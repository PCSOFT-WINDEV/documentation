


## Assisted universal replication through programming
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Overview
<a name="overview_ELTTEXTE000310"></a>
The assisted replication through programming is used to implement a replication on an existing application while controlling the synchronization in the application itself. The user starts the synchronization via the application directly, without using any external application.

The assisted replication through programming allows you to use all the available replication modes:

- direct replication, <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=replication_directe_prog.gif)


- replication by server with immediate or periodic replica. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=replication_serveur_prog.gif)







<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## HFSQL Classic database: Implementing the replication through programming
<a name="hfsql_classic_database_implementing_the_replication_through_programming_ELTTEXTE000340"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 

### Step 1: Programming the access to the HFSQL Classic files locally
<a name="step_1_programming_the_access_the_hfsql_classic_files_locally_ELTPARAGRAPHE000029"></a>

If an application uses the assisted universal replication, it accesses a local database containing the necessary data only. The main database (master database) is used during the synchronization only.

Therefore, the application must be modified in order to access the local data files. You must program:

- the creation (if necessary) of the local files.

- the access to these local files (with [HChangeDir](../WDLang4/3044168.md), [HSubstDir](../WDLang4/3044028.md), [HChangeName](../WDLang4/3044141.md), ...).



<a name="NOTE3_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 

### Step 2: Describing the replication
<a name="step_2_describing_the_replication_ELTPARAGRAPHE000052"></a>

The description of the replication is performed in a ".WER" file created by ReplicEdit. ReplicEdit is used to:

- define the files taken into account by the replication, the filters taken into account when updating the data. For more details, see [Creating a replication with ReplicEdit](../ReplicEdit/3526501.md).

- configure the location of the master files ("General" tab in the description window of the files in ReplicEdit). For more details, see [Replication options defined in ReplicEdit](../ReplicEdit/3526502.md).



<a name="NOTE3_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 

### Step 3: Programming the replication
<a name="step_3_programming_the_replication_ELTPARAGRAPHE000070"></a>

The local database is initialized when the first synchronization is performed between the application and the master database. The master database is found in the WER file generated by ReplicEdit.

**For a direct assisted replication:** Example of code that can be used:


```wl
// Initializes the replication by passing the zip code to take into account
IF ReplicInfo("MyReplication", replicInitialized) = False THEN
	ReplicInitialize("MyReplication", 47012)
END

// Starts the synchronization
ReplicSynchronize("MyReplication")
```


The local database must be initialized once only by [ReplicInitialize](../WDLang4/1000017195.md).

Then, a single data synchronization is required ([ReplicSynchronize](../WDLang4/1000017196.md))

**For an assisted replication with replication server**: If you perform an assisted replication with replication server, [ReplicOpen](../WDLang4/1000017194.md) must be called before [ReplicInitialize](../WDLang4/1000017195.md) to specify the parameters of the replication server. Example:


```wl
// Starts the replication on the replication server
ReplicOpen("MyReplication", "", "ReplicationServer", "Flora", "password")

// Initializes the replication by passing the zip code to take into account
IF ReplicInfo("MyReplication", replicInitialized) = False THEN
	ReplicInitialize("MyReplication", 47012)
END

// Starts the synchronization
ReplicSynchronize("MyReplication")
```

<a name="NOTE3_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png) 

### Step 4: Deploying the application
<a name="step_4_deploying_the_application_ELTPARAGRAPHE000103"></a>

The setup program is prepared like for any standard application.

**Important**: When creating the setup program, do not ask to install the assisted replication (uncheck "Install and configure the modules for assisted universal replication").
Reminder: To create the setup program, go to the "Project" tab, "Generation" group, expand "Setup procedure" and select "Create setup procedure".

**Direct assisted replication (without replication server)**: The .WER file must be included in the list of files installed by the application. The .WER must contain all the characteristics of the paths to the master data files used by the application. The.WER file cannot be included in the library (WDL file).

If the location of the data files of the master database is unknown when creating the .WER file, it must be specified for each end-user computer installed. This operation can be performed:

- on the end-user computer directly. To do so, ReplicEdit must be supplied to the user. However, the user will have access to all replication characteristics. This solution may cause security problems.

- by the developer, once the path of the master database was specified by the end user. Then, the .WER is transmitted to the end user for update.




**Assisted replication with replication server**: If you perform an assisted replication with replication server, the .WER file must be deployed on the replication server with all the information regarding the master database. For more details, see [Server for Assisted Universal Replication](../WDLang4/1000017227.md).  

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## HFSQL Client/Server database: Implementing the replication through programming
<a name="hfsql_clientserver_database_implementing_the_replication_through_programming_ELTTEXTE000382"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Native Connectors (Native Accesses)](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Step 1: Programming the access to the files locally
<a name="step_1_programming_the_access_the_files_locally_ELTPARAGRAPHE000142"></a>

If an application uses the assisted universal replication, it accesses a local database containing the necessary data only. The main database (master database) is used during the synchronization only.

Therefore, the application must be modified in order to access the local data files. You must program:

- the creation (if necessary) of the local files.

- the access to these local files.




The **principle** is straightforward:

- **Defining the connections at analysis level**: The connections must be described at analysis level. Each file is associated with a connection.

- **Configuring the connections with ReplicEdit**: ReplicEdit is used to configure these connections in order to access the master databases.

- **Programming the access to the local files**: The code of the application will be used to switch each connection to an HFSQL Classic connection in order to use the files locally.




**Implementation**: If your application uses data files that require or or more connections (HFSQL Client/Server, native accesses, OLE DB files, ...): we recommend that you perform the following operations:

- in the data model editor: if your files are associated with no connection, create as many test connections as necessary. For example, if you are using HFSQL Client/Server data and Oracle data, two test connections must be defined in the analysis.

- in your code, modify the connections associated with the files: all you have to do is modify the parameters of the test connections to handle the local HFSQL Classic files. For example, the following code is used to define a local connection on HFSQL files:
	
	```wl
	HOpenConnection("HF_local", "", "", "", "", hAccessHF7)
	HChangeConnection("*", "HF_local")
	```




<a name="NOTE4_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Native Connectors (Native Accesses)](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Step 1 bis: Using a database not in HFSQL format
<a name="step_1_bis_using_database_not_hfsql_format_ELTPARAGRAPHE000169"></a>

To implement the assisted universal replication on different databases (Oracle, ...), a ***DateTime*** item must be created in each file taken into account by in the replication. This item will have to be updated by the application when modifying or adding a record.

If the databases use different time zones, we recommend that you use a universal format (GMT date and time for example).

**Example: Managing a specific item for the replication between an HFSQL database and a MySQL database**:

A trigger is implemented in order to automatically fill the "Itm_DateTime" item found in the MySQL database:

- Code of the trigger
	
	```wl
	TriggerResult is boolean
	TriggerResult = HDescribeTrigger("*", "HADD,HMODIFY,HDELETE,HCROSS,HWRITE", ...
		"AddDateTime", hTriggerBefore)
	IF TriggerResult = False THEN Error(HErrorInfo())
	```


- Procedure called by the trigger
	
	```wl
	PROCEDURE AddDateTime()
	TestReplic.Itm_DateTime = DateSys()+TimeSys()
	```




<a name="NOTE4_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Native Connectors (Native Accesses)](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Step 2: Describing the replication
<a name="step_2_describing_the_replication_ELTPARAGRAPHE000178"></a>

The replication is described by ReplicEdit. This tool is used to:

- define the files taken into account by the replication, the filters taken into account when updating the data. For more details, see [Creating a replication with ReplicEdit](../ReplicEdit/3526501.md).

- configure the location of the master files. All you have to do is redefine the connections of the analysis. The list of connections is returned by "Replication .. Description of connections" from ReplicEdit. For more details, see [Replication options defined in ReplicEdit](../ReplicEdit/3526502.md).




This information is saved in a ".WER" file created by ReplicEdit.
<a name="NOTE4_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/us/WINDOWS.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Native Connectors (Native Accesses)](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Step 3: Programming the replication
<a name="step_3_programming_the_replication_ELTPARAGRAPHE000198"></a>

The local database is initialized when the first synchronization is performed between the application and the master database. The connections to the master database are defined in the WER file generated by ReplicEdit.

**For a direct assisted replication:** Example of code that can be used:


```wl
// Initialize the replication by passing the zip code 
// to take into account
IF ReplicInfo("MyReplication", replicInitialized) = False THEN
	ReplicInitialize("MyReplication", 47012)
END

// Starts the synchronization
ReplicSynchronize("MyReplication")
```


The local database must be initialized once only by [ReplicInitialize](../WDLang4/1000017195.md).

Then, a single data synchronization is required ([ReplicSynchronize](../WDLang4/1000017196.md))

**For an assisted replication with replication server**: If you perform an assisted replication with replication server, [ReplicOpen](../WDLang4/1000017194.md) must be called before [ReplicInitialize](../WDLang4/1000017195.md) to specify the parameters of the replication server.


```wl
// Starts the replication on the replication server
ReplicOpen("MyReplication", "", "ReplicationServer", "Flora", "password")

// Initialize the replication by passing the zip code 
// to take into account
IF ReplicInfo("MyReplication", replicInitialized) = False THEN
	ReplicInitialize("MyReplication", 47012)
END

// Starts the synchronization
ReplicSynchronize("MyReplication")
```

<a name="NOTE4_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Native Connectors (Native Accesses)](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Step 4: Deploying the application
<a name="step_4_deploying_the_application_ELTPARAGRAPHE000231"></a>

The setup program is prepared like for any standard application. The .WER file must be included in the list of files installed by the application. The .WER file must contain all the characteristics of the connections to the master databases used by the application.

**Important**: When creating the setup program, do not ask to install the assisted replication (uncheck "Install and configure the modules for assisted universal replication").
Reminder: To create the setup program, go to the "Project" tab, "Generation" group, expand "Setup procedure" and select "Create setup procedure".

**Direct assisted replication (without replication server)**:  The .WER file must be included in the list of files installed by the application. The .WER must contain all the characteristics of the paths to the master data files used by the application. The.WER file cannot be included in the library (WDL file).

If the parameters for connecting to the master databases are unknown when crating the .WER file, they must be specified for each installed end-user computer. This operation can be performed:

- on the end-user computer directly. To do so, ReplicEdit must be supplied to the user. However, the user will have access to all replication characteristics. This solution may cause security problems.

- by the developer, once the path of the master database was specified by the end user. Then, the .WER is transmitted to the end user for update.




**For an assisted replication with replication server**: If you are performing an assisted replication with replication server, the .WER file must be deployed on the replication server with the information regarding the connections to the master databases. For more details, see [Server for Assisted Universal Replication](../WDLang4/1000017227.md).  


- ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=WDUniversalReplication.gif) ***Training (WINDEV)*** : **WD Universal Replication** <br>This examples explains how to use the universal replication to synchronize data of different sites.<br>The universal replication is used to synchronize the data of a site (master site) with the same data of one or more replicated sites (subscriber sites). The data structures are identical on each site but they can be exploited via different data managers. HFSQL Classic and Access will be used in this example.<br>The example presents the processes that must be included in your applications to allow the user, via a simple action (menu, button, ...), to:<br>- create a master replica, <br>- create one or more subscriber replicas, <br>- see and modify the data of these replicas, <br>- export the created or modified data to a site (portable replica), <br>- import the created or modified data into another site...


