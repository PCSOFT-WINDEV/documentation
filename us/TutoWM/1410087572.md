
## Lesson 4.2. Developing the application


<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## In this lesson you will learn the following concepts
<a name="this_lesson_you_will_learn_the_following_concepts_ELTTEXTE001151"></a>


- Creating a window containing a looper. 

- Specific controls: Looper, Multiline Zone and Map controls, etc. 

- Handling the database.

- Features specific to the device used (GPS, Camera, etc.). 





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=dur%E9e.png)<br> | <br>Estimated time: 30 mn |



| [Previous Lesson](../TutoWM/1410087571.md) | [Table of contents](../TutoWM/1410087586.md) | [Next Lesson](../TutoWM/1410087573.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Project analysis
<a name="project_analysis_ELTTEXTE001198"></a>
Let's take a look at our initial project. 



- If necessary, open the "WM Product Management" project: 

	1. Go to the WINDEV Mobile home page (Ctrl + &lt;).  

	2. On the home page, click "Tutorial", then in "Part 4 - Development of an Android/iOS application", double-click "Android/iOS product management - Exercise".
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=exemple-WM.png) | Answers | A completed project is available. This project contains the different windows that will be created in this lesson. To open the completed project, go to the home page and click "Tutorial", then in "Part 4 - Development of an Android/iOS application", double-click "Android/iOS product management - Answers". |











This project does not contain any windows. It only contains the analysis describing the HFSQL Classic data files that will be used. The corresponding data files are provided with data in order to run the different tests.



Before going any further, let's do a quick **reminder of the terms** used in the analysis: 

- **Data file**: The analysis allows you to define the structure of the database files. A "Data file" corresponds to a "table" in some databases.
	In WINDEV Mobile, "***Table***" represents a graphic object used to view the content of a data file in a table and/or to enter rows. A table can be used to type the order details for example.

- **Record**: A record is sometimes called row. A data file record corresponds to all items defined for the data file.

- **Item**: In the analysis, an item represents a section of a data file. All items in a data file are used to define the structure of a record.

- **Key/Index**: In WINDEV Mobile and HFSQL, the concept of index is linked to the concept of key. A key is part of the item characteristics. Keys allow fast access to data and simplify loop through operations on data files. In WINDEV Mobile, if an HFSQL data file includes multiple key items, a single index file will be created at runtime.






- To view the analysis associated with the project:

	1. Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Analyse_WM_GAF.jpg) in the quick access buttons of the WINDEV Mobile menu.

	2. The data model editor is displayed.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Analyse%20-%20HC%20N%B0001.jpg)


	3. This analysis includes 3 data files:

	- A "Product" data file, which contains the product description: caption, price, quantity, etc.

	- A "Characteristic" data file, which contains the different product characteristics. For example, if the product is a T-shirt, its characteristics will be the size, color, etc. The "Characteristic" data file is therefore linked to the "Product" data file.

	- A "Store" data file, which contains the GPS coordinates of each store.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Displaying the list of products
<a name="displaying_the_list_products_ELTTEXTE001240"></a>
We will create a window to list the different products. These products will be displayed in a "Looper" control.

We will create this window via the window creation wizard. |   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | The window creation wizard offers several preset windows. These windows have modern UIs for your applications.<br><br>Most of these windows can be generated from your data, you just need to write the necessary WLanguage code. They can be used straightaway. |






### Creating the window
<a name="creating_the_window_ELTPARAGRAPHE000083"></a>

- To create the window used to list the products:

	1. Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Nv_WM_GAF.jpg) in the quick access buttons. The new element window appears: click "Window" then "Window".

	2. In the wizard, select the "Standard" tab. In the "Phone" area, choose "Looper" and validate.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | If you are using an iOS configuration, the window for creating a new window contains additional options, specific to iOS. <br><br>A "Looper" window can be created for both, iOS and Android.<br><br>Reminder: The images in part 4 of this tutorial use the Android configuration. Slight differences may appear if you use the iOS configuration. |





	3. The window creation wizard starts.

	4. Since our project contains multiple platforms (iOS and Android), the wizard prompts you to select the platform to be used to create the window. We recommend that you select the platform with the lowest resolution (in this case, "Generic iPhone"). <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Liste_produit_RAD%20-%20HC%20N%B0002.jpg&type=thumb)
Go to the next step of the wizard.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | If your project contains both platforms (Android and iOS), choosing "generic iPhone" will automatically generate the window for this platform. The "iOS" platform automatically becomes the current platform of your project. |





	5. The wizard prompts you to choose the data source associated with the window. In our case, it will be the "Product" data file:

		- The "Data files" option is selected by default.

		- Select the Product data file.<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Liste_produit_RAD%20-%20HC%20N%B0004.jpg&type=thumb)







- If your project uses both project configurations (Android and iOS), you can use the same window for the Android configuration: 

	1. Expand "Configurations (iOS application)" at the top of the "Project explorer" pane. 

	2. Double-click the "Android application" configuration. 

	3. The Android configuration is automatically selected and the corresponding window appears.  









- We will run a first test in the Android simulator to see the result. Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_GO_Fen_WM_GAF.jpg) in the quick access buttons (or press F9).<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Liste_produit_RAD_Go%20-%20HC%20N%B0001.jpg&type=thumb)





- Close the simulator to go back to the window editor.


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | When a project is associated with multiple platforms, the current window is tested with the current platform. The shell used for the simulator is also adapted to the current platform.<br><br>To run the test on another platform (iOS, for example), simply double-click its name in the "Project explorer" pane. <br><br>Remark: In this part, the images representing the tests correspond to an Android shell. |





<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Creating the form window
<a name="creating_the_form_window_ELTTEXTE001360"></a>
We will create a new window to display the product form. Then, this window will be opened from the list of products to display the details of the selected product.


### Creating the window
<a name="creating_the_window_ELTPARAGRAPHE000187"></a>

- To create the form window:

	1. Create a new blank window.

		- Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Nv_WM_GAF.jpg) in the quick access buttons.

		- The new element window appears: click "Window" then "Window".

		- In the wizard, select the "Standard" tab, choose "Blank" and validate.




2. The save window appears. Specify the window title: "Product form". Its name is automatically completed: "WIN_Product_form". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Fiche%20produit%20Enregistrement%20-%20HC%20N%B0001.jpg)
Validate. 

3. The window is added to the project, for all configurations. 


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | **If multiple platforms are defined in the project**, the save window associates the new element to all platforms by default.<br><br>To associate the element to a single platform, simply expand "Configurations" in the save window and choose the desired platform:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Fiche%20produit%20Enregistrement%20-%20HC%20N%B0002.jpg)<br> |






### Creating controls
<a name="creating_controls_ELTPARAGRAPHE000210"></a>

- To create the different Edit controls that will display the product details:

	1. Open the "Analysis" pane if necessary: on the "Home" tab, in the "Environment" group, expand "Panes", select "Panes", and then select "Analysis". The different data files described in the "WM Product Management" analysis appear in the pane.

	2. Select the items of the "Product" data file displayed in the pane (except for the "ProductID" item).

	3. Drag the items and drop them onto the window you have just created.<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Fiche%20produit%202%20-%20HC%20N%B0001.jpg&type=thumb)


	4. Resize the controls ("Caption", "Descr.", "Bar cod." and "Reorder.") so that they fit in the window.

5. Reorganize the controls in the window. Follow this order: "Photo", "Caption", "Descr.", "Price", "Ref", "Bar cod.", "Quantity", "Reorder.".<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Fiche%20produit%20-%20HC%20N%B0001.jpg&type=thumb)




- Test the "WIN_Product_form" window (click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_GO_Fen_WM_GAF.jpg) in the quick access buttons). 

	1. The window is displayed with empty controls.

	2. Close the simulator.







- To display the product data:

	1. Open the WLanguage events associated with the window:

		- Right-click the area next to the window.

		- Select "Code" in the context menu that appears.

		- The code editor appears.




2. Enter the following WLanguage code in the "End of initialization of WIN_Product_form" event:
			
		```wl
		Product.ToWindow()
		```

			[&lt;Data file&gt;.ToWindow](../WDLang4/1000021397.md) gets the data from the current record in the data file and displays it in the window controls. In our case, the current record will be the record selected in the Looper control of "WIN_List_of_products". This Looper control is linked to the Product data file. 

3. Close the code window.

4. Save the window.





### Opening the form from the list of products
<a name="opening_the_form_from_the_list_products_ELTPARAGRAPHE000266"></a>

Now, let's see how to open the form of the product selected in the list of products.



- Follow these steps:

	1. Select the "List of products" window: click "WIN_List_of_products" in the open document tabs (under the WINDEV Mobile ribbon):  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Fiche%20produit%20-%20HC%20N%B0001%201.jpg)


	2. Select the Looper control. 
			Caution: make sure you select the Looper control and not one of its controls. 

3. Right-click to open the context menu of the Looper control and select "Code".

4. In the code editor, write the following WLanguage code in the "Select a row in LOOP_Product" event:
			
		```wl
		WIN_Product_form.OpenMobileWindow()
		```

			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | Let the code completion guide you: a drop-down list with the names of the different elements of the project appears as you type the name of the window. Select the name of the desired window. Similarly, the different functions and properties that can be used in the window appear when you insert a '.' (dot) after the name of the window.  <br><br>Remark: If the window name does not appear in the list, it means that it has not been saved. |





5. Save changes by clicking ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Sauver_WM_GAF.jpg) in the quick access buttons.

6. Close the code window (click the "X" icon in the upper-right corner of the code editor).




- Test the "WIN_List_of_products" window again in the simulator (click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_GO_Fen_WM_GAF.jpg) in the quick access buttons).

	- In the list of products, click one of the products.

	- The detailed product window is displayed.







- Close the simulator.




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Creating and modifying a product
<a name="creating_and_modifying_product_ELTTEXTE001438"></a>
We will now modify our two windows to create and modify a product.
<a name="NOTE5_2"></a>


### Modifying the product form
<a name="modifying_the_product_form_ELTPARAGRAPHE000313"></a>When creating the form window, an Action Bar was automatically created. This Action Bar contains a button on the left to cancel the current input and go back to the previous window. In our case, this button will be used to go back to the list of products.<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Cr%E9ation%20modif%20produit%20-%20HC%20N%B0001.jpg)
No changes are required. 

We are going to add a validation button to the Action Bar of the "WIN_Product_form" window to confirm the changes.

- First, open the "WIN_Product_form" window: click the corresponding tab in the open document tabs.




- To add a validation option to the Action Bar:

	1. Select the Action Bar (at the top of the window). 

	2. Open the Action Bar description window: right-click and select "Description" in the context menu.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Cr%E9ation%20modif%20produit%20-%20HC%20N%B0002.jpg&type=thumb)

			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | The Action Bar description window adapts to the platforms used in the project. The Action Bar of an Android application is different from the Action Bar of an iOS application.<br><br>**Our project uses both Android and iOS configurations**: the window displays an overview of the Action Bar for both platforms.<br>If your project only uses an Android (or iOS) configuration, the options of the Action Bar will be shown depending on the platform. <br><br>Numbers allow you to access the options to configure.<br><br>We will only see the options required for our example.<br>For more details, see [Describing the Action Bar control](../WDChamp/1000025005.md). |





	3. Click on number 2 (any number 2 in the window). A new UI allows you to enter an option in the Action Bar. 

	4. Click "+" (below the "Top right" area) to add an option. A new option is created at the top right. 

	5. Change the characteristics of this option: 

		- In the "Option caption" area, type "Done".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Cr%E9ation%20modif%20produit%20-%20HC%20N%B0003.jpg&type=thumb)

						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | At runtime, the option caption appears in the Action Bar:<br><br>			- If no image is associated with the option.<br><br>			- If the option is moved to the bottom menu.<br><br><br> |





		- In the "Preset image" area, expand the list and select "Done".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Cr%E9ation%20modif%20produit%20-%20HC%20N%B0005.jpg&type=thumb)


		- Validate the description window.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | To go back to the Action Bar description, simply click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Nv_Produit%20-%20HC%20N%B0002%201.jpg). |





6. The WLanguage code of this option will be used to save the changes in the "WIN_Product_form" window. To write this code:

	- Select the Action Bar control. 

	- Click "OK". 

	- A drop-down menu with the "Done" option is displayed.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Cr%E9ation%20modif%20produit%20-%20HC%20N%B0006.jpg)

						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | This drop-down menu is only visible in edit mode to enter the WLanguage code associated with the option. This drop-down menu will not be displayed at runtime. |





	- Right-click the option.

	- Select "Code" in the context menu that appears.

	- Write the following WLanguage code in the "Select a menu" event:
						
			```wl
			Product.FromWindow()
			Product.Save()
			Close()
			```

						Let's take a look at these lines of code:

		- [&lt;Data file&gt;.FromWindow](../WDLang4/1000021403.md) updates the items of the current record with the data from the bound controls in the window.

		- [&lt;Data file&gt;.Save](../WDLang4/1000024606.md) updates the current record in the data file.




- When closing the product form, the content of the product list in the "WIN_List_of_products" window must be refreshed to take into account the changes made in the form. To do so, use the "Close a child window" of "WIN_List_of_products" event.

	1. Click "WIN_List_of_products" in the open document tabs:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Fiche%20produit%20-%20HC%20N%B0001%201.jpg)


	2. Right-click the window background and select "Code" in the context menu. The following WLanguage code is automatically displayed in the "Close a child window" event:
			
		```wl
		LooperDisplay(LOOP_Product,taCurrentSelection)
		```

			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | The generated code does not use prefix syntax but WLanguage "standard" syntax. In prefix syntax, this code is as follows: <br><br><br><pre><code>LOOP_Product.Display(taCurrentSelection)</code></pre><br> |





3. Let's take a look at this WLanguage code:

	- The "Close a child window" event is run when the child window of the current window is closed. In our case, it is run when the "WIN_Product_form" window is closed.

	- [&lt;Looper&gt;.Display](../WDLang2/1000023451.md) (or [LooperDisplay](../WDLang2/3083001.md)) updates the Looper control data in the "WIN_List_of_products" window. The **taCurrentSelection** constant updates the data according to the selection bar.
						This WLanguage code was automatically generated when the wizard created the window.




- Test the "WIN_List_of_products" window in the simulator (click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_GO_Fen_WM_GAF.jpg) in the quick access buttons).

	- In the list of products, click one of the products: for example, the "Polo Hibiscus, Blue" product.

	- The product detail window appears. Change the name to "Polo Hibiscus, Light blue" and click "OK".

	- When going back to the list of products, you will notice that the name of this article was updated.







- Close the simulator. The WINDEV Mobile editor is displayed.



<a name="NOTE5_3"></a>


### Creating a new product
<a name="creating_new_product_ELTPARAGRAPHE000438"></a>

The principle for creating a product is as follows:

- In the list of products, we will add an option in the window Action Bar to open the "Product form" window.

- Then, we will edit the WLanguage code of the "Product form" window to add data to the Product data file.




- To add an option to the Action Bar:

	1. Open the "WIN_List_of_products" window in the editor: click the corresponding tab in the open document tabs.

	2. Select the Action Bar (at the top of the window).

	3. Open the Action Bar description window: right-click and select "Description" in the context menu.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Nv_Produit%20-%20HC%20N%B0001.jpg&type=thumb)


	4. Click on number 2 (any number 2 in the window). The interface for typing an option in the toolbar appears. 

5. Click "+" (below the "Top right" area) to add an option. A new option is created at the top right. Change the characteristics of this option: 

	- In the "Option caption" area, type "New product".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Nv_Produit%20-%20HC%20N%B0002.jpg&type=thumb)




- Let's now check how to add records in the product form window.

	1. Open the "WIN_Product_form" window: click the corresponding tab in the open document tabs.

	2. Display the code of validation option in the Action Bar:

		- Select the Action Bar.

		- Click "OK". 

		- A drop-down menu with the "Done" option is displayed. 

		- Right-click "Done" and select "Code" in the context menu.

		- The WLanguage code of the "Click" event does not change:
						
			```wl
			Product.FromWindow()
			Product.Save()
			Close()
			```

						Let's look at this code again:

			- By default, [&lt;Data file&gt;.Save](../WDLang4/1000024606.md) is equivalent to [&lt;Data file&gt;.Modify](../WDLang4/1000025038.md): the current record in the data file is modified. 

			- If [&lt;Data file&gt;.Reset](../WDLang4/1000025052.md) has been called before [&lt;Data file&gt;.Save](../WDLang4/1000024606.md) (which is the case when a new product is added), [&lt;Data file&gt;.Save](../WDLang4/1000024606.md) adds the new record in the data file (equivalent to [&lt;Data file&gt;.Add](../WDLang4/1000024187.md)). 




3. Close the code window (click the "X" icon in the upper-right corner of the code editor).




- Open "WIN_List_of_products" in the window editor and test it in the simulator (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_GO_Fen_WM_GAF.jpg) in the quick access buttons).

	- Click "+" in the Action Bar. 

	- Enter a new product.

	- Validate. The new product appears in the list of products.

	- Close the simulator.





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | The project uses several platforms: we recommend that you test the project via the "GO" button for each platform. You will notice the application looks and behaves differently on each platform in the simulator. |





<a name="NOTE6"></a>
<a name="NOTE6_1"></a>


## Using the camera and displaying an image
<a name="using_the_camera_and_displaying_image_ELTTEXTE001582"></a>
|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=avertissement.png) | Caution! | This paragraph requires a device equipped with a camera. <br><br>If this is not the case, go to the next paragraph directly.<br><br>Furthermore, this paragraph requires the application to be installed on the device because it uses hardware resources that are not accessible in Simulation mode. |






### Overview
<a name="overview_ELTPARAGRAPHE000547"></a>

We will manage the product image using the device camera.

To do so, we are going to:

- create a Button control to launch the camera. The photo will be stored as an image in memory and displayed in the Image control of the product.

- create a Button control to select a photo from the mobile device's album.





### Creating the button for taking photos
<a name="creating_the_button_for_taking_photos_ELTPARAGRAPHE000557"></a>

- To create the Button control to be used to take photos:

	1. Open the "WIN_Product_form" window.

	2. Add a Button control in the window:

		- On the "Creation" tab, in the "Usual controls" group, click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Bouton_WM_GAF.jpg): the control shape appears under the mouse.

		- Then click on the top right of the Image control to create the Button control.







- We will modify the Button control to associate it with an image representing a camera:

	1. Right-click the control to open its context menu.

	2. Select "Description". The control description window appears.

	3. In the "General" tab, click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=Menu_Image_Editeur%20-%20HC%20N%B0001.gif) to the right of "Image". Select "Catalog" in the context menu that appears. 

	4. The image catalog of WINDEV Mobile is opened. This catalog contains hundreds of images in different fields, formats and sizes.

	5. Enter "photo" in the search box at the top and validate. Several images are displayed:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Appareil%20photo%20-%20HC%20N%B0001.jpg&type=thumb)


	6. Double-click the <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Appareil%20photo%20-%20HC%20N%B0001%201.jpg)
 image to select it.

7. In the window that appears, you can select the image size, color, orientation, format and name.

8. Keep all default options and name the image "Camera".

9. Validate the window.

10. The path of the image is displayed in the Button control description.

11. Give a name to the control: "BTN_Camera".

12. Clear the control caption.

13. Validate the description window.

14. In the editor, reduce the control size.




- This Button control uses the default style from the "Phoenix" skin template associated with the project: the control background is blue. In our case, the blue background is not necessary. We will change the style associated with the control: 

	1. If necessary, select the Button control you have just created. 

	2. Open the context menu and select "Choose a style". 

	3. The window that appears lists all styles that can be used for the Button controls in the Phoenix skin template.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20S%E9lection%20du%20style%20-%20HC%20N%B0001.jpg&type=thumb)


	4. Click the search icon and enter "BTN_Blank". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20S%E9lection%20du%20style%20-%20HC%20N%B0002.jpg)
This name corresponds to a style without background color. This is the style we are going to use. 

5. Validate the style selection window. 

6. The chosen style is automatically applied to the Button control.  





### Taking photos
<a name="taking_photos_ELTPARAGRAPHE000612"></a>

We will now enter the WLanguage code to take a photo and display it in the Image control of the product form.



- To take photos:

	1. Right-click the Button control and select "Code" in the context menu.

	2. Write the following WLanguage code in the "Click" event:
			
		```wl
		// Local variable
		ProductImage is string 
		// Start the camera
		ProductImage = VideoStartApp(viPictureCapture)
		IF ProductImage <> "" THEN
			IMG_Photo = ProductImage
		END
		```
In this WLanguage code, [VideoStartApp](../WDLang1/1000019368.md) is used to launch the native camera application on the device to record videos or take photos.

	3. Save changes by clicking ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Sauver_WM_GAF.jpg) in the quick access buttons.

	4. Close the code window (click the "X" icon in the upper-right corner of the code editor).








### Selecting a photo in the photo album
<a name="selecting_photo_the_photo_album_ELTPARAGRAPHE000634"></a>

We will add a Button control to select a photo from the device album and associate it with the product.



- To create the Button control for selecting the photo, we will "Copy - Paste" the photo Button control that we have just created:

	1. Select the "BTN_Camera" Button control.

	2. Press Ctrl + C: the Button control is copied to the clipboard. 

	3. Press Ctrl + V: the mouse cursor changes and the control shadow appears under the cursor.

	4. Click in the window next to the "BTN_Camera" control: the new Button control is automatically created.

	5. Open the control description window (double-click the control):

		- Give a name to the control: "BTN_Photo_Album".

		- Select an image in the image catalog.
						Remark: Don't forget to change the default image name. 




6. Validate the description window. 


Remark: Since this Button control is a copy of the Button control used to take photos, the style characteristics are identical. There is no need to change them! 



- The WLanguage code of this Button control opens the device's photo album and selects an image to display it in the Image control of the product form.

	1. Right-click the button and select "Code" in the context menu.

	2. Replace the WLanguage code of the "Click" event with the following WLanguage code:
			
		```wl
		// Local variable
		ProductImage is string 
		// Start the selection
		ProductImage = AlbumPicker(albumImage)
		IF ProductImage <> "" THEN
			IMG_Photo = ProductImage
		END
		```
In this WLanguage code, [AlbumPicker](../WDLang3/1000020186.md) retrieves the selected photo from the photo album.

	3. Save changes by clicking ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Sauver_WM_GAF.jpg) in the quick access buttons.

	4. Close the code window (click the "X" icon in the upper-right corner of the code editor).







<a name="NOTE7"></a>
<a name="NOTE7_1"></a>


## Product bar code
<a name="product_bar_code_ELTTEXTE001648"></a>
|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=avertissement.png) | Caution! | This paragraph requires a device equipped with a camera.<br><br>Otherwise, you will not be able to test it.<br><br>Furthermore, this paragraph requires the application to be installed on the device because it uses hardware resources that are not accessible in Simulation mode. |






### Overview
<a name="overview_ELTPARAGRAPHE000686"></a>

The "Product" data file contains a "Bar_Code" item. This item is used to store the value of a bar code. Some devices (especially the ones equipped with a camera) can scan a bar code to retrieve its value.

The bar code will be scanned with the camera of the device and managed by a specific WLanguage function.


### Implementation
<a name="implementation_ELTPARAGRAPHE000693"></a>

- To create a Button control to manage bar codes:

	1. Display (if necessary) the "WIN_Product_form" window in the editor.

	2. Add a Button control in the window:

		- On the "Creation" tab, in the "Usual controls" group, click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Bouton_WM_GAF.jpg).

		- The control shape appears under the mouse.

		- Create the control next to the "Bar cod." control (resize the Edit control if necessary).




3. Open the Button control description window (double-click the control):

	- Give a name to the control: "BTN_Bar_Code".

	- Clear the control caption.

	- Select an image for the bar code in the image catalog (type "Code" in the search box, for example).




- We will change the control style, like we did for the Button control used to take a photo: 

	1. If necessary, select the Button control you have just created. 

	2. Open the context menu and select "Choose a style". 

	3. In the window that contains the available styles, click the search icon and enter "BTN_Blank".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20S%E9lection%20du%20style%20-%20HC%20N%B0002.jpg)


	4. The "BTN_Blank" style is automatically selected. 

5. Validate the style selection window. 

6. The chosen style is automatically applied to the Button control. 




- The WLanguage code of this Button control will make it possible to scan the bar code.

	1. Double-click the control and select "Code" in the context menu.

	2. Write the following WLanguage code in the "Click" event:
			
		```wl
		// Local variable
		bc is BarCode 
		// Start the scan
		bc = BCCapture()
		IF bc.Content <> "" THEN
			EDT_Bar_code = bc.Content
		END
		```
In this WLanguage code, [BCCapture](../WDLang5/1000019456.md) decodes the information stored in a bar code using the camera of the device.

	3. Save changes by clicking ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Sauver_WM_GAF.jpg) in the quick access buttons.

	4. Close the code window (click "X" in the code editor tab).







<a name="NOTE8"></a>
<a name="NOTE8_1"></a>


## Defining anchors in the Product form
<a name="defining_anchors_the_product_form_ELTTEXTE001702"></a>
<a name="Block_Managing_Anchors"></a>
All controls have been positioned in the Product form. The vertical and horizontal resolution may differ according to the devices. 

Anchors are used to adapt the size of the controls to the resolution and avoid "empty" spaces in the window (especially at the bottom right).

If the target device is specified when the project is created, the window size will be set to fit the target device. No anchoring is required. 

If the target device is not specified or multiple devices are used, the smallest common resolution must be chosen when creating the project. Anchors must be set in this case. 



- To set the anchors of the different controls in the window:

	1. Select the following controls (click each control while holding down the Ctrl key):

		- the Image control that displays the product image,

		- the Button control used to take photos,

		- the Button control for selecting a photo from the album.




2. Right-click to open the context menu of the selection and select "Anchor".

3. Select "Horizontally centered" (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Ancrage%20fiche%20-%20HC%20N%B0002%203.jpg)).  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Ancrage%20fiche%20-%20HC%20N%B0004.jpg)




- To set the anchors of the Edit controls:

	1. Select the following Edit controls (click each control while holding down the Ctrl key):

		- Caption

		- Description

		- Bar code

		- Reorder date

		- Reference




2. Right-click to open the context menu of the selection and select "Anchor". 

3. Select "Width" (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Ancrage%20fiche%20-%20HC%20N%B0004%202.jpg)).

4. Validate. 




- Repeat this action for the Reference control and the Button control used to manage bar codes. In this case, select "Right" (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Ancrage%20fiche%20-%20HC%20N%B0004%203.jpg)).




- All anchors have been defined in the window. The red arrows indicating the orientation of the anchors are displayed:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Ancrage%20fiche%20-%20HC%20N%B0001.jpg&type=thumb)





<a name="NOTE9"></a>
<a name="NOTE9_1"></a>


## Using the Map control
<a name="using_the_map_control_ELTTEXTE001726"></a>
We will see the Map control and the GPS WLanguage functions.

Our database contains a "Store" data file. This data file contains the addresses of the stores that will be located on a map using the mapping functions.


### Creating the window
<a name="creating_the_window_ELTPARAGRAPHE000808"></a>

We will create a new window and add a Map control.



- To create the window:

	1. Create a new blank window. Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Nv_WM_GAF.jpg) in the quick access buttons. The window for creating a new element appears: click "Window" then "Window". In the wizard, choose "Blank" and validate.

	2. The save window appears. Specify the window title: "Map of stores". Its name is automatically completed: "WIN_Map_of_stores". Validate.








### Creating the Map control
<a name="creating_the_map_control_ELTPARAGRAPHE000822"></a>

- To create the Map control:

	1. On the "Creation" tab, in the "Graphic controls" group, click "Map". The control shape appears under the mouse.

	2. Click inside the window to create the control. The Map control appears in the window editor.

	3. Open the "Map" control description window (double-click the control for example).

	4. In the control description window, specify the control name ("MAP_STORE") and validate.

	5. Save changes by clicking ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Sauver_WM_GAF.jpg) in the quick access buttons.








### Displaying stores on the Map control
<a name="displaying_stores_the_map_control_ELTPARAGRAPHE000847"></a>

We will add the code to display all stores of the "Store" data file on a map.

To do so, we will loop through the "Store" data file with a FOR EACH loop. Then, we will use Marker variables. Marker variables allow you to define the markers that will be displayed on a map.

A marker contains different information. We will use the following information:

- Name,

- Latitude,

- Longitude.


[&lt;Map&gt;.AddMarker](../WDLang3/1000022422.md) adds a marker in the Map control. Then, simply adjust the zoom level to see all markers in the Map control. If the zoom is not properly adjusted, some markers may not be visible or may overlap on the control.

**Implementation**

- To enter the WLanguage code to display the stores:

	1. Right-click outside the window. Select "Code" in the context menu that appears. The different WLanguage events associated with the window are displayed.

	2. Write the following WLanguage code in the "Global declarations of..." event.
			
		```wl
		// Global variables
		StoreMarker is Marker
		// Load the stores
		FOR EACH Store 
			// Marker coordinates
			StoreMarker.Position.Latitude = Store.Latitude
			StoreMarker.Position.Longitude = Store.Longitude
			// Marker name
			StoreMarker.Name = Store.Name
			// Add the marker
			MAP_STORE.AddMarker(StoreMarker)
		END
		// Best zoom to view all markers on the map
		MAP_STORE.Zoom = zoomAdaptSize
		```


	3. Save changes by clicking ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Sauver_WM_GAF.jpg) in the quick access buttons.

	4. Close the code window (click "X" in the code editor tab).







- Test the "WIN_Map_of_stores" window in the simulator (click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_GO_Fen_WM_GAF.jpg) in the quick access buttons). Then, close the simulator.




<a name="NOTE10"></a>
<a name="NOTE10_1"></a>


## Using a Multiline Zone control
<a name="using_multiline_zone_control_ELTTEXTE001768"></a>
The "Multiline Zone" control is usually used on mobile platforms. This control is used to group multiple controls:

- options of a category,

- information about a contact, etc.


This control can contain at the same time:

- rows defined in edit mode (static rows),

- rows defined at runtime, through programming (dynamic rows).




We will use a Multiline Zone control to create the main menu of the application. We will create a new window and insert a Multiline Zone control.

The window that will be created is as follows:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Menu%20ZML%20-%20HC%20N%B0001%201.jpg)



### Creating the window
<a name="creating_the_window_ELTPARAGRAPHE000901"></a>

We will create a window and add a Multiline Zone control.



- To create the window:

	1. Create a new blank window:

		- Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Nv_WM_GAF.jpg) in the quick access buttons.

		- The new element window appears: click "Window" then "Window". In the wizard, choose "Blank" and validate.




2. The save window appears. Specify the window title: "Menu". Its name is automatically completed: "WIN_Menu". Validate.





### Creating the Multiline Zone control
<a name="creating_the_multiline_zone_control_ELTPARAGRAPHE000918"></a>

- To create the Multiline Zone control:

	1. On the "Creation" tab, in the "Data" group, click "Multiline Zone". The control shape appears under the mouse.

	2. Click inside the window to create the control.

	3. Open the control description window (double-click the control, for example).

	4. In the description window, specify the control name ("MZ_MENU") and validate.







The Multiline Zone control contains an empty row. We will add as many rows as the number of options in our menu.

Our menu will include 3 options:

- List of products.

- Map of stores.

- Exit application.





### Modifying the Multiline Zone control
<a name="modifying_the_multiline_zone_control_ELTPARAGRAPHE000948"></a>

- To modify the Multiline Zone control:

	1. Open the control description window (double-click the control, for example).

	2. Click "New row". A window opens: this window contains all preset row templates.

	3. Select "Simple row with icon" and validate. Repeat this operation twice.
			Now, the Multiline Zone control contains:

		- a "blank" row,

		- 3 "simple rows with icon".  <br>![Multiline Zone control](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Menu%20ZML%20-%20HC%20N%B0002.jpg&type=thumb)







Each row includes an Image control, a Static control and an arrow image. We will change the image and text of each row to represent the actions in the menu.



**Modifying the 1st row: access to the list of products**

- To change the image in the first row of the Multiline Zone control:

	1. Click the Image control in the first row.

	2. Open the image description window (double-click the control).

	3. In the description window:

		- Give a name to the image ("IMG_ListOfProducts" for example).

		- Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=Menu_Image_Editeur%20-%20HC%20N%B0001.gif). Select "Catalog" in the context menu that appears to select an image representing the action.

		- In the image catalog window, type "List" in the search box and press Enter.

		- Double-click the image you want to select.

		- In the image configuration window, select a size (80 for example, W (Width) = 80 and H (Height) = 80), give a name to the image (e.g. "ListOfProducts") and validate.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=note.png) | Note | The image used in a Multiline Zone control is in "Homothetic extended centered" mode by default. The image will be automatically "resized" to the proper dimensions. |








4. Validate the description window.




- To change the text in the first row of the Multiline Zone control:

	1. Click the Static control in the first row.

	2. Open the description window (double-click the control).

	3. In the "General" tab of the description window:

		- Give a name to the control ("STC_ListOfProducts" for example).

		- Change the caption ("List of products" for example).




4. Validate the description window.<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=P4_MP%20-%20Menu%20ZML%20-%20HC%20N%B0003.jpg)




**Modifying the 2nd row: access to the map of stores**

- To change the image in the second row of the Multiline Zone control:

	1. Click the Image control in the second row.

	2. Open the image description window (double-click the control).

	3. In the description window:

		- Give a name to the image ("IMG_MapOfStores" for example).

		- Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=Menu_Image_Editeur%20-%20HC%20N%B0001.gif). Select "Catalog" in the context menu that appears to select an image representing the action. 

		- In the image catalog window, type "Map" in the search control and press Enter.

		- Double-click the image you want to select.

		- In the image configuration window, select a size (80 for example, W (Width) = 80 and H (Height) = 80), give a name to the image (e.g. "MapOfStores") and validate.




4. Validate the description window.




- To change the text in the second row of the Multiline Zone control:

	1. Click the Static control in the second row.

	2. Open the description window (double-click the control).

	3. In the "General" tab of the description window:

		- Give a name to the control ("STC_MapOfStores" for example).

		- Change the caption ("Map of stores" for example).




4. Validate the description window.




**Modifying the 3rd row: exit the application**

- To change the image in the third row of the Multiline Zone control:

	1. Click the Image control in the third row.

	2. Open the image description window (double-click the control).

	3. In the description window:

		- Give a name to the image ("IMG_Exit" for example).

		- Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=Menu_Image_Editeur%20-%20HC%20N%B0001.gif). Select "Catalog" in the context menu that appears to select an image representing the action. 

		- In the image catalog window, type "Close" in the search control and press Enter.

		- Double-click the image you want to select.

		- In the image configuration window, select a size (80 for example, W (Width) = 80 and H (Height) = 80), give a name to the image (e.g. "Close") and validate.




4. Validate the description window.




- To change the text in the third row of the Multiline Zone control:

	1. Click the Static control in the third row.

	2. Open the description window (double-click the control).

	3. In the "General" tab of the description window:

		- Give a name to the control ("STC_Exit" for example).

		- Change the caption ("Exit application" for example).




4. Validate the description window.




- We will change the text style so that it is shown in black:

	1. Click the Static control in the first row. 

	2. Open the description window (Alt + Enter). 

	3. In the "Style" tab, select the "Caption" element, expand "Font color" and select black. 

	4. Validate the description window. 

	5. The text color changes automatically. 







- To repeat this action on the other Static controls: 

	1. Click the Static control in the second row. 

	2. Press F4. This key repeats the last action. In this case, the text becomes black. 

	3. Select the Static control in the third row and press F4 again. 








### Programming the menu
<a name="programming_the_menu_ELTPARAGRAPHE001081"></a>

- Finally, we will write the WLanguage code necessary to perform each action in the menu:

	1. Right-click the Multiline Zone control and select "Code". 
			**Caution**: make sure you select the Multiline Zone control and not one of its controls.

	2. In the code editor, type the following WLanguage code in the "Select (click) a row in..." event:
			
		```wl
		SWITCH MZ_MENU
			CASE 1 // List of products
				WIN_List_of_products.OpenMobileWindow() 
			CASE 2 // Map of stores
				WIN_Map_of_stores.OpenMobileWindow() 
			CASE 3 // Exit application
				Close()	
		END
		```


	3. Save changes by clicking ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_Sauver_WM_GAF.jpg) in the quick access buttons.

	4. Close the code window (click the "X" icon in the upper-right corner of the code editor).







<a name="NOTE11"></a>
<a name="NOTE11_1"></a>


## Application test
<a name="application_test_ELTTEXTE001834"></a>
The last step consists in specifying that the menu window is the first window of the application. To do so, we will test the entire project and define the first window of the application.



- To define the first project window:

	1. Select the "WIN_Menu" window in the "Project explorer" pane.

	2. Open the context menu.

	3. Select "First project window". A specific icon (with a small 1) appears to the left of the window name, in the "Project explorer" pane.







So far, we have tested the windows individually by clicking ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_GO_Fen_WM_GAF.jpg) in the quick access buttons. We will now test the entire project. 

- To start the project test on the simulator:

	1. Click ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=3&name=ICO_GO_simu_PRJ_WM_GAF.jpg) in the quick access buttons.

	2. Your project starts with the menu window. Click an option of your menu to check whether the different links are correct.







| [Previous Lesson](../TutoWM/1410087571.md) | [Table of contents](../TutoWM/1410087586.md) | [Next Lesson](../TutoWM/1410087573.md) |
| --- | --- | --- |




