
## Normes de programmation sous Windows Vista et supérieur
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000162"></a>
Pour augmenter la sécurité des postes face aux vers et virus, Windows Vista/7 a mis en place le [mécanisme de l'UAC](../Editeurs/2025014.md) (le contrôle de compte utilisateur). Par défaut, ce mécanisme considère que tous les utilisateurs (administrateurs y compris) sont de simples utilisateurs avec des droits réduits. Pour exécuter une application nécessitant des droits supplémentaires, le mécanisme de l'UAC demande une confirmation.

Cette page d'aide présente différents conseils de programmation pour créer une application ne nécessitant pas de privilèges administrateur (aucune confirmation ne sera demandée à son lancement) et respectant les normes de programmation de Windows Vista (et supérieur).



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Conseils de programmation
<a name="conseils_programmation_ELTTEXTE000186"></a>


### Emplacement des fichiers manipulés par l'application
<a name="emplacement_des_fichiers_manipules_par_application_ELTPARAGRAPHE000024"></a>Pour créer et modifier un fichier sans avoir besoin de privilèges administrateur, il est nécessaire :

- de ne pas écrire dans le répertoire "Windows".

- de ne pas écrire dans le répertoire "Program files". Par contre, il est conseillé d'installer les applications dans ce répertoire.




**Conséquences** : 

- **Si une application doit créer ou modifier des fichiers de données HyperFileSQL**, ces fichiers de données doivent être localisés par exemple dans le répertoire correspondant à l'application (connu avec la fonction [SysRep](../WDLang1/3073026.md) et la constante *srAppDataCommun*).

- **Si une application doit créer ou modifier des fichiers externes**(fichiers .INI, fichiers texte, ...), ces fichiers doivent être localisés par exemple dans le répertoire correspondant à l'application (connu avec la fonction [SysRep](../WDLang1/3073026.md) et la constante *srAppDataCommun*). Il est également nécessaire de faire attention à l'utilisation de la fonction [INIEcrit](../WDLang1/3013039.md) et de bien spécifier tous ses paramètres.

- **Exécutables autonomes** : Si un exécutable autonome est installé dans le répertoire "Program files", le framework ne sera pas copié dans le répertoire. Il est conseillé de ne pas utiliser d'exécutable autonome, mais plutôt de faire une installation auto-extractible.




**Remarque** : Si ces opérations ne sont pas réalisées, en 32 bits le mécanisme de virtualisation redirige les fichiers vers un emplacement spécifique, accessible uniquement par l'utilisateur (répertoire C:\\Users\\&lt;LOGIN&gt;AppData\\Local\\VirtualStore\\Windows\\). Cette redirection a pour but d'assurer la compatibilité des applications. Pour plus de détails, consultez [Mécanisme de l'UAC](../Editeurs/2025014.md).


<a name="NOTE2_2"></a>


### Utilisation de la base de registre
<a name="utilisation_base_registre_ELTPARAGRAPHE000055"></a>Pour écrire dans la base de registre sans avoir besoin de privilèges administrateur, il est nécessaire de ne pas écrire dans la clé "HKEY_LOCAL_MACHINE\\SOFTWARE".

**Remarque** : Si l'utilisateur n'a pas les droits nécessaires, le mécanisme de l'UAC effectue une redirection automatique vers la clé "HKEY_CURRENT_USER\\Software\\Classes\\VirtualStore\\MACHINE\\SOFTWARE". Cette redirection a pour but d'assurer la compatibilité des applications. Les clés écrites dans ce répertoire pourront être lues par l'application qui les a écrites. Pour plus de détails, consultez [Mécanisme de l'UAC](../Editeurs/2025014.md).



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Adapter une application existante pour Windows Vista (et supérieur)
<a name="adapter_une_application_existante_pour_windows_vista_superieur_ELTTEXTE000216"></a>
Votre application est déjà utilisée sous Windows Vista/7, mais vous voulez que cette application réponde aux normes de programmation Vista/7 ?

Si votre application est une application Monoposte utilisant des fichiers de données, il est nécessaire de modifier l'emplacement des fichiers de données dans votre application pour respecter les normes de programmation Vista/7 (voir paragraphe ci-dessus).

Chez l'utilisateur final, plusieurs cas peuvent se présenter : 

- Si l'application a été lancée en tant qu'administrateur (utilisation d'un manifeste administrateur ou case à cocher utilisée dans les propriétés de l'exécutable), les fichiers de données de l'application sont présents dans le répertoire spécifié dans votre application.

- Si l'application a été lancée en tant qu'utilisateur simple, Windows Vista/7 a automatiquement virtualisé les répertoires utilisés (si l'accès à ces répertoire était interdit pour cet utilisateur). Les fichiers de données de l'application sont présents dans le répertoire : C:\\Users\\&lt;LOGIN&gt;AppData\\Local\\VirtualStore\\Windows\\






<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Exemples de fonctions affectées par la gestion des droits utilisateur sous Vista (et supérieur)
<a name="exemples_fonctions_affectees_par_gestion_des_droits_utilisateur_sous_vista_superieur_ELTTEXTE000240"></a>


### Familles de fonctions pouvant être affectées par le mécanisme de l'UAC
<a name="familles_fonctions_pouvant_etre_affectees_par_mecanisme_uac_ELTPARAGRAPHE000085"></a>Voici les différentes familles de fonctions ou fonctions dont le fonctionnement peut être modifié par l'activation du mécanisme de l'UAC (Rappel : le mécanisme de l'UAC est activé par défaut sur Windows Vista/7) :

- Les fonctions de gestion des fichiers externes ([fonctions fxxx](../WDLang1/3036034.md)).

- Les fonctions de gestion de la base de registre (fonctions [RegistreXXX](../WDLang1/3065004.md)).

- Les fonctions de gestion des fichiers .INI ([INILit](../WDLang1/3013043.md) et [INIEcrit](../WDLang1/3013039.md))

- Les fonctions [LanceAppli](../WDLang1/3035006.md), [LanceAppliAssociée](../WDLang1/3035007.md)

- La fonction [EnvoieTouche](../WDLang1/3014014.md)




Cette liste n'est pas exhaustive.




