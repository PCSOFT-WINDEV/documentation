
## Utilisation de sites déconnectés
			

<DIV class="specObsolete">
	<IMG style="float:left;margin-right:10px;" src="https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=warning_big.png"><B>Avertissement</B><BR>
	A partir de la version <B>23 (50)</B>,  cette fonctionnalité n'est plus disponible
</DIV><a name="NOTE0_0"></a>


## Présentation
<a name="presentation_ELTTEXTE000155"></a>
WEBDEV permet d'indiquer qu'un site ou un ensemble de pages peuvent fonctionner en mode déconnecté (sans connexion Internet). 

Si le site peut fonctionner en mode déconnecté, l'ensemble des ressources (pages, images, fichier .js, fichier .css) utilisées par le site ou les pages est automatiquement mis en cache par le navigateur sur le poste de l'internaute.

Ainsi le site peut être utilisé sans se reconnecter à Internet.

La fonction navigateur [NavigateurEstConnecté](../WDLang2/1000019392.md) permet de savoir si le navigateur est en mode connecté ou en mode déconnecté et d'adapter le comportement du site. 

Cette fonctionnalité utilise la gestion des manifestes disponible avec HTML 5. Certains navigateurs (notamment Internet Explorer 8 ou des navigateurs anciens) ne gèrent pas cette fonctionnalité. 

**Remarque** : La mise en cache de site utilisée est spécifique à HTML 5 : 

- Avant l'utilisation de HTML 5, seules les pages visitées pouvaient être mises en cache. 

- Grâce à HTML 5, la mise en cache se fait à la première connexion à un site. Un fichier manifeste spécifique permet de lister toutes les ressources à mettre en cache. 




<a name="NOTE0_1"></a>


## Mise en place
<a name="mise_place_ELTTEXTE000179"></a>


### Définition des ressources à mettre en cache
<a name="definition_des_ressources_mettre_cache_ELTPARAGRAPHE000032"></a>La définition des ressources à mettre en cache est réalisée sous l'environnement de développement. Pour indiquer les pages disponibles en mode déconnecté : 

1. Ouvrez si nécessaire le projet WEBDEV. 

2. Sous le volet "Projet", déroulez "Web" et sélectionnez "Cache (mode déconnecté)".

3. Dans la fenêtre qui s'ouvre, sélectionnez les pages à mettre en cache. 
	**Attention** : Seules les pages dynamiques AWP, PHP et les pages statiques peuvent être mises en cache. 

4. Fermez la fenêtre. 




A la prochaine recompilation du projet, le fichier "&lt;Nom_Projet&gt;.manifest" est généré automatiquement dans le sous-répertoire de la langue présent dans le répertoire _WEB du projet. Ce fichier va contenir les pages spécifiées et toutes leurs dépendances (images, feuilles de styles CSS, fichiers Javascript, ...). 


### Configuration du serveur
<a name="configuration_serveur_ELTPARAGRAPHE000051"></a>L'utilisation d'un manifeste nécessite une configuration spécifique du serveur. Il est nécessaire de configurer un type mime spécifique :
 ".manifest" associé à "text/cache-manifest" 

Pour tester votre site, cette configuration doit être effectuée sur le poste de développement. 

**Remarques** : 

- La configuration du type mime est automatique. 

- Ce type mime n'est pas encore configuré chez tous les hébergeurs. 

- Ce type mime n'est pas supporté par tous les navigateurs. 







### Technique de programmation
<a name="technique_programmation_ELTPARAGRAPHE000072"></a>Un site en cache peut être utilisé par exemple : 

- pour simuler une application iPhone (création d'une application Web qui fonctionne uniquement en mode hors connexion). 

- pour gérer un site qui perdrait la connexion Internet. 




Voici quelques conseils de programmation : 

- Le principe est d'utiliser majoritairement du code navigateur. En effet, hors connexion, seul ce code peut être exécuté. Il est cependant possible d'utiliser du code serveur via la fonction [AjaxExécute](../WDLang2/3055114.md) (qui permet d'exécuter du code serveur dans un traitement navigateur). 

- Les champs disponibles sont uniquement des champs navigateur. Seuls les champs liste, bouton, champ de saisie, libellé, image, lien, menu, interrupteur et sélecteur peuvent être utilisés dans des pages en mode déconnecté. 

- Les boutons et liens ne doivent pas être de type "Submit". Il est cependant possible d'utiliser l'action "Afficher la page XXX". 

- Si l'enregistrement de données est nécessaire en mode déconnecté, il est nécessaire d'utiliser une base de données locale. La norme HTML 5 permet aux sites Internet d'utiliser une base de données locale gérée par le navigateur. Pour plus de détails, consultez [SQL Base de données locale à un navigateur](../WDLang4/9000119.md). 

- Si le site doit pouvoir fonctionner en mode connecté et déconnecté, il est possible d'utiliser la fonction [NavigateurEstConnecté](../WDLang2/1000019392.md) en code navigateur pour savoir si un code serveur peut être ou non effectué. En cas de déconnexion, une procédure ou un traitement spécifique peut être lancé pour ne pas effectuer le code serveur. 

- Utilisez les traitements optionnels de la page "Passage en mode déconnecté", "Passage en mode connecté" et "A chaque changement d'état du cache HTML" pour réaliser les traitements nécessaires au changement d'état (récupération des données de la base de données locale par exemple). 







### Test du site
<a name="test_site_ELTPARAGRAPHE000099"></a>Pour tester un site en cache : 

1. Configurez si nécessaire le serveur du poste de développement. 

2. Lancez le test du site (Go du site). Toutes les pages nécessaires sont mises en cache. 

3. Utilisez l'option "Travailler hors connexion" du navigateur. 

4. Testez votre site. 









