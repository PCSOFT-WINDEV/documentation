


## Création d'une requête en code SQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000182"></a>
<a name="Requete_SQL"></a>
L'éditeur de requêtes permet de créer une requête en saisissant du code SQL (si vous maîtrisez ce langage).|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png)<br> | Important | [Le logiciel Etats & Requêtes](../Presentation/3088004.md) ne permet pas de créer des requêtes en code SQL utilisant les ordres [INSERT](../Editeurs/2034001.md), [UPDATE](../Editeurs/2034001.md) ou [DELETE](../Editeurs/2034001.md). |



Pour plus de détails sur le langage SQL, consultez les [Commandes SQL disponibles dans une requête SQL](../Editeurs/2034006.md).


<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000230"></a>


### Créer une requête en code SQL
<a name="creer_une_requete_code_sql_ELTPARAGRAPHE000039"></a>Pour créer une requête en code SQL : 

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif)
 parmi les boutons d'accès rapide. 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Requête".

	- L'assistant de création d'une requête se lance.




2. Choisissez de créer une requête en saisissant directement le code SQL (option "Code SQL").

3. Si votre projet n'est pas lié à une analyse, spécifiez l'analyse à laquelle la requête doit être rattachée.
	Validez l'écran de l'assistant.

4. Saisissez le nom de la requête (nom du fichier ".WDR" correspondant à la requête). Ce nom permettra d'identifier la requête dans vos programmes.

5. Spécifiez le libellé de la requête en décrivant succinctement le rôle de la requête. Ce libellé sera utilisé dans le dossier du projet.
	Remarque : Le nom de la requête se définit automatiquement à partir du libellé saisi.

6. Validez la création de la requête. Une fenêtre de code s'affiche.

7. Saisissez le code SQL de votre requête. Il est possible d'insérer dans la requête :

	- **des commentaires** en les faisant précéder des caractères "--" ou "//". Seuls les commentaires sur les conditions de sélection seront pris en compte lors de la rétro-analyse de la requête : les autres commentaires seront automatiquement supprimés. Les commentaires sur les conditions de sélection paramétrées ne seront pas proposés lors du GO de la requête.

	- **des fonctions WLangage**. Il suffit de préfixer les fonctions WLangage utilisées par les lettres "WL.". La saisie assistée est disponible. Les fonctions WLangage peuvent être imbriquées. Exemple : 
			
		```sql
		SELECT Client.NumClient FROM Client
		WHERE WL.Gauche(Client.CodePostal,2)=34
		```

			![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Il n'est pas possible d'exécuter des requêtes dont le code SQL contient des fonctions WLangage. 




8. Sauvegardez le code SQL (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_Enregistrer.gif)
).




Remarque : Un clic sur un identifiant (nom de fichier, de rubrique, de paramètre) dans le code SQL de la requête permet de mettre en évidence toutes les occurrences de cet identifiant. 
<a name="NOTE2_2"></a>


### Rétro-analyse de la requête en code SQL
<a name="retroanalyse_requete_code_sql_ELTPARAGRAPHE000079"></a>La rétro-analyse de la requête en code SQL permet de représenter graphiquement la requête à partir des fichiers de données présents dans le code SQL et dans l'analyse du projet.

Pour effectuer la rétro-analyse d'une requête en code SQL :

1. Affichez le code SQL de la requête.

2. Pour représenter graphiquement la requête, sous le volet "Requête", dans le groupe "Analyser", cliquez sur "Rétro-Analyse".




**Limites** :

- Cette fonctionnalité est disponible pour les requêtes de type SELECT, UPDATE, DELETE et INSERT.

- Les sous-requêtes ne sont pas importées.

- Les requêtes de requêtes ne sont pas gérées.  

- Les requêtes UNION ne sont pas gérées.

- Cette fonctionnalité est disponible uniquement si les commandes SQL utilisées dans la requête sont reconnues par le moteur HFSQL. Pour plus de détails, consultez les [Commandes SQL disponibles dans une requête SQL](../Editeurs/2034006.md).




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Modes d'exécution d'une requête en code SQL
<a name="modes_execution_une_requete_code_sql_ELTTEXTE000260"></a>
L'éditeur de requêtes permet d'exécuter simplement des requêtes en code SQL. Ces requêtes peuvent être :

- soit saisies directement sous l'éditeur de requêtes. La requête est alors exécutée avec la fonction [HExécuteRequête](../WDLang4/3044080.md).

- soit directement saisies dans la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md) dans l'éditeur de code.




**Deux modes d'exécution des requêtes SQL sont disponibles** :

- **Exécution d'une requête SQL avec vérification du code SQL** : Cette option est disponible par défaut pour toutes les requêtes SQL exécutées depuis WINDEV. Le code SQL de la requête doit utiliser uniquement les commandes listées ci-dessous. Dans ce cas, le moteur HFSQL effectue une vérification du code SQL de la requête.

- **Exécution d'une requête SQL sans vérification du code SQL** (utilisation de la constante *hRequêteSansCorrection*) : Cette option est conseillée pour les requêtes exécutées via un accès natif ou OLE DB. Dans ce cas, le moteur HFSQL n'effectue aucune vérification de la requête. Cette option doit être utilisée si la requête comporte des ordres spécifiques à un type de connexion (Oracle, SQL Server, ...). Toutes les commandes SQL supportées par la base de données accédée sont utilisables.




**Remarque** : La constante *hRequêteSansCorrection* est également disponible lors du test d'une requête depuis l'éditeur de requêtes :

- **pour une requête de sélection** : cliquez sur le bouton "Avancé" de la fenêtre de description et cochez l'option "Exécuter avec hRequêteSansCorrection en mode test" dans l'onglet "hRequêteSansCorrection".

- **pour une requête d'insertion, de modification ou de suppression** : affichez l'onglet "Général" de la fenêtre de description et cochez l'option "Exécuter avec hRequêteSansCorrection en mode test".





