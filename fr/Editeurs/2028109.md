


## Personnaliser le programme d'installation (Plug-in)
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000349"></a>
Dans un programme d'installation, il peut être nécessaire de personnaliser certaines actions, d'ajouter des plans dans l'assistant, d'ajouter de nouveaux traitements, ...

Jusqu'à la version 21, il était nécessaire de modifier le code source du programme d'installation en utilisant le projet "WDSetup" livré en standard. A chaque nouvelle version, un report des modifications dans la nouvelle version de WDSetup était nécessaire. Pour plus de détails, consultez [Modifier WDSetup pour gérer des langues supplémentaires](../Editeurs/2028037.md). 

En version 21, il devient possible de réaliser un plug-in et de modifier ainsi le programme d'installation standard. Ce plug-in est réalisé à partir de l'exemple didactique "WD Plugin WDSETUP" livré avec WINDEV. 

Vous pouvez ainsi continuer à bénéficier des évolutions de l'installation standard tout en effectuant des personnalisations. 

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000373"></a>


### Principe
<a name="principe_ELTPARAGRAPHE000027"></a>

1. [Ouvrez le projet "WD Plugin WDSETUP"](#NOTE2_2). 

2. [Modifiez le projet](#NOTE2_3). 

3. [Générez la bibliothèque](#NOTE2_4). 

4. [Modifiez le programme d'installation de votre application](#NOTE2_5). 




Remarque : Consultez [Interactions avec le plug-in selon les types d'installation](#NOTE3_1) pour connaître l'ordre de lancement des procédures en fonction du type d'installation. 
<a name="NOTE2_2"></a>


### 1. Ouverture du projet "WD Plugin WDSETUP"
<a name="1_ouverture_projet_plugin_wdsetup_ELTPARAGRAPHE000050"></a>

1. Ouvrez le projet "WD Plugin WDSETUP". Ce projet est disponible dans les exemples didactiques de WINDEV. 
	Remarque : Il est conseillé de faire une copie de cet exemple afin de le personnaliser sans risque d'écrasement lors de l'installation d'une nouvelle version. 

2. Ce projet exemple permet de réaliser un plugin exemple : l'association du type de fichier WDINFO à l'application. 

3. Ce projet contient : 

	- **Une fenêtre interne "FI_PLANINSTALLPERSO"**. Cette fenêtre interne correspond aux nouvelles informations affichée par le plug-in. Chaque plan de la fenêtre interne correspond à un nouveau plan de l'assistant. Pour visualiser les différents plans sous l'éditeur, utilisez les touches [Page précédente] et [Page suivante] du clavier. Ici, le premier plan correspond à l'exemple (association du type de fichier WDINFO à l'application). 

	- **Une collection de procédures "COL_PLUGINWDSETUP"**. Cette collection de procédures contient les procédures prototypes des procédures à modifier pour le plug-in. 

	- **Une collection de procédures "COL_SHELL_ASSOCIATION"**. Cette collection de procédures contient les procédures utilisées par l'exemple de plug-in fourni.  






<a name="NOTE2_3"></a>


### 2. Adaptation du projet "WD Plugin WDSETUP"
<a name="2_adaptation_projet_plugin_wdsetup_ELTPARAGRAPHE000071"></a>Pour réaliser un plug-in, le projet doit contenir : 

- La collection de procédures "COL_PLUGINWDSETUP". 

- Une fenêtre interne. 

- Une collection de procédures contenant les procédures du plug-in. 




**La collection de procédures "COL_PLUGINWDSETUP"**

La collection de procédures "COL_PLUGINWDSETUP" contient le prototype des fonctions qui vont être appelées par le programme d'installation principal. Le nom de ces fonctions ne doit pas être modifié.

Le code de ces fonctions doit être complété selon le traitement à ajouter dans le plugin.

Ces fonctions sont (par ordre alphabétique) : 

- **BeforeAutoModif** : Procédure appelée avant la modification automatique des données. 

- **AfterAutoModif** : Procédure appelée après la modification automatique des données.

- **BeforeInstall** : Procédure appelée au démarrage de l'installation.

- **AfterInstall** : Procédure appelée après l'installation.

- **Startup** : Procédure d'initialisation du plug-in, appelée au lancement de l'installation.

- **BeforeUpload** : Procédure appelée avant envoi par FTP (installation de référence HTTP). 

- **AfterUpload** : Procédure appelée après envoi par FTP (installation de référence HTTP).

- **sCustomPlane** : Procédure permettant de déclarer une fenêtre interne à afficher dans l'assistant d'installation.
	Cette procédure doit :

	- renvoyer une chaîne vide si il n'y a pas de fenêtre interne à afficher,

	- renvoyer le nom de la fenêtre interne à afficher lors de l'appel du plugin ("FI_PLANINSTALLPERSO" dans l'exemple). 







Pour connaître l'enchaînement de ces fonctions en fonction du type d'installation, consultez [Interactions avec le plug-in selon les types d'installation](#NOTE3_1). 



**La fenêtre interne**

Cette fenêtre interne contient les différentes étapes personnalisées de l'assistant d'installation. Chaque nouvelle étape correspond à un plan de la fenêtre interne. Les plans de cette fenêtre interne seront affichés dans l'assistant d'installation, avant le plan de terminaison de l'installation. 
Le nom de cette fenêtre interne n'a pas d'importance. Il doit être utilisé dans la procédure **sCustomPlane**. 
La fenêtre interne doit contenir :

- un ou plusieurs plans. Ces plans correspondent aux informations affichées par le plug-in. 

- 3 procédures locales. Ces procédures locales permettent de gérer l'initialisation des plans, faire des contrôles et indiquer l'enchaînement des plans. Les 3 procédures doivent respecter les prototypes suivants :  

	- **Init** : procédure permettant d'initialiser les champs contenus dans les différents plans. 

	- **bControl** : procédure permettant de valider ou non le passage au plan suivant (enchaînement de plans).

	- **nNextPlane** :  procédure permettant de donner le numéro du plan à afficher (par défaut plan 1).






<a name="NOTE2_4"></a>


### 3. Génération de la bibliothèque du projet "WD Plugin WDSETUP"
<a name="3_generation_bibliotheque_projet_plugin_wdsetup_ELTPARAGRAPHE000128"></a>Pour générer la bibliothèque du projet, sous le volet "Projet", dans le groupe "Génération", cliquez sur "Générer". L'assistant de création de la bibliothèque se lance. Suivez les différentes étapes de l'assistant. La bibliothèque est générée dans le répertoire Exe du projet. 
<a name="NOTE2_5"></a>


### 4. Modification du programme d'installation
<a name="4_modification_programme_installation_ELTPARAGRAPHE000147"></a>Pour intégrer le plug-in : 

1. Ouvrez le projet voulu sous WINDEV. 

2. Lancez l'assistant de création du programme d'installation : sous le volet "Projet", dans le groupe "Génération", déroulez "Procédure d'installation" et sélectionnez "Créer la procédure d'installation". 

3. Créez l'exécutable et suivez les différentes étapes de l'assistant. 

4. Dans l'étape "Support d'installation", cliquez sur le bouton "Options avancées de l'installeur". 

5. Dans la fenêtre qui s'affiche, affichez l'onglet "Plug-in" et sélectionnez le fichier correspondant à la bibliothèque du plug-in créée précédemment (fichier wdl). 

6. Terminez l'assistant de création du programme d'installation. 




Remarque : Il est également possible de définir les caractéristiques du plug-in dans l'éditeur d'installation WDInst (option "Paramètres de l'installation .. Options de l'installeur"). 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Interactions avec le plug-in selon les types d'installation
<a name="interactions_avec_plugin_selon_les_types_installation_ELTTEXTE000421"></a>
Ce paragraphe présente les différentes interactions entre l'installation et le plug-in. Les types d'installation présentés sont les suivants : 

- [Installation simple.](#NOTE3_2)

- [Installation avec mise à jour automatique en réseau local.](#NOTE3_3)

- [Installation avec mise à jour automatique par HTTP.](#NOTE3_4)

- [Installation avec mise à jour automatique à 2 niveaux (HTTP puis LAN).](#NOTE3_5)



<a name="NOTE3_2"></a>


### Installation simple
<a name="installation_simple_ELTPARAGRAPHE000191"></a>Les étapes de la création puis de l'installation d'une application avec installation simple sont les suivantes : 

- **Assistant de création de l'installation/WDInst**

	1. Choix des différentes options : répertoires, outils, modification automatique des données, ...

	2. Ajout possible d'un plug-in de personnalisation via une bibliothèque (.wdl) basé sur le projet "WD Plugin WDSETUP" (optionnel). 

	3. Génération de l'installation. 




- **Lancement de l'installation sur le poste utilisateur** 

	1. Si le plug-in est utilisé, appel de la méthode "Startup". 

	2. Affichage de la première étape de l'installation (premier plan). 

	3. Affichage des différentes étapes de l'installation (plans correspondant aux répertoires destination, ...). 

	4. Si le plug-in est utilisé, appel de la méthode "sCustomPlane". 
			Dans le cas de plans personnalisés, la fenêtre interne appelle les des procédures "Init", "bControl" et "nNextPlane".

	5. En cas de Synchronisation des Données Déployées (SDD/Modif auto) : 

		- Si le plug-in est utilisé, appel de la méthode "BeforeAutoModif". 

		- Lancement de la Synchronisation des Données Déployées (SDD/Modif auto). 

		- Si le plug-in est utilisé, appel de la méthode "AfterAutoModif". 




6. Si le plug-in est utilisé, appel de la méthode "BeforeInstall". 

7. Installation de la mise à jour de l'application

8. Si le plug-in est utilisé, appel de la méthode "AfterInstall". 

9. Mise à jour de la base du registre si nécessaire. 

10. Mise à jour du fichier ini si nécessaire. 

11. Lancement de l'exécutable en fin d'installation si cette option a été demandée. 



<a name="NOTE3_3"></a>


### Installation avec mise à jour automatique en réseau local
<a name="installation_avec_mise_jour_automatique_reseau_local_ELTPARAGRAPHE000223"></a>Les étapes de la création puis de l'installation d'une application avec mise à jour automatique en réseau local sont les suivantes : 

- **Assistant de création de l'installation/WDInst**

	1. Choix des différentes options : répertoires, outils, modification automatique des données, ...

	2. Ajout possible d'un plug-in de personnalisation via une bibliothèque (.wdl) basé sur le projet "WD Plugin WDSETUP" (optionnel). 

	3. Génération de l'installation.




- **Lancement de l'installation pour mettre à jour le serveur local de référence**

	1. Si le plug-in est utilisé, appel de la méthode "Startup". 

	2. Affichage de la première étape de l'installation (premier plan). 

	3. Affichage des différentes étapes de l'installation (plans correspondant aux répertoires destination, ...). 

	4. Si le plug-in est utilisé, appel de la méthode "sCustomPlane". 
			Dans le cas de plans personnalisés, la fenêtre interne appelle les procédures "Init", "bControl" et "nNextPlane".

	5. En cas de Synchronisation des Données Déployées (SDD/Modif auto) : 

		- Si le plug-in est utilisé, appel de la méthode "BeforeAutoModif". 

		- Lancement de la Synchronisation des Données Déployées (SDD/Modif auto). 

		- Si le plug-in est utilisé, appel de la méthode "AfterAutoModif". 




6. Si le plug-in est utilisé, appel de la méthode "BeforeInstall". 

7. Installation de la mise à jour de la version de référence.

8. Si le plug-in est utilisé, appel de la méthode "AfterInstall". 

9. Mise à jour de la base du registre si nécessaire. 

10. Mise à jour du fichier ini si nécessaire. 

- **Lancement de l'installation de référence sur le poste utilisateur** (ou push ou mise à jour de l'application) : voir ["Installation simple"](#NOTE3_2). 



<a name="NOTE3_4"></a>


### Installation avec mise à jour automatique par HTTP
<a name="installation_avec_mise_jour_automatique_par_http_ELTPARAGRAPHE000258"></a>Les étapes de la création puis de l'installation d'une application avec mise à jour automatique par HTTP sont les suivantes : 

- **Assistant de création de l'installation/WDInst**

	1. Choix des différentes options : répertoires, outils, modification automatique des données, ...

	2. Ajout possible d'un plug-in de personnalisation via une bibliothèque (.wdl) basé sur le projet "WD Plugin WDSETUP" (optionnel). 

	3. Génération de l'installation.




- **Lancement de l'installation pour mettre à jour le serveur HTTP de référence**

	1. Si le plug-in est utilisé, appel de la méthode "Startup". 

	2. Affichage de l'étape (plan) de mise à jour du serveur HTTP par FTP. 

	3. Upload de la mise à jour sur le serveur HTTP de référence. 

	4. Si le plug-in est utilisé, appel de la méthode "AfterInstall". 




- **Lancement de l'installation HTTP depuis le poste utilisateur** (ou mise à jour de l'application) : voir ["Installation simple"](#NOTE3_2). 



<a name="NOTE3_5"></a>


### Installation avec mise à jour automatique à 2 niveaux (HTTP puis LAN)
<a name="installation_avec_mise_jour_automatique_2_niveaux_http_puis_lan_ELTPARAGRAPHE000281"></a>Les étapes de la création puis de l'installation d'une application avec mise à jour automatique à 2 niveaux (HTTP puis LAN) sont les suivantes : 

- **Assistant de création de l'installation/WDInst**

	1. Choix des différentes options : répertoires, outils, modification automatique des données, ...

	2. Ajout possible d'un plug-in de personnalisation via une bibliothèque (.wdl) basé sur le projet "WD Plugin WDSETUP" (Optionnel). 

	3. Génération de l'installation.




- **Lancement de l'installation pour mettre à jour le serveur HTTP de référence**

	1. Si le plug-in est utilisé, appel de la méthode "Startup". 

	2. Affichage de l'étape (plan) de mise à jour du serveur HTTP par FTP. 

	3. Si le plug-in est utilisé, appel de la méthode "BeforeInstall". 

	4. Si le plug-in est utilisé, appel de la méthode "BeforeUpload". 

	5. Upload de la mise à jour sur le serveur HTTP de référence. 

	6. Si le plug-in est utilisé, appel de la méthode "AfterUpload". 

	7. Si le plug-in est utilisé, appel de la méthode "AfterInstall". 




- **Lancement de l'installation HTTP depuis un serveur de référence local** (ou mise à jour automatique par la tâche planifiée s'il est déjà installé) : voir ["Installation avec mise à jour automatique en réseau local"](#NOTE3_3). 





