


## Groupware utilisateur et LDAP
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000194"></a>
LDAP est un protocole de plus en plus utilisé dans les entreprises. LDAP est un protocole permettant l'interrogation et la modification de services d'annuaires. Active Directory de Microsoft par exemple fournit les services d'accès LDAP à ses données.

Dans une entreprise, un utilisateur d'ordinateur se voit en général affecter par le responsable "système" un compte et un mot de passe pour accéder à sa machine.

Ce compte et ce mot de passe peuvent directement être utilisés par le groupware utilisateur de WINDEV et WEBDEV, avec la possibilité de définir des droits spécifiques.

**Remarque** : Le groupware utilisateur fonctionne avec Active Directory. Il ne fonctionne pas avec openLDAP.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000218"></a>


### Branchement du groupware utilisateur sur un annuaire LDAP sans gestion de droits
<a name="branchement_groupware_utilisateur_sur_annuaire_ldap_sans_gestion_droits_ELTPARAGRAPHE000024"></a>Pour brancher le groupware utilisateur sur un annuaire LDAP sans gestion de droits :

1. Sous le volet "Projet", dans le groupe "Projet", cliquez sur "Groupware Utilisateur". 

2. Activez le groupware utilisateur. 

3. Dans l'onglet "Fichiers" : 

	- Sélectionnez l'option "Identification à partir d'un annuaire LDAP ou Active Directory". Cliquez sur le lien "Cliquez ici pour saisir les paramètres du serveur" et indiquez les caractéristiques de l'annuaire LDAP. 

	- Cochez l'option "Fenêtre de login uniquement (pas de gestion des droits)". Dans ce cas, le groupware utilisateur ne crée pas de fichiers de données. Il ne sera pas possible à un superviseur de définir les droits sur les fenêtres et sur les pages.







Au lancement de l'application, la fenêtre ou page de login demande à l'utilisateur de s'identifier. Si l'utilisateur est enregistré dans l'annuaire LDAP, l'application se lancera, sinon elle se fermera.
<a name="NOTE2_2"></a>


### Branchement du groupware utilisateur sur un annuaire LDAP avec gestion de droits
<a name="branchement_groupware_utilisateur_sur_annuaire_ldap_avec_gestion_droits_ELTPARAGRAPHE000052"></a>Pour brancher le groupware utilisateur sur un annuaire LDAP avec gestion de droits :

1. Sous le volet "Projet", dans le groupe "Projet", cliquez sur "Groupware Utilisateur". 

2. Activez le groupware utilisateur. 

3. Dans l'onglet "Fichiers" :

	- Sélectionnez l'option "Identification à partir d'un annuaire LDAP ou Active Directory". Cliquez sur le lien "Cliquez ici pour saisir les paramètres du serveur" et indiquez les caractéristiques de l'annuaire LDAP. 

	- Décochez si nécessaire l'option "Fenêtre de login uniquement (pas de gestion des droits)". Dans ce cas, le groupware utilisateur crée des fichiers de données pour la gestion des utilisateurs et des droits. Il est possible à un superviseur de définir les droits sur les fenêtres et sur les pages.







**Cas 1 : La base de données du groupware utilisateur est vide. La base LDAP existe**
Lors de la mise en place de l'application, une configuration supplémentaire doit être réalisée :

1. Se connecter à l'application en tant que Superviseur.

2. Choisir "Configurer le groupware".

3. Dans la fenêtre d'administration du groupware, dans l'onglet "Utilisateurs et groupes", cliquez sur le bouton "Import LDAP". Ce bouton est situé sous la liste des utilisateurs. 

4. Une fenêtre s'affiche permettant de réaliser l'importation de tous les utilisateurs.<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=gpu_ldap.gif)
Si vous n'êtes pas authentifié sur le serveur LDAP (1ère utilisation par exemple), un login et un mot de passe d'un utilisateur LDAP vont vous être demandés. Il est nécessaire que l'utilisateur LDAP choisi ait les droits nécessaires pour lister les utilisateurs de l'annuaire LDAP.
	**Attention** : en fonction des stratégies LDAP définies dans Active Directory, l'importation peut être limitée à 1 000 utilisateurs. Dans ce cas, pour supprimer cette limitation, il faut intervenir sur le paramètre LDAP MaxPageSize. Pour plus de détails, consultez [https://support.microsoft.com/kb/315071](https://support.microsoft.com/kb/315071). 

5. Cliquez sur le bouton "Importer". L'importation est réalisée, tous les utilisateurs LDAP apparaissent dans la liste des utilisateurs.
	Remarque : Il est conseillé de donner les droits du superviseur à un utilisateur spécifique et de supprimer l'utilisateur "Superviseur" existant par défaut.

6. Il est possible d'affecter des droits aux différents utilisateurs importés.




**Cas 2 : La base de données du groupware utilisateur existe déjà. L'application se connecte à une base LDAP**
Seuls les utilisateurs présents dans la base du groupware utilisateur et dans la base LDAP pourront se connecter à l'application (mêmes logins des utilisateurs). Le mot de passe à utiliser est le mot de passe LDAP. Les utilisateurs qui ne sont pas présents dans la base LDAP ne pourront pas lancer l'application.

Les droits pourront être gérés sur les utilisateurs présents à la fois dans la base du groupware et dans la base LDAP.

**Note : L'utilisation d'un annuaire LDAP avec gestion des droits permet de passer simplement du mode LDAP au mode sans LDAP. Il suffit de cocher l'option "Utiliser un annuaire LDAP"**.
<a name="NOTE2_3"></a>


### Lancement de l'application
<a name="lancement_application_ELTPARAGRAPHE000106"></a>**En mode lancement automatique** : 
Les caractéristiques du serveur LDAP doivent être saisies dans l'onglet "Fichiers" de la fenêtre de paramétrage du groupware utilisateur.

Pour connaître le nom de l'utilisateur, il suffit d'utiliser la fonction [gpwRécupInfoUtilisateur](../WDLang6/3041004.md) :

```wl
Info("Bonjour " + gpwRecupInfoUtilisateur(gpwInfoLogin))
```


**En mode lancement manuel** : 
Pour utiliser l'annuaire LDAP, il est nécessaire d'ouvrir une session LDAP grâce à la fonction [gpwOuvreSessionLDAP](../WDLang6/1000017055.md) avant d'utiliser la fonction [gpwOuvre](../WDLang6/3041002.md) :

```wl
gpwOuvreSessionLDAP("xx.monentreprise.com", 389, 3, Faux)
gpwOuvre()
```
Pour identifier un utilisateur sans ouvrir de fenêtre de login, le code suivant peut être utilisé :

```wl
gpwOuvreSessionLDAP("xx.monentreprise.com", 389, 3, Faux)
SI gpwLogin("FP", "MotPasse") <> gpwOk ALORS
	Erreur("Utilisateur ou mot de passe incorrect")
	FinProgramme()
FIN
```

<a name="NOTE2_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png) 

### Installation de l'application utilisant un annuaire LDAP
<a name="installation_application_utilisant_annuaire_ldap_ELTPARAGRAPHE000136"></a>Les paramètres de l'annuaire LDAP peuvent être saisis lors de l'installation de l'application, par l'utilisateur.

**Lors de la création de l'installation de l'application** utilisant le groupware utilisateur, cochez l'option "Personnaliser le chemin des fichiers du groupware lors de l'installation" dans l'étape "Paramètres des bases de données".

**Lors de l'installation de l'application**, un écran spécifique au groupware utilisateur s'affichera. Cet écran permettra à la personne installant l'application :

- de configurer l'emplacement des fichiers de données du groupware utilisateur.

- d'activer l'historique des connexions.

- d'activer l'authentification des utilisateurs par un annuaire LDAP. Dans ce cas, il sera nécessaire de saisir l'adresse du serveur, le numéro de port et la version de LDAP utilisée.







