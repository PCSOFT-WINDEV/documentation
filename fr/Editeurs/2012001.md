


## Créer un assemblage .NET depuis WINDEV
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000232"></a>
Avant de créer un assemblage .NET, il est nécessaire de vérifier la [configuration du poste de développement](../Editeurs/2012006.md).

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer un assemblage .NET à partir d'un projet WINDEV
<a name="creer_assemblage_net_partir_projet_windev_ELTTEXTE000256"></a>
Pour créer un assemblage .NET :

1. Ouvrez le projet WINDEV à partir duquel l'assemblage .NET doit être créé.
	Ce projet doit contenir tous les éléments nécessaires à l'assemblage .NET. Ce projet peut par exemple contenir une ou plusieurs procédures globales ou/et classes, contenant diverses méthodes. Ces méthodes et / ou procédures seront les points d'entrées de l'assemblage.
	**Remarque** : Lorsque vous créez des assemblages .NET destinés à être utilisés sous d'autres environnements, il est conseillé de les documenter. Cette documentation est automatiquement générée par WINDEV.

2. Créez si nécessaire une configuration de projet de type "Assemblage .NET" : sous le volet "Projet", dans le groupe "Configuration de projet", déroulez "Nouvelle configuration" et sélectionnez "DLL d'assemblage .NET". Dans l'assistant, spécifiez :

	- le nom et la description de la configuration de projet. 

	- les éléments intégrés dans la configuration de projet. 

	- Validez. La configuration de projet est créée avec les éléments nécessaires. 




3. Parmi les boutons d'accès rapide, cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Cr%E9er_un_Assemblage%20-%20HC%20N%B0001%201.gif)
 pour générer l'assemblage ".NET". L'assistant de création d'un assemblage .NET se lance.

4. Indiquez les propriétés de l'assemblage .NET que vous allez créer : nom du ficher, société, description, copyright, etc. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Cr%E9er_un_Assemblage%20-%20HC%20N%B0002.gif)

	Le bouton "Avancé" reprend les propriétés indiquées et permet de définir des propriétés supplémentaires spécifiques à l'assemblage .NET.

5. Indiquez le numéro de version. Deux formats de numéro de version sont disponibles :

	- **Format standard.** Ce format est le format standard géré par Windows. Ce format correspond à un ensemble de 4 nombres séparés par des points. 

		- Le premier groupe de 4 chiffres correspond au nombre de changements majeurs effectués dans l'application.

		- Le second groupe de 4 chiffres correspond au nombre de changements mineurs effectués dans l'application.

		- Le troisième groupe de 4 chiffres correspond au numéro de génération. 
						Il est conseillé d'incrémenter automatiquement ce numéro à chaque génération. Cette incrémentation est réalisée automatiquement si l'option "Incrémentation automatique de la version à chaque génération" est cochée.

		- Le dernier groupe de 4 chiffres correspond au nombre de révisions (branches dans le GDS par exemple).
						




- **Format pour compatibilité.** Ce format était utilisé jusqu'à la version 12 par défaut pour les applications WINDEV.
			**Remarque** : Tous les caractères (chiffre et lettre) sont autorisés. Par exemple : "1.01A".
			Si l'option "Incrémentation automatique de la version à chaque génération" est cochée, le numéro de version sera modifié à chaque génération : le numéro de version "1.01A" deviendra "1.01B" et le numéro de version "A14Z" deviendra "A15A".

6. Sélectionnez les différents éléments WINDEV (projet, fenêtres, classes, ...) à intégrer dans l'assemblage .NET.

	- Le bouton "Ajouter" permet d'ajouter un élément à l'assemblage .NET : images, fichiers texte, ...

	- Le bouton "Enlever" permet de supprimer un élément de l'assemblage .NET. Les fichiers correspondants et leurs dépendances ne seront pas intégrés dans l'assemblage .NET.

	- Le bouton "WDU" permet d'afficher les éléments présents dans une bibliothèque précédemment créée.
			**Remarque** : Si le projet WINDEV (fichier ".WDP") est sélectionné :

		- l'analyse du projet sera associée à l'assemblage .NET.

		- l'événement "Initialisation du projet" sera exécuté à l'initialisation de l'assemblage .NET.

		- l'événement "Fermeture du projet" sera exécuté à la fermeture de l'assemblage .NET.




7. Sélectionnez les classes (fichiers ".WDC") et les collections de procédures (fichiers ".WDG") WINDEV à rendre accessibles. Ces classes et ces collections de procédures pourront être manipulées depuis l'application qui utilisera l'assemblage .NET.
	Une classe publique de l'assemblage doit posséder un constructeur sans paramètre (ou avoir tous ses paramètres optionnels).
	Toutes les classes qui sont instanciées dans une classe publique de l'assemblage doivent aussi être publiques.
	**Remarque** : Une classe .NET est générée avec le nom de la collection de procédures. Cette classe .NET contient :

	- une fonction statique correspondant à chaque fonction de la collection de procédures.

	- un membre statique correspondant à chaque variable de la collection de procédures WINDEV.




8. Sélectionnez : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Cr%E9er_un_Assemblage%20-%20HC%20N%B0003.gif)


	- la version du Framework .NET ciblé.

- le Framework WINDEV (32 bits ou 64 bits) à livrer avec l'assemblage .NET. 

9. Sélectionnez ensuite les librairies du Framework WINDEV nécessaires au fonctionnement de votre assemblage. 
	Remarques :

	- Les librairies du Framework WINDEV correspondant à .NET (par exemple wd280netx.dll) ne peuvent pas être renommées.

	- Si le même projet doit permettre de générer plusieurs versions du même assemblage, il est nécessaire d'utiliser des configurations de projet.

	- Si un assemblage .NET doit fonctionner en 32 bits et en 64 bits, il est nécessaire de générer 2 assemblages .NET en WINDEV. Le même assemblage ne peut pas fonctionner en 32 bits et en 64 bits.




10. Paramétrez si nécessaire le message d'erreur. Ce message sera affiché en cas d'erreur lors de l'utilisation de l'assemblage .NET. 
	Le bouton "Défaut" permet de paramétrer un message d'erreur par défaut.

11. Sélectionnez les options spécifiques de l'assemblage :

	- Le bouton **"Options de compilation"** permet de sélectionner un compilateur C# spécifique et d'indiquer des options de compilations supplémentaires.

	- Le bouton **"Propriétés avancées"** permet de définir si l'assemblage .NET doit être accessible par un programme utilisant la technologie COM. Pour plus de détails, consultez [Créer un assemblage .NET accessible par COM](../Editeurs/2012003.md).




12. Validez.




L'assemblage .Net est généré dans le répertoire EXE du projet ainsi qu'un document XML contenant la documentation de l'assemblage.

**Remarques** : 

- Les assemblages générés avec WINDEV s'utilisent comme n'importe quel autre assemblage .NET. Cependant, le framework WINDEV doit se trouver dans le même répertoire que l'assemblage.

- Limitation : Les états et les requêtes ne fonctionnent pas dans les assemblages .NET.

- Les assemblages .Net générés avec WINDEV ont un seul contexte d'exécution : ils ne peuvent donc être exécutés que par un seul thread. 




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Génération des classes C# à partir de classes WINDEV
<a name="generation_des_classes_partir_classes_windev_ELTTEXTE000280"></a>


### Conseils pour optimiser le code des classes
<a name="conseils_pour_optimiser_code_des_classes_ELTPARAGRAPHE000130"></a>Voici quelques conseils pour optimiser le code des classes générées. Dans vos classes WINDEV :

- Typez les paramètres des méthodes et les valeurs de retour.

- Utilisez le mot-clé "LOCAL" afin que les paramètres des méthodes ne soient pas de type "Entrée / Sortie".

- Remplacez les mots réservés du C#.

- Eliminez les héritages multiples.



<a name="NOTE4_2"></a>


### Types des paramètres et des valeurs de retour
<a name="types_des_parametres_des_valeurs_retour_ELTPARAGRAPHE000142"></a>Les types disponibles sont ceux du WLangage.

Si les types des paramètres ne sont pas spécifiés dans le prototype de la méthode, ils sont déterminés automatiquement par WINDEV. Dans ce cas, le générateur d'assemblage .NET utilise le type "Object".
<a name="NOTE4_3"></a>


### Paramètres en "Entrée / Sortie"
<a name="parametres_entree_sortie_ELTPARAGRAPHE000151"></a>Si le mot-clé LOCAL n'est pas utilisé dans la déclaration du paramètre dans le prototype de la fonction, le paramètre est considéré en "Entrée / Sortie" (Le générateur d'assemblage utilise le mot-clé "ref").
<a name="NOTE4_4"></a>


### Conséquence : un code d'utilisation de l'assemblage plus simple
<a name="consequence_code_utilisation_assemblage_plus_simple_ELTPARAGRAPHE000158"></a>Lors de l'exportation d'une classe WLangage classique, tous les paramètres sont non typés et en Entrée / Sortie.

**Si les optimisations décrites ci-dessus ne sont pas réalisées, le générateur d'assemblage génère des fonctions prenant des paramètres du type "ref object", ce qui rend plus complexe l'écriture du programme utilisant l'assemblage.**

En effet, pour passer un paramètre de type "ref object" à une fonction (par exemple en C#), il faut :

1. Créer un "Object".

2. Recopier dans cet "object" la variable type du C#.

3. Passer par référence un "Object" en paramètre à la méthode de la classe WLangage.




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Créer le programme d'installation d'un assemblage .NET
<a name="creer_programme_installation_assemblage_net_ELTTEXTE000322"></a>
La création du programme d'installation d'un assemblage .NET est identique à la création du programme d'installation d'une application WINDEV classique.

Pour créer le programme d'installation d'un assemblage .NET : 

1. Parmi les boutons d'accès rapide, sélectionnez le mode de génération "Créer la procédure d'installation de l'assemblage".
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Cr%E9er_un_Assemblage%20-%20HC%20N%B0001.gif)


2. Suivez les instructions des différentes étapes de l'assistant.




**Remarque** : Les assemblages générés avec WINDEV s'utilisent comme n'importe quel autre assemblage .NET. Cependant, le framework WINDEV doit se trouver dans le même répertoire que l'assemblage.


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDUtilisationdeDOTNET.gif) ***Exemples didactiques (WINDEV)*** : **WD Utilisation de DOTNET** <br>Cet exemple permet de convertir des devises dans d'autres devises.<br>La base de ce projet (la classe cEuro) est utilisée pour créer un assemblage DOTNET<br>WD Utilisation de DOTNET est présenté :<br>1/ Sous forme d'un projet WINDEV et d'un assemblage (le tout fonctionne sans DOTNET, en mode test)<br>2/ Sous forme d'un projet DOTNET écrit en C# et d'un exécutable DOTNET<br>Résumé de l'exemple livré avec WINDEV  :	<br>Il est désormais possible dans WINDEV d'utiliser des asssemblages DOTNET et inversement, il est également possible de générer des assemblages DOTNET depuis WINDEV !


