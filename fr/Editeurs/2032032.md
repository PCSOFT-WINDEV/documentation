


## Utilisation d'une requête paramétrée 
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000203"></a>
Une requête paramétrée peut être utilisée :

- Comme source de données d'un champ (Table, Liste, Combo, Zone répétée, ...).

- Comme source de données d'un état.

- Par programmation.




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Utilisation d'une requête paramétrée dans un champ Table, Zone répétée, Liste ou Combo
<a name="utilisation_une_requete_parametree_dans_champ_table_zone_repetee_liste_combo_ELTTEXTE000227"></a>
Lorsqu'un champ Table fichier est lié à une requête paramétrée (intégrée ou non), il est nécessaire de passer des paramètres à la requête avant de l'exécuter.

Si ces paramètres ne sont pas spécifiés avant la première exécution de la requête, la requête ne sera pas exécutée et le champ Table restera vide.

Pour passer les paramètres à la requête, il est possible d'utiliser :

- soit la notation suivante :
	
	```txt
	<Nom Requête>.<Nom Paramètre1> = xxx 
	<Nom Requête>.<Nom Paramètre2> = xxx 
	<Nom Requête>.<Nom Paramètre3> = xxx 
	HExécuteRequête(<Nom Requête>)
	```

	Dans ce cas, la requête est automatiquement exécutée lors de l'initialisation du champ Table.

- soit la fonction [HExécuteRequête](../WDLang4/3044080.md) en spécifiant les paramètres dans la fonction.




Cas particulier : il est possible d'initialiser les paramètres de la requête directement dans le code d'initialisation du champ. Dans ce cas, il n'est pas nécessaire d'utiliser la fonction HExécuteRequête pour calculer le résultat de la requête. La syntaxe est alors la suivante : 

```txt
MaSource.<Nom Paramètre1> = xxx 
MaSource.<Nom Paramètre2> = xxx 
MaSource.<Nom Paramètre3> = xxx
```




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Utilisation d'une requête paramétrée dans un état
<a name="utilisation_une_requete_parametree_dans_etat_ELTTEXTE000251"></a>


### Principe
<a name="principe_ELTPARAGRAPHE000057"></a><a name="Req_Param_Etat"></a>
Pour utiliser un état basé sur une requête paramétrée, il est nécessaire d'exécuter la requête avant d'ouvrir l'état. La requête peut être exécutée avec la fonction [iInitRequêteEtat](../WDLang5/3046021.md). Cette fonction permet d'exécuter la requête et d'indiquer les paramètres de cette requête. Cette fonction peut être appelée :

- soit dans le code d'initialisation de l'état,

- soit avant la fonction [iImprimeEtat](../WDLang5/3046032.md).



<a name="NOTE3_2"></a>


### Exemple
<a name="exemple_ELTPARAGRAPHE000074"></a>La fenêtre *FEN_ClientFiche* permet de parcourir les caractéristiques des clients. Pour chaque client, l'utilisateur peut cliquer sur le bouton *BTN_ImprimeCommande* pour imprimer l'état *ETAT_EtatCdeClient*. Cet état est associé à la requête *REQ_CdeClient* qui sélectionne les commandes passées par un client donné.

Le code suivant permet d'exécuter la requête *REQ_CdeClient* selon le client en cours et d'imprimer l'état :

```wl
// -- Traitement de clic du bouton BTN_ImprimeCommande
// Exécution de la requête selon le client en cours
iInitRequêteEtat(ETAT_EtatCdeClient, NumClient)
// Impression de l'état
iImprimeEtat(ETAT_EtatCdeClient)
```


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Utilisation d'une requête paramétrée par programmation
<a name="utilisation_une_requete_parametree_par_programmation_ELTTEXTE000281"></a>


### Principe
<a name="principe_ELTPARAGRAPHE000086"></a>Lors de l'exécution de la requête paramétrée par programmation, les paramètres peuvent être passés :

- soit directement dans la fonction WLangage [HExécuteRequête](../WDLang4/3044080.md).

- soit en utilisant la notation *&lt;Nom de la requête&gt;.&lt;Nom du paramètre&gt;*, puis en utilisant la fonction [HExécuteRequête](../WDLang4/3044080.md).




Pour plus de détails sur le passage de paramètres à la requête, consultez [Deux méthodes pour passer des paramètres à une requête](../Editeurs/2032050.md).
<a name="NOTE4_2"></a>


### Exemple
<a name="exemple_ELTPARAGRAPHE000107"></a>Pour afficher la liste des commandes de l'année 2018 :

```wl
// Exécution de la requête
HExécuteRequête(REQ_ParamCommande, hRequêteDefaut, 2018)
// Code similaire : 
// REQ_ParamCommande.Année = 2018
// HExécuteRequête(REQ_ParamCommande, hRequêteDefaut)
```


<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Astuce
<a name="astuce_ELTTEXTE000311"></a>
Lorsqu'un paramètre de requête est initialisé avec la valeur NULL, la condition associée à ce paramètre est ignorée lors de l'exécution de la requête. 

A savoir : Si la valeur du paramètre provient d'un champ de saisie, l'option "***NULL si vide***" (onglet "Détail" de la description du champ) permet d'affecter directement la valeur NULL si le champ n'est pas renseigné.
<a name="NOTE5_2"></a>


### Exemple
<a name="exemple_ELTPARAGRAPHE000124"></a>Le code SQL exécuté est :

```sql
SELECT NomDesRubriques
FROM NomDesFichiers
WHERE Rubrique = {Param1}
```
Pour cet exemple, le tableau ci-dessous décrit l'utilisation de l'option "NULL si vide" :

| Valeur saisie par l'utilisateur | Option "NULL si vide" | Code SQL exécuté |
| --- | --- | --- |
| Aucune valeur | Option cochée |   SELECT NomDesRubriques <br>FROM NomDesFichiers  <br> |
| Aucune valeur | Option décochée |   SELECT NomDesRubriques <br> FROM NomDesFichiers <br>WHERE Rubrique = ' '  <br> |
| Une valeur est saisie | Option cochée ou décochée |   SELECT NomDesRubriques <br>FROM NomDesFichiers<br> WHERE Rubrique = 'ValeurSaisie'  <br> |




