


## Découpage code Métier / UI
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000219"></a>
Lors du développement d'une application, les codes correspondant à des codes spécifiques à l'interface (UI) et ceux correspondant à des codes spécifiques au code métier (accès aux bases de données, etc.) sont souvent "mélangés". Qui n'a jamais utilisé le traitement de clic d'un bouton pour enregistrer des données dans un fichier de données et pour mettre à jour la fenêtre en cours ? 

WINDEV, WEBDEV et WINDEV Mobile proposent de vous aider à réaliser le découpage de votre code pour séparer les codes métier des codes UI. 

Ce découpage a plusieurs avantages : 

- structurer votre code, 

- simplifier la réutilisation et le partage de code, 

- simplifier la webisation de vos applications, 

- ...




La mise en place de ce découpage peut également vous permettre d'utiliser par la suite une méthode de développement de type MV ou MVP. 

WINDEV, WEBDEV et WINDEV Mobile proposent de mettre en place ce découpage progressivement : vous pouvez mettre en place ce découpage uniquement sur vos nouvelles fenêtres pour commencer, puis traiter votre projet, fenêtre par fenêtre. 

Vous pouvez également faire ce découpage uniquement afin de structurer le code de votre application ou choisir de générer les classes (ou collections de procédures) nécessaires à la réutilisation et au partage de votre code. 

WINDEV, WEBDEV et WINDEV Mobile vous donnent des outils et vous décidez de leur utilisation. 

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000243"></a>


### Découper un code existant
<a name="decouper_code_existant_ELTPARAGRAPHE000035"></a>Pour effectuer un découpage de code UI/code Métier d'un code existant, les étapes sont les suivantes : 

1. Ouvrez le projet à manipuler dans le produit voulu. 

2. Affichez l'éditeur de code (F2 sur un bouton par exemple). 

3. Activez la coloration des codes UI et métier : sous l'éditeur de code, sous le volet "Refactoring", dans le groupe "Métier/UI", déroulez "Afficher le code Métier/UI" et sélectionnez le mode de coloration voulu : 

	- Aucune coloration, 

	- Coloration en fond de ligne : dans ce cas, la coloration est effectuée sur toute la ligne de code. 

	- Coloration dans la marge : dans ce cas, la coloration est effectuée uniquement dans la marge des lignes de code. 


 Remarques : 

- La coloration est effectuée pour tous les projets. 

- La coloration utilise la norme suivante (thème clair) : 

	- Les lignes de code manipulant l'UI dans un traitement UI sont identifiées par la couleur verte. 

	- Les lignes de code manipulant un code métier dans un traitement UI sont identifiées par la couleur orange.

	- Les lignes de code manipulant l'UI dans un traitement métier sont identifiées par la couleur orange.

	- Les lignes de code manipulant un code métier dans un traitement métier sont identifiées par la couleur bleue. 

4. Activez les erreurs de mélange de code : sous l'éditeur de code, sous le volet "Refactoring", dans le groupe "Métier/UI" et cliquez sur "Activer les erreurs de mélange". Ce bouton active les erreurs de mélange uniquement pour l'élément en cours (fenêtre, page, ...). 
	Les erreurs de mélange sont affichées dans le volet "Erreurs de compilation", parmi les erreurs de normes de programmation (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Compilation_Norme%20-%20HC%20N%B0002.gif)). 

5. Découpez le code pour ne plus avoir d'erreurs de mélange. 

	- Créez si nécessaire des procédures locales (ou globales) pour séparer le code métier et le code UI.

	- Utilisez si nécessaire les attributs &lt;UI&gt; et &lt;Métier&gt;. Ces attributs permettent dans un code ou un traitement contenant à la fois du code UI et du code Métier d'indiquer l'utilisation de la variable ou de la procédure. 
			Exemple : La procédure **AfficheVoyage** est considérée comme une procédure manipulant l'UI (attribut &lt;UI&gt;) même si elle appelle une procédure métier **RécupèreVoyage**. <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Decoupage%20code%20ihm%20-%20HC%20N%B0002.gif&type=thumb)
Remarque : Les appels de procédure métier dans un traitement UI sont entourés d'un cadre bleu. 








### Extraire le code métier
<a name="extraire_code_metier_ELTPARAGRAPHE000105"></a>Lorsque toutes les erreurs de mélange de code sont corrigées sur le projet, il est possible de créer automatiquement les classes ou les procédures globales regroupant toutes les procédures locales créées pour séparer le code UI et le code Métier. 

Cette manipulation est utile et conseillée : 

- Si votre projet est partagé, 

- Si votre projet doit être webisé, 

- ...




Pour extraire le code Métier : 

1. Dans l'éditeur de code, sous le volet "Refactoring", dans le groupe "Métier/UI", cliquez sur "Extraire le code Métier". 

2. Dans la fenêtre qui s'affiche : 

	- Sélectionnez le type de découpage voulu : classe ou collection de procédures. 

	- Indiquez le nom de la classe ou de la collection de procédure. 




3. Validez. 

4. L'élément spécifié est automatiquement créé et le code est modifié pour utiliser la collection de procédures ou la classe créée. 




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Options liées à la séparation Code UI / Code Métier
<a name="options_liees_separation_code_code_metier_ELTTEXTE000273"></a>


### Description du projet
<a name="description_projet_ELTPARAGRAPHE000142"></a>L'option "Signaler les mélanges de code métier et de code UI" de la fenêtre de description du projet (onglet "Compilation") permet d'activer ou non les erreurs de mélange de code sur tous les éléments du projet. 

Remarque : Il est conseillé d'utiliser cette option sur les éléments du projet avant de l'utiliser sur le projet dans son intégralité. 


### Description d'une fenêtre
<a name="description_une_fenetre_ELTPARAGRAPHE000153"></a>Dans la fenêtre de description d'une fenêtre, l'onglet "Détail" permet de définir la norme de programmation via le bouton "Norme de programmation". 

Dans la fenêtre de définition de la norme de programmation, il est possible de demander à signaler pour la fenêtre en cours les erreurs de mélange de code.  


### Description d'une page
<a name="description_une_page_ELTPARAGRAPHE000164"></a>Dans la fenêtre de description d'une page, l'onglet "Détail" permet de définir la norme de programmation via le bouton "Norme de programmation". 

Dans la fenêtre de définition de la norme de programmation, il est possible de demander à signaler pour la page en cours les erreurs de mélange de code.  


