
## Transactions en SQL
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000137"></a>
A partir de la version 21, il est possible de gérer des transactions en code SQL. 

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Débuter une transaction
<a name="debuter_une_transaction_ELTTEXTE000161"></a>
**Pour débuter une transaction**, les syntaxes SQL suivantes sont utilisables : 

- BEGIN

- BEGIN WORK

- BEGIN TRANSACTION

- START TRANSACTION

- START TRANSACTION ISOLATION &lt;Niveau&gt;. Le paramètre &lt;Niveau&gt; peut correspondre à : 

	- READ UNCOMMITTED

	- READ COMMITTED

	- REPEATABLE READ

	- SERIALIZABLE


 En l'absence de niveau d'isolation fixé dans la commande SQL, le niveau d'isolation utilisé pour la transaction est celui actuellement défini.




**Pour définir le niveau d'isolation**, il est également possible d'utiliser la syntaxe : 
SET ISOLATION &lt;Niveau&gt;
Le paramètre &lt;Niveau&gt; peut correspondre à : 

- READ UNCOMMITTED

- READ COMMITTED

- REPEATABLE READ

- SERIALIZABLE




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Valider une transaction
<a name="valider_une_transaction_ELTTEXTE000185"></a>
Pour valider une transaction, les syntaxes SQL suivantes sont utilisables : 

- COMMIT

- COMMIT WORK

- COMMIT TRANSACTION




Les syntaxes permettant d'enchaîner une nouvelle transaction sont également disponibles : 

- COMMIT AND CHAIN

- COMMIT WORK AND CHAIN

- COMMIT TRANSACTION AND CHAIN




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Annuler une transaction
<a name="annuler_une_transaction_ELTTEXTE000209"></a>
Pour annuler une transaction, les syntaxes SQL suivantes sont utilisables : 

- ROLLBACK

- ROLLBACK WORK

- ROLLBACK TRANSACTION




Les syntaxes permettant d'enchaîner une nouvelle transaction sont également disponibles : 

- ROLLBACK AND CHAIN

- ROLLBACK WORK AND CHAIN

- ROLLBACK TRANSACTION AND CHAIN




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Reprendre une transaction
<a name="reprendre_une_transaction_ELTTEXTE000233"></a>
Pour définir et et nommer un point de sauvegarde dans la transaction en cours, la syntaxe SQL suivante est utilisable : SAVEPOINT nomDuSavePoint

Pour annuler les opérations effectuées durant la transaction jusqu'au point de sauvegarde, la syntaxe SQL suivante est utilisable : ROLLBACK TO SAVEPOINT nomDuSavePoint

<a name="NOTE6"></a>
<a name="NOTE6_1"></a>


## Exemple
<a name="exemple_ELTTEXTE000257"></a>

```wl
soit sdrTransactionStart est une Requête SQL = 
[
START TRANSACTION
]

soit sdrSavePoint est une Requête SQL = 
[
	SAVEPOINT monPoint
]

soit sdr est une Requête SQL = 
[
 	INSERT INTO client
 	VALUES (3, 20), (4,22)
]

soit sdrRollbackSavePoint est une Requête SQL = 
[
	ROLLBACK TO SAVEPOINT monPoint
]

soit sdrTransactionFin est une Requête SQL = 
[
COMMIT TRANSACTION
]

SI PAS HExécuteRequête(sdrTransactionStart) ALORS
	Trace(HErreurInfo())
FIN

sdrSavePoint est une Source de Données

SI PAS HExécuteRequêteSQL(sdrSavePoint, "SAVEPOINT monPoint") ALORS
	Trace(HErreurInfo())
FIN

SI PAS HExécuteRequête(sdr) ALORS
	Trace(HErreurInfo())
FIN

sdrRollbackSavePoint est une Source de Données
SI PAS HExécuteRequêteSQL(sdrRollbackSavePoint, "ROLLBACK TO SAVEPOINT monPoint") ALORS
	Trace(HErreurInfo())
FIN

soit sdr2 est une Requête SQL = 
[
 	INSERT INTO client
 	VALUES (10, 120), (11,122)
]

SI PAS HExécuteRequête(sdr2) ALORS
	Trace(HErreurInfo())
FIN

SI PAS HExécuteRequête(sdrTransactionFin) ALORS
	Trace(HErreurInfo())
FIN
```





