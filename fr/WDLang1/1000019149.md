


## Description d'API (Type de variable)

***En anglais : API description***
				



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Une variable de type **Description d'API** permet de décrire par programmation une API, ses paramètres, sa valeur de retour et ses options d'appel. 

Les caractéristiques de ce type peuvent être définies et modifiées à l'aide de différentes propriétés WLangage. 

**Remarque** : Pour plus de détails sur la déclaration de ce type de variable et l'utilisation des propriétés WLangage, consultez [Déclaration d'une variable](../Motscles/1514032.md).
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
GetModuleHandle est une Description d'API
GetModuleHandle.NomDLL = "kernel32"
GetModuleHandle.NomFonction = "GetModuleHandleA"
GetModuleHandle.TypeRetour = apiEntierSystème
GetModuleHandle.Paramètre[1].Type = apiChaîneAnsi
```



```wl
// Appel d'une DLL fictive de calcul de distance entre deux points à la surface de la Terre
CalculeDistance est une Description d'API
CalculeDistance.NomDLL = "GEO.DLL"
CalculeDistance.NomFonction = "CalculeDistance"
CalculeDistance.Paramètre[1].Type = apiRéel_8
CalculeDistance.Paramètre[2].Type = apiRéel_8
CalculeDistance.Paramètre[3].Type = apiRéel_8
CalculeDistance.Paramètre[4].Type = apiRéel_8
CalculeDistance.TypeRetour = apiRéel_8

distance est un réel = CalculeDistance(Latitude1, Longitude1, Latitude2, Longitude2)
```

<a name="NOTE0"></a>

## Remarques
<a name="NOTE0_1"></a>


### Utilisation des variables de type Description d'API
<a name="utilisation_des_variables_type_description_api_ELTPARAGRAPHE000032"></a>Les variables de type **Description d'API** peuvent être utilisées : 

- directement, en spécifiant les valeurs des différents paramètres si nécessaire. Par exemple : 
	
	```wl
	GetModuleHandle est une Description d'API
	GetModuleHandle.NomDLL = "kernel32"
	GetModuleHandle.NomFonction = "GetModuleHandleA"
	GetModuleHandle.TypeRetour = apiEntierSystème
	GetModuleHandle.Paramètre[1].Type = apiChaîneAnsi
	
	// Utilisation directe
	GetModuleHandle(Null)
	```


- avec la fonction [API](../WDLang1/3014005.md). Par exemple : 
	
	```wl
	GetModuleHandle est une Description d'API
	GetModuleHandle.NomDLL = "kernel32"
	GetModuleHandle.NomFonction = "GetModuleHandleA"
	GetModuleHandle.TypeRetour = apiEntierSystème
	GetModuleHandle.Paramètre[1].Type = apiChaîneAnsi
	
	// Utilisation de la fonction API
	API(GetModuleHandle, Null)
	```




<a name="NOTE0_2"></a>


### Propriétés spécifiques à la description des variables de type Description d'API
<a name="proprietes_specifiques_description_des_variables_type_description_api_ELTPARAGRAPHE000049"></a>Les propriétés suivantes peuvent être utilisées pour manipuler une Description d'API :

| **Nom de la propriété** | **Type manipulé** | **Effet** |
| --- | --- | --- |
| Adresse | Entier système | Adresse de la fonction. <br><br>Si cette propriété est renseignée, la propriété **NomFonction** contient l'adresse de la fonction, la propriété **Numéro** vaut -1 et la propriété **NomDLL** vaut "" (chaîne vide). |
| ConventionAppel | Constante de type Entier | Méthode d'appel de la DLL. Trois conventions d'appel sont disponibles grâce aux constantes suivantes : <br><br>- *CDECL*<br><br>- *STDCALL*<br><br>- *THISCALL*<br><br><br> |
| NomDLL | Chaîne de caractères | Nom de la DLL. |
| NomFonction | Chaîne de caractères | Nom de la fonction présente dans la DLL. <br><br>Si cette propriété est renseignée, il est nécessaire de renseigner également la propriété **NomDLL**. Dans ce cas, la propriété **Numéro** vaut -1 et la propriété **Adresse** vaut 0. |
| Numéro | Entier | Numéro de la fonction.<br><br>Si cette propriété est renseignée, il est nécessaire de renseigner également la propriété **NomDLL**. Dans ce cas, la propriété **NomFonction** contient le numéro et la propriété **Adresse** est remise à 0. |
| Option | Constante de type Entier | Options d'appel de l'API. Cette propriété peut correspondre à une des constantes suivantes : <br><br>- *apiBloqueThreads* : Si cette constante est utilisée, l'appel de l'API bloque tous les threads en cours. Cela permet de protéger la DLL externe des appels multi-threads. <br><br>- *apiDéchargeDLL* : Si la DLL a été chargée pour appeler l'API, elle sera déchargée. Si la DLL était déjà chargée lors de l'appel de l'API, cette constante est ignorée. <br><br>- *apiRestaureParamètresSystème* : Si cette constante est utilisée, les paramètres système sont restaurés après l'appel de l'API. En effet, certaines API modifient les paramètres système. <br><br><br>Les options par défaut sont *apiRestaureParamètreSystème* + *apiDéchargeDLL*. |
| Paramètre | Tableau | La propriété **Type** de chaque élément du tableau permet d'indiquer le type de chaque paramètre de l'API. Cette propriété peut correspondre à : <br><br>- un nom de structure sous forme de chaîne si le paramètre est une structure passée en paramètre par valeur, <br><br>- une des constantes suivantes : <br><br>	- *apiBooléen* : le paramètre est un booléen. <br><br>	- *apiBuffer* : le paramètre est un buffer. <br><br>	- *apiCaractère* : le paramètre est un caractère Ansi si le projet est en mode Ansi, le paramètre est un caractère Unicode si le projet est en mode Unicode. <br><br>	- *apiCaractèreAnsi* : le paramètre est un caractère Ansi.<br><br>	- *apiCaractèreUnicode* : le paramètre est un caractère Unicode<br><br>	- *apiChaîne* : le paramètre est une chaîne de caractères Ansi si le projet est en mode Ansi, le paramètre est une chaîne de caractères Unicode si le projet est en mode Unicode. <br><br>	- *apiChaîneAnsi* : le paramètre est une chaîne de caractères Ansi.<br><br>	- *apiChaîneUnicode* : le paramètre est une chaîne de caractères Unicode.<br><br>	- *apiEntier_1* : le paramètre est un entier sur 1. <br><br>	- *apiEntier_2* : le paramètre est un entier sur 2. <br><br>	- *apiEntier_4* : le paramètre est un entier sur 4. <br><br>	- *apiEntier_8* : le paramètre est un entier sur 8. <br><br>	- *apiEntierSansSigne_1* : le paramètre est un entier sans signe sur 1. <br><br>	- *apiEntierSansSigne_2* : le paramètre est un entier sans signe sur 2. <br><br>	- *apiEntierSansSigne_4* : le paramètre est un entier sans signe sur 4. <br><br>	- *apiEntierSansSigne_8* : le paramètre est un entier sans signe sur 8. <br><br>	- *apiEntierSystème* : le paramètre est un entier système. <br><br>	- *apiRéel_4* : le paramètre est un réel sur 4. <br><br>	- *apiRéel_8* : le paramètre est un réel sur 8.<br><br><br><br><br><br> |
| TypeRetour | Entier ou chaîne | Type retourné par l'API. Cette propriété correspond à : <br><br>- *apiBooléen* : l'API renvoie un booléen. <br><br>- *apiBuffer* : l'API renvoie un buffer. <br><br>- *apiCaractère* : l'API renvoie un caractère Ansi si le projet est en mode Ansi, un caractère Unicode si le projet est en mode Unicode. <br><br>- *apiCaractèreAnsi* : l'API renvoie un caractère Ansi. <br><br>- *apiCaractèreUnicode* : l'API renvoie un caractère Unicode. <br><br>- *apiChaîne* : l'API renvoie une chaîne de caractères Ansi si le projet est en mode Ansi, une chaîne de caractères Unicode si le projet est en mode Unicode. <br><br>- *apiChaîneAnsi* : l'API renvoie une chaîne de caractères Ansi.<br><br>- *apiChaîneUnicode* : l'API renvoie une chaîne de caractères Unicode.<br><br>	- *apiEntier_1* : l'API renvoie un entier sur 1. <br><br>	- *apiEntier_2* : l'API renvoie un entier sur 2. <br><br>	- *apiEntier_4* : l'API renvoie un entier sur 4. <br><br>	- *apiEntier_8* : l'API renvoie un entier sur 8. <br><br>	- *apiEntierSansSigne_1* : l'API renvoie un entier sans signe sur 1. <br><br>	- *apiEntierSansSigne_2* : l'API renvoie un entier sans signe sur 2. <br><br>	- *apiEntierSansSigne_4* : l'API renvoie un entier sans signe sur 4. <br><br>	- *apiEntierSansSigne_8* : l'API renvoie un entier sans signe sur 8. \* *apiEntierSystème* : l'API renvoie un entier système. <br><br><br><br><br>- *apiRéel_4* : l'API renvoie un réel sur 4. <br><br>- *apiRéel_8* : l'API renvoie un réel sur 8.<br><br><br> |


<a name="NOTE0_3"></a>


### Cas particuliers
<a name="cas_particuliers_ELTPARAGRAPHE000211"></a>

- Il est nécessaire de déclarer une variable de type **Description d'API** par fonction utilisée. 

- La DLL est chargée une seule fois, et non pas pour chaque variable. 



<a name="NOTE0_4"></a>


### Fonctions utilisant les variables de type Description d'API
<a name="fonctions_utilisant_les_variables_type_description_api_ELTPARAGRAPHE000219"></a>Les fonctions suivantes peuvent être utilisées pour manipuler une variable de type **Description d'API** :



|   |   |
| --- | --- |
| [API](../WDLang1/3014005.md) | Exécute une fonction présente dans une DLL externe. |
| [AppelDLL32](../WDLang1/3014003.md) | Exécute une fonction présente dans une DLL externe. |






