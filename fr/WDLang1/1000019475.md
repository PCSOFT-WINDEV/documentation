
## Gérer les mutex dans les threads
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000178"></a>
Les mutex permettent de limiter l'exécution simultanée d'un code (procédure, ligne de code, ...) à un thread à un instant donné. Un mutex peut être partagé par plusieurs applications. 

**Remarque** : D'autres systèmes permettent également de protéger une partie de code : 

- les **sémaphores** permettent de limiter l'exécution simultanée d'un code (procédure, ligne de code, ...) **à un ou plusieurs threads** à un instant donné. Un sémaphore peut être partagé par plusieurs applications. 

- les sections critiques permettent de limiter l'exécution simultanée d'un code (procédure, ligne de code, ...) **à un thread** à un instant donné dans une seule application.






<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Principe
<a name="principe_ELTTEXTE000202"></a>
Le mutex a été créé avec la fonction [MutexCrée](../WDLang1/1000019022.md).

1. Le thread n°1 exécute la fonction [MutexDébut](../WDLang1/1000019023.md) : aucun thread n'est actuellement présent dans le mutex.

2. Le thread n°1 exécute la partie de code protégée par le mutex.

3. Pendant que le thread n°1 exécute le code protégé par le mutex, un thread n°2 exécute la fonction [MutexDébut](../WDLang1/1000019023.md) : le code protégé par le mutex étant déjà en cours d'exécution par le thread n°1, le thread n°2 attend le déblocage du mutex.

4. Le thread n°1 exécute la fonction [MutexFin](../WDLang1/1000019024.md) : plus aucun thread n'exécute le code du mutex.

5. Le thread n°2 peut exécuter le code protégé par le mutex.

6. Le thread n°2 exécute la fonction [MutexFin](../WDLang1/1000019024.md) : plus aucun thread n'exécute le code du mutex.




![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Mutex.gif)




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Comment mettre en place un mutex ?
<a name="comment_mettre_place_mutex_ELTTEXTE000226"></a>


### Les étapes :
<a name="les_etapes_ELTPARAGRAPHE000074"></a>Les différentes étapes de la mise en place d'un mutex sont les suivantes :

1. Création d'un mutex avec la fonction [MutexCrée](../WDLang1/1000019022.md). Le mutex est associé à un nom.

2. Appel de la fonction [MutexDébut](../WDLang1/1000019023.md) avant la portion de code à protéger.

3. Appel de la fonction [MutexFin](../WDLang1/1000019024.md) pour délimiter la portion de code à protéger. Les lignes de code situées après la fonction [MutexFin](../WDLang1/1000019024.md) ne seront plus protégées.

4. Destruction du mutex avec la fonction [MutexDétruit](../WDLang1/1000019025.md).





<a name="NOTE3_2"></a>


### Remarques
<a name="remarques_ELTPARAGRAPHE000102"></a>

- Les parties de code protégées par un mutex doivent être les plus courtes possibles et concerner uniquement des traitements "critiques".

- Lorsqu'un thread est en attente, les ressources du processeur ne sont pas utilisées.

- Les mutex s'appliquent aussi bien au thread principal qu'aux threads secondaires (créés avec la fonction [ThreadExécute](../WDLang1/3077024.md)). Il est nécessaire d'éviter le blocage du thread principal. En effet, si le thread principal est bloqué (en attente), l'application ne peut plus s'exécuter.

- Les fonctions [MutexDébut](../WDLang1/1000019023.md) et [MutexFin](../WDLang1/1000019024.md) doivent être utilisées dans le même traitement (par exemple dans une procédure).

- Les mutex peuvent être partagés ou non entre les différentes applications exécutées sur le poste. Il suffit d'indiquer le mode de partage des mutex lors de leur création (fonction [MutexCrée](../WDLang1/1000019022.md)).



<a name="NOTE3_3"></a>


### Les fonctions de gestion des mutex
<a name="les_fonctions_gestion_des_mutex_ELTPARAGRAPHE000125"></a>Les fonctions du WLangage spécifiques à la gestion des mutex sont les suivantes :



|   |   |
| --- | --- |
| [MutexCrée](../WDLang1/1000019022.md) | Crée explicitement un mutex. |
| [MutexDébut](../WDLang1/1000019023.md) | Bloque le thread courant en attendant que le mutex soit libre. |
| [MutexDétruit](../WDLang1/1000019025.md) | Détruit explicitement un mutex. |
| [MutexFin](../WDLang1/1000019024.md) | Signale que le thread libère le mutex. |












