
## Ouverture d'une fenêtre à partir d'un thread secondaire
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000130"></a>
Un thread secondaire ne peut pas ouvrir directement une fenêtre avec les fonctions classiques du WLangage telles que : [Ouvre](../WDLang1/3038035.md), [Utilise](../WDLang1/3038044.md), ...

Or il peut être utile d'afficher une fenêtre à partir d'un thread secondaire. Par exemple, si un thread est utilisé pour gérer la réception des appels téléphonique, lorsqu'un appel entrant est détecté ce thread peut afficher une fenêtre avec les caractéristiques de l'appelant.

La solution consiste à faire ouvrir la fenêtre à partir d'un code exécuté par le thread principal. 

Pour lancer depuis un thread secondaire l'exécution d'un code par le thread principal, les méthodes suivantes sont disponibles :

- Exécuter une procédure globale du projet ou une procédure locale d'une fenêtre via la fonction [ExécuteThreadPrincipal](../WDLang1/1000019862.md),

- Exécuter l'événement "Demande de mise à jour de l'affichage" d'une fenêtre via la fonction [DemandeMiseAJourIHM](../WDLang1/1000021378.md),

- Instaurer un dialogue par messages entre les threads (fonctions [PostMessage](../WDLang1/3015001.md) et [Evénement](../Proprietes/1000017990.md)). 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Ouverture d'une fenêtre depuis un thread secondaire via un dialogue par messages
<a name="ouverture_une_fenetre_depuis_thread_secondaire_via_dialogue_par_messages_ELTTEXTE000154"></a>


### Principe
<a name="principe_ELTPARAGRAPHE000046"></a>Pour ouvrir une fenêtre à partir d'un thread secondaire :

1. Lorsque le thread secondaire veut ouvrir une fenêtre, il envoie un message au thread principal grâce à la fonction [PostMessage](../WDLang1/3015001.md). Ce message indique au thread principal la fenêtre à ouvrir et les paramètres nécessaires à l'ouverture de la fenêtre.

2. Le thread principal gère un événement spécifique, correspondant à la demande d'ouverture de fenêtre. Lorsque cet événement survient, la procédure WLangage lancée ouvre la fenêtre spécifiée (avec la fonction [Ouvre](../WDLang1/3038035.md) par exemple) avec si nécessaire les paramètres indiqués.






<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Exemple
<a name="exemple_ELTTEXTE000178"></a>


### La méthode décrite ci-dessus est utilisée dans l'exemple WD Messagerie instantanée.
<a name="methode_decrite_cidessus_est_utilisee_dans_exemple_messagerie_instantanee_ELTPARAGRAPHE000065"></a>Le code d'ouverture de la fenêtre principale permet de :

- mettre en place un événement pour gérer l'ouverture de la fenêtre dans le thread principal.

- déclencher les threads secondaires.





```wl
// Mise en place d'un événement 
// pour gérer l'ouverture de la fenêtre de "chat"
gnIdEvenement = Evénement("OuvertureChat", "*.*", "DebutChat")
SI gnIdEvenement = 0 ALORS
	// Erreur lors de la mise en place 
	// de l'événement de gestion de la fenêtre de "chat"
	Erreur("Impossible de gérer la fenêtre d'ouverture de chat", ErreurInfo())
	// L'application ne peut pas fonctionner sans cet événement
	FinProgramme()
FIN

// Ecoute des requêtes de connexion et de tests de présence
ThreadExécute("ThreadPresence", threadNormal, "EcouteDemandePresence")
ThreadExécute("ThreadRequete", threadNormal, "EcouteDemandeConnexion")
```


L'ouverture de la fenêtre est réalisée par exemple dans le code de la procédure ***EcouteRequeteDebutMessage***. Cette procédure est exécutée dans un thread. Le code utilisé pour ouvrir la fenêtre depuis le thread est le suivant :


```wl
// Demande d'ouverture de la fenêtre de "chat" 
PostMessage(Handle(FEN_Principale),"DebutChat", FIC_CONTACT.IDCONTACT, FIC_CONTACT.IDCONTACT)
```


Le message "DébutChat" est envoyé à la fenêtre principale (identifiée par son Handle). Ce message contient les différents paramètres à passer à la fenêtre. Le message est traité par l'événement défini dans le code d'ouverture de la fenêtre. Lorsque le message survient, la procédure "OuvertureChat" est automatiquement exécutée. C'est cette procédure qui ouvre la fenêtre.

Le code de cette procédure est le suivant : 


```wl
PROCEDURE OuvertureChat(nParam,nContact)
OuvreSoeur(FEN_Message, nContact)
```





