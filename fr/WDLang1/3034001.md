
## Mécanisme des exceptions générales
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000242"></a>
Un traitement d'exception général est disponible pour l'ensemble des composants de l'objet auquel il est associé. Ce traitement d'exception sera utilisable tant que l'objet est disponible.

Un traitement d'exception général peut être déclaré dans n'importe quel traitement. Après l'exécution d'un traitement d'exception, le code WLangage suivant le traitement est exécuté.

Quelques exemples :

- Si le traitement d'exception est déclaré dans le code d'initialisation du projet, il est valide pour toute erreur se produisant dans le projet.

- Si le traitement d'exception est déclaré dans le code de déclaration des globales d'une fenêtre, d'une page (ou d'un état), il est valide pour toute erreur survenant dans la fenêtre, la page, un champ de la fenêtre, de la page ou une procédure locale à la fenêtre, ou à la page. Ce traitement d'exception n'est plus valide à la fermeture de la fenêtre ou de la page.

- Si le traitement d'exception est déclaré dans un traitement quelconque, il est valide pour toute erreur se produisant dans ce traitement. Ce traitement d'exception ne sera plus valide une fois le traitement terminé. Ainsi, un traitement d'exception déclaré dans un code de clic d'un bouton ne sera valide que dans ce traitement et dans toutes les procédures appelées à partir de ce traitement.




![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Attention : Le mécanisme des exceptions générales n'est pas disponible. Seules les exceptions spécifiques (QUAND EXCEPTION DANS) sont disponibles. Pour plus de détails, consultez [Gestion des exceptions spécifiques](../WDLang1/3034003.md).

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Déclaration de plusieurs traitements d'exceptions générales
<a name="declaration_plusieurs_traitements_exceptions_generales_ELTTEXTE000266"></a>


### Déclaration des traitements d'exceptions générales dans un même traitement
<a name="declaration_des_traitements_exceptions_generales_dans_meme_traitement_ELTPARAGRAPHE000033"></a>Le second traitement d'exception remplacera le premier traitement d'exception à partir de la déclaration du second traitement d'exception.

**Exemple** : Dans la procédure Exemple, si une erreur survient :

- Dans le &lt;Code1&gt; : aucune gestion des exceptions n'est active sauf si une procédure d'exception a été définie dans le code appelant (dans la fenêtre en cours ou dans la page en cours ou dans le projet).

- Dans le &lt;Code 2&gt; : le traitement des exceptions actif est &lt;Traitement Exception 1&gt;.

- Dans le &lt;Code 3&gt; : le traitement des exceptions actif est &lt;Traitement Exception 2&gt;.





```txt
PROCEDURE Exemple()
<"Code 1">
QUAND EXCEPTION
	<Traitement exception 1>
FIN
<"Code 2">
QUAND EXCEPTION
	<Traitement exception 2>
FIN
<"Code 3">
```



<a name="NOTE2_2"></a>


### Déclaration de traitements d'exception dans des traitements différents
<a name="declaration_traitements_exception_dans_des_traitements_differents_ELTPARAGRAPHE000049"></a>Si des traitements d'exception sont déclarés dans des objets imbriqués (par exemple projet et fenêtre, projet et page, fenêtre et champ ou page et champ), le traitement d'exception du plus petit objet masque le traitement d'exception principal pendant la durée de vie de cet objet.

**Exemple** : Si les deux traitements d'exception suivants sont déclarés :

- traitement d'exception A déclaré dans le code d'initialisation d'un projet,

- traitement d'exception B déclaré dans le code de déclaration des globales d'une fenêtre ou d'une page.




Pour toutes les erreurs rencontrées dans la fenêtre ou dans la page, le traitement d'exception B sera utilisé et masquera le traitement d'exception A.


<a name="NOTE2_3"></a>


### Imbrication de traitements d'exception dans des traitements différents : gérer l'exception par un niveau supérieur
<a name="imbrication_traitements_exception_dans_des_traitements_differents_gerer_exception_par_niveau_superieur_ELTPARAGRAPHE000064"></a>Si des traitements d'exception sont déclarés dans des objets imbriqués (par exemple projet et fenêtre, projet et page, fenêtre et champ ou page et champ), il est possible de gérer l'erreur dans le traitement d'exception du niveau supérieur.

Il suffit d'utiliser le mot-clé EXCEPTION dans le traitement d'exception.

Exemple :


```wl
// Code d'initialisation du projet
QUAND EXCEPTION
	// On arrête l'application
	FinProgramme()
FIN
```



```wl
// Procédure globale ValeurChamp
// Renvoie la valeur du champ ou "" si le champ n'existe pas
PROCEDURE ValeurChamp(NomChamp)
QUAND EXCEPTION
	// Pour l'erreur de code ChampInconnu, on renvoie ""
	SI ExceptionInfo(errCODE) = ChampInconnu ALORS RENVOYER ""
	// Pour une autre erreur, on appelle le gestionnaire d'erreur du projet
	EXCEPTION
FIN
```




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Remarques générales
<a name="remarques_generales_ELTTEXTE000302"></a>


### Un traitement d'exception ne peut être utilisé qu'une seule fois
<a name="traitement_exception_peut_etre_utilise_quune_seule_fois_ELTPARAGRAPHE000082"></a>Un traitement d'exception ne peut être utilisé qu'une seule fois. Si une seconde exception survient, le traitement d'exception ne sera pas exécuté. Si un traitement d'exception d'un niveau supérieur existe, ce traitement d'exception sera exécuté.

Pour réactiver un traitement d'exception après utilisation, utilisez la fonction [ExceptionActive](../WDLang1/3034002.md). **Attention** : cette fonction doit être manipulée avec précaution.

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Par exemple** : Un traitement d'exception générale a été déclaré au niveau de la fenêtre et au niveau du projet. 
Une première erreur de programmation survient dans la fenêtre. Cette erreur est traitée par le traitement d'exception de la fenêtre. 
Une seconde erreur survient dans la fenêtre. Cette erreur est traitée par le traitement d'exception du projet.




<a name="NOTE3_2"></a>


### Qualité du code WLangage du traitement de l'exception
<a name="qualite_code_wlangage_traitement_exception_ELTPARAGRAPHE000111"></a>Il n'est pas possible de déclarer un traitement d'exception à l'intérieur d'un traitement WLangage d'exception. Il est recommandé de veiller à la qualité du code dans les traitements d'exception car toute erreur provoquera l'affichage de la fenêtre / page standard du mécanisme de sécurité du WLangage.


<a name="NOTE3_3"></a>


### Qualité du code suivant un traitement d'exception
<a name="qualite_code_suivant_traitement_exception_ELTPARAGRAPHE000119"></a>Après l'exécution d'un traitement d'exception, le code WLangage suivant le traitement est exécuté. Il est recommandé de veiller à la qualité de ce code (pour éviter l'affichage d'un message d'erreur).

**Exemple** : Dans le code suivant, la ligne {"Champ1"}..Valeur = 5 déclenche le traitement d'exception. A la fin du traitement d'exception, la même ligne de code est ré-exécutée : l'exception a déjà été traitée et le mécanisme de sécurité du WLangage est déclenché.


```wl
// Traitement d'exception
QUAND EXCEPTION
	// Traitement à effectuer en cas d'exception
	Trace("Erreur")
FIN
// Erreur de programmation : le champ Champ1 n'existe pas
{"Champ1"}..Valeur = 5
```


**Pour éviter ce problème, il est conseillé en fin du traitement d'exception** :

- Soit de s'assurer que le problème est corrigé et ne se reproduira plus.

- Soit d'utiliser les mots-clé RETOUR et RENVOYER pour sortir du traitement en cours.

- Soit d'utiliser la fonction [DonneFocusEtRetourUtilisateur](../WDLang1/1410088107.md) pour rendre la main à l'utilisateur. 
	

- Soit d'utiliser la fonction [FinProgramme](../WDLang1/3013033.md) pour fermer l'application.








<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Cas particulier
<a name="cas_particulier_ELTTEXTE000338"></a>
Un traitement d'exception générale ne peut pas être déclaré dans les instructions composées de type :

- POUR

- BOUCLE

- TANTQUE




Dans ce type d'instruction, utilisez le [traitement d'exception spécifique](../WDLang1/3034003.md).


<a name="NOTE4_2"></a>


### Traitement d'exception et composant
<a name="traitement_exception_composant_ELTPARAGRAPHE000166"></a>Si un traitement d'exception général est effectué à la fois dans le code d'initialisation du composant et dans le code d'initialisation du projet intégrant le composant, lorsqu'une erreur apparaîtra dans un des éléments du composant, ce sera le traitement d'exception du projet qui sera effectué.
<a name="NOTE4_3"></a>


### Traitement d'exception et threads
<a name="traitement_exception_threads_ELTPARAGRAPHE000173"></a>Si un traitement d'exception général est effectué dans le code d'initialisation du projet, il sera déclenché si une exception survient :

- dans le thread principal,

- dans un thread secondaire lancé par la fonction [ThreadExécute](../WDLang1/3077024.md).


Cependant, si le thread secondaire déclenche une exception, il ne sera pas possible de connaître son origine avec la fonction [ExceptionInfo](../WDLang1/3034006.md) dans le code du projet. Pour connaître l'origine d'une exception dans un thread secondaire, il faut inclure le traitement de l'exception dans le thread secondaire.

<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Fonctions de gestion des exceptions générales
<a name="fonctions_gestion_des_exceptions_generales_ELTTEXTE000374"></a>
Des fonctions spécifiques à la gestion des exceptions peuvent être utilisées avec les traitements d'exceptions générales :



|   |   |
| --- | --- |
| [ExceptionActive](../WDLang1/3034002.md) | Ré-active le traitement d'exception en cours si l'exception a pu être corrigée. |
| [ExceptionAffiche](../WDLang1/1000019408.md) | Affiche la fenêtre standard des exceptions avec le contenu de l'exception courante. |
| [ExceptionDéclenche](../WDLang1/3034005.md) | Déclenche artificiellement le mécanisme de sécurité de WLangage en provoquant une exception. |
| [ExceptionInfo](../WDLang1/3034006.md) | Récupère des informations sur l'exception en cours. |
| [ExceptionPropage](../WDLang1/3034014.md) | Propage une exception. |
| [ExceptionRestaureParamètre](../WDLang1/3034008.md) | Rétablit le traitement d'exception d'un traitement. |








