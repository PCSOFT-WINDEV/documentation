


## Structure TâchePlanifiée
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000317"></a>
La structure **TâchePlanifiée** permet de définir les caractéristiques d'une tâche planifiée. Les variables de cette structure sont ré-initialisées grâce à la fonction [PlanificateurRAZ](../WDLang1/3089012.md).

**Remarque** : Lors de la création d'une nouvelle tâche, la structure **TâchePlanifiée** est utilisée ainsi que la structure [HoraireTâchePlanifiée](../WDLang1/3089002.md).



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Structure TâchePlanifiée
<a name="structure_tacheplanifiee_ELTTEXTE000341"></a>
Les différentes variables de la structure **TâchePlanifiée** sont les suivantes :


|   |   |
| --- | --- |
| TâchePlanifiée.Application | Chaîne de caractères.<br><br>Nom et chemin du programme à lancer. |
| TâchePlanifiée.ArrêtSurActivité | Booléen.<br><br><u><u><u><u>Vrai</u></u></u></u> si la tâche doit être arrêtée dès que le système reprend une activité. <br>Par défaut, cette variable est à <u><u><u><u>Faux</u></u></u></u>. |
| TâchePlanifiée.ArrêtSurBatteries | Booléen.<br><br><u><u><u><u>Vrai</u></u></u></u> si le système doit terminer la tâche quand l'ordinateur passe à une alimentation sur batteries. <br>Par défaut, cette variable est à <u><u><u><u>Vrai</u></u></u></u>. |
| TâchePlanifiée.CodeErreur | Entier.<br><br>Dernier code d'erreur renvoyé par la tâche (0 si la tâche a été correctement exécutée, ou si le programme n'a jamais été lancé). <br>Cette variable est en lecture seule et elle est mise à jour grâce à la fonction [PlanificateurPropriétésTâche](../WDLang1/3089011.md). |
| TâchePlanifiée.Commentaire | Chaîne de caractères.<br><br>Commentaire associé à la tâche. Ce commentaire sera visible dans les propriétés de la tâche. Ce commentaire peut être multilingue. |
| TâchePlanifiée.DélaiAttenteInactivité | Entier en minutes. <br><br>Délai pendant lequel le système attendra une inactivité avant de lancer la tâche. <br>Si la variable TâchePlanifiée.DélaiInactivité est différente de 0, cette variable permet de dire au bout de combien de temps le système doit abandonner l'exécution d'une tâche, s'il n'a jamais été actif assez longtemps. <br>Par défaut, cette variable vaut 60 minutes. |
| TâchePlanifiée.DélaiInactivité | Entier en minutes.<br><br>Délai d'inactivité du système après lequel la tâche peut être effectuée. Permet d'exécuter une tâche uniquement si le système est inactif. <br>Exemple : Exécution d'un antivirus à 13H tous les jours, uniquement si le système est inactif depuis 30 minutes. <br>Par défaut, cette variable a pour valeur 0 (délai immédiat). |
| TâchePlanifiée.DernièreExécution | DateHeure.<br><br>Date de la dernière exécution de la tâche. <br>Cette variable est en lecture seule et elle est mise à jour grâce à la fonction [PlanificateurPropriétésTâche](../WDLang1/3089011.md). |
| TâchePlanifiée.DuréeMaximum | Durée.<br><br>Durée maximum de la tâche. Au-delà de cette durée, la tâche sera terminée de force par le système. <br>Si cette variable vaut 0, la tâche s'exécutera aussi longtemps que nécessaire. <br>Par défaut, la valeur de cette variable est 72 heures.<br><br>Remarque : Cette variable peut correspondre à : <br><br>- un entier correspondant au nombre de centièmes de seconde, <br><br>- une variable de type Durée, <br><br>- l'indication directe de la durée (par exemple 1 h). <br><br><br> |
| TâchePlanifiée.Eveil | Booléen.<br><br>- <u><u><u><u>Vrai</u></u></u></u> si l'ordinateur doit être mis en éveil pour exécuter cette tâche (le système ne doit pas être en veille),<br><br>- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire.<br><br><br>Par défaut, la valeur de cette variable est <u><u><u><u>Faux</u></u></u></u>. |
| TâchePlanifiée.ExécuteSiSessionOuverte | Booléen.<br><br>- <u><u><u><u>Vrai</u></u></u></u> si l'exécution de la tâche doit être réalisée uniquement lorsque une session interactive (avec identification de l'utilisateur) est ouverte sur le poste pour l'utilisateur TâchePlanifiée.Utilisateur,<br><br>- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire.<br><br><br>Ceci autorise de ne pas spécifier le mot de passe de l'utilisateur (mais son nom doit être renseigné).<br>Par défaut, la valeur de cette variable est <u><u><u><u>Faux</u></u></u></u> : la tâche s'exécutera même si la session est fermée. <br>Remarque : Cette variable fonctionne uniquement à partir de Windows XP (ne fonctionne pas en 2000). |
| TâchePlanifiée.LigneCommande | Chaîne de caractères. <br><br>Paramètres à passer en ligne de commande à l'application qui sera lancée. |
| TâchePlanifiée.MotDePasse | Chaîne de caractères.<br><br>Mot de passe de l'utilisateur. Cet utilisateur a été choisi grâce à la variable TâchePlanifiée.Utilisateur. Permet d'exécuter la tâche planifiée en fonction d'un compte utilisateur. <br>Si ce mot de passe est modifié, cette modification sera également prise en compte par l'ensemble des tâches liées à ce même utilisateur. |
| TâchePlanifiée.NombreHoraires | Entier.<br><br>Nombre d'horaires de la tâche (c'est-à-dire le nombre d'événements déclenchant la tâche). <br>Cette variable est en lecture seule et elle est mise à jour grâce à la fonction [PlanificateurPropriétésTâche](../WDLang1/3089011.md). |
| TâchePlanifiée.PasSurBatteries | Booléen.<br><br><u><u><u><u>Vrai</u></u></u></u> si la tâche ne doit pas être exécutée quand l'ordinateur est alimenté par des batteries.<br>Par défaut, la valeur de cette variable est <u><u><u><u>Vrai</u></u></u></u>. |
| TâchePlanifiée.ProchaineExécution | DateHeure.<br><br>Date de la prochaine exécution planifiée de la tâche. <br>Cette variable est en lecture seule et elle est mise à jour grâce à la fonction [PlanificateurPropriétésTâche](../WDLang1/3089011.md). |
| TâchePlanifiée.RépertoireTravail | Chaîne de caractères.<br><br>Répertoire de travail de l'application à lancer (chaîne vide si le répertoire de travail correspond au répertoire du planificateur (MSTASK.EXE). <br>**Attention : Si ce répertoire n'est pas renseigné, il correspond au répertoire de TâchePlanifiée.Application.** |
| TâchePlanifiée.SuppressionAutomatique | Booléen.<br><br><u><u><u><u>Vrai</u></u></u></u> si la tâche doit être supprimée automatiquement quand il n'existe plus de conditions d'exécution possible (par exemple la date limite de chaque horaire est dépassée). <br>Par défaut, la valeur de cette variable est <u><u><u><u>Faux</u></u></u></u>. |
| TâchePlanifiée.Utilisateur | Chaîne de caractères.<br><br>Nom d'utilisateur dont le compte est utilisé pour exécuter la tâche.<br>Remarque : si vous utilisez un domaine, il est nécessaire de préciser le domaine. |



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Exemple
<a name="exemple_ELTTEXTE000365"></a>


### Exemple d'ajout d'une tâche
<a name="exemple_ajout_une_tache_ELTPARAGRAPHE000268"></a>
```wl
PlanificateurRAZ()
// Création de la tache planifiée
TâchePlanifiée.Application = "MonExécutable.exe"
TâchePlanifiée.LigneCommande = ReqToutSurUneBackup.Nom
TâchePlanifiée.Eveil = Vrai
TâchePlanifiée.Commentaire = "Programme WINDEV"

// Création des horaires de la tâche planifiée
// nTypeSauvegarde est un sélecteur proposant une sauvegarde 
// unique, hebdomadaire, mensuelle...

HoraireTâchePlanifiée.Type = nTypeSauvegarde

// Date d'exécution de la sauvegarde unique
SI nTypeSauvegarde = htQuotidien ALORS
	SI SAI_DateUnique <> "" ALORS
		SI SAI_HoraireUnique <> "" ALORS
			HoraireTâchePlanifiée.Date = SAI_DateUnique 
			HoraireTâchePlanifiée.Heure = SAI_HoraireUnique
		SINON
			Info("Vous devez saisir une heure valide de sauvegarde.")
			RETOUR
		FIN
	SINON
		Info("Vous devez saisir une date valide de sauvegarde.")
		RETOUR
	FIN
FIN
// Sauvegarde chaque mois
SI nTypeSauvegarde = htMensuel ALORS
	SI SAI_HoraireUnique <> "" ALORS
		HoraireTâchePlanifiée.Jour = SEL_JourDuMois
		HoraireTâchePlanifiée.Heure = SAI_HoraireUnique
	SINON
		Info("Vous devez saisir une heure valide de sauvegarde.")
		RETOUR
	FIN
FIN
// Sauvegarde chaque semaine
SI nTypeSauvegarde = htHebdomadaire ALORS
	SI SAI_HoraireUnique <> "" ALORS
		HoraireTâchePlanifiée.JoursSemaine = SEL_JourDeLaSemaine
		HoraireTâchePlanifiée.Heure = SAI_HoraireUnique
	SINON
		Info("Vous devez saisir une heure valide de sauvegarde.")
		RETOUR
	FIN
FIN
SI PAS PlanificateurAjouteTâche("MaTache") ALORS 
	Erreur(ErreurInfo())
SINON
	Info("L'application a été ajoutée au gestionnaire de tâches de Windows")
FIN
```



