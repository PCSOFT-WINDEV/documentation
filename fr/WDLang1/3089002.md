
## Structure HoraireTâchePlanifiée
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000356"></a>
La structure **HoraireTâchePlanifiée** permet de définir tous les événements qui vont définir l'exécution d'une tâche. Les variables de cette structure sont ré-initialisées grâce à la fonction [PlanificateurRAZ](../WDLang1/3089012.md).

Cette structure doit être remplie avant d'utiliser la fonction [PlanificateurAjouteHoraire](../WDLang1/3089001.md) ou la fonction [PlanificateurAjouteTâche](../WDLang1/3089003.md).

L'horaire défini par défaut est une tâche quotidienne à 9h00.





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Détail de la structure HoraireTâchePlanifiée
<a name="detail_structure_horairetacheplanifiee_ELTTEXTE000380"></a>
Les paramètres à saisir dans la structure **HoraireTâchePlanifiée** dépendent du type de l'horaire de la tâche planifiée.

En effet, une tâche planifiée peut être : quotidienne, hebdomadaire, mensuelle, exécutée une seule fois, exécutée au démarrage, exécutée lorsque le système est inactif.

Le type de l'horaire de la tâche planifiée est déterminé par la variable **HoraireTâchePlanifiée.Type**. Nous allons détailler cette variable, puis toutes les autres variables de la structure HoraireTâchePlanifiée.


|   |   |
| --- | --- |
| HoraireTâchePlanifiée.ArrêtForcé | Booléen. <br><br>Si ce paramètre est à Vrai, arrête la tâche quand elle est en cours d'exécution et que la durée de répétition est écoulée. <br>Par défaut, cette variable est à faux. <br>Type de tâche associée : Tâche hebdomadaire, tâche mensuelle, quotidienne et une seule fois. |
| HoraireTâchePlanifiée.Date | Date<br><br>Date à laquelle la tâche sera exécutée. <br>Type de tâche associée : Tâche exécutée une seule fois. |
| HoraireTâchePlanifiée.DateDébut | Date<br><br>Date à partir de laquelle la tâche pourra être exécutée. Par défaut, cette date correspond à la date de création de la tâche. <br>Type de tâche associée : Tâche hebdomadaire, tâche mensuelle et quotidienne. |
| HoraireTâchePlanifiée.DateFin | Date<br><br>Date à partir de laquelle la tâche ne sera plus du tout exécutée. Pour ne pas définir de date de fin, il suffit d'utiliser une chaîne vide. <br>Par défaut, il n'y a pas de date de fin. <br>Type de tâche associée : Tâche hebdomadaire, tâche mensuelle et quotidienne. |
| HoraireTâchePlanifiée.DuréeInactivité | Entier en minutes<br><br>Durée d'inactivité après laquelle la tâche doit être exécutée. Par défaut, cette durée est égale à 10 minutes. <br>Type de tâche associée : Exécution lorsque le système est inactif |
| HoraireTâchePlanifiée.DuréeRépétition | Entier en minutes. <br><br>Durée pendant laquelle la tâche sera répétée. Par défaut, cette durée est égale à 60 minutes. <br>Type de tâche associée : Tâche hebdomadaire, tâche mensuelle et quotidienne. |
| HoraireTâchePlanifiée.Heure | Heure<br><br>Heure à laquelle la tâche sera exécutée. Par défaut, cette variable a pour valeur 9 Heures<br>Type de tâche associée : Tâche hebdomadaire, tâche mensuelle, quotidienne et une seule fois. |
| HoraireTâchePlanifiée.Intervalle | Entier<br><br>Nombre de jours ou semaines entre chaque exécution. Par défaut, cette variable a pour valeur 1. <br>Type de tâche associée : Tâche hebdomadaire, tâche quotidienne. |
| HoraireTâchePlanifiée.Jour | Entier<br><br>Jour d'exécution de la tâche dans le mois. Peut correspondre : <br><br>- soit à un numéro de jour (entre 1 et 31)<br><br>- soit à un nom de jour + sa position dans le mois<br><br><br>Exemple : 1er Lundi du mois : htLundi + htPremier<br><br>Les valeurs disponibles sont : <br><br>- htLundi, htMardi, htMercredi, htJeudi, htVendredi, htSamedi, htDimanche<br><br>- htPremier, htDeuxième, htTroisième, htQuatrième, htDernier. <br><br><br>Par défaut, l'exécution est effectuée le 1er de chaque mois. <br><br>Type de tâche associée : Tâche mensuelle |
| HoraireTâchePlanifiée.JourSemaine | Entier<br><br>Jour d'exécution de la tâche dans la semaine. Correspond à un nom de jour + sa position dans le mois<br><br>Exemple : 1er Lundi du mois : htLundi + htPremier<br><br>Les valeurs disponibles sont : htLundi, htMardi, htMercredi, htJeudi, htVendredi, htSamedi, htDimanche <br><br>Par défaut, l'exécution est effectuée le Lundi. <br><br>Type de tâche associée : Tâche hebdomadaire |
| HoraireTâchePlanifiée.Libellé | Chaîne de caractères<br><br>Libellé de l'horaire, c'est-à-dire de l'événement déclenchant la tâche planifiée. <br><br>Cette variable est en lecture seulement et elle est mise à jour lors de la lecture d'un horaire (fonction [PlanificateurPropriétésHoraire](../WDLang1/3089010.md)) |
| HoraireTâchePlanifiée.Mois | Entier<br><br>Mois d'exécution de la tâche dans l'année. Correspond à un ou plusieurs noms de mois : *htJanvier*, *htFévrier*, *htMars*, *htAvril*, *htMai*, *htJuin*, *htJuillet*, *htAout*, *htSeptembre*, *htOctobre*, *htNovembre*, *htDécembre*. <br><br>Exemple : htJanvier + htAout : effectue la tâche en Janvier et Août. <br><br>Par défaut, l'exécution est effectuée tous les mois. <br><br>Type de tâche associée : Tâche mensuelle |
| HoraireTâchePlanifiée.PériodeRépétition | Entier en minutes<br><br>Intervalle de répétition de la tâche (0 si elle ne doit être exécutée qu'une fois). Par défaut, il n'y a pas de répétition. <br><br>Type de tâche associée : Tâche hebdomadaire, tâche mensuelle, quotidienne et une seule fois. |
| HoraireTâchePlanifiée.Type | Cette variable peut être égale à une des constantes suivantes : <br><br><br>\   \   \<br>\ --- \ --- \<br>\ *htConnexion* \ Exécution à l'ouverture d'une session. \<br>\ *htDémarrage* \ Exécution au démarrage du système. \<br>\ *htHebdomadaire* \ Planification à la semaine. \<br>\ *htInactivité* \ Exécution lorsque le système est inactif. \<br>\ *htMensuel* \ Planification au mois. \<br>\ *htQuotidien* <br> (valeur par défaut) \ Planification par jour \<br>\ *htUneFois* \ Exécution une seule fois. \<br><br> |







<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Variables pouvant être utilisées selon le type de tâche
<a name="variables_pouvant_etre_utilisees_selon_type_tache_ELTTEXTE000404"></a>
Ce tableau présente la liste des variables pouvant être utilisées selon le type de tâche sélectionné :


|   |   |
| --- | --- |
| htConnexion | Aucune variable spécifique |
| htDémarrage | Aucune variable spécifique |
| htHebdomadaire | HoraireTâchePlanifiée.Heure<br>HoraireTâchePlanifiée.Intervalle<br>HoraireTâchePlanifiée.DateDébut<br>HoraireTâchePlanifiée.DateFin<br>HoraireTâchePlanifiée.PériodeRépétition<br>HoraireTâchePlanifiée.DuréeRépétition<br>HoraireTâchePlanifiée.ArrêtForcé |
| htInactivité | Aucune variable spécifique |
| htMensuel | HoraireTâchePlanifiée.Heure<br>HoraireTâchePlanifiée.Jour<br>HoraireTâchePlanifiée.Mois<br>HoraireTâchePlanifiée.DateDébut<br>HoraireTâchePlanifiée.DateFin<br>HoraireTâchePlanifiée.PériodeRépétition<br>HoraireTâchePlanifiée.DuréeRépétition<br>HoraireTâchePlanifiée.ArrêtForcé |
| htQuotidien | HoraireTâchePlanifiée.Heure<br>HoraireTâchePlanifiée.Intervalle<br>HoraireTâchePlanifiée.DateDébut<br>HoraireTâchePlanifiée.DateFin<br>HoraireTâchePlanifiée.PériodeRépétition<br>HoraireTâchePlanifiée.DuréeRépétition<br>HoraireTâchePlanifiée.ArrêtForcé |
| htUneFois | HoraireTâchePlanifiée.Heure<br>HoraireTâchePlanifiée.Date<br>HoraireTâchePlanifiée.PériodeRépétition<br>HoraireTâchePlanifiée.DuréeRépétition<br>HoraireTâchePlanifiée.ArrêtForcé |







<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Exemple
<a name="exemple_ELTTEXTE000428"></a>


### Exemple d'ajout d'une tâche
<a name="exemple_ajout_une_tache_ELTPARAGRAPHE000306"></a>


```wl
PlanificateurRAZ()
// Création de la tache planifiée
TâchePlanifiée.Application = "MonExécutable.exe"
TâchePlanifiée.LigneCommande = ReqToutSurUneBackup.Nom
TâchePlanifiée.Eveil = Vrai
TâchePlanifiée.Commentaire = "Programme WINDEV"

// Création des horaires de la tâche planifiée
// SEL_TypeSauvegarde est un sélecteur proposant 
// une sauvegarde unique, hebdomadaire, mensuelle ...

HoraireTâchePlanifiée.Type = SEL_TypeSauvegarde

// Date d'exécution de la sauvegarde unique
SI SEL_TypeSauvegarde = htQuotidien ALORS
	SI SAI_DateUnique <> "" ALORS
		SI SAI_HoraireUnique <> "" ALORS
			HoraireTâchePlanifiée.Date = SAI_DateUnique 
			HoraireTâchePlanifiée.Heure = SAI_HoraireUnique
		SINON
			Info("Vous devez saisir une heure valide de sauvegarde.")
			RETOUR
		FIN
	SINON
		Info("Vous devez saisir une date valide de sauvegarde.")
		RETOUR
	FIN
FIN
// Sauvegarde Chaque mois
SI SEL_TypeSauvegarde = htMensuel ALORS
	SI SAI_HoraireUnique <> "" ALORS
		HoraireTâchePlanifiée.Jour = SEL_JourDuMois
		HoraireTâchePlanifiée.Heure = SAI_HoraireUnique
	SINON
		Info("Vous devez saisir une heure valide de sauvegarde.")
		RETOUR
	FIN
FIN
// Sauvegarde chaque semaine
SI SEL_TypeSauvegarde = htHebdomadaire ALORS
	SI SAI_HoraireUnique <> "" ALORS
		HoraireTâchePlanifiée.JoursSemaine = SEL_JourDeLaSemaine
		HoraireTâchePlanifiée.Heure = SAI_HoraireUnique
	SINON
		Info("Vous devez saisir une heure valide de sauvegarde.")
		RETOUR
	FIN
FIN
SI PAS PlanificateurAjouteTâche("MaTache") ALORS 
	Erreur(ErreurInfo())
SINON
	Info("L'application a été ajoutée au gestionnaire de tâches de Windows")
FIN
```





