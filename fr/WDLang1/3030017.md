
## HTML 5 : Exemple de gestion du Drag and Drop programmé
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000159"></a>
Pour rendre un site WEBDEV plus interactif, il est possible de mettre en place un "Drag and Drop" (ou glisser-déplacer) dans les pages.

Les différentes étapes pour mettre en place le Drag and Drop programmé sont les suivantes : 

1. [Définir les sources et les cibles du "Drag and Drop"](#NOTE2_1).  

2. [Déclarer les événements à gérer](#NOTE3_1). 

3. [Agir pendant les événements](#NOTE4_1). 




Remarques : 

- Le "Drag and Drop" en HTML 5 est géré uniquement sous les navigateurs Chrome et Firefox (à l'heure de l'écriture de cette page). 

- Attention : Le "Drag and Drop" en HTML 5 n'est pas utilisable dans les sites affichés sur un mobile. En effet, la technologie utilisée ne permet pas de faire la différence entre une action du Drag and Drop et une gesture sur le mobile. 

- Cette page d'aide est basée sur l'exemple "WW_Drag_n_Drop_HTML5" livré avec WEBDEV. 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Définir les sources et les cibles
<a name="definir_les_sources_les_cibles_ELTTEXTE000183"></a>
La première étape dans la mise en place du Drag and Drop est l'identification des champs qui vont être utilisés dans le "Drag and Drop".


Dans notre exemple, il existe : 

- 3 champs "sources" : il s'agit des 3 champs affichant les images des extincteurs. Dans le code d'initialisation de ces champs (code serveur), la propriété [DndSource](../Proprietes/2510014.md) est utilisée pour indiquer que ces champs sont sources d'un "Drag and Drop" programmé. 
	
	```wl
	// Indique que le champ est source d'un "Drag and Drop" 
	MoiMême.DndSource = dndProgrammé
	```


- 1 champ "destination" : il s'agit de l'image du plan. La propriété [DndCible](../Proprietes/2510016.md) est utilisée dans le code d'initialisation de ce champ (code serveur). 
	
	```wl
	// Indique que le champ est cible d'un "Drag and Drop" 
	MoiMême.DndCible = dndProgrammé
	```





<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Déclarer les événements à gérer
<a name="declarer_les_evenements_gerer_ELTTEXTE000207"></a>
La fonction [DnDEvénement](../WDLang1/3030006.md) permet de définir les événements gérés lors du "Drag and Drop". Cette fonction attend en paramètres : 

- le nom de la procédure WLangage qui sera exécutée lorsque l'événement aura lieu. 

- le champ sur lequel l'événement doit être géré. Il est possible de spécifier un champ ou tous les champs de la page. 

- l'événement à gérer. Plusieurs événements sont disponibles : début et fin du glisser déplacer, entrée et sortie du champ cible, survol du champ cible et lâcher sur le champ cible. Ces événements sont identifiés par des constantes (dndXXX). 




Dans notre exemple, les deux événements gérés sont le survol et le lâcher. 


```wl
// Active le Drag and Drop sur l'image du plan 
DnDEvénement(Survol, IMG_PLAN, dndSurvol) 
DnDEvénement(Lacher, IMG_PLAN, dndLâcher)
```


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Agir pendant un événement
<a name="agir_pendant_evenement_ELTTEXTE000231"></a>


### Survol de la cible
<a name="survol_cible_ELTPARAGRAPHE000075"></a>La procédure "Survol" est appelée lorsque l'utilisateur survolera la zone cible pendant un "Drag and Drop". 

Dans notre cas, lors du survol, le curseur est modifié afin d'indiquer à l'utilisateur que l'action est autorisée par le "Drag and Drop" sur ce champ cible. 

Il suffit pour cela d'utiliser la fonction [DnDCurseur](../WDLang1/3030004.md), avec la constante *dndDépla­cer*. 


```wl
PROCEDURE Survol
// Modifie le curseur 
DnDCurseur(dndDéplacer)
```



### Lâcher du "Drag and Drop"
<a name="lacher_drag_and_drop_ELTPARAGRAPHE000089"></a>Lors du lâcher, plusieurs actions sont réalisées :  

1. L'action de déplacement est acceptée via la fonction [DnDAccepte](../WDLang1/3030005.md). 
	
	```wl
	PROCEDURE Lacher
	// On accepte le Drag and Drop 
	DnDAccepte(dndDéplacer)
	```


2. La position du curseur est récupérée via les variables _DND.SourisPosX et _DND.SourisPosY. 
	Ces variables renvoient en effet la position du curseur au moment du lâcher sur la cible. 
	
	```wl
	// Mémorise la position du curseur
	nXImage = _DND.SourisPosX 
	nYImage = _DND.SourisPosY
	```


3. Le champ source du "Drag and Drop" est également récupéré. Selon le champ source, la couleur associée va être mémorisée pour le dessin. 
	
	```wl
	// Récupère le champ source
	sIDExtincteur = _DND.ChampSource
	// La couleur est différente selon l'extincteur sélectionné 
	SELON sIDExtincteur 
		CAS IMG_EXTINCTEUR.Nom 
			nCouleur = 255 
		CAS IMG_EXTINCTEUR1.Nom 
			nCouleur = 3243262 
		CAS IMG_EXTINCTEUR2.Nom 
			nCouleur = 65535 
		AUTRE CAS
			nCouleur = 16706050 
	FIN
	```


4. L'ensemble des données (coordonnées, couleur, taille) est ensuite mémorisé dans un tableau pour pouvoir être réutilisé lors du dessin par la procédure **DessineTout**.
	
	```wl
	// Sauvegarde les coordonnées 
	sCoordonnees = sIDExtincteur + TAB + nXImage + TAB + nYImage + TAB + ...
			SAI_POTENTIOMETTRE + TAB + nCouleur
	// Sauvegarde les informations 
	gnIndiceCourant++ 
	gtabListeCoordonnees[gnIndiceCourant] = sCoordonnees
	// Dessine les extincteurs sur le plan 
	DessineTout()
	```








- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionnalitesdeDragAndDropHTML5.gif) ***Exemples unitaires (WEBDEV)*** : **Les fonctionnalités de Drag And Drop HTML5** <br>Utilisation des fonctionnalités de Drag n Drop HTML 5 dans un site WEBDEV.


