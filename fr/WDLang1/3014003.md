
## AppelDLL32 (Fonction)

***En anglais : CallDLL32***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Exécute une fonction présente dans une DLL externe. Cette fonction peut être une fonction de l'API Windows. Les fonctions accessibles par **AppelDLL32** sont par exemple les fonctions des librairies standard de Windows (USER32, KERNEL32, GDI32, etc.). 

La fonction peut être identifiée par : 

- son nom. 

- son numéro.

- son adresse.




Il est également possible d'utiliser une variable de type [Description d'API](../WDLang1/1000019149.md). Pour les API appelées plusieurs fois dans une même application ou utilisant des paramètres de types spécifiques, il est conseillé d'utiliser une variable de type Description d'API avec une utilisation directe (sans passer par la fonction **AppelDLL32**).  

**Remarques** :

- Cette fonction est identique à la fonction [API](../WDLang1/3014005.md).

- Si la fonction à exécuter possède des paramètres de type QWORD, il est nécessaire d'utiliser une variable de type [Description d'API](../WDLang1/1000019149.md) (Syntaxe 4).



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003014003&name=appeldll32_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
AppelDLL32("USER32", "SendMessageA", hWnd, wMsg, lParam1, lParam2)
```



<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Exécuter une fonction d'une DLL externe ou de l'API Windows identifiée par son nom

`<Résultat> = AppelDLL32(<Nom de la DLL> , <Nom de la fonction> [, <Paramètre 1> [... [, <Paramètre N>]]])`
---

**`<Résultat> : (Entier sur 4 en 32 bits, entier sur 8 en 64 bits)`**

Résultat de l'exécution de la fonction &lt;Nom de la fonction&gt;. Ce résultat peut être un code d'erreur. Le type de ce résultat dépend de la fonction exécutée. Consultez la documentation de cette fonction pour obtenir plus de détails. 
Si le résultat de la fonction est d'une taille supérieure à la taille de l'entier de la plateforme, il ne pourra pas être récupéré.

**`<Nom de la DLL> : (Chaîne de caractères)`**

Nom de la librairie (DLL) qui contient la fonction à exécuter.

**`<Nom de la fonction> : (Chaîne de caractères)`**

Nom de la fonction à exécuter. Cette fonction doit être présente dans la DLL spécifiée.

**`<Paramètre 1> : (Type correspondant au paramètre (optionnel))`**

Premier paramètre à passer à la fonction. Ces paramètres doivent être du même type que les paramètres attendus par la fonction. Sont utilisables : 

- les types "simples" (voir Remarques),

- les structures (voir Remarques),

- un nom de procédure WLangage. Cette procédure sera rappelée par la fonction de la DLL (voir Remarques).






**`<Paramètre N> : (Type correspondant au paramètre (optionnel))`**

Nième paramètre à passer à la fonction. Ces paramètres doivent être du même type que les paramètres attendus par la fonction. Sont utilisables : 

- les types "simples" (voir Remarques),

- les structures (voir Remarques),

- un nom de procédure WLangage. Cette procédure sera rappelée par la fonction de la DLL (voir Remarques).





<a name="SYNTAXE2"></a>

### Exécuter une fonction d'une DLL externe ou de l'API Windows identifiée par son numéro

`<Résultat> = AppelDLL32(<Nom de la DLL> , <Numéro de la fonction> [, <Paramètre 1> [... [, <Paramètre N>]]])`
---

**`<Résultat> : (Entier sur 4 en 32 bits, entier sur 8 en 64 bits)`**

Résultat de l'exécution de la fonction &lt;Nom de la fonction&gt;. Ce résultat peut être un code d'erreur. Le type de ce résultat dépend de la fonction exécutée. Consultez la documentation de cette fonction pour obtenir plus de détails. 
Si le résultat de la fonction est d'une taille supérieure à la taille de l'entier de la plateforme, il ne pourra pas être récupéré.

**`<Nom de la DLL> : (Chaîne de caractères)`**

Nom de la librairie (DLL) qui contient la fonction à exécuter.

**`<Numéro de la fonction> : (Chaîne de caractères)`**

Numéro de la fonction à exécuter. Cette fonction doit être présente dans la DLL spécifiée.

**`<Paramètre 1> : (Type correspondant au paramètre)`**

Premier paramètre à passer à la fonction. Ces paramètres doivent être du même type que les paramètres attendus par la fonction. Sont utilisables : 

- les types "simples" (voir Remarques),

- les structures (voir Remarques),

- un nom de procédure WLangage. Cette procédure sera rappelée par la fonction de la DLL (voir Remarques).






**`<Paramètre N> : (Type correspondant au paramètre)`**

Nième paramètre à passer à la fonction. Ces paramètres doivent être du même type que les paramètres attendus par la fonction. Sont utilisables : 

- les types "simples" (voir Remarques),

- les structures (voir Remarques),

- un nom de procédure WLangage. Cette procédure sera rappelée par la fonction de la DLL (voir Remarques).





<a name="SYNTAXE3"></a>

### Exécuter une fonction d'une DLL externe ou de l'API Windows identifiée par son adresse

`<Résultat> = AppelDLL32(<Adresse de la fonction> [, <Paramètre 1> [... [, <Paramètre N>]]])`
---

**`<Résultat> : (Entier sur 4 en 32 bits, entier sur 8 en 64 bits)`**

Résultat de l'exécution de la fonction &lt;Nom de la fonction&gt;. Ce résultat peut être un code d'erreur. Le type de ce résultat dépend de la fonction exécutée. Consultez la documentation de cette fonction pour obtenir plus de détails. 
Si le résultat de la fonction est d'une taille supérieure à la taille de l'entier de la plateforme, il ne pourra pas être récupéré.

**`<Adresse de la fonction> : (Entier)`**

Adresse en mémoire de la fonction à exécuter.

**`<Paramètre 1> : (Type correspondant au paramètre)`**

Premier paramètre à passer à la fonction. Ces paramètres doivent être du même type que les paramètres attendus par la fonction. Sont utilisables : 

- les types "simples" (voir Remarques),

- les structures (voir Remarques),

- un nom de procédure WLangage. Cette procédure sera rappelée par la fonction de la DLL (voir Remarques).






**`<Paramètre N> : (Type correspondant au paramètre)`**

Nième paramètre à passer à la fonction. Ces paramètres doivent être du même type que les paramètres attendus par la fonction. Sont utilisables : 

- les types "simples" (voir Remarques),

- les structures (voir Remarques),

- un nom de procédure WLangage. Cette procédure sera rappelée par la fonction de la DLL (voir Remarques).










<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques




### Contrôles effectués
<a name="controles_effectues_ELTPARAGRAPHE000134"></a>

- La fonction **AppelDLL32** est protégée contre les "Erreurs de protection générale" dans la fonction appelée. Néanmoins, si une erreur de ce type se produit, une erreur WLangage est déclenchée.

- Pour les fonctions au prototype d'appel PASCAL (les fonctions de l'API Windows notamment), un contrôle sommaire du nombre de paramètres passés à la fonction est effectué. En cas de discordance, une erreur WLangage est déclenchée.



<a name="NOTE0_2"></a>


### Gestion des erreurs
<a name="gestion_des_erreurs_ELTPARAGRAPHE000145"></a>Lors de l'exécution de fonctions de l'API Windows, si le résultat renvoyé correspond à une erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) pour obtenir plus d'informations sur l'erreur (avec la constante *errCodeSystème* ou *errMessageSystème*).
<a name="NOTE0_3"></a>


### Chargement et déchargement de la DLL
<a name="chargement_dechargement_dll_ELTPARAGRAPHE000155"></a>La fonction **AppelDLL32** charge automatiquement la DLL au besoin, puis la décharge (si elle l'a chargée). Ce mécanisme peut être très lent, sauf pour les DLL du système (KERNEL, USER, GDI).

Pour optimiser la vitesse d'exécution, il est conseillé de charger une fois la DLL avec [ChargeDLL](../WDLang1/3014006.md), puis de la décharger avec [DéchargeDLL](../WDLang1/3014009.md) lorsqu'elle n'est plus utilisée.


<a name="NOTE0_4"></a>


### Paramètres à passer à la fonction de la DLL
<a name="parametres_passer_fonction_dll_ELTPARAGRAPHE000174"></a>Ces paramètres doivent être du même type que les paramètres attendus par la fonction.

Les types utilisables sont les suivants :

- **Les types "simples"** (entier, réel, et booléen). L'utilisation d'un autre type WLangage provoque une erreur du WLangage. 
	Si la fonction à exécuter attend un pointeur ou un handle Windows, utilisez un [entier système](../Motscles/1514049.md). 
	Si la fonction à exécuter attend une adresse, utilisez [l'opérateur &](../Motscles/1512002.md).

- Les types "chaîne". 

- Les types structure.

- **Un nom de procédure WLangage**. Cette procédure sera rappelée par la fonction de la DLL (voir paragraphe ci-dessous). 
	Les paramètres dépendent de la fonction exécutée. Consultez la documentation de cette fonction pour obtenir plus de détails.





<a name="NOTE0_5"></a>


### Passer une chaîne à une API ou récupérer une chaîne en retour d'une API
<a name="passer_une_chaine_une_api_recuperer_une_chaine_retour_une_api_ELTPARAGRAPHE000201"></a>

1. En paramètre d'entrée, utilisez le type chaîne. Par exemple :
	
	```txt
	sChaîne est une chaîne 
	AppelDll32(<DLL>, <Fonction>, sChaîne)
	```


2. En paramètre de sortie, le C n'est pas capable de gérer des chaînes dynamiques de manière simple. Il est donc nécessaire :

	- soit de fixer une taille maximale, avec le type "Chaîne sur". Par exemple : 
			
		```txt
		sChaîne est une chaîne sur 100
		AppelDLL32(<DLL>, <Fonction>, sChaîne) 
		// dans Methode en C : 
		// STRNCPY(PointeurEnC, "Test", 100)
		```


	- soit de récupérer les adresses des chaînes en C (mais dans ce cas, la partie de code en C doit assurer la "survie" des chaînes renvoyées), puis de transférer la chaîne dans une variable de type chaîne grâce à la fonction [ChaîneRécupère](../WDLang1/3024005.md). Par exemple :
			
		```txt
		nAdresseChaîne est un entier système
		AppelDLL32(<DLL>, <Fonction>, &nAdresseChaîne)
		sChaîne est une chaîne
		sChaîne = ChaîneRécupère(nAdresseChaîne, crAdresseASCIIZ)
		// dans Méthode en C : *PointeurEnC = "Test"
		```





3. En valeur de retour, récupérer les adresses des chaînes en C (mais dans ce cas, la partie de code en C doit assurer la "survie" des chaînes renvoyées), puis transférer la chaîne dans une variable de type chaîne grâce à la fonction [ChaîneRécupère](../WDLang1/3024005.md).  Par exemple :
	
	```txt
	nAdresseChaîne est un entier système
	nAdresseChaîne = AppelDLL32(<DLL>, <Fonction>)
	sChaîne est une chaîne
	sChaîne = ChaîneRécupère(nAdresseChaîne, crAdresseASCIIZ)
	// dans Méthode en C : Return PointeurEnC
	```






<a name="NOTE0_6"></a>


### Passer une structure contenant une chaîne à une API
<a name="passer_une_structure_contenant_une_chaine_une_api_ELTPARAGRAPHE000228"></a>

1. En entrée, le code à utiliser est le suivant :
	
	```txt
	Struct est une structure
		sChaîne est une chaîne
	FIN
	UneStruct est une Struct
	AppelDLL32(<DLL>, <Fonction>, &UneStruct)
	```


2. En sortie, le C n'est pas capable de gérer des chaînes dynamiques de manière simple. Il est donc nécessaire de :

	- soit fixer une taille maximale et faire une copie dans la mémoire du WLangage. Par exemple :
			
		```txt
		sChaîne est une chaîne sur 100
		Struct est une structure
			aChaîne est un entier
		FIN
		UneStruct est une Struct
		UneStruct:aChaîne = &sChaîne
		AppelDLL32(<DLL>, <Fonction>, &UneStruct)
		// dans Methode en C : 
		// STRNCPY(StructEnC->PointeurEnC, "Test", 100)
		```


	- soit récupérer les adresses des chaînes en C (mais dans ce cas, la partie de code en C doit assurer la "survie" des chaînes renvoyées). Par exemple :
			
		```txt
		sChaîne est une chaîne
		Struct est une structure
			aChaîne est un entier
		FIN
		UneStruct est une Struct
		AppelDLL32(<DLL>, <Fonction>, &UneStruct)
		sChaîne = ChaîneRécupère(UneStruct:aChaîne, crAdresseASCIIZ)
		// dans Methode en C : StructEnC->PointeurEnC = "Test"
		```









<a name="NOTE0_7"></a>


### Procédure appelée en CallBack 
<a name="procedure_appelee_callback_ELTPARAGRAPHE000246"></a>Certaines fonctions de l'API Windows attendent en paramètre l'adresse d'une procédure "CallBack" : cette procédure sera rappelée par la fonction de l'API.

Par exemple : l'API EnumWindows permet d'énumérer toutes les fenêtres Windows ouvertes sur un poste. Cette fonction attend en paramètre l'adresse d'une procédure : cette procédure sera rappelée pour chacune des fenêtres trouvées.

**Remarque** : Les procédures CallBack peuvent être utilisées en 32 bits comme en 64 bits. 

Pour utiliser une procédure callback en WLangage :

**1.** Créez la procédure callback dans votre projet.

Pour récupérer les paramètres, il faut décrire exactement les paramètres attendus par la fonction "CallBack". Dans le cas contraire, des "erreurs de protection générale" peuvent survenir.

```txt
PROCEDURE <Nom de la procédure> (<Param1> est [un] <Type1>,<Param2> est [un] <Type2>)
```


**Remarques** :

- Les types doivent correspondre à ceux décrits dans la documentation de l'API.

- La fonction "CallBack" de la DLL doit être de type "stdcall". 

- Les paramètres sont obligatoirement passés par valeur. Pour récupérer un paramètre par référence :

	1. Utilisez un entier.

	2. Avec la fonction [Transfert](../WDLang1/3014015.md), récupérez ou affectez la véritable valeur.







**2.** Modifiez l'appel de la fonction en conséquence. Utilisez la syntaxe suivante :

```txt
AppelDLL32(<Nom de la DLL>, <Nom de la fonction>, <Nom de la procédure CallBack>)
```


Pour plus de détails, consultez l'exemple complet.


<a name="NOTE0_8"></a>


### Divers
<a name="divers_ELTPARAGRAPHE000284"></a>

- Les fonctions [API](../WDLang1/3014005.md) et **AppelDLL32** ne bloquent pas les autres threads.

- Si la fonction de l'API appelée modifie les paramètres systèmes régionaux, les paramètres régionaux précédents sont restaurés.




La fonction [APIParamètre](../WDLang1/3014026.md) permet de configurer le comportement par défaut de ces fonctions.

***Remarque*** : jusqu'à la version 100045 :

- Les fonctions [API](../WDLang1/3014005.md) et **AppelDLL32** bloquent les autres threads.

- Si la fonction de l'API appelée modifie les paramètres systèmes régionaux (langues, décimales, ...), les paramètres régionaux précédents ne sont pas restaurés.





- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ChainesavecdesAPIs.gif) ***Exemples unitaires (WINDEV)*** : **Chaînes avec des APIs** <br>Utilisation des chaînes avec des API.<br>Les fonctions suivantes sont utilisées : <br>- ChaîneRécupère<br>- Transfert
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDAPISystemes.gif) ***Exemples didactiques (WINDEV)*** : **WD APISystemes** <br>Cet exemple montre l'utilisation des Apis Windows. Différentes fonctions WLangage sont fournies et permettent d'effectuer les opérations suivantes :<br><br>	- Cacher les boutons système d'une fenêtre fille MDI<br>	- Enumérer les fenêtres ouvertes<br>	- Récupérer/Modifier le temps d'un double clic<br>	- Récupérer le temps d'inactivité sur le poste<br>	- Vider la corbeille (en utilisant ou non une variable de type "descripteur d'API")<br>	- Changer le fond d'écran<br>	- Modifier le caret (curseur de saisie) d'un champ de saisie<br>	- Partager un répertoire<br>	- Supprimer un partage<br><br>Ces fonctions utilisent des APIs Windows. Veuillez consulter la fenêtre d'aide de l'exemple pour en avoir les spécificités.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDEcrandeveille.gif) ***Exemples didactiques (WINDEV)*** : **WD Ecran de veille** <br>Cet exemple illustre la réalisation d'un économiseur d'écran avec les fonctions WLangage.<br>Dans cet exemple, nous abordons les principaux thèmes suivants :<br>1/ l'appel périodique d'une procédure (les "timers")<br>2/ la gestion des événements Windows <br>3/ les fonctions système (appel d'API Windows)<br>Pour utiliser l'écran de veille :<br>- Renommer l'exécutable (.EXE) en .SCR<br>- Copier le fichier dans le répertoire de Windows (Ex: C:\WINDOWS)<br>- Ouvrir la fenêtre de propriétés d'affichage du bureau<br>- Choisir l'onglet "Ecran de Veille"<br>- Sélectionnez l'écran de veille généré avec WINDEV
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDDirectX.gif) ***Exemples didactiques (WINDEV)*** : **WD DirectX** <br>DirectX est une collection de bibliothèques (ou API) destinées à la programmation d’applications multimédia.<br>Cet exemple intègre un composant interne permettant d'utiliser DirectX 9.0 dans vos applications WINDEV.<br>Toutes les APIs et interfaces de DirectX 9 ont été implémentées.



<a name="XComposante"></a>

## Composante :
wd280vm.dll
