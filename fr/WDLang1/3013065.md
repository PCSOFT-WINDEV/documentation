


## Sérialise (Fonction)

***En anglais : Serialize***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Transforme les éléments suivants dans un format spécifique :

- une structure (et ses sous-éléments).

- une classe (et ses sous-éléments).

- un tableau (y compris les tableaux associatifs).

- une file.

- une pile.

- une liste. 

- une variable d'un type avancé (par exemple [gglAgenda](../WDLang5/1000017418.md)).




Les formats disponibles sont XML, binaire et JSON. Il sera ensuite possible de récupérer le format initial grâce à la fonction [Désérialise](../WDLang1/3013066.md).


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=3013077&name=serialise_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
// Cet exemple montre l'utilisation des fonctions Sérialise/Désérialise
// avec une variable de type Tableau. 
// Ces fonctions peuvent utiliser tous les types de variables WLangage.

MonTableau est un tableau de chaînes
bufRésultat est un Buffer

// Ajoute des éléments dans le tableau
Ajoute(MonTableau, "WINDEV")
Ajoute(MonTableau, "WEBDEV")
Ajoute(MonTableau, "WINDEV MOBILE")

// Sérialisation du tableau dans le buffer en JSON
// => Sauvegarde du tableau et de tout son contenu dans une chaîne JSON
Sérialise(MonTableau, bufRésultat, psdJSON)

// Désérialisation du buffer JSON
// => Reconstruction du tableau WLangage à partir de la chaîne JSON
MonTableauReconstruit est un tableau de chaînes
Désérialise(MonTableauReconstruit, bufRésultat, psdJSON)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`Sérialise(<Variable> , <Buffer> , <Paramètres> [, <Nom de la racine>])`
---

**`<Variable> : (Type de la variable)`**

Variable à sérialiser. Cette variable est de type structure, classe, tableau, file, liste ou pile.

**`<Buffer> : (Chaîne de caractères Ansi ou buffer)`**

Variable qui contient le résultat de la sérialisation.



**`<Paramètres> : (Constante de type Entier)`**

Type de sérialisation :


|   |   |
| --- | --- |
| *psdBinaire* | Sérialisation binaire.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) La désérialisation binaire n'est pas disponible. |
| *psdBinaireFormat16* | Sérialisation binaire au format compatible avec la version 16.<br><br>Ce format doit être utilisé si une application en version 17 (ou supérieure) doit fournir des données à une application en version 16 ou inférieure. <br>**Ce format ne doit pas être utilisé en mode Unicode.**<br><br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) La désérialisation binaire n'est pas disponible. |
| *psdJSON* | Sérialisation au format JSON.<br><br>L'encodage utilisé correspond au standard JSON : <br><br>- l'utilisation d'un encodage en ASCII 7 bits, soit les 128 premiers caractères, les caractères non accentués, <br><br>- l'utilisation d'un encodage JSON des autres caractères : "\\u" suivi du code du caractère en hexadécimal sur 4. Exemple : pour "é" (code ASCII 233, code hexadécimal E9), l'encodage correspond à "\\u00E9".<br><br><br><br><br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) La désérialisation au format JSON n'est pas disponible. |
| *psdMinifié* | **Attention** : Cette constante doit être combinée à la constante *psdJSON*. Dans les autres cas, elle n'est pas prise en compte. <br><br>L'encodage utilisé correspond au standard JSON. Cette constante permet de générer un JSON en supprimant les espaces inutiles (retours à la ligne, caractères d'espacement, ...).<br><br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Cette constante n'est pas disponible. <br><br> |
| *psdMiseEnForme* | Sérialisation au format JSON ou XML avec retours à la ligne et indentation.<br><br>L'encodage utilisé correspond au standard JSON ou XML. <br><br>Attention : Cette constante doit être combinée avec la constante *psdJSON* ou *psdXML*. <br><br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) La sérialisation au format JSON avec mise en forme n'est pas disponible. |
| *psdXML* | Sérialisation XML avec référence aux sous-objets. Ce type de sérialisation permet d'utiliser le format XML comme moyen de stockage et d'échange entre des applications écrites en WLangage. <br><br> |
| *psdXMLAgrégé* | Sérialisation XML avec agrégation directe des sous-objets. Ce type de sérialisation permet de générer rapidement un fichier XML dans un format classique, utilisé pour des échanges avec d'autres systèmes.  <br><br>Remarque : Une désérialisation en mode *psdXMLAbrégé* est disponible, cependant les éléments WLangage (variants, tableaux, classes dérivées, ...) ne seront pas les mêmes que ceux d'origine.<br><br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce mode de sérialisation n'est pas disponible. |



**`<Nom de la racine> : (Chaîne de caractères)`**

Nom de la racine du XML généré. Ce paramètre est pris en compte uniquement en mode *psdXMLAgrégé*.
Si ce paramètre n'est pas précisé, le nom de la racine est "DOCUMENT". 





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Désérialisation
<a name="deserialisation_ELTPARAGRAPHE000204"></a>La désérialisation d'un tableau, d'une pile, d'une liste ou d'une file supprime le contenu de cet élément.

S'il y a des membres en plus dans la structure ou dans la classe :

- si on désérialise une structure ou une classe : les membres supplémentaires conservent leurs valeurs d'avant la désérialisation.

- si on désérialise un tableau de structures ou de classes : les membres supplémentaires prennent la valeur par défaut du type du membre.




S'il y a des membres en plus dans le buffer sérialisé, ils ne sont pas pris en compte lors de la désérialisation.

Pour désérialiser un tableau dynamique sans type, il est nécessaire d'allouer préalablement ce tableau.

Pour désérialiser une classe ou une structure contenant un tableau dynamique sans type, il est nécessaire d'allouer préalablement ce tableau.

La désérialisation XML nécessite la librairie wd280xml.dll ou wp280xml.dll.

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Pour que le format de sérialisation soit compatible entre des applications WINDEV et des applications WINDEV Java, les noms des éléments sérialisés suivants ne doivent pas contenir des caractères spéciaux ou des caractères accentués : 

- classes,

- tableaux de classes,

- structures,

- tableaux de structures.





<a name="NOTE0_2"></a>


### Changement de comportement en version 10 : génération d'une sérialisation XML pour les Mobiles
<a name="changement_comportement_version_10_generation_une_serialisation_xml_pour_les_mobiles_ELTPARAGRAPHE000250"></a>Jusqu'à la version 100050, l'utilisation de la constante *psdXML* ne générait pas un fichier XML correct. Le format généré posait un problème essentiellement sur les postes Mobiles. Ce problème a été corrigé.

Un fichier XML créé avec une version supérieure à la version 100050 n'est pas lisible par un programme compilé avec une version antérieure. Pour conserver le fonctionnement de la version 100050, il suffit d'utiliser la constante ***psdXML_AncienFormat***.
<a name="NOTE0_3"></a>


### Rapidité
<a name="rapidite_ELTPARAGRAPHE000259"></a>La sérialisation binaire est plus rapide que la sérialisation XML.
<a name="NOTE0_4"></a>


### Sérialisation des membres de classes et de structures
<a name="serialisation_des_membres_classes_structures_ELTPARAGRAPHE000268"></a>Par défaut, tous les membres d'une classe ou d'une structure sont sérialisés. 

Il est possible de gérer précisément la sérialisation de chaque membre : 

- en indiquant quel membre sera sérialisé lors de l'appel à la fonction **Sérialise**. 
	Cette opération est possible sur tous les types de sérialisation (XML, JSON, binaire). 
	

- en changeant le nom du membre lors de la sérialisation par la fonction **Sérialise**.  
	Cette opération n'est pas possible lors d'une sérialisation binaire. 
	




Cette gestion de la sérialisation est réalisée en utilisant la syntaxe suivante : 

- Sérialisation ou non d'un membre  : 
	
	```txt
	<Nom du membre> est un <Type du membre> [, Sérialise = <Vrai / Faux>] [, xmlAttribut]
	```


- Sérialisation et changement du nom d'un membre : 
	
	```txt
	<Nom du membre> est un <Type du membre> [, Sérialise = <Nouveau nom>] [, xmlAttribut]
	```





L'attribut d'extension "xmlAttribut" permet d'indiquer que le membre est créé en tant qu'attribut (et non balise). Cet attribut est pris en compte uniquement lors d'une sérialisation de type *psdXMLAgrégé*. 
![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) L'attribut d'extension "xmlAttribut" n'est pas disponible.

Exemple pour une classe : 

```wl
Cl est une classe
	// Membre sérialisé
	MembreSérialisé est un entier 
	// Membre non sérialisé
	MembreNonSérialisé est une chaîne, Sérialise = Faux  
	// Membre renommé lors de la sérialisation
	MembreRenommé est un entier, Sérialise = "NouveauNomMembre" 
FIN
```
Remarque : Pour ne pas sérialiser un membre de type tableau, il faut utiliser la syntaxe suivante : 

```txt
t1 est un tableau <Sérialise = Faux> d'entier
t2 est un tableau <Sérialise = "<nom de sérialisation>"> d'entier
```
<a name="NOTE0_5"></a>


### Nom de sérialisation des classes
<a name="nom_serialisation_des_classes_ELTPARAGRAPHE000321"></a>L'attribut d'extension "Sérialise" est disponible sur les classes pour indiquer le nom de sérialisation. 

La syntaxe utilisée est la suivante : 

```txt
<Nom de la classe> est une Classe [, Sérialise = <Nouveau nom>]
```


Exemple : 

```wl
CTest est une Classe, Sérialise = "Test"
	m_sNom	est une chaîne, Sérialise = "Nom"
	m_sPrenom est une chaîne, Sérialise = "Prenom"
	m_sSuitePrenom est une chaîne, Sérialise = "SuitePrenom"
FIN

sXML est un Buffer
 monTest est un CTest
 monTest.m_sNom = "Mon Nom"
 monTest.m_sPrenom = "Mon Prénom"
 monTest.m_sSuitePrenom = "Mon Prénom Mon Prénom"
Sérialise(monTest, sXML, psdXMLAgrégé)


// Contenu de sXML où l'on retrouve bien les noms de la sérialisation :
// <?xml version="1.0" encoding="UTF-8"?>
// <Test>
//  <Nom>Mon Nom</Nom>
//  <Prenom>Mon Prénom</Prenom>
//  <SuitePrenom>Mon Prénom Mon Prénom</SuitePrenom>
// </Test>
```


<a name="NOTE0_7"></a>


### Limites
<a name="limites_ELTPARAGRAPHE000337"></a>

- Les tableaux fixes et les tableaux associatifs de structures locales ne peuvent pas être sérialisés.

- Les membres globaux des classes ne sont pas sérialisés.

- La sérialisation/désérialisation XML d'un tableau de structures avec un membre chaîne contenant un "\\0" ou Caract(0) renvoie l'erreur "Format de sérialisation incorrect". Il est nécessaire de faire une sérialisation/désérialisation binaire dans ce cas.

- Il n'est pas possible de sérialiser/désérialiser un tableau de classes ou de structures si cette classe ou cette structure contient un tableau dynamique sans type. Il est nécessaire d'utiliser un tableau dynamique typé dans cette classe ou cette structure.

- Pour sérialiser/désérialiser une classe, il est nécessaire d'avoir un constructeur avec 0 paramètre.

- Piles, files, listes : 

	- La sérialisation JSON des piles, files, listes n'est pas possible. 

	- ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Il n'est pas possible de sérialiser/désérialiser des variables de type File, Pile ou Liste.




- Seule la sérialisation de type JSON est disponible pour les variables de type [Enregistrement](../WDLang4/1000020962.md). Aucune désérialisation n'est disponible.  





- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionsSerialise_Deserialise.gif) ***Exemples unitaires (WEBDEV)*** : **Les fonctions Sérialise/Désérialise** <br>Utilisation des fonctions WLangage Sérialise et Désérialise.<br>La sérialisation consiste à sauvegarder une variable, un objet, une structure, un tableau ou tout autre élément dans un buffer.<br>Ce buffer peut ensuite être sauvegardé sur disque ou envoyé par socket. Cela permet la persistance des objets.<br>La fonction Désérialise permet de reconstruire un objet, un tableau ou une structure à partir d'un buffer.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionsSerialise_Deserialise.gif) ***Exemples unitaires (WINDEV)*** : **Les fonctions Sérialise/Désérialise** <br>Utilisation des fonctions WLangage Sérialise et Désérialise.<br>La sérialisation consiste à sauvegarder une variable, un objet, une structure, un tableau ou tout autre élément dans un buffer. Ce buffer peut être ensuite sauvegardé sur disque ou envoyé par socket. Cela permet la persistance des objets.<br>La fonction Désérialise permet de reconstruire un objet, un tableau ou une structure à partir d'un buffer.

<a name="XComposante"></a>

## Classification Métier / UI :
Code neutre
## Composante :
wd280vm.dll
