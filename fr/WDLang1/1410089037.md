


## &lt;Variable FichierDisque&gt;.Bloque (Fonction)

***En anglais : &lt;DiskFile variable&gt;.Lock***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Bloque entièrement ou partiellement un fichier externe. Le fichier sera débloqué :

- à l'aide de la fonction [&lt;Variable FichierDisque&gt;.Débloque](../WDLang1/1410089040.md),

- à la fermeture du fichier.




L'application ayant bloqué le fichier peut lire et écrire dans ce fichier. Par contre, les autres applications ne pourront ni lire, ni écrire dans ce fichier.


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Ouverture d'un fichier externe
MonFichier est un FichierDisque
MonFichier = fOuvre("C:\MesRépertoires\Fichier.txt", foLectureEcriture)
SI PAS ErreurDétectée ALORS
	...
	// Blocage du fichier externe
	ResBloque = MonFichier.Bloque()
	...
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = <Fichier manipulé>.Bloque([<Premier octet à bloquer> [, <Nombre d'octets à bloquer>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le fichier a été bloqué, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire.




**`<Fichier manipulé> : (Variable de type FichierDisque)`**

Nom de la variable de type [FichierDisque](../WDLang1/1410088883.md) initialisée avec la fonction [fOuvre](../WDLang1/3036036.md) ou [fCrée](../WDLang1/3036017.md).

**`<Premier octet à bloquer> : (Entier optionnel)`**

Position du premier octet à bloquer (0 correspond au premier octet du fichier).

**`<Nombre d'octets à bloquer> : (Entier optionnel ou constante optionnelle)`**



- Nombre d'octets à bloquer dans le fichier. 

- Constante : 
	


|   |   |
| --- | --- |
| *fBloqueFichierVide* | La fonction **&lt;Variable FichierDisque&gt;.Bloque** a le même comportement que le fichier soit vide ou non (voir Remarques). |








<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Le blocage n'a pas été effectué
<a name="blocage_pas_ete_effectue_ELTPARAGRAPHE000263"></a>La fonction **&lt;Variable FichierDisque&gt;.Bloque** renvoie <u><u><u><u>Faux</u></u></u></u> si le fichier n'a pas été bloqué. Le blocage peut être effectué uniquement si :

- le fichier externe est ouvert,

- l'identifiant du fichier est valide,

- le fichier ou les octets à bloquer ne sont pas déjà bloqués par un autre poste ou par une autre application.



<a name="NOTE0_2"></a>


### Blocage d'un fichier
<a name="blocage_fichier_ELTPARAGRAPHE000284"></a>

- Le fichier est bloqué dans sa totalité si les paramètres &lt;Premier octet à bloquer&gt; et &lt;Nombre d'octets à bloquer&gt; ne sont pas précisés.

- Le fichier est bloqué à partir du premier octet à bloquer (paramètre &lt;Premier octet à bloquer&gt;) jusqu'à la fin si le paramètre &lt;Nombre d'octets à bloquer&gt; n'est pas précisé.

- Lors de la manipulation d'un fichier vide, la fonction **&lt;Variable FichierDisque&gt;.Bloque** ne bloque par défaut aucun octet. Dans ce cas, plusieurs applications peuvent "bloquer" avec succès un fichier vide. Mais il n'est pas possible d'écraser le fichier tant que le blocage est réalisé.




Pour avoir le même fonctionnement que le fichier soit vide ou non, il suffit d'utiliser la constante ***fBloqueFichierVide***.

![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png) Le blocage n'est effectif que entre 2 sites ou 2 contextes différents. Contrairement à Windows, un traitement ne peut pas bloquer un fichier qu'il a bloqué précédemment.
<a name="NOTE0_3"></a>


### Position dans le fichier
<a name="position_dans_fichier_ELTPARAGRAPHE000305"></a>A l'ouverture d'un fichier, la position en cours correspond :

- au premier octet du fichier (par défaut),

- au dernier octet du fichier si le fichier est ouvert en mode "ajout" (constante *foAjout*).




Cette position peut être modifiée par la fonction [&lt;Variable FichierDisque&gt;.Positionne](../WDLang1/1410089048.md).

La position en cours n'est pas modifiée par l'utilisation de la fonction **&lt;Variable FichierDisque&gt;.Bloque**.
<a name="NOTE0_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Fonctionnement sous Windows Vista (et supérieur)
<a name="fonctionnement_sous_windows_vista_superieur_ELTPARAGRAPHE000334"></a>Si cette fonction ne fonctionne pas correctement sous Windows Vista (et supérieur), il est nécessaire de vérifier si le fichier ou le répertoire manipulé ne se trouve pas dans un des répertoires système (répertoire de Windows ou répertoire "Program Files").

**En effet, sous Windows Vista (et supérieur), avec le [mécanisme de l'UAC](../Editeurs/2025014.md) (contrôle des comptes utilisateurs) activé**, il est nécessaire d'avoir les privilèges administrateur pour manipuler / modifier des fichiers ou des répertoires présents dans les répertoires système (répertoire de Windows ou répertoire "Program Files").

**Conseil de programmation** : Si vous devez manipuler / modifier des fichiers ou des répertoires, sans avoir besoin de privilèges administrateur, il est conseillé :

- de ne pas écrire dans le répertoire de Windows ou dans le répertoire "Program Files",

- d'utiliser le répertoire système correspondant à l'application (connu par la fonction [SysRep](../WDLang1/3073026.md) par exemple avec la constante *srAppDataCommun*).




<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280std.dll
