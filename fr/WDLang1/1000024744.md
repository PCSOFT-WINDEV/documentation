
## Agrège (Fonction)

***En anglais : Reduce***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Exécute une opération d'agrégation sur chaque élément d'un tableau WLangage.


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
tabValeur est un tableau d'entiers	= [1,2,3,4,5]
LaSomme est un entier
LaSomme = Agrège(tabValeur, (Valeur, ...
	VariableDeCalculeSomme) => { RENVOYER Valeur + VariableDeCalculeSomme }, 0)
Trace(LaSomme)

// note : cet exemple est didactique ; pour faire la somme des éléments d'un tableau, 
// il est préférable d'utiliser la fonction Somme
```



```wl
// -> compter dans un tableau le nombre de chaînes contenant la lettre "e"
// (Syntaxe préfixée)
tab3 est un tableau de chaînes = ["un","une","des","nos","leurs"]
soit Cpt = Agrège(tab3, ( Source, Total ) => { RENVOYER Total
   + ( Source [=] "e" ? 1 SINON 0 ) }, 0 )
// Cpt = 3
```



<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = Agrège(<Tableau> , <Opération à effectuer> [, <Valeur initiale>])`
---

**`<Résultat> : (Type correspondant au résultat)`**

Résultat de l'opération d'agrégation demandée.

**`<Tableau> : (Tableau WLangage)`**

Nom de la variable de type Tableau à manipuler. Ce tableau doit être un tableau à une dimension.

**`<Opération à effectuer> : (Procédure WLangage)`**

Nom de la procédure WLangage à exécuter. Cette procédure peut être : 

- une procédure globale ou locale, 

- une procédure interne. 


Il est également possible d'utiliser directement une lambda. 

**`<Valeur initiale> : (Paramètre optionnel, type correspondant à la valeur initiale)`**

Valeur initiale à utiliser lors de la première exécution de la procédure &lt;Opération à effectuer&gt;. 



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Fonctionnement
<a name="fonctionnement_ELTPARAGRAPHE000079"></a>La procédure &lt;Opération à effectuer&gt; est appelée une première fois avec deux paramètres : 

- le premier élément du tableau, 

- la valeur initiale spécifiée avec le paramètre &lt;Valeur initiale&gt;.




La procédure est ensuite appelée pour tous les autres éléments du tableau avec deux paramètres : 

- l'élément du tableau, 

- la valeur renvoyée par l'appel précédent.




**Exemple didactique**
Considérons l'exemple suivant :

```wl
tabValeur est un tableau d'entiers = [1,2,3,4,5]
LaSomme est un entier
LaSomme = Agrège(tabValeur, (Valeur, LaSomme) => { RENVOYER Valeur + LaSomme }, 0)
```
Dans cet exemple, le code :
```wl
LaSomme = Agrège(tabValeur, (Valeur, LaSomme) => { RENVOYER Valeur + LaSomme }, 0)
```
est équivalent au code suivant :
```wl
LaSomme = Agrège(tabValeur, Additionne, 0)
	
PROCEDURE INTERNE Additionne(Valeur, Total)
	RENVOYER Valeur + Total
FIN
```
Avec cette procédure interne, il est possible de découper le calcul de la façon suivante : 

- RésultatIntermédiaire1 = Additionne (t[1], ValeurInitiale) : dans l'exemple Additionne( 1, 0 ) -> 1

- RésultatIntermédiaire2 = Additionne (t[2], RésultatIntermédiaire1) : dans l'exemple Additionne( 2, 1 ) -> 3

- ...


Note : cet exemple est didactique ; pour faire la somme des éléments d'un tableau, il est préférable d'utiliser la fonction [Somme](../WDLang1/1000019892.md). 
<a name="NOTE0_2"></a>


### Agrégations existantes
<a name="agregations_existantes_ELTPARAGRAPHE000137"></a>Les agrégations les plus courantes sont disponibles en WLangage : 



|   |   |
| --- | --- |
| [Moyenne](../WDLang1/1000019891.md) | Calcule la moyenne de plusieurs éléments : <br><br>- éléments d'un tableau, <br><br>- valeurs numériques, ...<br><br><br> |
| [Somme](../WDLang1/1000019892.md) | Calcule la somme des éléments d'un tableau. |







**Enchaînement de fonctions**
Il est possible d'enchaîner les différentes fonctions de manipulation d'un tableau. 
Les fonctions suivantes peuvent être utilisées dans un enchaînement : 

- [Filtre](../WDLang1/1000024845.md)

- [Transforme](../WDLang1/1000024734.md)

- [Union](../WDLang1/1000025408.md)

- [Intersection](../WDLang1/1000025407.md)

- [Distinct](../WDLang1/1000025406.md). 


Cet enchaînement pourra être utilisé comme source d'une instruction POUR TOUT ou se terminer par une des fonctions suivantes : 

- [Applique](../WDLang1/1000024856.md)

- [Agrège](../WDLang1/1000024744.md)

- [Min](../WDLang1/3050004.md)

- [Max](../WDLang1/3050005.md)

- [Somme](../WDLang1/1000019892.md)

- [Moyenne](../WDLang1/1000019891.md)

- [VérifieTousFaux](../WDLang1/1000024858.md), [VérifieTousVrai](../WDLang1/1000024857.md), [VérifieUnFaux](../WDLang1/1000024860.md), [VérifieUnVrai](../WDLang1/1000024859.md). 




Exemple : 

```wl
gnMoyenne = gtabUser.Filtre(cbFiltre).Transforme(cbTransforme).Moyenne()
```

<a name="NOTE0_3"></a>


### Equivalence
<a name="equivalence_ELTPARAGRAPHE000151"></a>La syntaxe [POUR TOUT](../Motscles/1510016.md) permet également de parcourir les éléments d'un tableau pour réaliser des agrégations. 


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionsFiltre_Transforme_Agrege.gif) ***Exemples unitaires (WINDEV)*** : **Les fonctions Filtre / Transforme / Agrège** <br>Cet exemple montre l'utilisation des fonctions Filtre / Transforme / Agrège.<br><br>Le concept de Filter / Map / Reduce (Filtre / Transforme / Agrège en français) permet de réaliser des opérations sur des collections de données de manière extrêmement concise.<br><br>La fonction Filtre permet de filtrer un tableau d'éléments de manière personnalisée (avec une procédure callback).<br><br>La fonction Transforme permet de transformer un tableau d'éléments, toujours avec une procédure callback.<br><br>La fonction Agrège permet d'agréger des données de manière personnalisée avec une procédure callback.<br><br>Ici, cet exemple permet de calculer l'âge moyen des femmes parmi les utilisateurs affichés dans un champ Table.



<a name="XComposante"></a>

## Classification Métier / UI :
Code neutre
## Composante :
wd280vm.dll
