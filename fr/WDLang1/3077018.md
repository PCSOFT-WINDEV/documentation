
## Synchroniser des threads à l'aide de signaux
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000248"></a>
Les signaux permettent de synchroniser les différents threads d'une application. Un thread peut ainsi attendre l'exécution d'un thread.

Le WLangage propose deux modes de gestion des signaux :

- [gestion simple](#NOTE2_1) : synchronisation entre uniquement deux threads.

- [gestion avancée](#NOTE3_1) : synchronisation entre plus de deux threads.








<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Gestion simple des signaux
<a name="gestion_simple_des_signaux_ELTTEXTE000272"></a>


### Principe
<a name="principe_ELTPARAGRAPHE000056"></a>Deux threads s'exécutent en parallèle (un thread principal et un thread secondaire par exemple). Un des threads attend une action spécifique du second thread pour pouvoir s'exécuter.


<a name="NOTE2_2"></a>


### Exemple : Application gérant un correcteur d'orthographe
<a name="exemple_application_gerant_correcteur_orthographe_ELTPARAGRAPHE000064"></a>Lorsque l'utilisateur saisit le caractère ESPACE dans un champ de saisie, le correcteur orthographique est automatiquement lancé sur le mot précédent.

Dans ce cas, la correction orthographique est gérée dans un thread secondaire.

A chaque appui sur la touche ESPACE, le thread principal envoie un signal au thread secondaire afin de lancer le correcteur d'orthographe.

Le code d'une telle application est le suivant :

- Code du thread principal :
	
	```wl
	SI Droite(SAI_Saisie1, 1) = " " ALORS
		ThreadEnvoieSignal("ThreadCorrection")
	FIN
	```





- Code du thread secondaire (ThreadCorrection) :
	
	```wl
	BOUCLE
		SI ThreadAttendSignal() = Vrai ALORS
			 LanceCorrection()
		FIN
	FIN
	```




<a name="NOTE2_3"></a>


### Fonctions du WLangage
<a name="fonctions_wlangage_ELTPARAGRAPHE000085"></a>Les fonctions suivantes permettent de réaliser une gestion simple des signaux :



|   |   |
| --- | --- |
| [ThreadAttendSignal](../WDLang1/3077022.md) | Bloque le thread en cours jusqu'à ce qu'il reçoive un signal d'un autre thread. |
| [ThreadEnvoieSignal](../WDLang1/3077021.md) | Le thread en cours envoie un signal au thread spécifié pour le débloquer. |






<a name="NOTE2_4"></a>


### Remarque
<a name="remarque_ELTPARAGRAPHE000094"></a>Les sémaphores et les signaux sont des objets du système identifiés par leur nom. Ils sont donc partagés entre toutes les applications qui s'exécutent sur un poste.

Deux applications (ou deux instances de la même application) utilisent donc les mêmes objets si elles utilisent le même nom.

Pour créer des noms uniques, utilisez par exemple la fonction [Instance](../WDLang1/3014019.md) pour mettre en place le nom voulu.

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) En Java, les sémaphores, sections critiques et signaux sont uniques pour l'application qui les a créés. Ils ne peuvent pas être partagés entre plusieurs applications.



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Gestion avancée des signaux
<a name="gestion_avancee_des_signaux_ELTTEXTE000330"></a>


### Principe
<a name="principe_ELTPARAGRAPHE000115"></a>Une gestion avancée des signaux consiste à communiquer entre plusieurs threads (plus de 2 threads). Certains threads sont en attente d'une tâche réalisée par le thread principal. Lorsque le thread principal réalise cette tâche, il envoie un signal à tous les threads secondaires.
<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=SIGNAUX.gif)



<a name="NOTE3_2"></a>


### Mise en place
<a name="mise_place_ELTPARAGRAPHE000125"></a>Pour mettre en place une gestion des signaux avancée, deux méthodes sont disponibles : 

- Utilisation des types SignalAutomatique et SignalManuel. 

- Utilisation des signaux nommés (méthode conseillée pour gérer les options de partage du signal). 




![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) **Méthode 1 : Utilisation des types SignalAutomatique et SignalManuel.**
Pour mettre en place une gestion des signaux avancée, les différentes étapes sont les suivantes :

1. Création d'une variable de type [SignalAutomatique](../WDLang1/1000021270.md) ou de type [SignalManuel](../WDLang1/1000021275.md). Par défaut, ce signal est fermé. Le signal est automatiquement détruit lors de la sortie de la portée de la variable correspondante.

2. Attente du signal (fonction [SignalAttend](../WDLang1/3077007.md)).

3. Synchronisation des threads grâce aux fonctions [SignalOuvre](../WDLang1/1000021271.md) et [SignalFerme](../WDLang1/1000021272.md).




**Méthode 2 : Utilisation des signaux nommés (méthode conseillée pour gérer les options de partage du signal)**
Pour mettre en place une gestion des signaux avancée, les différentes étapes sont les suivantes :

1. Création d'un signal (fonction [SignalCrée](../WDLang1/3077009.md)). Par défaut, ce signal est fermé.

2. Attente du signal (fonction [SignalAttend](../WDLang1/3077007.md)).

3. Synchronisation des threads : 

	- grâce à la fonction [SignalModifie](../WDLang1/3077017.md) : le signal est ouvert. Tous les threads en attente sont débloqués et le signal est automatiquement refermé (fonctionnement par défaut).

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) grâce aux fonctions [SignalOuvre](../WDLang1/1000021271.md) et [SignalFerme](../WDLang1/1000021272.md).




4. Destruction du signal (fonction [SignalDétruit](../WDLang1/3077025.md)).



<a name="NOTE3_3"></a>


### Les fonctions de gestion des signaux avancés
<a name="les_fonctions_gestion_des_signaux_avances_ELTPARAGRAPHE000198"></a>Les fonctions du WLangage spécifiques à la gestion des signaux avancés sont les suivantes :



|   |   |
| --- | --- |
| [SignalAttend](../WDLang1/3077007.md) | Bloque le thread en cours en attendant que le signal spécifié soit ouvert. |
| [SignalCrée](../WDLang1/3077009.md) | Crée un signal. |
| [SignalDétruit](../WDLang1/3077025.md) | Détruit explicitement un signal. |
| [SignalFerme](../WDLang1/1000021272.md) | Ferme un signal de synchronisation entre plusieurs threads. |
| [SignalModifie](../WDLang1/3077017.md) | Modifie l'état d'un signal. |
| [SignalOuvre](../WDLang1/1000021271.md) | Ouvre un signal de synchronisation entre plusieurs threads. |






