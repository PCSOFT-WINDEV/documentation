


## Contrôle à distance : Personnalisation avec une procédure
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000127"></a>
Pour personnaliser le contrôle à distance effectué sur une application WINDEV multi-utilisateurs, il est possible de provoquer l'exécution d'une procédure de l'application.

Cette procédure sera utilisée à la place de la fenêtre standard des messages. Cette procédure permet une totale personnalisation de la gestion de l'arrêt à distance d'une application.

Cette procédure peut être utilisée par exemple :

- pour vérifier le nom de l'utilisateur connecté (cas du groupware) : un message sera affiché uniquement si l'utilisateur correspond à un administrateur.

- pour des applications sans interface, lancées en tâche de fond.

- pour ouvrir une fenêtre spécifique.




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Programmation
<a name="programmation_ELTTEXTE000151"></a>


### Procédure personnalisée
<a name="procedure_personnalisee_ELTPARAGRAPHE000026"></a>La procédure personnalisée doit être une procédure globale du projet. Il est possible de récupérer et de traiter dans cette procédure les différents renseignements concernant le mode en cours.

La déclaration de la procédure doit être du type :

```txt
PROCEDURE <Nom de la procédure> ([<Mode>[, <Message>[, <Temps d'affichage>]]])
```
où les paramètres sont les suivants :


|   |   |
| --- | --- |
| &lt;Mode&gt; | Récupère le mode de contrôle à distance en cours sous forme de constantes :<br><br>- *acInterdit* : accès interdit à l'application<br><br>- *acAvertissement* : avertissement d'un arrêt imminent<br><br>- *acArrêt* : arrêt de l'application<br><br><br> |
| &lt;Message&gt; | Récupère le message correspondant au mode en cours (ce message doit être affiché dans la fenêtre). |
| &lt;Temps d'affichage&gt; | Temps d'affichage maximal de la fenêtre (en secondes) |


```wl
// -- Procédure TraiteMessage
PROCEDURE TraiteMessage(ModeAccès, MessageAAfficher, TempsAff)
SELON ModeAccès
	CAS acInterdit
		SI NomUser <> "ADMIN" ALORS Ouvre(FEN_ConnexionImpossible)
	CAS acAvertissement
		SI NomUser <> "ADMIN" ALORS Info(MessageAAfficher)
	CAS acArrêt
		SI NomUser <> "ADMIN" ALORS FinProgramme()
FIN
```

<a name="NOTE2_2"></a>


### Initialisation de la procédure personnalisée
<a name="initialisation_procedure_personnalisee_ELTPARAGRAPHE000056"></a>Pour utiliser la procédure personnalisée pour le contrôle automatique de votre application, utilisez la fonction [AppliContrôle](../WDLang1/3013003.md) de la façon suivante dans le code d'initialisation de votre projet :

```wl
AppliContrôle("U:\MonAppli\WDUPDATE.NET", FEN_TraiteMessage)
```
où FEN_TraiteMessage est le nom de la fenêtre personnalisée,

et "WDUPDATE.NET" le fichier de contrôle de l'application.

**Conseil** : L'appel à la fonction [AppliContrôle](../WDLang1/3013003.md) doit être la première instruction du code d'initialisation du projet.
<a name="NOTE2_3"></a>


### Arrêt de l'application
<a name="arret_application_ELTPARAGRAPHE000075"></a>Lors de l'utilisation d'une procédure personnalisée, le mode d'arrêt de l'application (constante *acArrêt*) n'arrête pas automatiquement l'application. Vous devez intégrer l'appel à la fonction [FinProgramme](../WDLang1/3013033.md) dans votre application.


