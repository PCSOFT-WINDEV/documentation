
## Gérer les sections critiques
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000235"></a>
Les [sémaphores](../WDLang1/3077013.md) permettent de limiter l'exécution simultanée d'un code (procédure, ligne de code, ...) à un ou plusieurs threads à un instant donné. Un sémaphore peut être partagé par plusieurs applications.

D'autres systèmes permettent également de protéger une partie de code : 

- Les mutex permettent de limiter l'exécution simultanée d'un code (procédure, ligne de code, ...) **à un thread** à un instant donné. Un mutex peut être partagé par plusieurs applications. Pour plus de détails, consultez [Gérer les mutex dans les threads](../WDLang1/1000019475.md). 

- **Les sections critiques** : Une section critique est un *sémaphore limité à un seul thread* sur une seule portion de code (traitement, procédure, ...).




<a name="NOTE1B"></a>
<a name="NOTE1B_1"></a>


## Qu'est-ce qu'une section critique
<a name="questce_quune_section_critique_ELTTEXTE000259"></a>
Une section critique est un **sémaphore limité à un seul thread** sur une seule portion de code (traitement, procédure, ...).

Au contraire des sémaphores, une section critique ne peut être utilisée qu'une seule fois.

Par exemple, il est possible d'utiliser une section critique pour protéger une procédure de mise à jour des champs d'une fenêtre.

Remarque : Les sections critiques sont uniques pour l'application qui les a créés. Elles ne peuvent pas être partagées entre plusieurs applications.

WINDEV, WEBDEV et WINDEV Mobile proposent plusieurs méthodes pour mettre en place les sections critiques. 





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## La variable SectionCritique
<a name="variable_sectioncritique_ELTTEXTE000283"></a>
Le type de variable [SectionCritique](../WDLang1/1000023972.md) permet de mettre en place simplement une section critique grâce à la syntaxe [UTILISER .. DANS](../Motscles/1510025.md). 

Exemple : 

```wl
s est une SectionCritique
UTILISER s DANS
	// code protégé par la section critique
	// un seul thread pourra exécuter ce code à un moment donné

FIN
```


Remarques : 

- Le type **SectionCritique** permet de simplifier la déclaration des sections critiques. 

- Les variables de type **SectionCritique** respectent les règles de portée de variables. 










<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## La section critique associée à une variable
<a name="section_critique_associee_une_variable_ELTTEXTE000307"></a>
Lors de la déclaration d'une variable, il est possible d'associer cette variable à une section critique en utilisant l'attribut **section critique**. 

La syntaxe est la suivante : 

```txt
NomVariable est un TypeVariable <section critique>

ou 

NomVariable est un TypeVariable, section critique
```


Les portions de code qui manipulent ces variables doivent ensuite être encadrées par les fonctions [SectionCritiqueDébut](../WDLang1/3077001.md) et [SectionCritiqueFin](../WDLang1/3077005.md).


### Cas particulier
<a name="cas_particulier_ELTPARAGRAPHE000091"></a>Une section critique est automatiquement associée aux variables sur lesquelles des opérations simples sont effectuées, telles que : 

- affectation d'une valeur.

- récupération d'une valeur.

- incrémentation, décrémentation (opérateurs +, -, ++, --, +=, -=).





### Exemple
<a name="exemple_ELTPARAGRAPHE000102"></a>
```wl
// Déclarations globales de la fenêtre FEN_STAT
gmoSomme est un monétaire, section critique
gmoMax est un monétaire, section critique
...
```

```wl
// Code exécuté par plusieurs threads
moMontantCommande est un monétaire 
...
// opération atomique, la section critique est gérée automatiquement par le WLangage
gmoSomme += moMontantCommande

// opération multiple, il est nécessaire de mettre en place la section critique explicitement
UTILISER SectionCritique(gmoMax) DANS
	SI moMontantCommande > gmoMax ALORS
		gmoMax = moMontantCommande
	FIN
FIN
```



### Remarques
<a name="remarques_ELTPARAGRAPHE000116"></a>

- L'attribut **section critique** est autorisé sur :

	- les variables globales de projet, collection de procédures, fenêtre, page et état.

	- les variables locales.

	- les membres de classes.

	- les tableaux : dans ce cas, l'attribut est associé au tableau et pas aux éléments du tableau.




- Les files et les piles sont nativement protégées : l'attribut **section critique** n'est pas nécessaire. 










<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## La section critique nommée
<a name="section_critique_nommee_ELTTEXTE000349"></a>


### Le principe
<a name="principe_ELTPARAGRAPHE000138"></a>La section critique est définie par la fonction [SectionCritiqueDébut](../WDLang1/3077001.md) et terminée par la fonction [SectionCritiqueFin](../WDLang1/3077005.md). 

Le nom de la sectionCritique est passé en paramètre à ces fonctions à l'aide d'une chaîne de caractères. 

Exemple : 


```wl
// Utilisation d'une section critique nommée
SectionCritiqueDébut("MaSection")
// Deux threads ne pourront pas exécuter ce code en même temps
...
SectionCritiqueFin("MaSection")
```


Ce mode d'utilisation des sections critiques comporte plusieurs inconvénients : 

- risque de collisions entre plusieurs sections critiques de même nom. 

- sections critiques jamais libérées. 
















<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Programmation en WLangage
<a name="programmation_wlangage_ELTTEXTE000373"></a>


### Les fonctions de gestion des sections critiques
<a name="les_fonctions_gestion_des_sections_critiques_ELTPARAGRAPHE000175"></a>Les fonctions du WLangage spécifiques à la gestion des sections critiques sont les suivantes :



|   |   |
| --- | --- |
| [SectionCritique](../WDLang1/1000024373.md) | Active une section critique nommée ou sur une variable dans une instruction de type [UTILISER ... DANS](../Motscles/1510025.md). |
| [SectionCritiqueDébut](../WDLang1/3077001.md) | Signale le début d'une section critique : aucun autre thread ne pourra exécuter le code tant que le thread courant ne sera pas sorti de la section critique. |
| [SectionCritiqueFin](../WDLang1/3077005.md) | Signale la fin d'une section critique : un autre thread pourra exécuter le code. |





Pour manipuler les sections critiques, il est également possible d'utiliser le type suivant : 



|   |   |
| --- | --- |
| [SectionCritique](../WDLang1/1000023972.md) | Les variables de type **SectionCritique** permettent de définir des sections critiques afin de limiter l'exécution simultanée d'un code (procédure, ligne de code, ...) **à un thread** à un instant donné dans une seule application. |










