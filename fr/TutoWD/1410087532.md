
## Leçon 4.1. Application complète : Fenêtres d'ajout et de modification
<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Ce que vous allez apprendre dans cette leçon
<a name="que_vous_allez_apprendre_dans_cette_lecon_ELTTEXTE000943"></a>


- Présentation du projet exemple. 

- Création d'une fenêtre de menu listant les produits.

- Création d'une fiche produit.

- Gestion de l'ajout et de la modification d'un produit.





|   |   |
| --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=dur%E9e.png)<br> | <br>Durée estimée : 50 mn |



| [Leçon précédente](../TutoWD/1410087521.md) | [Sommaire](../TutoWD/1410087560.md) | [Leçon suivante](../TutoWD/1410087533.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Présentation de l'exemple utilisé dans cette partie
<a name="presentation_exemple_utilise_dans_cette_partie_ELTTEXTE000990"></a>
Dans cette partie, nous allons réaliser une application manipulant des fichiers de données au format HFSQL Classic.

Cette application de gestion de commandes permettra de :

- Visualiser, saisir et modifier des produits,

- Imprimer des états,

- Afficher des statistiques,

- Gérer des niveaux d'utilisation,

- Envoyer des emails,

- etc.


Le développement de cette application nous permettra également d'aborder le déploiement et la diffusion de l'application auprès des clients finaux.

Vous verrez ainsi tous les points importants du développement d'une application. 

Nous avons déjà vu dans la partie précédente comment créer un projet et une analyse. Nous n'y reviendrons pas. Nous allons travailler sur un projet contenant déjà une analyse et des fichiers de données pré-remplis. L'analyse de l'application est une version améliorée de l'analyse que vous avez créée dans la partie précédente. 

Nous allons : 

- créer différentes fenêtres permettant de lister, ajouter, modifier des produits. 

- créer différents états. 

- déployer l'application. 

- utiliser des fonctionnalités propres au développement de l'application (Tableau de bord, Audits, GDS). 

- intégrer des fonctionnalités (Groupware utilisateur, gestion des emails, etc.).  




Ces manipulations vous feront découvrir plusieurs aspects de la gestion des fichiers de données et vous feront également utiliser certaines fonctionnalités bien utiles de WINDEV­.



- Ouvrez le projet "WD Application Complète" :

	1. Lancez WINDEV si nécessaire. 

	2. Affichez la page d'accueil de WINDEV (Ctrl + &lt;).

	3. Dans la page d'accueil, cliquez sur "Tutoriel" puis dans la zone "Partie 4 - Application complète avec données", double-cliquez sur "Application complète - Exercice".
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=exemple-WD.png)<br> | Corrigé | Un projet corrigé est disponible. Ce projet contient les différentes fenêtres créées dans cette leçon. Pour ouvrir le projet corrigé, dans la page d'accueil, cliquez sur "Tutoriel" puis dans la zone "Partie 4 - Application complète avec données", double-cliquez sur "Application complète - Corrigé". |











<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Création d'une fenêtre listant les produits
<a name="creation_une_fenetre_listant_les_produits_ELTTEXTE001032"></a>
Pour créer la fenêtre listant les produits, nous allons tout d'abord créer une fenêtre vierge, puis ajouter tous les champs : nous verrons ainsi toutes les étapes nécessaires à la création d'une telle fenêtre.
<a name="NOTE3_2"></a>


### Création de la fenêtre
<a name="creation_fenetre_ELTPARAGRAPHE000075"></a>

- Pour créer une fenêtre listant les produits :

	1. Créez une nouvelle fenêtre vierge.

		- Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Cr%E9er1_GAF.jpg)
 parmi les boutons d'accès rapide (ou utilisez le raccourci Ctrl + N).

		- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Fenêtre" puis sur "Fenêtre".

		- Dans l'assistant, cliquez sur l'onglet "Basée sur un modèle" et choisissez "Utiliser : FENMOD_Modèle". Validez.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | **Les modèles de fenêtres**<br><br>Un modèle de fenêtres permet de donner un look homogène aux différentes fenêtres d'une application.<br><br>Un modèle de fenêtres contient tous les éléments graphiques communs à l'ensemble des fenêtres de l'application. Un modèle de fenêtres peut également contenir du code. Dans ce cas, ce code sera également commun à toutes les fenêtres de l'application.<br><br>Pour cet exemple nous avons créé le modèle de fenêtres FENMOD_Modèle. Ce modèle contient un logo qui apparaîtra sur toutes les fenêtres : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0007%201.jpg&type=thumb)<br> |








2. La nouvelle fenêtre apparaît sous l'éditeur. La fenêtre de sauvegarde de l'élément créé apparaît. 

3. Dans cette fenêtre, indiquez le titre de la fenêtre : "Menu". ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0001.jpg)


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | Nous avons appelé cette fenêtre "Menu" car cette fenêtre est la fenêtre principale de notre application. Elle va servir de menu mais également afficher des informations. |




<a name="NOTE3_3"></a>


### Création des champs
<a name="creation_des_champs_ELTPARAGRAPHE000109"></a>Pour créer la liste des produits, nous allons utiliser un champ Table. Ce champ va être lié au fichier de données "Produit".|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | **Qu'est-ce qu'un champ Table ?**<br><br>Il ne faut pas confondre "Table" et "champ Table".<br><br>- On parle de **Table** pour une base de données de type SQL.<br><br>- On parle de **champ Table** pour visualiser en tableau des données (ou "browse" ou encore "feuille de données"). Dans ce cas, ces données peuvent être saisies ou provenir d'un fichier de données (ou d'une table).<br><br><br><br><br>Le champ Table de WINDEV permet de visualiser ou de modifier des données :<br><br>- en mémoire : on parle alors de champ Table rempli par programmation ou de champ **Table par programmation**.<br><br>- provenant de fichiers de données ou de requêtes : on parle alors de champ **Table fichier**.<br><br>- provenant de variables WLangage : on parle alors de champ **Table sur variable**.<br><br><br> |







- Pour créer le champ Table :

	1. Sous le volet "Création", dans le groupe "Données", déroulez "Table et Liste" et sélectionnez "Table (Verticale)". Le champ en création suit alors le mouvement de la souris.

	2. Cliquez dans la fenêtre : l'assistant de création du champ Table se lance.

	3. Le champ Table que nous sommes en train de créer doit afficher les enregistrements du fichier de données "Produit". Dans l'assistant, sélectionnez l'option "Afficher des données d'un fichier ou d'une requête existante". 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0002.jpg&type=thumb)
Passez à l'étape suivante de l'assistant (bouton "Suivant").

	4. L'étape suivante de l'assistant propose les différents fichiers de données et les requêtes présents dans le projet en cours. Dépliez "Analyse" si nécessaire et sélectionnez le fichier de données "Produit". 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0003.jpg&type=thumb)
Passez à l'étape suivante.

	5. L'assistant propose la liste des rubriques présentes dans le fichier de données "Produit". 
			Par défaut, toutes les rubriques sont cochées pour être affichées dans le champ Table. Dans notre cas, nous allons afficher toutes les rubriques SAUF l'identifiant "IDProduit" qui correspond à l'identifiant automatique du fichier de données. 
			Décochez "IDProduit".
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0004.jpg&type=thumb)
Passez à l'étape suivante.

	6. L'assistant propose ensuite de sélectionner la rubrique de tri. Cette rubrique va être utilisée pour trier les données affichées dans le champ Table. Les rubriques proposées dans l'assistant correspondent à des rubriques définies comme clés dans l'analyse. Nous allons trier les produits selon leur libellé. Cliquez sur la ligne "Libellé".
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0005.jpg&type=thumb)
Passez à l'étape suivante.

	7. Les étapes suivantes correspondent à des paramètres supplémentaires. Conservez les options par défaut jusqu'à la fin de l'assistant puis terminez l'assistant.

	8. Le champ Table est automatiquement créé dans la fenêtre. Le champ est automatiquement positionné et agrandi afin d'occuper tout l'espace disponible dans la fenêtre. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0007.jpg&type=thumb)








Arrêtons-nous un instant sur le champ que nous venons de créer : les données sont déjà affichées dans le champ, même sous l'éditeur. **C'est le concept du "Live data"** : le contenu des fichiers de données présents sur le poste de développement est utilisé dans les fenêtres ou les états manipulés sous l'éditeur. Cette fonctionnalité est très intéressante par exemple pour définir la taille des champs présents dans une fenêtre.
<a name="NOTE3_4"></a>


### Test de la fenêtre
<a name="test_fenetre_ELTPARAGRAPHE000169"></a>

- Nous allons tout de suite tester la fenêtre que nous venons de créer.

	1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_GO_Fenetre_WD_GAF.jpg)
 parmi les boutons d'accès rapide.

	2. La fenêtre apparaît automatiquement avec ses données en exécution.

	3. Vous pouvez faire défiler les produits grâce à l'ascenseur (ou à l'aide des flèches du clavier).







- Mettons-nous quelques instants à la place de l'utilisateur final pour voir les possibilités du champ Table en exécution. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0008.jpg&type=thumb)



Quelques remarques :

- Tout d'abord, en exécution le champ Table a le même aspect que sous l'éditeur : c'est la notion de WYSIWYG ("What You See Is What You Get") : ce que vous voyez correspond à ce que vous obtenez.

- Des petits pictogrammes apparaissent en haut des colonnes :

	- la double flèche indique que la colonne peut être triée (colonne "Référence" ou "Libellé" par exemple). ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0008%201.jpg)
Par exemple, cliquez deux fois successivement sur la colonne "Libellé" : les données affichées sont triées différemment. Une flèche à gauche de la colonne indique que la colonne est triée ainsi que le sens de tri.

	- la loupe indique qu'une recherche peut être réalisée directement dans la colonne. ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0008%202.jpg)
Par exemple, cliquez sur la loupe de la colonne "Référence". Une zone de saisie apparaît et vous permet de saisir la référence recherchée. Saisissez "REF-010". Automatiquement, le produit correspondant à cette référence est affiché. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0009.jpg)





- Un menu contextuel est disponible sur le champ Table et sur chacune de ses colonnes. Ce menu contextuel peut être affiché :

	- par un clic droit sur la colonne du champ Table.

	- par clic sur la flèche située à l'extrémité des entêtes de colonnes.







- Ce menu contextuel permet notamment d'exporter le contenu du champ Table au format Excel (ou OpenOffice.org Calc), au format Word (ou OpenOffice.org Writer), de l'imprimer, etc. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0010.jpg&type=thumb)





En quelques minutes, nous venons de voir et de tester quelques fonctionnalités qui sont automatiquement incluses avec le champ Table. Vous n'avez rien à programmer pour proposer ces fonctionnalités à vos utilisateurs. Ces fonctionnalités sont appelées "FAA" (Fonctionnalités Automatiques de votre Application).|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | De nombreux champs proposent des FAA par défaut. Si ces fonctionnalités ne doivent pas être proposées (pour des raisons de sécurité ou de confidentialité), il est possible de les désactiver sous l'éditeur ou par programmation. <br><br>Pour plus de détails, consultez [Fonctionnalités Automatiques de vos Applications (FAA)](../Editeurs/9000022.md). |



Avoir la liste des produits, c'est bien, mais pouvoir modifier un produit, c'est mieux. Maintenant, nous allons créer une fenêtre affichant le détail du produit afin de pouvoir le modifier.



- Fermez la fenêtre en cours de test grâce à la croix située en haut de l'écran. L'éditeur de WINDEV réapparaît.




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Création d'une fenêtre "Fiche produit"
<a name="creation_une_fenetre_fiche_produit_ELTTEXTE001146"></a>


### Création de la fenêtre
<a name="creation_fenetre_ELTPARAGRAPHE000227"></a>La fenêtre que nous allons créer est destinée à afficher les caractéristiques du produit sélectionné dans le champ Table. Ce type de fenêtre est appelé une "Fiche" simplement car elle correspond à une fiche descriptive de l'élément voulu. 

- Pour créer une fenêtre affichant le détail d'un produit :

	1. Ouvrez si nécessaire le projet "WD Application Complète".

	2. Créez une nouvelle fenêtre vierge.

		- Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Cr%E9er1_GAF.jpg)
 parmi les boutons d'accès rapide.

		- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Fenêtre" puis sur "Fenêtre". 

		- L'assistant de création d'une fenêtre se lance.

		- Dans l'onglet "Basée sur un modèle", choisissez "Utiliser : FENMOD_Modèle" et validez l'assistant.




3. La fenêtre de sauvegarde apparaît. Saisissez le titre de la fenêtre : "Fiche du produit". Le nom "FEN_Fiche_du_produit" est automatiquement proposé. 

4. Validez la fenêtre de sauvegarde.



<a name="NOTE4_2"></a>


### Création des champs de saisie
<a name="creation_des_champs_saisie_ELTPARAGRAPHE000248"></a>Dans notre cas, cette fenêtre "Fiche" va afficher le contenu des différentes rubriques présentes dans le fichier de données "Produit". 



- Pour créer les champs dans la fenêtre :

	1. Affichez si nécessaire le volet "Analyse" : sous le volet "Accueil", dans le groupe "Environnement", déroulez "Volets" et sélectionnez "Volets" puis "Analyse". Les différents fichiers de données décrits dans l'analyse "WD Application Complète" apparaissent dans le volet.

	2. Cliquez sur l'icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0001%201.jpg)
 à gauche du fichier de données "Produit" : les rubriques du fichier de données sont listées. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0001.jpg)


	3. Sélectionnez à l'aide de la souris l'ensemble des rubriques affichées dans le volet (sauf la rubrique "IDProduit"). Vous pouvez par exemple utiliser la multisélection en maintenant la touche Ctrl enfoncée.

4. Effectuez un "Drag and Drop" (glisser/déplacer) de ces rubriques vers la fenêtre que vous venez de créer. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0002.jpg&type=thumb)




- Repositionnez les champs dans la fenêtre et redimensionnez la fenêtre afin d'obtenir l'UI suivante : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0004.jpg)




<a name="NOTE4_3"></a>


### Création des boutons
<a name="creation_des_boutons_ELTPARAGRAPHE000292"></a>La fenêtre "FEN_Fiche_du_produit" va permettre d'ajouter un nouveau produit ou encore de modifier un produit présent dans la liste.

Nous allons tout de suite ajouter un bouton de validation et un bouton d'annulation.

- Pour créer le champ Bouton permettant de valider les données saisies :

	1. Sous le volet "Création", dans le groupe "Champs usuels", déroulez "Bouton" (cliquez sur la flèche située sous ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Bouton_GAF.jpg)
).

	2. La liste des boutons prédéfinis s'affiche.

	3. Cliquez sur "Valider" : la forme du champ Bouton apparaît sous la souris.

	4. Cliquez ensuite à droite des champs de saisie pour créer le champ Bouton.







- Ajoutez le champ Bouton permettant d'annuler la saisie en utilisant le même principe.

	1. Sous le volet "Création", dans le groupe "Champs usuels", déroulez "Bouton" (cliquez sur la flèche située sous ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Bouton_GAF.jpg)
).

	2. Dans la liste des boutons prédéfinis, cliquez sur "Annuler" : la forme du champ Bouton apparaît sous la souris.

	3. Cliquez ensuite en dessous du champ Bouton "Valider" pour créer le champ. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0005.jpg)







<a name="NOTE4_4"></a>


### Améliorations de l'UI de la fenêtre
<a name="ameliorations_fenetre_ELTPARAGRAPHE000343"></a>Cette fenêtre étant une fenêtre relativement simple, essayons d'améliorer son UI. De nombreux petits détails peuvent vite devenir gênants pour l'utilisateur, alors autant les traiter dès le début.

**Alignement des champs**

- Une des premières optimisations à faire consiste à aligner les champs et à leur donner la même taille :

	1. Sélectionnez le champ "Libellé" puis tous les autres champs de saisie de la fenêtre (par exemple en maintenant la touche Ctrl appuyée et en cliquant sur les différents champs). Le premier champ sélectionné va servir de référence pour la taille des autres champs.

	2. Dans le ruban, affichez le volet "Alignement" de WINDEV. Ce volet contient toutes les options d'alignement disponibles pour les champs. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0006.jpg&type=thumb)


	3. Nous voulons que les bords externes et internes des champs soient alignés. Cliquez sur l'option "Justifier (Int. et Ext.)". 
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | Si vous ne savez pas quel alignement choisir, survolez les différentes options proposées par le volet "Alignement" de WINDEV. Lors du survol avec la souris d'une option, les champs sélectionnés dans la fenêtre sont automatiquement positionnés et/ou redimensionnés en fonction de l'option survolée.<br><br>Si le positionnement vous convient, il suffit de cliquer sur l'option.<br><br>Si le positionnement ne vous convient pas, il suffit de ne plus survoler les options d'alignement : les champs sont replacés à leur position d'origine. |




![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0007.jpg)




**Redimensionnement de la fenêtre**

Maintenant que nous avons positionné tous les champs dans notre fenêtre, nous pouvons lui donner sa dimension définitive. Dans notre exemple, la fenêtre est encore un peu trop large. 

- Nous pourrions utiliser les poignées de redimensionnement, comme nous l'avons fait précédemment. Mais WINDEV offre également la possibilité de saisir directement les dimensions de la fenêtre. 

	1. Cliquez sur la fenêtre présente sous l'éditeur. La fenêtre est sélectionnée. 

	2. Dans la barre de message, saisissez la nouvelle dimension de la fenêtre. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0007%201.jpg)
Dans cet exemple, la dimension originale est 609 x 270, nous allons saisir par exemple 554 x 252.

	3. La fenêtre est automatiquement modifiée. Si cette modification ne vous convient pas, utilisez la combinaison de touches Ctrl + Z pour annuler.  







**Gestion des ancrages**

- Voyons maintenant le rendu visuel de notre fenêtre :

	1. Sous le volet "Modification", dans le groupe "Aperçu", cliquez sur "Aperçu". Ce mode d'exécution permet d'afficher uniquement l'interface de la fenêtre. Les différents codes ne sont pas exécutés.

	2. Agrandissez la fenêtre à l'aide de la poignée d'agrandissement au bas de la fenêtre. La position des champs n'est pas modifiée et la fenêtre affiche une grande zone vide. Pour remédier à ce problème, deux possibilités :

		- Interdire le redimensionnement de la fenêtre.

		- Gérer les ancrages, c'est-à-dire gérer le comportement des champs lors d'un redimensionnement de la fenêtre. C'est ce que nous allons faire. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0008.jpg&type=thumb)







- Pour cette fenêtre, nous allons définir les ancrages ensemble :

	1. Les champs Bouton "Valider" et "Annuler" doivent toujours être collés à droite.

		- Sélectionnez ces deux champs.

		- Affichez le menu contextuel (clic droit) et sélectionnez l'option "Ancrage".

		- Dans la fenêtre de définition des ancrages, sélectionnez l'option "Droite". ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0009.jpg)


		- Validez. 

- Des petites flèches rouges apparaissent sous l'éditeur indiquant que les champs sont ancrés à droite.

2. Les champs de saisie doivent s'agrandir en largeur :

	- Sélectionnez les 4 champs de saisie.

	- Affichez le menu contextuel (clic droit) et sélectionnez l'option "Ancrage".

	- Dans la fenêtre de définition des ancrages, sélectionnez l'option "Largeur" (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_MP%20-%20Ancrage%20fiche%20-%20HC%20N%B0004%202.jpg)
).

	- Validez.



<a name="NOTE4_6"></a>


### Affichage de la fiche depuis la liste des produits
<a name="affichage_fiche_depuis_liste_des_produits_ELTPARAGRAPHE000473"></a>Nous allons maintenant voir comment afficher la fiche du produit sélectionné dans la liste des produits. Le principe est simple : l'utilisateur sélectionnera le produit dans le champ Table et affichera le détail du produit grâce à un champ Bouton.



- Nous allons tout d'abord modifier la fenêtre "FEN_Menu" afin de créer un champ Bouton :

	1. Placez-vous sur la fenêtre "Menu" : cliquez sur le bouton "FEN_Menu" dans la barre des documents ouverts : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0011.jpg)


	2. Actuellement, le champ Table occupe la totalité de la fenêtre. Agrandissez la taille de la fenêtre vers la droite à l'aide des poignées de redimensionnement.

3. Diminuez la taille du champ Table :

	- Maintenez la touche Maj enfoncée. 

	- Réduisez le champ Table à l'aide de ses poignées de redimensionnement.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | L'utilisation de la touche Maj permet de ne pas prendre en compte les options d'ancrage des champs lors du redimensionnement. |








- Pour créer le champ Bouton permettant de visualiser le produit :

	1. Sous le volet "Création", dans le groupe "Champs usuels", déroulez "Bouton" (cliquez sur la flèche située sous ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Bouton_GAF.jpg)
).

	2. Dans la liste des champs Bouton prédéfinis, saisissez "Modifier" dans la zone de recherche. Cliquez sur "Bouton Modifier". La forme du champ apparaît sous la souris. Cliquez ensuite à droite du champ Table pour créer le champ Bouton. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0012.jpg&type=thumb)


	3. Faites un clic droit sur le champ que vous venez de créer. Dans le menu qui s'affiche, sélectionnez l'option "Code".

4. Dans la fenêtre de code qui apparaît, saisissez le code WLangage suivant dans l'événement "Clic sur" :
			
		```wl
		FEN_Fiche_du_produit.Ouvre()
		```

			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | Laissez-vous guider par l'assistance à la saisie de code (également appelée "complétion") : dès que vous allez taper le point à la suite du nom de la fenêtre, une liste déroulante va s'ouvrir proposant le nom de toutes les fonctions pouvant s'appliquer sur cette fenêtre. Il suffit de sélectionner le nom de la fonction au clavier ou à la souris. |





5. Examinons ce code WLangage : la fonction [&lt;Fenêtre&gt;.Ouvre](../WDLang1/1000023903.md) permet d'ouvrir la fenêtre "FEN_Fiche_du_produit". Nous avons déjà vu cette fonction dans la première partie de ce cours.

6. Enregistrez les modifications en cliquant sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Enregistrer_GAF.jpg)
 parmi les boutons d'accès rapide.

7. Fermez la fenêtre de code (cliquez sur la croix en haut à droite de l'éditeur de code).




Nous allons maintenant modifier la fenêtre "FEN_Fiche_du_produit" pour afficher le produit sélectionné dans le champ Table.

- Affichez la fenêtre "FEN_Fiche_du_produit" sous l'éditeur : cliquez sur le bouton correspondant dans la barre des documents ouverts.




- Pour afficher les données du produit :

	1. Affichez les événements associés à la fenêtre :

		- Dans la zone à côté de la fenêtre (appelée "Zone d'accueil"), faites un clic droit de souris.

		- Dans le menu contextuel qui s'affiche, sélectionnez "Code".

		- L'éditeur de code apparaît. Les événements WLangage associés à la fenêtre sont affichés. 




2. Dans l'événement "Fin d'initialisation de FEN_Fiche_du_produit", saisissez le code WLangage suivant :
			
		```wl
		// Affecte le contenu des rubriques aux champs
		Produit.VersFenêtre()
		```

			La fonction [&lt;Fichier de données&gt;.VersFenêtre](../WDLang4/1000021397.md) permet d'afficher dans les champs les données présentes dans le fichier de données, pour l'enregistrement en cours. Dans notre cas, l'enregistrement en cours sera l'enregistrement sélectionné dans le champ Table de la fenêtre "FEN_Menu".




1. Fermez la fenêtre de code.

2. Enregistrez la fenêtre (Ctrl + S).




- Affichez la fenêtre "FEN_Menu" sous l'éditeur : cliquez sur le bouton correspondant dans la barre des documents ouverts.




- Testez la fenêtre (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_GO_Fenetre_WD_GAF.jpg)
 parmi les boutons d'accès rapide).

	- Dans la liste des produits, cliquez sur un des produits avec la souris.

	- Cliquez sur le bouton "Modifier".

	- La fenêtre de détail du produit s'affiche.







- Fermez les différentes fenêtres de test en utilisant la croix (x) en haut à droite des fenêtres.




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Gestion de la modification d'un produit
<a name="gestion_modification_produit_ELTTEXTE001266"></a>
Nous allons maintenant modifier la fenêtre "FEN_Fiche_du_produit" afin de gérer la modification d'un produit.

Nous allons :

- permettre à l'utilisateur de modifier l'image du produit.

- ajouter des champs Bouton pour enregistrer ou annuler les modifications effectuées dans la fiche du produit.



<a name="NOTE5_2"></a>


### Modification de l'image du produit
<a name="modification_image_produit_ELTPARAGRAPHE000579"></a>L'utilisateur va pouvoir modifier l'image du produit dans la fiche Produit. Pour cela, nous allons lui proposer un champ Bouton "Modifier" situé en dessous de l'image du produit. Ce champ ouvrira un sélecteur de fichiers permettant de sélectionner l'image à utiliser.



- Tout d'abord, affichez si nécessaire la fenêtre "FEN_Fiche_du_produit" sous l'éditeur : cliquez sur le bouton correspondant dans la barre des documents ouverts.




- Pour créer le champ Bouton permettant de modifier l'image : 

	1. Sous le volet "Création", dans le groupe "Champs usuels", déroulez "Bouton". Dans la liste des champs Bouton prédéfinis que s'affiche, saisissez "Modifier" dans la zone de recherche. Cliquez sur "Bouton Modifier". 

	2. La forme du champ apparaît sous la souris. Cliquez ensuite dans la fenêtre, sous l'image du produit.

	3. Redimensionnez si nécessaire le champ Bouton (à l'aide des poignées) pour que le champ ait la même largeur que le champ Image.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | Lors du redimensionnement du champ, un effet de magnétisme automatique simplifie l'alignement du champ Bouton avec le champ Image. |




![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0001.jpg)


	4. Faites un clic droit sur le champ Bouton. Dans le menu qui s'affiche, sélectionnez l'option "Code".

5. Dans la fenêtre de code qui apparaît, saisissez le code WLangage suivant dans l'événement "Clic sur" :
			
		```txt
		fSélecteurImage(
		```

![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0002.jpg)




Nous testerons cette fonctionnalité lorsque la gestion des modifications effectuées dans la fiche sera finie.
<a name="NOTE5_3"></a>


### Validation des modifications du produit
<a name="validation_des_modifications_produit_ELTPARAGRAPHE000638"></a>Nous avons déjà créé 2 champs Bouton dans la fenêtre "FEN_Fiche_du_produit" :

- un champ Bouton "Valider" pour gérer la validation des modifications,

- un champ Bouton "Annuler" pour gérer le retour à la liste des produits.


Nous allons maintenant saisir le code WLangage nécessaire à leur fonctionnement.



- Tout d'abord, affichez si nécessaire la fenêtre "FEN_Fiche_du_produit" sous l'éditeur : cliquez sur le bouton correspondant dans la barre des documents ouverts.




- Nous allons maintenant saisir le code WLangage associé au champ Bouton "Valider".

	1. Faites un clic droit sur le champ Bouton puis sélectionnez l'option "Code" dans le menu contextuel.

	2. Dans l'événement "Clic sur", saisissez le code WLangage suivant :
			
		```wl
		EcranVersFichier()
		Produit.Modifie()
		Ferme()
		```

			Examinons ce code WLangage :

		- La fonction [EcranVersFichier](../WDLang4/3044146.md) permet d'initialiser les rubriques avec les valeurs des champs liés, pour l'enregistrement courant. Cette fonction est donc équivalente aux lignes suivantes :
						
			```wl
			Produit.Référence = SAI_Référence
			Produit.Libellé = SAI_Libellé
			Produit.Description = SAI_Description
			...
			```

						Notre fenêtre utilise moins de 10 champs et déjà l'avantage se fait sentir ; pensez simplement aux fenêtres qui contiennent plusieurs dizaines de champs : 1 seule ligne de code effectue toutes les affectations !

		- La fonction [&lt;Fichier de données&gt;.Modifie](../WDLang4/1000025038.md) permet de mettre à jour les données du fichier de données pour l'enregistrement courant.




3. Enregistrez les modifications en cliquant sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Enregistrer_GAF.jpg)
 parmi les boutons d'accès rapide.

4. Fermez la fenêtre de code (cliquez sur la croix en haut à droite de l'éditeur de code).




- Les modifications réalisées dans la fenêtre "FEN_Fiche_du_produit" doivent être prises en compte dans le champ Table listant les produits. Pour cela, nous allons simplement modifier le code WLangage associé au champ Bouton "Modifier" dans la fenêtre "FEN_Menu".

	1. Affichez la fenêtre "FEN_Menu" sous l'éditeur : cliquez sur le bouton correspondant dans la barre de boutons.

	2. Sélectionnez le champ Bouton "Modifier" et affichez l'éditeur de code (touche F2).

	3. Modifiez l'événement "Clic sur" de la manière suivante :
			
		```wl
		// Ouvre la fiche produit sur le produit sélectionné
		FEN_Fiche_du_produit.Ouvre()
		
		// Met à jour la ligne sélectionnée
		TABLE_Produit.Affiche(taCourantBandeau)
		```
Examinons ce code :

		- La fonction [&lt;Table&gt;.Affiche](../WDLang1/1000023505.md) permet de mettre à jour le champ Table, avec les données modifiées dans la fiche du produit.

		- La constante *taCourantBandeau* permet de spécifier que le champ Table doit être mis à jour à partir de la position du bandeau de sélection.




4. Enregistrez les modifications en cliquant sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Enregistrer_GAF.jpg)
 parmi les boutons d'accès rapide.

5. Fermez la fenêtre de code (cliquez sur la croix en haut à droite de l'éditeur de code).



<a name="NOTE5_4"></a>


### Test de la modification d'un produit
<a name="test_modification_produit_ELTPARAGRAPHE000699"></a>

- Pour tester la modification d'un produit :

	1. Lancez le test du projet (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_GO_Projet_WD_GAF.jpg)
 parmi les boutons d'accès rapide). 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Go_Projet_acces_rapide.jpg)


	2. WINDEV demande de sélectionner la première fenêtre du projet. Dans notre cas, cette fenêtre correspond à "FEN_Menu". Sélectionnez cette fenêtre et validez.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | La première fenêtre du projet correspond à la première fenêtre ouverte au lancement de l'application. La première fenêtre du projet peut être définie :<br><br>		- lors d'un test du projet,<br><br>		- lors de la création de l'exécutable,<br><br>		- sous le volet "Explorateur de projet" : il suffit de sélectionner la fenêtre voulue, d'afficher le menu contextuel et de sélectionner l'option "Première fenêtre du projet".<br><br><br>Lorsqu'une première fenêtre du projet est définie, un petit 1 rouge apparaît devant le nom de la fenêtre dans le volet "Explorateur de projet". |





3. Le projet se lance en mode test et la première fenêtre est affichée. 

4. Sélectionnez un produit dans la liste des produits (par exemple le premier) et cliquez sur le bouton "Modifier".

5. Le détail du produit sélectionné apparaît dans la fenêtre fiche.

6. Modifiez le prix de 100,23 et saisissez 200,00 puis ensuite cliquez sur le bouton "Valider".

7. De retour sur la liste des produits, vous pouvez constater que le prix de cet article a été mis à jour.

8. Affichez à nouveau le détail du produit.

9. Cliquez sur le bouton "Modifier" sous l'image. Le sélecteur d'images s'affiche. Sélectionnez une image et validez. L'image apparaît dans la fiche.

10. Cliquez sur le bouton "Annuler". La modification de l'image n'a pas été prise en compte dans le fichier de données.

11. Fermez l'application en cliquant sur la croix.




<a name="NOTE6"></a>
<a name="NOTE6_1"></a>


## Création d'un nouveau produit
<a name="creation_nouveau_produit_ELTTEXTE001362"></a>
Le principe de la création d'un produit va être le suivant :

- Dans la fenêtre de la liste des produits, nous allons ajouter un champ Bouton "Nouveau" qui va permettre d'ouvrir la fenêtre "Fiche du produit".

- Nous modifierons ensuite le code de la fenêtre "Fiche du produit" pour gérer l'ajout dans le fichier de données Produit.



<a name="NOTE6_2"></a>


### Ajout d'un champ Bouton
<a name="ajout_champ_bouton_ELTPARAGRAPHE000741"></a>

- Pour ajouter un champ Bouton "Nouveau" dans la fenêtre "FEN_Menu" :

	1. Affichez la fenêtre "FEN_Menu" sous l'éditeur : cliquez sur le bouton correspondant dans la barre des documents ouverts.

	2. Sous le volet "Création", dans le groupe "Champs usuels", déroulez "Bouton" et sélectionnez "Bouton Nouveau".

	3. La forme du champ apparaît sous la souris. Cliquez ensuite dans la fenêtre : le champ Bouton est créé.

	4. Positionnez le champ Bouton au-dessus du champ Bouton "Modifier" (si nécessaire modifiez la position du champ Bouton "Modifier"). 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0003.jpg&type=thumb)


	5. Modifiez le code WLangage de ce champ :

	- Faites un clic droit sur le champ Bouton "Nouveau" puis sélectionnez l'option "Code" dans le menu contextuel.

	- Dans l'événement "Clic sur", saisissez le code WLangage suivant :
						
			```wl
			Produit.RAZ()
			FEN_Fiche_du_produit.Ouvre()
			TABLE_Produit.Affiche(taCourantEnreg)
			```
Examinons ce code :

		- La fonction [RAZ](../WDLang4/1000025052.md) initialise les variables des rubriques du fichier de données "Produit" avec les valeurs par défaut pour gérer un nouvel enregistrement.

		- La fonction [Ouvre](../WDLang1/1000023903.md) permet d'ouvrir la fiche du produit pour saisir le nouvel enregistrement.

		- La fonction [Affiche](../WDLang1/3074003.md) permet de réafficher le champ Table. Dans ce code, la constante ***taCourantEnreg*** est utilisée pour réafficher le champ Table à partir de l'enregistrement courant.



<a name="NOTE6_3"></a>


### Ajout d'un nouvel enregistrement dans le fichier de données
<a name="ajout_nouvel_enregistrement_dans_fichier_donnees_ELTPARAGRAPHE000790"></a>

- Maintenant, nous allons modifier la fenêtre de la fiche du produit pour gérer l'ajout d'un nouvel enregistrement.

	1. Affichez la fenêtre "FEN_Fiche_du_produit" sous l'éditeur.

	2. Nous allons modifier le code WLangage associé au champ Bouton "Valider" :

		- Faites un clic droit sur le champ Bouton "Valider" puis sélectionnez l'option "Code" dans le menu contextuel.

		- Dans l'événement "Clic sur", remplacez le code WLangage existant par le code suivant :
						
			```wl
			EcranVersFichier()
			SI Produit..NouvelEnregistrement ALORS
				Produit.Ajoute()
			SINON
				Produit.Modifie()
			FIN
			Ferme()
			```
Examinons ce code WLangage :

			- La propriété [NouvelEnregistrement](../Proprietes/1000017090.md) permet de savoir si l'enregistrement en cours doit être créé.

			- Si la fonction [&lt;Fichier de données&gt;.RAZ](../WDLang4/1000025052.md) a été appelée précédemment, la propriété renvoie <u><u><u><u>Vrai</u></u></u></u> (cas du clic sur le bouton "Nouveau") et l'enregistrement doit être créé par la fonction [Ajoute](../WDLang4/1000024187.md).

			- Dans le cas contraire, l'enregistrement en cours existe déjà et doit être modifié par la fonction [&lt;Fichier de données&gt;.Modifie](../WDLang4/1000025038.md).

			- La fonction [&lt;Fichier de données&gt;.Ajoute](../WDLang4/1000024187.md) ajoute l'enregistrement dans le fichier de données. Cette fonction prend les valeurs en mémoire et écrit le contenu des rubriques du fichier dans le fichier de données lui-même. Les index sont immédiatement et automatiquement mis à jour. Ici, le fichier de données mis à jour est bien entendu le fichier de données "Produit".
										|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | Le code de test du nouvel enregistrement peut être remplacé par la fonction [&lt;Fichier de données&gt;.Enregistre](../WDLang4/1000024606.md). Cette fonction permet de tester si l'enregistrement est déjà présent dans le fichier de données, et selon le cas elle permet soit de l'ajouter, soit de le modifier. Le code devient alors :<br><br><pre><code>EcranVersFichier()<br>				Produit.Enregistre()<br>				Ferme()</code></pre><br> |








3. Enregistrez les modifications en cliquant sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Enregistrer_GAF.jpg)
 parmi les boutons d'accès rapide.

4. Fermez la fenêtre de code (cliquez sur la croix en haut à droite de l'éditeur de code).



<a name="NOTE6_4"></a>


### Test de l'ajout d'un produit
<a name="test_ajout_produit_ELTPARAGRAPHE000843"></a>

- Pour tester l'ajout d'un produit :

	1. Lancez le test du projet (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_GO_Projet_WD_GAF.jpg)
 parmi les boutons d'accès rapide).

	2. Dans la liste des produits, cliquez sur le bouton "Nouveau".

	3. Saisissez un nouveau produit avec les caractéristiques suivantes :

		- Référence : REF-337

		- Libellé : Surf WD

		- Description : Surf aux couleurs de WINDEV

		- Prix : 150 ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0004.jpg)





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | Lors de l'ajout ou de la modification d'un enregistrement, plusieurs types d'erreurs peuvent survenir : erreur de doublons, erreur d'intégrité, erreur de mot de passe, etc.<br><br>WINDEV propose plusieurs modes de gestion de ces erreurs :<br><br>- **le mode automatique** : pour chaque erreur rencontrée lors de la gestion des enregistrements de la base de données, une fenêtre spécifique est affichée à l'utilisateur. Cette fenêtre permet à l'utilisateur de modifier directement ses données.<br><br>- **le mode programmé avancé** : pour chaque erreur rencontrée lors de la gestion des enregistrements de la base de données, une procédure ou une fenêtre personnalisée de gestion des erreurs est appelée.<br><br><br><br><br>L'exemple didactique "WD Detection Erreurs HFSQL" livré avec WINDEV permet de tester ces différents modes de gestion des erreurs. Cet exemple peut être ouvert via la page d'accueil de WINDEV (Ctrl + &lt;), option "Ouvrir un exemple". |




<a name="NOTE6_5"></a>


### Visualiser les enregistrements saisis
<a name="visualiser_les_enregistrements_saisis_ELTPARAGRAPHE000885"></a>Les nouveaux enregistrements que nous avons saisis peuvent être visualisés immédiatement dans le champ Table de la fenêtre "FEN_Menu".

Mais dans certains cas, lors de tests par exemple, il peut être nécessaire de voir directement le contenu du fichier de données.

WINDEV propose un outil simple permettant de voir le contenu des fichiers de données pendant le développement de l'application (lorsque par exemple, les fenêtres de visualisation n'ont pas encore été créées). 

Cet outil s'appelle WDMAP. Nous allons l'utiliser pour voir le contenu du fichier de données Produit.

- Pour lancer WDMAP :

	1. Sous le volet "Outils", dans le groupe "Base de données", cliquez sur "WDMap". 

	2. Sélectionnez le fichier de données "Produit". Le contenu du fichier de données s'affiche. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0006.jpg&type=thumb)


	3. En triant les éléments par référence (cliquez sur l'entête de la colonne "Référence"), les deux enregistrements que nous avons ajoutés apparaissent.




| [Leçon précédente](../TutoWD/1410087521.md) | [Sommaire](../TutoWD/1410087560.md) | [Leçon suivante](../TutoWD/1410087533.md) |
| --- | --- | --- |




