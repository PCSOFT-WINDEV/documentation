
## Leçon 4.6. Imprimer une liste de clients
<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Ce que vous allez apprendre dans cette leçon
<a name="que_vous_allez_apprendre_dans_cette_lecon_ELTTEXTE000278"></a>


- Créer un état avec ruptures.

- Lancer l'impression d'un état.





|   |   |
| --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=dur%E9e.png)<br> | <br>Durée estimée : 20 mn |

| [Leçon précédente](../TutoWD/1410087536.md) | [Sommaire](../TutoWD/1410087560.md) | [Leçon suivante](../TutoWD/1410087538.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000325"></a>
Cette leçon permet d'imprimer une liste des clients, regroupés par pays et par département ou province. 

Pour cela, nous allons utiliser un état de type tableau, qui permet de représenter clairement une liste de données.

- Ré-ouvrez si nécessaire le projet que vous avez manipulé dans la leçon précédente. 

	1. Affichez la page d'accueil de WINDEV (Ctrl + &lt;).

	2. Dans la page d'accueil, cliquez sur "Tutoriel" puis dans la zone "Partie 4 - Application complète avec données", double-cliquez sur "Application complète - Exercice".

	3. WINDEV vous propose d'ouvrir le projet que vous avez manipulé dans la leçon précédente. Vous pouvez ouvrir le projet présent sur votre poste ou ouvrir le projet original. Choisissez "Ouvrir la copie locale". 





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=exemple-WD.png)<br> | Corrigé | Un projet corrigé est disponible. Ce projet contient les différents états créés dans cette leçon. Pour ouvrir le projet corrigé, dans la page d'accueil, cliquez sur "Tutoriel" puis dans la zone "Partie 4 - Application complète avec données", double-cliquez sur "Application complète - Corrigé". |







<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Création de l'état
<a name="creation_etat_ELTTEXTE000367"></a>


- Pour créer un état : 

	1. Cliquez sur le bouton ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_Cr%E9er1_GAF.jpg)
 parmi les boutons d'accès rapide.

	2. La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Etat" puis sur "Etat". L'assistant de création d'un état se lance. L'assistant de création d'un état propose plusieurs types d'états : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Appli%20compl%E8te%20-%20Imprimer%20liste%20clients%20-%20HC%20N%B0001.jpg&type=thumb)


	3. Sélectionnez "Tableau". Passez à l'étape suivante.

4. Sélectionnez la source des données de l'état. L'état va être basé sur le fichier de données Client. Sélectionnez "Un fichier de données ou une requête existante". 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Appli%20compl%E8te%20-%20Imprimer%20liste%20clients%20-%20HC%20N%B0002.jpg&type=thumb)
Passez à l'étape suivante.

5. Dans la liste des fichiers de données et des requêtes, sélectionnez le fichier de données "Client". Passez à l'étape suivante.

6. Définissez la clé de parcours du fichier de données. Dans notre cas, nous allons parcourir le fichier de données Client selon le nom complet du client. Sélectionnez la clé de parcours "NomComplet". 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Appli%20compl%E8te%20-%20Imprimer%20liste%20clients%20-%20HC%20N%B0003.jpg&type=thumb)
Passez à l'étape suivante.

7. Nous allons maintenant définir les options de tri des données dans l'état. Par défaut, l'assistant propose la rubrique utilisée comme clé de parcours du fichier de données. Comme nous voulons faire un état listant les clients par pays et par province (département), nous allons ajouter un tri sur ces deux rubriques.

8. Pour ajouter un tri sur le pays :

	- Cliquez sur le bouton "Ajouter" puis sélectionnez "Critère de tri" pour ajouter une rubrique de tri.

	- Dans la fenêtre qui s'affiche, sélectionnez la rubrique Client.Pays. ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Appli%20compl%E8te%20-%20Imprimer%20liste%20clients%20-%20HC%20N%B0004.jpg)


L'état est terminé. Nous allons immédiatement le tester pour voir le résultat.



- Exécutez cet état en cliquant sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_GO_Fenetre_WD_GAF.jpg)
 parmi les boutons d'accès rapide. La destination de l'impression peut être au choix : ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Appli%20compl%E8te%20-%20Imprimer%20liste%20clients%20-%20HC%20N%B0011.jpg)





- Choisissez "Visualisateur de rapports" et validez. L'état s'exécute et s'affiche dans le visualisateur de rapports. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Appli%20compl%E8te%20-%20Imprimer%20liste%20clients%20-%20HC%20N%B0012%201.jpg&type=thumb)





Vous pouvez imprimer directement la page en cours ou la totalité du document en cliquant sur l'imprimante (volet "Imprimer").

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Lancement de l'impression d'un état par programmation
<a name="lancement_impression_etat_par_programmation_ELTTEXTE000427"></a>
Notre état étant terminé, nous allons créer un menu dans notre fenêtre "FEN_Menu" pour lancer directement l'impression de cet état.

- Pour insérer un menu dans la fenêtre "FEN_Menu" :

	1. Affichez la fenêtre "FEN_Menu" sous l'éditeur (double-cliquez sur son nom dans le volet "Explorateur de projet" par exemple).

	2. Sous le volet "Fenêtre", dans le groupe "Barres et menus", déroulez "Menu principal" et sélectionnez l'option "Ajouter le menu principal".

	3. Un menu s'insère dans la fenêtre sous la barre de titre. Ce menu contient par défaut une option qui se nomme "Menu".

	4. Sélectionnez l'option "Menu" :

		- Affichez le menu contextuel (clic droit).

		- Sélectionnez l'option "Ajouter après".




5. Dans la zone de saisie, saisissez "Etats". 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Appli%20compl%E8te%20-%20Imprimer%20liste%20clients%20-%20HC%20N%B0013.jpg)




- Pour saisir le code WLangage de l'option "Liste des clients" :

	1. Sélectionnez l'option "Liste des clients" sous l'éditeur.

	2. Affichez le menu contextuel (clic droit).

	3. Sélectionnez l'option "Code". L'éditeur de code apparaît.

	4. Dans l'événement "Sélection du menu", saisissez le code suivant :
			
		```wl
		// L'impression se fait dans le visualisateur de rapports
		iDestination(iVisualisateur)
		
		// Imprime l'état
		ETAT_Liste_des_clients.Imprime()
		```
Examinons ce code :

		- La fonction [iDestination](../WDLang5/3046074.md) permet de paramétrer la destination de l'impression. Il est par exemple possible d'imprimer :

			- dans un fichier texte,

			- au format HTML,

			- au format PCL,

			- au format PDF, RTF, XLS, XML,

			- sur un fax.


 Dans notre cas, l'impression se fera dans la fenêtre du visualisateur de rapports.

- La fonction [&lt;Etat&gt;.Imprime](../WDLang5/1000024554.md) permet d'imprimer un état.




- Testez la fenêtre et ses options de menu en cliquant sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_GO_Fenetre_WD_GAF.jpg)
 parmi les boutons d'accès rapide.




- Nous allons maintenant finir ce menu en ajoutant une option pour quitter l'application.

	1. Sous l'éditeur, sélectionnez l'option "Menu".

	2. Dans le menu contextuel (clic droit), sélectionnez l'option "Transformer pour dérouler un sous-menu".

	3. Dans la zone de saisie qui s'affiche, saisissez "Quitter".

	4. Nous allons associer cette option de menu au raccourci clavier "Alt + F4" :

		- Sélectionnez l'option de menu "Quitter".

		- Dans le menu contextuel (clic droit), sélectionnez l'option "Description de l'option".

		- Dans l'onglet "Général", dans la zone "Raccourci clavier", sélectionnez "F4" et cochez "Alt". 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P4_Appli%20compl%E8te%20-%20Imprimer%20liste%20clients%20-%20HC%20N%B0015.jpg)


		- Validez.

5. Affichez le code WLangage de l'option et dans l'événement "Sélection du menu", saisissez le code WLangage suivant :
			
		```wl
		// Demande à l'utilisateur s'il souhaite quitter l'application
		SI OuiNon(Non, "Quitter l'application ?") = Oui ALORS
			// Fin de l'application
			FinProgramme()
		FIN
		```
Examinons ce code WLangage :

	- La fonction [OuiNon](../WDLang1/3021005.md) permet de dialoguer avec l'utilisateur en lui posant une question. L'utilisateur peut répondre à la question à l'aide de 2 boutons : oui ou non.

	- La fonction [FinProgramme](../WDLang1/3013033.md) (appelée si l'utilisateur clique sur "Oui") permet de terminer l'application.




- Testez la fenêtre en cliquant sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_GO_Fenetre_WD_GAF.jpg)
 parmi les boutons d'accès rapide.




| [Leçon précédente](../TutoWD/1410087536.md) | [Sommaire](../TutoWD/1410087560.md) | [Leçon suivante](../TutoWD/1410087538.md) |
| --- | --- | --- |




