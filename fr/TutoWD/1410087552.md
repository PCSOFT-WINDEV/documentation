
## Leçon 7.5. Evénement Windows
<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Ce que vous allez apprendre dans cette leçon
<a name="que_vous_allez_apprendre_dans_cette_lecon_ELTTEXTE000164"></a>


- Programmation des événements Windows.





|   |   |
| --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=dur%E9e.png)<br> | <br>Durée estimée : 10 mn |



| [Leçon précédente](../TutoWD/1410087551.md) | [Sommaire](../TutoWD/1410087560.md) | [Leçon suivante](../TutoWD/1410087553.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Introduction
<a name="introduction_ELTTEXTE000211"></a>
Toute action effectuée par Windows correspond à un événement Windows. Différents types d'événements peuvent être rencontrés, par exemple :

- Le survol d'une fenêtre par la souris, 

- L'arrêt du système,

- L'affichage d'une boîte de dialogue,

- Une erreur logicielle,

- Etc.




Lorsque ces événements se produisent, il est possible de les intercepter afin de préparer ou d'exécuter un traitement spécifique.

Par défaut, WINDEV propose la gestion automatique des événements les plus utilisés. Par exemple, les événements suivants sont automatiquement proposés pour un champ de saisie :

- Initialisation du champ,

- Entrée dans le champ,

- Modification du champ,

- Sortie du champ.




Pour gérer des événements supplémentaires, il est possible :

- soit d'utiliser les événements optionnels proposés par WINDEV.

- soit d'utiliser les événements Windows.



<a name="NOTE2_2"></a>


### Exemple pratique
<a name="exemple_pratique_ELTPARAGRAPHE000048"></a>Nous avons choisi de vous présenter la gestion des événements grâce à l'exemple unitaire "La fonction Evénement".



- Ouvrez l'exemple unitaire "La fonction Evénement". 




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Evénements optionnels proposés par WINDEV
<a name="evenements_optionnels_proposes_par_windev_ELTTEXTE000241"></a>
Pour chaque élément (fenêtre, champ, etc.), WINDEV propose de nombreux événements optionnels.



- Pour ajouter un événement optionnel :

	1. Affichez les événements WLangage associés au champ Liste présent dans la fenêtre de l'exemple unitaire :

		- Sélectionnez le champ Liste.

		- Appuyez sur la touche F2.

		- L'éditeur de code est affiché.




2. Cliquez sur le lien "Ajouter d'autres événements ..." : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P7_Exemple%20Ev%E9nement%20-%20HC%20N%B0001%201.jpg)




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Evénements de Windows
<a name="evenements_windows_ELTTEXTE000265"></a>
Pour la gestion d'événements plus "spécifiques", il existe la fonction WLangage [Evénement](../WDLang1/3015011.md). La fonction [Evénement](../WDLang1/3015011.md) permet d'associer une procédure WLangage à un événement Windows.|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=note.png)<br> | Note | Pour utiliser la fonction [Evénement](../WDLang1/3015011.md), il faut maîtriser la programmation Windows et notamment les événements Windows. |




Pour connaître la liste (non exhaustive) des événements Windows, consultez [Valeur des constantes de l'API Windows 32 bits](../AppelDLL/6510001.md).
<a name="NOTE4_2"></a>


### Exemple : Détecter le clic sur un champ Liste
<a name="exemple_detecter_clic_sur_champ_liste_ELTPARAGRAPHE000104"></a>

- Lancez le test de la fenêtre "FEN_Fonction_Evénement". Cette fenêtre détecte si le champ Liste est manipulé avec la souris ou avec le clavier.

	1. Cliquez sur le champ Liste avec la souris.

	2. Utilisez la souris pour déplacer le bandeau de sélection.

	3. Un message s'affiche indiquant si la souris ou le clavier a été utilisé. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=P7_Exemple%20Ev%E9nement%20-%20HC%20N%B0002.jpg)


	4. Arrêtez le test et revenez sous l'éditeur.




- Regardons le code utilisé :

	1. Cliquez dans la fenêtre.

	2. Affichez les événements de la fenêtre (appuyez sur la touche F2).

	3. Examinons l'événement "Déclarations globales" de la fenêtre FEN_Fonction_Evénement.

		- Tout d'abord la ligne de code :
						
			```wl
			EXTERNE “WINCONST.WL”
			```
Cette ligne de code permet d'intégrer le contenu du fichier WINCONST.WL dans le code de l'application grâce au mot-clé EXTERNE. Ce fichier contient la déclaration et les valeurs des constantes Windows. A la compilation, tout le code contenu dans le fichier WINCONST.WL sera automatiquement intégré au code de l'application. 

		- Ensuite, les différents événements gérés sont déclarés :
						
			```wl
			// Evénements sur le champ LISTE_Mois
			// Pression d'une touche du clavier
			Evénement(SourisOuClavier, LISTE_Mois.NomComplet, WM_KEYDOWN) 
			// Clic gauche de souris
			Evénement(SourisOuClavier, LISTE_Mois.NomComplet, WM_LBUTTONDOWN)
			```
La procédure ***SourisOuClavier*** est appelée dès qu'une utilisation du clavier sur le champ Liste est effectuée (événement Windows correspondant : WM_KEYDOWN) ou dès que le clic gauche de la souris est utilisé (événement Windows correspondant : WM_LBUTTONDOWN). 




4. La procédure ***SourisOuClavier*** est une procédure interne. Le code de cette procédure est présent dans la suite de l'événement "Déclarations globales". Ce code est très simple :

	- Si le clavier est utilisé, le libellé affiché sous le champ Liste contient "Sélection avec le clavier".

	- Si la souris est utilisée, le libellé affiché sous le champ Liste contient "Sélection avec la souris".
						
			```wl
			PROCEDURE INTERNE SourisOuClavier()
			// La variable _EVE.wMessage contient le numéro du message
			SELON _EVE.wMessage
				// C'est le clavier
				CAS WM_KEYDOWN
					// Message indiquant l'utilisation du clavier
					LIB_TypeSélection = “Sélection avec le clavier”
					LIB_TypeSélection.Couleur = RougeClair
					
				// C'est la souris
				CAS WM_LBUTTONDOWN	
					// Message indiquant l'utilisation de la souris
					LIB_TypeSélection = “Sélection avec la souris”
					LIB_TypeSélection.Couleur = BleuClair	
			FIN
			```





| [Leçon précédente](../TutoWD/1410087551.md) | [Sommaire](../TutoWD/1410087560.md) | [Leçon suivante](../TutoWD/1410087553.md) |
| --- | --- | --- |




