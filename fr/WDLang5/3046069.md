
## iAperçu (Fonction)

***En anglais : iPreview***

<DIV class="specObsolete">
	<IMG style="float:left;margin-right:10px;" src="https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=warning_big.png"><B>Avertissement</B><BR>
	A partir de la version <B>25</B>,  la fonction [iDestination](../WDLang5/3046074.md) doit être privilégiée. Cette fonction propose une impression via le visualisateur de rapports (appelé aperçu avant impression dans les versions précédentes), via la mini-fenêtre d'aperçu, ainsi que toutes les destinations d'impression.  
</DIV><a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Paramètre la fenêtre d'aperçu avant impression. Il est possible d'imprimer :

- directement sur l'imprimante (syntaxe 1). 

- dans une [fenêtre d'aperçu](../WDChamp/1011085.md) (syntaxe 2). L'utilisateur peut ainsi visualiser le résultat de l'impression à l'écran, page par page. Dans cette fenêtre, il est possible de :

	- faire défiler les pages (page suivante et page précédente si elles existent),

	- lancer l'impression,

	- modifier l'échelle de l'aperçu,

	- afficher la première ou la dernière page,

	- connaître le numéro de la page en cours, ...




- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) dans une [mini-fenêtre d'aperçu](../WDChamp/1011094.md) (syntaxe 3). Ce mini-aperçu permet dans un seul écran de visualiser la page ou les pages à imprimer, de définir l'imprimante à utiliser, l'utilisation ou non de la couleur, le nombre de copies, ... 







|   |
| --- |
| **Remarque de compatibilité** |
| Dans les versions précédentes, la fonction **iAperçu** permettait également de choisir la destination de l'impression. Ces syntaxes ont été conservées pour compatibilité mais la fonction [iDestination](../WDLang5/3046074.md) doit être désormais privilégiée pour cet usage. |



**Remarque** : Par défaut, si les ressources du poste en cours deviennent critiques pour afficher la totalités des pages dans l'aperçu, un message d'avertissement est affiché par défaut (à partir de 1000 pages). Il est possible de ne pas afficher le message ou de paramétrer le nombre de pages avant l'affichage de ce message grâce à la fonction [iParamètreAperçu](../WDLang5/3046001.md).


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003046069&name=iapercu_fonction&product=WD">Voir des exemples supplémentaires</a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Impression dans un aperçu en configurant le titre de la fenêtre d'aperçu
SI iConfigure() = Vrai ALORS iAperçu(iPage, "Liste des fonctions")
```


<a name="Exemple2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Ouverture de l'aperçu : 
// au premier lancement : aperçu en zoom arrière
// aux autres lancements : en conservant les valeurs du dernier aperçu
iAperçu()
```


<a name="Exemple3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Ouverture du mini aperçu 
iAperçu(iMiniAperçu)
```





<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Imprimer directement sur l'imprimante

`iAperçu([<Destination> [, <Nom du document>]])`
---

**`<Destination> : (Constante optionnelle de type entier)`**

Destination de l'impression.


|   |   |
| --- | --- |
| *iImprimante* | Impression directe sur l'imprimante<br> |



**`<Nom du document> : (Chaîne de caractères optionnelle)`**

Nom à donner à l'impression. Ce nom permettra d'identifier l'impression dans la liste des documents traités par l'imprimante. 


<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Imprimer dans une fenêtre d'aperçu

`iAperçu([<Zoom> [, <Titre de la fenêtre d'aperçu> [, <Boutons d'impression> [, <Position horizontale> [, <Position verticale> [, <Largeur> [, <Hauteur>]]]]]]])`
---

**`<Zoom> : (Constante optionnelle de type entier)`**

Zoom à l'ouverture de la fenêtre d'aperçu.


|   |   |
| --- | --- |
| *i2Pages*<br>*iapZoom2Pages* | Aperçu affichant 2 pages en même temps. |
| *i100*<br>*iapZoom100* | Aperçu avec un zoom de 100%. |
| *iapZoomLargeurPage* | Aperçu affichant la largeur entière de la page. |
| *iPage*<br>*iapZoomPage* | Aperçu en zoom arrière : la page sera totalement affichée dans la fenêtre de zoom. |
| *iZoomDéfaut*<br>*iapZoomDéfaut*<br>(valeur par défaut) | Correspond :<br><br>- lors d'une première utilisation, à *iapZoomPage*.<br><br>- lors des utilisations suivantes, au dernier zoom défini par l'utilisateur dans l'aperçu avant impression.<br><br><br> |
| Valeur de 10 à 999 | Aperçu avec le zoom indiqué. |





Si ce paramètre n'est pas précisé, la valeur prise par défaut correspond :

- lors de la première utilisation de la fonction, à *iapZoomPage*.

- lors des utilisations suivantes, au zoom défini par l'utilisateur dans l'aperçu avant impression.




**`<Titre de la fenêtre d'aperçu> : (Chaîne de caractères optionnelle)`**

Titre affiché dans la barre de titre de la fenêtre. Si ce paramètre n'est pas précisé, le titre par défaut correspondra à "Prévisualisation de l'état " suivi du nom de l'état. 
Si l'utilisateur a la possibilité de générer des fichiers (Word, PDF, ...) depuis le visualisateur de rapports, le titre de l'aperçu sera automatiquement proposé comme nom de fichier. Si ce paramètre n'est pas précisé, le nom du fichier correspondra au nom de l'état.

**`<Boutons d'impression> : (Booléen optionnel)`**



- <u><u><u><u>Vrai</u></u></u></u> (par défaut) pour afficher les boutons permettant à l'utilisateur de lancer l'impression, 

- <u><u><u><u>Faux</u></u></u></u> pour ne pas afficher les boutons.




**`<Position horizontale> : (Entier optionnel)`**

Position horizontale de la fenêtre d'aperçu (en pixels). Par défaut, la position horizontale correspond à 100 pixels.

**`<Position verticale> : (Entier optionnel)`**

Position verticale de la fenêtre d'aperçu (en pixels). Par défaut, la position verticale correspond à 100 pixels.

**`<Largeur> : (Entier optionnel)`**

Dimensions de la fenêtre d'aperçu (en pixels). Par défaut, les dimensions de cette fenêtre sont 640 (largeur) et 480 (hauteur).

**`<Hauteur> : (Entier optionnel)`**

Dimensions de la fenêtre d'aperçu (en pixels). Par défaut, les dimensions de cette fenêtre sont 640 (largeur) et 480 (hauteur).  


<a name="SYNTAXE3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Imprimer dans une mini-fenêtre d'aperçu

`iAperçu([<Destination> [, <Titre de la mini-fenêtre d'aperçu>]])`
---

**`<Destination> : (Constante de type entier)`**

Destination de l'impression : 


|   |   |
| --- | --- |
| *iMiniAperçu*<br> | Affiche l'impression dans une mini-fenêtre d'aperçu. |



**`<Titre de la mini-fenêtre d'aperçu> : (Chaîne de caractères optionnelle)`**

Titre affiché dans la barre de titre de la mini-fenêtre d'aperçu. 
Si ce paramètre n'est pas précisé, le titre par défaut correspondra à "Prévisualisation de l'état " suivi du nom de l'état. 
Si l'utilisateur a la possibilité de générer des fichiers (Word, PDF, ...) depuis le mini-aperçu avant impression, le titre de l'aperçu sera automatiquement proposé comme nom de fichier. Si ce paramètre n'est pas précisé, le nom du fichier correspondra au nom de l'état.





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Quand utiliser la fonction iAperçu ? 
<a name="quand_utiliser_fonction_iapercu_ELTPARAGRAPHE000212"></a>La fonction **iAperçu** doit être la première fonction d'impression appelée. Elle doit donc figurer avant les fonctions [iImprime](../WDLang5/3046031.md), [iCréePolice](../WDLang5/3046045.md), etc. Mais la fonction **iAperçu** doit être appelée **après** les fonctions [iConfigure](../WDLang5/3046072.md) ou [iParamètre](../WDLang5/3046008.md).

Remarque : La fonction [iDestination](../WDLang5/3046074.md) doit être appelée avant l'exécution d'un état (avec [iImprimeEtat](../WDLang5/3046032.md)) pour choisir la destination de l'exécution de l'état.


<a name="NOTE0_11"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Aperçu avant impression
<a name="apercu_avant_impression_ELTPARAGRAPHE000248"></a>**1. Personnalisation de la fenêtre d'aperçu**
WINDEV offre la possibilité de personnaliser l'interface de la fenêtre d'aperçu avant impression de votre projet. Il est possible :

- soit de personnaliser uniquement les boutons affichés dans la fenêtre (fonction [iParamètreAperçu](../WDLang5/3046001.md)).

- soit de personnaliser entièrement la fenêtre d'aperçu (utilisation d'un gabarit, ...). Pour plus de détails, consultez [Personnaliser la fenêtre d'aperçu avant impression](../WDChamp/2024002.md).


Remarque : Si l'aperçu avant impression donne la possibilité d'envoyer un email, il est possible de paramétrer les caractéristiques de l'email grâce à la fonction [iParamètreExport](../WDLang5/1000017026.md).

**2. Valeurs de zoom**

- Il est déconseillé de donner une valeur de zoom inférieure à 33%, sinon les boutons de la fenêtre d'aperçu seront totalement écrasés et illisibles.

- En mode "zoom arrière", selon la police demandée (par exemple, certaines polices ayant une taille inférieure à 14), la police utilisée par Windows pour afficher le texte n'est pas proportionnelle à la police d'impression. Cela se traduit par un affichage "incorrect"; cependant, l'impression sur papier sera correcte.




**3. Abandon de visualisation**
Lors de la visualisation d'un état, les fonctions [iImprime](../WDLang5/3046031.md) et [iImprimeMot](../WDLang5/3046034.md) retournent <u><u><u><u>Faux</u></u></u></u> si l'utilisateur a cliqué sur le bouton "Abandon". Pour tester l'abandon de la visualisation, il suffit d'écrire:

```wl
SI iImprime(Texte) = Faux ALORS RETOUR
```

<a name="NOTE0_12"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Fin d'impression
<a name="fin_impression_ELTPARAGRAPHE000293"></a>La fonction [iFinImprime](../WDLang5/3046053.md) doit nécessairement être appelée pour terminer l'édition sauf après un appel à la fonction [iImprimeEtat](../WDLang5/3046032.md).

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) La fonction [iFinImprime](../WDLang5/3046053.md) annule la visualisation à l'écran.

Les prochaines impressions seront effectuées sur l'imprimante, sauf si la fonction **iAperçu** est à nouveau exécutée.

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Il ne faut pas appeler la fenêtre de configuration (fonction [iConfigure](../WDLang5/3046072.md)) entre deux sorties d'écrans successives sans avoir préalablement appelé la fonction [iFinImprime](../WDLang5/3046053.md).
<a name="NOTE0_13"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Polices imprimantes
<a name="polices_imprimantes_ELTPARAGRAPHE000330"></a>Les constructeurs d'imprimante installent des polices sur les imprimantes. Ces polices sont appelées police "imprimante". Au contraire des polices logicielles (telles que "True Type"), ces polices sont directement accessible par l'imprimante, elles n'ont pas besoin d'être téléchargées.

Dans les listes des polices, les polices imprimantes sont identifiées par une icône "imprimante" présent devant le nom de la police.

Si vous utilisez des polices d'imprimante, ces polices ne sont interprétées que par l'imprimante.

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Attention** : l'utilisation de polices d'imprimante peut entraîner des effets d'affichage en aperçu avant impression. Lors de l'aperçu avant impression, l'affichage des polices est géré par Windows. Ne sachant pas gérer ces polices spécifiques, Windows utilise la police écran la plus proche pour l'aperçu avant impression.

**Exemple** : Le code suivant imprime des codes barres sur l'imprimante, mais à l'écran il y a du texte.


```wl
iAperçu(iPage)
iCréePolice(1, 20, iNormal, "Interleaved 2of5", Noir, 0)
iCréePolice(2, 20, iNormal, "UPC/EAN", Noir, 0)
iImprime(iPolice(1) + "Test police imprimante")
iImprime(iPolice(2) + "Test police imprimante")
iFinImprime()
```



<a name="NOTE0_14"></a>


### Ré-exécution de l'état
<a name="reexecution_etat_ELTPARAGRAPHE000507"></a>L'état affiché dans le visualisateur de rapports est automatiquement ré-exécuté lorsque l'état est imprimé ou exporté depuis le visualisateur de rapports. Les événements WLangage associés à l'état sont ré-exécutés. 

Dans ce cas, les données affichées dans l'état peuvent être modifiées (prise en compte de données modifiées par d'autres utilisateurs par exemple).

Il est conseillé d'initialiser les variables utilisées par l'état dans le code d'initialisation de l'état (et non dans le champ Bouton qui lance le visualisateur de rapports).

**Remarque** : Les fonctions WLangage utilisées dans votre état peuvent renvoyer un résultat différent lors de la ré-exécution de l'état. Par exemple, si des fonctions WLangage de votre état manipulent la fenêtre en cours, lors de la ré-exécution de l'état, la fenêtre en cours correspondra à la fenêtre du visualisateur de rapports.

<a name="XComposante"></a>

## Classification Métier / UI :
Code neutre
## Composante :
wd280prn.dll
