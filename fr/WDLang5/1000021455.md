


## &lt;Variable gglConnexion&gt;.Connecte (Fonction)

***En anglais : &lt;gglConnection variable&gt;.Connect***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Permet de s'authentifier auprès d'un serveur Google (via le mode d'authentification "OAuth 2.0"). Cette fonction est automatiquement exécutée lors de l'exécution d'une fonction Gglxxx. 

**Remarques** : 

- Il est conseillé d'utiliser la fonction **&lt;Variable gglConnexion&gt;.Connecte** (syntaxe 2) pour regrouper les demandes d'autorisations faites par Google. 

- La déconnexion est automatiquement effectuée à la fermeture de l'application. 



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Connexion utilisant le mode d'authentification "OAuth 2.0"
Cnx est un gglConnexion
Cnx.Email = "email_utilisateur_final@gmail.com"
Cnx.ClientID = "387756281032-qffa6dajjd5348iqhi558dkd98xxxxxx.apps.googleusercontent.com" 
Cnx.ClientSecret = "S13DCA6KkYh1EgPv9-jLxxxh" 
// Lors de la connexion, l'utilisateur devra valider les services utilisés
// (Consultez les exemples supplémentaires pour plus de détails)
SI Cnx.Connecte() = Faux ALORS
	Erreur(ErreurInfo())
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Se connecter avec l'authentification de base

`<Résultat> = <Connexion Google>.Connecte()`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'authentification a été réalisée, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Connexion Google> : (Variable de type gglConnexion)`**

Nom de la variable de type [gglConnexion](../WDLang5/1000018009.md) à utiliser.


<a name="SYNTAXE2"></a>

### Se connecter en spécifiant les services utilisés

`<Résultat> = <Connexion Google>.Connecte(<Service Google>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'authentification a été réalisée, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Connexion Google> : (Variable de type gglConnexion)`**

Nom de la variable de type [gglConnexion](../WDLang5/1000018009.md) à utiliser.

**`<Service Google> : (Constante ou combinaison de constantes de type entier)`**

Service Google à activer (l'application doit accéder à ces services) : 


|   |   |
| --- | --- |
| *gglServiceAgenda* | Service "Agenda Google Calendar" : Agenda Google |
| *gglServiceContacts* | Service "Google Contacts" : Gestion des contacts Google |
| *gglServiceDocuments* | Service "Google Documents List" : Gestion des documents |
| *gglServicePicasa* | Service "Picasa" |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Cas d'erreurs possibles : 
<a name="cas_erreurs_possibles_ELTPARAGRAPHE000261"></a>

- La connexion Internet n'est pas valide.

- L'authentification n'a pas pu être réalisée correctement.



<a name="NOTE0_2"></a>


### Pré-requis pour l'authentification OAuth 2.0 
<a name="prerequis_pour_authentification_oauth_20_ELTPARAGRAPHE000276"></a>Pour se connecter avec l'authentification OAuth 2.0, il est nécessaire de déclarer l'application sur votre console développeur Google : [https://developers.google.com/console](https://developers.google.com/console). 
Dans la console : 

1. Cliquez sur "Créer un projet". Donnez le nom de votre projet. Un identifiant est automatiquement proposé pour votre projet. 

2. Validez

3. Le projet est créé. 

4. Dans le menu de gauche, cliquez sur "API et authentification" puis sur "API". 

5. Choisissez les services dont l'application a besoin : 

	- Pour l'accès aux agendas, choisissez "Calendar API" (catégorie "Google Apps APIs"). 

	- Pour l'accès aux contacts, choisir "Contacts API" (catégorie "Google Apps APIs"). 

	- Pour l'accès aux documents Google, choisir "Drive API" (catégorie "Google Apps APIs"). 

	- Pour l'accès aux albums Picasa et aux documents, aucune API spécifique n'est à sélectionner. 




6. Dans le menu de gauche, cliquez sur "Identifiants". 

7. Cliquez ensuite sur le bouton "Créer un identifiant client". 

	- Sélectionnez le type d'application "Application installée".

	- A la première création de l'identifiant client, il est nécessaire de configurer l'écran d'autorisation.   

	- Dans l'écran d'autorisation, dans la zone "Nom de produit", saisissez par exemple le nom de votre application. 

	- Cliquez sur "Enregistrer". 

	- L'écran de création de l'identifiant client s'affiche à nouveau. 

		- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Pour les applications WINDEV, sélectionnez "Application installée" puis "Autre".




- Validez. Les identifiants client sont créés : 

	- Identifiant client. Cet identifiant est à conserver. Il sera utilisé dans la variable de type [gglConnexion](../WDLang5/1000018009.md). 

	- Code secret du client. Cet identifiant est à conserver. Il sera utilisé dans la variable de type [gglConnexion](../WDLang5/1000018009.md). 

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) URI de redirection. Vérifiez que "http://localhost" est précisé. 



<a name="NOTE0_3"></a>


### Authentification OAuth 2.0
<a name="authentification_oauth_20_ELTPARAGRAPHE000355"></a>L'appel à la fonction **&lt;Variable gglConnexion&gt;.Connecte** provoque : 

1. L'ouverture d'une fenêtre de login pour l'utilisateur final. Si la propriété **Email** de la variable [gglConnexion](../WDLang5/1000018009.md) est spécifiée, Google pré-remplit la fenêtre de connexion avec l'adresse email indiquée. Si l'utilisateur est déjà connecté, la fenêtre de login ne s'affiche pas. 

2. L'ouverture de la fenêtre d'autorisation. L'utilisateur final doit autoriser l'application à accéder à son compte. Cette fenêtre se ferme automatiquement lorsque l'utilisateur accepte ou annule. 




Remarques :

- Si la syntaxe 1 est utilisée (connexion avec authentification de base), une fenêtre d'autorisation sera affichée à chaque tentative d'accès à un nouveau service. 

- Si la syntaxe 2 est utilisée (connexion en spécifiant les services utilisés), une fenêtre d'autorisation sera affichée pour tous les services demandés au début de l'application. 

- La fenêtre d'autorisation peut être affichée uniquement au premier lancement de l'application si la persistance de la connexion est gérée (voir paragraphe suivant). 





<a name="NOTE0_4"></a>


### Persistance de la connexion
<a name="persistance_connexion_ELTPARAGRAPHE000401"></a>Lors de la connexion aux services Google, les tokens d'authentification ne sont pas sauvegardés. Il est donc nécessaire de se re-loguer et de ré-autoriser l'accès à l'application à chaque exécution de l'application (c'est-à-dire à chaque fois qu'une variable [gglConnexion](../WDLang5/1000018009.md) "vierge" est utilisée). 

Pour que l'autorisation d'accès de l'application soit persistante, il suffit de passer par les fonctions de sérialisation du WLangage. 

Exemple de mise en place de la persistance en utilisation un fichier XML : 

```wl
soit sFichierPersistanceAuth = SysRep(srAppDataLocal) + [fSep] + "authggl.xml"

cnx est une gglConnexion 
// Si connexion déjà effectuée
SI fFichierExiste(sFichierPersistanceAuth) ALORS 
	// Restauration de la connexion 
	soit bufDésérialise = fChargeBuffer(sFichierPersistanceAuth) 
	Désérialise(cnx, bufDésérialise, psdXML) 
SINON 
	// Nouvelle connexion 
	cnx.Email = "email@gmail.com" 
	cnx.ClientID = "387756281032-qffa6dajjd5348iqhi558xxxxxxxx.apps.googleusercontent.com" 
	cnx.ClientSecret = "Sxxxxx-jLMwwh" 
FIN 

SI cnx.Connecte(gglServiceAgenda) ALORS 
	// Sauvegarde de la connexion pour réutilisation future 
	bufSérialise est un Buffer 
	Sérialise(cnx, bufSérialise, psdXML) 
	fSauveBuffer(sFichierPersistanceAuth, bufSérialise) 
FIN
```

Remarque : Il est possible de vider les tokens d'authentification d'une variable de type **gglConnexion** grâce à la fonction [&lt;Variable gglConnexion&gt;.Déconnecte](../WDLang5/1000021459.md). 

<a name="XComposante"></a>

## Composante :
wd280ggl.dll
