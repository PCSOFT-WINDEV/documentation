
## gglConnexion (Type de variable)

***En anglais : gglConnection ***
				



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Le type **gglConnexion** permet de décrire une connexion aux services Google et de gérer l'authentification auprès des différents services. Les caractéristiques de cette connexion peuvent être définies et modifiées à l'aide de différentes propriétés WLangage.

**Remarque** : Pour plus de détails sur la déclaration de ce type de variable et l'utilisation des propriétés WLangage, consultez [Déclaration d'une variable](../Motscles/1514032.md).
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Connexion
Cnx est un gglConnexion
Cnx.Email = "email_utilisateur_final@gmail.com"
Cnx.ClientID = "387756281032-qffa6dajjd5348iqhi558dkd98xxxxxx.apps.googleusercontent.com" 
Cnx.ClientSecret = "S13DCA6KkYh1EgPv9-jLxxxh" 
SI GglConnecte(Cnx) = Faux ALORS
	Erreur(ErreurInfo())
FIN
```

<a name="XSYNTAXE"></a>


<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques




### Propriétés spécifiques à la description des variables de type gglConnexion
<a name="proprietes_specifiques_description_des_variables_type_gglconnexion_ELTPARAGRAPHE000032"></a>Les propriétés suivantes peuvent être utilisées pour manipuler une connexion Google :

| Nom | Type manipulé | Effet |
| --- | --- | --- |
| ClientID | Chaîne de caractères | Identifiant client donné lors de la déclaration de l'application dans la console Google. |
| ClientSecret | Chaîne de caractères | Code secret du client donné lors de la déclaration de l'application dans la console Google. |
| Email | Chaîne de caractères | Email du client final. Cette propriété n'est pas obligatoire. Cette propriété permet de pré-renseigner la fenêtre de login du client à son compte Google. <br><br>Attention : Cette propriété ne permet pas de récupérer l'adresse email du compte authentifié. |










<a name="NOTE0_2"></a>


### Pré-requis pour l'authentification OAuth 2.0 
<a name="prerequis_pour_authentification_oauth_20_ELTPARAGRAPHE000200"></a>Pour se connecter avec l'authentification OAuth 2.0, il est nécessaire de déclarer l'application sur votre console développeur Google : [https://developers.google.com/console](https://developers.google.com/console). 
Dans la console : 

1. Cliquez sur "Créer un projet". Donnez le nom de votre projet. Un identifiant est automatiquement proposé pour votre projet. 

2. Validez

3. Le projet est créé. 

4. Dans le menu de gauche, cliquez sur "API et authentification" puis sur "API". 

5. Choisissez les services dont l'application a besoin : 

	- Pour l'accès aux agendas, choisissez "Calendar API" (catégorie "Google Apps APIs"). 

	- Pour l'accès aux contacts, choisir "Contacts API" (catégorie "Google Apps APIs"). 

	- Pour l'accès aux documents Google, choisir "Drive API" (catégorie "Google Apps APIs"). 

	- Pour l'accès aux albums Picasa et aux documents, aucune API spécifique n'est à sélectionner. 




6. Dans le menu de gauche, cliquez sur "Identifiants". 

7. Cliquez ensuite sur le bouton "Créer un identifiant client". 

	- Sélectionnez le type d'application "Application installée".

	- A la première création de l'identifiant client, il est nécessaire de configurer l'écran d'autorisation.   

	- Dans l'écran d'autorisation, dans la zone "Nom de produit", saisissez par exemple le nom de votre application. 

	- Cliquez sur "Enregistrer". 

	- L'écran de création de l'identifiant client s'affiche à nouveau. 

		- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Pour les applications WINDEV, sélectionnez "Application installée" puis "Autre".




- Validez. Les identifiants client sont créés : 

	- Identifiant client. Cet identifiant est à conserver. Il sera utilisé dans la variable de type [gglConnexion](../WDLang5/1000018009.md). 

	- Code secret du client. Cet identifiant est à conserver. Il sera utilisé dans la variable de type [gglConnexion](../WDLang5/1000018009.md). 

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) URI de redirection. Vérifiez que "http://localhost" est précisé. 





<a name="NOTE0_3"></a>


### Persistance de la connexion
<a name="persistance_connexion_ELTPARAGRAPHE000279"></a>Lors de la connexion aux services Google, les tokens d'authentification ne sont pas sauvegardés. Il est donc nécessaire de se re-loguer et de ré-autoriser l'accès à l'application à chaque exécution de l'application (c'est-à-dire à chaque fois qu'une variable [gglConnexion](../WDLang5/1000018009.md) "vierge" est utilisée). 

Pour que l'autorisation d'accès de l'application soit persistante, il suffit de passer par les fonctions de sérialisation du WLangage. 

Exemple de mise en place de la persistance en utilisation un fichier XML : 

```wl
soit sFichierPersistanceAuth = SysRep(srAppDataLocal) + [fSep] + "authggl.xml"

cnx est une gglConnexion
// Si connexion déjà effectuée
SI fFichierExiste(sFichierPersistanceAuth) ALORS 
	// Restauration de la connexion 
	soit bufDésérialise = fChargeBuffer(sFichierPersistanceAuth) 
	Désérialise(cnx, bufDésérialise, psdXML) 
SINON 
	// Nouvelle connexion 
	cnx.Email = "email@gmail.com" 
	cnx.ClientID = "387756281032-qffa6dajjd5348iqhi558xxxxxxxx.apps.googleusercontent.com" 
	cnx.ClientSecret = "Sxxxxx-jLMwwh" 
FIN 

SI GglConnecte(cnx, gglServiceAgenda) ALORS 
	// Sauvegarde de la connexion pour réutilisation future 
	bufSérialise est un Buffer 
	Sérialise(cnx, bufSérialise, psdXML) 
	fSauveBuffer(sFichierPersistanceAuth, bufSérialise) 
FIN
```

Remarque : Il est possible de vider les tokens d'authentification d'une variable de type **gglConnexion** grâce à la fonction [GglDéconnecte](../WDLang5/1000021451.md). 


<a name="NOTE0_4"></a>


### Fonctions utilisant une variable de type gglConnexion
<a name="fonctions_utilisant_une_variable_type_gglconnexion_ELTPARAGRAPHE000083"></a>Toutes les fonctions de communication avec les services Google prennent en paramètre une variable de type **gglConnexion**.



|   |   |
| --- | --- |
| [GglConnecte](../WDLang5/1000017332.md) | Permet de s'authentifier auprès d'un serveur Google (via le mode d'authentification "OAuth 2.0"). |
| [GglDéconnecte](../WDLang5/1000021451.md) | Déconnecte l'utilisateur des services Google utilisés. Lors de la prochaine reconnexion, les autorisations liées aux services Google seront redemandées. |
| [GglEcrit](../WDLang5/1000017401.md) | Crée et / ou met à jour des données sur le serveur Google (ajout ou modification de données). |
| [GglEnvoieDocument](../WDLang5/1000017368.md) | Envoie un document sur le serveur Google. |
| [GglListeAgenda](../WDLang5/1000017330.md) | Récupère la liste des agendas Google associés au compte Google spécifié. |
| [GglListeContact](../WDLang5/1000017344.md) | Récupère la liste des contacts associés au compte Google spécifié. |
| [GglListeContactParRequête](../WDLang5/1000017346.md) | Récupère une liste de contacts à partir de paramètres personnalisés. |
| [GglListeDocument](../WDLang5/1000017367.md) | Récupère la liste des documents disponibles sur le serveur Google pour l'utilisateur en cours. |
| [GglListeGroupeContact](../WDLang5/1000017577.md) | Récupère la liste des groupes de contacts associés au compte Google spécifié. |
| [GglRécupèreAgenda](../WDLang5/1000017410.md) | Récupère un agenda Google et ses événements à partir de son titre ou identifiant. |
| [GglRécupèreDocument](../WDLang5/1000019904.md) | Télécharge un document depuis le service Google Docs. |
| [GglRemplitAgenda](../WDLang5/1000017337.md) | Remplit un agenda précédemment récupéré : les événements correspondant à l'agenda sont récupérés (éventuellement en utilisant certains critères). |
| [GglRemplitAgendaParRequête](../WDLang5/1000017347.md) | Remplit un agenda précédemment récupéré : les événements correspondant à l'agenda sont récupérés à partir d'une requête personnalisée. |
| [GglRequête](../WDLang5/1000017345.md) | Effectue une requête de communication (requête HTTP) à un service Google. |
| [GglSupprime](../WDLang5/1000017402.md) | Supprime des données sur le serveur Google. |








### Fonctions (syntaxe préfixée) manipulant des variables de type gglConnexion
<a name="fonctions_syntaxe_prefixee_manipulant_des_variables_type_gglconnexion_ELTPARAGRAPHE000092"></a>


|   |   |
| --- | --- |
| [&lt;Variable gglConnexion&gt;.Connecte](../WDLang5/1000021455.md) | Permet de s'authentifier auprès d'un serveur Google (via le mode d'authentification "OAuth 2.0"). |
| [&lt;Variable gglConnexion&gt;.Déconnecte](../WDLang5/1000021459.md) | Déconnecte l'utilisateur des services Google utilisés. Lors de la prochaine reconnexion, les autorisations liées aux services Google seront redemandées. |
| [&lt;Variable gglConnexion&gt;.Ecrit](../WDLang5/1000021460.md) | Crée et / ou met à jour des données sur le serveur Google (ajout ou modification de données). |
| [&lt;Variable gglConnexion&gt;.EnvoieDocument](../WDLang5/1000020424.md) | Envoie un document sur le serveur Google. |
| [&lt;Variable gglConnexion&gt;.ListeAgenda](../WDLang5/1000017747.md) | Récupère la liste des agendas Google associés au compte Google spécifié. |
| [&lt;Variable gglConnexion&gt;.ListeContact](../WDLang5/1000017757.md) | Récupère la liste des contacts associés au compte Google spécifié. |
| [&lt;Variable gglConnexion&gt;.ListeContactParRequête](../WDLang5/1000017758.md) | Récupère une liste de contacts à partir de paramètres personnalisés. |
| [&lt;Variable gglConnexion&gt;.ListeDocument](../WDLang5/1000020436.md) | Récupère la liste des documents disponibles sur le serveur Google pour l'utilisateur en cours. |
| [&lt;Variable gglConnexion&gt;.ListeGroupeContact](../WDLang5/1000017759.md) | Récupère la liste des groupes de contacts associés au compte Google spécifié. |
| [&lt;Variable gglConnexion&gt;.RécupèreAgenda](../WDLang5/1000017748.md) | Récupère un agenda Google et ses événements à partir de son titre ou identifiant. |
| [&lt;Variable gglConnexion&gt;.RécupèreDocument](../WDLang5/1000020437.md) | Télécharge un document depuis le service Google Docs. |
| [&lt;Variable gglConnexion&gt;.RemplitAgenda](../WDLang5/1000017749.md) | Remplit un agenda précédemment récupéré : les événements correspondant à l'agenda sont récupérés (éventuellement en utilisant certains critères). |
| [&lt;Variable gglConnexion&gt;.RemplitAgendaParRequête](../WDLang5/1000017750.md) | Remplit un agenda précédemment récupéré : les événements correspondant à l'agenda sont récupérés à partir d'une requête personnalisée. |
| [&lt;Variable gglConnexion&gt;.Requête](../WDLang5/1000021462.md) | Effectue une requête de communication (requête HTTP) à un service Google. |
| [&lt;Variable gglConnexion&gt;.Supprime](../WDLang5/1000021461.md) | Supprime des données sur le serveur Google. |








