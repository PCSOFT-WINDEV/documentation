


## iInitRequêteEtatConnexion (Fonction)

***En anglais : iInitReportQueryConnection***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Initialise la requête liée à l'état. Cette fonction doit être utilisée si la requête utilise des fichiers accédés par une connexion spécifique (connexion à l'aide d'un provider OLE DB par exemple). Si la requête n'utilise pas de connexion spécifique, utilisez la fonction [iInitRequêteEtat](../WDLang5/3046021.md).

Cette fonction peut être appelée :

- soit dans l'événement "Initialisation" de l'état. Si la requête attend des paramètres, il est possible de spécifier les paramètres attendus.

- soit avant la fonction [iImprimeEtat](../WDLang5/3046032.md).


![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png) **Attention** : L'utilisation de cette fonction sous Linux nécessite une configuration spécifique. Pour plus de détails, consultez [Imprimer sous Linux](../Editeurs/9000078.md). 

|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png)<br> | Important | Si la requête est créée avec l'éditeur d'états utilisateur, il n'est pas nécessaire d'utiliser la fonction **iInitRequêteEtatConnexion** pour  spécifier les paramètres de la requête. En effet, lors de l'exécution d'un état sur une requête paramétrée depuis l'éditeur d'états utilisateur, une fenêtre s'affiche permettant de saisir les paramètres de la requête. |




<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Initialisation de la requête 
iInitRequêteEtatConnexion(ETAT_BulletinScolaire, hRequêteSansCorrection, ...
		"MaConnexion_Oracle", "Dupond", "2020")
// Impression de l'état
iImprimeEtat(ETAT_BulletinScolaire)
```
<a name="Exemple2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 
```wl
// Initialisation de la requête (connexion Oracle) 
iInitRequêteEtatConnexion(ETAT_BulletinScolaire, "MaConnexion_Oracle", "Dupond", "2020")
// Impression de l'état
iImprimeEtat(ETAT_BulletinScolaire)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`iInitRequêteEtatConnexion(<Etat manipulé> [, <Mode d'initialisation>] , <Nom de la connexion> [, <Paramètre 1 de la requête> [... [, <Paramètre N de la requête>]]])`
---

**`<Etat manipulé> : (Nom d'état)`**

Nom logique de l'état à imprimer.

**`<Mode d'initialisation> : (Constante optionnelle de type Entier)`**

Option pour l'initialisation de la requête :


|   |   |
| --- | --- |
| *hAvecFiltre*<br>(option combinable avec les autres constantes) | Si cette constante est spécifiée :<br><br>- le résultat de la requête correspond à une sélection d'enregistrements de type filtre si le moteur HFSQL le permet. Sinon, le résultat de la requête est une vue HFSQL.<br><br>- les opérations suivantes ne sont pas possibles : recherche sur le résultat de la requête, requête sur requête, vue sur requête, requête sur vue.<br><br>- les rubriques de parcours spécifiées lors du parcours du résultat ne sont pas prises en compte.<br><br>- la loupe n'est pas disponible sur les tables liées à une requête.<br><br>- la fonction hNbEnr ne peut pas être utilisée sur les requêtes.<br><br><br>Attention : si cette option est précisée, la constante hModifieFichier est automatiquement utilisée.<br>Si cette constante n'est pas spécifiée (par défaut) : <br><br>- le résultat de la requête correspond à une vue HFSQL<br><br>- il est possible de réaliser les opérations suivantes sur les requêtes : recherche sur le résultat de la requête, requête sur requête, vue sur requête, requête sur vue.<br><br>- les rubriques de parcours spécifiées lors du parcours du résultat sont prises en compte.<br><br>- la loupe est disponible sur les tables liées à une requête.<br><br>- la fonction [hNbEnr](../WDLang4/3044006.md) peut être utilisée sur les requêtes.<br><br><br> |
| *hModifieFichier*<br>(option combinable avec les autres constantes) | **Sur des fichiers de données HFSQL** : Lors de la modification du résultat de la requête (fonctions [HAjoute](../WDLang4/3044147.md), [HEcrit](../WDLang4/3044092.md), [HModifie](../WDLang4/3044042.md), [HRaye](../WDLang4/3044121.md), [HSupprime](../WDLang4/3044018.md)), ces modifications seront reportées dans les fichiers intervenant dans la requête.<br>Si cette option n'est pas précisée, seul le résultat de la requête est modifié. <br>Pour plus de détails sur la modification du résultat d'une requête, consultez [Modifier le contenu d'une requête](../WDLang4/3044234.md).<br><br>**Sur des fichiers de données non HFSQL**, la constante *hModifieFichier* est inutile : les fichiers intervenant dans la requête sont automatiquement modifiés lors de la modification du résultat de la requête. |
| *hRequêteDéfaut*<br>(valeur par défaut) | Initialisation de la requête sans interruption. |
| *hRequêteInterruptible* | L'initialisation de la requête peut être interrompue avec la touche ECHAP |
| *hRequêteSansCorrection* | ![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Le moteur HFSQL n'effectue aucune vérification de la requête. Cette option doit être utilisée si la requête comporte des ordres spécifiques à un type de connexion (Oracle, SQL Server, ...).<br>  **Attention** : si cette constante est utilisée :<br><br>- il est nécessaire de préciser le nom de la connexion (paramètre &lt;Nom de la connexion&gt;).<br><br>- les fonctions suivantes ne peuvent pas être utilisées sur la requête manipulée : [HFiltre](../WDLang4/3044100.md), [HLitRecherche](../WDLang4/3044050.md), [HLitRechercheDernier](../WDLang4/3044034.md), [HLitRecherchePremier](../WDLang4/3044036.md).<br><br>- il est conseillé de ne pas spécifier de rubrique de parcours dans les fonctions suivantes : [HDernier](../WDLang4/3044101.md), [HLitDernier](../WDLang4/3044140.md), [HLitPremier](../WDLang4/3044051.md), [HLitRechercheDernier](../WDLang4/3044034.md), [HLitRecherchePremier](../WDLang4/3044036.md), [HPremier](../WDLang4/3044113.md), [HRechercheDernier](../WDLang4/3044129.md), [HRecherchePremier](../WDLang4/3044125.md)<br><br><br> |
| *hRequêteSansCorrectionHF* | **HFSQL uniquement** : Le moteur HFSQL n'effectue aucune vérification du format de fichier (complété par des espaces ou non). A utiliser si la requête manipule à la fois des fichiers HFSQL au format complété par des espaces et des fichiers HFSQL au format non complété par des espaces. |



**`<Nom de la connexion> : (Chaîne de caractères)`**

Nom de la connexion à une base de données. Cette connexion a été définie dans l'éditeur d'analyses ou dynamiquement par la fonction [HDécritConnexion](../WDLang4/3044205.md). La description de la connexion doit être connue au moment de l'exécution de la fonction.

**`<Paramètre 1 de la requête> : (Type du paramètre de la requête (optionnel))`**

Premier paramètre de la requête définie comme source de l'état (si la requête attend un paramètre).



**`<Paramètre N de la requête> : (Type du paramètre de la requête (optionnel))`**

Dernier paramètre de la requête définie comme source de l'état (si la requête attend un paramètre).



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Champ Etat Interne : état basé sur une requête manipulant une connexion spécifique
<a name="champ_etat_interne_etat_base_sur_une_requete_manipulant_une_connexion_specifique_ELTPARAGRAPHE000250"></a>Si l'état associé à un champ de type "Etat interne" est basé sur une requête manipulant une connexion spécifique, utilisez la fonction **iInitRequêteEtatConnexion** pour exécuter cette requête (et lui passer si nécessaire des paramètres). Cette fonction doit être utilisée dans l'événement "Avant impression" du bloc contenant le champ "Etat Interne".

Pour plus de détails sur les "Etat Interne", consultez [Champs de type Etat Interne](../WDChamp/1013044.md).
<a name="NOTE0_2"></a>


### Divers
<a name="divers_ELTPARAGRAPHE000267"></a>

- Si certains paramètres attendus par la requête ne sont pas précisés (valeur correspondant à une chaîne vide par exemple), les conditions de sélection correspondant à ces paramètres seront ignorées.

- Si le nombre de paramètres précisé dans la fonction **iInitRequêteEtatConnexion** est supérieur au nombre de paramètres attendu par la requête, les paramètres supplémentaires sont ignorés.




<a name="XComposante"></a>

## Classification Métier / UI :
Code neutre
## Composante :
wd280etat.dll
