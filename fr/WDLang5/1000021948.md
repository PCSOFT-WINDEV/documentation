


## Utiliser l'identification Facebook (syntaxe préfixée)
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000097"></a>
Facebook, le 1er réseau social mondial, est très utilisé par les entreprises pour rassembler leurs clients. Facebook dis­pose d'une API très riche afin d'exploiter au mieux la plateforme. 

WINDEV, WEBDEV et WINDEV Mobile (pour les applications Android et iOS) proposent deux modes d'utilisation de Facebook : 

- une utilisation simple, permettant d'utiliser le login Facebook de l'utilisateur pour s'identifier dans l'application WINDEV ou WINDEV Mobile ou dans le site WEBDEV. L'utilisateur final a ainsi moins de mots de passe à retenir. 

- une utilisation avancée, permettant de s'interfacer avec Facebook afin d'utiliser l'API Facebook depuis une application WINDEV ou WINDEV Mobile ou depuis un site WEBDEV. 




Quel que soit le mode d'utilisation choisi, le principe est le même. Il faut : 

- Déclarer l'application WINDEV ou WINDEV Mobile ou le site WEBDEV à Facebook. 

- Utiliser les identifiants Facebook dans l'application WINDEV ou WINDEV Mobile ou dans le site WEBDEV. 

- Se connecter à Facebook depuis l'application WINDEV ou WINDEV Mobile ou le site WEBDEV pour identifier l'utilisateur. 




Si vous souhaitez une utilisation avancée, des fonctions WLangage permettent de dialoguer avec Facebook via son API. 

Attention : Cette fonctionnalité n'est pas disponible pour les applications WINDEV sous Linux. 



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Les éléments proposés par le WLangage
<a name="les_elements_proposes_par_wlangage_ELTTEXTE000165"></a>
Pour communiquer avec Facebook, le WLangage met à votre disposition les éléments suivants : 

- le type [fbSession](../WDLang5/1000021851.md). Ce type de variable contient tous les éléments nécessaires à la mise en place de la connexion et de l'authentification Facebook.

- plusieurs fonctions : 
	


|   |   |
| --- | --- |
| [&lt;Variable fbSession&gt;.Etat](../WDLang5/1000021942.md) | Vérifie l'état d'une session Facebook. |
| [&lt;Variable fbSession&gt;.Ferme](../WDLang5/1000021943.md) | Ferme la session Facebook ouverte avec la fonction [&lt;Variable fbSession&gt;.Ouvre](../WDLang5/1000021944.md). |
| [&lt;Variable fbSession&gt;.Ouvre](../WDLang5/1000021944.md) | Permet l'authentification et la connexion à Facebook. |
| [&lt;Variable fbSession&gt;.RécupèreInformationUtilisateur](../WDLang5/1000021945.md) | Récupère les informations Facebook de l'utilisateur connecté. |
| [&lt;Variable fbSession&gt;.Requête](../WDLang5/1000021946.md) | Effectue une requête de communication (requête HTTP) à la Graph API de Facebook. |




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Déclaration de l'application dans Facebook
<a name="declaration_application_dans_facebook_ELTTEXTE000251"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Déclaration de l'application WINDEV dans Facebook
<a name="declaration_application_windev_dans_facebook_ELTPARAGRAPHE000276"></a>Dans un premier temps, il est bien entendu nécessaire de créer avec WINDEV une application Windows utilisant l'identification Facebook et/ou l'API Facebook. 

Voici la marche à suivre (valide à la rédaction de cette page) : 

1. Connectez-vous au site "https://developers.facebook.com/". 

2. Identifiez-vous (bouton "Connexion"). 

3. Si nécessaire, enregistrez-vous (cliquez sur le bouton "S'enregistrer" et suivez l'assistant). 

4. Dans le menu "Mes Applications", cliquez sur "Créer une App". 

5. Dans la popup qui s'affiche, choisissez une application de type "Consommateur". 

6. Cliquez sur "Suivant". 

7. Dans la popup qui s'affiche, indiquez : 

	- Dans le champ "Nom d'usage de l'app", le nom de votre application. 

	- Dans le champ "E-mail du contact de l'app", une adresse email valide. 




8. Validez la création de l'application (et validez si nécessaire le contrôle de sécurité).   

9. La page de l'application que vous venez de créer s'affiche.  

10. Cliquez ensuite sur le menu "Paramètres", puis choisissez "Général".  

11. Notez le "Identifiant de l'application" et la "Clé secrète". 

12. Dans la zone "Domaines de l'app", saisissez "localhost". 

13. En bas de la page, cliquez sur "Ajouter une plateforme" et sélectionnez "Site web". 

14. Saisissez l'URL du site "http://localhost/". 

15. Cliquez ensuite sur le bouton "Enregistrer les modifications". 


L'application Facebook est prête pour les tests. 

A ce stade, il est possible de se connecter à l'application avec l'utilisateur Facebook qui a déclaré l'application (il est par défaut son administrateur).

Pour utiliser d'autres utilisateurs pour les tests, cliquez sur le menu "Rôles" et ajoutez les utilisateurs avec les droits voulus (développeurs, testeurs...). Il également possible de créer des utilisateurs pour test (option "Utilisateurs test") sans utiliser des comptes Facebook existants.

Pour une utilisation réelle de l'application, il est nécessaire de rendre l'application publique et si nécessaire de soumettre l'application à Facebook (option "Examen des apps"). Pour plus de détails, consultez la documentation de Facebook. 

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Mise en place de l'identification Facebook dans l'application WINDEV, WINDEV Mobile ou dans le site WEBDEV
<a name="mise_place_identification_facebook_dans_application_windev_windev_mobile_dans_site_webdev_ELTTEXTE000428"></a>


### Mise en place de la connexion
<a name="mise_place_connexion_ELTPARAGRAPHE000451"></a>Pour se connecter à Facebook, il suffit de : 

1. Paramétrer une session Facebook (variable de type [fbSession](../WDLang5/1000021851.md)). Dans les différentes propriétés de cette variable, vous devez indiquer : 

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) le "App ID" et le "App Secret" fournis lors de l'inscription de l'application à Facebook. 




2. Lancer la connexion avec la fonction [&lt;Variable fbSession&gt;.Ouvre](../WDLang5/1000021944.md).




Par exemple : 

```wl
MaConnexion est une fbSession
// Paramétrage de la session
MaConnexion.AppID = "1664XXXXXXXXXXXX"
MaConnexion.AppSecret = "c6e7XXXXXXXXXXXXXXXXX"
// Définition des droits :
// - Lecture de l'email
// - Gestion des pages
MaConnexion.Permission = [fbEmail, "manage_pages", "publish_pages", "publish_actions"]
// Connexion
MaConnexion.Ouvre()
```

Si la connexion est permanente, la fonction ne présente pas d'écran de connexion et ouvre directement la session.

Remarques : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Une page Web s'affiche dans le navigateur par défaut permettant à l'utilisateur de saisir son login et son mot de passe.

- Une session Facebook ouverte est persistante : elle restera ouverte : 

	- jusqu'à la fermeture de l'application. 

	- jusqu'à l'utilisation de la fonction [&lt;Variable fbSession&gt;.Ferme](../WDLang5/1000021943.md).








### Utilisation de l'API Facebook
<a name="utilisation_api_facebook_ELTPARAGRAPHE000519"></a>La fonction [&lt;Variable fbSession&gt;.Requête](../WDLang5/1000021946.md) permet d'effectuer des requêtes auprès de Facebook.

L'exemple suivant permet de lister les pages et groupes gérés par l'utilisateur courant :

```wl
MaConnexion est une fbSession
...
sURL est une chaîne ANSI = GRAPHAPI + "me/accounts?locale=fr_FR"
sJSON est une chaîne ANSI
vJSON est un Variant

// Récupère les pages gérées par l'utilisateur
sJSON = MaConnexion.Requête(sURL)
vJSON = JSONVersVariant(sJSON)
```

La fonction renvoie la réponse JSON de Facebook.

Il suffit ensuite de lire et d'accéder aux membres documentés dans l'API Facebook : "[https://developers.facebook.com/docs/graph-api/reference](https://developers.facebook.com/docs/graph-api/reference)".

```wl
POUR i = 1 _A_ vJSON.data..Occurrence 
	LISTE_PAGES.Ajoute(gValeurMémorisée(i) + vJSON.data[i].name)
FIN
```



