
## Gestion des réplications de serveurs HFSQL (Centre de Contrôle)
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000242"></a>
Le Centre de Contrôle HFSQL permet de : 

- [mettre en place une réplication de serveurs HFSQL](#NOTE2_1). Cette réplication peut être : 

	- une réplication classique entre deux serveurs. 

	- une réplication d'un serveur vers un serveur spare.




- [gérer les réplications de serveurs HFSQL déjà définies](#NOTE3_1). 




**Rappel** : La réplication de serveurs HFSQL consiste à répliquer les données automatiquement de serveur en serveur. Pour plus de détails, consultez [Réplication de serveurs HFSQL](../WDLang4/1000020588.md). 


|   |
| --- |
| **Attention : La réplication de serveurs HFSQL ne doit pas être mise en place sans accord du développeur de l'application**. En effet, la mise en place de la réplication entre plusieurs serveurs HFSQL nécessite quelques adaptations de l'application. <br><br>Si ces adaptations ne sont pas réalisées, l'application risque de ne pas fonctionner correctement et **des données pourront être perdues**. |







<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Mettre en place une réplication de serveurs HFSQL
<a name="mettre_place_une_replication_serveurs_hfsql_ELTTEXTE000272"></a>


### Configurer une réplication avec le Centre de Contrôle HFSQL
<a name="configurer_une_replication_avec_centre_controle_hfsql_ELTPARAGRAPHE000041"></a>Pour configurer une réplication avec le Centre de Contrôle HFSQL : 

1. [Définir avec le Centre de Contrôle le serveur abonné](#NOTE2_2). Le serveur abonné sera le serveur qui recevra les données répliquées. 

2. [Définir avec le Centre de Contrôle le serveur maître](#NOTE2_3). Le serveur maître sera le serveur qui répliquera ses données. 

3. [Définir la réplication sur le serveur maître](#NOTE2_4). 


**Remarques** : 

- L'utilisateur du Centre de Contrôle HFSQL doit avoir le droit de "Créer une réplication entre deux serveurs HFSQL" pour pouvoir créer et configurer la réplication entre serveurs. 

- La communication entre les serveurs est authentifiée. Elle n'est pas cryptée.



<a name="NOTE2_2"></a>


### Définir le serveur abonné depuis le Centre de Contrôle HFSQL
<a name="definir_serveur_abonne_depuis_centre_controle_hfsql_ELTPARAGRAPHE000063"></a>Pour définir le serveur abonné depuis le Centre de Contrôle HFSQL : 

1. Connectez-vous depuis le Centre de Contrôle HFSQL au serveur HFSQL qui sera le serveur abonné. 

2. Double-cliquez sur le **serveur** HFSQL dans l'arbre de gauche. 

3. Dans l'onglet du serveur, dans le ruban, cliquez sur "Configuration du serveur". 

4. Dans la liste des configurations possibles, sélectionnez "Réplication". Vous pouvez configurer la réplication pour le serveur en cours. 

5. Cochez l'option "Le serveur est abonné ou spare (va recevoir des données répliquées)". <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CC_HF_Replication_Serveur%20-%20HC%20N%B0001.gif&type=thumb)


6. Indiquez le port pour la réception des données répliquées. 

7. Indiquez le mot de passe et sa confirmation pour la réplication. 

8. Indiquez l'identifiant unique du serveur HFSQL (compris entre 1 et 32000). 

9. Indiquez la priorité du serveur. 
	Remarque : Lors d'un conflit de modification, ce numéro est utilisé si la méthode de résolution du conflit correspond à une résolution par priorité. Plus la valeur de priorité définie pour le serveur est petite, plus le serveur sera prioritaire.

10. Validez. 



<a name="NOTE2_3"></a>


### Définir le serveur maître depuis le Centre de Contrôle HFSQL
<a name="definir_serveur_maitre_depuis_centre_controle_hfsql_ELTPARAGRAPHE000088"></a>Pour définir le serveur maître depuis le Centre de Contrôle HFSQL : 

1. Connectez-vous depuis le Centre de Contrôle HFSQL au serveur HFSQL qui sera le serveur maître. 

2. Double-cliquez sur le **serveur** HFSQL dans l'arbre de gauche. 

3. Dans l'onglet du serveur, dans le ruban, cliquez sur "Configuration du serveur". 

4. Dans la liste des configurations possibles, sélectionnez "Réplication". Vous pouvez configurer la réplication pour le serveur en cours. 

5. Cochez l'option "Le serveur est maitre (va répliquer ses données)". 

6. Indiquez l'identifiant unique du serveur HFSQL (compris entre 1 et 32000). 

7. Indiquez la priorité du serveur. 
	Remarque : Lors d'un conflit de modification, ce numéro est utilisé si la méthode de résolution du conflit correspond à une résolution par priorité. Plus la valeur de priorité définie pour le serveur est petite, plus le serveur sera prioritaire.

8. Cliquez sur le bouton "Appliquer". 



<a name="NOTE2_4"></a>


### Définir une réplication sur le serveur maître
<a name="definir_une_replication_sur_serveur_maitre_ELTPARAGRAPHE000110"></a>Pour définir une réplication sur le serveur maître : 

1. Si aucune réplication n'a été définie, cliquez sur le lien "Cliquez ici pour créer une nouvelle réplication de serveurs". 
	Si une ou plusieurs réplications ont été définies, cliquez sur "Ajouter". 
	L'assistant de création d'une réplication se lance. 

2. Indiquez le type de réplication : 

	- Réplication mono-directionnelle, 

	- Réplication spare,

	- Réplication bi-directionnelle. 
			En cas de réplication bi-directionnelle, le serveur sera également configuré en tant qu'abonné. Il est alors nécessaire d'indiquer : 

		- le port permettant de recevoir les données répliquées. 

		- le mot de passe pour la réplication. Ce mot de passe sera identique pour le serveur abonné. 




3. Indiquez la destination de la réplication (c'est-à-dire les caractéristiques du serveur abonné) : 

	- le nom DNS du serveur abonné ou son adresse IP.

	- le port de réplication sur le serveur abonné. 

	- le mot de passe pour la réplication pour le serveur abonné (cas d'une réplication mono directionnelle ou spare). 




4. Sélectionnez les éléments à répliquer. Il est possible de répliquer :

	- tout le contenu du serveur, 

	- une base de données,

	- une sélection de bases de données ou de fichiers. 


 Remarques : 

- Il est possible d'exclure certains fichiers de la réplication. Si cette option a été sélectionnée, l'étape suivante de l'assistant permet de sélectionner les éléments à exclure. 

- Il est possible si nécessaire de réaliser une copie initiale des éléments à répliquer. 

5. Planifiez la réplication : 

	- Périodique : la réplication sera effectuée régulièrement. Un assistant permet de définir la périodicité. 

	- Mode continu : la réplication sera effectuée en continu, à chaque modification. 




6. ***Dans le cas d'une réplication mono-directionnelle ou bi-directionnelle,*** sélectionnez le mode de résolution des conflits : 

	- **Plus récent** : Lors d'un conflit, l'élément le plus récent est prioritaire.
			Attention : Cette méthode nécessite une synchronisation de l'horloge des différents serveurs. La date et l'heure à la seconde des enregistrements est utilisée pour la comparaison (AAAAMMJJHHmmSS). Si deux enregistrements en conflit ont strictement la même date et heure, l'identifiant des serveurs est utilisé pour que la comparaison soit déterministe.

	- **Priorité** :  Lors d'un conflit, seule la valeur de priorité définie pour le serveur est prise en compte. Plus la valeur de priorité définie pour le serveur est petite, plus le serveur sera prioritaire.

	- **Procédure stockée avec toutes les rubriques** : Lors d'un conflit, une procédure stockée est lancée. Dans cette procédure, toutes les rubriques de l'enregistrement seront accessibles. Indiquez le nom de la procédure stockée à utiliser. 

	- **Procédure stockée avec les rubriques modifiées** : Lors d'un conflit, une procédure stockée est lancée. Dans cette procédure, seules les rubriques modifiées seront accessibles. Indiquez le nom de la procédure stockée à utiliser. 




7. Donnez un nom à la réplication et validez. L'assistant de création de la réplication se ferme et la réplication apparaît dans la **Liste des réplications**. 






<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Gérer les réplications existantes
<a name="gerer_les_replications_existantes_ELTTEXTE000314"></a>
Si des réplications ont été définies sur le serveur HFSQL en cours, le Centre de Contrôle HFSQL permet de : 

- **Ajouter une nouvelle réplication** (bouton "Ajouter"). Dans ce cas, l'assistant de création de réplication se lance automatiquement. 

- **Modifier une réplication** (bouton "Modifier"). La fenêtre de description de la réplication apparaît. Cette fenêtre permet de modifier les principales caractéristiques de la réplication. Certaines caractéristiques ne sont pas modifiables. Dans ce cas, il peut être nécessaire de supprimer la réplication et de la re-créer. 
	Les caractéristiques modifiables sont les suivantes : 

	- le mode de résolution des conflits (onglet "Général"). Cette option est disponible uniquement dans le cas des réplications mono-directionnelles et bi-directionnelles.  

	- la description de la réplication (onglet "Général"). 
			Il est possible de modifier le nom DNS du serveur destination via le bouton "...". Dans la fenêtre qui s'affiche, il suffit de saisir le nouveau nom du serveur et le port utilisé. 
			**Attention** : Cette modification doit être effectuée uniquement si le serveur est resté à l'identique, sauf son nom DNS ou le port de réplication des données.  

	- les éléments répliqués (onglet "Eléments répliqués"). 
			Attention : il est uniquement possible d'exclure des éléments de la réplication. 

	- la planification de la réplication (onglet "Planification"). 




- **Supprimer une réplication** (bouton "Supprimer"). Après confirmation, la configuration de la réplication est supprimée.
	Attention : Le serveur abonné doit être accessible. Si le serveur abonné n'est pas accessible, il est possible de forcer la suppression. Dans ce cas : 

	- les informations de réplication ne seront pas supprimées du serveur abonné.  

	- si la réplication est bi-directionnelle, la configuration ne sera pas supprimée du serveur inaccessible. Il est conseillé de réaliser également cette suppression sur ce serveur pour éviter une consommation mémoire inutile. 


Dans le cas d'une réplication spare, lors de la suppression de la réplication, le serveur abonné redevient en lecture/écriture. Les données ne sont pas supprimées du serveur abonné. 

- **Déclencher une réplication** (bouton "Déclencher"). Cette option permet de déclencher immédiatement une réplication programmée. 







