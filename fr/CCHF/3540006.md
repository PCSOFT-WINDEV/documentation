
## Centre de Contrôle HFSQL : Sauvegardes HFSQL Client/Serveur
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000191"></a>
Le Centre de Contrôle HFSQL permet de gérer des sauvegardes des fichiers de données HFSQL Client/Serveur.

Les sauvegardes peuvent être :

- complètes : dans ce cas, tous les éléments sélectionnés (serveur complet, bases de données ou fichiers) sont sauvegardés dans leur intégralité. Cette sauvegarde est plus sûre puisqu'elle suffit pour restaurer les éléments. Elle est plus longue à réaliser puisque tout est sauvegardé.

- différentielles : dans ce cas, seules les différences par rapport à une sauvegarde complète sont sauvegardées. Cette sauvegarde est plus rapide à réaliser et moins volumineuse. Elle nécessite d'être conservée avec la sauvegarde complète qui lui correspond.






<a name="NOTE2B"></a>
<a name="NOTE2B_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000221"></a>


### Effectuer une sauvegarde
<a name="effectuer_une_sauvegarde_ELTPARAGRAPHE000027"></a>**Remarque** : Les sauvegardes réalisées de cette façon sont nécessairement complètes. Les sauvegardes différentielles ne peuvent être faites que par le biais de sauvegardes planifiées.

Pour effectuer une sauvegarde : 

1. Connectez-vous si nécessaire à un serveur HFSQL. 

2. Double-cliquez sur le nom du serveur HFSQL dans l'arborescence. 

3. La partie droite du Centre de Contrôle affiche un onglet au nom du serveur. 

4. Cliquez sur l'onglet "Sauvegardes".

5. Dans le ruban, dans le groupe "Sauvegardes", déroulez "Nouvelle sauvegarde" et sélectionnez "Nouvelle sauvegarde à chaud". L'assistant de création d'une sauvegarde se lance.

6. Indiquez le contenu de la sauvegarde :

	- Tout le contenu du serveur.

	- Une base de données spécifique.

	- Une sélection de bases de données et / ou de fichiers de données.




7. Passez à l'étape suivante de l'assistant et indiquez les options de sauvegarde : 

	- si le résultat de la sauvegarde doit être compressé dans un fichier zip. 

	- si la sauvegarde doit contenir les fichiers d'index (fichiers d'index NDX et fichiers d'index full-text FTX). Si les fichiers d'index ne sont pas sauvegardés, la taille de la sauvegarde sera réduite, mais le temps de restauration sera plus long. Remarque : si les fichiers d'index ne sont pas sauvegardés, il sera nécessaire de fournir les mots de passe des fichiers au moment de la restauration pour permettre leur réindexation.




8. Passez à l'étape suivante de l'assistant. 

9. Indiquez l'emplacement de la sauvegarde en spécifiant le répertoire de sauvegarde. Si ce nom correspond à un chemin relatif, la sauvegarde sera réalisée dans le sous-répertoire "Backup" du serveur HFSQL. L'assistant permet de définir un sous-répertoire de "backup" ("Sauvegardes" par défaut). Il est également possible d'ajouter la date et l'heure (sous la forme "Année\\Mois\\Jour\\Heure-Minute") au nom du répertoire pour identifier facilement la sauvegarde.
	Remarque : Les sauvegardes sont réalisées dans un sous-répertoire numéroté (par exemple "backup\\Sauvegardes\\1"). Ainsi, si plusieurs sauvegardes sont réalisées, les fichiers correspondants ne seront pas écrasés par une nouvelle sauvegarde.

10. Passez à l'étape suivante de l'assistant. 

11. Indiquez les actions associées à la sauvegarde : 

	- Procédure stockée avant ou après la sauvegarde : Dans ce cas, l'étape suivante de l'assistant permet d'indiquer :

		- le nom de la base contenant la procédure stockée à exécuter,

		- le nom de la collection de procédures contenant la procédure stockée à exécuter,

		- le nom de la procédure à exécuter.




- Webhook exécutée après la sauvegarde : Dans ce cas, l'étape suivante de l'assistant permet d'indiquer l'URL de la webhook (du service REST) à laquelle le résultat de la sauvegarde doit être envoyé. 

12. Donnez une description à votre sauvegarde et validez.

13. La sauvegarde est automatiquement lancée. Vous pouvez suivre la sauvegarde dans le Centre de Contrôle HFSQL.




**Remarque** : Il est également possible de réaliser une sauvegarde depuis l'onglet "Sauvegardes" d'une base de données sélectionnée dans l'arbre à gauche de l'écran.


### Effectuer une sauvegarde planifiée
<a name="effectuer_une_sauvegarde_planifiee_ELTPARAGRAPHE000070"></a>Pour effectuer une sauvegarde planifiée : 

1. Connectez-vous si nécessaire à un serveur HFSQL. 

2. Double-cliquez sur le nom du serveur HFSQL dans l'arborescence. 

3. La partie droite du Centre de Contrôle affiche un onglet au nom du serveur. 

4. Cliquez sur l'onglet "Sauvegardes".

5. Dans le ruban, dans le groupe "Sauvegardes", déroulez "Nouvelle sauvegarde" et sélectionnez "Nouvelle sauvegarde planifiée". L'assistant de création d'une sauvegarde se lance.

6. Indiquez le contenu de la sauvegarde : tout le contenu du serveur, une base de données spécifique, une sélection de bases de données et / ou de fichiers.

7. Passez à l'étape suivante de l'assistant et indiquez les options de sauvegarde : 

	- si le résultat de la sauvegarde doit être compressé au format zip.

	- si la sauvegarde doit contenir les fichiers d'index (fichiers d'index NDX et fichiers d'index full-text FTX). Si les fichiers d'index ne sont pas sauvegardés, la taille de la sauvegarde sera réduite, mais le temps de restauration sera plus long. Remarque : si les fichiers d'index ne sont pas sauvegardés, il sera nécessaire de fournir les mots de passe des fichiers au moment de la restauration pour permettre leur réindexation.




8. Passez à l'étape suivante de l'assistant. 

9. Choisissez un scénario de planification parmi les scénarios prédéfinis. Vous pouvez également opter pour une planification personnalisée. Dans ce cas, les étapes suivantes de l'assistant vous guideront dans la construction de la planification.

10. Passez à l'étape suivante de l'assistant. 

11. Indiquez l'emplacement de la sauvegarde en spécifiant le répertoire de sauvegarde. Si ce nom correspond à un chemin relatif, la sauvegarde sera réalisée dans le sous-répertoire "Backup" du serveur HFSQL. L'assistant permet de définir un sous-répertoire de "backup" ("Sauvegardes" par défaut). Il est également possible d'ajouter la date et l'heure (sous la forme "Année\\Mois\\Jour\\Heure-Minute") au nom du répertoire pour identifier facilement la sauvegarde.
	Remarque : Les sauvegardes sont réalisées dans un sous-répertoire numéroté (par exemple "backup\\Sauvegardes\\1"). Ainsi, si plusieurs sauvegardes sont réalisées, les fichiers correspondants ne seront pas écrasés par une nouvelle sauvegarde.

12. Passez à l'étape suivante de l'assistant. 

13. Indiquez les actions associées à la sauvegarde : 

	- Procédure stockée avant ou après la sauvegarde : Dans ce cas, l'étape suivante de l'assistant permet d'indiquer :

		- le nom de la base contenant la procédure stockée à exécuter,

		- le nom de la collection de procédures contenant la procédure stockée à exécuter,

		- le nom de la procédure à exécuter.




- Webhook exécutée après la sauvegarde : Dans ce cas, l'étape suivante de l'assistant permet d'indiquer l'URL de la webhook (du service REST) à laquelle le résultat de la sauvegarde doit être envoyé. 

14. Indiquez si vous souhaitez limiter le nombre de sauvegardes conservées sur le serveur.

15. Donnez une description à votre sauvegarde et validez.

16. La sauvegarde sera automatiquement lancée selon la planification indiquée. Vous pouvez suivre la sauvegarde dans le Centre de Contrôle HFSQL.



<a name="NOTE2B_2"></a>


### Manipulations sur les sauvegardes
<a name="manipulations_sur_les_sauvegardes_ELTPARAGRAPHE000110"></a>Le Centre de Contrôle HFSQL permet de manipuler les différentes sauvegardes réalisées. Il est possible de :

- Effectuer une sauvegarde.

- Restaurer une sauvegarde.

- Restaurer une sauvegarde présente dans un répertoire spécifique.

- Supprimer une sauvegarde. Pour supprimer une sauvegarde, il est nécessaire d'être "Super utilisateur".

- Relancer une sauvegarde (option disponible dans "Autres actions"). 

- Récupérer une sauvegarde sur le poste client (option disponible dans "Autres actions"). 




Pour effectuer ces manipulations : 

1. Connectez-vous si nécessaire à un serveur HFSQL. 

2. Double-cliquez sur le nom du serveur HFSQL dans l'arborescence. 

3. La partie droite du Centre de Contrôle affiche un onglet au nom du serveur.

4. Sélectionnez l'onglet "Sauvegardes".

5. Sélectionnez la sauvegarde à manipuler. 

6. Les options spécifiques à la gestion des sauvegardes sont placées dans le groupe "Sauvegardes" du ruban. Elles permettent de : 

	- créer une nouvelle sauvegarde (à chaud ou planifiée), 

	- relancer une sauvegarde,

	- restaurer une sauvegarde,

	- supprimer une sauvegarde, 

	- récupérer une sauvegarde. Cette option est disponible uniquement pour les sauvegardes réalisées sous forme d'un fichier ZIP. Il suffit d'indiquer l'emplacement où doit être enregistré le fichier de sauvegarde. 







<a name="NOTE3"></a>
<a name="NOTE3_1"></a>




## Remarques
<a name="remarques_ELTTEXTE000294"></a>


### Caractéristiques de la sauvegarde
<a name="caracteristiques_sauvegarde_ELTPARAGRAPHE000258"></a>La sauvegarde effectuée correspondra à l'état de la base de données au début de la sauvegarde.

Pendant la sauvegarde, il est interdit de :

- supprimer des fichiers de données et des bases de données,

- mettre à jour des procédures stockées.   





<a name="1000017308_NOTE4_2"></a>


### Gestion d'une procédure avant et/ou après
<a name="gestion_une_procedure_avant_etou_apres_ELTPARAGRAPHE000271"></a>Il est possible d'appeler une procédure stockée avant ou après la sauvegarde. Ces procédures peuvent prendre des paramètres. 

**Gestion d'une procédure avant** : 
La procédure stockée appelée AVANT la sauvegarde peut prendre des paramètres. Cette procédure est de la forme : 

```txt
PROCEDURE <Nom de la procédure>(<Données à sauvegarder>, ...
		<Destination de la sauvegarde>, <Description>)
```
Ces paramètres sont optionnels. Ils vous permettront de manipuler les indications suivantes dans le code de la procédure stockée :

- ***&lt;Données à sauvegarder&gt;*** : Chaîne de caractères correspondant aux informations à sauvegarder. Correspond à la propriété **Source**. Les valeurs possibles sont les suivantes :
	


|   |   |
| --- | --- |
| *\** | Sauvegarde toutes les bases de données du serveur, les journaux, les bases de données systèmes (utilisateurs, groupes, droits). |
| *Nom de la base de données 1/Nom Fichier1 + TAB + Nom de la base de données 2/Nom Fichier2 + ...* | Liste d'éléments à sauvegarder. Le séparateur utilisé peut être la tabulation (TAB) ou le point virgule (";"). |
| *Nom de la base de données/\** | Sauvegarde toute la base de données : fichiers, liaisons, procédures stockées, triggers. |
| *Nom de la base de données/Nom Fichier1* | Sauvegarde le fichier &lt;Nom Fichier1&gt; de la base de données &lt;Nom de la base de données&gt;. |
| *System* | Sauvegarde les bases de données systèmes (utilisateurs, groupes, droits). |



- ***&lt;Destination de la sauvegarde&gt;*** : Nom et destination de la sauvegarde. Correspond à la propriété **Destination**. La sauvegarde sera réalisée sur le serveur, dans un emplacement défini par ce nom. Si ce nom correspond à un chemin relatif, la sauvegarde sera placée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier :

	- le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".

	- l'année, il suffit d'utiliser la chaîne de caractères "%%ANNEE%%" (par exemple 2008).

	- le mois sur 2 chiffres, il suffit d'utiliser la chaîne de caractères "%%MOIS%%" (par exemple 03).

	- le jour, il suffit d'utiliser la chaîne de caractères "%%JOUR%%".

	- l'heure, il suffit d'utiliser la chaîne de caractères "%%HEURE%%".

	- les minutes, il suffit d'utiliser la chaîne de caractères "%%MINUTE%%".




- ***&lt;Description&gt;*** : Description de la sauvegarde. Correspond à la propriété **Description**.




**Gestion d'une procédure après** : 
La procédure stockée appelée APRES la sauvegarde peut prendre des paramètres. Cette procédure est de la forme : 

```txt
PROCEDURE <Nom de la procédure>(<Données à sauvegarder>, <Destination de la sauvegarde>, ...
			<Description>, <Etat>, <Message d'erreur>)
```
Ces paramètres sont optionnels. Ils vous permettront de manipuler les indications suivantes dans le code de la procédure stockée :

- ***&lt;Données à sauvegarder&gt;*** : Chaîne de caractères correspondant aux informations à sauvegarder. Correspond à la propriété **Source**. Les valeurs possibles sont les suivantes :
	


|   |   |
| --- | --- |
| *\** | Sauvegarde toutes les bases de données du serveur, les journaux, les bases de données systèmes (utilisateurs, groupes, droits). |
| *Nom de la base de données 1/Nom Fichier1 + TAB + Nom de la base de données 2/Nom Fichier2 + ...* | Liste d'éléments à sauvegarder. Le séparateur utilisé peut être la tabulation (TAB) ou le point virgule (";"). |
| *Nom de la base de données/\** | Sauvegarde toute la base de données : fichiers, liaisons, procédures stockées, triggers. |
| *Nom de la base de données/Nom Fichier1* | Sauvegarde le fichier &lt;Nom Fichier1&gt; de la base de données &lt;Nom de la base de données&gt;. |
| *System* | Sauvegarde les bases de données systèmes (utilisateurs, groupes, droits). |



- ***&lt;Destination de la sauvegarde&gt;*** : Nom et destination de la sauvegarde. Correspond à la propriété **Destination**. La sauvegarde sera réalisée sur le serveur, dans un emplacement défini par ce nom. Si ce nom correspond à un chemin relatif, la sauvegarde sera placée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier :

	- le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".

	- l'année, il suffit d'utiliser la chaîne de caractères "%%ANNEE%%" (par exemple 2008).

	- le mois sur 2 chiffres, il suffit d'utiliser la chaîne de caractères "%%MOIS%%" (par exemple 03).

	- le jour, il suffit d'utiliser la chaîne de caractères "%%JOUR%%".

	- l'heure, il suffit d'utiliser la chaîne de caractères "%%HEURE%%".

	- les minutes, il suffit d'utiliser la chaîne de caractères "%%MINUTE%%".




- ***&lt;Description&gt;*** : Description de la sauvegarde. Correspond à la propriété **Description**.

- ***&lt;Etat&gt;*** :  entier (ou constante de type Entier) permettant de connaître l'état de la sauvegarde :
	


|   |   |   |
| --- | --- | --- |
| *hSvgAnnulée* | 2 | Sauvegarde annulée |
| *hSvgEnCours* | 0 | Sauvegarde en cours |
| *hSvgErreur* | 3 | Erreur lors de la sauvegarde |
| *hSvgTerminée* | 1 | Sauvegarde terminée |



- ***&lt;Message d'erreur&gt;*** : Message d'erreur s'il existe sous forme de chaîne de caractères.





<a name="1000017308_NOTE4_3"></a>


### Gestion d'une webhook
<a name="gestion_une_webhook_ELTPARAGRAPHE000287"></a>Une webhook permet de déclencher un traitement automatiquement via un service REST. Il suffit de renseigner l'URL du service REST.  

Une requête de type POST sera effectuée sur l'URL fournie. L'URL reçoit un contenu de type 'application/json' correspondant aux informations sur la sauvegarde effectuée. Par exemple : 
```txt
{
	"identifier" : "283",
	"destination" : "c:\backup\283\monbackup.zip",
	"state" : "completed"
}
```
où : 

- "identifier" correspond à l'identifiant de la sauvegarde. 

- "destination" correspond à la destination de la sauvegarde. 

- "state" correspond à l'état de la sauvegarde. Différents états sont possibles : 'completed', 'canceled' ou 'error'.







