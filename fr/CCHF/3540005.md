
## Centre de Contrôle HFSQL : Gestion des clusters HFSQL
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000126"></a>
Le Centre de Contrôle HFSQL propose une gestion complète d'un cluster HFSQL.

Les opérations d'administration les plus courantes sont les suivantes :

- [Démarrage du cluster](#Demarrage).

- [Gestion des noeuds](#Noeud).

- [Arrêt du cluster](#Arret).

- [Resynchronisation du cluster après une panne](#Synchro).

- [Correction des problèmes potentiels signalés par le Centre de Contrôle HFSQL](#Probleme).

- [Administration des bases de données du cluster HFSQL](#AdminData).




**Remarque** : L'ajout et la suppression de noeuds dans un cluster HFSQL sont décrits dans la page [Installation et configuration de HFSQL Cluster](../WDLang4/1000019031.md). 




|   |
| --- |
| **Attention** : <br>L'utilisation de HFSQL Cluster nécessite l'usage d'un pack d'installation spécifique. <br>Ce pack est disponible gratuitement en téléchargement sur le site de PC SOFT, dans l'espace de téléchargement des modules communs à la version 28. |









## Connexion au coordinateur
<a name="connexion_coordinateur_ELTTEXTE000165"></a>
Pour se connecter au coordinateur via le Centre de Contrôle HFSQL : 

1. Lancez le Centre de Contrôle HFSQL. 

2. Dans la fenêtre de bienvenue, cliquez sur l'option "Se connecter à un cluster HFSQL". 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Administration_cluster%20-%20HC%20N%B0001.gif&type=thumb)


3. Dans la partie "Nouvelle connexion", saisissez : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Administration_cluster%20-%20HC%20N%B0002.gif&type=thumb)


	- l'adresse du coordinateur. 

- le mot de passe d'administration du cluster (optionnel). Ce mot de passe a été choisi lors de [l'installation du cluster](../WDLang4/1000019031.md). 

	- Pour administrer les noeuds du cluster, ce mot de passe doit être indiqué. 

	- Pour administrer les bases de données du cluster, ce mot de passe n'est pas nécessaire.

4. Validez. Les caractéristiques du cluster apparaissent dans le Centre de Contrôle HFSQL. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Administration_cluster%20-%20HC%20N%B0004.gif&type=thumb)



**Remarques** : 

- L'option "Se connecter à un cluster HFSQL" doit être utilisée pour l'administration des bases de données. Les bases de données du cluster s'administrent de la même façon que des bases de données HFSQL Client/Serveur.

- Si le Centre de Contrôle HFSQL est déjà lancé, il est possible d'utiliser le menu déroulant pour se connecter à un cluster : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Administration_cluster%20-%20HC%20N%B0003.gif)





<a name="Demarrage"></a>


## Démarrage du cluster
<a name="demarrage_cluster_ELTTEXTE000214"></a>


### Démarrage automatique au boot
<a name="demarrage_automatique_boot_ELTPARAGRAPHE000232"></a>Le démarrage du cluster HFSQL se fait de façon automatique lors du démarrage (boot) des différents serveurs composant le cluster.

Le démarrage du cluster se fait dans l'ordre suivant :

1. Démarrage du service du coordinateur (service ClusterManager).

2. Démarrage des serveurs HFSQL des différents noeuds.

3. Connexion des noeuds au coordinateur.

4. Vérification de la synchronisation de toutes les bases de données. 
	En cas de désynchronisation, une synchronisation est lancée sur les noeuds dont la base n'est pas à jour. Si aucun noeud ne possède de façon certaine une base de données à jour (par exemple dans les cas où le cluster a été arrêté par une coupure de courant générale), il sera nécessaire de choisir manuellement le noeud qui servira de source de données pour la synchronisation. Pour connaître le détail de cette procédure, consultez Resynchronisation du cluster.

5. Le cluster est disponible pour traiter les demandes de connexions des applications clientes.





### Démarrage manuel après un arrêt forcé
<a name="demarrage_manuel_apres_arret_force_ELTPARAGRAPHE000250"></a>Si le cluster a été arrêté volontairement en utilisant le Centre de Contrôle HFSQL (option "Arrêter le cluster") ou à l'aide de la fonction [HClusterArrête](../WDLang4/1000019058.md), il est possible de le redémarrer avec le bouton "Démarrer le cluster" du Centre de Contrôle HFSQL ou grâce à la fonction [HClusterDémarre](../WDLang4/1000019057.md).

<a name="Noeud"></a>


## Gestion des noeuds
<a name="gestion_des_noeuds_ELTTEXTE000273"></a>


### Comment gérer les noeuds ? 
<a name="comment_gerer_les_noeuds_ELTPARAGRAPHE000291"></a>Lors de l'affichage des caractéristiques du cluster HFSQL dans le Centre de Contrôle HFSQL, la partie "Administration des noeuds" permet de visualiser les différents noeuds du cluster HFSQL et de voir leur état. 

Il est possible de : 

- Accéder au noeud sélectionné. Dans ce cas, il est nécessaire que le noeud soit actif. Vous devez alors préciser le nom d'utilisateur et le mot de passe associé. 

- Réintégrer le noeud sélectionné. Cette option permet par exemple de réintégrer un noeud en attente d'ajout. 

- Exclure le noeud. 




Rappel : 

- Pour ajouter un nouveau noeud au cluster HFSQL, il est nécessaire d'installer un serveur HFSQL version Cluster sur la machine cible. Lorsque l'installation est terminée, le noeud apparaît automatiquement dans la liste des noeuds du cluster. 

- Pour supprimer un noeud du cluster HFSQL, il est nécessaire de désinstaller le serveur HFSQL version Cluster sur la machine cible.  






<a name="Arret"></a>


## Arrêt du cluster
<a name="arret_cluster_ELTTEXTE000314"></a>


### Arrêt automatique à l'extinction des serveurs
<a name="arret_automatique_extinction_des_serveurs_ELTPARAGRAPHE000332"></a>Lorsqu'un serveur abritant un noeud d'un cluster HFSQL est éteint, le noeud est automatiquement exclu du cluster. Sa base de données sera resynchronisée automatiquement lorsque le serveur sera remis en fonctionnement.

Attention : L'arrêt du service ClusterManager n'arrête pas le cluster.


### Arrêt manuel du cluster
<a name="arret_manuel_cluster_ELTPARAGRAPHE000339"></a>Le cluster peut être arrêté manuellement à l'aide du Centre de Contrôle HFSQL en utilisant le bouton "Arrêter le cluster" présent dans le groupe "Cluster" de l'onglet d'administration du cluster.

Son redémarrage pourra être effectué comme indiqué dans Démarrage du cluster





## Panne d'un ou plusieurs noeuds
<a name="panne_plusieurs_noeuds_ELTTEXTE000360"></a>
Lorsqu'un ou plusieurs noeuds d'un cluster HFSQL tombent en panne (défaillance de la machine, du système d'exploitation ou coupure du réseau), plusieurs cas peuvent se présenter.

Le tableau ci-dessous récapitule les différents cas de figure pour un cluster de **N** noeuds dont **n** sont actifs :


| Nombre de nœuds<br>actifs (= *n*) | Effet |
| --- | --- |
| n &gt; N/2 | Plus de la moitié des noeuds est active : le cluster fonctionne normalement. |
| n = N/2 | Exactement la moitié des noeuds est active : le cluster fonctionne normalement si le coordinateur est également actif, sinon le cluster s'arrête. |
| n &lt; N/2 | Moins de la moitié des noeuds est active : le cluster s'arrête. |


Cette règle de fonctionnement évite que le cluster ne se trouve scindé en deux morceaux (phénomène de "split-brain") à la suite d'une coupure réseau et que chaque morceau continue de fonctionner indépendamment et désynchronise les bases. Seule la portion contenant plus de la moitié des noeuds restera active. Dans le cas particulier où le cluster se trouverait coupé en deux segments de même taille, la présence du coordinateur permet de départager les groupes.

<a name="Synchro"></a>


## Resynchronisation du cluster
<a name="resynchronisation_cluster_ELTTEXTE000412"></a>
Lorsque le cluster est démarré ou lorsqu'un noeud est ajouté, une synchronisation des bases de données est effectuée.

Deux cas peuvent se présenter :

- **Le cluster est démarré et les noeuds actifs ont une base de données synchrone**. 
	Le nouveau noeud se synchronise alors automatiquement avec l'état en cours du reste du cluster. Aucune action n'est à entreprendre. Dès que le nouveau noeud est synchronisé, il rejoint le cluster et traite les demandes de connexion des applications clientes.

- **Le cluster est arrêté et aucun noeud ne possède de façon certaine la version la plus à jour de la base de données**. 
	Ce cas se produit généralement à la suite d'une panne générale (coupure de courant, coupure réseau, etc.). Le cluster ne peut pas redémarrer automatiquement dans ce cas là. Il est nécessaire d'utiliser le Centre de Contrôle HFSQL pour sélectionner l'un des noeuds comme source de synchronisation. Sa base servira alors de référence et les autres noeuds se synchroniseront par rapport à lui.
	**Remarque** : Il convient de choisir le noeud de référence avec précaution. En effet, les bases de données des autres noeuds seront écrasées par la base de données du noeud de référence.




Remarque : Lors d'une synchronisation, une jauge permettant de suivre l'état d'avancement de la synchronisation est affichée dans le Centre de Contrôle HFSQL (par exemple, dans le tableau d'administration des noeuds, colonne "Etat"). Il est également possible de suivre l'état d'avancement de la synchronisation grâce à la fonction [HClusterInfoSynchronisation](../WDLang4/1000021974.md). La fonction [HClusterInfoErreurSynchronisation](../WDLang4/1000021975.md) permet de connaître la dernière erreur de synchronisation. 

<a name="Probleme"></a>


## Correction des problèmes potentiels signalés par le Centre de Contrôle HFSQL
<a name="correction_des_problemes_potentiels_signales_par_centre_controle_hfsql_ELTTEXTE000460"></a>
Le Centre de Contrôle HFSQL peut signaler un certain nombre de problèmes concernant l'état d'un cluster HFSQL et en corriger automatiquement une partie. Voici la liste des problèmes possibles :


### Aucune source de synchronisation
<a name="aucune_source_synchronisation_ELTPARAGRAPHE000481"></a>


|   |   |
| --- | --- |
| **Problème** | En attente d'une source de synchronisation. |
| **Cause** | Aucun des noeuds du cluster ne possède de base pour une synchronisation automatique. |
| **Résolution** | Choisir un noeud de référence pour la synchronisation.<br><br>Consultez le paragraphe Resynchronisation du cluster. |






### Aucune adresse IP associée au nom DNS
<a name="aucune_adresse_associee_nom_dns_ELTPARAGRAPHE000503"></a>


|   |   |
| --- | --- |
| **Problème** | Aucune adresse IP n'est associée au nom DNS &lt;nom DNS&gt; du cluster &lt;nom du cluster&gt;. |
| **Cause** | Aucune entrée de DNS ne correspond au nom DNS choisi pour le cluster. Les postes clients ne peuvent pas se connecter aux bases de données du cluster. |
| **Résolution** | Ajouter une entrée de DNS pour l'IP de chaque noeud du cluster correspondant au nom DNS choisi pour le cluster. Cette opération peut être faite automatiquement depuis le Centre de Contrôle HFSQL. |






### Un nœud n'est pas présent dans l'enregistrement DNS du cluster
<a name="nœud_nest_pas_present_dans_enregistrement_dns_cluster_ELTPARAGRAPHE000520"></a>


|   |   |
| --- | --- |
| **Problème** | Un noeud du cluster est installé sur la machine &lt;nom de machine&gt; alors que son adresse IP (&lt;adresse IP&gt;) n'est pas associée au nom DNS du cluster (&lt;nom DNS&gt;). |
| **Cause** | L'un des noeuds du cluster n'est pas référencé dans le DNS sous le nom DNS choisi pour le cluster. Ce noeud ne sera jamais sollicité par les applications clientes. |
| **Résolution** | Ajouter une entrée de DNS pour l'IP du noeud correspondant au nom DNS choisi pour le cluster. Cette opération peut être faite automatiquement depuis le Centre de Contrôle HFSQL. |






### Une entrée de DNS ne correspond pas à un noeud
<a name="une_entree_dns_correspond_pas_noeud_ELTPARAGRAPHE000537"></a>


|   |   |
| --- | --- |
| **Problème** | La machine &lt;nom de machine&gt; (adresse IP &lt;adresse IP&gt;) est associée au nom DNS du cluster (&lt;nom DNS&gt;) alors qu'elle ne correspond pas à un noeud de ce cluster. |
| **Cause** | L'enregistrement DNS du nom du cluster contient une adresse IP qui ne correspond pas à un noeud. Si une application cliente tente de se connecter à cette adresse, elle ne recevra pas de réponse et la durée de connexion sera rallongée. |
| **Résolution** | Supprimer l'entrée de DNS en trop. Cette opération peut être faite automatiquement depuis le Centre de Contrôle HFSQL. |






### Le cluster n'est associé à aucun nom DNS
<a name="cluster_nest_associe_aucun_nom_dns_ELTPARAGRAPHE000554"></a>


|   |   |
| --- | --- |
| **Problème** | Aucun nom DNS n'a été saisi pour le cluster. |
| **Cause** | Les applications clientes ne peuvent pas se connecter au cluster. |
| **Résolution** | Choisir un nom DNS pour le cluster et y associer toutes les IP des différents noeuds. Cette opération peut être faite automatiquement depuis le Centre de Contrôle HFSQL. |





<a name="AdminData"></a>


## Administration des bases de données HFSQL
<a name="administration_des_bases_donnees_hfsql_ELTTEXTE000607"></a>
L'administration des bases de données d'un cluster HFSQL se fait de la même façon que celle d'un serveur HFSQL autonome. Il est nécessaire de se connecter à la base de données depuis le Centre de Contrôle HFSQL.

Si la connexion à la base de données depuis le Centre de Contrôle HFSQL se fait en utilisant le nom DNS du cluster, cette connexion utilise un noeud quelconque du cluster (selon l'algorithme de répartition de charge).

Si la connexion à la base de données se fait en utilisant explicitement le nom d'un noeud (en outrepassant l'algorithme de répartition de charge), c'est la base de ce noeud qui est vue. Il est dans ce cas possible de voir la liste des utilisateurs connectés au noeud.

**Remarques**

- Quelle que soit la méthode de connexion employée, les données vues sont strictement les mêmes du fait du mécanisme de réplication du cluster.

- Si le cluster est en attente de synchronisation, il n'est pas possible de se connecter à la base de données.

- Si un noeud est en cours de resynchronisation, il n'est pas possible de se connecter à la base de données de ce noeud.







