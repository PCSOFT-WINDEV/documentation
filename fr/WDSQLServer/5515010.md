
## Connecteur Natif SQL Server : Programmation à l'aide des fonctions SQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000158"></a>
Que l'outil WDSQSINS.EXE soit utilisé ou non pour configurer la base de données accédée, il est possible d'utiliser les fonctions SQL pour manipuler la base de données SQL Server. Pour plus de détails sur WDSQSINS, consultez [Paramétrage de la connexion avec WDSQSINS](../WDSQLServer/5515007.md).

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Programmation
<a name="programmation_ELTTEXTE000182"></a>


### 1. Ouverture de la connexion
<a name="1_ouverture_connexion_ELTPARAGRAPHE000020"></a>La fonction [SQLConnecte](../WDLang4/3072005.md) permet d'ouvrir une connexion à une base de données SQL Server par le Connecteur Natif. Il est nécessaire de passer en paramètre à la fonction [SQLConnecte](../WDLang4/3072005.md) le type de la base utilisée, ici SQL SERVER.

Le nom de la base correspond :

- soit au nom donné dans WDSQSINS. 

- soit au nom du serveur SQL Server (ou à son alias). 
	
	```wl
	NumConnexion = SQLConnecte("BaseSQLServer", "", "", "", "SQL SERVER")
	```





**Remarques** : 

- Par défaut, la version installée du Connecteur Natif SQL Server est utilisée. Si vous avez installé à la fois le Connecteur Natif SQL Server via OLE DB et via ODBC, le Connecteur Natif via OLE DB est utilisé. Il est possible de sélectionner la version à utiliser. La variable [H.ModeSQLServer](../WDLang4/3044276.md) permet de forcer un mode grâce aux valeurs suivantes :

	- 0 pour forcer le Connecteur Natif SQL Server via OLE DB.

	- 3 pour forcer le Connecteur Natif SQL Server via ODBC.


 Cette variable doit être modifiée avant l'utilisation de la fonction [SQLConnecte](../WDLang4/3072005.md).

- **SQL Azure :** Si le nom du serveur est de type : NomServeur.database.windows.net, le login doit être de la forme : login@NomServeur. 



<a name="NOTE2_2"></a>


### 2. Exécution de requêtes
<a name="2_execution_requetes_ELTPARAGRAPHE000057"></a>L'exécution de requêtes est réalisée grâce à la fonction [SQLExec](../WDLang4/3072007.md). La fonction [SQLExec](../WDLang4/3072007.md) attend en paramètres le texte de la requête SQL et le nom qui sera donné à cette requête.


```wl
SQLExec("SELECT NOM, PRENOM, POSTE, PHOTO FROM CLIENT", "REQ1")
```

<a name="NOTE2_3"></a>


### 3. Récupération du résultat
<a name="3_recuperation_resultat_ELTPARAGRAPHE000072"></a>Plusieurs modes de récupération du résultat sont disponibles :

- [SQLPremier](../WDLang4/3072017.md) : Permet de récupérer le résultat et initialise un parcours du résultat de type **SQLPremier/SQLCol**.

- [SQLTable](../WDLang4/3072031.md) : Permet de récupérer le résultat de la requête dans un champ Table par programmation de l'application WINDEV. Il est possible de récupérer le résultat de la requête par Fetch partiel.

- [SQLAvance](../WDLang4/3072011.md) : Permet de parcourir les différentes lignes résultat de la requête. Le parcours du résultat de la requête est du type **SQLAvance/SQLLitCol**.




La fonction **SQLBloque** permet de bloquer soit les enregistrements de la table, soit les enregistrements sélectionnés par la requête. 


<a name="NOTE2_4"></a>


### 4. Fermeture de la connexion
<a name="4_fermeture_connexion_ELTPARAGRAPHE000092"></a>La fonction [SQLFerme](../WDLang4/3072015.md) permet de fermer la connexion à la base de données lorsque toutes les requêtes nécessaires ont été réalisées.


<a name="NOTE2_5"></a>


### SQL Azure
<a name="sql_azure_ELTPARAGRAPHE000105"></a>SQL Azure nécessite la présence d'un "clustered index" dans les fichiers de données.

Si vous créez les fichiers de données avec des requêtes SQL ou pour ajouter un clustered index à un fichier de données existant, consultez la documentation de SQL Azure pour connaître la syntaxe à utiliser.






