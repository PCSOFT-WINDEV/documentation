


## Etat sur une vue HFSQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000314"></a>
Un état sur une vue HFSQL permet d'imprimer des enregistrements provenant d'une vue HFSQL Classic ou Client/Serveur.

**Rappel** : Une vue HFSQL correspond à une "image mémoire" de tout ou partie d'un fichier de données. Une vue est stockée en mémoire, ce qui la rend insensible aux modifications effectuées sur le fichier de données associé. Une fois créée, une vue se manipule comme un fichier de données HFSQL. Pour plus de détails, consultez [Les vues HFSQL](../WDLang4/3044248.md).

**Caractéristiques d'un état sur une vue HFSQL** :

- un état sur une vue HFSQL est lié au **fichier de base** de cette vue HFSQL. L'état permet d'imprimer les enregistrements provenant de ce fichier de base.

- l' **ordre d'impression des enregistrements** correspond à l'ordre des **enregistrements** présents dans la vue HFSQL (défini lors de la création de la vue ou avec la fonction [HTrieVue](../WDLang4/3044114.md)).




La création d'un état sur une vue HFSQL s'effectue grâce à l'assistant de création d'un état.

Lorsque l'état sur une vue HFSQL est créé, il est possible à tout moment de :

- modifier la source de données de l'état (onglet "Données" de la description de l'état).

- ajouter ou supprimer des champs Rubriques liés à la vue HFSQL associée à l'état.


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png) | Important | [Le logiciel Etats & Requêtes](../Presentation/3088004.md) ne permet pas de créer des états sur une vue HFSQL. Cependant, il est possible de personnaliser des états sur une vue HFSQL créés sous l'éditeur d'états intégré (couleur, polices, taille, ...). |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer un état sur une vue HFSQL
<a name="creer_etat_sur_une_vue_hfsql_ELTTEXTE000362"></a>
Pour créer un état sur une vue HFSQL :

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif) parmi les boutons d'accès rapide. 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Etat" puis sur "Etat". 

	- L'assistant de création d'un état s'affiche.




2. Choisissez la présentation de votre état (tableau, fiche, étiquette, ...). Pour plus de détails, consultez [Les différents types d'états](../WDChamp/1011054.md).

3. Sélectionnez si nécessaire le modèle d'états à utiliser. Un modèle d'états permet de respecter une mise en page spécifique. Pour plus de détails sur les modèles d'états, consultez [Les modèles d'états](../WDChamp/9000105.md). 

4. Sélectionnez la source de données de l'état (option "Autre (programmation, fichier texte, zone mémoire, vue HFSQL, ...").

5. Sélectionnez le type de la source de données de l'état (option "d'une vue HFSQL").

6. Sélectionnez le fichier de données de base de la vue HFSQL associée à l'état.

7. Sélectionnez les rubriques affichées dans l'état. Seuls les champs reliés aux rubriques de la vue HFSQL seront renseignés.
	Pour chaque rubrique affichée dans l'état :

	- saisissez le libellé correspondant. Ce libellé sera affiché :

		- soit avant la rubrique. Par exemple :<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=etatLibelleFiche.gif)


		- soit dans l'entête de la colonne (cas des états Tableau). Par exemple :<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=etatLibelleTable.gif)
Ce libellé pourra être modifié directement sous l'éditeur d'états.

- sélectionnez le bloc dans lequel le champ associé à la rubrique doit être imprimé. La position des différents champs pourra être modifiée directement sous l'éditeur d'états. Pour plus de détails sur les différents blocs et sur leur position dans un état, consultez [Blocs d'un état](../WDChamp/1011040.md).

8. Modifiez si nécessaire l'ordre d'affichage des différents champs dans l'état à l'aide des boutons fléchés à droite du tableau.

9. Si la vue HFSQL associée à l'état contient au moins une rubrique de type numérique, il est possible de réaliser des calculs sur ces rubriques. Spécifiez le calcul réalisé pour chaque rubrique (somme, moyenne, ...). Deux types de calcul sont possibles :

	- **calcul général** : un champ Calculé sera créé dans le bloc *Fin de document*.

	- **calcul sur rupture** (inutile dans ce type d'état). 




10. Selon le type d'état en cours de création, indiquez les options spécifiques correspondantes.
	

| Type d'état | Options spécifiques |
| --- | --- |
| État sur formulaire | Image du formulaire, impression de l'image du formulaire, ...<br>Options détaillées dans la page [Etat sur formulaire](../WDChamp/1011067.md) |
| État Étiquette | Format des étiquettes, nombre d'exemplaires identiques, ...<br>Options détaillées dans la page [Etat Étiquette](../WDChamp/1011050.md) |



11. Spécifiez le format de la feuille sur laquelle l'état va être imprimé. Par défaut, l'état est imprimé sur une feuille au format A4. 
	Remarque : Par défaut, les champs de l'état sont disposés sur une seule colonne. Pour réaliser un état multicolonne, il suffit de spécifier le nombre de colonnes voulues dans l'onglet "Format" de la fenêtre de description de l'état.

12. Sélectionnez le gabarit de l'état si nécessaire.

13. Saisissez le nom et le titre de l'état (nom du fichier ".WDE" correspondant à l'état). Ce nom permettra d'identifier l'état dans vos programmes.
	![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Il est également possible d'indiquer si l'état peut être modifié par l'utilisateur final sous le logiciel "Etats & Requêtes". 

14. Validez la création de l'état. 

15. L'éditeur d'états propose automatiquement de changer le format de l'état utilisé si les conditions suivantes sont réunies :

	- l'état en cours de création comporte un tableau.

	- le format de l'état ne permet pas d'afficher l'ensemble des colonnes du tableau.




16. Si nécessaire, indiquez le mode de réduction de l'état : 

	- Imprimer l'état sur plusieurs pages. Dans ce cas, l'utilisateur final devra assembler les pages. Pour plus de détails, consultez [Impression multipage](../WDChamp/1011065.md). 

	- Utiliser le mode paysage. 

	- Réduire l'état par rapport à l'original. Attention : selon le pourcentage de réduction choisi, l'état imprimé pourra devenir illisible. 




17. L'état en cours de création s'affiche sous l'éditeur d'états.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Imprimer un état sur une vue HFSQL
<a name="imprimer_etat_sur_une_vue_hfsql_ELTTEXTE000386"></a>


### Pour imprimer un état sur une vue HFSQL
<a name="pour_imprimer_etat_sur_une_vue_hfsql_ELTPARAGRAPHE000152"></a>

1. Créer la vue HFSQL avec la fonction [HCréeVue](../WDLang4/3044159.md) (ou la fonction [HFusionneVue](../WDLang4/3044124.md)).

2. Paramétrer la destination de l'impression de l'état :

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) En WINDEV, grâce à la fonction [iDestination](../WDLang5/3046074.md) (visualisateur de rapports, impression dans un fichier HTML, ...).


 Pour plus de détails, consultez [Modes d'impression d'un état](../WDChamp/1011031.md).

3. Préciser les paramètres suivants grâce à la fonction [iImprimeEtat](../WDLang5/3046032.md) :

	- le nom de l'état à imprimer.

	- le nom de la vue HFSQL Classic utilisée.







Remarques :

- La vue HFSQL doit avoir été créée et initialisée avant de lancer l'impression de l'état. Seule une vue HFSQL Classic ou Client/Serveur peut être utilisée.

- Si des paramètres supplémentaires doivent être passés à l'état, ces paramètres doivent être indiqués dans la fonction [iImprimeEtat](../WDLang5/3046032.md), après le nom de la vue HFSQL utilisée. Pour plus de détails, consultez [Etat paramétré](../WDChamp/1011008.md).

- La propriété [NomVue](../Proprietes/2511030.md) utilisée dans le code de l'état permet de connaître et de changer la vue HFSQL associée à l'état.

- La propriété [NomSource](../Proprietes/2511035.md) utilisée dans le code de l'état permet de connaître et de changer le fichier de données de base de la vue HFSQL associée à l'état.


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png) | Important | Sous [le logiciel Etats & Requêtes](../Presentation/3088004.md), il est possible d'imprimer un état :<br><br>- soit en lançant une impression (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Imprimer.gif)). <br><br>- soit en testant l'état (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Go_Fenetre_WD_bl.gif)).<br><br><br>Il n'est donc pas nécessaire de programmer l'impression de l'état. |




<a name="NOTE3_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Exemple WINDEV
<a name="exemple_windev_ELTPARAGRAPHE000226"></a>L'utilisateur sélectionne la référence d'une commande dans une liste. Le champ Bouton "BTN_Imprimer" permet de :

- créer la vue HFSQL "VueCommande" contenant les lignes de la commande sélectionnée (fonction [HCréeVue](../WDLang4/3044159.md)).

- ouvrir la fenêtre du visualisateur de rapports (fonction [iDestination](../WDLang5/3046074.md)).

- imprimer l'état "ETAT_Vue" (fonction [iImprimeEtat](../WDLang5/3046032.md)).




Dans cet exemple, le code de clic du champ Bouton "BTN_Imprimer" est le suivant :

```wl
// Créer la vue
SI HCréeVue("VueCommande", LigneCde, "*", "Référence", "", "", ...
		hVueExclusive + hVueInterruptible) = Faux ALORS
	Erreur(HErreurInfo())
SINON
	// Ouvrir le visualisateur de rapports
	iDestination(iVisualisateur)
	// Imprimer l'état ETAT_Vue
	iImprimeEtat(ETAT_Vue, "VueCommande")
FIN
```

<a name="NOTE3_4"></a>


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDEtats.gif) ***Exemples didactiques (WINDEV)*** : **WD Etats** <br>Cet exemple montre les différentes méthodes pour réaliser un état :<br> <br>- impressions basées sur différentes sources de données (requêtes, variables, ...)<br>- impressions basées sur des champs (Table, Tableur, TCD, ...)<br>- impression d'états composés<br>- impressions spécifiques (portrait / paysage, état avec filigrane, état avec code-barres, ...)


