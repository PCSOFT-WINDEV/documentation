
## Etat sur une zone mémoire
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000310"></a>
Un état sur une zone mémoire permet d'imprimer les enregistrements stockés dans une zone mémoire. La zone mémoire doit **obligatoirement** contenir tous les numéros des enregistrements du fichier de données à imprimer.

**Remarque** : Ce type d'état n'est pas disponible en WINDEV Mobile.

**Caractéristiques d'un état sur une zone mémoire** :

- un état sur une zone mémoire est lié au **fichier de données de base** de cette zone mémoire. L'état permet d'imprimer les enregistrements provenant de ce fichier de données de base.

- l' **ordre d'impression des enregistrements** correspond à l'ordre des **numéros d'enregistrements** présents dans la zone mémoire.




Il est ainsi possible par exemple de :

- stocker dans une zone mémoire les numéros d'enregistrements sélectionnés par un ou plusieurs traitements.

- imprimer les enregistrements uniquement lorsque la sélection aura été réalisée.




La création d'un état sur une zone mémoire s'effectue grâce à l'assistant de création d'un état.

Pour tester un état sur zone mémoire, il est nécessaire de :

- créer et d'initialiser la zone mémoire.

- imprimer l'état.




Lorsque l'état sur une zone mémoire est créé, il est possible à tout moment de :

- modifier la source de données de l'état (onglet "Données" de la description de l'état).

- ajouter ou supprimer des champs Rubriques liés à la zone mémoire associée à l'état.




|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png)<br> | Important | [Le logiciel Etats & Requêtes](../Presentation/3088004.md) ne permet pas de créer des états sur une zone mémoire. Cependant, il est possible de personnaliser des états sur une zone mémoire créés sous l'éditeur d'états intégré (couleur, polices, taille, ...). |









<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer un état sur une zone mémoire
<a name="creer_etat_sur_une_zone_memoire_ELTTEXTE000352"></a>
Pour créer un état sur une zone mémoire :

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif)
 parmi les boutons d'accès rapide. 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Etat" puis sur "Etat". 

	- L'assistant de création d'un état s'affiche.




2. Choisissez la présentation de votre état (tableau, fiche, étiquette, ...). Pour plus de détails, consultez [Les différents types d'états](../WDChamp/1011054.md).

3. Sélectionnez si nécessaire le modèle d'états à utiliser. Un modèle d'états permet de respecter une mise en page spécifique. Pour plus de détails sur les modèles d'états, consultez [Les modèles d'états](../WDChamp/9000105.md). 

4. Sélectionnez la source de données de l'état (option "Autre (programmation, fichier texte, zone mémoire, vue HFSQL, ...").

5. Sélectionnez le type de la source de données ("d'une zone mémoire que j'ai remplie par programmation").

6. Sélectionnez le fichier de données de base de la zone mémoire associée à l'état.

7. Sélectionnez les rubriques de tri de l'état. Ces rubriques seront utilisées pour trier les données imprimées dans l'état. Pour plus de détails sur les tris, consultez les [Tris dans un état](../WDChamp/1011035.md).

8. Pour grouper les enregistrements, il est possible de créer des ruptures sur les rubriques de tri. Pour créer des ruptures, répondez "Oui" à la question "Voulez-vous des ruptures dans l'état ?".
	L'étape suivante permet alors de sélectionner les rubriques de tri correspondant aux ruptures. Pour plus de détails sur les ruptures, consultez les [Ruptures dans un état](../WDChamp/1011028.md).

9. Sélectionnez les rubriques affichées dans l'état. Seuls les champs reliés aux rubriques de la zone mémoire seront renseignés.
	Pour chaque rubrique du fichier affichée dans l'état :

	- saisissez le libellé correspondant. Ce libellé sera affiché :

		- soit avant la rubrique. Par exemple :![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=etatLibelleFiche.gif)


		- soit dans l'entête de la colonne (cas des états Tableau). Par exemple :![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=etatLibelleTable.gif)
Ce libellé pourra être modifié directement sous l'éditeur d'états.

- sélectionnez le bloc dans lequel le champ associé à la rubrique doit être imprimé. La position des différents champs pourra être modifiée directement sous l'éditeur d'états. Pour plus de détails sur les différents blocs et sur leur position dans un état, consultez [Blocs d'un état](../WDChamp/1011040.md).

10. Modifiez si nécessaire l'ordre d'apparition des différents champs dans l'état à l'aide des boutons fléchés à droite du tableau.

11. Si le fichier de données de base de la zone mémoire associée à l'état contient au moins une rubrique de type numérique, il est possible de réaliser des calculs sur ces rubriques. Spécifiez le calcul réalisé pour chaque rubrique (somme, moyenne, ...). Deux types de calcul sont possibles :

	- **calcul général** : un champ Calculé sera créé dans le bloc *Fin de document*.

	- **calcul sur rupture** : un champ Calculé sera créé dans le bloc *Bas de rupture*. Dans les calculs sur rupture, le résultat du calcul est réinitialisé à chaque rupture. Pour réaliser un calcul sur rupture, une rupture doit être présente dans l'état en cours de création.




12. Selon le type d'état en cours de création, indiquez les options spécifiques correspondantes.
	

| Type d'état | Options spécifiques |
| --- | --- |
| État sur formulaire | Image du formulaire, impression de l'image du formulaire, ...<br>Options détaillées dans la page [Etat sur formulaire](../WDChamp/1011067.md) |
| État Étiquette | Format des étiquettes, nombre d'exemplaires identiques, ...<br>Options détaillées dans la page [Etat Étiquette](../WDChamp/1011050.md) |



13. Spécifiez le format de la feuille sur laquelle l'état va être imprimé. Par défaut, l'état est imprimé sur une feuille au format A4.
	Remarque : Par défaut, les champs de l'état sont disposés sur une seule colonne. Pour réaliser un état multicolonne, il suffit de spécifier le nombre de colonnes voulues dans l'onglet "Format" de la fenêtre de description de l'état. 

14. Sélectionnez le gabarit de l'état si nécessaire.

15. Saisissez le nom et le titre de l'état (nom du fichier ".WDE" correspondant à l'état). Ce nom permettra d'identifier l'état dans vos programmes.
	![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Il est également possible d'indiquer si l'état peut être modifié par l'utilisateur final sous le logiciel "Etats & Requêtes". 

16. Validez la création de l'état. 

17. L'éditeur d'états propose automatiquement de changer le format de l'état utilisé si les conditions suivantes sont réunies :

	- l'état en cours de création comporte un tableau.

	- le format de l'état ne permet pas d'afficher l'ensemble des colonnes du tableau.




18. Si nécessaire, indiquez le mode de réduction de l'état : 

	- Imprimer l'état sur plusieurs pages. Dans ce cas, l'utilisateur final devra assembler les pages. Pour plus de détails, consultez [Impression multipage](../WDChamp/1011065.md).

	- Utiliser le mode paysage. 

	- Réduire l'état par rapport à l'original. Attention : selon le pourcentage de réduction choisi, l'état imprimé pourra devenir illisible. 




19. L'état en cours de création s'affiche sous l'éditeur d'états.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Imprimer un état sur une zone mémoire
<a name="imprimer_etat_sur_une_zone_memoire_ELTTEXTE000376"></a>
Pour imprimer un état sur une zone mémoire :

1. Créez la zone mémoire avec la fonction [MemCrée](../WDLang1/3053005.md).

2. Ajoutez des enregistrements dans la zone mémoire avec la fonction [MemAjoute](../WDLang1/3053002.md) et triez si nécessaire ces enregistrements grâce à la fonction [MemTrie](../WDLang1/3053020.md).

3. Paramétrez la destination de l'impression de l'état grâce à la fonction [iAperçu](../WDLang5/3046069.md) (aperçu avant impression, impression dans un fichier HTML, ...). Pour plus de détails, consultez [Modes d'impression d'un état](../WDChamp/1011031.md).

4. Précisez les paramètres suivants grâce à la fonction [iImprimeEtat](../WDLang5/3046032.md) :

	- le nom de l'état à imprimer.

	- le nom de la zone mémoire utilisée.




5. Supprimez la zone mémoire avec la fonction [MemSupprimeTout](../WDLang1/3053019.md) à la fin de l'impression de l'état.




Remarques :

- Si des paramètres supplémentaires doivent être passés à l'état, ces paramètres doivent être indiqués dans la fonction [iImprimeEtat](../WDLang5/3046032.md), après le nom de la zone mémoire utilisée. Pour plus de détails, consultez [Etat paramétré](../WDChamp/1011008.md).

- La propriété [NomZoneMem](../Proprietes/2511029.md) utilisée dans le code de l'état permet de connaître et de changer le nom de la zone mémoire associée à l'état.

- La propriété [NomSource](../Proprietes/2511035.md) utilisée dans le code de l'état permet de connaître et de changer le nom du fichier de base de la zone mémoire associée à l'état.


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png)<br> | Important | Sous [le logiciel Etats & Requêtes](../Presentation/3088004.md), il est possible d'imprimer un état :<br><br>- soit en lançant une impression (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Imprimer.gif)<br>). <br><br>- soit en testant l'état (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Go_Fenetre_WD_bl.gif)<br>).<br><br><br>Il n'est donc pas nécessaire de programmer l'impression de l'état. |






<a name="NOTE3_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Exemple WINDEV
<a name="exemple_windev_ELTPARAGRAPHE000224"></a>L'utilisateur sélectionne les clients auxquels une offre commerciale doit être envoyée. Le nom des clients sélectionnés est contenu dans le champ Liste "Destinataire".

Après avoir sélectionné l'ensemble des clients, l'utilisateur clique sur le bouton "BTN_Imprimer" pour imprimer l'état "ETAT_ZoneMem".

Lors d'un clic sur le champ Bouton "Imprimer" :

- la zone mémoire "ZoneMem" est créé.

- le numéro d'enregistrement de chaque client sélectionné est récupéré et ajouté dans la zone mémoire "ZoneMem".

- l'état "ETAT_ZoneMem" est imprimé.

- la zone mémoire "ZoneMem" est détruite.




Dans cet exemple, le code de clic du champ Bouton "BTN_Imprimer" est le suivant :

```wl
nIndice est un entier
// Créer la zone mémoire
MemCrée("ZoneMem")
// Parcourir la liste LISTE_Destinataire et initialiser la zone mémoire
POUR nIndice = 1 _A_ LISTE_Destinataire.Occurrence
	// Rechercher l'enregistrement en cours
	HLitRecherche(Client, Nom, LISTE_Destinataire[nIndice])
	SI HTrouve(Client) = Vrai ALORS
		// Ajouter les éléments dans la zone mémoire
		MemAjoute("ZoneMem", "", HNumEnr())
	FIN
FIN
// Ouvrir le visualisateur de rapports
iDestination(iVisualisateur)
// Imprimer l'état
iImprimeEtat(ETAT_ZoneMem, "ZoneMem")
// Destruction de la zone mémoire
MemSupprimeTout("ZoneMem")
```

<a name="NOTE3_3"></a>


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDEtats.gif) ***Exemples didactiques (WINDEV)*** : **WD Etats** <br>Cet exemple montre les différentes méthodes pour réaliser un état :<br> <br>- impressions basées sur différentes sources de données (requêtes, variables, ...)<br>- impressions basées sur des champs (Table, Tableur, TCD, ...)<br>- impression d'états composés<br>- impressions spécifiques (portrait / paysage, état avec filigrane, état avec code-barres, ...)


