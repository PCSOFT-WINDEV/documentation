


## Gestion des contextes HFSQL dans les fenêtres et dans les états
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000242"></a>
Un contexte HFSQL contient toutes les informations relatives aux données manipulées :

- Informations sur l'enregistrement en cours : numéro de l'enregistrement, contenu des rubriques, ...

- Valeurs des fonctions [HTrouve](../WDLang4/3044104.md), [HEnDehors](../WDLang4/3044094.md), ...

- Caractéristiques du filtre en cours.

- Caractéristiques de la recherche en cours.

- Caractéristiques du parcours en cours.

- Nom des fichiers ouverts.

- Nom et caractéristiques des requêtes (fonctions [HExécuteRequêteSQL](../WDLang4/3044084.md), [HExécuteRequête](../WDLang4/3044080.md), [SQLExec](../WDLang4/3072007.md), [SQLExecWDR](../WDLang4/3072010.md)).




**Remarque** : Une seule transaction est possible par contexte HFSQL.


<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Qu'est-ce qu'un contexte HFSQL ?
<a name="questce_quun_contexte_hfsql_ELTTEXTE000272"></a>


### Contexte HFSQL indépendant
<a name="contexte_hfsql_independant_ELTPARAGRAPHE000047"></a>WINDEV permet de créer des contextes HFSQL indépendants :

- Pour les fenêtres WINDEV.

- Pour les états WINDEV.

- [Pour la manipulation de threads](../WDLang1/3077026.md).




Lors de l'ouverture de la fenêtre (ou de l'état), le contexte HFSQL existant est automatiquement "doublé" (une copie du contexte existant est réalisé) : les opérations réalisées dans chacun des contextes seront indépendantes de celles réalisées dans les autres contextes. La gestion du contexte indépendant permet d'obtenir le même résultat que si 2 instances de la même application s'exécutaient en parallèle.

La gestion d'un contexte HFSQL indépendant est recommandée pour les applications MDI et multi-thread.

**Le contexte HFSQL indépendant est pris en compte :**

- Lors de la manipulation d'une base de données HFSQL avec des [fonctions HFSQL](../WDLang4/3044156.md) (fonctions commençant par la lettre H).

- Lors de la manipulation d'une base de données HFSQL avec des [fonctions SQL](../WDLang4/3072002.md) (fonctions commençant par les lettres SQL).

- Lors de la manipulation d'une base de données quelconque via un driver ODBC, en utilisant les [fonctions SQL](../WDLang4/3072002.md).




**Remarques** : 

- Il est impossible d'accéder depuis du code global d'une fenêtre mère MDI à une requête exécutée dans une fenêtre fille qui a un contexte HFSQL indépendant, même si la source de données utilisée est globale au projet.

- Tous les Connecteurs Natifs gèrent les contextes HFSQL indépendants : la copie de contexte est effectuée et les opérations effectuées seront indépendantes. Cependant, certains Connecteurs Natifs ne gèrent pas le transfert de la position courante au moment de la copie. Il est dans ce cas nécessaire de se repositionner sur l'enregistrement courant après la copie de contexte. 



<a name="NOTE2_2"></a>


### Transactions et contexte HFSQL indépendant
<a name="transactions_contexte_hfsql_independant_ELTPARAGRAPHE000084"></a>Lors de la copie de contexte, si une transaction est en cours sur le premier contexte, le nouveau contexte n'est pas en transaction. Il faut rappeler la fonction [HTransactionDebut](../WDLang4/3044002.md) pour démarrer une transaction dans le nouveau contexte.
<a name="NOTE2_3"></a>


### Limitation : Fichiers de données au format 5.5 et Vues au format Hyper File 5.5
<a name="limitation_fichiers_donnees_format_55_vues_format_hyper_file_55_ELTPARAGRAPHE000094"></a>

- Les contextes indépendants ne sont pas gérés sur les fichiers Hyper File 5.5.

- La copie d'un contexte HFSQL (création d'un contexte HFSQL indépendant à partir du contexte existant au moment de la copie) échoue si une vue Hyper File 5.5 (fonction HCréeVue_55 conservée par compatibilité) est présente dans le contexte HFSQL d'origine.



<a name="NOTE2_5"></a>


### Limitation : Contexte HFSQL indépendant et utilisation d'un driver ODBC
<a name="limitation_contexte_hfsql_independant_utilisation_driver_odbc_ELTPARAGRAPHE000105"></a>Attention : la requête sera dupliquée uniquement si la copie du contexte (ouverture de la fenêtre ou de l'état) est réalisée APRES avoir initialisé le parcours du résultat avec la fonction [SQLPremier](../WDLang4/3072017.md).


|   |   |
| --- | --- |
| **Ne pas faire**<br><br><pre><code>SI SQLExec("Requête1") ALORS <br>	Ouvre(FEN_Résultat)<br>FIN</code></pre><br> | **Faire**<br><br><pre><code>SI SQLExec("Requête1") ALORS<br>	SQLPremier("Requête1")<br>	Ouvre(FEN_Résultat)<br>FIN</code></pre><br> |



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Contextes HFSQL et fenêtres
<a name="contextes_hfsql_fenetres_ELTTEXTE000314"></a>


### Comment gérer le contexte HFSQL de fenêtre ?
<a name="comment_gerer_contexte_hfsql_fenetre_ELTPARAGRAPHE000126"></a>Pour gérer ou non le contexte HFSQL indépendant d'une fenêtre :

1. Affichez la description de la fenêtre.

2. Affichez l'onglet "Détail".

3. Cochez ou non l'option "Contexte HFSQL indépendant".



<a name="NOTE3_2"></a>


### Si les contextes HFSQL ne sont pas indépendants pour chaque fenêtre (option non cochée)
<a name="les_contextes_hfsql_sont_pas_independants_pour_chaque_fenetre_option_non_cochee_ELTPARAGRAPHE000141"></a>A chaque ouverture de fenêtre, le contexte HFSQL est mis à jour en fonction des manipulations réalisées dans la fenêtre.

Toutes les fenêtres travaillent sur le même contexte HFSQL.

Si une même fenêtre est ouverte plusieurs fois en parallèle dans l'application, les contextes HFSQL risquent de se chevaucher et les données manipulées ne correspondront pas aux données souhaitées.
<a name="NOTE3_3"></a>


### Si les contextes HFSQL sont indépendants pour chaque fenêtre (option cochée)
<a name="les_contextes_hfsql_sont_independants_pour_chaque_fenetre_option_cochee_ELTPARAGRAPHE000152"></a>Le contexte HFSQL en cours est complètement copié à chaque nouvelle ouverture de fenêtre. Il est ainsi possible de faire des opérations différentes (filtres, tris, recherches) sur le même fichier dans des fenêtres ouvertes en parallèles. Chaque fenêtre a son propre contexte. Aucun risque de confusion de données.

Chaque contexte HFSQL étant indépendant, il est possible de gérer les blocages des enregistrements dans chaque contexte. La fermeture d'une fenêtre ayant un contexte indépendant :

- débloquera automatiquement les enregistrements bloqués par cette fenêtre,

- fermera le contexte correspondant.




De même, une fonction HFSQL utilisée dans un contexte n'aura d'effet que dans ce contexte. Ainsi si la gestion des mémos est active à l'ouverture des contextes indépendants, il est possible de désactiver cette fonctionnalité dans une fenêtre : la désactivation des mémos sera uniquement réalisée dans le contexte correspondant à la fenêtre.

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Contextes HFSQL et états
<a name="contextes_hfsql_etats_ELTTEXTE000350"></a>


### Comment gérer le contexte HFSQL d'état ?
<a name="comment_gerer_contexte_hfsql_etat_ELTPARAGRAPHE000168"></a>Pour gérer ou non le contexte HFSQL indépendant d'un état:

1. Affichez la description de l'état (option "Description de l'état" du menu contextuel de l'état).

2. Dans l'onglet "Données", cochez ou non l'option "L'exécution de l'état n'affecte pas les parcours (contexte HFSQL indépendant)".



<a name="NOTE4_2"></a>


### Si les contextes HFSQL ne sont pas indépendants pour chaque état
<a name="les_contextes_hfsql_sont_pas_independants_pour_chaque_etat_ELTPARAGRAPHE000182"></a>A chaque impression d'état, le contexte HFSQL est mis à jour en fonction des manipulations réalisées dans l'état. Toutes les états en cours d'impression utilisent le même contexte HFSQL.

Si plusieurs états parcourent simultanément le même fichier, il est recommandé d'utiliser des contextes HFSQL indépendants.
<a name="NOTE4_3"></a>


### Si les contextes HFSQL sont indépendants pour chaque état
<a name="les_contextes_hfsql_sont_independants_pour_chaque_etat_ELTPARAGRAPHE000191"></a>Le contexte HFSQL en cours est complètement copié à chaque nouvelle impression d'un état. Il est ainsi possible de faire des opérations différentes (filtres, tris, recherches) sur le même fichier dans des états ouverts en parallèle. Chaque état a son propre contexte. Aucun risque de confusion de données.


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDMulti-Fenetrage.gif) ***Exemples didactiques (WINDEV)*** : **WD Multi-Fenetrage** <br>Cet exemple permet de comprendre les bases de la gestion du Multi-fenêtrage et des onglets dynamiques avec WINDEV.<br><br>Cet exemple présente une interface simple de gestion de fiches client sous deux formes :<br>- multi fenêtrée avec une interface MDI,<br>- multi onglets avec un champ onglet dynamique.


