


## Rupture dans un état
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000223"></a>
La rupture permet de grouper les enregistrements correspondant à un argument de tri. Pour chaque argument de tri, une rupture peut être demandée.

Par exemple, pour lister les clients par ville, il suffira de trier les clients par ville puis par nom et de faire une rupture sur la ville.
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=EtatRupture.gif)
L'ajout d'une rupture génère automatiquement les blocs *Début de rupture* et *Fin de rupture*. Ces blocs permettent par exemple de :

- afficher le contenu de la rubrique de rupture (généralement dans le bloc *Début de rupture*).

- réaliser des calculs sur les enregistrements de la rupture (généralement dans le bloc *Fin de rupture*).




Deux types de ruptures sont disponibles :

- **rupture automatique**. La rupture est réalisée sur une rubrique appartenant à la source de données de l'état.

- **rupture programmée**. La rupture est entièrement définie par programmation dans l'événement "Valeur de rupture" du bloc *Début de rupture*.




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Ajout d'une rupture
<a name="ajout_une_rupture_ELTTEXTE000247"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000030"></a>Selon la source de données de l'état, les opérations à effectuer pour ajouter une rupture ne sont pas les mêmes.

Deux cas se distinguent :

- ajout d'une rupture dans un état basé sur un fichier de données, une requête ou une zone mémoire.

- ajout d'une rupture dans un état basé sur un fichier texte, un champ Table ou une vue HFSQL.



<a name="NOTE2_2"></a>


### Ajouter une rupture dans un état basé sur un fichier de données, une requête ou une zone mémoire
<a name="ajouter_une_rupture_dans_etat_base_sur_fichier_donnees_une_requete_une_zone_memoire_ELTPARAGRAPHE000042"></a>Pour ajouter une rupture dans un état basé sur un fichier de données, une requête ou une zone mémoire : 

1. Sous le volet "Création", dans le groupe "Structure", cliquez sur "Ruptures". La fenêtre suivante s'affiche : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=EtatRuptureAjout.gif)
Les critères de tri de l'état sont listés sur la gauche. Les ruptures de l'état sont listées sur la droite.

2. Pour ajouter :

	- une **rupture basée sur un critère de tri** : sélectionnez le critère de tri désiré et cliquez sur le bouton "Créer une rupture sur le tri sélectionné" (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=EtatRuptureAjout%201.gif)
).

	- une **rupture programmée** : cliquez sur le bouton "Ajouter une rupture programmée" (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=etatIconeNewcritereTri.gif)
 dans la liste des ruptures). Le code de cette rupture programmée devra être saisi dans l'événement "Valeur de rupture" du bloc *Début de rupture*. Pour plus de détails sur les ruptures programmées, consultez le paragraphe [Evénement Rupture?](#NOTE3_1).




3. Les ruptures seront réalisées selon leur ordre d'affichage. Modifiez si nécessaire cet ordre à l'aide des boutons fléchés à droite du tableau.

4. Validez l'ajout de la nouvelle rupture.




**Remarque** : Lors de l'ajout d'une nouvelle rupture, les blocs *Début de rupture* et *Fin de rupture* sont automatiquement créés.
<a name="NOTE2_3"></a>


### Ajouter une rupture dans un état basé sur un fichier texte, un champ Table ou une vue HFSQL
<a name="ajouter_une_rupture_dans_etat_base_sur_fichier_texte_champ_table_une_vue_hfsql_ELTPARAGRAPHE000080"></a>Pour ajouter une rupture dans un état basé sur un fichier texte, un champ Table ou une vue HFSQL : 

1. Sous le volet "Création", dans le groupe "Structure", cliquez sur "Ruptures". La fenêtre suivante s'affiche : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=EtatRuptureAjout2.gif)


2. Cliquez sur le bouton "Ajouter une rupture" (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=etatIconeNewcritereTri.gif)
).

3. Pour ajouter :

	- une **rupture basée sur une rubrique** : sélectionnez la rubrique désirée et validez.

	- une **rupture programmée** : sélectionnez l'option "(Aucune rubrique)" et validez. Le code de cette rupture programmée devra être saisi dans l'événement "Valeur de rupture" du bloc *Début de rupture*. Pour plus de détails sur les ruptures programmées, consultez le paragraphe [Evénement Rupture?](#NOTE3_1).




4. Les ruptures seront réalisées selon leur ordre d'affichage. Modifiez si nécessaire cet ordre à l'aide des boutons fléchés à droite du tableau.

5. Validez l'ajout de la nouvelle rupture.




**Remarque** : Lors de l'ajout d'une nouvelle rupture, les blocs *Début de rupture* et *Fin de rupture* sont automatiquement créés.

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Evénement Rupture?
<a name="evenement_rupture_ELTTEXTE000283"></a>
<a name="Traitement_rupture"></a>
Si votre état comprend une ou plusieurs ruptures programmées, l'événement "Rupture?" est associé au bloc *Début de rupture*.

Cet événement permet d'utiliser une rupture programmée. Deux types de programmation de rupture peuvent être mis en place :

- l'événement renvoie <u><u><u><u>Vrai</u></u></u></u> ou <u><u><u><u>Faux</u></u></u></u> (<u><u><u><u>Vrai</u></u></u></u> pour effectuer la rupture, <u><u><u><u>Faux</u></u></u></u> pour ne pas effectuer la rupture).

- l'événement renvoie la valeur de la rupture. Si la valeur change, la rupture est automatiquement réalisée par l'état (voir exemple ci-dessous).
	La valeur de la rupture peut correspondre à la valeur d'une rubrique, d'un champ de l'état, d'une variable, ...




**Remarque** : Si la valeur de la rupture correspond à la valeur d'un champ de l'état, la valeur retournée sera fausse si ce champ est contenu dans le bloc *Corps* de l'état. En effet, l'événement de rupture est exécuté avant le remplissage des champs présents dans le bloc *Corps*. Dans ce cas, il suffit de renvoyer la valeur de la rubrique liée au champ.

```wl
// -- Code de rupture
nFournisseur est un entier = 0
// Récupérer l'identifiant du fournisseur
nFournisseur = ExtraitChaîne(gfsLigne, 1, TAB)
// Rechercher le nom du fournisseur
HLitRecherchePremier(Fournisseur, NumFournisseur, nFournisseur)
SI HTrouve() = Vrai ALORS
	// Initialiser le champ
	NomFournisseur = Fournisseur.Société
FIN
// Renvoyer l'identifiant du fournisseur
RENVOYER nFournisseur
```

**Important** : Le code de rupture est exécuté **uniquement** si la rupture correspondante est une rupture programmée (non reliée à un critère de tri).

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Saut de page
<a name="saut_page_ELTTEXTE000307"></a>
Pour réaliser un saut de page à la suite d'une rupture : 

1. Ouvrez la fenêtre de description du bloc "Fin de rupture" (option "Description" du menu contextuel).

2. Dans l'onglet "UI", sélectionnez l'option "Saut de page après le bloc".




**Remarque** : Il est également possible d'effectuer ce saut de page par programmation :

- fonction [iTerminePage](../WDLang5/3046038.md) si l'état a été créé avec l'éditeur d'états.

- fonction [iSautePage](../WDLang5/3046073.md) si l'état est imprimé grâce aux [fonctions d'impression](../WDLang5/3046065.md).





