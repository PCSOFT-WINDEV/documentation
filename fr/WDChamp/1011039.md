


## Bloc Itération (ou bloc de substitution)
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000208"></a>
Le bloc **Itération** est un bloc libre, créé manuellement sous l'éditeur d'états. Il peut être utilisé comme n'importe quel autre type de bloc. Par exemple, un bloc **Itération** peut être utilisé pour remplacer un bloc *Entête de page* pour différencier les pages paires et les pages impaires.

La substitution de blocs est réalisée en programmation grâce à la fonction [iSubstBloc](../WDLang5/3046048.md). Il est également possible d'imprimer un bloc spécifique grâce à la fonction [iImprimeBloc](../WDLang5/3046030.md).

**Remarque** : A partir de la version 19, les plans sont disponibles dans les états. Dans la majorité des cas, l'utilisation des plans dans les états permet de remplacer l'utilisation des blocs d'itération. L'utilisation des plans dans les états est plus simple que l'utilisation des blocs d'itération. Pour plus de détails, consultez [Les plans](../WDChamp/1013078.md).



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Création du bloc Itération
<a name="creation_bloc_iteration_ELTTEXTE000232"></a>
Pour créer un bloc Itération : 

1. Effectuez une des manipulations suivantes sous l'éditeur d'états :

	- sous le volet "Création", dans le groupe "Structure", déroulez "Blocs".

	- sélectionnez l'option "Ajouter un bloc" du menu contextuel de l'état (clic droit sur l'état en cours de création).

	- cliquez sur le bouton "Ajouter un bloc" dans l'onglet "Blocs" de la description de l'état.




2. Sélectionnez le type "Bloc d'itération".




Remarque : Par défaut, les blocs d'itération sont affichés selon l'ordre de création des blocs. Il est possible de modifier cet ordre sous l'éditeur. Pour plus de détails, consultez [Manipulations des blocs d'un état](../WDChamp/1011041.md). 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Imprimer un bloc Itération
<a name="imprimer_bloc_iteration_ELTTEXTE000256"></a>
Un bloc *Itération* permet de :

- remplacer un bloc existant.

- ajouter un bloc supplémentaire à l'état.



<a name="NOTE3_2"></a>


### Remplacer un bloc existant
<a name="remplacer_bloc_existant_ELTPARAGRAPHE000082"></a>La programmation nécessaire au remplacement d'un bloc existant est illustrée par l'exemple suivant :
|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=exemple-WD.png) | Exemple | Le haut de page de mon état doit être différent pour les pages paires et les pages impaires.<br>Le bloc *Haut de page* (bloc "HautPage") correspond aux pages impaires (il sera imprimé sur la page 1,3,5, ...). Ce bloc sera donc imprimé sur la première page de mon état.<br>Le bloc *Itération* (bloc "Itération") correspond aux pages paires. |





1. Ajoutez si nécessaire un bloc *Haut de page* : sous le volet "Création", dans le groupe "Structure", déroulez "Blocs" et sélectionnez "Haut de page". Le nom de ce bloc est "HautPage".

2. Personnalisez le bloc "HautPage" comme celui correspondant aux pages impaires.

3. Dans l'événement "Après impression" du bloc "HautPage", saisissez le code suivant :
	
	```wl
	// --Après impression de HautPage
	// Substitution du bloc HautPage par le bloc
	// Itération sur la prochaine page de mon état
	iSubstBloc(HautPage, Itération)
	```


4. Ajoutez si nécessaire un bloc *Itération* : sous le volet "Création", dans le groupe "Structure", déroulez "Blocs" et sélectionnez "Bloc d'itération". Le nom de ce bloc est "Itération".

5. Personnalisez le bloc "Itération" comme celui correspondant aux pages paires.

6. Dans l'événement "Après impression" du bloc "Itération", saisissez le code suivant :
	
	```wl
	// --Après impression de Itération 
	// Annulation de la substitution du bloc HautPage 
	// par le bloc Itération sur la prochaine page de mon état
	iSubstBloc(HautPage, "")
	```



**Remarque** : Pour substituer un bloc *Bas de page*, il est conseillé d'utiliser des blocs de même hauteur pour éviter des problèmes d'impression.
<a name="NOTE2_3"></a>


### Ajouter un bloc supplémentaire à l'état
<a name="ajouter_bloc_supplementaire_etat_ELTPARAGRAPHE000135"></a>La programmation nécessaire à l'ajout d'un bloc *Itération* supplémentaire est illustrée par l'exemple suivant :
|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=exemple-WD.png) | Exemple | L'état "ETAT_EtatProduit" imprime la description de chaque produit proposé à la vente (une rupture est effectuée sur "NumProduit"). Certains produits font l'objet d'une promotion. Dans ce cas, la rubrique "Promotion" du fichier de données "Produit" correspond à Vrai. Cette rubrique est de type booléen.<br>Pour les produits en promotion, le bloc "Itération" est ajouté à l'état. Ce bloc décrit le type de promotion s'appliquant au produit en cours (achat de deux produits pour le prix d'un, 20% du produit gratuit en plus, ...). |





1. Ajoutez si nécessaire un bloc "Itération" : sous le volet "Création", dans le groupe "Structure", déroulez "Blocs" et sélectionnez "Bloc d'itération". Le nom de ce bloc est "Itération".

2. Personnalisez le bloc "Itération".

3. Dans l'événement "Après impression" du bloc "Fin de rupture" de l'état, saisissez le code suivant :
	
	```wl
	// --Après impression du Fin de rupture 
	// Est-ce que le produit en cours d'impression est en promotion ?
	SI MaSource.Promotion = Vrai ALORS
		// Impression du bloc Itération
		iImprimeBloc("Itération")
	FIN
	```






