
## Le champ Zone répétée : Synchronisation personnalisée
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000118"></a>
Comment gérer la synchronisation entre :

- la page affichée dans le navigateur. Cette page contient un champ Zone répétée affichant des enregistrements d'un fichier HFSQL.

- le contexte de page correspondant existant sur le serveur.




Grâce à une gestion personnalisée de la synchronisation, lors d'une action sur une répétition dans la page (par exemple clic sur un lien pour commander le produit affiché), les informations mémorisées sur le serveur sont mises à jour en fonction de l'identifiant présent dans la répétition en cours sur le navigateur.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Principe
<a name="principe_ELTTEXTE000142"></a>
La méthode de synchronisation personnalisée pour les champs Zone répétée s'appuie sur une information cachée dans la page : l'identifiant de la répétition sélectionnée.

La synchronisation va consister à envoyer au serveur l'identifiant de la répétition en cours sur le navigateur.


<a name="NOTE2_2"></a>


### Rappel
<a name="rappel_ELTPARAGRAPHE000032"></a>Le code de synchronisation est déclenché lorsque les conditions suivantes sont réunies :

- la page affichée sur le navigateur ne correspond plus au contexte de page du serveur.

- l'internaute exécute un code serveur (en cliquant sur un lien, un bouton, une image, une option de menu, ...). L'option "Appeler le traitement de synchronisation de la page si l'internaute a utilisé le bouton précédent du navigateur" n'a pas été décochée dans l'onglet "Avancé" de la description du champ exécutant le code serveur.








<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Mise en oeuvre
<a name="mise_oeuvre_ELTTEXTE000172"></a>
Pour personnaliser la gestion de synchronisation pour les champs Zone répétée fichier :

1. Vérifiez que le mécanisme de gestion de synchronisation est activé.

	- au niveau de la page (option "Utilisation du bouton "Précédent" du navigateur" correspondant à "Autorisé (exécute le code de synchronisation)" de l'onglet "UI" de la description de la page).

	- au niveau de chaque bouton permettant de gérer la zone répétée ou d'effectuer une action sur l'enregistrement sélectionné dans la zone répétée (option "Appeler le traitement de synchronisation de la page si l'internaute a utilisé le bouton précédent du navigateur" non décochée dans l'onglet "Avancé" de la description du champ).




2. Créez un champ invisible dans le champ Zone répétée.

3. Définissez un attribut sur la valeur de ce champ invisible (nommé "IDUNIK" par exemple) dans la description du champ Zone répétée. Ce champ doit contenir l'identifiant de la répétition en cours. L'initialisation de ce champ doit être réalisée principalement dans le code de clic sur le lien ou le bouton présent dans le champ Zone répétée.

4. Personnalisez le code de synchronisation de la page en cours. Ce code de synchronisation doit :

	- lire la valeur du champ caché de la répétition en cours.

	- relire l'enregistrement correspondant à l'identifiant stocké dans le champ caché.

	- effectuer les traitements nécessaires selon l'application.







Un exemple de code de synchronisation peut être :


```wl
Ch est une chaîne
Clé est une chaîne
Ch = "_" + PageParamètre(ZR_ZoneRépétée1) + "_" + IDUNIK
// Ch = nom du champ IDUNIK dans la répétition en cours
Clé = PageParamètre(Ch)
// Clé = contenu du champ IDUNIK dans la répétition en cours
// Recherche de l'enregistrement sélectionné 
HLitRecherche(PRODUIT, PRCLEUNIK, Clé)
SI HTrouve() ALORS
	// Traitement à effectuer
	...
	// Continue l'application sans afficher de message
	ChangeAction(caContinuer)
SINON
	ChangeAction(caErreur)
FIN
```





