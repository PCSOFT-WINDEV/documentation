


## Evénements associés au champ Upload
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Evénements gérés par défaut
<a name="evenements_geres_par_defaut_ELTTEXTE000172"></a>
WEBDEV gère par défaut les événements suivants (ordre d'apparition sous l'éditeur de code) sur le champ de type Upload :

| Evénement | Condition d'exécution |
| --- | --- |
| Initialisation<br>(Code serveur) | Exécuté à l'ouverture de la page. \* |
| A chaque modification de la liste des fichiers sélectionnés <br>(Code navigateur) | Exécuté lors de la modification de la liste des fichiers à uploader. <br>Dans le cas d'un champ Upload mono fichier, cet événement est exécuté dès qu'un fichier est sélectionné. <br>Dans le cas d'un champ Upload multi fichiers, cet événement est exécuté dès qu'un fichier est ajouté dans la liste. |
| Progression du transfert <br>(Code navigateur) | Exécuté lors de l'envoi des fichiers sur le serveur. <br>Lors de l'avancement de l'envoi, cet événement est régulièrement appelé pour permettre la mise à jour d'une éventuelle jauge.<br><br><br><br>Pour plus de détails, reportez-vous à l'exemple unitaire "Upload ou Download d'un fichier" livré en standard avec WEBDEV. |
| Réception des fichiers uploadés <br>(Code serveur) | Exécuté lors de la réception des fichiers uploadés par le serveur. <br>**ATTENTION** : Si vous utilisez les champs Upload prédéfinis (mono fichier ou multi fichier), le code présent dans cet événement doit être modifié pour indiquer l'emplacement où les fichiers doivent être copiés sur le serveur.<br><br>L'événement "Réception des fichiers uploadés" est exécuté en AJAX. Il est possible d'utiliser toutes les fonctions supportées en code serveur AJAX. Cet événement permet notamment en fin d'upload de mettre à jour la page sans faire un aller-retour supplémentaire vers le serveur. |
| Après réception des fichiers uploadés<br>(Code navigateur) | Exécuté lorsque tous les fichiers ont été uploadés sur le serveur.<br><br>Permet notamment d'exécuter un événement navigateur lorsque l'upload est terminé, sans avoir à retourner sur le serveur. |



(\*) Par défaut, l'événement "Initialisation" de chaque champ est exécuté selon l'ordre de création des différents champs dans la page. Pour modifier cet ordre d'exécution : 

1. Sous le volet "Page", dans le groupe "Edition", déroulez "Navigation" et sélectionnez "Editer".

2. Dans la fenêtre qui s'affiche, utilisez les flèches situées sur la droite pour modifier l'ordre d'initialisation des champs.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Evénement de réception des fichiers
<a name="evenement_reception_des_fichiers_ELTTEXTE000196"></a>
L'événement "Réception des fichiers uploadés" permet de gérer l'emplacement des fichiers uploadés sur le serveur. Cet événement permet également de gérer les paramètres passés par la fonction [UploadLance](../WDLang2/1000018793.md). 

En effet, la fonction [UploadLance](../WDLang2/1000018793.md) permet de lancer l'upload des fichiers. Si la fonction [UploadLance](../WDLang2/1000018793.md) est appelée avec des paramètres supplémentaires, ces paramètres sont transmis à l'événement "Réception des fichiers uploadés" à la fin de l'upload. Pour récupérer ces paramètres, il est nécessaire de déclarer une procédure dans cet événement (via l'instruction PROCEDURE).

Cette procédure est de la forme : 

```txt
PROCEDURE NomProcédure(<Paramètre 1> [, ... [, <Paramètre N>]])
```


L'événement "Réception des fichiers uploadés" peut également permettre de charger les images uploadées dans une rubrique mémo d'un fichier HFSQL, via la fonction [HAttacheMémo](../WDLang4/3044173.md).

L'événement "Réception des fichiers uploadés" est exécuté en AJAX. Il est possible d'utiliser toutes les fonctions supportées en code serveur AJAX.

Exemple de code utilisé dans l'événement "Réception des fichiers uploadés" : 

```wl
// Insérer ici le code de traitement des fichiers uploadés
// Exemple de code :
// Copie le fichier uploadé dans un répertoire spécifique
// UploadCopieFichier(MoiMême, sRépertoireDestination, "")

// Traitement de chaque fichier à uploader
POUR Indice = 1 A NbFichiersAUploader
	Trace(UploadNomFichier(UPL_Upload, Faux, Indice))
	Trace(UploadNomFichier(UPL_Upload, Vrai, Indice))
	UploadCopieFichier(UPL_Upload, "c:\temp2", "", Indice)
FIN
```


<a name="Exemple2"></a>


## Exemple
<a name="exemple_ELTTEXTE000220"></a>
Exemple de code permettant de charger les images uploadées depuis un champ Upload multi-fichiers dans une rubrique mémo.

```wl
// Pour chaque image uploadée 
POUR i = 1 _A_ UPL_ChampUpload.Occurrence
	// Ajout dans la base de données		
	HRAZ(Photo)
	EcranVersFichier()

	// UploadNomFichier(UPL_ChampUpload, Vrai, i) :
	// permet de récupérer le chemin du ième fichier uploadé sur le serveur
	// Ce fichier est un fichier temporaire créé sur le serveur
	// Ce fichier est donc supprimé automatiquement à la fin de l'événement
	// "Réception des fichiers uploadés"
	HAttacheMémo(Photo, Image, UploadNomFichier(UPL_ChampUpload, Vrai, i))

	HAjoute(Photo)
FIN
```



- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=UploadouDownloadd'unfichier.gif) ***Exemples unitaires (WEBDEV)*** : **Upload ou Download d'un fichier** <br>Upload (copier vers le serveur) et download (télécharger depuis le serveur) d'un fichier :<br>- Copier un fichier du poste navigateur vers le poste serveur<br>- Télécharger un fichier présent sur le serveur<br>- Télécharger un fichier présent sur le serveur grâce à un lien<br>- Télécharger un fichier présent sur le serveur en demandant son ouverture


