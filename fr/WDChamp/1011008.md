


## Etat paramétré
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000237"></a>
<a name="Etat_Param"></a>
Lors de l'impression d'un état, il est possible de passer des paramètres à cet état. L'état est alors appelé "État paramétré".

Par exemple, votre état correspond à un mailing publicitaire envoyé à tous les clients de votre société. Avant d'exécuter cet état, le texte du mailing est saisi dans un champ. Ce texte correspond alors à un paramètre attendu par l'état.<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=etatParametre.gif&type=thumb)




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer un état paramétré
<a name="creer_etat_parametre_ELTTEXTE000261"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000037"></a>La création d'un état paramétré est composée de plusieurs étapes :

1. Création d'un état.

2. Modification de cet état pour gérer les paramètres :

	- Récupération des paramètres dans l'événement "Ouverture" de l'état à l'aide de la syntaxe suivante :
			
		```txt
		PROCEDURE <NomEtat>(<NomParam1>, ...
			<NomParam2>= "<ValeurParDéfautParam2>", ...
			...
			<NomParamN> = "<ValeurParDéfautParamN>")
		```

			Rappel : Certains paramètres passés à une procédure peuvent être optionnels. Lors de la déclaration de la procédure, les paramètres optionnels doivent être décrits en dernière position (à droite), avec une valeur par défaut précédée du signe "=". 

	- Utilisation de ces paramètres dans les champs de l'état.




3. Modification si nécessaire de l'application afin de spécifier les différents paramètres.

4. Impression de l'état avec passage des paramètres. Pour plus de détails, consultez le paragraphe [Imprimer un état paramétré](#NOTE3_1).



<a name="NOTE2_2"></a>


### Exemple
<a name="exemple_ELTPARAGRAPHE000068"></a>La programmation nécessaire à la création d'un état paramétré est illustrée par l'exemple suivant :

- L'état "ETAT_EtatParam" correspond à un mailing publicitaire envoyé aux clients. 

- Cet état attend en paramètre le texte du mailing saisi dans le champ de saisie "SAI_TexteMailing".




Mise en place :

1. Créez l'état "ETAT_EtatParam" : 

	- Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif) parmi les boutons d'accès rapide. 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Etat" puis sur "Etat".

	- L'assistant de création d'un état se lance. 

	- Dans l'assistant, sélectionnez "Mailing" et validez. 
			Cet état est lié au fichier "Client" de votre analyse. 




2. Personnalisez cet état.

3. Dans l'événement "Ouverture" de l'état "ETAT_EtatParam", saisissez le code suivant : 
	
	```wl
	// Récupérer le paramètre passé à l'état et
	// passer un paramètre par défaut pour le test de l'état
	PROCEDURE ETAT_EtatParam(sTexte = "Valeur par défaut")
	```


4. Dans le bloc *Corps* de cet état, ajoutez le champ Libellé "LIB_TexteMailing" permettant d'afficher le texte du mailing.

5. Dans l'événement "Avant impression" du champ "LIB_TexteMailing", saisissez le code suivant :
	
	```wl
	// Récupérer le texte du mailing
	LIB_TexteMailing = sTexte
	```


6. Dans une fenêtre de l'application, ajoutez :

	- le champ de saisie "SAI_TexteMailing" permettant à l'utilisateur de saisir le texte du mailing.

	- le bouton "BTN_Imprimer" permettant de lancer l'impression de l'état.







<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Imprimer un état paramétré
<a name="imprimer_etat_parametre_ELTTEXTE000291"></a>
Pour imprimer un état paramétré, il suffit de : 

1. Paramétrer la destination de l'impression de l'état grâce à la fonction [iDestination](../WDLang5/3046074.md) (visualisateur de rapports, impression dans un fichier HTML, ...).

2. Préciser les paramètres suivants grâce à la fonction [iImprimeEtat](../WDLang5/3046032.md) :

	- le nom de l'état à imprimer.

	- les paramètres.







**Remarques** :

- Si l'état est basé sur une vue HFSQL, le nom de cette vue HFSQL doit être indiqué dans la fonction [iImprimeEtat](../WDLang5/3046032.md), avant les paramètres. 

- Si l'état est basé sur une zone mémoire, le nom de cette zone mémoire doit être indiqué dans la fonction [iImprimeEtat](../WDLang5/3046032.md), avant les paramètres. 

- Si l'état est un état borné, la valeur des bornes (minimales et/ou maximales) doit être indiquée dans la fonction [iImprimeEtat](../WDLang5/3046032.md), avant les paramètres. 



<a name="NOTE3_2"></a>


### Exemple
<a name="exemple_ELTPARAGRAPHE000172"></a>L'état "ETAT_EtatParam" correspond à un mailing publicitaire envoyé aux clients. Cet état attend en paramètre le texte du mailing saisi dans le champ de saisie "SAI_TexteMailing".

L'état "ETAT_EtatParam" s'imprime lors d'un clic sur le champ Bouton "BTN_Imprimer".

Dans cet exemple, le code de l'événement "Clic" du champ Bouton "BTN_Imprimer" est le suivant :

```wl
// Ouvrir le visualisateur de rapports
iDestination(iVisualisateur)
// Imprimer l'état avec passage de paramètre
iImprimeEtat(ETAT_EtatParam, SAI_TexteMailing)
```

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Conseil
<a name="conseil_ELTTEXTE000327"></a>
<a name="EtatParam_Tester"></a>
Pour tester un état paramétré directement depuis l'éditeur d'états, il est conseillé de donner une valeur par défaut aux paramètres dans la déclaration des paramètres.

Par exemple, pour tester l'état de l'exemple précédent, saisissez le code suivant dans l'événement "Ouverture" de l'état "ETAT_EtatParam" :

```wl
// Récupérer le paramètre passé à l'état et
// passer un paramètre par défaut pour le test de l'état
PROCEDURE ETAT_EtatParam(sTexte = "Valeur par défaut")
```




