
## Fenêtres Widget Android
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000205"></a>
Une application Android peut contenir une ou plusieurs fenêtres de type Widget. Ces fenêtres pourront être affichées sur l'écran d'accueil de la tablette ou du téléphone. 

Les informations affichées dans ces fenêtres sont mises à jour régulièrement. Les fenêtres de type Widget permettent des interactions simples avec l'utilisateur. 
<a name="NOTE1_2"></a>


### Créer une fenêtre de type Widget Android
<a name="creer_une_fenetre_type_widget_android_ELTPARAGRAPHE000016"></a>Pour créer une fenêtre de type Widget Android : 

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif) parmi les boutons d'accès rapide : 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Fenêtre" puis sur "Fenêtre". 

	- L'assistant de création d'une fenêtre se lance.




2. Dans l'onglet "Standard", dans la zone "Autre plateforme", sélectionnez l'option "Vierge pour Widget" et validez.

3. Une nouvelle fenêtre est créée sous l'éditeur. Seuls 3 types de champs sont disponibles dans les fenêtres Widget : [les champs Bouton](../WDChamp/1013076.md), [les champs Libellé](../WDChamp/1013179.md) et [les champs Image](../WDChamp/1013218.md).
	Attention : Les styles des champs d'un Widget définis en édition seront ignorés en exécution. Il est uniquement possible de définir la couleur de fond des champs et l'image de fond pour les champs Bouton.




**Remarque** : Il est également possible de modifier le type d'une fenêtre existante : 

1. Affichez la description de la fenêtre (option "Description" du menu contextuel). 

2. Dans l'onglet "UI", sélectionnez "Widget (Android/iOS14+)". <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Fen%EAtre_android_Widget%20-%20HC%20N%B0001.gif)


3. Validez. 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Caractéristiques d'une fenêtre de type Widget Android
<a name="caracteristiques_une_fenetre_type_widget_android_ELTTEXTE000235"></a>


### Taille d'une fenêtre Widget
<a name="taille_une_fenetre_widget_ELTPARAGRAPHE000052"></a>La taille d'une fenêtre Widget est définie en nombre de cellules verticales et horizontales. Cette taille est paramétrable dans l'onglet "UI" de la fenêtre de description : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Fen%EAtre_android_Widget%20-%20HC%20N%B0003%202.gif)


Une cellule a pour taille 74 pixels de côté (pour un dpi de 160). 

Pour un affichage compatible avec la plupart des appareils (téléphones et tablettes), il est conseillé de ne pas dépasser une taille de 4 x 4 cellules. 

**Remarque** : Les Widgets créés avec WINDEV Mobile ne sont pas redimensionnables. 


### Mise à jour du contenu
<a name="mise_jour_contenu_ELTPARAGRAPHE000064"></a>Les fenêtres de type Widget possèdent un événement spécifique : Rafraîchissement du Widget. Cet événement permet de mettre à jour le contenu du Widget. Cet événement est lancée à intervalle de temps régulier. La fréquence de rafraîchissement est fixée dans l'onglet "UI" de la fenêtre de description. <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Fen%EAtre_android_Widget%20-%20HC%20N%B0003%201.gif)


Remarques : 

- Cette fréquence de rafraîchissement ne peut pas être inférieure à 30 minutes. 

- La fonction [WidgetAffiche](../WDLang3/1000020647.md) provoque le ré-affichage du Widget et l'exécution de l'événement "Rafraîchissement du Widget". 







### Réaffichage de la fenêtre du Widget
<a name="reaffichage_fenetre_widget_ELTPARAGRAPHE000079"></a>L'affichage du dessin d'une fenêtre Widget est effectué par le processus qui gère l'écran d'accueil de l'appareil. Cet affichage n'est pas effectué en permanence. Il est mis à jour dans les cas suivants : 

- Ajout d'une nouvelle instance du Widget sur l'écran d'accueil. 

- Après un clic sur un bouton ou une image du Widget. 

- Après la mise à jour du contenu du Widget. 




**Remarque** : La fonction [WidgetAffiche](../WDLang3/1000020647.md) provoque le ré-affichage du Widget et l'exécution de l'événement "Rafraîchissement du Widget". 


### Image du Widget
<a name="image_widget_ELTPARAGRAPHE000093"></a>Lors de l'installation d'un Widget sur le bureau, l'utilisateur dispose de la liste des Widgets présents sur son poste. Cette liste contient pour chaque Widget le nom du Widget et l'image d'aperçu. 

L'image d'aperçu du Widget est définie dans l'onglet "UI" de la fenêtre de description. <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Fen%EAtre_android_Widget%20-%20HC%20N%B0003%203.gif)


Il est possible : 

- de fournir une image spécifique. 

- de générer une copie d'écran de la fenêtre. Dans ce cas, la copie d'écran est automatiquement associée à l'image d'aperçu. 




Si aucune image n'est spécifiée, l'icône de l'application Android sera automatiquement utilisée. 



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Programmation d'une fenêtre de type Widget Android
<a name="programmation_une_fenetre_type_widget_android_ELTTEXTE000277"></a>


### Ouverture d'une fenêtre Widget
<a name="ouverture_une_fenetre_widget_ELTPARAGRAPHE000113"></a>Il n'est pas possible de demander explicitement l'ouverture d'une fenêtre de type Widget. Les fonctions d'ouverture ([OuvreSoeur](../WDLang1/3038045.md), [OuvreFille](../WDLang1/3038021.md), [Utilise](../WDLang1/3038044.md)) déclencheront une erreur fatale si elles sont utilisées en mode Widget. 

Les fenêtres de type Widget sont automatiquement ouvertes dans les cas suivants : 

- Ajout sur l'écran d'accueil de la première instance du Widget correspondant à la fenêtre.

- Après le démarrage de l'appareil si au moins une instance du Widget est présente sur l'écran d'accueil.

- Lors de la mise à jour du Widget ou en cas d'interaction de l'utilisateur avec le Widget (clic  sur un bouton par exemple). 

- Dans le cas où le processus a été stoppé par le système (s'il a besoin de ressources par exemple). 




Les événements exécutés lors de l'ouverture d'une fenêtre de type Widget sont les suivants : 

- "Déclaration globales" de la fenêtre.

- "Initialisation" des champs de la fenêtre. 

- "Initialisation" de la fenêtre. 

- "Rafraîchissement du Widget". 




L'événement "Initialisation" associé au projet sera exécuté uniquement avant l'ouverture de la première fenêtre de type Widget de l'application. Pour différencier le code spécifique aux Widgets du code spécifique à l'application dans cet événement, utilisez la fonction [EnModeWidget](../WDLang1/1000020649.md).




### Fermeture d'une fenêtre Widget
<a name="fermeture_une_fenetre_widget_ELTPARAGRAPHE000147"></a>Il n'est pas possible de demander explicitement la fermeture d'une fenêtre de type Widget. La fonction [Ferme](../WDLang1/3038018.md) déclenchera une erreur fatale si elle est utilisée en mode Widget. 

Les fenêtres de type Widget sont automatiquement fermées lorsque la dernière instance du Widget est retirée de l'écran d'accueil. L'événement "Fermeture" (associé à la fenêtre) est exécuté lors de la fermeture d'une fenêtre de type Widget.

L'événement "Fermeture" associé au projet sera exécuté lorsque la dernière instance d'un Widget de l'application est retirée de l'écran d'accueil et qu'il n'y a plus aucune instance affichée d'autres Widgets de l'application.






