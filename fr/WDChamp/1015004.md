


## Manipuler un champ Table hiérarchique par programmation
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000676"></a>
Voici les principaux points de la programmation des champs Table hiérarchique. Le WLangage met à votre disposition de nombreuses fonctions permettant de gérer par programmation les champs Table hiérarchique.

N'hésitez pas à consulter la documentation de ces fonctions. Pour plus de détails, consultez la [liste des fonctions de gestion des champs Table hiérarchique](../WDLang1/1000010002.md). 



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Initialisation d'un champ Table hiérarchique
<a name="initialisation_champ_table_hierarchique_ELTTEXTE000700"></a>
Pour remplir par programmation un champ Table hiérarchique, il est possible d'utiliser les fonctions suivantes : 

- [TableAjouteLigne](../WDLang1/3074006.md), [TableAjouteFils](../WDLang1/1000010004.md), [TableInsèreLigne](../WDLang1/3074026.md) et [TableInsèreFils](../WDLang1/1000010005.md) : dans chaque ligne, la valeur de chaque colonne est séparée par des virgules. 

- [TableAjoute](../WDLang1/3074017.md) et [TableInsère](../WDLang1/3074025.md) : dans une ligne, la valeur de chaque colonne est séparée par TAB.




Si une nouvelle ligne a été ajoutée dans un champ Table hiérarchique avec la fonction [TableAjoute](../WDLang1/3074017.md), [TableInsere](../WDLang1/3074025.md), [TableAjouteLigne](../WDLang1/3074006.md), [TableAjouteFils](../WDLang1/1000010004.md), [TableInsèreLigne](../WDLang1/3074026.md) ou [TableInsèreFils](../WDLang1/1000010005.md), la propriété [Nouveau](../Proprietes/2510073.md) est à <u><u><u><u>Vrai</u></u></u></u> (sinon elle est à <u><u><u><u>Faux</u></u></u></u>).

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Remarque** : Pour optimiser le remplissage d'un champ Table hiérarchique, il est possible d'utiliser la propriété [AjouteFilsDifféré](../Proprietes/1000020927.md) sur les lignes du champ Table hiérarchique. 
Dans ce cas, le principe du remplissage est simplifié : 

- A l'initialisation du champ, seul les éléments du premier niveau sont chargés. Chaque élément est associé à la propriété [AjouteFilsDifféré](../Proprietes/1000020927.md).  

- Lorsque l'utilisateur clique sur l'élément de premier niveau pour le dérouler, la procédure définie par la propriété [AjouteFilsDifféré](../Proprietes/1000020927.md) est exécutée. Cette procédure effectue le remplissage du niveau à dérouler. La recherche des fils n'est effectuée que lorsque l'utilisateur demande à les voir.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Ajout ou modification de lignes dans un champ Table hiérarchique
<a name="ajout_modification_lignes_dans_champ_table_hierarchique_ELTTEXTE000724"></a>


### Ajout de lignes dans un champ Table hiérarchique
<a name="ajout_lignes_dans_champ_table_hierarchique_ELTPARAGRAPHE000117"></a>La création d'une ligne dans un champ Table hiérarchique n'est pas automatique. Elle doit être demandée explicitement par un appel aux fonctions :

- [TableAjoute](../WDLang1/3074017.md), [TableAjouteLigne](../WDLang1/3074006.md) ou [TableAjouteFils](../WDLang1/1000010004.md) : ajoute une ligne à la fin du champ,

- [TableInsère](../WDLang1/3074025.md), [TableInsèreLigne](../WDLang1/3074026.md) ou [TableInsèreFils](../WDLang1/1000010005.md) : ajoute une ligne à l'indice spécifié ou à l'indice en cours. 


![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Remarque** : Si l'option "Saisie en cascade" n'est pas sélectionnée :

- Le champ Table hiérarchique ne comporte aucune ligne à sa création. Dans ce cas, aucune saisie n'est possible. La propriété [Vide](../Proprietes/2510126.md) est à <u><u><u><u>Vrai</u></u></u></u>.

- Pour insérer automatiquement une ligne dans un champ Table hiérarchique vide, utilisez la fonction [TableAjoute](../WDLang1/3074017.md) ou [TableAjouteLigne](../WDLang1/3074006.md).



<a name="NOTE3_2"></a>


### Modification d'une ligne ou d'une colonne
<a name="modification_une_ligne_une_colonne_ELTPARAGRAPHE000165"></a>Le contenu des lignes et des colonnes d'un champ Table hiérarchique peut être modifié :

- par l'utilisateur, en saisissant directement dans les colonnes. Les modifications sont mémorisées automatiquement dans le champ Table hiérarchique, sans programmation complémentaire. La propriété [Modifié](../Proprietes/2510080.md) est à <u><u><u><u>Vrai</u></u></u></u>.

- par programmation :

	- avec la fonction [TableModifie](../WDLang1/3074019.md) ou la fonction [TableModifieLigne](../WDLang1/3074028.md) pour modifier le contenu de la ligne en cours ou d'une ligne donnée.
			Par exemple : 
			
		```wl
		TableModifie(TABLEH_CLIENT, "PY" + TAB + "Jean" + TAB + "Nîmes")
		```

			**Remarque** : Il est également possible d'utiliser directement le nom du champ Table hiérarchique : 
			
		```wl
		// Modifier la ligne en cours
		TABLEH_CLIENT = "DURAND" + TAB + "Sophie" + TAB + "Nîmes"
		// Modifier la colonne COL_JOUR de la ligne 3
		TableModifie(COL_JOUR, "Mercredi"+ TAB + "Vaqué", 3)
		```


	- directement en donnant le nom de la colonne (comme pour un champ de saisie) pour modifier le contenu de la colonne. Pour modifier une colonne d'une ligne précise, il faut indiquer le numéro de la ligne (indice).
			Par exemple :
			
		```wl
		COL_NOM[Indice] = NomClient
		```

			Pour modifier une colonne de la ligne en cours, il n'est pas nécessaire de préciser l'indice. 
			Par exemple : 
			
		```wl
		COL_NOM = NomClient
		```

			La propriété [Modifié](../Proprietes/2510080.md) est à <u><u><u><u>Faux</u></u></u></u> (elle est mise à <u><u><u><u>Vrai</u></u></u></u> uniquement par une saisie dans le champ Table hiérarchique).






<a name="NOTE3_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Reprendre la saisie dans une colonne
<a name="reprendre_saisie_dans_une_colonne_ELTPARAGRAPHE000236"></a>La fonction [DonneFocusEtRetourUtilisateur](../WDLang1/1410088107.md) peut être utilisée pour se replacer en saisie sur une colonne, de la ligne en cours. Par exemple :

```wl
// Evénement "Entrée dans" de COL_QTE
// COL_QTE ne peut pas être saisi si COL_PRODUIT n'est pas saisi
SI SansEspace(COL_PRODUIT) = "" ALORS
	Erreur("La colonne Produit doit être saisie en premier")
	DonneFocusEtRetourUtilisateur(COL_PRODUIT)
FIN
```

<a name="NOTE3_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Ajout ou suppression d'une colonne
<a name="ajout_suppression_une_colonne_ELTPARAGRAPHE000252"></a>Il est possible de :

- ajouter une colonne dans un champ Table hiérarchique grâce à la fonction [ChampClone](../WDLang1/3025017.md).

- supprimer une colonne dans un champ Table hiérarchique grâce à la fonction [ChampSupprime](../WDLang1/3025037.md).



<a name="NOTE3_5"></a>


### Gestion des colonnes calculées
<a name="gestion_des_colonnes_calculees_ELTPARAGRAPHE000270"></a>La formule de calcul d'une colonne calculée doit être décrite dans l'événement "Affichage d'une ligne" du champ Table. Par exemple :

```wl
// COL_PHT : colonne calculée
// COL_PUHT et COL_QTE : colonnes liées à des zones mémoire
COL_PHT = COL_PUHT * COL_QTE
```


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Opérations sur les lignes et les cellules
<a name="operations_sur_les_lignes_les_cellules_ELTTEXTE000772"></a>


### Suppression d'une ligne
<a name="suppression_une_ligne_ELTPARAGRAPHE000282"></a>La suppression d'une ligne doit être demandée explicitement à l'aide des fonctions [TableSupprime](../WDLang1/3074032.md) et [TableSupprimeFils](../WDLang1/1000010006.md).

- La syntaxe utilisée pour la fonction [TableSupprime](../WDLang1/3074032.md) est : 
	
	```txt
	TableSupprime(Champ Table hiérarchique>[, <Indice>])
	```

	Si l'indice est précisé, la fonction [TableSupprime](../WDLang1/3074032.md) supprime la ligne correspondant à l'indice. Sinon, elle supprime la ligne en cours.
	La suppression d'une ligne du champ Table hiérarchique supprime toutes les valeurs des colonnes pour cette ligne.

- La syntaxe utilisée pour la fonction [TableSupprimeFils](../WDLang1/1000010006.md) est : 
	
	```txt
	TableSupprimeFils(<Champ Table hiérarchique>, <Indice de l'élément parent>)
	```

	Tous les éléments fils de la ligne désignée par l'indice seront supprimés.



<a name="NOTE4_2"></a>


### Sélection d'une ligne
<a name="selection_une_ligne_ELTPARAGRAPHE000329"></a>La sélection d'une ligne s'effectue avec la fonction [TableSelectPlus](../WDLang1/3074031.md).

La syntaxe utilisée est :

```txt
TableSelectPlus(<Champ Table hiérarchique>[, <Indice>])
```

<a name="NOTE4_3"></a>


### Récupération d'une ligne ou d'une cellule
<a name="recuperation_une_ligne_une_cellule_ELTPARAGRAPHE000349"></a>Le contenu d'un champ Table hiérarchique peut être récupéré :

- soit la ligne entière.

- soit cellule par cellule.



<a name="NOTE4_4"></a>


### Valeur d'une cellule de la ligne en cours
<a name="valeur_une_cellule_ligne_cours_ELTPARAGRAPHE000361"></a>Pour récupérer la valeur d'une colonne (ou cellule) de la ligne en cours, la syntaxe est la même que pour un champ de saisie simple : 

```txt
<Valeur> = <Nom_Colonne>
```
Par exemple : 

```wl
// COL_QTE est une colonne d'un champ Table hiérarchique
SI COL_QTE < 10 ALORS
	Info("Quantité insuffisante")
FIN
```

<a name="NOTE4_5"></a>


### Valeur d'une cellule pour une ligne spécifique
<a name="valeur_une_cellule_pour_une_ligne_specifique_ELTPARAGRAPHE000375"></a>Pour récupérer la valeur d'une colonne qui n'est pas sur la ligne en cours, il faut passer l'indice de la ligne : 

```txt
<Valeur> = <Nom Colonne>[<Indice>]
```
Par exemple : 

```wl
// Totaliser le Prix PHT pour toutes les lignes de commande
PrixTotal = 0
POUR Indice = 1 A TABLEH_COMMANDE.Occurrence
	PrixTotal = PrixTotal + COL_PHT[Indice]
FIN
```

<a name="NOTE4_6"></a>


### Contenu de la ligne en cours
<a name="contenu_ligne_cours_ELTPARAGRAPHE000389"></a>Pour récupérer le contenu de la ligne en cours : 

```txt
<Valeur> = <Champ Table hiérarchique>
```

<a name="NOTE4_7"></a>


### Contenu d'une ligne spécifique
<a name="contenu_une_ligne_specifique_ELTPARAGRAPHE000400"></a>Pour récupérer le contenu de la ligne d'indice &lt;Indice&gt; :

```txt
<Valeur> = <Champ Table hiérarchique>[<Indice>]
```

**Remarque** : l'indice de la ligne en cours peut être connu par la fonction [TableSelect](../WDLang1/3074020.md). Par exemple : 

```wl
// Récupérer le contenu de la ligne 10 du champ Table hiérarchique TABLEH_CLIENT
LigneEnCours = TABLEH_CLIENT[10] 
// Nom du client sélectionné
NomClient = COL_NOM[TableSelect(TABLEH_CLIENT)]
// Récupérer le contenu de la ligne en cours du champ Table hiérarchique TABLEH_CLIENT
LigneEnCours = TABLEH_CLIENT
```


<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Opérations sur l'arborescence
<a name="operations_sur_arborescence_ELTTEXTE000832"></a>


### Enrouler tous les noeuds d'un champ Table hiérarchique
<a name="enrouler_tous_les_noeuds_champ_table_hierarchique_ELTPARAGRAPHE000425"></a>Pour enrouler tous les noeuds de l'arbre d'un champ Table hiérarchique, utilisez la fonction [TableEnrouleTout](../WDLang1/1000010003.md). La syntaxe utilisée est : 

```txt
TableEnrouleTout(<Champ Table hiérarchique>)
```

<a name="NOTE5_2"></a>


### Dérouler tous les noeuds d'un champ Table hiérarchique
<a name="derouler_tous_les_noeuds_champ_table_hierarchique_ELTPARAGRAPHE000444"></a>Pour dérouler tous les noeuds de l'arbre d'un champ Table hiérarchique, utilisez la fonction [TableDérouleTout](../WDLang1/1000010001.md). La syntaxe utilisée est :

```txt
TableDérouleTout(<Champ Table hiérarchique>)
```


![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Remarque : Si le champ Table hiérarchique utilise le remplissage différé des sous-niveaux via la propriété [AjouteFilsDifféré](../Proprietes/1000020927.md), la procédure de remplissage des sous-niveaux sera exécutée pour chaque nouvel élément déroulé. 
<a name="NOTE5_3"></a>


### Connaître le numéro de la ligne enroulée/déroulée
<a name="connaitre_numero_ligne_enrouleederoulee_ELTPARAGRAPHE000472"></a>Pour connaître le numéro de la ligne qui est enroulée ou déroulée, il suffit d'utiliser le code "Enroulé, déroulé" d'un noeud du champ Table hiérarchique : 

```wl
// Quelle est la ligne manipulée ? 
Info(TABLEH_TableHiérarchique[TABLEH_TableHiérarchique])
```

<a name="NOTE5_4"></a>


### Définir le prochain état de la ligne ajoutée
<a name="definir_prochain_etat_ligne_ajoutee_ELTPARAGRAPHE000483"></a>Il est possible de définir pour un champ Table hiérarchique l'état de la prochaine ligne qui sera ajoutée, à savoir enroulée ou déroulée. Pour cela, utilisez la propriété [Enroulé](../Proprietes/2513014.md).


```wl
// Les prochaines lignes ajoutées seront automatiquement enroulées
TABLEH_TableHiérarchique.Enroulé = Vrai
```

<a name="NOTE5_5"></a>


### Connaître et modifier les images des lignes
<a name="connaitre_modifier_les_images_des_lignes_ELTPARAGRAPHE000497"></a>Pour connaître et modifier les images des lignes d'un champ Table hiérarchique, utilisez les propriétés :

- [ImageDéroulée](../Proprietes/2513015.md) : image d'une ligne déroulée,

- [ImageEnroulée](../Proprietes/2513016.md) : image d'une ligne enroulée. 





```wl
// Modifier les images des lignes du champ Table hiérarchique
TABLEH_TableHiérarchique.ImageDéroulée = "DossierOuvert.gif"
TABLEH_TableHiérarchique.ImageEnroulée = "DossierFermé.gif"
```

<a name="NOTE5_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Colonne hiérarchique de type Interrupteur
<a name="colonne_hierarchique_type_interrupteur_ELTPARAGRAPHE000517"></a>Il est possible de définir dans un champ Table hiérarchique une colonne de type Interrupteur comme "Colonne hiérarchique". Dans ce cas, la colonne interrupteur permet de gérer la hiérarchie.

La propriété [Libellé](../Proprietes/2510053.md) de la ligne permet de connaître et modifier le libellé présent à côté de l'interrupteur.
La propriété [Valeur](../Proprietes/2510130.md) de la ligne permet de connaître et de modifier la valeur de l'interrupteur. 
<a name="NOTE5_7"></a>


### Connaître le parent ou les fils d'un élément
<a name="connaitre_parent_les_fils_element_ELTPARAGRAPHE000535"></a>Il est possible de connaître le parent ou les fils d'un élément grâce aux fonctions suivantes : 

- [TableRécupèreParent](../WDLang1/1000010011.md) : Renvoie le "parent" d'un élément, c'est-à-dire l'élément de niveau immédiatement supérieur. 

- [TableRécupèreFils](../WDLang1/1000010009.md) : Renvoie les fils d'un élément, c'est-à-dire les éléments de niveau immédiatement inférieur. 




<a name="NOTE6"></a>
<a name="NOTE6_1"></a>


## Propriétés spécifiques aux champs Table hiérarchique
<a name="proprietes_specifiques_aux_champs_table_hierarchique_ELTTEXTE000892"></a>
Les propriétés suivantes sont spécifiques à la gestion des caractéristiques d'un champ Table hiérarchique par programmation.


|   |   |
| --- | --- |
| [AjouteFilsDifféré](../Proprietes/1000020927.md) | Permet de définir la procédure qui sera appelée pour un remplissage différé d'une branche. |
| [Enroulé](../Proprietes/2513014.md) | Permet de connaître et définir l'état (enroulé ou déroulé) qui sera utilisé lors des prochains ajouts de lignes dans un champ Table hiérarchique. |
| [Fusion](../Proprietes/1000017095.md) | Permet de savoir si les cellules d'un champ Table hiérarchique (ou les titres de colonnes) sont fusionnées et permet de fusionner les cellules d'un champ Table hiérarchique (ou les titres de colonnes). |
| [ImageDéroulée](../Proprietes/2513015.md) | Permet de connaître et de modifier l'image par défaut d'une ligne déroulée dans un champ Table hiérarchique. |
| [ImageEnroulée](../Proprietes/2513016.md) | Permet de connaître et de modifier l'image par défaut d'une ligne enroulée dans un champ Table hiérarchique. |
| [Multisélection](../Proprietes/1000017054.md) | Permet de connaître et de modifier le mode de sélection d'un champ Table hiérarchique. |
| [NbFilsTotal](../Proprietes/1000021046.md) | Renvoie le nombre total de fils d'une branche d'un champ Table hiérarchique. |
| [OptionTri](../Proprietes/1000017044.md) | Permet de connaître et de modifier les options de tri définies pour une colonne d'un champ Table hiérarchique. |
| [RetraitGauche](../Proprietes/2513018.md) | Permet de connaître ou modifier l'espace laissé à gauche du texte dans les colonnes d'un champ Table hiérarchique. |
| [RubriqueParcourue](../Proprietes/2510111.md) | Permet de connaître et de modifier la rubrique utilisée pour le parcours automatique des champs Table hiérarchique. |
| [Taille](../Proprietes/2510125.md) | Permet de connaître et de modifier le nombre de colonnes d'un champ Table hiérarchique. |
| [TotauxActif](../Proprietes/2510122.md) | Permet de connaître le mode de fonctionnement des calculs automatiques pour un champ Table hiérarchique et d'interdire ou de forcer les calculs automatiques dans un champ Table hiérarchique. |


Pour connaître la liste complète des propriétés du WLangage pouvant être utilisées : 

- avec un champ Table hiérarchique, consultez [Propriétés associées à un champ Table hiérarchique](../WDChamp/1015003.md).

- avec les lignes d'un champ Table hiérarchique, consultez [Propriétés associées à une ligne d'un champ Table hiérarchique](../WDChamp/1015007.md)





