


## Le champ "Etat interne"
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation du champ "Etat interne"
<a name="presentation_champ_etat_interne_ELTTEXTE000263"></a>


### Champ d'un état
<a name="champ_etat_ELTPARAGRAPHE000011"></a>Grâce aux champs de type "Etat interne", il est possible d'imprimer plusieurs états (états secondaires) dans un seul état (état principal) sans programmation.

Par exemple, l'état principal suivant est composé de deux états secondaires imprimés côte à côte :

- un état affichant les données sous forme de tableau.

- un état affichant les données sous forme de graphe.<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=EtatInterne.gif&type=thumb)





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Avantages des états internes par rapport aux états imbriqués
<a name="avantages_des_etats_internes_par_rapport_aux_etats_imbriques_ELTTEXTE000287"></a>
Les [**états imbriqués**](../WDChamp/1011001.md) permettent également d'imprimer plusieurs états secondaires dans un seul état principal. Les états secondaires sont imprimés les uns en dessous des autres.
Pour imprimer ces états secondaires, utilisez la fonction [iImprimeEtat](../WDLang5/3046032.md) dans le code du bloc où les états secondaires doivent être imprimés.

Les **états internes** permettent d'imprimer **sans programmation** plusieurs états :

- soit les uns en dessous des autres.

- soit les uns à côté des autres.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000311"></a>


### Créer un état principal composé de plusieurs états secondaires
<a name="creer_etat_principal_compose_plusieurs_etats_secondaires_ELTPARAGRAPHE000061"></a>Pour créer un état principal composé de plusieurs états secondaires : 

1. Créez et enregistrez tous les états secondaires.

2. Créez l'état principal : 

	- Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif) parmi les boutons d'accès rapide. 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Etat" puis sur "Etat". L'assistant de création d'un état se lance.

	- Dans l'assistant, sélectionnez "Etat vierge" et validez.




3. Dans l'état principal, créez autant de champs de type "Etat interne" que d'états secondaires à imprimer. 
	Pour créer un état interne, sous le volet "Création", dans le groupe "Structure", cliquez sur "Etat interne".
	**Remarque** : L'état principal peut contenir tous les autres types de champs.

4. Associez chaque champ "Etat interne" à un état secondaire (option "Etat imprimé" dans l'onglet "Général" de la description du champ). L'état secondaire sera imprimé en totalité dans le champ "Etat interne".

5. Positionnez les champs "Etat interne" dans l'état principal.

6. Testez l'état principal (![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ICO_GO_fenetre_WD_bl.GIF) parmi les boutons d'accès rapide) pour vérifier l'impression de votre état.



<a name="NOTE3_2"></a>


### Etat principal non vierge
<a name="etat_principal_non_vierge_ELTPARAGRAPHE000099"></a>Si l'état principal et les états secondaires ont la même source de données, il est conseillé d'utiliser un contexte HFSQL indépendant :

- soit pour l'état principal.

- soit pour les états secondaires.




**Remarque** : Pour définir un contexte HFSQL indépendant :

1. Affichez la description de l'état (option "Description de l'état" du menu contextuel de l'état).

2. Dans l'onglet "Données", cochez l'option "L'exécution de l'état n'affecte pas les parcours (contexte HFSQL indépendant)".



<a name="NOTE3_3"></a>


### Etat secondaire
<a name="etat_secondaire_ELTPARAGRAPHE000120"></a>Un état secondaire peut contenir tous les types de champs sauf les champs de type "Etat interne".
<a name="NOTE3_4"></a>


### Etat secondaire basé sur une requête paramétrée
<a name="etat_secondaire_base_sur_une_requete_parametree_ELTPARAGRAPHE000127"></a>Si l'état secondaire est basé sur une requête paramétrée, utilisez la fonction [iInitRequêteEtat](../WDLang5/3046021.md) pour passer les paramètres à la requête. Cette fonction doit être utilisée dans l'événement "Avant impression" du bloc contenant le champ "Etat Interne".
<a name="NOTE3_5"></a>


### Etat secondaire basé sur une requête utilisant une connexion spécifique
<a name="etat_secondaire_base_sur_une_requete_utilisant_une_connexion_specifique_ELTPARAGRAPHE000137"></a>Si l'état secondaire est basé sur une requête manipulant une connexion spécifique, utilisez la fonction [iInitRequêteEtatConnexion](../WDLang5/3046028.md) pour exécuter cette requête (et lui passer si nécessaire des paramètres). Cette fonction doit être utilisée dans l'événement "Avant impression" du bloc contenant le champ "Etat Interne".
<a name="NOTE3_6"></a>


### Etat secondaire basé sur une vue HFSQL
<a name="etat_secondaire_base_sur_une_vue_hfsql_ELTPARAGRAPHE000147"></a>Si l'état secondaire est basé sur une vue HFSQL :

1. Déclarez une variable globale de type chaîne de caractères dans le projet et affectez à cette variable le nom de la vue HFSQL **avant l'exécution de l'état principal**.

2. Associez la vue à l'état secondaire grâce à la propriété [NomVue](../Proprietes/2511030.md) dans le code d'ouverture de l'état secondaire :
	
	```txt
	<NomEtatSecondaire>.NomVue = <NomVariableGlobale>
	```




<a name="NOTE3_7"></a>


### Passer des paramètres à un état interne
<a name="passer_des_parametres_etat_interne_ELTPARAGRAPHE000164"></a>Les paramètres donnés à l'état (lors de l'appel à la fonction [iImprimeEtat](../WDLang5/3046032.md)) sont automatiquement transmis à l'état interne. Attention, dans ce cas, le passage par référence des paramètres n'est pas garanti. 

Pour passer des paramètres à un état interne, il est conseillé d'utiliser des variables globales. Par exemple, il est possible de déclarer une variable globale dans l'état appelant. Cette variable pourra être ensuite manipulée dans l'état interne grâce à la syntaxe :

```txt
<NomEtatAppelant>.<Nom de la variable>
```


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Notes
<a name="notes_ELTTEXTE000383"></a>


### Dimension des états secondaires
<a name="dimension_des_etats_secondaires_ELTPARAGRAPHE000179"></a>Lors de l'impression de l'état principal, la largeur des états secondaires est ajustée en fonction de la largeur du champ "Etat interne".

Tous les blocs des états secondaires seront imprimés. L'état principal s'adaptera automatiquement à la hauteur des états secondaires en :

- augmentant si nécessaire la hauteur du champ "Etat interne".

- augmentant si nécessaire la hauteur du bloc contenant le champ "Etat interne".

- déplaçant vers le bas si nécessaire les champs positionnés sous le champ "Etat interne".



<a name="NOTE4_2"></a>


### Diminuer la largeur d'un état secondaire
<a name="diminuer_largeur_etat_secondaire_ELTPARAGRAPHE000192"></a>Pour diminuer la largeur d'un état secondaire :

1. Affichez l'onglet "Format" de la description de l'état secondaire (option "Description de l'état" du menu contextuel de l'état).

2. Modifiez la largeur de la page sur laquelle l'état secondaire est imprimé.

3. Validez. 



<a name="NOTE4_3"></a>


### Saut de page de l'état secondaire
<a name="saut_page_etat_secondaire_ELTPARAGRAPHE000203"></a>Les sauts de page définis dans un état secondaire seront ignorés lors de l'impression de l'état principal.
<a name="NOTE4_4"></a>


### Ouverture de l'état interne
<a name="ouverture_etat_interne_ELTPARAGRAPHE000212"></a>Le menu contextuel du champ "Etat Interne" sous l'éditeur permet d'ouvrir directement l'état interne grâce à l'option "Ouvrir l'état interne". 


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDEtats.gif) ***Exemples didactiques (WINDEV)*** : **WD Etats** <br>Cet exemple montre les différentes méthodes pour réaliser un état :<br> <br>- impressions basées sur différentes sources de données (requêtes, variables, ...)<br>- impressions basées sur des champs (Table, Tableur, TCD, ...)<br>- impression d'états composés<br>- impressions spécifiques (portrait / paysage, état avec filigrane, état avec code-barres, ...)


