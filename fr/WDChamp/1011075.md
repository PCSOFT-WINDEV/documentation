


## Imprimer des duplicata
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000280"></a>
Pour des raisons légales, il peut être nécessaire de conserver une copie strictement exacte d'un état, par exemple d'une facture. 

Par ailleurs, compte tenu du volume des données à traiter, certains états (par exemple statistiques) peuvent être longs à générer. 

La fonctionnalité de Duplicata permet de répondre automatiquement à cette problématique. 

**Le principe est simple** : Lors de l'édition d'un état (état créé sous l'éditeur d'états ou par programmation), sa copie exacte peut être générée dans un fichier au format ".dpl" et peut être conservée. 
Il devient alors possible de ré-éditer cette copie de l'état. Les données ne sont pas retraitées ce qui protège contre les modifications et rend cette ré-édition instantanée. 

La création d'un duplicata peut être réalisée : 

- depuis le visualisateur de rapports (WINDEV uniquement).

- par programmation. 


Il est possible de signer un duplicata à l'aide d'un certificat : 

- soit depuis le visualisateur de rapports. 

- soit par programmation.


**Remarques** : 

- L'impression d'un état avec duplicata ralentit l'impression. En effet, la durée de création du duplicata est comprise dans la durée de l'impression. Il est recommandé de faire des tests de performances. 

- L'impression d'une page d'un état avec duplicata entraîne la création du duplicata pour la totalité de l'état.




<a name="NOTE2"></a>


## Créer un duplicata depuis le visualisateur de rapports
<a name="creer_duplicata_depuis_visualisateur_rapports_ELTTEXTE000304"></a>
<a name="NOTE2_1"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Impression disponible par défaut
<a name="impression_disponible_par_defaut_ELTPARAGRAPHE000045"></a>Par défaut, le volet "Exporter" du visualisateur de rapports propose l'option "Duplicata" permettant de créer à tout moment un duplicata de l'état actuellement affiché. <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Apercu_Volet_Exporter.gif)


Lors de l'utilisation de cette option, un sélecteur de fichiers s'ouvre permettant : 

- de saisir le nom du fichier de type duplicata qui sera créé. 

- d'indiquer le certificat qui sera utilisé pour signer le duplicata. La signature du duplicata est bien entendu optionnelle.




Par défaut, le duplicata : 

- est enregistré dans le répertoire de l'application. 

- n'a pas de mot de passe. 

- a pour nom : Dupli_AAAAMMJJ_HHMMSS.dpl.




**Remarques** : 

- Pour ne pas proposer l'option d'impression des duplicata, utilisez la fonction [iParamètreVisualisateur](../WDLang5/1000024634.md) (constante *iBoutonDuplicata*). 

- Pour modifier les paramètres par défaut du duplicata, utilisez la fonction [iParamètreDuplicata](../WDLang5/1000018845.md) avant d'afficher le visualisateur de rapports.



<a name="NOTE2_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Personnalisation du duplicata créé
<a name="personnalisation_duplicata_cree_ELTPARAGRAPHE000079"></a>Pour modifier les paramètres par défaut pour les duplicatas créés depuis le visualisateur de rapports, il est possible d'utiliser la fonction [iParamètreDuplicata](../WDLang5/1000018845.md) avec la constante *iDplImpression*. 

Exemple : 

```wl
// Paramétrage du duplicata de la facture
iParamètreDuplicata(iDplImpression, "C:\Temp", ...
	"MonDuplicata_%d_%h", "JJJJ JJ MMMM AAAA", "HH.MM.SS")

// Impression du duplicata
iDestination(iVisualisateur)
iImprimeEtat(ETAT_Facture)
```

La fonction [iParamètreDuplicata](../WDLang5/1000018845.md) permet : 

- de personnaliser les options de duplicata proposées par défaut par l'option "Duplicata" présente dans le visualisateur de rapports. 

- d'automatiser l'impression d'un duplicata depuis le visualisateur de rapports. En effet : 

	- le duplicata sera généré lors de l'impression (réalisée depuis le visualisateur de rapports). 

	- si une annotation ou un champ de saisie est modifié dans le visualisateur de rapports, un nouveau duplicata sera généré lors de la prochaine impression.

	- si l'impression est effectuée sur plusieurs imprimantes différentes, un duplicata sera généré pour chaque imprimante. 







**Remarque** : La liste des duplicatas créés lors de la dernière impression peut être connue grâce à la fonction [iDernierFichier](../WDLang5/3046068.md). 
<a name="NOTE2_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Personnalisation du visualisateur de rapports
<a name="personnalisation_visualisateur_rapports_ELTPARAGRAPHE000111"></a>Si vous avez personnalisé le visualisateur de rapports avec une version ne gérant pas cette option, pour gérer les duplicatas, il suffit de : 

1. Importer la nouvelle fenêtre du visualisateur de rapports. 

2. Copier le bouton de création du duplicata. 




Pour plus de détails, consultez [Personnaliser le visualisateur de rapports](../WDChamp/2024002.md). 

<a name="NOTE3"></a>


## Créer un duplicata par programmation
<a name="creer_duplicata_par_programmation_ELTTEXTE000340"></a>
<a name="NOTE3_1"></a>
Pour créer un duplicata par programmation :

1. Utilisez la fonction [iParamètreDuplicata](../WDLang5/1000018845.md) (avec la constante *iDplImpression*) pour paramétrer les options de création des duplicata. 

2. Utilisez la fonction [iDestination](../WDLang5/3046074.md) en précisant que l'impression doit être réalisée sur une imprimante. Le duplicata sera créé en même temps que l'impression sera réalisée. 




Pour arrêter l'impression des duplicatas, utilisez la fonction [iParamètreDuplicata](../WDLang5/1000018845.md) (avec la constante *iDplAucun*). 

<a name="NOTE4"></a>


## Signer un duplicata
<a name="signer_duplicata_ELTTEXTE000364"></a>
<a name="NOTE4_1"></a>
Les duplicata peuvent être signés à l'aide d'un certificat. Cette signature assure l'intégrité des états mémorisés. La signature est intégrée au duplicata. 

Cette signature effectue automatiquement un horodatage. Elle peut être nécessaire sur le plan légal pour certaines utilisations. 

La norme de signature utilisée est PKCS7. 

Il est possible de signer un duplicata à l'aide d'un certificat : 

- soit depuis le visualisateur de rapports (consultez le paragraphe [Créer un duplicata depuis le visualisateur de rapports](#NOTE2_1) de cette page). 

- soit par programmation : 

	- La signature de duplicata est réalisée grâce aux fonctions : 
			


|   |   |
| --- | --- |
| [iDestination](../WDLang5/3046074.md) | Paramètre la destination de l'impression. |
| [iParamètreDuplicata](../WDLang5/1000018845.md) | Paramètre la création automatique du duplicata généré lors de la prochaine impression. |

- La vérification de la signature d'un fichier duplicata est réalisée grâce à la fonction : 
			




**Remarque** : Si l'état comprend un champ Signature (lié à un certificat) ou si la fonction [iImprimeSignature](../WDLang5/1000021690.md) est utilisée, le duplicata sera automatiquement signé lors de sa création. 

<a name="NOTE5"></a>


## Utiliser un duplicata
<a name="utiliser_duplicata_ELTTEXTE000407"></a>
<a name="NOTE5_1"></a>
Pour utiliser un duplicata existant, il est possible de : 

- dropper le fichier ".dpl" dans l'éditeur de WINDEV ou WEBDEV : le duplicata s'ouvre automatiquement dans le visualisateur de rapports et peut être imprimé. 

- utiliser la fonction [iImprimeDuplicata](../WDLang5/1000018842.md). Cette fonction permet d'imprimer le fichier ".dpl" spécifié. Pour afficher le duplicata dans le visualisateur de rapports, il suffit d'utiliser la fonction [iDestination](../WDLang5/3046074.md). Par exemple : 
	
	```wl
	iDestination(iVisualisateur)
	iImprimeDuplicata("C:\Mes Projets\Mon_Projet\Exe\Dupli_20101021_112712.dpl")
	```



![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Visionneuse de duplicata**
Installée avec l'application sur le poste de l'utilisateur final, cette visionneuse permet de visualiser et d'imprimer facilement le contenu d'un fichier duplicata. Il suffira de double-cliquer sur le fichier d'extension ".dpl".  
Pour installer cet outil, il suffit de sélectionner l'outil optionnel "DplViewer" dans l'assistant de génération du programme d'installation. 
<a name="NOTE5_2"></a>


### Bandeaux colorés
<a name="bandeaux_colores_ELTPARAGRAPHE000222"></a>Lors de l'affichage d'un duplicata dans le visualisateur de rapports, différents bandeaux peuvent apparaître en bas du visualisateur pour informer l'utilisateur sur le fichier duplicata manipulé : ![centeralt=Bandeaux colorés](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Duplicata_couleurs.gif)![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Visionneuse de duplicata**
Ces bandeaux colorés sont également disponibles dans la visionneuse de duplicata. 


