


## Evénements associés aux états
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000328"></a>
Les différents événements associés aux états sont les suivants (ordre d'apparition sous l'éditeur de code) :

- [Ouverture de l'état](#NOTE2_1).

- [Lecture des données](#NOTE3_1).

- [Filtre (tenir compte de l'enregistrement ?)](#NOTE4_1).

- [Fermeture de l'état](#NOTE5_1).

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) [Avant réimpression de l'état](#NOTE6_1).




Plusieurs événements sont associés aux états. Ces événements sont exécutés lors de l'impression de l'état.

Pour connaître l'ordre d'exécution de ces événements, consultez [Enchaînement des événements associés aux états](../WDChamp/1011004.md).

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Evénement "Ouverture" de l'état
<a name="evenement_ouverture_etat_ELTTEXTE000352"></a>


### Exécution de l'événement
<a name="execution_evenement_ELTPARAGRAPHE000045"></a>L'événement "Ouverture" de l'état est exécuté lors du lancement de l'impression de l'état.

**Rappel** : L'ordre d'exécution des événements au lancement d'un état (y compris lors d'un test) est le suivant :

- "Ouverture" de l'état.

- ["Initialisation" des blocs de l'état](../WDChamp/1011042.md).

- ["Initialisation" des champs](../WDChamp/1013047.md).



<a name="NOTE2_2"></a>


### Mot de passe du fichier de données source de l'état
<a name="mot_passe_fichier_donnees_source_etat_ELTPARAGRAPHE000062"></a>Si le fichier de données source de l'état est protégé par un mot de passe, précisez ce mot de passe avant l'ouverture du fichier de données (grâce à la fonction [HPasse](../WDLang4/3044108.md) par exemple).

Si le fichier de données n'a pas été ouvert avant l'impression de l'état, il est possible de préciser le mot de passe dans l'événement "Ouverture" de l'état.
<a name="NOTE2_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Initialisation des variables
<a name="initialisation_des_variables_ELTPARAGRAPHE000076"></a>Lors de l'impression d'un état depuis le visualisateur de rapports, l'état est automatiquement ré-exécuté lorsque :

- l'utilisateur change d'imprimante.

- l'utilisateur utilise une des options d'export du ruban (Impression en mode PDF, HTML, dans un email, ...).


Dans ce cas, les données imprimées dans l'état peuvent être différentes de celles visualisées dans le visualisateur de rapports.

Il est conseillé d'initialiser les variables nécessaires à l'état dans l'événement "Ouverture de l'état" plutôt que dans le code du champ Bouton qui lance l'impression.
<a name="NOTE2_4"></a>


### Exemples d'utilisation
<a name="exemples_utilisation_ELTPARAGRAPHE000090"></a>Cet événement permet par exemple de :

- déclarer les variables globales de l'état.

- modifier les bornes de l'état avec les propriétés [BorneMin](../Proprietes/2510008.md) et [BorneMax](../Proprietes/2510009.md).

- initialiser les mots de passe des fichiers de données si nécessaire.

- paramétrer la destination de l'impression (fonction [iDestination](../WDLang5/3046074.md)).

- passer des paramètres à la requête liée à l'état (fonction [iInitRequêteEtat](../WDLang5/3046021.md)).

- récupérer les paramètres passés à l'état.

- changer la source de données de l'état.




**Remarque** : La fonction [iImprime](../WDLang5/3046031.md) ne doit pas être utilisée dans l'événement "Ouverture" de l'état.

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Evénement "Lecture des données"
<a name="evenement_lecture_des_donnees_ELTTEXTE000394"></a>


### Exécution de l'événement
<a name="execution_evenement_ELTPARAGRAPHE000124"></a>Cet événement est exécuté lors du parcours des enregistrements à imprimer (dans la boucle d'impression), après la lecture de l'enregistrement.
<a name="NOTE3_2"></a>


### États basés sur un fichier texte
<a name="etats_bases_sur_fichier_texte_ELTPARAGRAPHE000131"></a>Pour les états basés sur un fichier texte (avec lecture programmée), l'événement "Lecture des données" permet de lire les enregistrements présents dans le fichier texte pour les imprimer.
<a name="NOTE3_3"></a>


### Exemples d'utilisation
<a name="exemples_utilisation_ELTPARAGRAPHE000138"></a>Cet événement permet par exemple de :

- effectuer des substitutions de blocs (car le prochain enregistrement à imprimer est connu).

- sélectionner des enregistrements.

- effectuer des calculs spécifiques.




**Remarque** : Cet événement renvoie <u><u><u><u>Vrai</u></u></u></u> s'il reste des enregistrements à imprimer et <u><u><u><u>Faux</u></u></u></u> s'il n'y a plus d'enregistrements à imprimer.

Pour ne pas imprimer un enregistrement, utilisez l'événement "Filtre (tenir compte de l'enregistrement ?)".

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Evénement "Filtre (tenir compte de l'enregistrement ?)"
<a name="evenement_filtre_tenir_compte_enregistrement_ELTTEXTE000430"></a>


### Exécution de l'événement
<a name="execution_evenement_ELTPARAGRAPHE000163"></a>Cet événement est exécuté :

- lors de l'initialisation de la source de données si elle est effectuée (pour les états basés sur un fichier de données, une vue ou une zone mémoire).

- dans la boucle d'impression, après la lecture de l'enregistrement (cas des états sur requête ou sur un champ Table).




Cet événement permet de filtrer les enregistrements affichés dans l'état.
<a name="NOTE4_2"></a>


### Utilisation de l'événement Filtre
<a name="utilisation_evenement_filtre_ELTPARAGRAPHE000175"></a>Si cet événement contient des lignes de code, ces lignes de codes doivent renvoyer une valeur :

- <u><u><u><u>Annuler</u></u></u></u> pour arrêter la lecture des enregistrements (et arrêter l'impression).

- <u><u><u><u>Vrai</u></u></u></u> pour signifier que l'enregistrement vérifie le filtre et qu'il doit être imprimé.

- <u><u><u><u>Faux</u></u></u></u> pour signifier que l'enregistrement ne vérifie pas le filtre et qu'il ne doit pas être imprimé.



<a name="NOTE4_3"></a>


### Exemples d'utilisation
<a name="exemples_utilisation_ELTPARAGRAPHE000195"></a>Cet événement permet par exemple de :

- sélectionner des enregistrements.

- réaliser des calculs avancés (total préalable, ...) pour les états basés sur les fichiers de données, les vues ou les zones mémoires.




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Evénement "Fermeture" de l'état
<a name="evenement_fermeture_etat_ELTTEXTE000466"></a>


### Exécution de l'événement
<a name="execution_evenement_ELTPARAGRAPHE000207"></a>Cet événement est exécuté lorsque l'impression de l'état est terminée, juste avant de fermer l'état.

Cet événement ne doit pas contenir de [fonctions d'impression](../WDLang5/3046065.md).

Remarque : La fonction [iFichierEnCours](../WDLang5/1000021859.md) permet de connaître le nom du fichier généré pour l'état (cas des exports en PDF, HTML, ...).
<a name="NOTE5_2"></a>


### Exemples d'utilisation
<a name="exemples_utilisation_ELTPARAGRAPHE000226"></a>Cet événement permet par exemple de :

- connaître l'état de l'impression en cours (fonction [iStatusImpressionEtat](../WDLang5/3046043.md)).

- ouvrir une boîte de dialogue.




<a name="NOTE6"></a>
<a name="NOTE6_1"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

## Evénement "Avant réimpression" de l'état
<a name="evenement_avant_reimpression_etat_ELTTEXTE000496"></a>


### Exécution de l'événement
<a name="execution_evenement_ELTPARAGRAPHE000244"></a>Cet événement est exécuté lors d'une impression effectuée depuis le visualisateur de rapports (impression directe ou export dans les formats PDF, XLS, RTF, ...). 

Cet événement est exécuté après l'événement "Ouverture de l'état". 

Si cet événement renvoie :

- <u><u><u><u>Vrai</u></u></u></u>, la réimpression sera effectuée. 

- <u><u><u><u>Faux</u></u></u></u>, la réimpression sera annulée.




Remarques : 

- La fonction [iDestination](../WDLang5/3046074.md) utilisée dans cet événement permet de connaître la destination de l'état (HTML, PDF, ...). 

- La fonction [iFichierEnCours](../WDLang5/1000021859.md) utilisée dans cet événement permet de connaître le nom du fichier généré pour l'état (cas des exports en PDF, HTML, ...).



<a name="NOTE6_2"></a>


### Exemples d'utilisation
<a name="exemples_utilisation_ELTPARAGRAPHE000275"></a>Cet événement permet par exemple de :

- demander la qualité du PDF généré avant l'export au format PDF. 

- ajouter un filigrane. 

- demander un mot de passe avant l'impression ou l'export.





