


## Etat sur variable (Data binding)
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000353"></a>
L'état sur variable permet d'imprimer directement les informations présentes dans une variable WLangage. Cette variable peut être : 

- une variable globale au projet,

- une variable globale à une fenêtre ou une page. 

- une variable globale à une collection de procédures. 


Cette variable peut être par exemple une variable de type tableau simple, un membre d'une classe, un membre d'une structure ou un membre d'une variable de type avancé. 

|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png)<br> | Important | [**Le logiciel Etats & Requêtes**](../Presentation/3088004.md) ne permet pas de créer ou de modifier des états sur variable. |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer un état sur variable
<a name="creer_etat_sur_variable_ELTTEXTE000395"></a>
Pour créer un état sur variable :

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif)
 parmi les boutons d'accès rapide. 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Etat" puis sur "Etat". 

	- L'assistant de création d'un état se lance. 




2. Dans l'assistant, choisissez la présentation de votre état (tableau, fiche, étiquette, ...). Pour plus de détails, consultez [Les différents types d'états](../WDChamp/1011054.md).

3. Sélectionnez si nécessaire le modèle d'états à utiliser. Un modèle d'états permet de respecter une mise en page spécifique. Pour plus de détails sur les modèles d'états, consultez [Les modèles d'états](../WDChamp/9000105.md). 

4. Sélectionnez la source de données de l'état (option "D'une variable existante").

5. Sélectionnez la variable de type tableau sur laquelle est basé l'état. Seules les variables globales au projet ou aux fenêtres présentes dans l'application en cours sont proposées.

6. Pour grouper les enregistrements, il est possible de créer des ruptures sur les éléments du tableau. Pour créer des ruptures, répondez "Oui" à la question "Voulez-vous des ruptures dans l'état ?".
	Le plan suivant permet alors de sélectionner les variables correspondant aux ruptures. 
	**Attention** : Avant d'imprimer l'état, dans le cas d'un tableau, il sera nécessaire de trier par programmation la variable tableau selon la variable de rupture. Ce tri sera par exemple réalisé avec la fonction [Trie](../WDLang1/1000017364.md).  
	Pour plus de détails sur les ruptures, consultez les [Ruptures dans un état](../WDChamp/1011028.md).

7. Sélectionnez les variables à afficher dans l'état. Modifiez si nécessaire l'ordre d'affichage des différents champs dans l'état à l'aide des boutons fléchés à droite de la liste.

8. Sélectionnez le bloc dans lequel chaque variable sera affiché. Il est également possible de renommer le libellé du champ. 
	Remarque : Par défaut, les champs associés aux variables sont affichées dans le bloc Corps. Le libellé du champ correspond par défaut au nom de la variable. Ce libellé pourra être modifié également directement sous l'éditeur d'états.

9. Si la variable associée à l'état contient au moins une rubrique de type numérique, il est possible de réaliser des calculs sur ces rubriques. Spécifiez le calcul réalisé pour chaque rubrique (somme, moyenne, ...). Deux types de calcul sont possibles :

	- calcul général : un champ Calculé sera créé dans le bloc *Fin de document*.

	- calcul sur rupture : un champ Calculé sera créé dans le bloc *Bas de rupture*. Dans les calculs sur rupture, le résultat du calcul est réinitialisé à chaque rupture. Pour réaliser un calcul sur rupture, une rupture doit être présente dans l'état en cours de création.




10. Selon le type d'état en cours de création, indiquez les options spécifiques correspondantes.
	

| Type d'état | Options spécifiques |
| --- | --- |
| État sur formulaire | Image du formulaire, impression de l'image du formulaire, ...<br>Options détaillées dans la page [Etat sur formulaire](../WDChamp/1011067.md) |
| État Étiquette | Format des étiquettes, nombre d'exemplaires identiques, ...<br>Options détaillées dans la page [Etat Étiquette](../WDChamp/1011050.md) |



11. Spécifiez le format de la feuille sur laquelle l'état va être imprimé. Par défaut, l'état est imprimé sur une feuille au format A4.
	Remarque : Par défaut, les champs de l'état sont disposés sur une seule colonne. Pour réaliser un état multicolonne, il suffit de spécifier le nombre de colonnes voulues dans l'onglet "Format" de la fenêtre de description de l'état.

12. Sélectionnez le gabarit de l'état si nécessaire.

13. Saisissez le nom et le titre de l'état (nom du fichier ".WDE" correspondant à l'état). Ce nom permettra d'identifier l'état dans vos programmes.

14. Validez la création de l'état. 

15. L'éditeur d'états propose automatiquement de changer le format de l'état utilisé si les conditions suivantes sont réunies :

	- l'état en cours de création comporte un tableau.

	- le format de l'état ne permet pas d'afficher l'ensemble des colonnes du tableau.




16. Si nécessaire, indiquez le mode de réduction de l'état : 

	- Imprimer l'état sur plusieurs pages. Dans ce cas, l'utilisateur final devra assembler les pages. Pour plus de détails, consultez [Impression multipage](../WDChamp/1011065.md).

	- Utiliser le mode paysage. 

	- Réduire l'état par rapport à l'original. Attention : selon le pourcentage de réduction choisi, l'état imprimé pourra devenir illisible. 




17. L'état en cours de création s'affiche sous l'éditeur d'états.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Imprimer un état sur une variable
<a name="imprimer_etat_sur_une_variable_ELTTEXTE000419"></a>


### Imprimer un état sur une variable
<a name="imprimer_etat_sur_une_variable_ELTPARAGRAPHE000134"></a>Pour imprimer un état sur une variable, il suffit de :

1. Initialiser la valeur de la variable utilisée.

2. Si nécessaire, trier le tableau (par exemple avec la fonction [TableauTrie](../WDLang1/3075007.md)). 

3. Paramétrer la destination de l'impression de l'état :

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) En WINDEV, grâce à la fonction [iDestination](../WDLang5/3046074.md) (visualisateur de rapports, impression dans un fichier HTML, ...).


 Pour plus de détails, consultez [Modes d'impression d'un état](../WDChamp/1011031.md).

4. Préciser le nom de l'état à imprimer grâce à la fonction [iImprimeEtat](../WDLang5/3046032.md).


Si nécessaire, il est possible de spécifier des paramètres supplémentaires lors de l'impression d'un état paramétré basé sur une variable. Par exemple, il est possible de passer en paramètre le nom de la variable tableau à utiliser. Dans ce cas, l'état est un état paramétré sur une variable tableau (voir paragraphe suivant).  |   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png)<br> | Important | Sous [le logiciel Etats & Requêtes](../Presentation/3088004.md), il est possible d'imprimer un état :<br><br>- soit en lançant une impression (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Imprimer.gif)<br>). <br><br>- soit en testant l'état (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Go_Fenetre_WD_bl.gif)<br>). <br><br><br>Il n'est donc pas nécessaire de programmer l'impression de l'état. |




![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Exemples WINDEV et WINDEV Mobile
<a name="exemples_windev_windev_mobile_ELTPARAGRAPHE000186"></a>L'état "ETAT_gglEvenement" est un état basé sur la variable MesEvenements de type gglEvénement. Cet état permet d'imprimer la liste des événements d'un agenda Google.

L'état "ETAT_gglEvenement" s'imprime lors d'un clic sur le bouton "BTN_Evénement". Dans cet exemple, le code de clic du bouton "BTN_Evénement" est le suivant :

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Code WINDEV :
	
	```wl
	// Ouvrir le visualisateur de rapports
	iDestination(iVisualisateur)
	// Imprimer l'état ETAT_gglEvenement
	iImprimeEtat(ETAT_gglEvenement)
	```






### Remarques
<a name="remarques_ELTPARAGRAPHE000210"></a>

- La propriété [NomSource](../Proprietes/2511035.md) utilisée dans le code de l'état permet de connaître et de changer le nom de la variable associée à l'état.

- La propriété [RubriqueAffichee](../Proprietes/2510123.md) utilisée dans le code de l'état permet de connaître et de changer le nom de la variable associée à la rubrique.





### Imprimer un état paramétré basé sur une variable
<a name="imprimer_etat_parametre_base_sur_une_variable_ELTPARAGRAPHE000222"></a>Pour imprimer un état paramétré, il est nécessaire de passer des paramètres. Pour plus de détails, consultez les [Etats paramétrés](../WDChamp/1011008.md).

Pour imprimer un état paramétré basé sur une variable, il suffit de :

1. Initialiser la valeur de la variable tableau utilisée.

2. Si nécessaire, trier le tableau (par exemple avec la fonction [TableauTrie](../WDLang1/3075007.md)). 

3. Paramétrer la destination de l'impression de l'état :

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) En WINDEV, grâce à la fonction [iDestination](../WDLang5/3046074.md) (visualisateur de rapports, impression dans un fichier HTML, ...).

	- 
			Pour plus de détails, consultez [Modes d'impression d'un état](../WDChamp/1011031.md).




4. Préciser les paramètres suivants grâce à la fonction [iImprimeEtat](../WDLang5/3046032.md) :

	- le nom de l'état à imprimer.

	- les différents paramètres attendus par l'état (dans l'ordre spécifié dans l'état).






![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Exemple WINDEV et WINDEV Mobile
<a name="exemple_windev_windev_mobile_ELTPARAGRAPHE000275"></a>Une fenêtre liste les agendas et leurs événements. L'état "ETAT_gglEvenement" s'imprime lors d'un clic sur le champ Bouton "Imprimer les événements de l'agenda". Cet état attend en paramètre l'agenda pour lequel les événements doivent être listés. 

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Code WINDEV** :

- le code de clic du champ Bouton "Imprimer les événements de l'agenda" est le suivant :
	
	```wl
	// Ouvrir le visualisateur de rapports
	iDestination(iVisualisateur)
	// Imprimer l'état avec le passage des paramètres
	iImprimeEtat(ETAT_gglEvenement, Agenda[1])
	```


- le code de l'état est le suivant :
	
	```wl
	// Récupérer les paramètres passés à l'état
	PROCEDURE ETAT_gglEvenement(MonAgenda)
	```






- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDEtats.gif) ***Exemples didactiques (WINDEV)*** : **WD Etats** <br>Cet exemple montre les différentes méthodes pour réaliser un état :<br> <br>- impressions basées sur différentes sources de données (requêtes, variables, ...)<br>- impressions basées sur des champs (Table, Tableur, TCD, ...)<br>- impression d'états composés<br>- impressions spécifiques (portrait / paysage, état avec filigrane, état avec code-barres, ...)


