


## Manipuler les blocs d'un état par programmation
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000187"></a>
Chaque bloc de l'état est associé à différents événements. Ces événements permettent d'affiner le fonctionnement de l'état grâce aux différents ordres de programmation du WLangage.

De plus, chaque bloc peut être lui-même manipulé en WLangage : il suffit d'utiliser le nom du bloc dans le code WLangage.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Evénements des blocs d'un état
<a name="evenements_des_blocs_etat_ELTTEXTE000211"></a>
Les événements associés aux blocs d'un état sont les suivants :

| Evénements | Conditions d'exécution |
| --- | --- |
| Initialisation | Exécuté lors de l'initialisation du bloc. L'ordre d'exécution des événements au lancement d'un état (y compris lors d'un test) est le suivant :<br><br>- événement "[Ouverture](../WDChamp/1011037.md)" de l'état.<br><br>- événement "Initialisation" des blocs de l'état.<br><br>- événement "[Initialisation](../WDChamp/1013047.md)" des champs.<br><br><br>Cet événement permet par exemple de :<br><br>- initialiser des champs "Calculé".<br><br>- initialiser des variables globales déclarées dans l'événement "Ouverture" de l'état.<br><br>- effectuer des substitutions de blocs.<br><br><br> |
| Avant impression | Avant l'impression d'un bloc, les opérations suivantes sont réalisées :<br><br>- lecture de l'enregistrement en cours.<br><br>- affectation des valeurs lues dans les champs du bloc.<br><br>- réalisation des calculs sur les valeurs des rubriques.<br><br>- exécution de l'événement "Avant impression" du bloc.<br><br>- réalisation des calculs sur les champs du bloc.<br><br><br>Lorsque cet événement est appelé, l'éditeur d'états s'est assuré qu'il reste assez de place sur la page en cours pour imprimer le bloc en cours (cas d'un bloc insécable). S'il n'y a pas assez de place pour imprimer le bloc insécable en cours, il y a passage à la page suivante (et impression des blocs Pied de page, Entête de page et Complément de corps si nécessaire).<br><br>Si le bloc est auto extensible, l'événement "Avant impression de bloc" est exécuté avant de savoir si le bloc va pouvoir être imprimé sur la page.<br><br>Cet événement permet par exemple de :<br><br>- consulter et modifier les champs du bloc concerné.<br><br>- affecter des images.<br><br>- exécuter la fonction [iTerminePage](../WDLang5/3046038.md) dans le bloc Haut de rupture.<br><br><br>**Attention** : Cet événement ne peut pas exécuter de substitution du bloc en cours. Il peut par contre demander la substitution d'un autre bloc. |
| Après impression | Exécuté après l'impression du bloc.<br><br>Cet événement permet par exemple de :<br><br>- consulter et modifier les champs du bloc concerné.<br><br>- affecter des images.<br><br>- remettre à zéro les champs qui viennent d'être imprimés.<br><br>- substituer les blocs (pris en compte pour les prochains blocs).<br><br>- imprimer un bloc *Itération* (fonction [iImprimeBloc](../WDLang5/3046030.md)).<br><br><br> |
| Valeur de rupture<br>(Bloc *Haut de rupture* uniquement) | Exécuté avant l'événement "Avant impression" du bloc *Fin de rupture*.<br>Pour plus de détails sur les ruptures dans un état, consultez [Rupture dans un état](../WDChamp/1011028.md). |


**Rappel** : Si la destination de l'impression est un fichier HTML, les blocs Haut de page et Bas de page ne sont édités qu'une seule fois. 

Pour visualiser les événements spécifiques à un bloc, utilisez :

- soit l'option "Code du bloc" du menu contextuel du bloc (clic droit sur l'intitulé du bloc).

- soit l'icône "Code" de la description du bloc.


Certaines fonctions et propriétés sont spécifiques à la manipulation des blocs. 

**Remarque** : Les événements associés à un bloc de l'état sont exécutés lors de l'impression de ce bloc. Dans ces événements, vous pouvez utiliser du code WLangage. Pour plus de détails sur l'enchaînement de ces événements, consultez [Enchaînement des événements associés à un état](../WDChamp/1011004.md). 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Manipuler un bloc dans un événement ou traitement WLangage
<a name="manipuler_bloc_dans_evenement_traitement_wlangage_ELTTEXTE000235"></a>
Pour manipuler un bloc d'un état dans un événement ou traitement WLangage, il est possible d'utiliser une des deux méthodes suivantes :

- utiliser directement le nom de ce bloc. Cette syntaxe est valable uniquement si ce bloc est manipulé depuis l'état auquel il appartient.

- utiliser la notation suivante : "&lt;NomEtat&gt;.&lt;NomBloc&gt;".




Un bloc peut être manipulé :

- soit dans une fonction WLangage.

- soit avec une propriété WLangage.

- soit en affectation directe.




Par exemple :

```wl
// Imprimer un bloc d'itération
iImprimeBloc("ITERATION1") 
// Rendre le bloc "Corps" invisible 
Corps.Visible = Faux
```



