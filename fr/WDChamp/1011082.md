
## Etat sur un champ Table hiérarchique
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000293"></a>
L'état sur un champ Table hiérarchique permet d'imprimer directement les informations affichées dans un champ Table hiérarchique présent  :

- dans une fenêtre ou une page de l'application. Cette fenêtre ou page doit être affichée lors de l'impression de l'état.

- dans une fenêtre interne ou une page interne : 

	- La fenêtre affichant la fenêtre interne doit être affichée.

	- La page affichant la page interne doit être affichée.







Un état sur un champ Table hiérarchique peut imprimer :

- soit toutes les lignes affichées dans le champ Table hiérarchique.

- soit uniquement les lignes sélectionnées par l'utilisateur (cas des champs Table hiérarchique multisélection où les lignes sont sélectionnées grâce à la touche Ctrl). Cette option n'est pas disponible en WEBDEV.

- soit la hiérarchie entière. 

- soit uniquement la hiérarchie visible dans le champ Table hiérarchique. 




**Remarque** : Seul un état de type Tableau hiérarchique peut être créé sur un champ Table hiérarchique. 



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer un état sur un champ Table hiérarchique depuis l'éditeur d'états
<a name="creer_etat_sur_champ_table_hierarchique_depuis_editeur_etats_ELTTEXTE000317"></a>
L'éditeur d'états permet de créer un état de type Tableau hiérarchique basé sur un champ Table hiérarchique. Chaque ligne et chaque colonne du champ Table hiérarchique sont affichées dans l'état Tableau hiérarchique. 

Après avoir créé l'état, l'impression de l'état nécessite une programmation en WLangage. Pour plus détails, consultez le paragraphe [Imprimer un état sur un champ Table hiérarchique](#NOTE4_1).|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png)<br> | Important | [**Le logiciel Etats & Requêtes**](../Presentation/3088004.md) ne permet pas de créer des états sur un champ Table hiérarchique. Cependant, il est possible de personnaliser des états sur un champ Table hiérarchique créés sous l'éditeur d'états intégré (couleur, polices, taille, ...). |






<a name="NOTE2_2"></a>


### Créer un état sur un champ Table hiérarchique depuis l'éditeur d'états
<a name="creer_etat_sur_champ_table_hierarchique_depuis_editeur_etats_ELTPARAGRAPHE000048"></a>Pour créer un état sur un champ Table hiérarchique depuis l'éditeur d'états : 

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif)
 parmi les boutons d'accès rapide. 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Etat" puis sur "Etat". 

	- L'assistant de création d'un état s'affiche.




2. Choisissez un état de type "Tableau hiérarchique". 

3. Sélectionnez "D'un champ Table hiérarchique" et passez à l'étape suivante. 

4. Indiquez : 

	- le champ Table hiérarchique sur lequel sera basé l'état. Seuls les champs Table hiérarchique présents dans les fenêtres ou les pages du projet en cours sont proposés.

	- si seules les lignes sélectionnées doivent être imprimées ou si toutes les lignes du champ doivent être imprimées. 




5. Sélectionnez les rubriques (colonnes du champ Table hiérarchique) à imprimer et leur position (bloc associé). 

6. Indiquez si des calculs doivent être réalisés sur les rubriques numériques.

7. Spécifiez le format de la feuille sur laquelle l'état va être imprimé. Par défaut, l'état est imprimé sur une feuille au format A4.

8. Sélectionnez le gabarit à utiliser. 

9. Saisissez le nom et le titre de l'état (nom du fichier ".WDE" correspondant à l'état). Ce nom permettra d'identifier l'état dans vos programmes.
	![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Il est également possible d'indiquer si l'état peut être modifié par l'utilisateur final sous le logiciel "Etats et Requêtes". 

10. Validez la création de l'état. 

11. L'éditeur d'états propose automatiquement de changer le format de l'état utilisé. 

12. Indiquez le mode de réduction de l'état : 

	- Imprimer l'état sur plusieurs pages. Dans ce cas, l'utilisateur final devra assembler les pages. Pour plus de détails, consultez [Impression multipage](../WDChamp/1011065.md). 

	- Utiliser le mode paysage. 

	- Réduire l'état par rapport à l'original. Attention : selon le pourcentage de réduction choisi, l'état imprimé pourra devenir illisible. 




13. L'état en cours de création s'affiche sous l'éditeur d'états.






<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Caractéristiques de l'état sur un champ Table hiérarchique
<a name="caracteristiques_etat_sur_champ_table_hierarchique_ELTTEXTE000365"></a>
Un état sur un champ Table hiérarchique correspond à un état sur un champ table avec quelques caractéristiques supplémentaires. 

L'état est donc constitué d'un tableau. Pour plus de détails sur la manipulation d'un tableau dans un état, consultez : 

- [Description d'un tableau d'un état](../WDChamp/1013051.md). 

- [Manipuler les cellules d'un tableau d'un état](../WDChamp/1013049.md). 




Dans la description de l'état, il est possible de paramétrer des informations spécifiques à ce type d'état dans l'onglet "Données" : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Lignes imprimées** : Comme pour le champ Table, il est possible d'indiquer si seules les lignes sélectionnées ou l'ensemble des lignes du champ doivent être imprimées.

- **Impression de la hiérarchie** : Il est possible de spécifier si seule la hiérarchie affichée dans le champ doit être imprimée ou si la hiérarchie complète doit être imprimée. 





<a name="NOTE3_2"></a>


### Test de l'état
<a name="test_etat_ELTPARAGRAPHE000115"></a>Il est impossible de tester un état sur un champ Table hiérarchique directement depuis l'éditeur d'états car la fenêtre ou la page contenant le champ Table hiérarchique doit être ouverte. Pour tester un état sur un champ Table hiérarchique, il est donc nécessaire de :

- créer si nécessaire un bouton dans la fenêtre ou la page du champ Table hiérarchique. Ce bouton permet de lancer l'impression de l'état sur le champ Table hiérarchique (fonction [iImprimeEtat](../WDLang5/3046032.md)). 
	Cas des fenêtres internes ou des pages internes : Si le champ Table hiérarchique est présent dans une fenêtre interne ou une page interne, il est conseillé de créer le bouton dans la fenêtre/page interne et non dans la fenêtre/page hôte.

- tester directement la fenêtre contenant le champ Table hiérarchique puis l'état (grâce au bouton).
	Cas des fenêtres internes : il est nécessaire d'effectuer le test depuis la fenêtre accueillant la fenêtre interne.

- tester directement la page contenant le champ Table hiérarchique puis l'état (grâce au bouton).
	Cas des pages internes : il est nécessaire d'effectuer le test depuis la page accueillant la page interne.










<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Imprimer un état sur un champ Table hiérarchique
<a name="imprimer_etat_sur_champ_table_hierarchique_ELTTEXTE000395"></a>


### Imprimer un état sur un champ Table hiérarchique
<a name="imprimer_etat_sur_champ_table_hierarchique_ELTPARAGRAPHE000139"></a>L'impression d'un état sur un champ Table hiérarchique doit être réalisée uniquement à partir de la fenêtre (ou de la page) affichant le champ Table hiérarchique à imprimer. Il suffit de :

1. Créer un bouton dans la fenêtre (ou la page) contenant le champ Table hiérarchique.

2. Paramétrer la destination de l'impression de l'état :

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) En WINDEV, grâce à la fonction [iDestination](../WDLang5/3046074.md) (visualisateur de rapports, impression dans un fichier HTML, ...).

	- 
			Pour plus de détails, consultez [Modes d'impression d'un état](../WDChamp/1011031.md).


 Pour plus de détails, consultez [Modes d'impression d'un état](../WDChamp/1011031.md).

3. Préciser le nom de l'état à imprimer grâce à la fonction [iImprimeEtat](../WDLang5/3046032.md).




**Remarques** :

- Si des paramètres supplémentaires doivent être passés à l'état, ces paramètres doivent être indiqués dans la fonction [iImprimeEtat](../WDLang5/3046032.md), après le nom de l'état à imprimer. Pour plus de détails, consultez [Etat paramétré](../WDChamp/1011008.md).

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Si la fenêtre contenant le champ Table hiérarchique source de l'état est ouverte plusieurs fois (ouverture non modale par la fonction [OuvreFille](../WDLang1/3038021.md)), il faut passer en paramètre à l'état le nom complet du champ Table hiérarchique à imprimer. Par exemple : 
	
	```wl
	// Propriété NomComplet va contenir le nom de la fenêtre
	// qui doit être ouverte avec un alias afin de distinguer chaque fenêtre
	iImprimeEtat(ETAT_TableH_Client, TABLEH_Client.NomComplet)
	```

	```wl
	// Code d'ouverture de l'état : 
	PROCEDURE ETAT_TableH_Client(NomTableHSource)
	MonEtat.NomSource = NomTableHSource
	```


- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) La propriété [SélectionSeule](../Proprietes/2511017.md) permet de connaître et de modifier les enregistrements à imprimer dans l'état : impression de tous les enregistrements ou uniquement des enregistrements sélectionnés.

- La propriété [ConserverHiérarchieVisible](../Proprietes/1000021055.md) permet de connaître et de modifier le mode d'impression de la hiérarchie : impression de la hiérarchie complète ou impression de la hiérarchie visible dans le champ.


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ER.png)<br> | Important | Sous [le logiciel Etats & Requêtes](../Presentation/3088004.md), il est possible d'imprimer un état :<br><br>- soit en lançant une impression (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Imprimer.gif)<br>). <br><br>- soit en testant l'état (icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Go_Fenetre_WD_bl.gif)<br>). <br><br><br>Il n'est donc pas nécessaire de programmer l'impression de l'état. |








![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Exemple WINDEV
<a name="exemple_windev_ELTPARAGRAPHE000221"></a>L'ensemble des informations à imprimer est contenu dans le champ Table hiérarchique "TABLEH_TableClient" présent dans la fenêtre "FEN_Client".

L'état à imprimer est nommé "ETAT_TableH_Client" et s'imprime lors d'un clic sur le bouton "BTN_Imprimer".

Dans cet exemple, le code de clic du bouton "BTN_Imprimer" est le suivant : 


```wl
// Ouvrir le visualisateur de rapports
iDestination(iVisualisateur)
// Imprimer l'état basé sur le champ Table hiérarchique "TABLEH_TableClient" 
iImprimeEtat(ETAT_TableH_Client)
```

<a name="NOTE5_3"></a>






