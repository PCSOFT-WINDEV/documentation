


## Programmation de calculs personnalisés dans les champs Table
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000198"></a>
WINDEV permet d'insérer simplement des calculs automatiques dans les colonnes des champs Table et Table hiérarchique. 

A partir de la version 22, il est également possible de réaliser des calculs personnalisés dans les colonnes des champs Table et Table hiérarchique. Ces calculs sont réalisés par programmation. 

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000222"></a>


### Mise en place
<a name="mise_place_ELTPARAGRAPHE000024"></a>Pour mettre en place un calcul personnalisé dans une colonne d'un champ Table (ou Table hiérarchique), utilisez la fonction [TableFormuleAjoute](../WDLang1/1000022361.md).

Cette fonction attend en paramètres : 

- le nom de la colonne prise en compte pour le calcul. 

- le libellé de la ligne affichant le calcul dans le champ Table. Si ce libellé n'existe pas, la ligne sera créée. Si ce libellé existe, le calcul sera affiché dans la colonne voulue. 

- le nom de trois procédures. Ces procédures permettent : 

	- d'initialiser le calcul, 

	- de réaliser un calcul pour chaque ligne du champ Table, 

	- de réaliser le calcul final si nécessaire. 







Exemple : 

```wl
TableFormuleSupprimeTout(TABLE_MaTable)
nLigne est entier
nLigne = TableFormuleAjoute(TABLE_MaTable.COL_Num, "Moyenne positive", ProcInit, ProcAjout, ProcFin)
// Changement de la couleur de fond de la ligne du calcul personnalisé
COL_Num[nLigne].CouleurFond = RougeClair

nCompteur est entier
PROCEDURE INTERNE ProcInit() 
	nCompteur = 0
	RENVOYER 0
FIN

PROCEDURE INTERNE ProcAjout(Accumulateur, ValeurCol) 
	// Ignore les négatifs ou NULL
	SI (ValeurCol <= 0) RENVOYER Accumulateur
	nCompteur++
	RENVOYER Accumulateur + ValeurCol
FIN
PROCEDURE INTERNE ProcFin(Accumulateur) 
	SI nCompteur = 0 ALORS RENVOYER 0
	// Calcul de la moyenne
	RENVOYER  Accumulateur/nCompteur
FIN
```


Remarques : 

- Les lignes de calculs personnalisés sont automatiquement recalculées dès que le contenu du champ Table (ou Table hiérarchique) change.
	Conseil : La procédure d'itération est appelée pour chaque ligne : il est recommandé de ne pas faire de calculs trop lents (par exemple, éviter les accès à la base de données).

- La propriété [TotauxActif](../Proprietes/2510122.md) permet d'interdire ou de forcer les calculs de colonnes (automatiques ou personnalisés) effectués dans un champ Table. 

- Si la propriété [AffichageActif](../Proprietes/2510015.md) est utilisée sur le champ Table et correspond à <u><u><u><u>Faux</u></u></u></u>, les calculs de colonnes ne sont pas mis à jour. 

- Pour récupérer la valeur du calcul personnalisé d'une colonne, il suffit d'utiliser la syntaxe suivante : 
	
	```txt
	<Champ Table>.<Nom de la colonne>[Numéro ligne]
	```
où &lt;Numéro ligne&gt; correspond à l'indice de ligne renvoyé par la fonction [TableFormuleAjoute](../WDLang1/1000022361.md). 





### Position de la ligne de calculs
<a name="position_ligne_calculs_ELTPARAGRAPHE000072"></a>Pour configurer la position des calculs de colonnes (automatiques ou personnalisés) :

1. Affichez l'onglet "Général" du champ Table (pour cela, sélectionnez le nom du champ Table et cliquez sur l'onglet "Général").

2. Indiquez la position des totaux. Pour afficher le ou les résultats :

	- dans une ou plusieurs lignes ajoutées directement après la dernière ligne du champ, cochez l'option "Dans la table, après la dernière ligne".
			Ces lignes sont visibles uniquement :

		- au bas du champ Table, si le champ ne possède pas d'ascenseur vertical.

		- quand l'ascenseur vertical est tout en bas, si le champ Table possède un ascenseur vertical.




- sous le champ Table, cochez l'option "Sous la table".
			Ces lignes sont toujours visibles.

- il est également possible de réaliser des calculs de colonnes sans les afficher (option "Sans affichage").

3. Validez la fenêtre de description du champ Table.





### Personnalisation de la ligne de calculs
<a name="personnalisation_ligne_calculs_ELTPARAGRAPHE000094"></a>Il est possible de personnaliser (libellé, couleur, police, hauteur, ...) : 

- la ligne ajoutée en utilisant la syntaxe suivante : 
	
	```txt
	<Champ Table>[Numéro ligne].<Propriété> = <Nouvelle valeur>
	```


- la cellule contenant le résultat en utilisant la syntaxe suivante : 
	
	```txt
	<Champ Table>.<Nom de la colonne>[Numéro ligne].<Propriété> = <Nouvelle valeur>
	```

	Attention : la première colonne contient le libellé du calcul s'il existe. 


où : 

- &lt;Numéro ligne&gt; correspond à l'indice de ligne renvoyé par la fonction [TableFormuleAjoute](../WDLang1/1000022361.md). 

- &lt;Propriété&gt; peut correspondre à une des propriétés suivantes : 
	


|   |   |
| --- | --- |
| [Couleur](../Proprietes/2510071.md) | Permet de connaître et de modifier la couleur du texte affiché dans une cellule de calcul. |
| [CouleurFond](../Proprietes/2510022.md) | Permet de connaître et de modifier la couleur de fond d'une cellule de calcul. |
| [Etat](../Proprietes/2510039.md) | Permet de connaître et de modifier l'état d'affichage de la ligne contenant la cellule de calcul. |
| [Hauteur](../Proprietes/2510050.md) | Permet de connaître et de modifier la hauteur d'une cellule de calcul. |
| [Largeur](../Proprietes/2510059.md) | Permet de connaître et de modifier la largeur d'une cellule de calcul. |
| [Libellé](../Proprietes/2510053.md) | Permet de connaître et de modifier le libellé de la ligne contenant une cellule de calcul. |
| [Nom](../Proprietes/2510082.md) | Permet de connaître le nom d'une cellule de calcul. |
| [Note](../Proprietes/2510085.md) | Permet de connaître et de modifier les notes associées à une cellule de calcul. |
| [Police](../Motscles/1514045.md) | Permet de connaître et de modifier la police utilisée dans une cellule de calcul. |
| [PoliceBarrée](../Proprietes/2510091.md) | Permet de connaître et de modifier l'attribut "Barré" pour une cellule de calcul. |
| [PoliceCondensée](../Proprietes/2510096.md) | Permet de savoir si les caractères des éléments de la colonne sont condensés ou non, et de condenser ou non les caractères des éléments de la colonne. |
| [PoliceEtendue](../Proprietes/2510104.md) | Permet de savoir si les caractères des éléments de la colonne sont étendus ou non et d'étendre ou non les caractères des éléments de la colonne. |
| [PoliceGras](../Proprietes/2510103.md) | Permet de connaître et de modifier l'attribut "Gras" pour les éléments de la colonne. |
| [PoliceItalique](../Proprietes/2510102.md) | Permet de connaître et de modifier l'attribut "Italique" pour les éléments de la colonne. |
| [PoliceLarge](../Proprietes/2510101.md) | Permet de savoir si les caractères des éléments de la colonne sont élargis ou non, et d'élargir ou non les caractères des éléments de la colonne. |
| [PoliceNom](../Proprietes/2510100.md) | Permet de connaître et de modifier la police utilisée pour les éléments de la colonne. |
| [PoliceSoulignée](../Proprietes/2510099.md) | Permet de connaître et de modifier l'attribut "Souligné" pour les éléments de la colonne. |
| [PoliceTaille](../Proprietes/2510072.md) | Permet de connaître et de modifier la taille de la police utilisée pour les éléments de la colonne. |
| [Visible](../Proprietes/2510138.md) | Permet de savoir si une colonne est visible et de rendre visible / invisible une colonne. |







### Suppression des lignes de calcul personnalisé
<a name="suppression_des_lignes_calcul_personnalise_ELTPARAGRAPHE000120"></a>Pour supprimer les lignes de calcul personnalisé, utilisez la fonction [TableFormuleSupprimeTout](../WDLang1/1000022362.md). 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Exporter les résultats des calculs
<a name="exporter_les_resultats_des_calculs_ELTTEXTE000367"></a>


### Export via les FAA (Fonctionnalités Automatiques de vos Applications) du champ Table
<a name="export_via_les_faa_fonctionnalites_automatiques_vos_applications_champ_table_ELTPARAGRAPHE000134"></a>Le menu contextuel des champs Table et Table hiérarchique propose par défaut des options permettant d'exporter le contenu du champ. 

Lors de cet export, les résultats des calculs personnalisés sont exportés. 

**Remarque** : Seule la valeur est exportée, pas le libellé. 


### Export via les fonctions WLangage
<a name="export_via_les_fonctions_wlangage_ELTPARAGRAPHE000145"></a>Diverses fonctions WLangage permettent d'exporter le contenu d'un champ Table dans un format spécifique (Word, Excel, XML, ...). Lors de cet export, par défaut les lignes correspondant à un calcul sont également exportées.

Pour ne pas exporter les lignes de calculs, il suffit de spécifier la constante *taSansTotaux* dans les fonctions suivantes :



|   |   |
| --- | --- |
| [TableVersExcel](../WDLang1/3074033.md) | Crée un fichier Excel avec les données d'un champ Table ou Table hiérarchique. |
| [TableVersPressePapier](../WDLang1/1000017062.md) | Copie le contenu d'un champ Table ou Table hiérarchique dans le presse-papiers. |
| [TableVersTexte](../WDLang1/1000017061.md) | Crée une chaîne de caractères avec les données d'un champ Table ou Table hiérarchique. |
| [TableVersWord](../WDLang1/3074036.md) | Crée un fichier Word (.RTF) avec les données d'un champ Table ou Table hiérarchique. |
| [TableVersXML](../WDLang1/3074037.md) | Crée un fichier XML avec les données d'un champ Table ou Table hiérarchique. |






