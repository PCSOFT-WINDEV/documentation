


## Exemple de gestion des vidéos (retransmises par un champ Caméra)
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000213"></a>
Dans cet exemple, l'application étudiée permet de :

- visualiser la séquence vidéo actuellement retransmise par la caméra installée sur le poste en cours.

- modifier la configuration du driver de capture vidéo.

- sauvegarder la séquence vidéo actuellement retransmise par la caméra spécifiée sous forme d'une image (fichier BMP) ou d'une séquence vidéo (fichier AVI).




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Exemple d'utilisation
<a name="exemple_utilisation_ELTTEXTE000237"></a>
Pour réaliser cette application :

1. Créez une fenêtre vierge : 

	- Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif)
 parmi les boutons d'accès rapide. 

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Fenêtre" puis sur "Fenêtre". 

	- Dans l'assistant, sélectionnez "Vierge". 




2. Dans cette nouvelle fenêtre :

	- Créez un champ Caméra nommé "CAM_Caméra" : sous le volet "Création", dans le groupe "Champs graphiques", déroulez "Vidéo et capture" et cliquez sur "Caméra".
			Remarque : Par défaut, la caméra associée à ce champ correspondra à la caméra par défaut du poste en cours.

	- Créez un champ Bouton nommé "BTN_Filmer" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur "Bouton".
			Ce champ Bouton permettra d'afficher la séquence vidéo dans le champ Caméra.

	- Créez un champ Bouton nommé "BTN_Configuration" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur "Bouton".
			Ce champ Bouton permettra de modifier la configuration du driver de capture vidéo.

	- Créez un champ Bouton nommé "BTN_Image" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur "Bouton".
			Ce champ Bouton permettra de sauvegarder la séquence vidéo actuellement retransmise sous forme d'une image (fichier BMP).

	- Créez un champ Bouton nommé "BTN_Vidéo" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur "Bouton".
			Ce champ Bouton permettra de sauvegarder la séquence vidéo actuellement retransmise sous forme d'une séquence vidéo (fichier AVI).

	- Créez un champ Bouton nommé "BTN_Arrêter" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur "Bouton".
			Ce champ Bouton permettra d'arrêter l'affichage et/ou la sauvegarde de la séquence vidéo dans le champ Caméra.




3. Dans l'événement "Clic" du champ Bouton "BTN_Filmer", saisissez les lignes de code suivantes :
	
	```wl
	// Affiche la séquence vidéo actuellement retransmise dans le champ "CAM_Caméra"
	ResAffiche est un booléen
	ResAffiche = VidéoAffiche(CAM_Caméra)
	// Affiche une erreur en cas de problème
	SI ResAffiche = Faux ALORS Erreur(ErreurInfo())
	```


4. Dans l'événement "Clic" du champ Bouton "BTN_Configuration", saisissez les lignes de code suivantes :
	
	```wl
	// Affiche la boîte de dialogue standard permettant 
	// la configuration du driver de capture vidéo utilisé pour le champ "CAM_Caméra"
	VidéoConfigure(CAM_Caméra)
	```


5. Dans l'événement "Clic" du champ Bouton "BTN_Image", saisissez les lignes de code suivantes : 
	
	```wl
	// Sauvegarde de l'image actuellement retransmise dans le champ "CAM_Caméra"
	ResSauvImg est un booléen
	ResSauvImg = VidéoCapture(CAM_Caméra, "Temp.bmp", viCaptureImage)
	SI ResSauvImg = Faux ALORS 
		Erreur(ErreurInfo())
	FIN
	
	// Sélection du fichier à créer
	FichierImage est une chaîne 
	FichierImage = fSélecteur(fRepExe(), "Image", ...
		"Enregistrer sous...", "BMP" + TAB + "*.BMP", "bmp", fselCrée + fselExiste)
	
	// Renomme le fichier BMP créé
	SI FichierImage ~= "" ALORS
		// Suppression du fichier temporaire
		fSupprime("Temp.BMP")
	SINON
		// Renomme et déplace le fichier généré
		fRenomme("Temp.BMP", FichierImage)
	FIN
	```


6. Dans l'événement "Clic" du champ Bouton "BTN_Vidéo", saisissez les lignes de code suivantes :
	
	```wl
	// Sauvegarde de la séquence vidéo actuellement retransmise 
	// dans le champ "CAM_Caméra" sous forme d'une AVI de 3 minutes
	ResSauvVidéo est un booléen
	ResSauvVidéo = VidéoCapture(CAM_Caméra, "Temp.avi", viCaptureVidéo, 180)
	SI ResSauvVidéo = Faux ALORS 
		Erreur(ErreurInfo())
	FIN
	
	// Sélection du fichier à créer
	FichierVidéo est une chaîne = fSélecteur(fRepExe(), "Vidéo", ...
		"Enregistrer sous...", "AVI" + TAB + "*.avi", "avi", fselCrée + fselExiste)
	
	// Renomme le fichier AVI créé
	SI FichierVidéo ~= "" ALORS
		// Suppression du fichier temporaire
		fSupprime("Temp.avi")
	SINON
		// Renomme et déplace le fichier généré
		fRenomme("Temp.avi", FichierImage)
	FIN
	```


7. Dans l'événement "Clic" du champ Bouton "BTN_Arrêter", saisissez les lignes de code suivantes :
	
	```wl
	// Affiche l'affichage ou la sauvegarde de la séquence vidéo
	ResArrête est un booléen 
	ResArrête = VidéoArrête(CAM_Caméra)
	// Affiche une erreur en cas de problème
	SI ResArrête = Faux ALORS Erreur(ErreurInfo())
	```






