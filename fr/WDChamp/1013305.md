
## Rupture dans un champ Table
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000364"></a>
Une rupture dans un champ Table permet d'effectuer un regroupement de lignes selon un ou plusieurs critères. 

Par exemple, il est possible de regrouper :

- les clients par pays et par ville,

- les produits selon leur famille, ...




![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) La mise en place d'un total sur une rupture permet d'effectuer automatiquement un calcul (somme, comptage, moyenne) pour toutes les lignes d'une rupture donnée. Par exemple, un total sur une rupture permet de calculer le chiffre d'affaires généré par client. 

Les ruptures dans un champ Table sont disponibles pour :

- les champs Table fichier chargés en mémoire,

- les champs Table par programmation.




![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Remarques : 

- En exécution, l'utilisateur peut à tout moment mémoriser l'état des ruptures en cours dans le champ Table (ruptures repliées, dépliées, ...). Pour plus de détails, consultez [Mémoriser les ruptures dans les champs Table/Zone répétée (FAA)](../WDChamp/9500138.md). 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) En exécution, un double-clic sur une rupture permet d'enrouler ou de dérouler cette rupture.

- Il est possible de gérer les [ruptures dans un champ Table par programmation](#NOTE8_1). 








<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000388"></a>


### Ajouter une rupture dans un champ Table
<a name="ajouter_une_rupture_dans_champ_table_ELTPARAGRAPHE000072"></a>Pour ajouter une rupture dans un champ Table : 

1. Affichez la description du champ Table (option "Description" du menu contextuel).

2. Dans l'onglet "Contenu", cliquez sur le bouton ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_rupture_table.gif)
. La fenêtre de gestion des ruptures apparaît.
	**Remarque** : Les ruptures ne sont pas disponibles sur les champs Table fichier à accès direct.

3. Sélectionnez la rubrique sur laquelle la rupture doit être effectuée. Il est possible de sélectionner plusieurs rubriques pour effectuer plusieurs ruptures. Les rubriques proposées diffèrent en fonction du type du champ Table :

	- **Champ Table fichier chargé en mémoire** :

		- *parcours automatique* : la rubrique de parcours, la colonne liée à la rubrique de parcours et les colonnes liées à aucune rubrique sont proposées. Si la rubrique de parcours correspond à une clé composée, les composantes de cette clé composée, les colonnes liées à ces composantes et les colonnes liées à aucune rubrique sont proposées.

		- *parcours programmé* : les rubriques du fichier de données et les colonnes liées à ces rubriques sont proposées.




- **Champ Table fichier lié à une requête** :

	- *parcours automatique* : la rubrique de parcours, les colonnes liées à cette rubrique de parcours et les colonnes liées à aucune rubrique sont proposés. Si la rubrique de parcours n'est pas spécifié (option "&lt;Automatique&gt;"), les rubriques triées de la requête, les colonnes liées à ces rubriques et les colonnes liées à aucune rubrique sont proposées.

	- *parcours programmé* : les rubriques de la requête, les colonnes liées à ces rubriques et les colonnes liées à aucune rubrique sont proposées.

4. Les ruptures sont réalisées selon leur ordre d'affichage. Modifiez si nécessaire cet ordre à l'aide des boutons fléchés à droite du tableau.

5. Validez.





<a name="NOTE2_2"></a>


### Haut et bas de rupture
<a name="haut_bas_rupture_ELTPARAGRAPHE000100"></a>Lors de l'ajout d'une nouvelle rupture, un haut et un bas de rupture sont automatiquement ajoutés au champ Table. Si le champ Table possède plusieurs ruptures, il y a autant de hauts et de bas de ruptures que de ruptures.

**Les hauts et bas de rupture apparaissent en édition dans le champ Table**. 

Pour modifier les caractéristiques de ces hauts et bas de rupture (nom, visibilité, couleur de fond, ...), il suffit d'afficher leur fenêtre de description (option "Description" du menu contextuel).

Chaque haut et bas de rupture est associé à l'événement "Affichage d'une ligne". Cet événement est exécuté lorsqu'un nouveau haut ou bas de rupture est affiché dans le champ Table.

Ces hauts et bas de rupture peuvent contenir des champs. Ces champs sont manipulables par programmation. Des événements WLangage sont associés aux hauts de rupture. 

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Les sommes, moyennes et comptages sont automatiques dans les ruptures du champ Table. Les champs des hauts et bas de ruptures peuvent afficher ces calculs. Pour plus de détails, consultez [Calculs automatiques dans les ruptures de table](#NOTE4_1).

**Remarques** : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Dans la description du champ Table (onglet "Contenu"), il est possible de paramétrer si les ruptures doivent afficher ou non un bouton permettant d'enrouler/dérouler la rupture (option "Ruptures avec enroulé/déroulé").

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Dans la description du champ Table, il est possible de paramétrer l'image utilisée pour dessiner les boutons "+" et "-" dans les ruptures des tables. Il faut pour cela sélectionner l'élément "Rupture, cadre en création" dans l'onglet "Style" de la table puis cliquer sur le bouton "Image Plus/Moins des ruptures".

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Un haut de rupture peut être toujours visible. Dans ce cas, lors du défilement, le bandeau de la rupture ne sera pas déplacé. Pour rendre un haut de rupture toujours visible : 

	- Sélectionnez le haut de rupture et affichez sa description (option "Description" du menu contextuel). 

	- Dans l'onglet "UI", cochez l'option "Haut de rupture toujours visible". 






<a name="NOTE2_3"></a>


### Comment remplir un champ Table avec ruptures ?
<a name="comment_remplir_champ_table_avec_ruptures_ELTPARAGRAPHE000148"></a>***Dans le cas des champs Table fichier***, l'ajout des enregistrements est automatiquement en fonction du fichier ou de la requête associée. Le tri est réalisé selon la rubrique de parcours.

***Dans le cas des champs Table par programmation***, les ajouts de données sont réalisés avec la fonction [TableAjouteLigne](../WDLang1/3074006.md). Pour obtenir un champ Table trié selon les ruptures définies, il est nécessaire d'utiliser la fonction [TableTrie](../WDLang1/3074035.md).

**Exemple : Champ Table par programmation** : Une rupture a été définie sur les colonnes Pays et Ville :


```wl
// Remplissage du champ Table
TableAjouteLigne(TABLE_Ruptures, "FRANCE", "Montpellier", "TEXTE1", "Texte1")
TableAjouteLigne(TABLE_Ruptures, "FRANCE", "Paris", "TEXTE2", "Texte2")
TableAjouteLigne(TABLE_Ruptures, "FRANCE", "Montpellier", "TEXTE3", "Texte3")
TableAjouteLigne(TABLE_Ruptures, "FRANCE", "Lille", "TEXTE4", "Texte4")

TableAjouteLigne(TABLE_Ruptures, "ESPAGNE", "Madrid", "TEXTE1", "Texte1")
TableAjouteLigne(TABLE_Ruptures, "ESPAGNE", "Barcelone", "TEXTE3", "Texte3")
TableAjouteLigne(TABLE_Ruptures, "ESPAGNE", "Barcelone", "TEXTE4", "Texte4")

TableAjouteLigne(TABLE_Ruptures, "ALGERIE", "Alger", "TEXTE5", "Texte5")
TableAjouteLigne(TABLE_Ruptures, "ALGERIE", "Oran", "TEXTE6", "Texte6")
TableAjouteLigne(TABLE_Ruptures, "ALGERIE", "Alger", "TEXTE7", "Texte7")
TableAjouteLigne(TABLE_Ruptures, "ALGERIE", "Chlef", "TEXTE8", "Texte8")
TableAjouteLigne(TABLE_Ruptures, "ALGERIE", "Alger", "TEXTE9", "Texte9")

TableAjouteLigne(TABLE_Ruptures, "ESPAGNE", "Madrid", "TEXTE2", "Texte2")

// Tri du contenu du champ Table selon les ruptures
TableTrie(TABLE_Ruptures, TABLE_Ruptures.Pays.Nom, TABLE_Ruptures.Ville.Nom)
```




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Manipulation des champs présents dans les hauts et les bas de ruptures
<a name="manipulation_des_champs_presents_dans_les_hauts_les_bas_ruptures_ELTTEXTE000424"></a>


### Comment le faire ? 
<a name="comment_faire_ELTPARAGRAPHE000170"></a>Pour manipuler les champs présents dans les hauts et les bas de ruptures

- soit manipulez chaque champ de tous les hauts / bas de rupture : 
	
	```txt
	<Nom Champ>.<Nom Propriété> = <Valeur>
		ou
	<Nom Table>.<Nom Haut/Bas de rupture>.<Nom Champ>.<Nom Propriété> = <Valeur>
	```


- soit manipulez chaque champ d'une rupture donnée :
	
	```txt
	<Nom Table>[<Indice>].<Nom Champ>.<Nom Propriété> = <Valeur>
	```

	&lt;Indice&gt; correspond au numéro de la ligne de la rupture.




Remarques : 

- Ces lignes de code doivent être présentes dans l'événement "Affichage d'une ligne" du haut / bas de rupture.

- Cas particulier : champ Interrupteur : un champ Interrupteur possédant plusieurs options et placé dans les hauts et les bas de ruptures ne peut pas être affecté par programmation. Si plusieurs cases à cocher sont nécessaires dans les hauts et les bas de ruptures, il est conseillé d'utiliser un champ Interrupteur par coche.



<a name="NOTE3_2"></a>


### Exemple
<a name="exemple_ELTPARAGRAPHE000191"></a>Ce code permet d'afficher dans le champ "LIB_Pays", le nom du pays affiché dans la colonne Pays. Ce code est saisi dans le code d'affichage d'une ligne de HautRupture :


```wl
// Code d'affichage de la rupture
// Récupère l'indice de la rupture (ici RUPT_HautDeRupture) 
IndiceRupture est un entier = TableIndiceRupture(RUPT_HautDeRupture)

// Fixe la valeur du libellé contenu dans la rupture
TABLE_CLIENTS[IndiceRupture].LIB_PAYS = "Pays : " + TABLE_Articles.COL_NomPays
```




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Calculs automatiques dans les ruptures d'un champ Table
<a name="calculs_automatiques_dans_les_ruptures_champ_table_ELTTEXTE000454"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 
Il est possible d'ajouter des calculs automatiques (somme, comptage et moyenne) dans les hauts et bas de rupture.

Pour mettre en place les calculs automatiques :

1. Insérez un champ Libellé ou un champ de saisie dans le haut/bas de rupture. Ce champ va contenir le calcul automatique. 

2. Affichez la fenêtre de description du champ (option "Description" du menu contextuel).

3. Dans l'onglet "UI", dans la zone "Dans une rupture, afficher", cliquez sur le lien "Aucun calcul" ou sur la description du calcul (si un calcul automatique a déjà été défini). La fenêtre de description d'un calcul automatique s'affiche.

4. Sélectionnez le calcul à effectuer. Vous pouvez choisir :

	- "La somme de" : le champ affichera la somme par rupture.

	- "La moyenne de": le champ affichera la moyenne sur la rupture.

	- "Le nombre (comptage) de" : le champ comptera le nombre d'éléments par rupture.




5. Sélectionnez l'élément sur lequel le calcul doit être effectué. Il est possible d'effectuer le calcul sur une colonne du champ Table.

6. Validez les différentes fenêtres. 




Astuces :

- Selon le type d'information calculé, pensez à modifier le masque de saisie du champ qui affiche le calcul.

- N'hésitez pas à utiliser la technologie des "eye magnet" sur les champs de saisie affichant des calculs dans les ruptures. Il sera ainsi possible de mettre en évidence un calcul (par exemple affichage d'un CA insuffisant en rouge).








<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Manipulation des hauts et bas de rupture
<a name="manipulation_des_hauts_bas_rupture_ELTTEXTE000478"></a>


### Pour initialiser les hauts/bas de ruptures
<a name="pour_initialiser_les_hautsbas_ruptures_ELTPARAGRAPHE000233"></a>Il est possible de manipuler tous les hauts/bas de rupture :


```txt
<Nom Haut/Bas de rupture>.<Nom Propriété> = <Valeur>
```


**Remarque** : Ces lignes de code doivent être présentes dans l'événement "Affichage d'une ligne" du haut/bas de rupture.

**Exemple** : Code permettant de modifier la hauteur des hauts de rupture :


```wl
HautRupture1.Hauteur += 10
```



<a name="NOTE6_2"></a>


### Propriétés associées aux hauts / bas de ruptures
<a name="proprietes_associees_aux_hauts_bas_ruptures_ELTPARAGRAPHE000249"></a>Les propriétés associées aux hauts / bas de ruptures sont les suivantes :


|   |   |
| --- | --- |
| [Enroulé](../Proprietes/2513014.md) | Permet de connaître et de modifier l'état "enroulé" d'une rupture. |
| [Hauteur](../Proprietes/2510050.md) | Permet de connaître et de modifier la hauteur d'un haut ou d'un bas de rupture. |
| [Nom](../Proprietes/2510082.md) | Renvoie le nom d'un haut/bas de rupture. |
| [Type](../Proprietes/2510131.md) | Renvoie le type d'un élément. |
| [Visible](../Proprietes/2510138.md) | Permet de savoir si un haut/bas de rupture est visible, et de rendre un haut/bas de rupture visible. |


Pour connaître la liste complète des propriétés disponibles, consultez [Propriétés disponibles sur les ruptures (Table)](../WDChamp/9500144.md). 

<a name="NOTE7"></a>
<a name="NOTE7_1"></a>


## Fonctions WLangage spécifiques aux champs Table avec ruptures
<a name="fonctions_wlangage_specifiques_aux_champs_table_avec_ruptures_ELTTEXTE000508"></a>
Les fonctions suivantes peuvent être utilisées pour manipuler les ruptures dans les champs Table :



|   |   |
| --- | --- |
| [TableDéroule](../WDLang1/1000010007.md) | Déroule :<br><br>- une branche d'un champ Table hiérarchique précédemment enroulée. <br><br>- une rupture d'un champ Table précédemment enroulée. <br><br>- une fenêtre de détail affichée pour une ligne.<br><br><br> |
| [TableDérouleTout](../WDLang1/1000010001.md) | Déroule :<br><br>- toute la hiérarchie (tous les noeuds) d'un champ Table hiérarchique.<br><br>- toutes les ruptures d'un champ Table. <br><br><br> |
| [TableEnroule](../WDLang1/1000010008.md) | Enroule :<br><br>- une branche d'un champ Table hiérarchique précédemment déroulée. <br><br>- une rupture d'un champ Table précédemment déroulée. <br><br>- une fenêtre de détail affichée pour une ligne.<br><br><br> |
| [TableEnrouleTout](../WDLang1/1000010003.md) | Enroule :<br><br>- toute la hiérarchie (tous les noeuds) d'un champ Table hiérarchique.<br><br>- toutes les ruptures d'un champ Table. <br><br><br> |
| [TableIndiceRupture](../WDLang1/1000018758.md) | Renvoie l'indice du haut et du bas de rupture d'une rupture donnée dans un champ Table. |





<a name="NOTE8"></a>
<a name="NOTE8_1"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

## Gestion des ruptures dans les champs Table par programmation
<a name="gestion_des_ruptures_dans_les_champs_table_par_programmation_ELTTEXTE000583"></a>
Les ruptures dans les tables peuvent être créées et manipulées par programmation grâce aux fonctions suivantes : 



|   |   |
| --- | --- |
| [RuptureAjoute](../WDLang1/1000022737.md) | Ajoute une rupture dans un champ Table ou dans un champ Zone Répétée. |
| [RuptureSupprime](../WDLang1/1000022738.md) | Supprime une rupture dans un champ Table ou dans un champ Zone répétée. |
| [RuptureSupprimeTout](../WDLang1/1000022739.md) | Supprime toutes les ruptures présentes dans un champ Table ou un champ Zone répétée. |





L'ajout d'une rupture dans une table est réalisé grâce à la fonction [RuptureAjoute](../WDLang1/1000022737.md). La rupture créé correspond à une variable de type [Champ](../WDLang1/1000020967.md) qui peut ensuite être manipulé avec les mêmes propriétés WLangage qu'une rupture créée sous l'éditeur. 

Exemple : 

```wl
// Ajout d'une rupture verte sur la date dans un champ Table
x est un Champ
x <- RuptureAjoute(TABLE_Commande.COL_DATE, "RuptDate", ruptHaut, 50) 
x.CouleurFond = VertFoncé // Colorie en vert la rupture
```







- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LechampTableavecrupture.gif) ***Exemples unitaires (WINDEV)*** : **Le champ Table avec rupture** <br>Utilisation du champ Table avec rupture.


