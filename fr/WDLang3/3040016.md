


## FTPConnecte (Fonction)

***En anglais : FTPConnect***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Connecte le poste en cours à un serveur FTP (File Transfer Protocol).

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png) Les modes de connexion sécurisés disponibles sont les suivants : 

- FTPS : FTP sécurisé selon le protocole SSL avec chiffrement implicite. 

- FTPES : FTP sécurisé selon le protocole SSL avec chiffrement explicite. 

- SFTP : FTP sécurisé par un tunnel SSH.



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003040016&name=ftpconnecte_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
// Connexion du poste en cours au serveur FTP
ResConnecte = FTPConnecte("192.54.12.8")
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = FTPConnecte(<Serveur> [, <Nom de l'utilisateur> [, <Mot de passe> [, <Numéro de port> [, <Type de connexion> [, <Délai de connexion> [, <Clé privée> [, <Mot de passe de la clé>]]]]]]])`
---

**`<Résultat> : (Entier)`**



- Identifiant de la connexion, 

- 0 lors de la première connexion.

- -1 en cas d'erreur. Le compte-rendu détaillé de l'erreur est connu grâce à la fonction [ErreurInfo](../WDLang1/3013008.md) utilisée avec la constante *errCode* ou *errMessage*. 
	En cas d'erreur d'identification, la fonction [ErreurInfo](../WDLang1/3013008.md) utilisée avec la constante *errCode* renvoie la constante *ftpErreurIdentification*.






**`<Serveur> : (Chaîne de caractères)`**

Nom du serveur FTP (par exemple "ftp.cdrom.com") ou adresse IP du serveur FTP (par exemple "192.54.12.8").

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png) Ce paramètre permet de définir le protocole utilisé : 

- si le nom du serveur commence par "ftp://", la connexion est en mode non sécurisé. 

- si le nom du serveur commence par "ftps://", la connexion est en mode sécurisé selon le protocole FTPS (FTP sécurisé par SSL avec chiffrement implicite). 

- si le nom du serveur commence par "ftpes://", la connexion est en mode sécurisé selon le protocole FTPES (FTP sécurisé par SSL avec chiffrement explicite). 

- si le nom du serveur commence par "sftp://", la connexion est en mode sécurisé par un tunnel SSH selon le protocole SFTP. 




**`<Nom de l'utilisateur> : (Chaîne de caractères optionnelle)`**



- Nom de l'utilisateur qui tente d'effectuer une connexion nominative (identification de l'utilisateur sur le serveur FTP). Ce paramètre est donné par le responsable du site FTP.

- Chaîne vide ("") pour effectuer une connexion anonyme.




**`<Mot de passe> : (Chaîne de caractères optionnelle)`**

Mot de passe de l'utilisateur : permet d'identifier l'utilisateur sur le serveur FTP. Ce paramètre est donné par le responsable du site FTP.

Ce mot de passe correspond :

- au &lt;Mot de passe&gt; spécifié si ce paramètre est différent d'une chaîne vide (""),

- à l'adresse email de l'utilisateur si le paramètre &lt;Nom de l'utilisateur&gt; n'est pas spécifié ou est égal à une chaîne vide (""),

- à une chaîne vide ("") si ce paramètre n'est pas spécifié et si le paramètre &lt;Nom de l'utilisateur&gt; est différent d'une chaîne vide ("").


Remarque : Si le mot de passe contient des caractères spéciaux, il peut être nécessaire de le convertir en UTF8 en utilisant la fonction [ChaîneVersUTF8](../WDLang1/3024042.md).

**`<Numéro de port> : (Entier optionnel)`**

Numéro de port sur lequel le serveur doit être lancé. Ce paramètre est donné par le responsable du site FTP.

Par défaut : 

- pour une connexion non sécurisée, ce port est le port 21.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png) pour une connexion sécurisée en mode FTPS, ce port est le port 990. 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png) pour une connexion sécurisée en mode FTPES, ce port est le port 21.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png) pour une connexion sécurisée en mode SFTP, ce port est le port 22.




**`<Type de connexion> : (Constante optionnelle de type Entier)`**

Type de connexion à effectuer : 



|   |   |
| --- | --- |
| *ftpModeActif* (ou <u><u><u><u>Faux</u></u></u></u> par compatibilité) | **Connexion active** au serveur FTP. <br><br>Lors d'un transfert de fichiers, c'est le client qui prend l'initiative du transfert. Ce type de connexion peut être refusé par certains serveurs FTP protégés. |
| *ftpModePassif* (ou <u><u><u><u>Vrai</u></u></u></u> par compatibilité)<br>(Valeur par défaut) | **Connexion passive** au serveur FTP (mode PASV). <br><br>Lors d'un transfert de fichiers, c'est le serveur qui prend l'initiative du transfert. Ce type de connexion permet de franchir certains "firewalls".<br><br>Remarque : Si la connexion au serveur est en IPV6, alors la connexion se fera en mode passif étendu (car le mode passif ne supporte pas IPV6). |
| *ftpModePassifEtendu* | **Connexion passive étendue** au serveur FTP (mode EPSV). <br><br>Lors d'un transfert de fichiers, c'est le serveur qui prend l'initiative du transfert. Ce type de connexion permet de franchir certains "firewalls". <br><br>Si le serveur ne supporte pas le mode passif étendu (la commande FEAT est envoyée au serveur pour connaître la capacité), la connexion est dégradée en mode passif simple. <br><br>Limitations : <br><br>- Ce mode n'est pas supporté lors de l'utilisation du module "wininet" de Windows (voir fonction [FTPParamètre](../WDLang3/1000020947.md)) : la connexion est réalisée en mode *ftpModePassif*. <br><br>- ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Constante non disponible.<br><br><br><br><br> |
| *ftpModePassifIgnoreIP* | **Connexion passive** au serveur FTP (mode PASV). <br><br>Lors d'un transfert de fichiers en mode passif le serveur donne le port et l'adresse IP pour le transfert des données. Avec ce paramètre, seul le port est pris en compte, l'adresse IP est ignorée.<br>Ce type de connexion permet d'utiliser des serveurs FTP qui retournent des adresses IP non routables mais qui sont joignables par l'adresse IP de connexion<br><br>Limitations : <br><br>- Ce mode n'est pas supporté lors de l'utilisation du module "wininet" de Windows (voir fonction [FTPParamètre](../WDLang3/1000020947.md)) : la connexion est réalisée en mode *ftpModePassif*. <br><br><br> |



**`<Délai de connexion> : (Entier optionnel ou Durée optionnelle)`**

Nombre de secondes au bout desquelles la requête de connexion au serveur FTP est abandonnée (par défaut 20). Ce délai s'applique à toutes les opérations FTP réalisées sur cette connexion. Si aucune réponse du serveur n'est obtenue dans le &lt;Délai de connexion&gt; spécifié, la fonction **FTPConnecte** retourne -1.
Remarque : Ce paramètre peut correspondre à : 

- un entier correspondant au nombre de secondes, 

- une variable de type Durée, 

- l'indication directe de la durée (par exemple '1s'). 




**`<Clé privée> : (Chaîne de caractères optionnelle)`**

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png) Nom et chemin du fichier correspondant à la clé privée utilisée lors d'une connexion en mode SFTP. Ce fichier doit avoir été généré au format OpenSSH. 
Si ce paramètre n'est pas spécifié, la connexion sécurisée utilise une authentification par &lt;Nom de l'utilisateur&gt; / &lt;Mot de passe&gt;. 

**`<Mot de passe de la clé> : (Chaîne de caractères ANSI optionnelle)`**

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png) Mot de passe du fichier contenant la clé privé utilisée lors d'une connexion en mode SFTP.
Si l'utilisation des chaînes en exécution est en UNICODE (onglet "Unicode" de la [configuration courante](../Editeurs/9000030.md)), le mot de passe ne doit pas être donné entre guillemets. Il doit être contenu dans une variable de type chaîne déclarée en ANSI.
Si ce paramètre n'est pas spécifié, la connexion sécurisée utilise une authentification par &lt;Nom de l'utilisateur&gt; / &lt;Mot de passe&gt;. 



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png)![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png) 

### Erreur de sécurité dans une connexion sécurisée de type FTPS
<a name="erreur_securite_dans_une_connexion_securisee_type_ftps_ELTPARAGRAPHE000249"></a>Lors d'une connexion sécurisée, certaines erreurs de sécurité peuvent faire échouer la fonction :

- certificat invalide ou ne provenant pas d'une société connue.

- nom du site figurant dans le certificat ne correspondant pas à un serveur.

- date du certificat non-valide ou expiré.




Il est possible de se connecter en ignorant ces erreurs. Pour cela, il suffit d'utiliser la variable **FTP.IgnoreErreur** :

| Valeur de FTP.IgnoreErreur<br>(ces valeurs peuvent être combinées) | Description |
| --- | --- |
| *ftpIgnoreCertificatInvalide* | Le certificat est ignoré. |
| *ftpIgnoreCertificatExpiré* | La date du certificat est ignorée. |
| *ftpIgnoreNomCertificatInvalide* | Le nom du site figurant dans le certificat est ignoré. |
| *ftpIgnoreRévocation* | La révocation du certificat est ignorée. |


```wl
// Exemple de gestion des erreurs

xnum est un entier
FTP.IgnoreErreur = ftpIgnoreCertificatExpiré + ftpIgnoreCertificatInvalide + ...
	ftpIgnoreNomCertificatInvalide + ftpIgnoreRévocation
xnum = FTPConnecte("ftpes://Mon_Ip_Server", "Mon_User", "Mon_Password", 21, Vrai)
SI xnum =-1  ALORS
       Info(ErreurInfo(errMessage))
SINON
       Info("OK")
FIN
```

<a name="NOTE0_4"></a>


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionsFTP.gif) ***Exemples unitaires (WEBDEV)*** : **Les fonctions FTP** <br>Utilisation des principales fonctions FTP de WEBDEV pour :<br>- Se connecter à un serveur FTP<br>- Lister les fichiers et les répertoires présents sur le serveur FTP<br>- Récupérer des fichiers présents sur le serveur FTP<br>- Se déconnecter d'un serveur FTP
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDTransfertdefichiersparFTP.gif) ***Exemples complets (WINDEV)*** : **WD Transfert de fichiers par FTP** <br>WD Transfert de fichiers par FTP<br><br>Cet exemple est un client FTP complet vous permettant de mémoriser plusieurs serveurs FTP. Vous pouvez alors effectuer des transferts multi-fichiers du poste local vers le serveur ou du serveur FTP vers le poste local. On utilise pour cela les fonctions standards du WLangage (FTPConnecte, etc...)

<a name="XComposante"></a>

## Composante :
wd280com.dll
