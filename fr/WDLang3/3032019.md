


## EmailLitEntêtePrécédent (Fonction)

***En anglais : EmailReadPreviousHeader***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Lit l'entête de l'email précédant l'email en cours :

- soit par le protocole POP3 ou IMAP : l'email est présent dans la boîte aux lettres sur le serveur de messagerie.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) soit par l'intermédiaire du logiciel de messagerie Lotus Notes ou Outlook : l'email reçu est présent sur le poste local dans la boîte de réception de Lotus Notes ou Outlook.




Les différentes variables de la structure email (ou la variable de type Email) correspondant à l'entête du message sont remplies.

Cette fonction est utile lorsque la lecture de l'email est par exemple liée à la taille du message.

Si aucun email n'est trouvé, la variable Email.EnDehors est positionnée à <u><u><u>Vrai</u></u></u>.

**Rappel** : Avant de lire un email, il est nécessaire d'ouvrir une session avec la fonction [EmailOuvreSession](../WDLang3/3032028.md), [EmailOuvreSessionNotes](../WDLang3/3032121.md) ou [EmailOuvreSessionOutlook](../WDLang3/3032128.md).

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Seule la lecture par le protocole POP3 est disponible.






<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Supprime les emails envoyés par des expéditeurs "black-listé" 
// Parcours des emails
// Lecture de l'entête uniquement 
// (pour économiser la bande passante)
// Si l'email est "interdit", on le supprime
// Les emails "autorisés" pourront alors être lus complètement 
// dans un deuxième temps
SI EmailLitEntêteDernier(MaSessionPOP) ALORS
	BOUCLE
	// Est-ce-que l'expéditeur fait partie d'une liste de gens "interdit" ?
	SI ExpediteurInterdit(Email.AdresseExpéditeur) OU ...
			ExpediteurInterdit(Email.Expéditeur) ALORS
		EmailSupprimeMessage(MaSessionPOP)
	FIN
	A FAIRE TANTQUE EmailLitEntêtePrécédent(MaSessionPOP)
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Lire l'entête du précédent email géré par le protocole POP3 ou IMAP

`<Résultat> = EmailLitEntêtePrécédent(<Session> [, <Email>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'entête du message a été lu. Dans ce cas, la structure email est automatiquement mise à jour.

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




La variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u> si aucun message n'a été trouvé (pas de mail).

**`<Session> : (Chaîne de caractères ou variable de type emailSessionPOP3 ou emailSessionIMAP)`**

Identifie la session d'un utilisateur. Correspond :

- au nom d'utilisateur utilisé pour ouvrir la session email (fonction [EmailOuvreSession](../WDLang3/3032028.md)).

- à une variable de type [emailSessionPOP3](../WDLang3/1000018759.md).

- à une variable de type [emailSessionIMAP](../WDLang3/1000018957.md).


![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Les variables de type [emailSessionPOP3](../WDLang3/1000018759.md) et [emailSessionIMAP](../WDLang3/1000018957.md) ne sont pas supportées.

**`<Email> : (Variable de type Email optionnelle)`**

Nom de la variable de type [Email](../WDLang3/1000018713.md) à initialiser avec le contenu du message.
![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre n'est pas disponibleSi ce paramètre n'est pas spécifié, la structure [Email](../WDLang3/3032029.md) est utilisée.


<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Lire l'entête du précédent email géré par l'intermédiaire de Lotus Notes ou Outlook

`<Résultat> = EmailLitEntêtePrécédent(<Session> [, <Email> [, <Mode de lecture>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'entête du message a été lu. Dans ce cas, la structure email est automatiquement mise à jour.

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




La variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u> si aucun message n'a été trouvé (pas de mail).

**`<Session> : (Entier)`**

Identifiant de la session email en cours. Cet identifiant peut être :

- un entier renvoyé par la fonction [EmailOuvreSessionOutlook](../WDLang3/3032128.md) ou [OutlookOuvreSession](../WDLang3/3032123.md).

- une variable de type [emailSessionOutlook](../WDLang3/1000018767.md).

- une variable de type [emailSessionNotes](../WDLang3/1000018768.md).

- une variable de type [emailSessionIMAP](../WDLang3/1000018957.md).




**`<Email> : (Variable de type Email optionnelle)`**

Nom de la variable de type [Email](../WDLang3/1000018713.md) à initialiser avec le contenu du message.

Si ce paramètre n'est pas spécifié, la structure [Email](../WDLang3/3032029.md) est utilisée.

**`<Mode de lecture> : (Constante ou chaîne de caractères optionnelle)`**

Précise les messages qui doivent être lus :


|   |   |
| --- | --- |
| *emailNonLus* ou "NON LUS" | Seuls les messages qui n'ont pas été consultés seront lus. |
| *emailTous* ou "TOUS"<br>(Valeur par défaut) | Tous les messages seront lus. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### La structure email et les variables de type Email
<a name="structure_email_les_variables_type_email_ELTPARAGRAPHE000225"></a>Deux méthodes de manipulation des emails sont disponibles :

- [La structure Email](../WDLang3/3032029.md) est une structure globale permettant de manipuler simplement un message.

- [Les variables de type Email](../WDLang3/1000018713.md) offrent des fonctionnalités plus avancées (data binding, sérialisation, instances multiples).



![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Messagerie Outlook
<a name="messagerie_outlook_ELTPARAGRAPHE000366"></a>Les fonctions WLangage **EmailLitxxx** fonctionnent uniquement avec le fichier de données Outlook (.pst) par défaut. Les autres fichiers de données ne sont pas gérés.

<a name="XComposante"></a>

## Composante :
wd280com.dll
