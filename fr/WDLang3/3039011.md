


## WINDEV et les flux - Exemple d'utilisation
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000162"></a>
Dans cet exemple, l'application étudiée doit gérer la visioconférence entre deux postes. Cette application permet de :

- visualiser la vidéo actuellement retransmise par la web caméra installée sur le poste en cours.

- visualiser la vidéo actuellement retransmise par la web caméra installée sur le poste connecté.

- retransmettre à l'utilisateur connecté la voix de l'utilisateur en cours.

- entendre la voix de l'utilisateur connecté.




A partir de la version 20, les champs Conférence sont supportés sous Windows Vista et supérieur. Si vous souhaitez utiliser le champ Conférence avec une version antérieure de Windows : 

1. Affichez la fenêtre de description du champ. 

2. Dans l'onglet "UI", cochez l'option "Utilisez les API TAPI 3.x / Windows XP (pour compatibilité)". 

3. Validez. 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Exemple d'utilisation
<a name="exemple_utilisation_ELTTEXTE000186"></a>
Pour réaliser cette application : 

1. Créez une fenêtre vierge : 

	- Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif)
 parmi les boutons d'accès rapide.

	- La fenêtre de création d'un nouvel élément s'affiche : cliquez sur "Fenêtre" puis sur "Fenêtre".




2. Créez deux champs Conférence dans cette fenêtre : sous le volet "Création", dans le groupe "Champs graphiques", déroulez "Vidéo et capture" et sélectionnez "Conférence". Dans cet exemple, le premier champ s'appelle "CONF_Réception" et le second champ s'appelle "CONF_Emission".
	Remarque : WINDEV associe automatiquement ces deux champs dans le même flux. Par défaut, le premier champ créé permet de visualiser la vidéo reçue, et le deuxième champ créé permet de visualiser la vidéo envoyée.

3. Affichez les événements associés au flux (option "Code du flux associé" du menu contextuel d'un des champs Conférence).
	Rappel : L'événement "Demande de connexion d'un nouveau flux" est exécuté lorsqu'un nouveau flux tente de se connecter avec l'application en cours. Cet événement accepte un paramètre. Pour gérer ce paramètre, une procédure est automatiquement déclarée dans l'événement "Demande de connexion d'un nouveau flux".

4. Dans l'événement "Demande de connexion d'un nouveau flux", ajoutez les lignes de code suivantes :
	
	```wl
	// Procédure de détection d'un nouveau flux 
	// nIDFlux est une variable de type entier contenant 
	// l'identifiant du flux détecté 
	PROCEDURE NouveauFlux(nIDFlux)  
	// Connaître le nom de l'appelant 
	NomAppelant est une chaîne = FluxInfo(nIDFlux, FluxNomAppelant) 
	// Accepter le flux entrant ? 
	SI OuiNon(NomAppelant + "souhaite entrer en conférence avec vous", ...
		"Acceptez-vous ?") = Oui ALORS
		FluxAccepte(nIDFlux, Réception) 
	SINON     
		FluxRefuse(nIDFlux) 
	FIN
	```


5. Dans la fenêtre :

	- créez un bouton nommé "BTN_Appel" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_bouton.gif)
. Ce bouton permettra de connecter le flux à un correspondant.

	- créez un champ de saisie nommé "SAI_AdresseCorrespondant" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_saisie.gif)
. Ce champ permettra de saisir l'adresse du correspondant.

	- créez un bouton nommé "BTN_Terminer" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_bouton.gif)
. Ce bouton permettra de terminer la réception ou l'émission d'un flux.

	- créez un champ de saisie nommé "SAI_NomUtilisateur" : sous le volet "Création", dans le groupe "Champs usuels", cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_saisie.gif)
. Ce champ permettra de saisir le nom de l'utilisateur en cours.




6. Dans l'événement "Clic du bouton BTN_Appel", saisissez le code suivant :
	
	```wl
	// Spécifier le nom de l'appelant
	Flux1.Identifiant = SAI_NomUtilisateur 
	// Connecter le flux 
	FluxConnecte(Flux1, AdresseCorrespondant) 
	// équivalent à : 
	// Flux1.Adresse = AdresseCorrespondant
	```


7. Dans l'événement "Clic du bouton BTN_Terminer", saisissez les lignes de code suivantes :
	
	```wl
	// Déconnecter le flux
	FluxDéconnecte(Flux1)
	```





**Remarque** : Pour fonctionner, cette application doit être lancée sur deux postes différents.


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDVisioconference.gif) ***Exemples complets (WINDEV)*** : **WD Visioconférence** <br>Cet exemple utilise le champ Conférence et illustre aussi l'utilisation des sockets grâce à une messagerie instantanée.<br>WD VisioConférence permet d'entrer en conférence (son + vidéo) avec un utilisateur distant. De plus grâce à la messagerie instantanée, vous avez la possibilité d'envoyer un fichier à votre correspondant et de dialoguer simplement avec lui.


