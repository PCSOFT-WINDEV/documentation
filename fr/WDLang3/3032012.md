


## EmailLitEntêteMessage (Fonction)

***En anglais : EmailReadMessageHeader***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Lit l'entête d'un email reçu :

- soit par le protocole POP3 ou IMAP : l'email est présent dans la boîte aux lettres sur le serveur de messagerie.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) soit par l'intermédiaire du logiciel de messagerie Lotus Notes ou Outlook : l'email reçu est présent sur le poste local dans la boîte de réception de Lotus Notes ou Outlook.




Les différentes variables de la structure email correspondant à l'entête du message sont remplies.

Cette fonction est utile lorsque la lecture de l'email est par exemple liée à la taille du message.

Si aucun email n'est trouvé, la variable Email.EnDehors est positionnée à <u><u><u>Vrai</u></u></u>.

**Rappel** : Avant de lire un email, il est nécessaire d'ouvrir une session avec une des fonctions suivantes : [EmailOuvreSession](../WDLang3/3032028.md), [EmailOuvreSessionNotes](../WDLang3/3032121.md) ou [EmailOuvreSessionOutlook](../WDLang3/3032128.md).
![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Seule la lecture par le protocole POP3 est disponible.






<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Utilisation du protocole POP3 
// Lecture des emails dont la taille ne dépasse pas TailleMaxEmail
I est un entier
POUR I = 1 A EmailNbMessage(NomUser)
	SI EmailTailleMessage(NomUser, I) < TailleMaxEmail ALORS
		// Procédure de lecture et traitement du message
		LireMessage()
	SINON
		EmailLitEntêteMessage(NomUser, I)
		// Procédure de réponse signalant que l'email n'a pas été lu
		RenvoiMessage(Email.AdresseExpéditeur)
	FIN
FIN
```
<a name="Exemple2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 
```wl
// Utilisation avec le logiciel de messagerie Outlook 
// TABLE_TableEmail contient l'ensemble des emails reçus
// COL_Exp contient le nom de l'expéditeur (variable Email.Expéditeur)
// COL_Sujet contient le sujet de l'email (variable Email.Sujet)
// COL_ID contient l'identifiant de l'email (variable Email.ID)
// Lecture de l'entête de l'email sélectionné dans la table
EmailLitEntêteMessage(IDSession, COL_ID)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Lire l'entête d'un email géré par le protocole POP3 ou IMAP

`<Résultat> = EmailLitEntêteMessage(<Session> [, <Email>] , <Numéro message>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'entête du message a été lu. Dans ce cas, la structure email est automatiquement mise à jour.

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




La variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u> si aucun message n'a été trouvé (pas de mail).

**`<Session> : (Chaîne de caractères ou variable de type emailSessionPOP3 ou emailSessionIMAP)`**

Identifie la session d'un utilisateur. Correspond :

- au nom d'utilisateur utilisé pour ouvrir la session email (fonction [EmailOuvreSession](../WDLang3/3032028.md)).

- à une variable de type [emailSessionPOP3](../WDLang3/1000018759.md).

- à une variable de type [emailSessionIMAP](../WDLang3/1000018957.md).


![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Les variables de type [emailSessionPOP3](../WDLang3/1000018759.md) et [emailSessionIMAP](../WDLang3/1000018957.md) ne sont pas supportées.

**`<Email> : (Variable de type Email optionnelle)`**

Nom de la variable de type [Email](../WDLang3/1000018713.md) à initialiser avec le contenu du message.
![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre n'est pas disponibleSi ce paramètre n'est pas spécifié, la structure [Email](../WDLang3/3032029.md) est utilisée.

**`<Numéro message> : (Entier)`**

Numéro du message dont l'entête doit être lu.  


<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Lire l'entête d'un email géré par l'intermédiaire de Lotus Notes ou Outlook

`<Résultat> = EmailLitEntêteMessage(<Session> [, <Email>] , <Identifiant message>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'entête du message a été lu. Dans ce cas, la structure email est automatiquement mise à jour.

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




La variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u> si aucun message n'a été trouvé (pas de mail).

**`<Session> : (Entier)`**

Identifiant de la session email en cours. Cet identifiant peut être :

- un entier renvoyé par la fonction [EmailOuvreSessionOutlook](../WDLang3/3032128.md) ou [OutlookOuvreSession](../WDLang3/3032123.md).

- une variable de type [emailSessionOutlook](../WDLang3/1000018767.md).

- une variable de type [emailSessionNotes](../WDLang3/1000018768.md).

- une variable de type [emailSessionIMAP](../WDLang3/1000018957.md).




**`<Email> : (Variable de type Email optionnelle)`**

Nom de la variable de type [Email](../WDLang3/1000018713.md) à initialiser avec le contenu du message.

Si ce paramètre n'est pas spécifié, la structure [Email](../WDLang3/3032029.md) est utilisée.

**`<Identifiant message> : (Chaîne de caractères)`**

Identifiant du message dont l'entête doit être lu. Cet identifiant est contenu dans la variable Email.ID lors de la lecture des emails.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Nombre de messages présents dans la boîte aux lettres (protocole POP3)
<a name="nombre_messages_presents_dans_boite_aux_lettres_protocole_pop3_ELTPARAGRAPHE000219"></a>Le nombre total des messages reçus est obtenu grâce à la fonction [EmailNbMessage](../WDLang3/3032024.md).

Si, dans la même session d'emails, un message a été supprimé par la fonction [EmailSupprimeMessage](../WDLang3/3032027.md) :

- la fonction [EmailNbMessage](../WDLang3/3032024.md) renvoie le nombre de messages présents sur le serveur d'emails avant la suppression. 

- les numéros des messages supprimés ne sont pas ré-affectés.




Par exemple : Lors de la connexion, quatre messages sont sur le serveur et ces messages sont numérotés de 1 à 4. Si le message 1 est supprimé :

- La fonction [EmailNbMessage](../WDLang3/3032024.md) renvoie 4.

- La lecture du message 1 avec la fonction [EmailLitMessage](../WDLang3/3032016.md) ou la fonction **EmailLitEntêteMessage** est impossible : le message n'existe plus. La variable Email.EnDehors retourne <u><u><u><u>Vrai</u></u></u></u>. Seuls les messages 2, 3 et 4 existent.




Les numéros des messages sont ré-affectés lors de la prochaine connexion.
<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Nombre de messages présents dans la boîte aux lettres (messagerie Outlook)
<a name="nombre_messages_presents_dans_boite_aux_lettres_messagerie_outlook_ELTPARAGRAPHE000262"></a>Le nombre total des messages reçus est obtenu par la fonction [EmailNbMessage](../WDLang3/3032024.md).

Si, dans la même session d'emails, un message a été supprimé par la fonction [EmailSupprimeMessage](../WDLang3/3032027.md), la fonction [EmailNbMessage](../WDLang3/3032024.md) renvoie le nombre correct de messages présents dans le dossier des emails reçus.
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Messagerie Outlook
<a name="messagerie_outlook_ELTPARAGRAPHE000413"></a>Les fonctions WLangage **EmailLitxxx** fonctionnent uniquement avec le fichier de données Outlook (.pst) par défaut. Les autres fichiers de données ne sont pas gérés.

<a name="XComposante"></a>

## Composante :
wd280com.dll
