


## FTPRécupère (Fonction)

***En anglais : FTPGet***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Transfère un fichier ou un répertoire d'un serveur FTP (File Transfer Protocol) sur le poste en cours.

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Remarque : Pour récupérer rapidement un seul fichier existant sur le serveur FTP, utilisez la fonction [FTPRécupèreFichier](../WDLang3/1000024597.md). 


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003040002&name=ftprecupere_fonction&product=WD">Voir des exemples supplémentaires</a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Récupération du fichier "/Document/Fichier.txt" présent sur le serveur FTP 
// dans le répertoire "D:\Temp" sur le poste en cours 
ResRécupère = FTPRécupère(7, "/Document/Fichier.txt", "D:\Temp")
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = FTPRécupère(<Identifiant de la connexion> , <Fichier/Répertoire à récupérer> , <Fichier/Répertoire destination> [, <Procédure WLangage> [, <Mode de transfert>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le transfert a été effectué, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.
	Remarque : Le résultat peut être incorrect sur certains serveurs Unix : un fichier ou un répertoire existant peut ne pas être trouvé.




**`<Identifiant de la connexion> : (Entier)`**

Identifiant de la connexion, obtenu avec la fonction [FTPConnecte](../WDLang3/3040016.md).


**`<Fichier/Répertoire à récupérer> : (Chaîne de caractères)`**

Nom et chemin absolu (ou relatif) du fichier (ou du répertoire) à récupérer. Ce fichier (ou ce répertoire) est situé sur le serveur FTP. Les parties du chemin sont séparées par des "slash" (barre oblique normale, "/"). 
Attention : le nom du répertoire est case sensitive. Il faut utiliser la même casse que sur le serveur FTP (majuscules/minuscules). 
Il n'est pas possible de donner de caractères joker (\* ou ?). Pour récupérer plusieurs fichiers, utilisez préalablement la fonction [FTPListeFichier](../WDLang3/3040018.md) pour avoir le nom des fichiers à récupérer.
					
Un chemin absolu est du type "#XLTXLT#NomFichier&gt;". L'arborescence obtenue est "/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;".
Un chemin relatif est du type "&lt;NomRépertoire&gt;/&lt;NomFichier&gt;". L'arborescence obtenue est "/&lt;RépertoireCourantServeur&gt;/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;".
							
**Si ce paramètre correspond à un répertoire**, tous les fichiers de ce répertoire sont récupérés. Un répertoire de même nom est créé sur le poste en cours à l'emplacement désigné par le paramètre &lt;Fichier/Répertoire destination&gt;.
			
**Si ce paramètre correspond à un fichier** :

- si le paramètre &lt;Fichier/Répertoire destination&gt; est un répertoire existant sur le poste en cours, le fichier à récupérer est copié dans le répertoire destination.

- si le paramètre &lt;Fichier/Répertoire destination&gt; est un fichier existant sur le poste en cours, le fichier à récupérer est copié et renommé.




**`<Fichier/Répertoire destination> : (Chaîne de caractères)`**

Nom et chemin complet (ou relatif) du fichier (ou du répertoire) destination. Un chemin de type UNC peut être utilisé.

**`<Procédure WLangage> : (Nom de procédure)`**

Nom d'une procédure WLangage appelée automatiquement pour contrôler la progression du transfert. Cette procédure peut être une méthode globale de classe (de la forme &lt;Nom Classe&gt;::&lt;NomMéthodeGlobale&gt;).


**`<Mode de transfert> : (Constante optionnelle de type Entier)`**

Mode de transfert réalisé :					


|   |   |
| --- | --- |
| *ftpModeASCII* | Transfert réalisé en mode ASCII. Ce mode est utilisé pour un transfert entre deux systèmes d'exploitation différents, par exemple UNIX vers Windows : le fichier transféré est livré dans le format ASCII du système destinataire. |
| *ftpModeBinaire*<br>(Valeur par défaut) | Transfert réalisé en mode binaire. Le fichier est strictement identique entre l'envoi et la réception. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Gestion de la progression de transfert
<a name="gestion_progression_transfert_ELTPARAGRAPHE000130"></a>La fonction **FTPRécupère** est une fonction bloquante : aucune autre action ne peut être effectuée jusqu'à la fin du transfert en cours. 

Pour contrôler la progression du transfert, la fonction **FTPRécupère** peut appeler automatiquement une procédure WLangage &lt;Procédure WLangage&gt; à intervalles réguliers (tous les 64 Ko).

Cette procédure est déclarée de la manière suivante :

```txt
PROCEDURE <Nom de la procédure> (<Taille totale>, <Taille transférée>)
```
où : 						

- &lt;Taille totale&gt; est un entier correspondant à la taille totale du fichier ou du répertoire en cours de transfert.

- &lt;Taille transférée&gt; est un entier correspondant au nombre d'octets déjà transférés.




Il est possible dans cette procédure :

- d'afficher une jauge de progression (via un champ Jauge par exemple),			

- de savoir si le transfert est terminé (&lt;Taille totale&gt;=&lt;Taille transférée&gt;).




La fonction **FTPRécupère** ne peut pas être interrompue tant qu'il reste des fichiers à transférer. Pour forcer l'interruption du parcours, il faut utiliser la ligne suivante dans la procédure &lt;Nom de la procédure&gt; :	

```wl
RENVOYER Faux
```
Dans les autres cas (pour poursuivre le parcours), la procédure &lt;Nom de la procédure&gt; DOIT renvoyer <u><u><u><u>Vrai</u></u></u></u>.

Si la procédure &lt;Nom de la procédure&gt; ne retourne aucune valeur (ni <u><u><u><u>Vrai</u></u></u></u>, ni <u><u><u><u>Faux</u></u></u></u>), une erreur est générée.
<a name="NOTE0_2"></a>


### Délai de transfert
<a name="delai_transfert_ELTPARAGRAPHE000178"></a>Par défaut, toutes les fonctions FTP échouent si aucune réponse du serveur FTP n'est reçue après 20 secondes. Ce délai peut être modifié lors de la connexion au serveur FTP avec la fonction [FTPConnecte](../WDLang3/3040016.md).
<a name="NOTE0_3"></a>
<a name="NOTE0_4"></a>


### Droits des utilisateurs
<a name="droits_des_utilisateurs_ELTPARAGRAPHE000207"></a>La récupération des fichiers présents sur un serveur FTP n'est possible que pour un utilisateur ayant les droits en lecture sur le serveur FTP. En règle générale, les utilisateurs "anonymes" ont les droits en lecture.					
<a name="NOTE0_5"></a>


### Chemin relatif et absolu
<a name="chemin_relatif_absolu_ELTPARAGRAPHE000214"></a>Les notions de chemin relatif et de chemin absolu sont très importantes dans une application FTP.

- Un chemin commençant par un slash est considéré comme un **chemin absolu** : il s'agit du chemin par rapport à la racine du serveur FTP (paramètre propre au serveur).
	ex: /pub/user/JULIE

- Si le chemin ne commence pas par un slash, il est considéré comme un **chemin relatif**, c'est-à-dire le chemin par rapport au répertoire en cours. Ce répertoire en cours peut être connu ou modifié avec la fonction [FTPRepEnCours](../WDLang3/3040003.md).




Lors de la connexion à un site FTP, le répertoire initial, le "home directory" de l'utilisateur n'est pas forcément la racine du serveur FTP. Il est donc conseillé d'utiliser des chemins relatifs.
<a name="NOTE0_7"></a>


### Serveur FTP de type AS/400
<a name="serveur_ftp_type_as400_ELTPARAGRAPHE000231"></a>La fonction **FTPRécupère** ne fonctionne pas correctement si le serveur FTP est présent sur un AS/400.

Dans ce cas, il convient d'utiliser la fonction [FTPCommande](../WDLang3/3040017.md) avec la commande FTP "RETR" (pour plus de détails sur les fonctions FTP, consultez la documentation du serveur FTP utilisé).

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280com.dll
