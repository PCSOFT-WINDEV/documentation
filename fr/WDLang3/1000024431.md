
## Application en mode kiosque
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000241"></a>
Une application en mode kiosque est une application que l'utilisateur ne peut pas quitter par lui-même. Lorsqu'une application est en mode kiosque l'utilisateur ne peut pas lancer d'autres applications, il n'a pas accès aux paramètres de l'appareil, il ne voit et ne reçoit ni les notifications ni les appels.

Les cas d'utilisation sont multiples : application de démonstration, application pour borne numérique, application pour enfant, application dédiée à une tâche particulière, etc.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Android et le mode kiosque
<a name="android_mode_kiosque_ELTTEXTE000265"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000018"></a>Depuis Android 5.0, deux possibilités sont disponibles pour créer une application en mode kiosque : 

- le mode kiosque 'simple' (fonctionnalité "Screen Pinning").

- le mode kiosque 'complet'.





### Le mode kiosque simple
<a name="mode_kiosque_simple_ELTPARAGRAPHE000026"></a>Cette fonctionnalité permet, sans autorisation particulière, de n'afficher qu'une seule application à l'écran : 

- la status bar est vidée, 

- les icônes des notifications sont masquées, 

- les boutons "Accueil" et "Applications récentes" sont désactivés,

- les autres applications ne peuvent pas lancer de nouvelles activités.




Cette fonctionnalité peut être utilisée par exemple pour prêter son téléphone à des enfants ou à d'autres personnes sans risque de fuite de données personnelles. 

Cependant cette fonctionnalité est insuffisante dans la plupart des autres cas. En effet : 

- une confirmation est demandée à l'utilisateur avant de passer dans ce mode. 

- l'utilisateur peut quitter ce mode à tout moment en appuyant simultanément sur les touches "Retour" et "Applications récentes". 





### Le mode kiosque complet
<a name="mode_kiosque_complet_ELTPARAGRAPHE000043"></a>Contrairement au mode kiosque simple : 

- le mode kiosque complet ne demande pas de confirmation. 

- l'utilisateur ne peut pas quitter le mode kiosque complet.




Cependant, la mise en place de ce mode kiosque nécessite l'utilisation de privilèges spécifiques. Ces privilèges peuvent être obtenus uniquement : 

- lorsque l'application est définie comme propriétaire de l'appareil ("device owner")

- si une application "device owner" donne ces privilèges à l'application. 




Une application "device owner" peut effectuer, à la condition de les déclarer, des opérations normalement réservées aux applications système : créer des utilisateurs, modifier des paramètres globaux (accès au wifi, au bluetooth), définir des politiques de  sécurité, masquer des applications, et notamment dans le cas du mode kiosque : verrouiller l'application pour que l'utilisateur ne puisse plus en sortir par lui même. 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Comment gérer le mode kiosque simple dans une application WINDEV Mobile ?
<a name="comment_gerer_mode_kiosque_simple_dans_une_application_windev_mobile_ELTTEXTE000301"></a>


### Comment le faire ?
<a name="comment_faire_ELTPARAGRAPHE000062"></a>Pour gérer le mode kiosque simple : 

1. Utilisez la fonction [KiosqueActive](../WDLang3/1000024425.md). 

2. Un message de confirmation est affiché à l'utilisateur pour activer ou non le mode kiosque. 





### Remarques
<a name="remarques_ELTPARAGRAPHE000073"></a>

- Il est possible de savoir si le mode kiosque est activé grâce à la fonction [EnModeKiosque](../WDLang1/1000024427.md). 

- Il est possible de sortir du mode kiosque grâce à la fonction [KiosqueDésactive](../WDLang3/1000024426.md). 








<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Comment gérer le mode kiosque complet dans une application WINDEV Mobile ?
<a name="comment_gerer_mode_kiosque_complet_dans_une_application_windev_mobile_ELTTEXTE000331"></a>


### Comment le faire ?
<a name="comment_faire_ELTPARAGRAPHE000090"></a>Pour gérer le mode kiosque complet : 

1. Passez l'application en mode "Device owner" : 

	- Dans la description de la configuration de projet Android, cochez l'option "Application d'administration de l'appareil (peut devenir "device owner" pour le mode kiosque)". 

	- Exécutez la ligne de commande pour activer le mode kiosque complet (voir ci-dessous). 




2. Utilisez la fonction [KiosqueActive](../WDLang3/1000024425.md) dans l'application pour activer le mode kiosque. 





### Ligne de commande pour activer le mode kiosque complet
<a name="ligne_commande_pour_activer_mode_kiosque_complet_ELTPARAGRAPHE000108"></a>**Après l'installation de l'application sur le terminal Android**, exécutez la commande ADB suivante en ciblant l'appareil sur lequel l'application est installée : 

```txt
adb shell dpm set-device-owner 
<package>/fr.pcsoft.wdjava.core.application.WDDeviceAdminReceiver
```
où :  
&lt;Package&gt; correspond au nom du package de votre application Android.
Cette commande crée une entrée dans le fichier "/data/system/ device_owner.xml" qui référence l'application comme étant "device owner". 
 **Remarque** : Il ne peut y avoir qu'une seule application en mode "device owner" par appareil et cette opération n'est possible que si aucun utilisateur n'a été configuré sur l'appareil. Dans le cas contraire, il est nécessaire de supprimer tous les utilisateurs avant d'exécuter la commande.


### Comment tester une application utilisant le mode kiosque complet ? 
<a name="comment_tester_une_application_utilisant_mode_kiosque_complet_ELTPARAGRAPHE000122"></a>Pour tester une application Android utilisant le mode kiosque complet, il est conseillé de réaliser un test dans l'émulateur. En effet, il est ensuite possible de faire un "reset" de l'émulateur pour réaliser le test d'autres applications. 

**A partir d'Android 7.0**, il est possible d'indiquer que l'application est utilisée uniquement à des fins de tests lors de la génération de l'application Android. 
WINDEV Mobile propose cette option par défaut dans l'assistant de génération de l'application Android si : 

- l'option "Application d'administration de l'appareil (peut devenir "device owner" pour le mode kiosque)" a été cochée dans la fenêtre de description de la configuration Android. 

- l'application n'est pas signée pour le store lors de sa génération. 


Pour information, cette option consiste à utiliser "android:testOnly=true" dans le manifeste de l'application. 

Dans ce cas, après les tests effectués sur l'appareil mobile, il est possible de désactiver le mode "Device owner" avec la ligne de commande suivante : 

```txt
adb shell dpm remove-active-admin <package>/fr.pcsoft.wdjava.core.application.WDDeviceAdminReceiver
```
L'activation de cette option est conseillée durant la phase de test de l'application. Il n'est pas possible de déployer une application de test sur le Play Store. 


### Remarques sur le mode kiosque complet
<a name="remarques_sur_mode_kiosque_complet_ELTPARAGRAPHE000145"></a>

- Une fois qu'une application a été définie comme "device owner", il n'est plus possible de désactiver ce mode ni même de supprimer l'application. Seule une réinitialisation d'usine (factory reset) de l'appareil permet supprimer l'application.  

- Pour mettre à jour une application en mode "device owner", il est nécessaire de la signer avec la même clé que celle utilisée lorsque le mode a été activée.

- La fonction WLangage [EnModeDeviceOwner](../WDLang1/1000024428.md) permet de savoir si l'application est "device owner".

- Il est possible de savoir si le mode kiosque est activé grâce à la fonction [EnModeKiosque](../WDLang1/1000024427.md). 

- Il est possible sortir du mode kiosque grâce à la fonction [KiosqueDésactive](../WDLang3/1000024426.md). 




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Astuces et programmation
<a name="astuces_programmation_ELTTEXTE000373"></a>


### Astuces
<a name="astuces_ELTPARAGRAPHE000167"></a>

- Il est conseillé de prévoir un moyen de sortir du mode kiosque (option de menu accessible par un mot de passe, ...). 

- En cas de redémarrage du système (problème de batteries, ...), l'activation du mode kiosque ne sera pas conservée au lancement suivant de l'application. Pensez à  :  

	- Relancer automatiquement l'application : cochez l'option "Lancer automatiquement l'application au démarrage du périphérique" dans l'assistant de génération de l'application Android. 

	- Enregistrer le mode d'utilisation de l'application (mode kiosque ou non) afin que lors de son lancement, ce mode soit paramétré par défaut (par exemple, utilisez les fonctions [SauveParamètre](../WDLang1/3025046.md) et [ChargeParamètre](../WDLang1/3025047.md) dans l'événement "Initialisation" du projet). 

	- Réactivez si nécessaire le mode kiosque (fonction [KiosqueActive](../WDLang3/1000024425.md) utilisée dans dans l'événement "Initialisation" du projet). 








### Fonctions WLangage liées à l'utilisation du mode kiosque
<a name="fonctions_wlangage_liees_utilisation_mode_kiosque_ELTPARAGRAPHE000190"></a>


|   |   |
| --- | --- |
| [EnModeDeviceOwner](../WDLang1/1000024428.md) | Indique si l'application Android est en mode "Device owner". |
| [EnModeKiosque](../WDLang1/1000024427.md) | Indique si l'application Android est en mode kiosque. |
| [KiosqueActive](../WDLang3/1000024425.md) | Passe l'application Android en cours en mode kiosque. |
| [KiosqueDésactive](../WDLang3/1000024426.md) | Désactive le mode kiosque pour l'application en cours. |










