


## HTTPEnvoieFormulaire (Fonction)

***En anglais : HTTPSendForm***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Envoie un formulaire HTTP. Ce formulaire a été créé grâce à la fonction [HTTPCréeFormulaire](../WDLang3/1000017119.md).

<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000019245&name=httpenvoieformulaire_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
HTTPCréeFormulaire("FORM")
HTTPAjouteParamètre("FORM", "Prix", "3400") 
...
HTTPEnvoieFormulaire("FORM", "www.monsite.fr")
```

```wl
// Exemple d'envoi d'un fichier 
lIdForm = "TEST"
HTTPCréeFormulaire(lIdForm) 
HTTPAjouteFichier(lIdForm, "file", "C:\temp\Attestation.pdf") 
SI PAS HTTPEnvoieFormulaire(lIdForm, "http://test.monserveur.net", httpPost, "AGENT") ALORS 
...		
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Syntaxe complète

`<Résultat> = HTTPEnvoieFormulaire(<Nom du formulaire> , <URL à contacter> [, <Méthode HTTP> [, <Agent utilisateur> [, <Entête HTTP supplémentaire> [, <Type du formulaire> [, <Nom User> [, <Mot de passe>]]]]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le formulaire HTTP a été envoyé, 

- <u><u><u><u>Faux</u></u></u></u> en cas d'erreur. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




**`<Nom du formulaire> : (Chaîne de caractères)`**

Nom du formulaire HTTP à envoyer.

**`<URL à contacter> : (Chaîne de caractères)`**

Adresse du serveur à contacter sous forme d'adresse URL. 
Ce paramètre peut contenir le numéro de port pour la connexion sur le serveur. La valeur par défaut est 80 (correspond à un serveur de pages Web). Pour spécifier un numéro de port, utilisez le format : "&lt;URL du serveur&gt;**:**&lt;N° du port&gt;". 
Par exemple : http://www.pcsoft.fr:80.

**Remarque** : Pour réaliser une transaction sécurisée, l'URL doit commencer par la chaîne "https://".

**`<Méthode HTTP> : (Constante optionnelle de type Entier)`**

Méthode HTTP utilisée :


|   |   |
| --- | --- |
| *httpCopy* | Méthode COPY |
| *httpDelete* | Méthode DELETE |
| *httpGet* | Méthode GET |
| *httpHead* | Méthode HEAD |
| *httpPatch* | Méthode PATCH |
| *httpPost*<br>(Valeur par défaut) | Méthode POST |
| *httpPut* | Méthode PUT<br>![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Non disponible. |



**`<Agent utilisateur> : (Chaîne de caractères optionnelle)`**

Identifie le client. Par défaut, la valeur "PC SOFT Framework" est envoyée. 
Le contenu de la réponse peut dépendre de l'agent utilisateur. Dans ce cas, consultez la documentation de l'agent utilisateur pour plus de détails.

**`<Entête HTTP supplémentaire> : (Chaîne de caractères optionnelle)`**



- Entête HTTP supplémentaire à ajouter au message HTTP. Attention : cette chaîne doit se terminer par un Retour-Chariot (RC). 

- Chaîne vide ("") si aucun entête HTTP ne doit être ajouté.




**`<Type du formulaire> : (Chaîne de caractères optionnelle ou constante optionnelle)`**

Type du formulaire à envoyer au serveur. Ce paramètre correspond au "Content-Type". 
Par défaut, le type du message correspond à : "application/x-www-form-urlencoded".
Ce paramètre peut correspondre à une des constantes suivantes : 



|   |   |
| --- | --- |
| *typeMimeFormulaireMultiPartie* | Le type du message correspond à : "multipart/form-data" (utilisé notamment pour le transfert de fichiers). |
| *typeMimeFormulaireSimple*<br>(Valeur par défaut) | Le type du message correspond à : "application/x-www-form-urlencoded". |



**`<Nom User> : (Chaîne de caractères optionnelle)`**

Nom permettant d'accéder à une page avec une URL protégée (chaîne vide par défaut). Ce nom permet d'identifier l'utilisateur.

**`<Mot de passe> : (Chaîne de caractères optionnelle)`**

Mot de passe associé au nom d'utilisateur (chaîne vide par défaut). Permet d'accéder à une page avec une URL protégée. **Attention** : Le mot de passe est transmis en clair sur Internet.


<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 
### Syntaxe utilisant le type httpRequête

`<Résultat> = HTTPEnvoieFormulaire(<Nom du formulaire> , <Requête HTTP>)`
---

**`<Résultat> : (Variable de type httpRéponse)`**

Nom de la variable de type [httpRéponse](../WDLang3/1000021165.md) contenant la réponse de la requête.

**`<Nom du formulaire> : (Chaîne de caractères)`**

Nom du formulaire HTTP à envoyer.

**`<Requête HTTP> : (Variable de type httpRequête)`**

Nom de la variable [httpRequête](../WDLang3/1000021158.md) contenant tous les paramètres nécessaires à l'envoi du formulaire.


<a name="SYNTAXE3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 
### Syntaxe asynchrone utilisant le type httpRequête

`HTTPEnvoieFormulaire(<Nom du formulaire> , <Requête HTTP> , <Procédure WLangage>)`
---

**`<Nom du formulaire> : (Chaîne de caractères)`**

Nom du formulaire HTTP à envoyer.

**`<Requête HTTP> : (Variable de type httpRequête)`**

Nom de la variable [httpRequête](../WDLang3/1000021158.md) contenant tous les paramètres nécessaires à l'envoi du formulaire.

**`<Procédure WLangage> : (Nom de procédure)`**

Nom de la procédure WLangage appelée lors de la réponse du serveur HTTP. Cette procédure est de la forme : 

```txt
PROCEDURE <Nom de la procédure>(<Réponse> est une httpRéponse)
```
où &lt;Réponse&gt; est une variable de type [httpRéponse](../WDLang3/1000021165.md) contenant la réponse reçue du serveur HTTP.





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Erreur de sécurité dans une transaction sécurisée
<a name="erreur_securite_dans_une_transaction_securisee_ELTPARAGRAPHE000211"></a>Lors d'une transaction sécurisée, certaines erreurs de sécurité peuvent faire échouer l'envoi du formulaire :

- certificat invalide ou ne provenant pas d'une société connue.

- nom du site figurant dans le certificat ne correspond pas à un serveur.

- date du certificat non-valide ou expiré.

- renvoi vers un serveur non sécurisé.




Ces erreurs sont renvoyées par la fonction [ErreurInfo](../WDLang1/3013008.md).

Si une de ces erreurs est rencontrée, il est possible d'exécuter à nouveau la requête en ignorant ces erreurs. 

Selon la syntaxe utilisée, deux méthodes peuvent être utilisées : 

- Syntaxe 1 : utilisation de la variable **HTTP.IgnoreErreur** (voir paragraphe ci-dessous). 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Syntaxe 2 : utilisation de la propriété **IgnoreErreur** de la variable [httpRequête](../WDLang3/1000021158.md).




**Si la syntaxe complète est utilisée (syntaxe 1)**, il suffit d'utiliser la variable **HTTP.IgnoreErreur** :

| Erreur renvoyée par la fonction [ErreurInfo](../WDLang1/3013008.md)<br> (avec la constante *errCode*) | Valeur de HTTP.IgnoreErreur <br>(ces valeurs peuvent être combinées) | Description |
| --- | --- | --- |
| *httpErreurCertificatInvalide*<br>Certificat invalide ou ne provenant pas d'une société connue | *httpIgnoreCertificatInvalide* | Le certificat est ignoré. |
| *httpErreurNomCertificatInvalide*<br>Nom du site figurant dans le certificat ne correspond pas à un serveur | *httpIgnoreNomCertificatInvalide* | Le nom du site figurant dans le certificat est ignoré. |
| *httpErreurCertificatExpiré*<br>Date du certificat non-valide ou expiré | *httpIgnoreCertificatExpiré* | La date du certificat est ignorée |
| *httpErreurRenvoiHTTP*<br>Renvoi vers un serveur non sécurisé | *httpIgnoreRenvoiHTTP* | Le renvoi vers un serveur non sécurisé est autorisé. |
| *httpErreurRenvoiHTTPS*<br>Renvoi vers un serveur sécurisé | *httpIgnoreRenvoiHTTPS* | Le renvoi vers un serveur sécurisé est autorisé. |

Par exemple :

```wl
// Envoi d'un formulaire sur un serveur sécurisé
ResLancement = HTTPEnvoieFormulaire("FORM", "https://www.MonServeur.com")
// Si erreur rencontrée
SI ResLancement = Faux ALORS
	// Selon le type d'erreur rencontré
	SELON ErreurInfo(ErrCode)
	  // Certificat invalide ou ne provenant pas d'une société connue
	  CAS httpErreurCertificatInvalide : 
		// Ignorer le certificat ?
		SI OuiNon("Attention, une alerte de sécurité a été détecté !", ...
			 "Le certificat est invalide.", ...
				"Voulez-vous ignorer ce certificat ?") = Oui ALORS
			HTTP.IgnoreErreur = httpIgnoreCertificatInvalide
			// Nouvel envoi du formulaire ignorant cette erreur
			HTTPEnvoieFormulaire("FORM", "https://www.MonServeur.com")
		FIN
	// Date du certificat non-valide ou expiré
	CAS httpErreurCertificatExpiré : 
		// Ignorer la date du certificat ?
		SI OuiNon("Attention, une alerte de sécurité a été détecté !", ...
			"La date du certificat est invalide ou expiré.", ...
				"Voulez-vous ignorer cette date ?") = Oui ALORS
			HTTP.IgnoreErreur = httpIgnoreCertificatExpiré
			// Nouvel envoi du formulaire en ignorant cette erreur
			HTTPEnvoieFormulaire("FORM", "https://www.MonServeur.com")
		FIN
	FIN
FIN
```

<a name="NOTE0_2"></a>


### Récupération
<a name="recuperation_ELTPARAGRAPHE000306"></a>La fonction [HTTPDonneRésultat](../WDLang3/3043001.md) permet de récupérer le résultat du dernier formulaire HTTP envoyé.
<a name="NOTE0_3"></a>


### Accéder à une URL protégée par mot de passe
<a name="acceder_une_url_protegee_par_mot_passe_ELTPARAGRAPHE000316"></a>Pour accéder à une URL protégée par mot de passe, il est possible :

- soit d'utiliser les paramètres &lt;Nom User&gt; et &lt;Mot de passe&gt; de la fonction **HTTPEnvoieFormulaire**.

- soit de préciser directement dans le paramètre &lt;URL à contacter&gt; le login et le mot de passe. 
	Par exemple :
	
	```txt
	<Résultat> = HTTPEnvoieFormulaire("http://<user>:<password>@<URL à contacter>")
	```




<a name="NOTE0_4"></a>


### Utilisation d'un proxy
<a name="utilisation_proxy_ELTPARAGRAPHE000333"></a>Pour accéder à l'URL spécifiée dans la fonction **HTTPEnvoieFormulaire** via un proxy, utilisez la fonction [Proxy](../WDLang3/3043002.md).
<a name="NOTE0_5"></a>


### En-têtes d'authentification
<a name="entetes_authentification_ELTPARAGRAPHE000346"></a>Les entêtes d'authentification sont générées automatiquement dans les cas suivants :

- Si la fonction **HTTPEnvoieFormulaire** utilise la syntaxe avec login et mot de passe.

- Si l'URL serveur est protégée par mot de passe

- Si la fonction [Proxy](../WDLang3/3043002.md) est utilisée.



<a name="NOTE0_7"></a>
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) 

### Fonctionnalité d'application requise
<a name="fonctionnalite_application_requise_ELTPARAGRAPHE000367"></a>L'utilisation de cette fonction entraîne la déclaration d'une fonctionnalité d'application dans l'assistant de génération de l'application.

Fonctionnalité requise : Internet et réseaux publics (sortant).

Cette fonctionnalité permet aux applications d'utiliser des accès à Internet et aux réseaux publics. 

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280com.dll
