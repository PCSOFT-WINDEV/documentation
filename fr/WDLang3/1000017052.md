
## DotNetDélégué (Fonction)

***En anglais : DotNetDelegate***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Initialise un délégué .NET. Ce délégué permettra à .NET de rappeler une procédure ou une méthode du WLangage dans le cas des événements ou des "callbacks".


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1001000017052&name=dotnetdelegue_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
clPossède est un PossèdeEvènement
clPossède:add_MonEvènement(DotNetDélégué("MonHandler", "EventHandler<MonArgumentEvènement>"))
clPossède:Déclenche("Coucou")
```

```wl
PROCEDURE MonHandler(src, args)
Trace(args:Message)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = DotNetDélégué(<Procédure WLangage> , <Type du délégué>)`
---

**`<Résultat> : (Objet .NET)`**

Objet .Net du type du délégué.

**`<Procédure WLangage> : (Nom de procédure)`**

Nom de la procédure ou de la méthode WLangage à appeler. Cette procédure est de la forme :


```txt
PROCEDURE <Nom de la procédure>(Src, Args)
```


où : 

- ***Src*** correspond à l'objet .NET envoyant l'événement

- ***Args*** correspond à l'objet .NET utilisé comme paramètre de l'événement.




**`<Type du délégué> : (Chaîne de caractères)`**

Nom de la classe du délégué à créer. Ce paramètre ne doit pas correspondre à une variable.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques




### Vocabulaire
<a name="vocabulaire_ELTPARAGRAPHE000050"></a>

- **Delegate** : Sert à gérer une callback. C'est un type "fonction". Il définit le prototype de la fonction. Le delegate est initialisé avec une fonction .NET correspondant au prototype. Le delegate est l'équivalent .NET du pointeur de fonction du langage C. Il est possible d'associer plusieurs méthodes au même delegate : elles seront toutes appelées.
	**Attention** : dans la documentation .NET, ce terme peut également désigner les "delegates methods", c'est-à-dire les méthodes associées à un délégué.

- **Handler** : Type particulier de delegate spécialement dédié au traitement des événements.

- **Evénement** : Il est possible d'associer à un événement un ou plusieurs handlers. Lorsque l'événement se produit, tous les handlers qui lui ont été associés sont appelés.



<a name="NOTE0_2"></a>




### Comment utiliser un delegate DotNet avec WINDEV ? 
<a name="comment_utiliser_delegate_dotnet_avec_windev_ELTPARAGRAPHE000062"></a>Pour utiliser un delegate DotNet avec WINDEV, il faut : 

1. Trouver le delegate dans la liste des classes .NET 
	Le delegate est lui-même une classe .NET. Vous devez connaître le nom du delegate (voir la documentation de votre assemblage .NET).

2. Déterminer les paramètres du delegate
	Le delegate définit une méthode Invoke. La procédure WLangage associée au delegate doit posséder les mêmes paramètres.

3. Associer la procédure WLangage au delegate
	Le delegate est utilisé dans une classe .NET. Cette classe possède des méthodes permettant d'ajouter ou de retirer une "delegate method" au delegate.
	Reportez-vous à la documentation de votre assemblage .NET pour connaître les noms de ces méthodes.




Exemple :

- Nom de la classe utilisant le delegate 	: CUtiliseDelegate

- Nom de la classe du delegate : CUtiliseDelegate.CpfMonDelegate

- Prototype de la méthode Invoke de la classe CUtiliseDelegate.CpfMonDelegate  : Invoke(entier)

- Prototype de la méthode WLangage correspondante : Procédure MaCallbackWL(local i est un entier)
	
	```wl
	// Instancier une classe possédant un delegate 
	clUtilise est un CUtiliseDelegate
	
	// Ajouter une "delegate method" (callback WL) au delegate
	clUtilise:AjouteDelegate(DotNetDelegate("MaCallbackWL", ...
			"CUtiliseDelegate.CpfMonDelegate"))
	
	// Provoquer l'utilisation du delegate par la classe .NET
	clUtilise:UtiliseDelegate()
	```






### Comment traiter les événements .NET
<a name="comment_traiter_les_evenements_net_ELTPARAGRAPHE000088"></a>Pour traiter les événements .Net, il faut : 

**1. Trouver l'événement.**
L'événement est un membre d'une classe .NET. Ce membre a un nom et un type. Le type définit le type du handler qui pourra être associé à l'événement. Le nom permet de trouver deux méthodes :

- "add_&lt;Nom de l'événement&gt;"

- "remove_&lt;Nom de l'événement&gt;"




Ces deux méthodes permettent d'associer et de dissocier un ou plusieurs handlers à un événement. Le type du paramètre de ces deux méthodes est le nom du type du handler.

Exemple : La classe **PossèdeEvénement** contient un événement *MonEvenement* de type ***EventHandler&lt;MonArgumentEvénement&gt;***.

**2. Récupérer un handler.**
La récupération d'un handler est réalisée grâce à la fonction **DotNetDélégué** :

- Le premier paramètre est le nom de la procédure WLangage

- Le second paramètre est le nom de la classe du type du handler. Ce nom peut être récupéré par le nom du type des paramètres des méthodes "add_xxx" et "remove_xxx".




Exemple : La procédure WLangage est de la forme :

```wl
PROCEDURE MonHandler(src, args)
Trace(args:Message)
```


src est un objet .NET de type PossèdeEvénement, args est un objet .NET de type MonArgumentEvénement

**3. Associer le handler à l'événement**
Pour associer le handler à l'événement, il suffit d'appeler sur l'objet possédant l'événement, la méthode "add_&lt;Nom de l'événement&gt;".

Exemple :

```wl
clPossède:add_MonEvénement(DotNetDélégué("MonHandler", "EventHandler<MonArgumentEvénement>"))
```


**4. Déclencher l'événement**
Dans notre exemple, l'appel à clPossède:Déclenche provoque l'événement.
<a name="NOTE0_3"></a>


### Astuce
<a name="astuce_ELTPARAGRAPHE000132"></a>Dans la procédure WLangage, il est possible :

- soit d'utiliser directement les méthodes associées aux paramètres de la procédure. Cependant, la complétion n'est pas disponible.

- soit de définir un objet dynamique et de lui affecter le paramètre voulu. La complétion est alors disponible sur l'objet.




Ces deux méthodes sont utilisées dans l'exemple détaillé.
<a name="NOTE0_4"></a>


### Divers
<a name="divers_ELTPARAGRAPHE000144"></a>

- Cette fonction ne peut pas être utilisée en compilation dynamique.

- La procédure WLangage est exécutée dans un thread secondaire. Le mode HFSQL utilisé est une copie légère du contexte HFSQL à chaque appel. Le contexte est détruit à la fin de la procédure.





- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDObservateurRepertoire.gif) ***Exemples didactiques (WINDEV)*** : **WD ObservateurRépertoire** <br>Cet exemple montre l'utilisation de la fonction WLangage fSurveilleRépertoire.<br>il permet de monitorer un répertoire,<br>c'est à dire d'être prévenu à chaque fois qu'une modification est faite dans ce répertoire.<br>Une modification peut être :<br>- Un ajout de fichier / répertoire<br>- Un renommage<br>- Une modification de fichier<br>- Une suppression de fichier
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDDelegueDOTNET.gif) ***Exemples didactiques (WINDEV)*** : **WD Délégué DOTNET** <br>Cet exemple didactique montre comment interagir avec les délégués DOTNET



<a name="XComposante"></a>

## Composante :
wd280vm.dll
