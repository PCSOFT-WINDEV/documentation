


## Développement d'un site SaaS
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000343"></a>
Le développement d'un site SaaS est très similaire à celui d'un site WEBDEV traditionnel. 

Certaines opérations supplémentaires doivent être réalisées :

- [Activation de la prise en charge de SaaS au niveau du projet](#NOTE2_1).

- [Définition de la page de connexion (si le mécanisme de connexion automatique n'est pas utilisé)](#NOTE3_1).

- [Appels au Webservice pour vérifier les autorisations d'accès aux différents services du site](#NOTE4_1).

- [Personnalisation du site en fonction du compte client utilisé](#NOTE5_1).

- [Configuration du mode test](#NOTE6_1). 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Activation de la prise en charge de SaaS
<a name="activation_prise_charge_saas_ELTTEXTE000367"></a>
Pour activer la prise en charge des fonctionnalités SaaS dans le projet : 

1. Sous le volet "Projet", dans le groupe "Projet", cliquez sur "Description".

2. Dans l'onglet "Projet", cochez l'option "Site SaaS (Software as a Service)" : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ConfigSaaSProjet.gif)


3. Indiquez si nécessaire le nom du Serveur d'Application (ou l'adresse complète du Webservice SaaS) à utiliser pour le mode test. 
	Pour utiliser le serveur SaaS local, aucune adresse ne doit être indiquée. 
	Pour plus de détails, consultez [Configuration du mode test](#NOTE5_1). 

4. Indiquez le mode de connexion : 

	- Cochez la case "Utiliser le mode "Connexion automatique"" pour utiliser le mode de connexion intégré de WEBDEV. 

	- Si vous souhaitez personnaliser la page de connexion à l'application, décochez cette case. 





Pour plus de détails, consultez le paragraphe [Mode de connexion](#NOTE3_1). 

<a name="NOTE3"></a>


## Mode de connexion
<a name="mode_connexion_ELTTEXTE000391"></a>
<a name="NOTE3_1"></a>


### Page de connexion automatique
<a name="page_connexion_automatique_ELTPARAGRAPHE000087"></a>Lorsqu'un site SaaS utilise la page de connexion automatique, le Serveur d'Application WEBDEV génère une page permettant à l'utilisateur de se connecter au site.

Cette page prend en charge les opérations suivantes :

- Saisie du login et d'un mot de passe.

	- Un lien permet de gérer l'oubli du mot de passe. Dans ce cas, un email est envoyé à l'utilisateur avec le code de sécurité correspondant. 
			Attention : pour utiliser cette fonctionnalité, il est nécessaire de renseigner l'adresse email de l'utilisateur et de configurer l'administrateur SaaS pour l'envoi d'emails par SMTP.

	- Après 3 tentatives de saisie du mot de passe, la saisie d'un captcha est demandée en plus du mot de passe pour l'identification. 




- Appel de la fonction [SaaSConnecte](../WDLang3/1000018959.md) pour vérifier les informations d'authentification fournies.

- Vérification si l'utilisateur est titulaire d'une licence pour au moins un service fourni par le site.

- Changement automatique de la connexion de tous les fichiers de données de l'analyse du site.
	Ce changement est équivalent au code suivant :
	
	```wl
	HChangeConnexion("*", SaaSConnexionClient())
	```





**Avantages de cette méthode** :

- Si le site définit uniquement un seul service, il n'y a rien à programmer.

- Test rapide du passage d'un site en SaaS.

- Possibilité d'affiner le résultat des appels automatiques en utilisant les fonctions [HChangeConnexion](../WDLang4/3044150.md) ou [SaaSVérifieService](../WDLang3/1000018961.md) dans le site.



<a name="NOTE3_2"></a>


### Page de connexion personnalisée
<a name="page_connexion_personnalisee_ELTPARAGRAPHE000129"></a>Si le mécanisme de connexion automatique n'est pas utilisé, il est nécessaire de prévoir une page du site pour gérer un mécanisme d'authentification de l'utilisateur auprès du Websevice SaaS. 

La page de connexion doit :

1. Appeler la fonction [SaaSConnecte](../WDLang3/1000018959.md) pour établir la connexion au Webservice SaaS.

2. Vérifier quels sont les services que l'utilisateur peut utiliser (fonction [SaaSVérifieService](../WDLang3/1000018961.md)).

3. Changer la connexion des fichiers de données de l'analyse en utilisant la fonction [HChangeConnexion](../WDLang4/3044150.md). Les informations de connexion de l'utilisateur SaaS en cours peuvent être récupérées grâce à la fonction [SaaSConnexionClient](../WDLang3/1000019016.md).




**Avantages de cette méthode :**

- Possibilité de personnaliser la page de connexion.

- La page de connexion n'est pas obligatoirement la première page site. Il devient possible d'avoir une partie "publique" visible par tous et une partie "privée" accessible aux seuls utilisateurs authentifiés.



<a name="NOTE3_3"></a>


### Remarques
<a name="remarques_ELTPARAGRAPHE000159"></a>

- Même la partie publique d'un site peut nécessiter un appel à la fonction [SaaSConnecte](../WDLang3/1000018959.md) (en utilisant un identifiant "invité") afin de permettre la personnalisation de l'interface utilisateur du site grâce aux paramètres associés au compte client SaaS. Pour plus de détails, consultez [Personnalisation d'un site SaaS](#NOTE5_1).

- Il est recommandé d'accéder à la page de connexion en utilisant le protocole HTTPS afin d'éviter de faire circuler les informations d'authentification en clair sur le réseau.

- Pour accroître encore la sécurité d'un site SaaS, il est possible de placer le Webservice sur une machine qui n'est pas accessible publiquement mais seulement depuis le Serveur d'Application WEBDEV hébergeant le site SaaS. De cette façon, les requêtes au Webservice ne peuvent pas être interceptées.




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Vérification des autorisations
<a name="verification_des_autorisations_ELTTEXTE000427"></a>
Il est possible de segmenter les différentes fonctionnalités offertes par un site SaaS en déclarant des services dans l'[Administrateur SaaS](../SaaSAdminWeb/1600000.md). Ces services sont ensuite mis à la disposition des utilisateurs par le biais de tarifications. Une tarification regroupe un ou plusieurs services. Les comptes utilisateur souscrivent des abonnements aux tarifications et distribuent les licences ainsi obtenues à leurs utilisateurs.

Pour vérifier que l'utilisateur connecté possède bien une licence correspondant à une fonctionnalité du site, il suffit d'utiliser la fonction [SaaSVérifieService](../WDLang3/1000018961.md).

Par exemple, il est possible d'afficher un message d'erreur et rediriger l'utilisateur. La fonction [SaaSVérifieService](../WDLang3/1000018961.md) est employée dans le code d'initialisation d'une page de la façon suivante : 


```wl
// Vérifie que l'utilisateur est autorisé à ajouter de nouveaux incidents dans la base
SI SaaSVérifieService("Ajout d'incident") = Faux ALORS
	Erreur("Votre niveau d'abonnement ne vous autorise pas à ajouter de nouveaux incidents.")
	PageAffiche(PAGE_ListeBug)
FIN
```


Il est également possible de rendre invisibles les éléments auxquels l'utilisateur n'a pas accès :


```wl
// Masque le graphe des statistiques 
// si l'abonnement de l'utilisateur en cours n'inclus pas le service "statistiques"
GRF_Stat.Visible = SaaSVérifieService("statistiques")
```



### Remarque
<a name="remarque_ELTPARAGRAPHE000198"></a>Même dans le cas d'un site offrant un nombre limité de services, il est toujours utile de déclarer des constantes correspondant aux noms des services afin d'éviter des fautes de frappe dans les appels à la fonction [SaaSVérifieService](../WDLang3/1000018961.md).

<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Personnalisation d'un site SaaS
<a name="personnalisation_site_saas_ELTTEXTE000457"></a>
Il est possible de personnaliser l'IHM et le fonctionnement d'un site SaaS pour chaque compte client. Cette personnalisation peut se faire de la façon suivante :

- Libellé dépendant du compte client.

- Images propres à chaque compte client.

- Fonctionnement interne (algorithmes du site) dépendant du compte client.




L'essentiel du paramétrage par client repose sur l'utilisation de la fonction [SaaSLitParamètreSite](../WDLang3/1000019037.md).

L'administrateur du système SaaS peut en effet définir pour chaque site déclaré dans l'[Administrateur SaaS](../SaaSAdminWeb/1600000.md), un ou plusieurs paramètres. Ces paramètres (identifiés par leur nom) peuvent être relus dans le code du site grâce à la fonction [SaaSLitParamètreSite](../WDLang3/1000019037.md) pour influer sur le fonctionnement du site.

Voici quelques exemples :

- **Paramétrage du logo et du titre des pages du site**
	Ce code peut être utilisé dans un modèle de pages, présent dans chaque page du site.
	
	```wl
	// Paramétrage de l'IHM du site SaaS
	IMG_Logo = SaaSLitParamètreSite("ImageLogo")
	LIB_Titre = SaaSLitParamètreSite("TitreClient")
	```

	Dans cet exemple, il suffit de déclarer "ImageLogo" et "TitreClient" comme étant des paramètres du site et de personnaliser leur valeur pour chaque compte client.




- **Paramétrage de l'algorithmique du site**
	
	```wl
	bEstUnPro est un booléen
	bEstUnPro = SaaSLitParamètreSite("ComptePro")
	
	SI bEstUnPro = Vrai ALORS
		AppliqueRemisePro()
	SINON
		AppliqueRéductionCarteFidélité()
	FIN
	```

	Dans cet exemple, le paramètre "ComptePro" indique si le compte client référence un professionnel ou un particulier et un traitement particulier est appelé en fonction de cette information.




<a name="NOTE6"></a>
<a name="NOTE6_1"></a>


## Configuration du mode test
<a name="configuration_mode_test_ELTTEXTE000481"></a>
Afin de pouvoir lancer un site SaaS en mode test, plusieurs configurations sont possibles :

- Utilisation d'un Serveur d'Application WEBDEV.

- Utilisation d'un Serveur d'Application WEBDEV de test limité à 10 connexions. 

- Utilisation d'un Serveur SaaS local.  





### Utilisation d'un Serveur d'Application WEBDEV (limité ou non à 10 connexions)
<a name="utilisation_serveur_application_webdev_limite_non_10_connexions_ELTPARAGRAPHE000257"></a>Pour utiliser un Serveur d'Application WEBDEV en mode test, il suffit d'indiquer :

- soit son nom (ou son adresse IP) dans le champ correspondant de la fenêtre de description du projet (sous le volet "Projet", dans le groupe "Projet", cliquez sur "Description").

- soit l'URL complète du Webservice (pour faire usage du protocole HTTPS par exemple). 





### Utilisation d'un Serveur SaaS local
<a name="utilisation_serveur_saas_local_ELTPARAGRAPHE000279"></a>Pour utiliser un Serveur d'Application WEBDEV local en mode test, il suffit de ne pas spécifier d'adresse pour le serveur SaaS dans la description du projet. 
Pour lancer l'administrateur SaaS local, sous le volet "Outils", dans le groupe "Utilitaires Web", cliquez sur "WDAdminSaaS".


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WW_SiteClientSAAS.gif) ***Exemples didactiques (WEBDEV)*** : **WW_SiteClientSAAS** <br>L'exemple "WW_SiteClientSAAS" est un exemple d'utilisation des fonctions d'administration SaaS de WEBDEV.<br><br>Cet exemple se présente sous forme d'un site de vente de solutions SaaS. <br>Pour utiliser cet exemple, un site SaaS doit être configuré tel que défini dans le code d'initialisation du projet.<br>L'internaute peut ainsi s'abonner à une ou plusieurs tarifications données d'un site SaaS sans faire appel à l'administrateur du serveur SaaS.


