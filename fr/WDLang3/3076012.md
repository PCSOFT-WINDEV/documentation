


## telComposeLigne (Fonction)

***En anglais : tapiLineDial***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Compose un numéro de téléphone pour une prise de ligne vocale, en choisissant le périphérique.

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Application PABX** : Dans le cadre d'une application PABX, chaque ligne apparaît comme un périphérique. Pour numéroter sur une ligne téléphonique, il faut donc à chaque fois :

1. Choisir la ligne téléphonique en cours (fonction [telPériphérique](../WDLang3/3076032.md)).

2. Numéroter (fonction [telCompose](../WDLang3/3076013.md)).


C'est ce que fait la fonction **telComposeLigne**.
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Récupère la liste des périphériques TAPI 
sListeTAPI est une chaîne = telListePériphérique() 
// Affiche la liste dans un champ Combo 
ListeAjoute(COMBO_TAPI, sListeTAPI) 
... 
// Sélectionne le périphérique TAPI 
SI telComposeLigne(COMBO_TAPI[COMBO_TAPI], SAI_NuméroTéléphone, "TestEtatLigne") <> 0 ALORS 
	Info("Cliquez sur OK pour raccrocher") 
	telRaccroche() 
FIN
```

```wl
PROCEDURE TestEtatLigne(ValeurEtatLigne est un entier) 
SELON ValeurEtatLigne 
	CAS telLigneOccupée: Message("La ligne est occupée") 
	CAS telLigneDecrochée: Message("OK, connecté") 
	CAS telLigneNumérote: Message("Numérotation en cours") 
	CAS telLigneTonalité: Message("Tonalité") 
	CAS telLigneRaccrochée: Message("Le correspondant a raccroché") 
	CAS telLigneAttendRéponse: Message("Recherche du correspondant") 
	CAS telLigneSonnerie: Message("Sonnerie chez le correspondant") 
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = telComposeLigne(<Ligne à utiliser> , <Numéro à composer> [, <Procédure WLangage> [, <Durée> [, <Paramètre personnalisé>]]])`
---

**`<Résultat> : (Entier)`**



- Identifiant de l'appel numéroté. 

- 0 en cas d'erreur. Le détail de l'erreur peut être connu avec la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Ligne à utiliser> : (Chaîne de caractères)`**

Ligne ou périphérique à utiliser. 

Rappel : La liste des périphériques de téléphonie est connue avec la fonction [telListePériphérique](../WDLang3/3076024.md).

**`<Numéro à composer> : (Chaîne de caractères)`**

Numéro de téléphone à composer.

**`<Procédure WLangage> : (Nom de procédure optionnelle)`**

Nom de la procédure WLangage permettant de gérer la progression de la numérotation. Cette procédure est du type :

```txt
PROCÉDURE <Nom de la procédure>(<Etat de la ligne>, <Paramètre>)
```

Le premier paramètre de la procédure (paramètre &lt;Etat de la ligne&gt;) est un entier qui peut prendre les valeurs suivantes : 


|   |   |
| --- | --- |
| *telLigneAttendRéponse* | L'appel est composé : recherche du correspondant. |
| *telLigneDécrochée* | La ligne est connectée. |
| *telLigneNumérote* | Numérotation en cours.<br><br>Remarque : Si la technologie TAPI 3.1 est utilisée, cette constante n'est plus renvoyée. |
| *telLigneOccupée* | La ligne est actuellement occupée. |
| *telLigneRaccrochée* | Le correspondant a raccroché. |
| *telLigneSonnerie* | Sonnerie en cours chez le correspondant. |
| *telLigneTonalité* | La ligne reçoit la tonalité. |

Le second paramètre de la procédure (paramètre &lt;Paramètre&gt;) est le paramètre personnalisé passé à la fonction **telComposeLigne**.

**Attention** : cette procédure ne doit pas contenir d'appel au débogueur (ni point d'arrêt, ni mot-clé STOP, ni expression auto-stop, ...).

**`<Durée> : (Entier optionnel ou Durée optionnelle)`**

Durée maximale d'attente (en secondes). Au delà de cette durée, la fonction considère qu'il n'y a pas de réponse (personne ne décroche). Ce paramètre peut correspondre à : 

- un entier correspondant au nombre de secondes, 

- une variable de type Durée, 

- l'indication directe de la durée (par exemple 1 s ou 10 ms). 


Par défaut, ce paramètre correspond à 15 secondes. 

**`<Paramètre personnalisé> : (Tout type, optionnel)`**

Paramètre passé à la procédure WLangage.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Différences entre la fonction telCompose et telComposeLigne
<a name="differences_entre_fonction_telcompose_telcomposeligne_ELTPARAGRAPHE000122"></a>

- La fonction [telCompose](../WDLang3/3076013.md) s'utilise dans un contexte d'un seul appel sortant. L'identifiant de cet appel n'est pas disponible.

- La fonction **telComposeLigne** s'utilise dans un contexte où il peut y avoir plusieurs appels simultanés. La fonction **telComposeLigne** renvoie l'identifiant de l'appel. On peut ainsi le manipuler simplement (par exemple, pour effectuer un transfert d'appel).



<a name="NOTE0_2"></a>


### Limitation
<a name="limitation_ELTPARAGRAPHE000139"></a>Il n'est pas possible d'appeler la fonction **telComposeLigne** dans la procédure de détection d'appel (définie grâce à la fonction [telDémarreDétectionAppel](../WDLang3/3076029.md)).
<a name="NOTE0_3"></a>


### Configuration nécessaire
<a name="configuration_necessaire_ELTPARAGRAPHE000285"></a>Les fonctions de téléphonie utilisent la technologie TAPI 2.0 et/ou la technologie TAPI 3.1. Ces technologies sont utilisables sur tous les systèmes.

<a name="XComposante"></a>

## Composante :
wd280com.dll
