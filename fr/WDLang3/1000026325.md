
## Intégrez la double authentification dans vos applications
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000117"></a>
En version 26, WINDEV, WEBDEV et WINDEV Mobile permettent de mettre en place une connexion par double authentification.
Cette double authentification peut être mise en place à travers une application standard (à choisir entre Google Authenticator, Microsoft Authenticator ou autre). Cette application, à télécharger sur un mobile, renvoie à la demande un code personnel (valable 30 secondes) à saisir lors du login (protocole TOTP).

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Comment le faire
<a name="comment_faire_ELTTEXTE000141"></a>


### Principe
<a name="principe_ELTPARAGRAPHE000018"></a>Le principe est le suivant : 

- L'application ou le site qui propose la double authentification nécessite pour se connecter : 

	- le couple d'identifiant login / mot de passe

	- un identifiant spécifique, généré par une application d'authentification installée sur le téléphone portable. 




- A la première connexion avec double authentification, l'application ou le site génère un code (affichage possible sous forme de QRCode). Ce code est une clé TOTP qui doit être mémorisée : ce QRCode (ou le code correspondant) doit être enregistré dans l'application d'authentification sur le téléphone. L'application d'authentification fournit à l'utilisateur un code d'authentification qui doit être utilisé dans l'application ou le site pour valider la connexion. 

- Lors des prochaines connexions, l'utilisateur devra fournir à chaque fois le code d'identification fournit par l'application d'authentification. Ce code est modifié à chaque connexion et est valable pour un laps de temps défini. 





### Mise en place
<a name="mise_place_ELTPARAGRAPHE000030"></a>Pour mettre en place la double authentification dans une application, prévoyez : 

- une interface pour la première authentification afin de d'afficher le code et/ou le QRCode nécessaire à l'application d'authentification. Il faut : 

	- générer la clé TOTP (fonction [DoubleAuthGénèreCléTOTP](../WDLang3/1000025974.md)). Cette clé doit être enregistrée dans l'application, pour l'utilisateur. 

	- afficher le code-barres nécessaire à l'enregistrement de l'application/site dans l'application mobile d'authentification (fonction [DoubleAuthGénèreLien](../WDLang3/1000025975.md)). 
			Remarque : Cette étape n'est pas obligatoire. Il est également possible de fournir directement la clé TOTP à l'utilisateur pour qu'il la saisisse dans l'application mobile d'authentification. 


 Exemple de code : 
	
	```wl
	// Identifiant unique de l'utilisateur
	sAdresse est une chaîne = Client.IDClient + "monadresse@masociete.com"
	// Génération de la clé TOTP
	sCléAppliMobile est une chaîne ANSI = DoubleAuthGénèreCléTOTP(sAdresse)
	// Affichage de la clé TOTP dans un code-barres
	CBA_QR_Autentificator = DoubleAuthGénèreLien(sCléAppliMobile, ...
		sAdresse, "Mon Appli")
	```


- une interface permettant à l'utilisateur de saisir son code d'authentification fourni par l'application d'authentification. Cette interface comprendra : 

	- un champ de saisie à 6 chiffres. 
			Attention, le champ doit être de type texte, car la séquence de 6 chiffres peut commencer par un zéro. Il est également courant d'avoir 6 champs pour saisir chaque chiffre, les champs sont alors en "Fin de saisie automatique" (option disponible dans le volet "Détail" de la fenêtre de description des champs).

	- un champ Bouton par exemple, permettant de vérifier le code fourni avec la fonction [DoubleAuthVérifieCode](../WDLang3/1000025976.md). Voici un exemple de code : 
			
		```wl
		sAdresse est une chaîne = Client.IDClient + "monadresse@masociete.com"
		sCléAppliMobile est une chaîne ANSI = DoubleAuthGénèreCléTOTP(sAdresse) // Ou clé mémorisée
		SI DoubleAuthVérifieCode(SAI_Code, sCléAppliMobile) ALORS ...
		```










<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Fonctions WLangage de gestion de la double authentification
<a name="fonctions_wlangage_gestion_double_authentification_ELTTEXTE000171"></a>
Les fonctions WLangage de gestion de la double authentification sont les suivantes : 



|   |   |
| --- | --- |
| [DoubleAuthGénèreCléTOTP](../WDLang3/1000025974.md) | Génère une clé TOTP pour un utilisateur dans une application. |
| [DoubleAuthGénèreLien](../WDLang3/1000025975.md) | Génère un lien pour enregistrer un compte dans une application d'authentification. Affecté à un champ Code-barres, ce lien permettra d'afficher un QRCode pouvant être scanné dans l'application d'authentification choisie sur le téléphone. |
| [DoubleAuthVérifieCode](../WDLang3/1000025976.md) | Vérifie le code donné par une application d'authentification. |






- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDDoubleAuthentification.gif) ***Exemples didactiques (WINDEV)*** : **WD Double Authentification** <br>Cet exemple montre comment utiliser la double authentification afin de sécuriser l'accès à des comptes utilisateurs.<br>Il utilise une double authentification TOTP qui génère un code à 6 chiffres toutes les 30 secondes.<br><br>Le code est généré par n'importe quel Authenticator qui gère le protocole TOTP (Google, Microsoft, ...)
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WW_Double_Authentification.gif) ***Exemples didactiques (WEBDEV)*** : **WW_Double_Authentification** <br>Cet exemple montre comment utiliser la double authenfication afin de sécuriser l'accès à des comptes utilisateurs.<br>Il utilise une double authentification TOTP qui génère un code à 6 chiffres toutes les 30 secondes.<br>Le code est généré par n'importe quel Authenticator qui gère le protocole TOTP (Google, Microsoft, ...)


