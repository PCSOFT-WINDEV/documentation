


## Gestion de MQTT (syntaxe préfixée)
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000068"></a>
MQTT est un protocole de messagerie de type "publish-subscribe" basé sur le protocole TCP/IP. Depuis la version 3.1.1, MQTT est un standard OASIS. 

Dans MQTT, deux éléments sont présents : 

- le client, qui publie et peut souscrire à des messages.  

- le broker ("serveur") qui reçoit les publications des clients, les traite et les envoie aux clients y ayant souscrits. 




Il existe de nombreux brokers MQTT (ActiveMQ, JoramMQ, OW2 JORAM, Mosquitto, RabbitMQ) mais aussi des serveurs d'iOT offrant une compatibilité avec MQTT (Amazon iOT, Azure iOT, ...).

WINDEV, WEBDEV et WINDEV Mobile permettent de gérer un client MQTT : il est possible de publier et de s'abonner aux publications.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Mise en place
<a name="mise_place_ELTTEXTE000111"></a>


### Comment le faire ?
<a name="comment_faire_ELTPARAGRAPHE000134"></a>Pour mettre en place une gestion d'un client MQTT : 

1. Définissez une variable de type [mqttSession](../WDLang3/1000023023.md) correspondant aux informations nécessaires à la connexion au broker MQTT.

2. Connectez-vous au broker (fonction [&lt;Variable mqttSession&gt;.Connecte](../WDLang3/1000023084.md)).  

3. Vous pouvez : 

	- Publier un message (fonction [&lt;Variable mqttSession&gt;.Publie](../WDLang3/1000023091.md)). Dans ce cas, il est nécessaire de définir : 

		- le sujet, 

		- la qualité de service (voir ci-dessous), 

		- le message (n'excédant pas 256 Mo),

		- si le message doit être conservé ou non sur le serveur. 




- Vous abonner à un message (fonction [&lt;Variable mqttSession&gt;.Abonne](../WDLang3/1000023083.md)). 

- Vous désabonner (fonctions [&lt;Variable mqttSession&gt;.Désabonne](../WDLang3/1000023086.md), [&lt;Variable mqttSession&gt;.DésabonneTout](../WDLang3/1000023090.md))

4. Déconnectez-vous (fonction [&lt;Variable mqttSession&gt;.Déconnecte](../WDLang3/1000023085.md)).





### Qualité de service (QoS)
<a name="qualite_service_qos_ELTPARAGRAPHE000191"></a>Lors de la publication d'un message, le client définit la qualité souhaitée : 

- Message de QoS niveau 0 "At most once" : Le message sera délivré tout au plus une fois. Le message n'est pas stocké. Il est envoyé sans garantie de réception. Le serveur MQTT (broker) n'informe pas l'expéditeur qu'il a reçu le message. Le message peut être perdu si le client se déconnecte ou si le serveur s'arrête.

- Message de QoS niveau 1 "At least once" :  Le message sera délivré au moins une fois. Le client transmettra le message plusieurs fois s'il le faut jusqu'à ce que le serveur (Broker) lui confirme que le message a été transmis sur le réseau.

- Message de QoS niveau 2 "Exactly once" :  Le message sera obligatoirement sauvegardé par l'émetteur. Il sera transmis tant que le récepteur ne confirme pas son envoi sur le réseau. L'émetteur utilise une phase de reconnaissance sophistiquée avec le serveur (broker) pour éviter une duplication des messages. Ce mode est plus lent mais plus sûr.





