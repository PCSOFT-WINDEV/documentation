


## TâcheEnArrièrePlanAjoute (Fonction)

***En anglais : BackgroundTaskAdd***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Ajoute une nouvelle tâche en arrière-plan. Cette tâche sera exécutée périodiquement lorsque l'application est arrêtée ou lorsque l'application est en arrière-plan.
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Demande le traitement des emails reçus une fois par jour
TâcheEnArrièrePlanAjoute(ProcTraitementEmailEnArrièrePlan, 24*60)
```

```wl
PROCEDURE ProcTraitementEmailEnArrièrePlan()
// Traitement des emails en attente
n est un entier = TraiteEmailRecus()	
SI n > 0 ALORS
	// Notifie l'utilisateur 
	notif est une Notification
	notif.Titre = "Traitement des emails terminés"
	notif.Message = ChaineConstruit("%1 emails ont été traités", n)
	NotifAjoute(notif)
FIN
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = TâcheEnArrièrePlanAjoute(<Procédure WLangage> [, <Intervalle de temps>])`
---

**`<Résultat> : (Entier)`**



- Identifiant de la tâche ajoutée, 

- 0 en cas d'erreur. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Procédure WLangage> : (Nom de procédure)`**

Procédure WLangage (également nommée "callback") appelée lors de l'exécution de la tâche.
Cette procédure doit être une procédure globale du projet et ne doit attendre aucun paramètre. Dans le cas contraire, une erreur fatale sera déclenchée lors de l'appel de la fonction **TâcheEnArrièrePlanAjoute**.

**`<Intervalle de temps> : (Entier optionnel)`**

Intervalle de temps minimum (exprimé en minutes) entre deux exécutions de la tâche. Permet de garantir que la tâche ne sera pas exécutée durant cet intervalle de temps. En revanche, le système peut augmenter l'intervalle de temps en fonction de différents facteurs (charge d'utilisation importante, batterie faible, ...). L'intervalle de temps réel peut donc varier et être relativement long (plusieurs heures).
Par défaut : 

- l'intervalle de temps entre deux exécutions de la tâche est de 1 heure. 

- l'intervalle de temps minimum autorisé est de 15 minutes.


Ce paramètre peut correspondre à : 

- un entier correspondant au nombre de minutes, 

- une variable de type Durée, 

- l'indication directe de la durée (par exemple '20min'). 






<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Fonctionnement
<a name="fonctionnement_ELTPARAGRAPHE000060"></a>Une fois ajoutée, la tâche en arrière-plan est automatiquement exécutée par le système à intervalle régulier. 

La tâche est persistante, elle continuera à être exécutée périodiquement lorsque l'application est arrêtée, même après redémarrage de l'appareil. 

Si la tâche est déclenchée alors que l'application n'est pas lancée, l'application sera lancée en arrière-plan (sans ouvrir la première fenêtre du projet), les traitements d'initialisation du projet et de déclaration des classes et collections de procédures seront exécutés avant d'appeler la procédure associée à la tâche. 

La tâche sera exécutée uniquement lorsque l'application n'est pas lancée ou lorsque l'application est en arrière-plan. Si l'application se trouve au premier plan, son exécution sera reportée.

La tâche pouvant être exécutée dans un thread secondaire de l'application, le code de la procédure WLangage ne doit donc contenir aucun accès à l'UI de l'application ni aucune ouverture de boites de dialogue (via les fonctions [Info](../WDLang1/3021011.md), [Erreur](../WDLang1/3021013.md), etc.). Si la tâche doit interagir avec l'utilisateur, il est possible d'utiliser les notifications ([fonctions Notifxxx](../WDLang3/1000019476.md)).
<a name="NOTE0_2"></a>


### Manipulation des tâches en arrière-plan
<a name="manipulation_des_taches_arriereplan_ELTPARAGRAPHE000086"></a>

- Pour supprimer une tâche ajoutée avec la fonction **TâcheEnArrièrePlanAjoute**, utilisez la fonction [TâcheEnArrièrePlanSupprime](../WDLang3/1000023455.md).

- Pour lister les tâches en arrière-plan ajoutées, utilisez la fonction [TâcheEnArrièrePlanListe](../WDLang3/1000023456.md).

- La fonction [EnModeArrièrePlan](../WDLang1/1000023457.md) permet de savoir si une procédure est exécutée en mode "arrière-plan" ou non. 




- Il est possible demander depuis l'éditeur à ce qu'une procédure soit exécuté en tant que tâche en arrière-plan en activant l'option correspondante depuis la fenêtre de paramétrage des automatismes de la procédure. La tâche sera automatiquement ajoutée au prochain lancement de l'application : dans ce cas, il n'est pas nécessaire d'appeler la fonction **TâcheEnArrièrePlanAjoute**.



<a name="NOTE0_3"></a>
<a name="NOTE0_4"></a>

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280android.jar
