


## inAppListeAchat (Fonction)

***En anglais : inAppListPurchase***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Renvoie la liste : 

- des produits de l'application achetés par l'utilisateur et non consommés.

- des abonnements actifs de l'utilisateur.





<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Récupération de la liste des achats de l'utilisateur 
inAppListeAchat(ListeAchat, inAppIdentifiantAchat)
```

```wl
PROCEDURE ListeAchat(bSuccès est un booléen, sListeAchat est une chaîne)
	SI PAS bSuccès ALORS
		ToastAffiche(ErreurInfo())
	SINON
		// Parcours les achats effectués
		POUR TOUTE CHAINE sInfoAchat DE sListeAchat SEPAREE PAR RC
			// Récupère l'identifiant du produit
			sIDProduit est une chaîne = ExtraitChaine(sInfoAchat, 1, TAB)
			// Récupère l'identifiant de l'achat
			sIDAchat est une chaîne = ExtraitChaine(sInfoAchat, 2, TAB)
			// Consomme le produit si nécessaire
			SI sIDProduit = "ID_PRODUIT" ALORS
				inAppConsommeProduit(sIDProduit, ConsommationProduit)	
			FIN
		FIN
	FIN
FIN
```

```wl
PROCEDURE ConsommationProduit(nSuccès est un booléen)
	SI PAS bSuccès ALORS
		ToastAffiche(ErreurInfo())
	SINON
		// Consommation du produit dans l'application
		...
	FIN
FIN
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = inAppListeAchat(<Procédure> [, <Type information>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la demande de récupération de la liste des achats a été effectuée, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Procédure> : (Chaîne de caractères)`**

Nom de la procédure WLangage (également nommée "callback") exécutée lors de la réception de la liste des achats effectués. Cette procédure est de la forme : 

```txt
PROCEDURE <NomProcédure>(<Succès> est un booléen, <ListeAchat> est une chaîne)
```
où : 

- &lt;Succès&gt; est un booléen : 

	- <u><u><u><u>Vrai</u></u></u></u> si la liste des achats effectués par l'utilisateur a pu être récupérée, 

	- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour récupérer le détail de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avant tout autre appel à une fonction WLangage (ce qui réinitialiserait l'erreur).




- &lt;ListeAchat&gt; est une chaîne de caractères contenant les informations sur chacun des achats effectués par l'utilisateur. Les informations retournées pour chaque achat sont de la forme (selon les informations demandées) : 
	
	```txt
	<Identifiant du produit> + TAB + <Numéro de commande> + TAB + <Date d'achat> + 
	TAB + <Identifiant de l'achat> + TAB + <Renouvellement automatique> + TAB +
	<Date de fin d'abonnement>
	```



Si plusieurs achats sont listés, ils sont séparés par des Retours Chariot (RC).

**`<Type information> : (Constante optionnelle de type Entier)`**

Informations supplémentaire à retourner pour chaque achat listé (en plus de l'identifiant du produit) : 


|   |   |
| --- | --- |
| *inAppDateAchat* | Date d'achat au format AAAAMMJJ.<br><br>Dans le cas d'un abonnement : date de souscription de l'abonnement. |
| *inAppDateFinAbonnement* | Date de fin d'abonnement au format AAAAMMJJ.<br><br> |
| *inAppIdentifiantAchat* | Identifiant de l'achat. <br><br><br><br> |
| *inAppNuméroCommande* | Numéro de la commande correspondant à l'achat. |
| *inAppRenouvellementAuto* | <br><br>- 1 si l'abonnement sera automatiquement renouvelé à la prochaine date de facturation. <br><br>- 0 si l'utilisateur a annulé son abonnement ou si l'achat ne correspond pas à un abonnement. <br><br><br> |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Cas particuliers
<a name="cas_particuliers_ELTPARAGRAPHE000139"></a>

- La fonction **inAppListeAchat** sera sans effet si elle est exécutée depuis le simulateur ou l'émulateur.



<a name="NOTE0_2"></a>


### Gestion des abonnements
<a name="gestion_des_abonnements_ELTPARAGRAPHE000170"></a>

<a name="XComposante"></a>

## Composante :
wd280android.aar
