
## emailSessionSMTP (Type de variable)

***En anglais : emailSMTPSession***
				



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Le type **emailSessionSMTP** permet d'accéder à un serveur de messagerie en utilisant le protocole SMTP (Simple Mail Transfer Protocol) afin d'envoyer des messages électroniques. Les caractéristiques de la connexion peuvent être définies et modifiées à l'aide de différentes propriétés WLangage.

**Remarques** :

- Pour plus de détails sur la déclaration de ce type de variable et l'utilisation des propriétés WLangage, consultez [Déclaration d'une variable](../Motscles/1514032.md).

- Le serveur SMTP à utiliser est en général le serveur SMTP du fournisseur d'accès à Internet (et non pas celui du compte email). Par exemple, si vous avez un accès Internet Orange et un compte email Free, il faut utiliser le serveur SMTP de Orange et non pas celui de Free. Pour utiliser un serveur SMTP différent, il faut en général utiliser un serveur SMTP authentifié, serveur qui demande la plupart du temps une connexion sécurisée.







<a name="XExemple1"></a>
<a name="sample_code"></a>

## Exemple

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 
```wl
// Connexion avec authentification 
// Session SMTP sécurisée TLS
MaSessionSMTP est un emailSessionSMTP
OAuthCnxGoogle est un OAuth2Paramètres

// Paramètres de connexion OAuth
OAuthCnxGoogle.ClientID = "ID de l'application"
OAuthCnxGoogle.ClientSecret = "ID secret de l'application"
OAuthCnxGoogle.URLAuth = "https://accounts.google.com/o/oauth2/auth"
OAuthCnxGoogle.URLToken = "https://accounts.google.com/o/oauth2/token"
OAuthCnxGoogle.Scope = "https://mail.google.com/"
OAuthCnxGoogle.URLRedirection = "http://localhost:9000"
OAuthCnxGoogle.TypeRéponse = oauth2TypeRéponseCode

// Identification OAuth
MaSessionSMTP.AdresseServeur = "smtp.gmail.com"
MaSessionSMTP.Nom = "utilisateur@gmail.com"
MaSessionSMTP.MotDePasse = "secret"
MaSessionSMTP.Port = 587
MaSessionSMTP.Option = emailOptionSécuriséTLS
MaSessionSMTP.AuthToken = AuthIdentifie(OAuthCnxGoogle)

// Si l'identification a réussi, il faut se connecter à la boîte email
SI MaSessionSMTP.AuthToken <> Null ALORS
	SI EmailOuvreSession(MaSessionSMTP) = Faux ALORS
		// Erreur d'ouverture de session
		Erreur("Impossible d'ouvrir la session SMTP.", ErreurInfo(), ...
			"En cas de TimeOut, assurez-vous des paramètres du " + ...
			"""Pare-Feu"" sur le port utilisé (" + ...
			MaSessionSMTP.Port + ")")
		RETOUR
	FIN
	// Envoi d'un message
	MonEmail est un Email
	...
	EmailEnvoieMessage(MaSessionSMTP, MonEmail)
	...
	EmailFermeSession(MaSessionSMTP)
SINON
	// Erreur d'authentification
FIN
```

<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Propriétés spécifiques à la description des variables de type emailSessionSMTP
<a name="proprietes_specifiques_description_des_variables_type_emailsessionsmtp_ELTPARAGRAPHE000058"></a>Les propriétés suivantes peuvent être utilisées pour manipuler une variable de type **emailSessionSMTP** :

| Nom de la propriété | Type manipulé | Effet |
| --- | --- | --- |
| AdresseServeur | Chaîne de caractères | Nom DNS ou adresse IP du serveur d'emails (protocole sortant). Cette adresse est fournie par le fournisseur de services ou par l'administrateur réseau.<br><br>**Attention** : Il est nécessaire d'utiliser le serveur SMTP du fournisseur de la connexion Internet. Ce serveur SMTP peut n'avoir aucun lien avec le serveur SMTP associé au compte email. |
| Asynchrone | Booléen ou constante de type Entier | <br><br>- *emailAsynchrone* (ou <u><u><u><u>Vrai</u></u></u></u>) si les emails envoyés lors de la session ouverte avec la fonction [EmailOuvreSessionSMTP](../WDLang3/3032025.md) doivent être transmis en mode asynchrone.<br><br>- *emailSynchrone* (ou <u><u><u><u>Faux</u></u></u></u>) dans le cas contraire (valeur par défaut).<br><br><br><br><br><br><br><br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Cette propriété n'est pas disponible : l'envoi est toujours synchrone. |
| AuthToken | Variable de type [AuthToken](../WDLang3/1000022220.md) | Token d'accès au serveur d'emails à utiliser en cas d'authentification via le protocole OAuth 2.0 (double authentification). Ce token d'accès a été récupéré via la fonction [AuthIdentifie](../WDLang3/1000022219.md).<br><br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Cette propriété n'est pas disponible. |
| MotDePasse | Chaîne de caractères | Mot de passe de l'utilisateur. Ce mot de passe est fourni par le fournisseur de services ou par l'administrateur réseau. Ce mot de passe permet d'ouvrir une session SMTP authentifiée. |
| Nom | Chaîne de caractères | Nom de l'utilisateur utilisé dans le cas des sessions SMTP authentifiées. |
| Option | Constante de type Entier | Options de la connexion SMTP. Les valeurs possibles sont :<br><br>- *emailOptionDéfaut* (valeur par défaut) : Ouverture d'une session SMTP non sécurisée. Dans ce cas, le port standard est le port 25.<br><br>- *emailOptionSécuriséTLS* : Ouverture d'une session SMTP sécurisée par le protocole TLS. Dans ce mode : <br><br>	- la connexion initiale est établie non chiffrée, puis une commande **STARTTLS** est envoyée pour commencer le chiffrement,<br><br>	- le port standard est le port 587.<br><br><br><br><br>- *optionSSL* : Ouverture d'une session SMTP sécurisée par le protocole TLS. Dans ce cas, le port standard est le port 465. <br><br><br><br><br>![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Cette propriété n'est pas gérée. |
| Port | Entier | Identifie le port utilisé pour le protocole SMTP (25 par défaut). |


<a name="NOTE0_3"></a>


### Fonctions utilisant les variables de type emailSessionSMTP
<a name="fonctions_utilisant_les_variables_type_emailsessionsmtp_ELTPARAGRAPHE000158"></a>


|   |   |
| --- | --- |
| [EmailEnvoieMessage](../WDLang3/3032005.md) | Envoie un email selon le protocole utilisé (SMTP, MS Exchange, Lotus Notes, Outlook). |
| [EmailFermeSession](../WDLang3/3032006.md) | Ferme une session de gestion des emails selon le mode choisi (SMTP/POP3, IMAP, MS Exchange ou Lotus Notes). |
| [EmailOuvreSession](../WDLang3/3032028.md) | Ouvre une session de gestion des emails en fonction du mode de gestion choisi (POP3, SMTP, IMAP ou MS Exchange). |










- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDMail.gif) ***Exemples complets (WINDEV)*** : **WD Mail** <br>Cette application est un client mail complet développé en WINDEV. Il s'appuie sur les objets Email.<br>Ce client mail permet de récupérer et d'envoyer des emails en utilisant les protocoles POP, IMAP et SMTP.<br>Il est possible d'appliquer des filtres sur le courrier entrant.<br>L'écriture d'un email s'appuie sur le champ Editeur HTML.<br>L'affichage des emails utilise le champ Affichage HTML.<br>L'application permet de gérer plusieurs comptes emails différents.


