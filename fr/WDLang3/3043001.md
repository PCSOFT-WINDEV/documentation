


## HTTPDonneRésultat (Fonction)

***En anglais : HTTPGetResult***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Récupère le résultat ou l'entête de la dernière requête HTTP lancée. Cette requête a été lancée par la fonction [HTTPRequête](../WDLang3/3043007.md) ou par la fonction [HTTPEnvoieFormulaire](../WDLang3/1000017190.md).


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003043001&name=httpdonneresultat_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
// Récupération des éléments de la page Web "www.pcsoft.fr"
ResLancement = HTTPRequête("http://www.pcsoft.fr")
SI ResLancement = Vrai ALORS
	ResCode est une chaîne = HTTPDonneRésultat()
	Info("Code HTML : " + ResCode)
	ResEntête est une chaîne = HTTPDonneRésultat(httpEntête)
	Info("Entête : " + ResEntête)
	ResCookie est une chaîne = HTTPDonneRésultat(httpCookie)
	Info("Cookie : " + ResCookie)
FIN
```
<a name="Exemple2"></a>

```wl
// Exemple de traitement d'erreur renvoyée par le serveur Web
Url est une chaîne 
Res_HTTP est une chaîne
ErreurHTTP est une chaîne
Url = "http://www.amazon.fr/s/ref=nb_ss?__mk_fr_FR=AMAZON&url" + ...
	"=search-alias=aps&field-keywords=2746049805"

// Envoi de la requête sur le serveur amazon
SI HTTPRequête(Url) ALORS
	// La requête a pu être envoyée, il s'agit d'une URL valide
	Res_HTTP = HTTPDonneRésultat()
	SI Taille(Res_HTTP) = 0 ALORS
		// Il y a eu une erreur du serveur Web, 
		// le détail de l'erreur est dans l'entête de la page
		ErreurHTTP = HTTPDonneRésultat(httpEntête)
		Erreur(ErreurHTTP)
	FIN
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = HTTPDonneRésultat([<Type d'information>])`
---

**`<Résultat> : (Buffer ou chaîne de caractères)`**



- Résultat de la dernière requête HTTP si la constante *httpRésultat* est spécifiée.

- En-tête de la dernière requête HTTP si la constante *httpEntête* est spécifiée.




**`<Type d'information> : (Constante optionnelle)`**

Type d'information à récupérer :


|   |   |
| --- | --- |
| *httpCookie* | Bloc des cookies (extrait à partir des entêtes HTTP).<br><br>![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Cette constante n'est pas disponible. |
| *httpEntête* | En-tête de la dernière requête HTTP. |
| *httpRésultat*<br>(Valeur par défaut) | Résultat de la dernière requête HTTP.<br><br>Attention : Dans ce cas, en Unicode, &lt;Résultat&gt; est un Buffer. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### En-tête de requête HTTP
<a name="entete_requete_http_ELTPARAGRAPHE000103"></a>Un entête de requête HTTP fournit diverses informations sur la requête HTTP (date, serveur utilisé, etc.).

Pour l'exécution de la requête HTTP suivante :

```wl
ResLancement = HTTPRequête("http://www.pcsoft.fr")
```
L'entête récupéré est :

```txt
HTTP/1.1 200 OK<\r><\n>
Date: Tue, 10 Jul 2001 13:19:08 GMT<\r><\n>
Server: Apache/1.3.11 (Unix) PHP/4.0.1<\r><\n>
Last-Modified: Thu, 04 Jan 2001 13:20:11 GMT<\r><\n>
ETag: "4107f-5f7b-3a54788b"<\r><\n>
Accept-Ranges: bytes<\r><\n>
Content-Length: 24443<\r><\n>
Connection: close<\r><\n>
Content-Type: image/gif<\r><\n><\r>
```

<a name="NOTE0_2"></a>


### Gestion des erreurs du serveur Web
<a name="gestion_des_erreurs_serveur_web_ELTPARAGRAPHE000115"></a>Certains serveurs Web retournent une erreur dans l'entête http. Par exemple, l'erreur peut correspondre à une notification de déplacement de page (rewriting d'url). Si le contenu de la page obtenue par **HTTPDonneRésultat** est vide, il faut consulter l'entête de la page. 

Exemple d'entête d'erreur lors d'un déplacement de page (rewriting d'url): 

```txt
HTTP/1.1 302 MovedTemporarily
Date: Wed, 30 Sep 2009 15:38:48 GMT
Server: Server
x-amz-id-1: 1KR8DDF5DV380D14DHTC
x-amz-id-2: pU0oo3rO/L+5kLNg4Yc4MPd0jF3qwyEI4nGaOhMgYkk=
Location: http://www.amazon.fr/WinDev-14-fondamentaux-d%C3%A9veloppement
-Pr%C3%A9sentation/dp/2746049805/ref=sr_11_1/277-8952281-8252733?ie=
UTF8&qid=1254325128&sr=11-1
Vary: Accept-Encoding,User-Agent
nnCoection: close
Content-Type: text/html; charset=ISO-8859-15
Set-cookie: session-id-time=1254866400l; path=/; domain=.amazon.fr; 
expires=Tue Oct 06 22:00:00 2009 GMT
Set-cookie: session-id=277-8952281-8252733; path=/; domain=.amazon.fr; 
expires=Tue Oct 06 22:00:00 2009 GMT
Content-Length: 0
```

<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Fonctionnement de HTTPRequête / HTTPDonneRésultat avec une destination
<a name="fonctionnement_httprequete_httpdonneresultat_avec_une_destination_ELTPARAGRAPHE000130"></a>Lorsqu'une destination fichier est précisée avec la fonction [HTTPDestination](../WDLang3/1000017094.md) :

- la fonction **HTTPDonneRésultat** utilisée avec la constante *httpRésultat* renvoie toujours une chaîne vide ("").

- la fonction **HTTPDonneRésultat** utilisée avec la constante *httpEntête* renvoie toujours l'entête de la réponse HTTP. Cet entête n'est pas enregistré dans le fichier destination : seules les données sont enregistrées.




Lorsque la requête est terminée, la destination est annulée et la fonction [HTTPRequête](../WDLang3/3043007.md) fonctionne normalement.
<a name="NOTE0_4"></a>


### Récupération
<a name="recuperation_ELTPARAGRAPHE000154"></a>La fonction **HTTPDonneRésultat** permet également de récupérer une image ou un document binaire (voir Exemple).
<a name="NOTE0_5"></a>
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) 

### Limites
<a name="limites_ELTPARAGRAPHE000166"></a>

- Le proxy utilisé est celui d'Internet Explorer. 

- Il n'est pas possible d'ignorer les certificats. 

- Le protocole renvoyé par la fonction **HTTPDonneRésultat** utilisé avec la constante *httpEntête* est toujours 1.1 (même si le serveur est 1.0). 




<a name="XComposante"></a>

## Composante :
wd280com.dll
