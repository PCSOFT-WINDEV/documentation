


## EmailLitMessage (Fonction)

***En anglais : EmailReadMessage***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Lit un email reçu :

- soit par le protocole POP3 OU IMAP : l'email est présent dans la boîte aux lettres sur le serveur de messagerie.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) soit par l'intermédiaire du logiciel de messagerie Lotus Notes ou Outlook : l'email reçu est présent sur le poste local dans la boîte de réception de Lotus Notes ou Outlook.


Cette fonction ne modifie pas la position courante.

Les différentes variables de la structure email (ou de la variable de type Email) sont remplies.

Si aucun email n'est trouvé, la variable Email.EnDehors est positionnée à <u><u><u>Vrai</u></u></u>.

**Rappel** : Avant de lire un email, il est nécessaire d'ouvrir une session avec la fonction [EmailOuvreSession](../WDLang3/3032028.md), [EmailOuvreSessionNotes](../WDLang3/3032121.md) ou [EmailOuvreSessionOutlook](../WDLang3/3032128.md).

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Seule la lecture par le protocole POP3 est disponible.






<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003032016&name=emaillitmessage_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
// Utilisation avec le protocole POP3 
I est un entier
nbMSG est un entier = EmailNbMessage(NomUser)
POUR I = 1 A nbMSG
	SI EmailLitMessage(NomUser, I) = Vrai ALORS
		SI Email.Endehors <> Vrai ALORS
			CL.NOM = Email.Expediteur
			CL.MESSAGE_TXT = Email.Message
			...
		SINON
			Info("Ce message a été supprimé")
		FIN
	FIN
FIN
```
<a name="Exemple2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 
```wl
// Utilisation avec le logiciel de messagerie Outlook 
// TABLE_TableEmail contient l'ensemble des emails reçus
// COL_Exp contient le nom de l'expéditeur (variable Email.Expéditeur)
// COL_Sujet contient le sujet de l'email (variable Email.Sujet)
// COL_ID contient l'identifiant de l'email (variable Email.ID)
// Lecture de l'email sélectionné dans le champ Table
EmailLitMessage(IDSession, COL_ID)
// Récupération du contenu de l'email
Info("Message de l'email : " + Email.Message)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Lire un email géré par le protocole POP3 ou IMAP

`<Résultat> = EmailLitMessage(<Session> [, <Email>] , <Numéro message>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le message a été lu. Dans ce cas, la structure email est automatiquement mise à jour.

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




La variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u> si aucun message n'a été trouvé (pas de mail).

**`<Session> : (Chaîne de caractères ou variable de type emailSessionPOP3 ou emailSessionIMAP)`**

Identifie la session d'un utilisateur. Correspond :

- au nom d'utilisateur utilisé pour ouvrir la session email (fonction [EmailOuvreSession](../WDLang3/3032028.md)).

- à une variable de type [emailSessionPOP3](../WDLang3/1000018759.md).

- à une variable de type [emailSessionIMAP](../WDLang3/1000018957.md).


![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Les variables de type [emailSessionPOP3](../WDLang3/1000018759.md) et [emailSessionIMAP](../WDLang3/1000018957.md) ne sont pas supportées.

**`<Email> : (Variable de type Email optionnelle)`**

Nom de la variable de type [Email](../WDLang3/1000018713.md) à initialiser avec le contenu du message.
![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre n'est pas disponibleSi ce paramètre n'est pas spécifié, la structure [Email](../WDLang3/3032029.md) est utilisée.

**`<Numéro message> : (Entier)`**



- Indice du message à lire en POP3 

- Identifiant (UID) du message en IMAP. 





<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Lire un email géré par l'intermédiaire de Lotus Notes ou Outlook

`<Résultat> = EmailLitMessage(<Session> [, <Email>] , <Identifiant message>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le message a été lu. Dans ce cas, la structure email est automatiquement mise à jour.

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




La variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u> si aucun message n'a été trouvé (pas de mail).

**`<Session> : (Entier ou variable de type emailSessionOutlook ou emailSessionNotes)`**

Identifiant de la session email en cours. Cet identifiant peut être :

- un entier renvoyé par la fonction [EmailOuvreSessionOutlook](../WDLang3/3032128.md) ou [OutlookOuvreSession](../WDLang3/3032123.md). Dans ce cas, le paramètre &lt;Email&gt; ne doit pas être spécifié. 

- une variable de type [emailSessionOutlook](../WDLang3/1000018767.md).

- une variable de type [emailSessionNotes](../WDLang3/1000018768.md).

- une variable de type [emailSessionIMAP](../WDLang3/1000018957.md).




**`<Email> : (Variable de type Email optionnelle)`**

Nom de la variable de type [Email](../WDLang3/1000018713.md) à initialiser avec le contenu du message.

Si ce paramètre n'est pas spécifié, la structure [Email](../WDLang3/3032029.md) est utilisée.

**`<Identifiant message> : (Chaîne de caractères)`**

Identifiant du message à lire. Cet identifiant est contenu dans la variable **Email.ID** lors de la lecture des emails.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Nombre de messages présents dans la boîte aux lettres (protocole POP3)
<a name="nombre_messages_presents_dans_boite_aux_lettres_protocole_pop3_ELTPARAGRAPHE000222"></a>Le nombre total des messages reçus est obtenu par la fonction [EmailNbMessage](../WDLang3/3032024.md).

Si, dans la même session d'emails, un message a été supprimé par la fonction [EmailSupprimeMessage](../WDLang3/3032027.md) :

- la fonction [EmailNbMessage](../WDLang3/3032024.md) renvoie le nombre de messages présents sur le serveur d'emails avant la suppression. 

- les numéros des messages supprimés ne sont pas ré-affectés.




Par exemple : Lors de la connexion, quatre messages sont sur le serveur. Ces messages sont numérotés de 1 à 4. Si le message 1 est supprimé :

- La fonction [EmailNbMessage](../WDLang3/3032024.md) renvoie 4.

- La lecture du message 1 avec la fonction **EmailLitMessage** est impossible : le message n'existe plus. La variable Email.EnDehors retourne <u><u><u><u>Vrai</u></u></u></u>. Seuls les messages 2, 3 et 4 existent.




Les numéros des messages sont ré-affectés lors de la prochaine connexion.
<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Nombre de messages présents dans la boîte aux lettres (messagerie Outlook)
<a name="nombre_messages_presents_dans_boite_aux_lettres_messagerie_outlook_ELTPARAGRAPHE000262"></a>Le nombre total des messages reçus est obtenu par la fonction [EmailNbMessage](../WDLang3/3032024.md).

Si, dans la même session d'emails, un message a été supprimé par la fonction [EmailSupprimeMessage](../WDLang3/3032027.md), la fonction [EmailNbMessage](../WDLang3/3032024.md) renvoie le nombre correct de messages présents dans le dossier des emails reçus.
<a name="NOTE0_4"></a>


### Les fichiers attachés
<a name="les_fichiers_attaches_ELTPARAGRAPHE000280"></a>Lors de la lecture d'un message, les fichiers attachés à ce message peuvent être copiés sur le disque local (ou sur le disque du serveur) grâce à la fonction [EmailSauveFichierAttaché](../WDLang3/3032020.md).

**Conseil** : Il est conseillé de sauvegarder les messages et leurs fichiers attachés sur le disque local (ou sur le disque du serveur) puis de les supprimer du serveur d'email. Cette opération permet :

- d'alléger la boîte aux lettres sur le serveur,

- d'améliorer et d'alléger les communications sur les serveurs POP3 : seuls les nouveaux messages seront lus sur le serveur.



<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Jauge de progression
<a name="jauge_progression_ELTPARAGRAPHE000297"></a>Pour suivre la progression de la réception de l'email, utilisez la fonction [EmailJauge](../WDLang3/3032017.md).
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Messagerie Outlook
<a name="messagerie_outlook_ELTPARAGRAPHE000452"></a>Les fonctions WLangage **EmailLitxxx** fonctionnent uniquement avec le fichier de données Outlook (.pst) par défaut. Les autres fichiers de données ne sont pas gérés.

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280com.dll
