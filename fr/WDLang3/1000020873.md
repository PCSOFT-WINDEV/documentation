


## inAppAchèteProduit (Fonction)

***En anglais : inAppPurchaseProduct***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Envoie : 

- une demande d'achat d'un produit "In-App" associé à l'application.

- une demande de souscription à un abonnement.




Remarque : La demande d'achat est asynchrone. Une procédure de type "Callback" est exécutée lors de lors de la réception de la réponse à la demande d'achat. 
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
MonProduit est un inAppProduit = tabProduit[nIndex]
inAppAchèteProduit(monProduit, ValideAchatProduit)
```

```wl
PROCEDURE ValideAchatProduit(bSuccès est un booléen, Produit est un inAppProduit, Reçu)

SI PAS bSuccès ALORS
	ToastAffiche(ErreurInfo())
	RETOUR
SINON
	// Cas Android
	SI EnModeAndroid() ALORS
		// Consommation du produit (optionnel)
		inAppConsommeProduit(Produit, Reçu, ConsommationProduit)
	FIN
	// Cas iOS
	SI EnModeiOS() ALORS
		// Activation du produit dans l'application
		ActiveProduit(Produit)
		// Mémorisation de l'achat dans les préférences de l'application
		SauveParamètre(Produit..Identifiant, 1)
	FIN
FIN
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>
<a name="SYNTAXE2"></a>

<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Caractéristiques de la procédure WLangage
<a name="caracteristiques_procedure_wlangage_ELTPARAGRAPHE000110"></a>La procédure &lt;Procédure WLangage&gt; doit être de la forme :

```txt
PROCEDURE <Nom de la procédure>(<Succès> est un booléen, <Produit> est un inAppProduit, 
		<Reçu>, <Quantité> est un entier)
```


où : 

- &lt;Succès&gt; est un booléen : 

	- <u><u><u><u>Vrai</u></u></u></u> si l'achat a été validé, 

	- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour récupérer le détail de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avant tout autre appel à une fonction WLangage (ce qui réinitialiserait l'erreur). La fonction [ErreurInfo](../WDLang1/3013008.md) utilisée avec la constante *errCode* permet d'obtenir un des codes d'erreur suivants : 
			


|   |   |
| --- | --- |
| *inAppAnnulation* | Achat annulé par l'utilisateur.<br><br> |
| *inAppErreurInconnue* | Erreur inconnue. |
| *inAppErreurSignature* | Erreur lors de la vérification de la signature des données reçue pour la validation de l'achat (problème de sécurité). |
| *inAppRéponseInvalide* | Réponse invalide. |

- &lt;Produit&gt; est une variable de type [inAppProduit](../WDLang3/1000020868.md) correspondant au produit ou à l'abonnement acheté.

- &lt;Reçu&gt;  : 




- &lt;Quantité&gt; est un entier correspondant à la quantité de produits achetée. 






<a name="NOTE0_2"></a>


### Cas particuliers
<a name="cas_particuliers_ELTPARAGRAPHE000192"></a>

- Si l'achat est valide, l'application doit fournir le contenu de l'achat à l'utilisateur.

- Si la fonction **inAppAchèteProduit** est utilisée pour souscrire un abonnement déjà actif pour l'utilisateur, cet abonnement est alors automatiquement prolongé de la période correspondante.



<a name="NOTE0_3"></a>

<a name="XComposante"></a>

## Composante :
wd280android.aar
