


## MQTTPublie (Fonction)

***En anglais : MQTTPublish***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Publie un message sur le broker MQTT. 


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
gMqttSession est une mqttSession
llRésultat est un entier
sSujet est une chaîne
bufContenu est un Buffer

gMqttSession.Adresse = "xxx.xx.xxx.xxx" // A remplir
gMqttSession.Port = 1883
gMqttSession.IDClient = "MonTest"
gMqttSession.SessionVide = Vrai

sSujet = "/SERVER"
bufContenu = "Test à partir de WINDEV"

SI PAS MQTTConnecte(gMqttSession) ALORS
	Erreur("Problème de connexion. '" + ErreurInfo() + "')")
FIN

llRésultat = MQTTPublie(gMqttSession, sSujet, bufContenu)
```

```wl
llRésultat est entier
sSujet = "/SERVER"
bufContenu = "Test à partir de WINDEV"
llRésultat = MQTTPublie(gMqttSession, sSujet, bufContenu, Vrai, ...
	mqttQualitéExactementUneFois,  PublicationMQTT)

PROCÉDURE INTERNE PublicationMQTT(pMqttSession est un mqttSession, NumMessage est un entier)
Trace("Publication" + " - NumMessage = " + NumMessage)
FIN
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = MQTTPublie(<Session MQTT> , <Sujet> , <Données> [, <A conserver> [, <Qualité de service> [, <Procédure>]]])`
---

**`<Résultat> : (Entier)`**



- Numéro du message publié (constantes *mqttQualitéExactementUneFois* et *mqttQualitéAuMoinsUneFois*). 

- 0 si la publication a réussi (constante *mqttQualitéAuPlusUneFois*). 

- -1 en cas d'erreur. 




**`<Session MQTT> : (Variable de type mqttSession)`**

Nom de la variable [mqttSession](../WDLang3/1000023023.md) correspondant à la session MQTT à manipuler. 

**`<Sujet> : (Chaîne de caractères)`**

Sujet du message.

**`<Données> : (Buffer)`**

Données à publier (ne doit pas excéder 256Mo). 

**`<A conserver> : (Booléen optionnel)`**



- <u><u><u><u>Vrai</u></u></u></u> si le message doit être conservé sur le serveur. 

- <u><u><u><u>Faux</u></u></u></u> (par défaut) dans le cas contraire.




**`<Qualité de service> : (Entier optionnel)`**

Qualité du service souhaitée : 



|   |   |
| --- | --- |
| *mqttQualitéAuMoinsUneFois* | Le message sera délivré au moins une fois. Le client transmettra le message plusieurs fois s'il le faut jusqu'à ce que le serveur (Broker) lui confirme que le message a été transmis sur le réseau.<br><br>Equivalent à un QOS de 1. |
| *mqttQualitéAuPlusUneFois* | Le message sera délivré tout au plus une fois. Le message n'est pas stocké. Il est envoyé sans garantie de réception. Le serveur MQTT (broker) n'informe pas l'expéditeur qu'il a reçu le message. Le message peut être perdu si le client se déconnecte ou si le serveur s'arrête. <br><br>Equivalent à un QOS de 0. |
| *mqttQualitéExactementUneFois* | Le message sera obligatoirement sauvegardé par l'émetteur. Il sera transmis tant que le récepteur ne confirme pas son envoi sur le réseau. L'émetteur utilise une phase de reconnaissance sophistiquée avec le serveur (broker) pour éviter une duplication des messages. Ce mode est plus lent mais plus sûr.<br><br>Equivalent à un QOS de 2. |



**`<Procédure> : (Nom de procédure optionnel)`**

Nom de la procédure WLangage (également nommée "callback") exécutée lorsque le message a été diffusé (cette procédure est appelée si les constantes *mqttQualitéExactementUneFois* et *mqttQualitéAuMoinsUneFois* sont utilisées). Cette procédure est de la forme :

```txt
PROCEDURE <Nom de la procédure>(<Session> est un mqttSession, 
<Num message> est un entier)
```
où : 

- &lt;Session&gt; correspond à une variable [mqttSession](../WDLang3/1000023023.md) contenant les caractéristiques de la session MQTT. 

- &lt;Num message&gt; correspond au numéro du message publié. 






<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280com.dll
