


## restRequête (Type de variable)

***En anglais : restRequest***
				



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Le type **restRequête** permet de définir toutes les caractéristiques avancées d'une requête REST. Les caractéristiques de cette requête REST peuvent être définies et modifiées à l'aide de différentes propriétés WLangage. 

**Remarque** : Pour plus de détails sur la déclaration de ce type de variable et l'utilisation des propriétés WLangage, consultez [Déclaration d'une variable](../Motscles/1514032.md).


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
cMaRequete est un restRequête
cMaRequete.URL = "http://www.pcsoft.fr"
cMaReponse est un restRéponse = RESTEnvoie(cMaRequete)
SI ErreurDétectée ALORS
	Erreur(ErreurInfo(errComplet))
SINON
	Info(cMaReponse.Contenu)
FIN
```

<a name="NOTE0"></a>

## Remarques
<a name="NOTE0_1"></a>


### Propriétés spécifiques à la description des variables de type restRequête
<a name="proprietes_specifiques_description_des_variables_type_restrequete_ELTPARAGRAPHE000042"></a>Les propriétés suivantes peuvent être utilisées pour manipuler une requête REST :

| Nom de la propriété | Type manipulé | Effet |
| --- | --- | --- |
| AgentUtilisateur | Chaîne de caractères | Identifie le client. Par défaut, la valeur est "PC SOFT Framework".<br><br>Le contenu de la réponse peut dépendre de l'agent utilisateur (par exemple, une requête effectuée à partir d'un Mobile peut nécessiter des pages différentes d'une requête effectuée avec un navigateur PC). Dans ce cas, consultez la documentation de l'agent utilisateur pour plus de détails.<br><br> |
| AuthToken | Variable de type [AuthToken](../WDLang3/1000022220.md) | Token d'accès à un Webservice à utiliser en cas d'authentification via le protocole OAuth 2.0. Ce token d'accès a été récupéré via la fonction [AuthIdentifie](../WDLang3/1000022219.md).<br><br>Le token d'accès est automatiquement passé au paramètre **access_token** directement sur l'URL. Si le paramètre doit être différent, construisez vous-même l'URL à exécuter.<br><br> |
| AvancementEnvoi | Variable de type [httpAvancement](../WDLang3/1000021222.md) | Notification de l'état d'avancement de l'envoi des données POST. |
| AvancementTéléchargement | Variable de type [httpAvancement](../WDLang3/1000021222.md) | Notification de l'état d'avancement de la réception des données. |
| CertificatClient | Chaîne de caractères ou buffer | Correspond : <br><br>- à une chaîne de caractères contenant un chemin d'accès au fichier .p12 contenant le certificat à joindre à la requête. Le chargement du certificat se fera automatiquement en prenant :<br><br>	- le certificat présent dans la bibliothèque de l'exécutable (si il a été intégré à l'application),<br><br>	- le certificat présent à l'emplacement spécifié sur disque (si le certificat n'a pas été intégré dans la bibliothèque de l'exécutable).<br><br><br><br><br>- à un buffer contenant le certificat (utilisation de la fonction [fChargeBuffer](../WDLang1/1000019410.md)).<br><br><br><br><br>Si cette propriété correspond à une chaîne vide (""), le certificat par défaut est réinitialisée à "&lt;Aucun&gt;". |
| CipherChoisi | Chaîne de caractères | Nom du cipher choisi pour la requête sécurisée. <br><br>**Cette propriété est disponible uniquement en lecture.** |
| ContentType | Chaîne de caractères | Type du contenu du message à envoyer au serveur. Cette propriété est prise en compte uniquement si la méthode d'envoi (propriété **Méthode**) le permet. <br><br>Par défaut, le type du message correspond à : "application/x-www-form-urlencoded".<br><br><br><br>Il est cependant possible de mettre n'importe quelle valeur, par exemple : "text/xml", "application/javascript", "application/json", "application/xml", "image/jpeg", ...<br><br><br><br>Pour envoyer des données brutes, qui seront lues en une seule fois par le serveur d'application WEBDEV, utilisez les types : <br><br>- "application/octet-stream".<br><br>- "text/xml".<br><br><br> |
| Contenu | Buffer | Message à envoyer au serveur. Cette propriété est prise en compte uniquement si la méthode d'envoi (propriété **Méthode**) le permet. <br><br>Le message à envoyer doit respecter le protocole HTTP utilisé. Par défaut, si cette propriété est précisée et non vide, la méthode utilisée est une requête POST sinon c'est une requête GET. |
|   | Booléen | Indique si la propriété **Contenu** doit correspondre au contenu brute :<br><br>- <u><u><u><u>Vrai</u></u></u></u> : la propriété **Contenu** correspond à un buffer.  Aucune modification n'est effectuée. <br><br>- <u><u><u><u>Faux</u></u></u></u> (Valeur par défaut) : le contenu est modifié par le navigateur. En particulier, le texte UTF-8 est automatiquement décodé. la propriété **Contenu** retourne le résultat sous forme d'une chaîne.<br><br><br> |
| DébitEnvoiMax | Entier | Vitesse maximale à utiliser pour l'envoi des données, exprimée en kilo-octets par seconde. Cette vitesse est donnée à titre indicatif.<br>0 (valeur par défaut) signifie que cette vitesse n'est pas limitée.<br><br> |
| DébitTéléchargementMax | Entier | Vitesse maximale à utiliser pour la réception des données, exprimée en kilo-octets par seconde. Cette vitesse est donnée à titre indicatif. <br>0 (valeur par défaut) signifie que cette vitesse n'est pas limitée.<br><br> |
| Destination | Chaîne de caractères | Chemin complet du fichier de sauvegarde du résultat de la requête.<br><br> |
| DuréeNonRéponse | Entier | Temps maximum d'attente de la réponse (exprimé en millisecondes). Cette propriété peut correspondre à : <br><br>- un entier correspondant au nombre de millisecondes, <br><br>- une variable de type Durée, <br><br>- l'indication directe de la durée (par exemple 1 s ou 10 ms). <br><br><br><br><br>Par défaut, cette propriété vaut 20 secondes. <br><br><br><br>Remarque : Le timeout défini avec la fonction [HTTPTimeOut](../WDLang3/3043008.md) n'a pas d'influence sur cette propriété.  <br><br><br><br> |
| Entête | Tableau associatif de chaînes de caractères | Ensemble clé/valeur des entêtes à envoyer.<br><br>Exemple d'utilisation de cette propriété : <br><br><pre><code>cMaRequête est un restRequête<br><br>cMaRequête.Entête["Authorization"] = ...<br>	" WSSE profile=""UsernameToken"""<br>cMaRequête.Entête["X-WSSE"] = ...<br>	"UsernameToken Username=blahblah "<br>cMaRequête.Entête["Cache-Control"] = " no-cache"</code></pre><br> |
| IgnoreErreur | Constante de type Entier | Spécifie les erreurs ignorées. Correspond à une constante ou une combinaison de constantes : <br><br>- *httpIgnoreCertificatInvalide* : Le certificat est ignoré.<br><br>- *httpIgnoreNomCertificatInvalide* : Le nom du site figurant dans le certificat est ignoré.<br><br>- *httpIgnoreCertificatExpiré* : La date du certificat est ignorée.<br><br>- *httpIgnoreRedirection* : La redirection vers une page est ignorée.<br><br>- *httpIgnoreRenvoiHTTP* : Le renvoi vers un serveur non sécurisé est autorisé.<br><br>- *httpIgnoreRenvoiHTTPS* : Le renvoi vers un serveur sécurisé est autorisé.<br><br><br><br><br><br><br><br><br> |
| Méthode | Constante de type Entier | Méthode HTTP utilisée : <br><br>- *httpCopy* : Méthode COPY (valeur 7). <br><br>- *httpDelete* : Méthode DELETE (valeur 4). <br><br>- *httpGet* : Méthode GET (valeur 1).<br><br>- *httpHead* : Méthode HEAD (valeur 5).<br><br>- *httpLock* : Méthode LOCK (valeur 12) (protocole WebDAV). <br><br>- *httpMkCol* : Méthode MKCOL (valeur 10) (protocole WebDAV).<br><br>- *httpMove* : Méthode MOVE (valeur 11) (protocole WebDAV).<br><br>- *httpPatch* : Méthode PATCH (valeur 6). <br><br>- *httpPost* : Méthode POST (valeur 2). <br><br>- *httpPropFind* : Méthode PROPFIND (valeur 8) (protocole WebDAV).<br><br>- *httpPropPatch* : Méthode PROPPATCH (valeur 9) (protocole WebDAV).<br><br>- *httpPut* : Méthode PUT (valeur 3). <br><br>- *httpUnlock* : Méthode UNLOCK (valeur 13) (protocole WebDAV).<br><br><br>Par défaut, si la propriété **Contenu** est non vide, la méthode *httpPost* est utilisée. Dans le cas contraire, la méthode *httpGet* est utilisée. |
| MotDePasse | Chaîne de caractères | Mot de passe associé au nom d'utilisateur (chaîne vide par défaut). Permet d'accéder à une page avec une URL protégée. **Attention** : Le mot de passe est transmis en clair sur Internet.<br><br>Remarque : En renseignant les propriétés **NomUtilisateur** et **MotDePasse**, le "Authorization:Basic" correspondant est automatiquement généré dans l'entête de la requête. |
| MotDePasseCertificatClient | Chaîne de caractères | Mot de passe associé au certificat client (chaîne vide par défaut). |
| ProcédureTrace | Procédure | Nom de la procédure WLangage permettant de connaître les entêtes et les données envoyées. Cette procédure est de la forme : <br><br><pre><code>PROCÉDURE <Nom procédure>(<TypeInfo> est entier, <br>	<Data> est un Buffer)</code></pre><br> où : <br><br>- &lt;TypeInfo&gt; est une constante de type Entier correspondant au type de données tracées : <br><br>	- *httpTraceDonnéeEnvoyée* : Données envoyées.<br><br>	- *httpTraceDonnéeRecue* : Données reçues. <br><br>	- *httpTraceEntêteEnvoyé* : Entête envoyé. <br><br>	- *httpTraceEntêteRecu* : Entête reçu. <br><br><br><br><br>- &lt;Data&gt; est un buffer contenant les informations. <br><br><br><br><br>Exemple de procédure : <br><pre><code>PROCÉDURE ProcTrace(nTypeInfo est entier, ...<br>		bufByData est un Buffer)<br>	SELON nTypeInfo<br>		CAS httpTraceEnteteEnvoye:<br>			Trace("Entete : ", ...<br>				UTF8VersChaîne(bufByData))<br>		CAS httpTraceDonneeEnvoyee:<br>			Trace("Donnees : ", ...<br>					bufByData)<br>		CAS httpTraceEntêteRecu:<br>			Trace("Entête reçu : ", ...<br>				UTF8VersChaîne(bufByData))<br>		CAS httpTraceDonnéeRecue:<br>			Trace("Données reçues : ", ...<br>					bufByData)<br>	FIN</code></pre><br><br><br><br><br> |
| TimeoutConnexion | Entier | Temps maximal d'attente pour la connexion exprimé en millisecondes (par défaut 20 secondes, soit 20000 millisecondes). Cette propriété peut correspondre à : <br><br>- un entier correspondant au nombre de millisecondes, <br><br>- une variable de type Durée, <br><br>- l'indication directe de la durée (par exemple '20s' ou '20000ms'). <br><br><br><br><br>Si à la fin de ce délai, la connexion n'a pas pu s'effectuer, il y a échec de la connexion (la fonction [RESTEnvoie](../WDLang3/1000021476.md) par exemple renverra une erreur, contenue dans la variable résultat de type [restRéponse](../WDLang3/1000021477.md)). <br><br><br><br> |
| URL | Chaîne de caractères | Adresse du serveur à contacter sous forme d'adresse URL.<br><br>Cette URL peut contenir :<br><br>- le numéro de port pour la connexion sur le serveur. <br>	La valeur par défaut est 80 en HTTP (correspond à un serveur de pages Web) et 443 en HTTPS. Pour spécifier un numéro de port, utilisez le format : "&lt;URL du serveur&gt;**:**&lt;N° du port&gt;". Par exemple : "http://www.pcsoft.fr:80".<br><br>- des paramètres supplémentaires. Ces paramètres peuvent permettre d'effectuer une recherche ou de remplir un formulaire. Par exemple, pour rechercher "pcsoft" sur "http://www.google.fr", l'URL à contacter sera : "http://www.google.fr/search?q=pcsoft". <br><br><br><br><br>**Remarques** :<br><br>- Pour spécifier à la fois le numéro de port et des paramètres supplémentaires, utilisez le format : "&lt;URL du serveur&gt;**:**&lt;N° du port&gt;/&lt;Paramètres supplémentaires&gt;".<br><br>- Pour réaliser une transaction sécurisée, l'URL doit commencer par la chaîne "https://". Dans ce cas, le mode de gestion des requêtes est toujours effectué par Internet Explorer (pour plus de détails, consultez la fonction [HTTPParamètre](../WDLang3/1000018985.md)). <br><br><br> |
| Utilisateur | Chaîne de caractères | Nom permettant d'accéder à une page avec une URL protégée (chaîne vide par défaut). Ce nom permet d'identifier l'utilisateur.<br><br>Remarque : En renseignant les propriétés **NomUtilisateur** et **MotDePasse**, le "Authorization:Basic" correspondant est automatiquement généré dans l'entête de la requête. |
| VersionHTTP | Constante de type Entier | Version du protocole HTTP utilisée par le serveur : <br><br>- *httpVersion2* : Protocole HTTP version 2.0. Si le serveur ne gère pas cette version, une version plus ancienne est utilisée. <br><br>- *httpVersion2Uniquement* : Protocole HTTP version 2.0 forcée : si le serveur ne gère pas cette version, une erreur fatale est affichée. <br><br>- *httpVersion1_1* : Protocole HTTP version 1.1.<br><br>- *httpVersion1_0* : Protocole HTTP Version 1.0. <br><br>- *httpVersionDéfaut* : Protocole HTTP Version 1.0. <br><br><br> |
| VersionSSL | Constante de type Entier | Version SSL minimum et maximum à utiliser. <br><br>Pour limiter par exemple à TLS entre 1.1 et 1.3, il suffit d'indiquer la combinaison de constantes *ProtocoleTLS1_1* + *ProtocoleTLS1_3*<br><br>Les constantes utilisables sont les suivantes :  <br><br>- *ProtocoleDéfaut* : Protocole par défaut. C'est la version la plus élevée qui est proposée (ou une version inférieure si le serveur ne supporte pas ce protocole). <br><br>- *ProtocoleTLS1* : Protocole TLS1.<br><br>- *ProtocoleTLS1_1* : Protocole TLS1.1.<br><br>- *ProtocoleTLS1_2* : Protocole TLS1.2.<br><br>- *ProtocoleTLS1_3* : Protocole TLS1.3.<br><br><br> |
| VersionSSLChoisie | Constante de type Entier | Version SSL choisie pour une requête sécurisée : <br><br>- *ProtocoleDéfaut* : Protocole par défaut (TLS 1.2). <br><br>- *ProtocoleTLS1* : Protocole TLS1.<br><br>- *ProtocoleTLS1_1* : Protocole TLS1.1.<br><br>- *ProtocoleTLS1_2* : Protocole TLS1.2.<br><br>- *ProtocoleTLS1_3* : Protocole TLS1.3.<br><br><br><br><br>**Cette propriété est disponible uniquement en lecture.** |




<a name="NOTE0_2"></a>


### Gestion des redirections
<a name="gestion_des_redirections_ELTPARAGRAPHE000513"></a>Par défaut, les redirections sont gérées. Pour ne pas gérer les redirections, utilisez la constante *httpIgnoreRedirection* dans la propriété **IgnoreErreur**. 
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) 

### Cookies HTTP
<a name="cookies_http_ELTPARAGRAPHE000524"></a>Les cookies reçus en réponse à un appel de la fonction [RESTEnvoie](../WDLang3/1000021476.md) sont conservés dans l'attente d'un appel ultérieur à la fonction [RESTEnvoie](../WDLang3/1000021476.md) sur le même domaine : la variable de type **restRequête** est mise à jour.
Pour plus de détails, consultez la fonction  [HTTPCookieGère](../WDLang3/1000019218.md).


