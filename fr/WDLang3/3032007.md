
## Communiquez par emails
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000250"></a>
WINDEV, WEBDEV et WINDEV Mobile permettent de gérer directement les emails depuis vos applications. Envoi et réception d'emails sont simplifiés grâce à :

- [de nombreuses fonctions du WLangage](../WDLang3/3032034.md),

- plusieurs types avancés permettant de manipuler plusieurs connexions à des serveurs et un grand nombre de messages aisément :

	- Les types [Email](../WDLang3/1000018713.md) et [emailAttache](../WDLang3/1000018752.md) permettent de gérer les messages et leurs pièces jointes.
			Ces types de variables remplacent la [structure email](../WDLang3/3032029.md) conservée par compatibilité.

	- Les types [emailSessionPOP3](../WDLang3/1000018759.md), [emailSessionSMTP](../WDLang3/1000018765.md), [emailSessionNotes](../WDLang3/1000018768.md), [emailSessionOutlook](../WDLang3/1000018767.md) et [emailSessionIMAP](../WDLang3/1000018957.md) permettent de gérer les connexions aux serveurs de messagerie.







Remarque : Il est également possible de manipuler le contenu des emails sans les envoyer (fonctions [EmailConstruitSource](../WDLang3/1000017225.md) et [EmailImporteSouce](../WDLang3/1000017226.md)).



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## La gestion des emails
<a name="gestion_des_emails_ELTTEXTE000274"></a>
Plusieurs méthodes sont à votre disposition pour gérer les emails :

- Gestion via les protocoles POP3, IMAP et SMTP : 

	- **le protocole POP3** : ce ***protocole de réception des emails*** est reconnu par tous les fournisseurs de service. Ce protocole vous permet de dialoguer directement avec le serveur, disponible chez votre fournisseur d'accès. Ce protocole permet de lister les messages reçus et de les lire. 

	- **le protocole IMAP** : ce ***protocole de réception d'emails*** permet de laisser les emails sur le serveur dans le but de pouvoir les consulter de différents clients de messagerie ou webmail. De nombreuses caractéristiques associées aux emails peuvent être gérées. 

	- **le protocole SMTP** : ce protocole est un ***protocole d'envoi des emails*** reconnu par tous les fournisseurs de service. 







- Gestion via Lotus Notes, Outlook ou MS Exchange : 

	- **l'API "Simple Mail API (appelé aussi SMAPI ou Simple MAPI)"** : ce mode de gestion des emails est utilisé par la plupart des applications Microsoft et principalement le client MS Exchange.

	- **le logiciel de messagerie Lotus Notes ou Outlook** : grâce à ces logiciels, il est possible d'envoyer et de recevoir des emails.







**Remarques** :

- ![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Seuls les protocoles POP3 et SMTP sont disponibles.




- ![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Les connexions SSL ne sont pas gérées (cas d'un serveur POP3, SMTP ou IMAP sécurisé).




<a name="NOTE2B"></a>
<a name="NOTE2B_1"></a>


## La double authentification pour les emails
<a name="double_authentification_pour_les_emails_ELTTEXTE000298"></a>
De plus en plus de fournisseurs proposent l'utilisation de comptes email sécurisés (SMTP/IMAP) avec une double authentification.

Le principe est le suivant : 

- Connexion de type OAuth vers le fournisseur de la boîte mail : cette connexion fournit un token. 

- Utilisation du token qui devra être utilisé lors de la connexion aux boîtes IMAP ou SMTP.




Voici un exemple de code pouvant être utilisé :




```wl
// Exemple de connexion IMAP avec un compte Gmail
// et une double authentification
OAuthCnxGoogle est un OAuth2Paramètres
gMaSessionIMAP est un emailSessionIMAP

// Paramètres du serveur IMAP
gMaSessionIMAP.AdresseServeur = "imap.gmail.com"
gMaSessionIMAP.Option = optionSSL
gMaSessionIMAP.Port = "993"

// Paramètres de connexion OAuth
OAuthCnxGoogle.ClientID = "ID de l'application"
OAuthCnxGoogle.ClientSecret = "ID secret de l’application"
OAuthCnxGoogle.URLAuth = "https://accounts.google.com/o/oauth2/auth"
OAuthCnxGoogle.URLToken = "https://accounts.google.com/o/oauth2/token"
OAuthCnxGoogle.Scope = "https://mail.google.com/"
OAuthCnxGoogle.URLRedirection = "http://localhost:9000"
OAuthCnxGoogle.TypeRéponse = "code"

// Identification OAuth

gMaSessionIMAP.AuthToken = AuthIdentifie(OAuthCnxGoogle)

// Si l'identification a réussi, il faut se connecter à la boîte email.
SI gMaSessionIMAP.AuthToken <> Null ALORS
	SI EmailOuvreSession(gMaSessionIMAP) ALORS
	// Session ouverte
	SINON
	// Erreur d'ouverture de la session.
	FIN
SINON
	// Erreur d'authentification.
FIN
```


<a name="NOTE3"></a>
<a name="NOTE3_1"></a>





- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDMail.gif) ***Exemples complets (WINDEV)*** : **WD Mail** <br>Cette application est un client mail complet développé en WINDEV. Il s'appuie sur les objets Email.<br>Ce client mail permet de récupérer et d'envoyer des emails en utilisant les protocoles POP, IMAP et SMTP.<br>Il est possible d'appliquer des filtres sur le courrier entrant.<br>L'écriture d'un email s'appuie sur le champ Editeur HTML.<br>L'affichage des emails utilise le champ Affichage HTML.<br>L'application permet de gérer plusieurs comptes emails différents.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDMailingparemails.gif) ***Exemples didactiques (WINDEV)*** : **WD Mailing par emails** <br>Cet exemple illustre la possibilité d'envoyer un mailing par eMails avec WINDEV.<br>	<br>Cet exemple permet de saisir l'objet du message, son contenu et ses pièces jointes. <br>L'utilisateur doit ensuite sélectionner les clients auxquels le message doit être envoyé.<br>La fonction WLangage EMailEnvoieMessage() permet ensuite d'envoyer tout simplement le message saisi à chacun des clients sélectionnés.<br>Mise en œuvre technique :<br>Un serveur de mail compatible POP3/SMTP doit obligatoirement être accessible depuis le poste sur lequel s'exécute l'application.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Envoid'emails.gif) ***Exemples unitaires (WEBDEV)*** : **Envoi d'emails** <br>Envoi d'un email avec WEBDEV.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Envoid'unemailauformatHTML.gif) ***Exemples unitaires (WINDEV)*** : **Envoi d'un email au format HTML** <br>Utilisation de la fonction WLangage "EmailImporteHTML".<br>Cette fonction permet d'importer un fichier HTML directement dans la structure email. Cela permet notamment d'ajouter des images simplement dans des emails.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionsEmailPOP3.gif) ***Exemples unitaires (WINDEV)*** : **Les fonctions Email POP3** <br>Utilisation des fonctions Email pour gérer le protocole POP3.<br>Ce protocole sert à récupérer des emails depuis un serveur.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDJavaMail.gif) ***Exemples didactiques (WINDEV)*** : **WD JavaMail** <br>Cet exemple est un exemple Java permettant de de lire et envoyer des emails.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDProxyPOP3.gif) ***Exemples complets (WINDEV)*** : **WD ProxyPOP3** <br>Cet exemple présente un proxy POP3. Un proxy est un logiciel qui se connecte à un serveur à la place d'un autre.<br>On peut utiliser un proxy pour isoler un réseau local d'Internet dans un souci de sécurité par exemple.<br>Seule la machine abritant le proxy est reliée à Internet et les utilisateurs accèdent au serveur d'email à travers le proxy.<br>Dans l'exemple le proxy est utilisé pour archiver automatiquement dans une base HFSQL les emails récupérés.<br>De nombreuses extensions sont possibles pour cette application : filtrage automatique des spams, statistiques sur les emails...
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WW_CMS.gif) ***Exemples complets (WEBDEV)*** : **WW_CMS** <br>Cet exemple est un exemple de CMS (Content Management System).<br>C'est un site de gestion de contenu, typiquement un site d'affichage d'articles.<br><br>Cet exemple est découpé en 2 parties :<br>- Une partie AWP pour la partie qui doit être référencée<br>- Une partie WEBDEV Classique pour la partie administration<br><br>Note :<br>Pour que certaines fonctionnalités de l'exemple fonctionnent (l'envoi d'emails par exemple) il est nécessaire de modifier les paramètres afin de les adapter à votre configuration.<br>Ces paramètres sont stockés sous forme de constantes définies dans le code du projet.




