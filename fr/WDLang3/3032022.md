


## EmailOuvreSessionPOP3 (Fonction)

***En anglais : EmailStartPOP3Session***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Ouvre une session de réception et de lecture d'emails avec le protocole POP3. Il sera uniquement possible de lire des emails. Il est possible d'ouvrir une session POP3 sécurisée via SSL.

**Remarque** : Pour ouvrir une session d'envoi d'emails, utilisez la fonction [EmailOuvreSessionSMTP](../WDLang3/3032025.md).


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Lecture d'un email par le protocole POP3
SI EmailOuvreSessionPOP3(USER, PASSWORD, "pop3.fournisseur.fr") = Vrai ALORS 
	NomUser = USER
SINON
	NomUser = ""
	Erreur("Impossible d'établir la connexion")
FIN
```


<a name="Exemple2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Connexion à un serveur POP3 nécessitant une connexion SSL par exemple, gmail 
// 995 est le port standard pour ce type de service
EmailOuvreSessionPOP3(SAI_SESSION, SAI_PASS, SAI_POP, 995, optionSSL)

// Connexion à un serveur POP non sécurisé
EmailOuvreSessionPOP3(SAI_SESSION, SAI_PASS, SAI_POP, 110)
// 110 est le port standard pour ce type de service. 
// C'est aussi la valeur par défaut de la fonction, 
// On peut donc écrire plus simplement
EmailOuvreSessionPOP3(SAI_SESSION, SAI_PASS, SAI_POP)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = EmailOuvreSessionPOP3(<Nom utilisateur> , <Mot de passe> , <Adresse serveur POP3> [, <Numéro port POP3> [, <Option>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la session a été ouverte, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. En cas d'erreur, la variable [ErreurDétectée](../WDLang1/3087001.md) est à <u><u><u><u>Vrai</u></u></u></u>. 
	Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




**`<Nom utilisateur> : (Chaîne de caractères)`**

Identifie l'utilisateur. Ce nom est fourni par le fournisseur de services ou par l'administrateur réseau. Ce nom permettra d'identifier la session d'emails dans les différentes fonctions de gestion des emails.

**`<Mot de passe> : (Chaîne de caractères)`**

Mot de passe de l'utilisateur. Ce mot de passe est fourni par le fournisseur de services ou par l'administrateur réseau.

**`<Adresse serveur POP3> : (Chaîne de caractères)`**

Adresse IP du serveur d'emails (protocole entrant). Cette adresse IP est fournie par le fournisseur de services ou par l'administrateur réseau. Cette adresse IP peut être donnée sous la forme :

- Adresse IP au format XXX.XXX.XXX.XXX ( par exemple, 125.5.110.100).

- Adresse IP contenant le nom du serveur (par exemple, pop3.freesbee.fr). Cette syntaxe est conseillée.

- Adresse IP obtenue par la fonction [NetAdresseIP](../WDLang3/3056023.md).




**`<Numéro port POP3> : (Entier optionnel)`**

Identifie le port utilisé pour le protocole POP3 (110 par défaut).

**`<Option> : (Constante optionnelle de type Entier)`**

Permet d'indiquer si une connexion SSL est nécessaire :


|   |   |
| --- | --- |
| *optionSSL* | Connexion SSL nécessaire (cas d'un serveur POP3 sécurisé).<br><br>**Remarque** : le port généralement utilisé pour un serveur POP3 sécurisé est 995 (et non 110, valeur du port par défaut).<br><br>![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Constante non disponible. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Protocole POP3
<a name="protocole_pop3_ELTPARAGRAPHE000113"></a>

- Les différents paramètres passés à la fonction **EmailOuvreSessionPOP3** sont fournis par le fournisseur de services ou par l'administrateur réseau. Avant de pouvoir gérer les emails, il est nécessaire d'ouvrir une connexion Internet. Plusieurs cas peuvent se présenter :

	- L'utilisateur utilise un modem pour se connecter à Internet : la fonction [NetOuvreAccèsDistant](../WDLang3/3056026.md) permet d'ouvrir la connexion à Internet.

	- L'utilisateur utilise une connexion à Internet directe (cable ou ADSL) : aucune opération spécifique ne doit être faite.




- Le protocole POP3 permet uniquement de lire des messages emails. Si vous tentez d'envoyer des messages emails sans ouvrir une session SMTP (fonction [EmailOuvreSessionSMTP](../WDLang3/3032025.md)), une erreur du WLangage sera générée. 
	Pour ouvrir à la fois une session POP3 et une session SMTP, utilisez la fonction [EmailOuvreSession](../WDLang3/3032028.md).

- Les emails reçus sont ceux reçus lors de l'ouverture de la session. Tous les emails reçus après l'ouverture de la session ne sont pas accessibles. Pour accéder aux nouveaux emails reçus, il est nécessaire de fermer et de ré-ouvrir la session POP3.



<a name="NOTE0_2"></a>


### Session et nom d'utilisateur
<a name="session_nom_utilisateur_ELTPARAGRAPHE000139"></a>Après l'ouverture d'une session POP3, il est possible d'ouvrir une session SMTP (fonction [EmailOuvreSessionSMTP](../WDLang3/3032025.md)) en utilisant le même nom d'utilisateur.
<a name="NOTE0_3"></a>


### Délai de timeout
<a name="delai_timeout_ELTPARAGRAPHE000149"></a>Il est possible de paramétrer le délai de timeout avec la fonction [EmailChangeTimeOut](../WDLang3/3032001.md).
<a name="NOTE0_4"></a>
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) 

### Fonctionnalité d'application requise
<a name="fonctionnalite_application_requise_ELTPARAGRAPHE000163"></a>L'utilisation de cette fonction entraîne la déclaration d'une fonctionnalité d'application dans l'assistant de génération de l'application.

Fonctionnalité requise : Réseaux domestiques et professionnels

Cette fonctionnalité permet aux applications d'utiliser des accès entrants et sortants vers des réseaux domestiques et professionnels. 
<a name="NOTE0_5"></a>


### Gmail : Que faire si une connexion à Gmail (SMTP, IMAP, POP3) échoue avec une erreur de certificat ?
<a name="gmail_que_faire_une_connexion_gmail_smtp_imap_pop3_echoue_avec_une_erreur_certificat_ELTPARAGRAPHE000313"></a>Depuis fin août 2017, Google a déployé un nouveau certificat : Google Internet Authority G3. Malheureusement, l'API Windows utilisée pour la vérification des certificats ne valide pas ce certificat.

L'ouverture d'une session POP3, IMAP ou SMTP peut donc échouer avec le retour "La chaîne de certificats a été fournie par une autorité qui n'est pas approuvée".

Afin de permettre la validation du certificat, il est possible de modifier le mode de gestion des emails. La fonction WLangage [EmailParamètre](../WDLang3/1000022269.md) permet de changer ce mode et ainsi de ne plus utiliser l'API Windows qui bloque ce certificat. Voici le code à ajouter avant l'ouverture de la session par la fonction **EmailOuvreSessionPOP3** :

```wl
// Activation de l'implémentation multiplateforme
EmailParamètre(emailParamètreMode, 1)
```


Remarque : À partir de la version 23 Update 1, l'appel à la fonction [EmailParamètre](../WDLang3/1000022269.md) n'est plus nécessaire : le WLangage utilise automatiquement le mode de gestion des emails adapté à la session.


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionsEmailPOP3.gif) ***Exemples unitaires (WINDEV)*** : **Les fonctions Email POP3** <br>Utilisation des fonctions Email pour gérer le protocole POP3.<br>Ce protocole sert à récupérer des emails depuis un serveur.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDJavaMail.gif) ***Exemples didactiques (WINDEV)*** : **WD JavaMail** <br>Cet exemple est un exemple Java permettant de de lire et envoyer des emails.

<a name="XComposante"></a>

## Composante :
wd280com.dll
