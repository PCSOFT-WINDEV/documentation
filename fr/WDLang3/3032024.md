


## EmailNbMessage (Fonction)

***En anglais : EmailNbMessage***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Renvoie le nombre de messages reçus actuellement présents :

- sur le serveur d'emails (protocole POP3 et IMAP). 

	- Protocole POP3 : Ce nombre de messages reste constant durant toute la session d'emails, même si des nouveaux emails sont reçus ou si des emails sont supprimés avec la fonction [EmailSupprimeMessage](../WDLang3/3032027.md).

	- Protocole IMAP : Ce nombre de messages évolue en fonction des emails reçus ou réellement supprimés du serveur d'emails (via une commande "expunge", par exemple, vider la corbeille depuis un WebMail). Il est également possible de forcer la destruction de tous les emails supprimés grâce à la fonction [EmailDétruit](../WDLang3/1000021553.md).




- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) dans le logiciel de messagerie Outlook. Ce nombre de messages évolue en fonction des emails reçus ou supprimés avec la fonction [EmailSupprimeMessage](../WDLang3/3032027.md).

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) dans le logiciel de messagerie Notes. Ce nombre de messages évolue en fonction des emails reçus ou supprimés avec la fonction [EmailSupprimeMessage](../WDLang3/3032027.md).



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003032024&name=emailnbmessage_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
// Boucle de lecture de tous les messages reçus présents
// dans la boîte aux lettres du protocole POP3
I est un entier
nbMSG est un entier = EmailNbMessage(NomUser)
POUR I = 1 A nbMSG
	EmailLitMessage(NomUser,I)
	SI Email.EnDehors <> Vrai ALORS
		CL.NOM = Email.Expediteur
		CL.MESSAGE_TXT = Email.Message
		...
	SINON
		Info("Ce message a été supprimé")
	FIN
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Connaître le nombre d'emails présents sur le serveur d'emails (protocole POP3)

`<Résultat> = EmailNbMessage(<Session POP3>)`
---

**`<Résultat> : (Entier)`**



- Nombre de messages reçus sur le serveur au début de la session d'emails en cours, 

- -1 en cas d'erreur. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Session POP3> : (Chaîne de caractères)`**

Identifie la session d'un utilisateur (Protocole POP3). Ce paramètre peut correspondre à :

- la chaîne de nom d'utilisateur utilisé pour ouvrir la session email (fonction [EmailOuvreSession](../WDLang3/3032028.md)).  

- une variable de type [emailSessionPOP3](../WDLang3/1000018759.md).





<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Connaître le nombre d'emails présents sur le logiciel de messagerie Outlook

`<Résultat> = EmailNbMessage(<Session messagerie Outlook>)`
---

**`<Résultat> : (Entier)`**



- Nombre de messages reçus présents dans le logiciel de messagerie Outlook au moment de l'appel de la fonction **EmailNbMessage**, 

- -1 en cas d'erreur. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Session messagerie Outlook> : (Entier ou variable de type emailSessionOutlook)`**

Identifiant de la session email de la messagerie Outlook en cours. Ce paramètre peut correspondre à :

- un entier renvoyé par la fonction [EmailOuvreSessionOutlook](../WDLang3/3032128.md) ou [OutlookOuvreSession](../WDLang3/3032123.md).

- une variable de type [emailSessionOutlook](../WDLang3/1000018767.md).





<a name="SYNTAXE3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Connaître le nombre d'emails présents sur le logiciel de messagerie Notes

`<Résultat> = EmailNbMessage(<Session messagerie Notes>)`
---

**`<Résultat> : (Entier)`**



- Nombre de messages reçus présents dans le logiciel de messagerie Notes au moment de l'appel de la fonction **EmailNbMessage**, 

- -1 en cas d'erreur. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Session messagerie Notes> : (Variable de type emailSessionNotes)`**

Identifiant de la session email de la messagerie Notes en cours.


<a name="SYNTAXE4"></a>

### Connaître le nombre d'emails présents sur le serveur d'emails (protocole IMAP)

`<Résultat> = EmailNbMessage(<Session messagerie IMAP>)`
---

**`<Résultat> : (Entier)`**



- Nombre de messages reçus sur le serveur dans la session d'emails en cours, 

- -1 en cas d'erreur. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Session messagerie IMAP> : (Variable de type emailSessionIMAP)`**

Identifiant de la session email en cours (Protocole IMAP). Cet identifiant est renvoyé par la fonction [EmailOuvreSession](../WDLang3/3032028.md).  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Messages supprimés (protocole POP3)
<a name="messages_supprimes_protocole_pop3_ELTPARAGRAPHE000274"></a>Si un message a été supprimé par la fonction [EmailSupprimeMessage](../WDLang3/3032027.md) :

- la fonction **EmailNbMessage** renvoie le nombre de messages présents sur le serveur d'emails avant la suppression. 

- les numéros des messages ne sont pas ré-affectés.




Ainsi, si quatre messages sont présents sur le serveur à l'ouverture de la session, ces messages sont numérotés de 1 à 4. Si le message 1 est supprimé :

- La fonction **EmailNbMessage** utilisée dans la même session renvoie toujours 4.

- La lecture du message 1 avec [EmailLitMessage](../WDLang3/3032016.md) est impossible car le message n'existe plus (seuls les messages 2, 3 et 4 existent).




Les numéros des messages sont ré-affectés lors de la prochaine connexion.
<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Messages supprimés (messagerie Outlook)
<a name="messages_supprimes_messagerie_outlook_ELTPARAGRAPHE000309"></a>Si, dans la même session d'emails, un message a été supprimé par la fonction [EmailSupprimeMessage](../WDLang3/3032027.md), la fonction **EmailNbMessage** renvoie le nombre correct de messages présents dans le dossier des emails reçus.
<a name="NOTE0_4"></a>


### Messages supprimés (protocole IMAP)
<a name="messages_supprimes_protocole_imap_ELTPARAGRAPHE000324"></a>Si un message a été supprimé par la fonction [EmailSupprimeMessage](../WDLang3/3032027.md), ce message est réellement supprimé de la session : 

- lors de la prochaine commande "expunge" (par exemple, vider la corbeille depuis un WebMail).

- lors de l'utilisation de la fonction [EmailDétruit](../WDLang3/1000021553.md) pour forcer la destruction de tous les emails supprimés.



<a name="NOTE0_5"></a>


### Nouveaux messages (protocole POP 3)
<a name="nouveaux_messages_protocole_pop_3_ELTPARAGRAPHE000344"></a>Le protocole POP3 ne permet pas de connaître et de gérer les nouveaux messages reçus durant la connexion. Pour obtenir les nouveaux messages, il est nécessaire de se déconnecter ([EmailFermeSession](../WDLang3/3032006.md)) puis de se reconnecter ([EmailOuvreSession](../WDLang3/3032028.md)).

<a name="XComposante"></a>

## Composante :
wd280com.dll
