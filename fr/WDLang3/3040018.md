
## FTPListeFichier (Fonction)

***En anglais : FTPListFile***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Liste les fichiers d'un répertoire (et/ou les répertoires) d'un serveur FTP et retourne le nombre de fichiers (et/ou de répertoires) listés.

Les fichiers listés sont recherchés dans un répertoire donné. Pour chaque fichier trouvé, **FTPListeFichier** appelle automatiquement une procédure spécifique. Cette procédure permet de manipuler le fichier en cours. Cette procédure doit renvoyer un résultat (<u><u><u>Vrai</u></u></u> pour continuer à lister les répertoires et / ou les fichiers, <u><u><u>Faux</u></u></u> pour arrêter).

**Attention** : Cette fonction n'est pas récursive. La recherche est effectuée dans le répertoire indiqué, sans tenir compte des sous-répertoires. 


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003040018&name=ftplistefichier_fonction&product=WD">Voir des exemples supplémentaires</a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Liste les fichiers .BMP présents dans "/Documents" sur le serveur FTP.
// La procédure FTPListeFichier_Callback retourne le nombre de fichiers en lecture seule.
ResListeFichier = FTPListeFichier(7, "/Documents/*.BMP", FTPListeFichier_Callback)
```


![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Connexion à un site FTP
nConnexion est un entier
nConnexion = FTPConnecte("ftp.cdrom.com")

nFichier est un entier  // Nombre de fichiers présents dans le répertoire
nJPG est un entier		// Nombre de fichiers .JPG
nJPG = 0

// On liste les fichiers ".JPG" du répertoire en cours
nFichier = FTPListeFichier(nConnexion, "", FTPListeFichier_Callback, ftpFichier, nJPG)
Info("Il y a" + nJPG + "fichiers .JPG sur" + nFichier + "fichiers listés") 


// Procédure appelée par la fonction FTPListeFichier
// Pour chaque fichier trouvé, la procédure FTPListeFichier_Callback 
// permet de compter le nombre de fichiers d'extension ".JPG".
PROCEDURE INTERNE FTPListeFichier_Callback(Nom, nTaille, sAttribut, sDate, sHeure, nParam)
	SI Droite(Nom, 4) ~= ".JPG" ALORS
		nParam++
	FIN
	RENVOYER Vrai
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = FTPListeFichier(<Identifiant de la connexion> , <Chemin et nom générique des fichiers> , <Procédure WLangage> [, <Fichiers/Répertoires> [, <Paramètre>]])`
---

**`<Résultat> : (Entier)`**



- Nombre de fichiers listés, 

- 0 (en cas d'erreur). Pour savoir si cette fonction a généré une erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




**`<Identifiant de la connexion> : (Entier)`**

Identifiant de la connexion, obtenu avec la fonction [FTPConnecte](../WDLang3/3040016.md).



**`<Chemin et nom générique des fichiers> : (Chaîne de caractères)`**

Chemin et nom générique des fichiers (et des répertoires) à lister. Les caractères génériques (\* et ?) sont autorisés. Les parties du chemin sont séparées par des "slash" (barre oblique normale, "/").

Si le chemin est du type "/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;" : le chemin de recherche est "/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;".

Si le chemin est du type "&lt;NomRépertoire&gt;/&lt;NomFichier&gt;" : le chemin de recherche est "/&lt;RépertoireCourantServeur&gt;/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;".

**`<Procédure WLangage> : (Nom de procédure)`**

Nom de la procédure WLangage (également nommée "callback") appelée pour chaque fichier listé. Cette procédure permet de manipuler le fichier en cours. 
Pour forcer l'interruption du parcours, cette procédure doit renvoyer <u><u><u><u>Faux</u></u></u></u>, et pour poursuivre le parcours, la procédure DOIT renvoyer <u><u><u><u>Vrai</u></u></u></u>.
Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction FTPListeFichier](../WDLang3/1000025351.md). 

**`<Fichiers/Répertoires> : (Constante (ou combinaison de constantes) optionnelle)`**

Indique les éléments recherchés :



|   |   |
| --- | --- |
| *ftpFichier* | La recherche est effectuée uniquement sur les fichiers. |
| *ftpRépertoire* | La recherche est effectuée uniquement sur les répertoires. |

Par défaut, ce paramètre vaut *ftpFichier*+*ftpRépertoire* : la recherche est effectuée sur les fichiers et les répertoires.

**`<Paramètre> : (Type correspondant à la valeur passée (optionnel))`**

Paramètre passé à la procédure &lt;Nom de la procédure&gt;.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Procédure manipulant chaque fichier listé
<a name="procedure_manipulant_chaque_fichier_liste_ELTPARAGRAPHE000131"></a>Pour plus de détails sur les paramètres de la procédure &lt;Procédure WLangage&gt;, consultez [Paramètres de la procédure utilisée par la fonction FTPListeFichier](../WDLang3/1000025351.md). 

**Attention** : Dans la procédure &lt;Procédure WLangage&gt; :

- aucune fonction FTP utilisant la même connexion que celle de la fonction **FTPListeFichier** ne doit être appelée.

- il est possible de récupérer les propriétés (nom, taille, attributs, dates et heures) du fichier listé à l'aide des fonctions [FTPNom](../WDLang3/3040019.md), [FTPTaille](../WDLang3/3040007.md), [FTPAttribut](../WDLang3/3040006.md), [FTPDate](../WDLang3/3040015.md) et [FTPHeure](../WDLang3/3040013.md). Cependant, cette solution est coûteuse en temps : elle provoque une requête supplémentaire sur le serveur FTP. Il est donc préférable de lire directement les paramètres optionnels passés à la &lt;Procédure WLangage&gt;.





<a name="NOTE0_3"></a>


### Délai de transfert
<a name="delai_transfert_ELTPARAGRAPHE000167"></a>Par défaut, toutes les fonctions FTP échouent si aucune réponse du serveur FTP n'est reçue après 20 secondes. Ce délai peut être modifié lors de la connexion au serveur FTP avec la fonction [FTPConnecte](../WDLang3/3040016.md).


<a name="NOTE0_4"></a>


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionsFTP.gif) ***Exemples unitaires (WEBDEV)*** : **Les fonctions FTP** <br>Utilisation des principales fonctions FTP de WEBDEV pour :<br>- Se connecter à un serveur FTP<br>- Lister les fichiers et les répertoires présents sur le serveur FTP<br>- Récupérer des fichiers présents sur le serveur FTP<br>- Se déconnecter d'un serveur FTP



<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280com.dll
