


## EmailSupprimeMessage (Fonction)

***En anglais : EmailDeleteMessage***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Permet de supprimer l'email en cours via un protocole spécifique :

- Protocole POP3 : l'email est supprimé directement sur le serveur d'emails.

- Protocole IMAP : l'email est marqué "effacé/supprimé". Il sera réellement supprimé du serveur d'emails lors de la prochaine commande "expunge" (par exemple, vider la corbeille depuis un WebMail).
	Il est également possible de forcer la destruction de tous les emails supprimés grâce à la fonction [EmailDétruit](../WDLang3/1000021553.md).

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Client MS Exchange : l'email est supprimé de la boîte de réception des messages.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Messagerie Lotus Notes ou Outlook : l'email est supprimé de la boîte de réception des messages.




Après l'exécution de la fonction **EmailSupprimeMessage**, la variable Email.EnDehors est positionnée à <u><u><u>Vrai</u></u></u>.

**Rappel** : Avant de manipuler un email (lecture ou suppression d'un email par exemple), il est nécessaire d'ouvrir une session avec la fonction [EmailOuvreSession](../WDLang3/3032028.md) (pour le protocole POP3, MS Exchange), avec la fonction [EmailOuvreSessionNotes](../WDLang3/3032121.md) (pour le logiciel de messagerie Lotus Notes) ou avec la fonction [EmailOuvreSessionOutlook](../WDLang3/3032128.md) ou [OutlookOuvreSession](../WDLang3/3032123.md) (pour le logiciel de messagerie Outlook).
![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Seule la suppression d'emails par le protocole POP3 est disponible.






<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003032027&name=emailsupprimemessage_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
cMaSession est une emailSessionIMAP
...
SI EmailOuvreSession(cMaSession) ALORS 
	cMonEmail est un Email
	EmailLitPremier(cMaSession, cMonEmail)
	TANTQUE PAS cMonEmail..EnDehors
		EmailSupprimeMessage(cMaSession, cMonEmail)
		EmailLitSuivant(cMaSession, cMonEmail)
	FIN
	EmailFermeSession(cMaSession)
FIN
```
<a name="Exemple2"></a>

```wl
// Utilisation avec le logiciel de messagerie Outlook 
// TABLE_TableEmail contient l'ensemble des emails reçus
// COL_Exp contient le nom de l'expéditeur (variable Email.Expéditeur)
// COL_Sujet contient le sujet de l'email (variable Email.Sujet)
// COL_ID contient l'identifiant de l'email (variable Email.ID)
// Suppression de l'email sélectionné dans le champ Table
EmailSupprimeMessage(IDSession, COL_ID)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Supprimer un email reçu en utilisant le protocole POP3 ou IMAP

`<Résultat> = EmailSupprimeMessage(<Session> [, <Email ou Numéro du message>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le message a été supprimé, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire.




**`<Session> : (Chaîne de caractères ou variable de type emailSessionPOP3 ou emailSessionIMAP)`**

Identifie la session d'un utilisateur. Ce paramètre correspond à :

- une chaîne de caractères utilisée comme nom d'utilisateur pour ouvrir la session email (fonction [EmailOuvreSession](../WDLang3/3032028.md)).

- une variable de type [emailSessionPOP3](../WDLang3/1000018759.md).

- une variable de type [emailSessionIMAP](../WDLang3/1000018957.md).




![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Les variables de type [emailSessionPOP3](../WDLang3/1000018759.md) et [emailSessionIMAP](../WDLang3/1000018957.md) ne sont pas disponibles.

**`<Email ou Numéro du message> : (Variable de type Email ou Entier optionnel)`**

Si ce paramètre est une variable de type [Email](../WDLang3/1000018713.md), le message correspondant à la variable est supprimé.
Si ce paramètre est un entier, il désigne le numéro du message à supprimer sur le serveur.
Si ce paramètre n'est pas précisé, le dernier message lu est supprimé du serveur d'emails.


<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Supprimer un email reçu par l'intermédiaire de MS Exchange, Lotus Notes ou Outlook

`<Résultat> = EmailSupprimeMessage(<Session> [, <Email ou Identifiant du message>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le message a été supprimé, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




**`<Session> : (Entier ou variable de type EMailSessionOutlook)`**

Identifiant de la session email en cours. Cette valeur peut être :

- un entier renvoyé par la fonction [EmailOuvreSession](../WDLang3/3032028.md).  

- une variable de type [emailSessionOutlook](../WDLang3/1000018767.md).




**`<Email ou Identifiant du message> : (Variable de type Email ou Chaîne de caractères optionnelle)`**

Si ce paramètre est une variable de type [Email](../WDLang3/1000018713.md), le message correspondant à la variable est supprimé.
Si ce paramètre est une chaîne de caractères, il désigne l'identifiant du message à supprimer sur le serveur.
Si le paramètre n'est pas précisé, le dernier message lu est supprimé du serveur d'emails et la variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u>.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Utilisation du protocole POP3
<a name="utilisation_protocole_pop3_ELTPARAGRAPHE000192"></a>Si le paramètre &lt;Numéro message&gt; :

- n'est pas précisé : le dernier message lu est supprimé du serveur d'emails.

- est précisé : le message identifié par &lt;Numéro message&gt; est supprimé du serveur d'emails.




Lors de la suppression d'un message avec la fonction **EmailSupprimeMessage** :

- Le message ne sera effectivement supprimé du serveur d'emails que lors de la déconnexion (fonction [EmailFermeSession](../WDLang3/3032006.md)).

- La variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u>.



<a name="NOTE0_2"></a>


### Suppression de messages et nombre de messages reçus (protocole POP3)
<a name="suppression_messages_nombre_messages_recus_protocole_pop3_ELTPARAGRAPHE000217"></a>Si un message a été supprimé par la fonction **EmailSupprimeMessage** : 

- la fonction [EmailNbMessage](../WDLang3/3032024.md) renvoie le nombre de messages présents sur le serveur d'emails avant la suppression.

- les numéros des messages ne sont pas ré-affectés.




Ainsi, si quatre messages sont présents sur le serveur lors de la connexion, ces messages sont numérotés de 1 à 4. Si le message 1 est supprimé :

- La fonction [EmailNbMessage](../WDLang3/3032024.md) (utilisée dans la même session) renvoie 4.

- La lecture du message 1 avec la fonction [EmailLitMessage](../WDLang3/3032016.md) est impossible car le message n'existe plus (seuls les messages 2, 3 et 4 existent).




Les numéros des messages sont ré-affectés lors de la prochaine connexion.

**Attention : Gmail via une session POP3** : lors de l'utilisation de la fonction **EmailSupprimeMessage**, l'email est marqué comme supprimé mais il n'est pas supprimé. Il s'agit du comportement normal de Gmail via POP3.
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Utilisation du client MS Exchange, de Lotus Notes ou Outlook
<a name="utilisation_client_exchange_lotus_notes_outlook_ELTPARAGRAPHE000253"></a>Le dernier message lu est supprimé des messages reçus. Ce message ne sera plus visualisé lors du parcours des messages par les fonctions [EmailLitPremier](../WDLang3/3032014.md) et [EmailLitSuivant](../WDLang3/3032004.md).

Après l'exécution de la fonction **EmailSupprimeMessage**, la variable Email.EnDehors est positionnée à <u><u><u><u>Vrai</u></u></u></u>.

Il est possible de retrouver un message supprimé en consultant la boîte des messages supprimés de MS Exchange, Lotus Notes ou Outlook.


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDMail.gif) ***Exemples complets (WINDEV)*** : **WD Mail** <br>Cette application est un client mail complet développé en WINDEV. Il s'appuie sur les objets Email.<br>Ce client mail permet de récupérer et d'envoyer des emails en utilisant les protocoles POP, IMAP et SMTP.<br>Il est possible d'appliquer des filtres sur le courrier entrant.<br>L'écriture d'un email s'appuie sur le champ Editeur HTML.<br>L'affichage des emails utilise le champ Affichage HTML.<br>L'application permet de gérer plusieurs comptes emails différents.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=LesfonctionsEmailPOP3.gif) ***Exemples unitaires (WINDEV)*** : **Les fonctions Email POP3** <br>Utilisation des fonctions Email pour gérer le protocole POP3.<br>Ce protocole sert à récupérer des emails depuis un serveur.

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280com.dll
