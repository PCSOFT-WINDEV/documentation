


## zipAjouteFichier (Fonction)

***En anglais : zipAddFile***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Ajoute et compresse automatiquement un fichier (de n'importe quel type) dans une archive de type CAB, ZIP, WDZ, 7z, TAR ou TGZ (TAR.GZ). Cette fonction n'est pas utilisable sur les archives de type RAR.

Pour ajouter les fichiers d'un répertoire, utilisez la fonction [zipAjouteRépertoire](../WDLang3/3082014.md).


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003082008&name=zipajoutefichier_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
MonArchive est un zipArchive
ResCréation est un entier
ResAjoutFichier est un entier
// Création de l'archive 
ResCréation = zipCrée(MonArchive, "C:\Temp\Archive.zip")
SI ResCréation = 0 ALORS
	// Ajout d'un fichier dans une archive
	ResAjoutFichier = zipAjouteFichier(MonArchive, ...
			"C:\MonRépertoire\MesFichiers\Fichier.pdf", zipDisque)
FIN
// Affichage du message d'erreur si le fichier n'a pas été ajouté
SI ResAjoutFichier <> 0 ALORS 
	Erreur(zipMsgErreur(ResAjoutFichier))
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Ajouter un fichier en précisant la portion de chemin à conserver

`<Résultat> = zipAjouteFichier(<Archive> , <Chemin d'accès du fichier> [, <Portion du chemin à conserver> [, <Progression>]])`
---

**`<Résultat> : (Entier)`**



- 0 si l'ajout a été effectué, 

- un code d'erreur (valeur supérieure à 0) dans le cas contraire. Pour plus de détails sur ces codes d'erreur, consultez [les remarques](#NOTE0_2).




**`<Archive> : (Chaîne de caractères ou variable de type zipArchive)`**

Nom de l'archive dans laquelle le fichier doit être ajouté.
Ce nom peut correspondre :

- soit au nom d'une archive défini avec la fonction [zipOuvre](../WDLang3/3082044.md) ou [zipCrée](../WDLang3/3082003.md).

- soit au nom d'une variable de type [zipArchive](../WDLang3/1000018679.md). 
	![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Les variables de type [zipArchive](../WDLang3/1000018679.md) ne sont pas disponibles en JAVA.




**`<Chemin d'accès du fichier> : (Chaîne de caractères)`**

Chemin d'accès du fichier à ajouter dans l'archive (260 caractères maximum, 90 maximum dans le cas d'une archive au format TAR ou TGZ (TAR.GZ)). Ce chemin peut être un chemin complet ou relatif au répertoire en cours. Il n'est pas possible d'utiliser des caractères jokers (\*, ?) dans le nom du fichier.
La taille de ce fichier doit être inférieure à 4 Go. Dans le cas contraire, une erreur est générée.

![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Le chemin d'accès au fichier est un chemin complet ou relatif au répertoire de travail de l'application (connu avec la fonction [fRepDonnées](../WDLang1/3036001.md)). Seuls les fichiers présents dans le répertoire de travail peuvent être ajoutés à l'archive. 

**`<Portion du chemin à conserver> : (Constante optionnelle)`**

Indique la portion de chemin du fichier à conserver dans l'archive :


|   |   |
| --- | --- |
| *zipAucun* | Conserve uniquement le nom et l'extension du fichier. Par exemple : NomFichier.pdf |
| *zipDisque* | Conserve le chemin complet et absolu du fichier (nom du disque, des répertoires, du fichier et l'extension du fichier). Par exemple : C:\\Répertoire\\Fichiers\\NomFichier.pdf<br>**Pour le format ZIP** : Cette constante n'a pas d'effet.<br>**Pour le format 7z** : Cette constante a le même effet que la constante *zipRépertoire*.<br><br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png) Cette constante n'est pas disponible car il n'y a pas de racine de lecteur.![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Cette constante aura le même effet que la constante *zipRépertoire*. |
| *zipRépertoire*<br>(Valeur par défaut) | Conserve les différents répertoires composant le chemin, le nom et l'extension du fichier. Par exemple : \\Répertoire\\Fichiers\\NomFichier.pdf |


**Si vous manipulez une archive au format .CAB**, seule la constante *zipAucun* est prise en compte. En effet, le format .CAB ne permet pas d'enregistrer des chemins à l'intérieur de l'archive.
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Ce paramètre n'est pas disponible : seuls le nom du fichier et son extension sont conservés.

**`<Progression> : (Nom de champ ou nom de procédure)`**

Mode de gestion de la jauge. Ce paramètre peut correspondre : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) au nom d'un champ Jauge présent dans une fenêtre. Cette jauge affichera la progression de l'ajout et de la compression du fichier manipulé.  

- au nom d'une procédure WLangage. Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction zipAjouteFichier](../WDLang3/1000025730.md). 




**Si vous manipulez une archive au format TAR ou TGZ (TAR.GZ)**, la jauge est mise à jour uniquement à la fin de l'ajout du fichier. 



![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre n'est pas disponible.


<a name="SYNTAXE2"></a>

### Ajouter un fichier en précisant le chemin à ignorer 

`<Résultat> = zipAjouteFichier(<Archive> , <Chemin d'accès du fichier> [, <Portion du chemin à ignorer> [, <Progression>]])`
---

**`<Résultat> : (Entier)`**



- 0 si l'ajout a été effectué,

- un code d'erreur (valeur supérieure à 0) dans le cas contraire. Pour plus de détails sur ces codes d'erreur, consultez les [Remarques](#NOTE0_2).




**`<Archive> : (Chaîne de caractères ou variable de type zipArchive)`**

Nom de l'archive dans laquelle le fichier doit être ajouté.
Ce nom peut correspondre :

- soit au nom d'une archive défini avec la fonction [zipOuvre](../WDLang3/3082044.md) ou [zipCrée](../WDLang3/3082003.md).

- soit au nom d'une variable de type [zipArchive](../WDLang3/1000018679.md). 
	![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Les variables de type [zipArchive](../WDLang3/1000018679.md) ne sont pas disponibles en JAVA.




**`<Chemin d'accès du fichier> : (Chaîne de caractères)`**

Chemin d'accès du fichier à ajouter dans l'archive (260 caractères maximum, 90 maximum dans le cas d'une archive au format TAR ou TGZ (TAR.GZ)). Ce chemin peut être un chemin complet ou relatif au répertoire en cours. Il n'est pas possible d'utiliser des caractères jokers (\*, ?) dans le nom du fichier.
La taille de ce fichier doit être inférieure à 4 Go. Dans le cas contraire, une erreur est générée.

**`<Portion du chemin à ignorer> : (Chaîne de caractères optionnelle)`**

Indique la portion de chemin du fichier à ne pas conserver dans l'archive. 
Par exemple, en WINDEV, si le chemin complet du fichier ajouté dans l'archive est : "C:\\Mes Documents\\Travail\\Rapport.doc" et si le paramètre &lt;Portion du chemin à ignorer&gt; vaut "C:\\Mes Documents\\", seule la portion "Travail\\Rapport.doc" sera conservée.  

**`<Progression> : (Nom de champ ou nom de procédure)`**

Mode de gestion de la jauge. Ce paramètre peut correspondre : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) au nom d'un champ Jauge présent dans une fenêtre. Cette jauge affichera la progression de l'ajout et de la compression du fichier manipulé.  

- au nom d'une procédure WLangage. Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction zipAjouteFichier](../WDLang3/1000025730.md). 




**Si vous manipulez une archive au format TAR ou TGZ (TAR.GZ)**, la jauge est mise à jour uniquement à la fin de l'ajout du fichier.



![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre n'est pas disponible.


<a name="SYNTAXE3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Ajouter un fichier présent dans un buffer (format WDZ et ZIP uniquement)

`<Résultat> = zipAjouteFichier(<Archive> , <Fichier à ajouter> , <Gestion du buffer> , <Chemin à conserver> [, <Progression>])`
---

**`<Résultat> : (Entier)`**



- 0 si l'ajout a été effectué, 

- un code d'erreur (valeur supérieure à 0) dans le cas contraire. Pour plus de détails sur ces codes d'erreur, consultez les [Remarques](#NOTE0_2).




**`<Archive> : (Chaîne de caractères ou variable de type zipArchive)`**

Nom de l'archive dans laquelle le fichier doit être ajouté.
Ce nom peut correspondre :

- soit au nom d'une archive défini avec la fonction [zipOuvre](../WDLang3/3082044.md) ou [zipCrée](../WDLang3/3082003.md).

- soit au nom d'une variable de type [zipArchive](../WDLang3/1000018679.md). 




**`<Fichier à ajouter> : (Buffer)`**

Buffer correspondant au contenu du fichier à ajouter dans l'archive.

**`<Gestion du buffer> : (Constante)`**

Mode de gestion du buffer : 


|   |   |
| --- | --- |
| *zipEnMémoire* | Sauve le contenu du buffer (c'est-à-dire le fichier) dans l'archive. |



**`<Chemin à conserver> : (Chaîne de caractères)`**

Chemin du fichier ou nom du fichier associé au buffer et à conserver dans l'archive.  

**`<Progression> : (Nom de champ ou nom de procédure)`**

Mode de gestion de la jauge. Ce paramètre peut correspondre : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) au nom d'un champ Jauge présent dans une fenêtre. Cette jauge affichera la progression de l'ajout et de la compression du fichier manipulé.  

- au nom d'une procédure WLangage. Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction zipAjouteFichier](../WDLang3/1000025730.md). 




**Si vous manipulez une archive au format TAR ou TGZ (TAR.GZ)**, la jauge est mise à jour uniquement à la fin de l'ajout du fichier.




<a name="SYNTAXE4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Ajouter un fichier en utilisant une variable de type zipFichierArchivé

`<Résultat> = zipAjouteFichier(<Archive> , <Fichier> [, <Progression>])`
---

**`<Résultat> : (Entier)`**



- 0 si l'ajout a été effectué, 

- un code d'erreur (valeur supérieure à 0) dans le cas contraire. Pour plus de détails sur ces codes d'erreur, consultez les [Remarques](#NOTE0_2).




**`<Archive> : (Chaîne de caractères ou variable de type zipArchive)`**

Nom de l'archive dans laquelle le fichier doit être ajouté.
Ce nom peut correspondre :

- soit au nom d'une archive défini avec la fonction [zipOuvre](../WDLang3/3082044.md) ou [zipCrée](../WDLang3/3082003.md).

- soit au nom d'une variable de type [zipArchive](../WDLang3/1000018679.md). 
	




**`<Fichier> : (Variable de type zipFichierArchivé)`**

Nom de la variable de type [zipFichierArchivé](../WDLang3/1000019044.md) contenant toutes les informations sur le fichier à ajouter (y compris son contenu).
Il n'est pas nécessaire que le fichier existe sur le disque : seules les informations contenues dans ce paramètre sont prises en compte.

**`<Progression> : (Nom de champ ou nom de procédure)`**

Mode de gestion de la jauge. Ce paramètre peut correspondre : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) au nom d'un champ Jauge présent dans une fenêtre. Cette jauge affichera la progression de l'ajout et de la compression du fichier manipulé.

- au nom d'une procédure WLangage. Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction zipAjouteFichier](../WDLang3/1000025730.md).  




**Si vous manipulez une archive au format TAR ou TGZ (TAR.GZ)**, la jauge est mise à jour uniquement à la fin de l'ajout du fichier.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Condition d'utilisation
<a name="condition_utilisation_ELTPARAGRAPHE000487"></a>L'ajout de fichiers dans une archive ne peut être réalisé que si :

- L'archive existe (la création d'une archive s'effectue avec la fonction [zipCrée](../WDLang3/3082003.md)).

- L'archive est accessible en lecture et en écriture.

- L'archive est mono-partie.

- La taille du fichier est inférieure à 4 Go.




**Attention** : 

- **Archives au format CAB** : L'ajout de fichiers doit se faire immédiatement après la création de l'archive. Ce format ne permet pas d'ajouter des fichiers dans une archive existante.  

- **Archives au format 7z** : L'archive est entièrement compressée à chaque appel de la fonction **zipAjouteFichier**. Cette fonction est conseillée lors de l'ajout d'un seul fichier. Si plusieurs fichiers doivent être ajoutés dans l'archive, utilisez la fonction [zipAjouteListeFichier](../WDLang3/3082038.md) ou [zipAjouteRépertoire](../WDLang3/3082014.md). 




Le nombre maximum de fichiers pouvant être intégrés :

- dans un fichier WDZ : 232-1.

- dans un fichier ZIP : 65535. 

- dans un fichier CAB : 65535. 


Rappel : 

- ![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Seules les archives au format ZIP, TAR ou TGZ (TAR.GZ) sont disponibles.

- ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Seules les archives au format ZIP sont disponibles.



<a name="NOTE0_2"></a>


### Niveau de compression des archives ZIP ou 7z
<a name="niveau_compression_des_archives_zip_7z_ELTPARAGRAPHE000566"></a>Par défaut, les fichiers ajoutés dans une archive au format ZIP ou 7z sont compressés. Il est possible de modifier le niveau de compression des fichiers ajoutés dans une archive grâce à la fonction [zipNiveauCompression](../WDLang3/3082054.md).
<a name="NOTE0_3"></a>


### Codes d'erreur
<a name="codes_erreur_ELTPARAGRAPHE000578"></a>Les codes d'erreur retournés sont les suivants :

- 1 : Le chemin passé en paramètre n'existe pas.

- 2 : Accès interdit : l'utilisateur n'a pas les droits nécessaires ou le fichier est en cours d'utilisation. Si le fichier à insérer est un fichier de données HFSQL, il doit être fermé avec le code suivant :
	
	```wl
	HFerme(NomFichier)
	Multitâche() // Attend la fermeture effective du fichier
	```


- 3 : L'archive est corrompue.

- 4 : Le chemin n'existe pas dans l'archive.

- 5 : Impossible d'écrire dans l'archive.

- 7 : Le fichier est déjà présent dans l'archive.

- 8 : Une archive ne peut pas être ajoutée à elle-même. Par exemple, l'archive "MonArchive" ne peut pas être ajoutée à l'archive "MonArchive".




Le message correspondant au code d'erreur peut être connu grâce à la fonction [zipMsgErreur](../WDLang3/3082034.md).
<a name="NOTE0_4"></a>


### Ajout d'un fichier déjà présent dans l'archive
<a name="ajout_fichier_deja_present_dans_archive_ELTPARAGRAPHE000602"></a>L'ajout d'un fichier déjà présent dans une archive provoque une erreur. Un fichier est identifié selon son chemin enregistré dans l'archive. Il est donc impossible d'ajouter à l'archive deux fichiers de même nom ayant le même chemin relatif.

Par exemple, l'ajout de deux fichiers de même noms issus de répertoires différents avec la constante *zipAucun* est impossible.
<a name="NOTE0_5"></a>


### Indice des fichiers dans l'archive
<a name="indice_des_fichiers_dans_archive_ELTPARAGRAPHE000613"></a>Lors de l'ajout d'un fichier dans une archive, un indice est automatiquement attribué au fichier. Cet indice correspond à l'ordre d'intégration des fichiers dans l'archive. Pour sélectionner un fichier de l'archive, il est possible d'utiliser :

- soit l'indice de l'élément (remarque : l'indice d'un élément peut être connu grâce à la fonction [zipChercheFichier](../WDLang3/3082002.md)).

- soit le chemin de l'élément enregistré dans l'archive.



<a name="NOTE0_6"></a>


### Chemin conservé (archives au format WDZ et ZIP)
<a name="chemin_conserve_archives_format_wdz_zip_ELTPARAGRAPHE000628"></a>Le tableau ci-dessous présente les chemins conservés dans l'archive en fonction :

- du chemin d'accès du fichier,

- de la portion du chemin à conserver.


![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Le répertoire en cours est : "C:\\Temp" :


|   |   |   |   |   |
| --- | --- | --- | --- | --- |
| **Fonction zipAjouteFichier** | **Localisation du fichier** | *zipAucun* | *zipRépertoire* | *zipDisque* |
| zipAjouteFichier<br>("Archi", "Fichier.txt") | C:\\Temp\\Fichier.txt | Fichier.txt | Fichier.txt | Fichier.txt |
| zipAjouteFichier<br>("Archi", "Donnée\\Fichier.txt") | C:\\Temp\\Donnée\\Fichier.txt | Fichier.txt | Donnée\\Fichier.txt | Donnée\\Fichier.txt |
| zipAjouteFichier<br>("Archi", "D:\\Donnée\\Fichier.txt") | D:\\Donnée\\Fichier.txt | Fichier.txt | Donnée\\Fichier.txt | D:\\Donnée\\Fichier.txt |


**Remarque** : Si la constante *zipDisque* est utilisée, le format WDZ conserve le chemin complet du fichier (lettre du lecteur comprise) alors que le format ZIP ne conserve pas la lettre du lecteur.


![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Le disque n'est pas conservé dans le chemin de l'archive.

![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Le répertoire et le disque ne sont pas conservés dans le chemin de l'archive. Seuls le nom du fichier et son extension sont conservés. 

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280zip.dll
