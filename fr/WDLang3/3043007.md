


## HTTPRequête (Fonction)

***En anglais : HTTPRequest***

<DIV class="specObsolete">
	<IMG style="float:left;margin-right:10px;" src="https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=warning_big.png"><B>Avertissement</B><BR>
	A partir de la version <B>28</B>,  cette fonction est conservée uniquement par compatibilité (notamment pour la programmation en PHP). Il est conseillé d'utiliser une variable de type [httpRequête](../WDLang3/1000021158.md) avec la fonction [HTTPEnvoie](../WDLang3/1000021183.md). 
</DIV><a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Lance une requête HTTP sur un serveur. Le résultat de la requête (buffer) peut être : 

- enregistré dans un fichier de sauvegarde grâce à la fonction [HTTPDestination](../WDLang3/1000017094.md)

- récupéré grâce à la fonction [HTTPDonneRésultat](../WDLang3/3043001.md).


![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Conseil** : Utilisez la fonction [HTTPEnvoie](../WDLang3/1000021183.md) pour exécuter une requête HTTP. Cette fonction utilise une variable de type [httpRequête](../WDLang3/1000021158.md) permettant de décrire précisément et simplement la requête HTTP. 

**Remarques** : 

- Deux types de requêtes sont gérés : POST et GET. Les requêtes de type GET sont automatiques. Si le "Message à envoyer" n'est pas précisé, il s'agit d'une requête GET (voir syntaxe). Pour gérer des formulaires, il est conseillé d'utiliser les fonctions de gestion des formulaires ([HTTPCréeFormulaire](../WDLang3/1000017119.md), [HTTPEnvoieFormulaire](../WDLang3/1000017190.md), ...). 





<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003043007&name=httprequete_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
// Récupération du code HTML de la page Web "www.pcsoft.com"
ResLancement = HTTPRequête("http://www.pcsoft.fr")
```
<a name="Exemple2"></a>

```wl
// Récupération d'une page HTML utilisant une URL protégée
ResLancement = HTTPRequête("http://www.pcsoft.fr", ...
	"", "", "", "", "Julie", "MotDePasse")
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = HTTPRequête(<URL à contacter> [, <Agent utilisateur> [, <Entête HTTP supplémentaire> [, <Message à envoyer> [, <Type du message> [, <Nom User> [, <Mot de passe>]]]]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la requête a été lancée, 

- <u><u><u><u>Faux</u></u></u></u> en cas d'erreur. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.
	Le résultat de la requête peut être enregistré dans un fichier de sauvegarde grâce à la fonction [HTTPDestination](../WDLang3/1000017094.md) ou récupéré grâce à la fonction [HTTPDonneRésultat](../WDLang3/3043001.md).
	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Les erreurs concernant la sécurité des transactions ne sont pas retournées par la fonction [ErreurInfo](../WDLang1/3013008.md) : la connexion est simplement refusée.




**`<URL à contacter> : (Chaîne de caractères)`**

Adresse du serveur à contacter sous forme d'adresse URL. Ce paramètre peut contenir :

- le numéro de port pour la connexion sur le serveur. La valeur par défaut est 80 (correspond à un serveur de pages Web). Pour spécifier un numéro de port, utilisez le format : "&lt;URL du serveur&gt;**:**&lt;N° du port&gt;". Par exemple : "http://www.pcsoft.fr:80".

- des paramètres supplémentaires. Ces paramètres peuvent permettre d'effectuer une recherche ou de remplir un formulaire. Par exemple, pour rechercher "pcsoft" sur "http://www.google.fr", l'URL à contacter sera : "http://www.google.fr/search?q=pcsoft". 




**Remarques** :

- Pour spécifier à la fois le numéro de port et des paramètres supplémentaires, utilisez le format : "&lt;URL du serveur&gt;**:**&lt;N° du port&gt;/&lt;Paramètres supplémentaires&gt;".

- Pour réaliser une transaction sécurisée, l'URL doit commencer par la chaîne "https://". Dans ce cas, le mode de gestion des requêtes est toujours effectué par Internet Explorer (pour plus de détails, consultez la fonction [HTTPParamètre](../WDLang3/1000018985.md)). 




**`<Agent utilisateur> : (Chaîne de caractères optionnelle)`**

Identifie le client. Par défaut, le nom de l'application est envoyé.  
Le contenu de la réponse peut dépendre de l'agent utilisateur (par exemple, une requête effectuée à partir d'un mobile nécessite des pages différentes d'une requête effectuée avec un navigateur PC). Dans ce cas, consultez la documentation de l'agent utilisateur pour plus de détails.

**`<Entête HTTP supplémentaire> : (Chaîne de caractères optionnelle)`**



- Entête HTTP supplémentaire à ajouter au message HTTP, 

- Chaîne vide ("") si aucun entête HTTP ne doit être ajouté.




**`<Message à envoyer> : (Chaîne de caractères optionnelle)`**

Message HTTP à envoyer au serveur. Ce paramètre peut être spécifié uniquement dans le cas d'une requête d'envoi de message (requête POST). Le message à envoyer doit respecter le protocole HTTP utilisé. Si ce paramètre est précisé et non vide, il s'agit d'une requête POST sinon c'est une requête GET (tout le reste est automatique).

**`<Type du message> : (Chaîne de caractères optionnelle)`**

Type du contenu du message HTTP à envoyer au serveur. Ce paramètre peut être spécifié uniquement dans le cas d'une requête d'envoi de message (requête POST). Ce paramètre correspond au "Content-Type". 
Par défaut, le type du message correspond à : "application/x-www-form-urlencoded".
Il est cependant possible de mettre n'importe quelle valeur, par exemple : "text/xml", "application/javascript", "application/json", "application/xml", "image/jpeg", ...
Pour envoyer des données brutes, qui seront lues en une seule fois par le serveur d'application WEBDEV, utilisez les types : 

- "application/octet-stream".

- "text/xml".




**`<Nom User> : (Chaîne de caractères optionnelle)`**

Nom permettant d'accéder à une page avec une URL protégée (chaîne vide par défaut). Ce nom permet d'identifier l'utilisateur.

Remarque : En renseignant les paramètres &lt;Nom User&gt; et &lt;Mot de passe&gt;, le "Authorization:Basic" correspondant est automatiquement généré dans l'entête de la requête.


**`<Mot de passe> : (Chaîne de caractères optionnelle)`**

Mot de passe associé au nom d'utilisateur (chaîne vide par défaut). Permet d'accéder à une page avec une URL protégée. **Attention** : Le mot de passe est transmis en clair sur Internet.

Remarque : En renseignant les paramètres &lt;Nom User&gt; et &lt;Mot de passe&gt;, le "Authorization:Basic" correspondant est automatiquement généré dans l'entête de la requête.




<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Erreur de sécurité dans une transaction sécurisée
<a name="erreur_securite_dans_une_transaction_securisee_ELTPARAGRAPHE000180"></a>Lors d'une transaction sécurisée, certaines erreurs de sécurité peuvent faire échouer la requête :

- certificat invalide ou ne provenant pas d'une société connue.

- nom du site figurant dans le certificat ne correspond pas à un serveur.

- date du certificat non-valide ou expiré.

- renvoi vers un serveur non sécurisé.

- ...




Ces erreurs sont renvoyées par la fonction [ErreurInfo](../WDLang1/3013008.md).

Si une de ces erreurs est rencontrée, il est possible d'exécuter à nouveau la requête en ignorant ces erreurs. Pour cela, il suffit d'utiliser la variable **HTTP.IgnoreErreur**. 

La variable **HTTP.IgnoreErreur** permet également de gérer certains cas particuliers lors des transactions sécurisées (par exemple, ne pas prendre en compte la liste des certificats révoqués). 

| Erreur renvoyée par la fonction [ErreurInfo](../WDLang1/3013008.md)<br> (avec la constante *errCode*) | Valeur de HTTP.IgnoreErreur <br>(ces valeurs peuvent être combinées) | Description |
| --- | --- | --- |
| *httpErreurCertificatInvalide*<br>Certificat invalide ou ne provenant pas d'une société connue | *httpIgnoreCertificatInvalide* | Le certificat est ignoré. |
| *httpErreurNomCertificatInvalide*<br>Nom du site figurant dans le certificat ne correspond pas à un serveur | *httpIgnoreNomCertificatInvalide* | Le nom du site figurant dans le certificat est ignoré. |
| *httpErreurCertificatExpiré*<br>Date du certificat non-valide ou expiré | *httpIgnoreCertificatExpiré* | La date du certificat est ignorée |
| *httpErreurRenvoiHTTP*<br>Renvoi vers un serveur non sécurisé | *httpIgnoreRenvoiHTTP* | Le renvoi vers un serveur non sécurisé est autorisé. |
| *httpErreurRenvoiHTTPS*<br>Renvoi vers un serveur sécurisé | *httpIgnoreRenvoiHTTPS* | Le renvoi vers un serveur sécurisé est autorisé. |
|   | *httpIgnoreRedirection* | La redirection vers une page est ignorée. |
|   | *httpIgnoreRévocation* | Le contrôle du certificat dans la liste des certificats révoqués n'est pas effectué. |

Par exemple :

```wl
// Lancement d'une requête sur un serveur sécurisé
ResLancement = HTTPRequête("https://www.MonServeur.com")
// Si erreur rencontrée
SI ResLancement = Faux ALORS
	// Selon le type d'erreur rencontré
	SELON ErreurInfo(ErrCode)
		// Certificat invalide 
		// ou ne provenant pas d'une société connue
		CAS httpErreurCertificatInvalide : 
			// Ignorer le certificat ?
			SI OuiNon("Alerte de sécurité détectée !", ...
				"Certificat invalide.", ...
				"Ignorer ce certificat ?") = Oui ALORS
				HTTP.IgnoreErreur = httpIgnoreCertificatInvalide
				// Nouveau lancement de la requête 
				// en ignorant cette erreur
				HTTPRequête("https://www.MonServeur.com")
			FIN
		// Date du certificat non-valide ou expiré
		CAS httpErreurCertificatExpiré : 
			// Ignorer la date du certificat ?
			SI OuiNon("Alerte de sécurité détectée !", ...
				"Date du certificat invalide ou expiré.", ...
				"Ignorer cette date ?") = Oui ALORS
				HTTP.IgnoreErreur = httpIgnoreCertificatExpiré
				// Nouveau lancement de la requête 
				// en ignorant cette erreur
				HTTPRequête("https://www.MonServeur.com")
			FIN
	FIN
FIN
```
Remarques : 

- Lorsque des requêtes HTTP sont faites dans plusieurs threads, la variable **HTTP.IgnoreErreur** possède une valeur spécifique par thread.

- ![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Les erreurs concernant la sécurité des transactions sont ignorées. La variable **HTTP.IgnoreErreur** n'est pas disponible.

- ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) 
	**Avant la version 200057**, les erreurs concernant la sécurité des transactions étaient ignorées. La variable **HTTP.IgnoreErreur** n'était pas disponible.
	**A partir de la version 200057**, les erreurs suivantes sont gérées : *httpIgnoreCertificatExpiré*, *httpIgnoreCertificatInvalide*, *httpIgnoreNomCertificatInvalide*, *httpIgnoreRévocation*. Les autres erreurs sont ignorées. Par défaut, pour compatibilité, toutes les erreurs sont ignorées sur les projets existants. Ces erreurs sont gérées uniquement sur les nouveaux projets.
	



<a name="NOTE0_2"></a>


### Récupération du résultat
<a name="recuperation_resultat_ELTPARAGRAPHE000284"></a>La fonction [HTTPDonneRésultat](../WDLang3/3043001.md) permet de récupérer le résultat de la dernière requête HTTP lancée.

Lorsqu'une destination fichier est précisée avec la fonction [HTTPDestination](../WDLang3/1000017094.md) :

- la fonction [HTTPDonneRésultat](../WDLang3/3043001.md) utilisée avec la constante *httpRésultat* renvoie toujours une chaîne vide ("").

- la fonction [HTTPDonneRésultat](../WDLang3/3043001.md) utilisée avec la constante *httpEntête* renvoie toujours l'entête de la réponse HTTP. Cet entête n'est pas enregistré dans le fichier destination : seules les données sont enregistrées.




Lorsque la requête est terminée, la destination est annulée et la fonction [HTTPRequête](../WDLang3/3043007.md) fonctionne normalement.
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Accéder à une URL protégée par mot de passe
<a name="acceder_une_url_protegee_par_mot_passe_ELTPARAGRAPHE000315"></a>Pour accéder à une URL protégée par mot de passe, il est possible :

- soit d'utiliser les paramètres &lt;Nom User&gt; et &lt;Mot de passe&gt; de la syntaxe de  la fonction **HTTPRequête**.

- soit de préciser directement dans le paramètre &lt;URL à contacter&gt; le login et le mot de passe. Par exemple :
	
	```txt
	<Res> = HTTPRequête("http://<user>:<password>@<URL à contacter>")
	```




<a name="NOTE0_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Utilisation d'un proxy
<a name="utilisation_proxy_ELTPARAGRAPHE000332"></a>Pour accéder à l'URL spécifiée dans la fonction **HTTPRequête** via un proxy, utilisez la fonction [Proxy](../WDLang3/3043002.md).
<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### En-têtes d'authentification
<a name="entetes_authentification_ELTPARAGRAPHE000347"></a>Les entêtes d'authentification sont générées automatiquement dans les cas suivants :

- Si la fonction **HTTPRequête** utilise la syntaxe avec login et mot de passe.

- Si l'URL serveur est protégée par mot de passe.

- Si la fonction [Proxy](../WDLang3/3043002.md) est utilisée.



<a name="NOTE0_7"></a>
<a name="NOTE0_8"></a>
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) 

### Limites
<a name="limites_ELTPARAGRAPHE000379"></a>

- Le proxy utilisé est celui d'Internet Explorer. 

- Il n'est pas possible d'ignorer les certificats. 



<a name="NOTE0_9"></a>
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) 

### Fonctionnalité d'application requise
<a name="fonctionnalite_application_requise_ELTPARAGRAPHE000391"></a>L'utilisation de cette fonction entraîne la déclaration d'une fonctionnalité d'application dans l'assistant de génération de l'application.

Fonctionnalité requise : Internet et réseaux publics (sortant).

Cette fonctionnalité permet aux applications d'utiliser des accès à Internet et aux réseaux publics. 

<a name="XComposante"></a>

## Composante :
wd280com.dll
