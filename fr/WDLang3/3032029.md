


## La structure email
			




	<B><B>Avertissement</B></B>

	 La structure email est conservée par compatibilité, et pour une utilisation en PHP. Dans la majorité des cas, il est conseillé d'utiliser une variable de type [Email](../WDLang3/1000018713.md). 

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000785"></a>
La structure Email est une structure prédéfinie du WLangage (aucune déclaration n'est nécessaire). Cette structure permet de :

- créer un email,

- récupérer le contenu des emails.




Pour remettre à zéro toutes les variables de la structure Email, utilisez la fonction [EmailRaz](../WDLang3/3032023.md).

La structure Email offre une méthode simple pour manipuler un email. Il est également possible d'utiliser les types avancés de manipulation des emails :

- variable de type [Email](../WDLang3/1000018713.md).

- variable de type [emailAttache](../WDLang3/1000018752.md).




Ces types avancés permettent par exemple de :

- manipuler plusieurs emails simultanément.

- utiliser les fonctions [Sérialise](../WDLang1/3013065.md)/[Désérialise](../WDLang1/3013066.md) sur l'email.

- utiliser le [Data binding](../Editeurs/2022051.md).

- utiliser les boucles POUR TOUT sur les sessions emails.

- ...








<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Les différentes variables de la structure email
<a name="les_differentes_variables_structure_email_ELTTEXTE000809"></a>
La structure est composée des membres suivants :

**Remarque** : Les limites données dans ce tableau concernent uniquement le client MS Exchange. Lors de l'utilisation du protocole POP3/SMTP, les limites sont celles données par le serveur.


|   |   |
| --- | --- |
| **Email.AccuséRéception** | Booléen (<u><u><u><u>Faux</u></u></u></u> par défaut).<br><br>**En envoi**, permet de demander un accusé de réception au destinataire. Le destinataire n'est pas obligé d'envoyer un accusé de réception. <br><br>**En réception**, permet de savoir si l'expéditeur a demandé un accusé de réception.<br>Si la confirmation de lecture est demandée, elle est prioritaire sur l'accusé de réception.<br><br>Ce membre n'est pas géré par Outlook sous Windows.<br><br> |
| **Email.AdresseExpéditeur** | Chaîne de caractères contenant l'adresse à laquelle la réponse au message doit être envoyée (127 caractères maximum). Correspond au **Reply-To**. <br><br><br><br>**Sous Outlook**, cette variable est ignorée. Le nom du compte de la session en cours est utilisé pour remplir cette variable.<br><br>**Sous Lotus**, si l'expéditeur n'est pas renseigné, le login lotus est utilisé.<br><br>Remarque : Si l'adresse contient des caractères spéciaux ou des accents, utilisez la constante **emailOptionEncodeEntête** lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br> |
| **Email.Attache** | Tableau de chaînes contenant le nom des fichiers attachés. <br>Le nombre de fichiers attachés est illimité.<br>Pour plus de détails sur la gestion des fichiers attachés, consultez <br><br>- [Lire un email](../WDLang3/3032037.md).<br><br>- [Ecrire un email](../WDLang3/3032002.md). <br><br><br> |
| **Email.Catégorie** | Chaîne de caractères contenant une liste de mots-clé associés à l'email. Les mots-clés sont séparés par des points virgules.<br><br>Remarque : Si un mot-clé contient des caractères spéciaux ou des accents, utilisez la constante **emailOptionEncodeEntête** lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br> |
| **Email.CC** | Tableau de chaînes contenant les adresses des *destinataires en copie* : leur nom ne figure pas dans le mail reçu par les destinataires officiels (variable Email.Destinataire). <br>Les adresses sont limitées à 127 caractères. <br>Le nombre de destinataires non officiels est limité à 200. En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| **Email.Cci (ou Bcc)** | Tableau de chaînes contenant les adresses des *destinataires non officiels* : leur nom ne figure pas dans le mail reçu par les destinataires officiels (variable Email.Destinataire). <br>Les adresses sont limitées à 127 caractères. <br>Le nombre de destinataires non officiels est limité à 200. En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| **Email.Certificat** | Variable de type [Certificat](../WDLang1/1000019287.md) contenant le certificat à utiliser pour signer l'email avant son envoi.<br><br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Non disponible. |
| **Email.Confidentialité** | Constante de type Entier contenant le type de confidentialité de l'email. Les valeurs possibles sont les suivantes :<br><br>- ***emailConfidentiel*** : Utilisé par exemple pour les emails envoyés à l'intérieur d'une société.<br><br>- ***emailNormal*** (Valeur par défaut) : Aucune confidentialité.<br><br>- ***emailPersonnel*** : Utilisé par exemple pour les emails personnels.<br><br>- ***emailPrivé*** : Utilisé par exemple pour les emails privés.<br><br><br>Ce membre n'est pas géré sous Lotus Notes.<br><br> |
| **Email.ConfirmationLecture** | Booléen (<u><u><u><u>Faux</u></u></u></u> par défaut)<br><br>**En envoi,** permet de demander une confirmation de lecture au destinataire. Le destinataire n'est pas obligé d'envoyer une confirmation de lecture. <br><br>**En réception,** permet de savoir si l'expéditeur a demandé une confirmation de lecture.<br>Si la confirmation de lecture est demandée, elle est prioritaire sur l'accusé de réception.<br><br>Ce membre n'est pas géré sous Lotus Notes.<br>Ce membre est géré par Outlook pour Windows.<br><br> |
| **Email.DateRéception** | Date contenant la date de réception du message (128 caractères).<br>Si la session email a été ouverte grâce à la fonction :<br><br>- [EmailOuvreSession](../WDLang3/3032028.md) : le format de la date dépend de la langue utilisée par Windows sur le poste en cours.<br><br>- [EmailOuvreSessionOutlook](../WDLang3/3032128.md) : le format de la date correspond au format suivant : AAAAMMJJHHSSCCmmm. L'heure est au format UTC.<br><br><br><br><br> |
| **Email.Destinataire** | Tableau de chaînes de caractères contenant les adresses des *destinataires principaux*. Les destinataires en copie et les destinataires non officiels ne sont pas pris en compte. Le nombre de destinataires est limité à 20. En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| **Email.EnDehors** | Booléen indiquant si un message a pu être lu. Email.EnDehors retourne <u><u><u><u>Faux</u></u></u></u> lorsqu'un message a été lu et <u><u><u><u>Vrai</u></u></u></u> lorsque le message n'a pas été lu.<br><br> |
| **Email.Erreur** | Chaîne de caractères contenant le message d'erreur.<br><br> |
| **Email.Expéditeur** | Chaîne de caractères contenant l'adresse de l'expéditeur.<br>Sous Lotus, si l'expéditeur n'est pas renseigné, le login lotus est utilisé.<br><br>Remarque : Si l'expéditeur contient des caractères spéciaux ou des accents, utilisez la constante **emailOptionEncodeEntête** lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br> |
| **Email.HTML** | Chaîne de caractères contenant le message avec une mise en forme HTML. Limité à 4 Go.<br>Ce membre est géré uniquement en POP3 / SMTP.<br><br> |
| **Email.ID** | Identifiant unique de l'email (chaîne de caractères). Cet identifiant est constant pour toute la durée de vie de l'email. Cet identifiant est initialisé lors de l'envoi de l'email (fonction [EmailEnvoieMessage](../WDLang3/3032005.md)).<br><br>Remarque : Si l'identifiant contient des caractères spéciaux ou des accents, utilisez la constante **emailOptionEncodeEntête** lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br>**Logiciel de messagerie Outlook et Lotus Notes uniquement**<br><br>![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Non disponible. |
| **Email.IdentifiantAttache** | Tableau de chaînes de caractères contenant l'identifiant des fichiers attachés inclus dans un message HTML.<br>Cette variable est renseignée uniquement lors de la réception d'un email.<br><br> |
| **Email.IdentifiantMail** | Identifiant de l'email (mode asynchrone uniquement)<br>WEBDEV uniquement<br><br>![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Non disponible. |
| **Email.Message** | Chaîne de caractères contenant le texte du message (avec une mise en forme texte simple). Limité à 2Go maximum (64Ko maximum dans le cas de Lotus Notes). <br><br>Remarque : Si le message contient des caractères spéciaux ou des accents, utilisez la constante **emailOptionEncodeEntête** lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md). |
| **Email.MessageID** | Identifiant unique de l'email (chaîne de caractères). Cet identifiant est constant pour toute la durée de vie de l'email. Cet identifiant est utilisé pour suivre une conversation.<br><br>**Lors d'un envoi**, cette variable précise l'identifiant de l'email. Si cette variable correspond à une chaîne vide, l'identifiant sera fourni par le serveur. C'est à l'application qui génère l'identifiant de s'assurer de l'unicité de cet identifiant.<br>Cette variable n'est prise en compte que si la variable **EmailOptionMessageID** est utilisée dans la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br>**Lors de la réception**, cette variable précise l'identifiant de l'email.<br>Cet identifiant est de la forme &lt;Identifiant@domaine&gt;. Par exemple : 1@192.168.2.210<br>Ce membre n'est pas géré sous Lotus Notes.<br>Ce membre n'est pas géré par Outlook sous Windows.<br><br> |
| **Email.NbAttache** | Entier indiquant le nombre de fichiers attachés au message. Le nombre de fichiers attachés est illimité.<br><br> |
| **Email.NbCc** | Entier correspondant au nombre de destinataires pour copie (limité à 200). <br>En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| **Email.NbCci (ou NbBcc)** | Entier correspondant au nombre de destinataires non officiels (limité à 200). <br>En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| **Email.NbDestinataire** | Entier contenant le nombre de destinataires du message. Le nombre de destinataires est limité à 20. <br>En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| **Email.Priorité** | Constante de type Entier contenant le type de priorité de l'email. Les valeurs possibles sont les suivantes :<br><br>- ***emailPrioritéBasse*** : utilisé par exemple pour les emails très peu urgents.<br><br>- ***emailPrioritéHaute*** : utilisé par exemple pour les emails urgents.<br><br>- ***emailPrioritéNormale*** (Valeur par défaut) : utilisé par exemple pour les emails non urgents.<br><br><br><br><br>Attention : Ce membre est géré uniquement en POP3 / SMTP.<br><br> |
| **Email.Référence** | Chaîne de caractères. Identifiant unique d'un ou de plusieurs emails de référence liés à la conversation en cours.<br>Ce membre n'est pas géré sous Lotus Notes.<br>Ce membre n'est pas géré par Outlook sous Windows.<br><br> |
| **Email.Signature** | Constante de type Entier correspondant à l'état de la signature de l'email :<br><br>- ***certificatExpiré*** : Signature valide mais certificat expiré.<br><br>- ***certificatInvalide*** : Signature ou certificat invalide.<br><br>- ***certificatNonFiable*** : Signature valide mais la racine de confiance du certificat est non fiable.<br><br>- ***certificatOK*** : Signature et certificat fiables.<br><br><br><br><br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Non disponible. |
| **Email.Source** | Chaîne de caractères contenant la source du message reçu (sujet, expéditeur, destinataire, contenu, ...).<br><br>Ce membre n'est pas géré par Outlook sous Windows.<br><br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Non disponible. |
| **Email.Sujet** | Chaîne de caractères contenant le sujet du message. <br><br>Remarque : Si le sujet contient des caractères spéciaux ou des accents, utilisez la constante **emailOptionEncodeEntête** lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md). |
| **Email.TexteBrut** | Chaîne de caractères contenant le texte brut du message. Cette variable est disponible en réception uniquement.<br><br> |


**Gestion avancée des emails** (mode SMTP uniquement) : Pour réaliser une description avancée des emails, il est possible d'accéder aux champs MIME Content-Type et Content-Description pour chaque fichier attaché fourni avec l'email.

Les variables correspondantes sont les suivantes :


|   |   |
| --- | --- |
| Email.AttacheContentDescription | Mode SMTP uniquement<br><br>Tableau de chaînes correspondant au contenu du champ MIME Content-description de chaque fichier attaché. Le nombre de fichiers attachés est illimité. |
| Email.AttacheContentType | Mode SMTP uniquement<br><br>Tableau de chaînes correspondant au contenu du champ MIME Content-type de chaque fichier attaché. Le nombre de fichiers attachés est illimité. |


Ces variables sont accessibles en lecture lors d'une réception et en écriture lors d'un envoi.

**Remarques** : 

- Si Email.Message et Email.HTML sont vides, et si le mail ne contient qu'un seul fichier attaché, les champs MIME content-Type et Content-description correspondront aux caractéristiques du fichier attaché.




- Il est possible d'utiliser des caractères non latins dans les variables suivantes : 

	- Email.Sujet

	- Email.Message

	- Email.Categorie

	- Email.AdresseExpediteur

	- Email.Expéditeur

	- Email.ID


 Dans ce cas, utilisez la constante **emailOptionEncodeEntête** lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).



<a name="NOTE2_2"></a>


### Accusé de réception d'email
<a name="accuse_reception_email_ELTPARAGRAPHE000563"></a>Deux variables permettent de gérer l'accusé de réception d'un email : ***Email.ConfimationLecture*** et ***Email.AccuséRéception***.

Certaines messageries reconnaissent uniquement ***Email.ConfirmationLecture***, d'autres reconnaissent les deux variables et effectuent des traitements spécifiques en fonction de la variable utilisée. 

***Email.ConfirmationLecture*** est la variable la plus reconnue par les messageries récentes, ***Email.AccuséRéception*** étant de moins en moins reconnue.

Pour rester compatible avec les messageries utilisant la seconde variable, les 2 variables sont conservées et différenciées. Il est conseillé d'utiliser ces deux variables (la variable prioritaire étant ***Email.ConfirmationLecture***).
<a name="NOTE2_3"></a>


### Variables de la structure email faisant partie de l'entête de l'email
<a name="variables_structure_email_faisant_partie_entete_email_ELTPARAGRAPHE000576"></a>Lors de la lecture de l'entête de l'email, la structure email est automatiquement mise à jour en fonction du contenu de l'entête du message.
Les variables suivantes sont vides :

- Email.Message

- Email.Attache

- Email.NbAttache

- Email.HTML

- Email.TexteBrut


Ces variables nécessitent une lecture complète du message (fonction [EmailLitMessage](../WDLang3/3032016.md)). Les variables Email.Bcc et Email.NbBcc servent uniquement à envoyer des emails.

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Quelles fonctions utilisent la structure email ?
<a name="quelles_fonctions_utilisent_structure_email_ELTTEXTE000845"></a>
Les fonctions utilisant la structure email sont :

| Nom de la fonction | Variables utilisées |
| --- | --- |
| [EmailEnvoie](../WDLang3/3032003.md) | Lors de l'envoi de l'email, seules les variables de la structure email nécessaires au protocole SMTP sont prises en compte. Les autres variables sont ignorées.<br>Variables utilisées : <br>Email.CC, Email.Destinataire, Email.Expéditeur, Email.NbCC, Email.NbDestinataire. |
| [EmailEnvoieMessage](../WDLang3/3032005.md) | *Variables utilisées en écriture* pour créer l'email : <br>Email.Attache, Email.Message, Email.Destinataire, Email.NbAttache, Email.NbDestinataire, Email.Sujet |
| [EmailLitPremier](../WDLang3/3032014.md) | *Variables utilisées en lecture* : <br>Email.AdresseExpéditeur, Email.Attache, Email.DateRéception, Email.EnDehors , Email.Message, Email.NbAttache et Email.Sujet |
| [EmailLitSuivant](../WDLang3/3032004.md) | *Variables utilisées en écriture* : <br>Email.AdresseExpéditeur, Email.Attache, Email.DateRéception, Email.EnDehors, Email.Message, Email.NbAttache et Email.Sujet |
| [EmailMiseAJour](../WDLang3/3032036.md) | Email.Erreur |
| [EmailOuvreSession](../WDLang3/3032028.md) | Email.Erreur |
| [EmailSupprimeMessage](../WDLang3/3032027.md) | Email.EnDehors |



<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Les valeurs de la variable Email.Erreur
<a name="les_valeurs_variable_emailerreur_ELTTEXTE000869"></a>
La variable Email.Erreur contient après chaque fonction le compte-rendu d'erreur de la fonction :

| Valeur | Signification |
| --- | --- |
| 0 | Aucune erreur |
| 1 | Abandon demandé par l'utilisateur |
| 2 | Erreur inconnue |
| 3 | Impossible de se connecter |
| 4 | Disque plein |
| 5 | Plus de mémoire disponible |
| 6 | Accès interdit |
| 8 | Trop de sessions ouvertes |
| 9 | Trop de fichiers attachés (10 fichiers maximum) |
| 10 | Trop de destinataires (20 destinataires maximum) |
| 11 | Fichier attaché non trouvé |
| 12 | Impossible d'ouvrir le fichier attaché |
| 13 | Impossible d'écrire le fichier attaché |
| 14 | Destinataire inconnu |
| 17 | Message invalide |
| 18 | Texte du message trop long |
| 19 | Session invalide |
| 21 | Adresse du destinataire ambiguë |
| 23 | Erreur réseau |




- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDMailingparemails.gif) ***Exemples didactiques (WINDEV)*** : **WD Mailing par emails** <br>Cet exemple illustre la possibilité d'envoyer un mailing par eMails avec WINDEV.<br>	<br>Cet exemple permet de saisir l'objet du message, son contenu et ses pièces jointes. <br>L'utilisateur doit ensuite sélectionner les clients auxquels le message doit être envoyé.<br>La fonction WLangage EMailEnvoieMessage() permet ensuite d'envoyer tout simplement le message saisi à chacun des clients sélectionnés.<br>Mise en œuvre technique :<br>Un serveur de mail compatible POP3/SMTP doit obligatoirement être accessible depuis le poste sur lequel s'exécute l'application.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Envoid'emails.gif) ***Exemples unitaires (WEBDEV)*** : **Envoi d'emails** <br>Envoi d'un email avec WEBDEV.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Envoid'unemailauformatHTML.gif) ***Exemples unitaires (WINDEV)*** : **Envoi d'un email au format HTML** <br>Utilisation de la fonction WLangage "EmailImporteHTML".<br>Cette fonction permet d'importer un fichier HTML directement dans la structure email. Cela permet notamment d'ajouter des images simplement dans des emails.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDJavaMail.gif) ***Exemples didactiques (WINDEV)*** : **WD JavaMail** <br>Cet exemple est un exemple Java permettant de de lire et envoyer des emails.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WW_CMS.gif) ***Exemples complets (WEBDEV)*** : **WW_CMS** <br>Cet exemple est un exemple de CMS (Content Management System).<br>C'est un site de gestion de contenu, typiquement un site d'affichage d'articles.<br><br>Cet exemple est découpé en 2 parties :<br>- Une partie AWP pour la partie qui doit être référencée<br>- Une partie WEBDEV Classique pour la partie administration<br><br>Note :<br>Pour que certaines fonctionnalités de l'exemple fonctionnent (l'envoi d'emails par exemple) il est nécessaire de modifier les paramètres afin de les adapter à votre configuration.<br>Ces paramètres sont stockés sous forme de constantes définies dans le code du projet.


