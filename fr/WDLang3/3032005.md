


## EmailEnvoieMessage (Fonction)

***En anglais : EmailSendMessage***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Envoie un email :

- soit en utilisant le **protocole SMTP** : l'email est directement envoyé au serveur. **L'envoi effectif est réalisé lors de la déconnexion du serveur SMTP** (c'est-à-dire lors de la fermeture de la session).

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) soit par l'intermédiaire du client **MS Exchange** : l'email est placé dans la boîte d'envoi de MS Exchange. Pour envoyer réellement l'email, utilisez la fonction [EmailMiseAJour](../WDLang3/3032036.md). 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) soit par l'intermédiaire du logiciel **Lotus Notes** : l'email est placé dans la boîte d'envoi du logiciel de messagerie. L'email est automatiquement envoyé par le spooler de Domino. 
	Attention : Lotus Notes doit être installé en mode connecté et non en mode local.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) soit par l'intermédiaire du logiciel **Outlook** : l'email est placé dans la boîte d'envoi du logiciel de messagerie. L'envoi effectif de l'email est réalisé à partir de Outlook. Pour plus de détails, consultez [Accéder à Outlook](../WDLang3/3032137.md).




**Attention** : Avant d'envoyer l'email, il est nécessaire de :

- Ouvrir une session avec l'une des fonctions suivantes : [EmailOuvreSession](../WDLang3/3032028.md), [EmailOuvreSessionOutlook](../WDLang3/3032128.md) ou [EmailOuvreSessionNotes](../WDLang3/3032121.md) selon le protocole à employer.

- Remplir une variable de type [Email](../WDLang3/1000018713.md) ou la structure [Email](../WDLang3/3032029.md) avec le message (expéditeur, destinataire, ...).


![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Dans cette version, il est possible d'envoyer un email uniquement en utilisant le protocole SMTP.






<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003032005&name=emailenvoiemessage_fonction&product=WD">Voir des exemples supplémentaires</a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) **Envoi d'un message par SMTP**

```wl
// Ouverture d'une session SMTP
MaSession est un emailSessionSMTP
MaSession.AdresseServeur = "smtp.masociete.fr"
EmailOuvreSession(MaSession)

// Construction d'un email
MonMessage est un Email
MonMessage.Expéditeur = "service_commande@masociete.fr"
Ajoute(MonMessage.Destinataire, "client@societe.com")
MonMessage.Sujet = SAI_SujetEmail
MonMessage.Message = SAI_TexteEmail

// Envoi du message
EmailEnvoieMessage(MaSession, MonMessage)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Envoyer un email en utilisant le protocole SMTP

`<Résultat> = EmailEnvoieMessage(<Session> [, <Email> [, <Options avancées>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le message a été envoyé au serveur SMTP, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.


![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) En cas d'erreur, il faut tester le contenu de la variable Email.Erreur.

**`<Session> : (Chaîne de caractères ou variable de type emailSessionSMTP)`**

Identifie la session d'un utilisateur. Correspond :

- au nom d'utilisateur utilisé pour ouvrir la session email (fonction [EmailOuvreSession](../WDLang3/3032028.md) ou [EmailOuvreSessionSMTP](../WDLang3/3032025.md)).

- à une variable de type [emailSessionSMTP](../WDLang3/1000018765.md).




**`<Email> : (Variable de type Email optionnelle)`**

Nom de la variable de type [Email](../WDLang3/1000018713.md) correspondant à l'email à envoyer. Si ce paramètre n'est pas spécifié, les informations contenues dans la structure [Email](../WDLang3/3032029.md) sont utilisées.
![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre n'est pas disponible.

**`<Options avancées> : (Constante optionnelle de type Entier)`**

Combinaison des constantes suivantes :


|   |   |
| --- | --- |
| *emailOptionEncodeEntête* | Encode les entêtes du message en Quoted-Printable si nécessaire. <br>Par défaut, les entêtes des messages ne sont pas encodés. Cette constante évite la réception de messages avec des accents mal décodés. |
| *emailOptionMessageID* | Tient compte de la variable **Email.MessageID** pour générer l'email. Si cette variable est absente, cette option est ignorée.<br><br>Cette option est une option avancée. |
| *emailOptionRéférence* | Tient compte de la variable **Email.Référence** pour générer l'email. Si cette variable est absente, cette option est ignorée.<br><br>Cette option est une option avancée. |




<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
### Envoyer un email par l'intermédiaire de MS Exchange, Lotus Notes ou Outlook

`<Résultat> = EmailEnvoieMessage(<Id session> [, <Email> [, <Afficher> [, <Type>]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le message a été placé dans la boîte d'envoi de MS Exchange, de Lotus Notes ou de Outlook, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.




**`<Id session> : (Entier ou variable de type emailSessionOutlook)`**

Identifie la session email en cours. Ce paramètre peut être :

- un entier renvoyé par une des fonctions suivantes : [EmailOuvreSession](../WDLang3/3032028.md), [EmailOuvreSessionNotes](../WDLang3/3032121.md) ou [EmailOuvreSessionOutlook](../WDLang3/3032128.md).

- une variable de type [emailSessionOutlook](../WDLang3/1000018767.md).

- une variable de type [emailSessionNotes](../WDLang3/1000018768.md).




**`<Email> : (Variable de type Email optionnelle)`**

Nom de la variable de type [Email](../WDLang3/1000018713.md) correspondant à l'email à envoyer.

Si ce paramètre n'est pas spécifié, les informations contenues dans la structure [Email](../WDLang3/3032029.md) sont utilisées.

**`<Afficher> : (Booléen optionnel)`**



- <u><u><u><u>Vrai</u></u></u></u> pour afficher le message dans une boîte de dialogue avant de l'envoyer, 

- <u><u><u><u>Faux</u></u></u></u> (par défaut) pour ne pas afficher de boîte de dialogue.




Ce paramètre est pris en compte uniquement si la session email a été ouverte à l'aide de la fonction [EmailOuvreSession](../WDLang3/3032028.md), en utilisant la syntaxe MS Exchange avec un nom de profile. Dans les autres cas, la boîte de dialogue ne s'affiche pas.

**Remarque** : Ce paramètre n'est pas disponible pour Lotus Notes. 

**`<Type> : (Chaîne de caractères optionnelle)`**

Décrit le type de message à envoyer. Par défaut, &lt;Type&gt; = "IPM" (Inter Personal Message).




<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
<a name="NOTE0_2"></a>
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Jauge de progression
<a name="jauge_progression_ELTPARAGRAPHE000445"></a>Pour suivre la progression de l'envoi de l'email, utilisez la fonction [EmailJauge](../WDLang3/3032017.md).


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Envoid'unemailauformatHTML.gif) ***Exemples unitaires (WINDEV)*** : **Envoi d'un email au format HTML** <br>Utilisation de la fonction WLangage "EmailImporteHTML".<br>Cette fonction permet d'importer un fichier HTML directement dans la structure email. Cela permet notamment d'ajouter des images simplement dans des emails.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Envoid'emails.gif) ***Exemples unitaires (WEBDEV)*** : **Envoi d'emails** <br>Envoi d'un email avec WEBDEV.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDMailingparemails.gif) ***Exemples didactiques (WINDEV)*** : **WD Mailing par emails** <br>Cet exemple illustre la possibilité d'envoyer un mailing par eMails avec WINDEV.<br>	<br>Cet exemple permet de saisir l'objet du message, son contenu et ses pièces jointes. <br>L'utilisateur doit ensuite sélectionner les clients auxquels le message doit être envoyé.<br>La fonction WLangage EMailEnvoieMessage() permet ensuite d'envoyer tout simplement le message saisi à chacun des clients sélectionnés.<br>Mise en œuvre technique :<br>Un serveur de mail compatible POP3/SMTP doit obligatoirement être accessible depuis le poste sur lequel s'exécute l'application.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDJavaMail.gif) ***Exemples didactiques (WINDEV)*** : **WD JavaMail** <br>Cet exemple est un exemple Java permettant de de lire et envoyer des emails.
- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WW_CMS.gif) ***Exemples complets (WEBDEV)*** : **WW_CMS** <br>Cet exemple est un exemple de CMS (Content Management System).<br>C'est un site de gestion de contenu, typiquement un site d'affichage d'articles.<br><br>Cet exemple est découpé en 2 parties :<br>- Une partie AWP pour la partie qui doit être référencée<br>- Une partie WEBDEV Classique pour la partie administration<br><br>Note :<br>Pour que certaines fonctionnalités de l'exemple fonctionnent (l'envoi d'emails par exemple) il est nécessaire de modifier les paramètres afin de les adapter à votre configuration.<br>Ces paramètres sont stockés sous forme de constantes définies dans le code du projet.

<a name="XComposante"></a>

## Composante :
wd280com.dll
