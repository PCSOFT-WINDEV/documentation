


## &lt;Variable zipArchive&gt;.ExtraitFichier (Fonction)

***En anglais : &lt;zipArchive variable&gt;.ExtractFile***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Extrait et décompresse automatiquement un fichier d'une archive à un emplacement physique ou en mémoire.



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
Archive est un zipArchive
// Ouverture d'une archive
ResOuvreArchive = Archive.Ouvre("C:\Archives\Archive.zip")

SI ResOuvreArchive = 0 ALORS
	...
	 // Extraction d'un fichier à son emplacement d'origine
	 ResExtraitFichier = Archive.ExtraitFichier("Fichier.txt", zipDisque)
	...
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Extraire un fichier identifié par son indice

`<Résultat> = <Archive>.ExtraitFichier(<Indice du fichier> [, <Destination du fichier> [, <Progression>]])`
---

**`<Résultat> : (Entier ou buffer)`**



- 0 si le fichier a été extrait, 

- Un code d'erreur (valeur supérieure à 0) dans le cas contraire. Pour plus de détails sur ces codes d'erreur, consultez les Remarques.




Lors d'une extraction "en mémoire", correspond au buffer contenant le fichier extrait.

**`<Archive> : (Variable de type zipArchive)`**

Nom d'une variable de type [zipArchive](../WDLang3/1000018679.md) correspondant à l'archive à manipuler.

**`<Indice du fichier> : (Entier)`**

Indice du fichier à extraire de l'archive.  Cet indice peut être connu grâce à la fonction [&lt;Variable zipArchive&gt;.ChercheFichier](../WDLang3/1000026330.md).

**`<Destination du fichier> : (Chaîne de caractères ou constante optionnelle)`**

Chemin de destination du fichier extrait :

- Chaîne de caractères optionnelle : Le fichier est extrait dans le chemin spécifié auquel s'ajoute l'arborescence mémorisée du fichier (le disque n'est pas conservé). Le chemin spécifié est créé s'il n'existe pas.
	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Le chemin destination du fichier extrait doit correspondre au répertoire de travail de l'application (connu avec la fonction [fRepDonnées](../WDLang1/3036001.md)) ou un de ses sous-répertoires.

- Constante optionnelle :
	


|   |   |
| --- | --- |
| *zipAucun* | Extraction dans le répertoire en cours sans restauration de l'arborescence du fichier (si elle a été mémorisée). |
| *zipDisque* | Extraction :<br><br>	- à l'emplacement d'origine du fichier s'il a été mémorisé et si le disque existe.<br><br>	- avec restauration de l'arborescence du fichier sur le disque en cours si le disque ou si le répertoire mémorisé n'existe pas.<br><br>	- dans le répertoire en cours si seuls le nom et l'extension du fichier ont été mémorisés.<br><br><br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png) Cette constante n'est pas disponible. Les répertoires n'ont pas de racine.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Cette constante aura le même effet que la constante *zipRépertoire*.**Archives au format 7z** :  Cette constante aura le même effet que la constante *zipRépertoire*. |
| *zipEnMémoire* | Extraction du fichier en mémoire. Le contenu du fichier est renvoyé directement par la fonction. Il peut être affecté à une variable de type Buffer par exemple.<br>Cette fonctionnalité est disponible uniquement pour les archives au format ZIP et WDZ. |
| *zipRépertoire*<br>(Valeur par défaut) | Extraction dans le répertoire en cours avec restauration de l'arborescence du fichier (si elle a été mémorisée). |


	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Il n'est pas possible d'utiliser ces constantes.




**`<Progression> : (Nom de champ ou nom de procédure)`**

Mode de gestion de la jauge. Ce paramètre peut correspondre : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) au nom d'un champ Jauge présent dans une fenêtre. Cette jauge affichera la progression de l'extraction du fichier manipulé.  

- au nom d'une procédure WLangage. Cette procédure est de la forme : 
	
	```txt
	<Nom de la procédure> (<Fichier en cours>, <Pourcentage d'avancement>)
	```

	où : 

	- &lt;Fichier en cours&gt; correspond au nom du fichier en cours de traitement. 

	- &lt;Pourcentage d'avancement&gt; correspond au pourcentage d'avancement de l'extraction du fichier en cours depuis l'archive. 







Attention : La jauge est mise à jour uniquement à la fin de l'extraction du fichier pour les archives de type : 

- TAR ou TGZ (TAR.GZ),

- RAR,

- CAB.





<a name="SYNTAXE2"></a>

### Extraire un fichier identifié par son chemin

`<Résultat> = <Archive>.ExtraitFichier(<Chemin du fichier> [, <Destination du fichier> [, <Progression>]])`
---

**`<Résultat> : (Entier ou buffer)`**



- 0 si le fichier a été extrait, 

- Un code d'erreur (valeur supérieure à 0) dans le cas contraire. Pour plus de détails sur ces codes d'erreur, consultez les Remarques.




Lors d'une extraction "en mémoire", correspond au buffer contenant le fichier extrait.

**`<Archive> : (Variable de type zipArchive)`**

Nom d'une variable de type [zipArchive](../WDLang3/1000018679.md) correspondant à l'archive à manipuler.

**`<Chemin du fichier> : (Chaîne de caractères)`**

Chemin mémorisé du fichier à extraire de l'archive. Effectue une recherche à l'identique sur le chemin du fichier dans l'archive.

**`<Destination du fichier> : (Chaîne de caractères ou constante optionnelle)`**

Chemin de destination du fichier extrait :

- Chaîne de caractères optionnelle : Le fichier est extrait dans le chemin spécifié auquel s'ajoute l'arborescence mémorisée du fichier (le disque n'est pas conservé). Le chemin spécifié est créé s'il n'existe pas.
	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Le chemin destination du fichier extrait doit correspondre au répertoire de travail de l'application (connu avec la fonction [fRepDonnées](../WDLang1/3036001.md)) ou un de ses sous-répertoires.

- Constante optionnelle :
	


|   |   |
| --- | --- |
| *zipAucun* | Extraction dans le répertoire en cours sans restauration de l'arborescence du fichier (si elle a été mémorisée). |
| *zipDisque* | Extraction :<br><br>	- à l'emplacement d'origine du fichier s'il a été mémorisé et si le disque existe.<br><br>	- avec restauration de l'arborescence du fichier sur le disque en cours si le disque ou si le répertoire mémorisé n'existe pas.<br><br>	- dans le répertoire en cours si seuls le nom et l'extension du fichier ont été mémorisés.<br><br><br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png) Cette constante n'est pas disponible. Les répertoires n'ont pas de racine.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Cette constante aura le même effet que la constante *zipRépertoire*.**Archives au format 7z** :  Cette constante aura le même effet que la constante *zipRépertoire*. |
| *zipEnMémoire* | Extraction du fichier en mémoire. Le contenu du fichier est renvoyé directement par la fonction. Il peut être affecté à une variable de type Buffer par exemple.<br>Cette fonctionnalité est disponible uniquement pour les archives au format ZIP et WDZ. |
| *zipRépertoire*<br>(Valeur par défaut) | Extraction dans le répertoire en cours avec restauration de l'arborescence du fichier (si elle a été mémorisée). |


	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Il n'est pas possible d'utiliser ces constantes.




**`<Progression> : (Nom de champ ou nom de procédure)`**

Mode de gestion de la jauge. Ce paramètre peut correspondre : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) au nom d'un champ Jauge présent dans une fenêtre. Cette jauge affichera la progression de l'extraction du fichier manipulé. 

- au nom d'une procédure WLangage. Cette procédure est de la forme : 
	
	```txt
	<Nom de la procédure> (<Fichier en cours>, <Pourcentage d'avancement>)
	```

	où : 

	- &lt;Fichier en cours&gt; correspond au nom du fichier en cours de traitement. 

	- &lt;Pourcentage d'avancement&gt; correspond au pourcentage d'avancement de l'extraction du fichier en cours depuis l'archive. 







Attention : La jauge est mise à jour uniquement à la fin de l'extraction du fichier pour les archives de type : 

- TAR ou TGZ (TAR.GZ),

- RAR,

- CAB.






<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Codes d'erreur
<a name="codes_erreur_ELTPARAGRAPHE000521"></a>Les codes d'erreur retournés sont les suivants :

- 1 : Le chemin passé en paramètre n'existe pas.

- 2 : Accès interdit : l'utilisateur n'a pas les droits nécessaires.

- 3 : L'archive est corrompue.

- 4 : Le chemin n'existe pas dans l'archive.

- 6 : Les fichiers des sous-archives ne sont pas dans l'ordre (cas d'une extraction dans une archive multi-parties).

- 21 : Le mot de passe spécifié n'est pas correct.




Le message correspondant au code d'erreur peut être connu grâce à la fonction [zipMsgErreur](../WDLang3/3082034.md).
Rappel : 

- ![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Seules les archives au format ZIP, TAR et TGZ (TAR.GZ) sont disponibles.

- ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Seules les archives au format ZIP sont disponibles.

- Le format RAR est géré jusqu'à la version 4 incluse.



<a name="NOTE0_2"></a>


### Fichier extrait
<a name="fichier_extrait_ELTPARAGRAPHE000552"></a>Le fichier extrait n'est pas effacé de l'archive. Pour effacer un ou tous les fichiers de l'archive, utilisez la fonction [&lt;Variable zipArchive&gt;.SupprimeFichier](../WDLang3/1000019152.md) ou [&lt;Variable zipArchive&gt;.SupprimeTout](../WDLang3/1000019154.md).
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Extraction et mot de passe
<a name="extraction_mot_passe_ELTPARAGRAPHE000574"></a>Si le fichier n'est pas crypté et si la fonction [zipMotDePasse](../WDLang3/3082053.md) a été utilisée :

- Archive au format WDZ : Le fichier est tout de même extrait.

- Archive au format ZIP : Une erreur apparaît.



<a name="NOTE0_4"></a>


### Indice des fichiers dans l'archive
<a name="indice_des_fichiers_dans_archive_ELTPARAGRAPHE000590"></a>Lors de l'ajout d'un fichier dans une archive, un indice est automatiquement attribué au fichier. Cet indice correspond à l'ordre d'intégration des fichiers dans l'archive. Pour sélectionner un fichier de l'archive, il est possible d'utiliser :

- soit l'indice de l'élément (l'indice d'un élément peut être connu grâce à la fonction [&lt;Variable zipArchive&gt;.ChercheFichier](../WDLang3/1000026330.md)).

- soit le chemin mémorisé de l'élément.



<a name="NOTE0_5"></a>


### Chemin mémorisé
<a name="chemin_memorise_ELTPARAGRAPHE000608"></a>Le tableau ci-dessous présente les chemins mémorisés dans l'archive en fonction :

- du chemin d'accès du fichier,

- de la portion mémorisée du chemin.




Le répertoire en cours est : "C:\\Temp".


|   |   |   |   |   |
| --- | --- | --- | --- | --- |
| **Fonction zipAjouteFichier** | **Localisation du fichier** | *zipAucun* | *zipRépertoire* | *zipDisque* |
| zipAjouteFichier("Archi",...<br>"Fichier.txt") | C:\\Temp\\Fichier.txt | Fichier.txt | Fichier.txt | Fichier.txt |
| zipAjouteFichier("Archi",...<br>"Donnée\\Fichier.txt") | C:\\Temp\\Donnée\\Fichier.txt | Fichier.txt | Donnée\\Fichier.txt | Donnée\\Fichier.txt |
| zipAjouteFichier("Archi",...<br>"D:\\Donnée\\Fichier.txt") | D:\\Donnée\\Fichier.txt | Fichier.txt | Donnée\\Fichier.txt | D:\\Donnée\\Fichier.txt |


**Remarque** : Si la constante *zipDisque* est utilisée : 

- le format WDZ mémorise le chemin complet du fichier (lettre du lecteur comprise). 

- le format ZIP ne mémorise pas la lettre du lecteur.

- le format 7z mémorise uniquement les répertoires.


![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) La constante *zipDisque*est identique à la constante *zipRépertoire*.![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Le répertoire et le disque ne sont pas mémorisés dans le chemin de l'archive. Seuls le nom du fichier et son extension sont mémorisés. 

<a name="XComposante"></a>

## Composante :
wd280zip.dll
