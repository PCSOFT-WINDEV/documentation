
## DéclareContexteWebservice (Fonction)

***En anglais : DeclareWebserviceContext***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Permet de déclarer une liste de variables dont la valeur sera persistante entre les appels successifs à un Webservice. Cette fonction indique quelles variables sauver et restaurer lors de chaque appel au webservice. Il est ainsi possible de gérer un contexte dans le webservice. 

La gestion des contextes est réalisée sur disque. Pour plus de détails, consultez [Générer un Webservice](../WDLang3/3086002.md). 

La fonction **DéclareContexteWebservice** est prise en compte uniquement lors de l'exécution de Webservices déployés sur le serveur d'application WEBDEV (Webservice en .AWWS).

Il est conseillé d'utiliser cette fonction dans l'événement "Initialisation" du projet (pour les variables du projet) et / ou dans le code d'initialisation des collections de procédures ou des classes. En règle générale, il faut utiliser cette fonction dans le traitement où sont déclarées et initialisées les variables.
Si votre projet utilise les sessions prélancées, cette fonction ne doit pas être utilisée dans l'événement "Initialisation" du projet. Cette fonction doit être utilisée dans l'événement "Initialisation du projet après connexion au site". 

**Attention** : 

- Cette fonction est destinée aux développeurs maîtrisant WINDEV/WEBDEV.

- Par défintion, un webservice REST est sans contexte. Cette fonction ne peut donc pas être utilisée dans un webservice REST. 



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000019652&name=declarecontextewebservice_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
// -- Evénement "Initialisation" du projet 
gnNumProduitEnCours est un entier = 1

// On indique que l'on souhaite sauver la valeur de gnNumProduitEnCours
// à chaque appel du Webservice
DéclareContexteWebservice(gnNumProduitEnCours)

// Lors des prochains appels du Webservice :
// - soit la valeur gnNumProduitEnCours n'est pas récupérée 
// et elle est automatiquement réinitialisée avec "1"
// (par exemple, lors du premier appel par un nouveau client)
// - soit la valeur gnNumProduitEnCours est récupérée et utilisée
// (par exemple, lors d'appels successifs par un même client)
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = DéclareContexteWebservice(<Nom de la variable 1> [, <Nom de la variable 2> [... [, <Nom de la variable N>]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la ou les variables indiquées ont bien été restaurées, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire (lors du premier appel du Webservice par exemple).




**`<Nom de la variable 1> : (Type de la variable)`**

Nom de la première variable à sauver à la fin de l'affichage. La valeur de cette variable sera récupérée lors des appels successifs du Webservice.

**`<Nom de la variable 2> : (Type de la variable)`**

Nom de la seconde variable à sauver à la fin de l'affichage. La valeur de cette variable sera récupérée lors des appels successifs du Webservice.



**`<Nom de la variable N> : (Type de la variable)`**

Nom de la Nième variable à sauver à la fin de l'affichage. La valeur de cette variable sera récupérée lors des appels successifs du Webservice.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Fonctionnement
<a name="fonctionnement_ELTPARAGRAPHE000066"></a>

- Le contexte est toujours sauvé sur le disque et transmis via un entête SOAP.

- La fonction **DéclareContexteWebservice** utilise les contextes sur disque. Les valeurs des variables sont toujours restaurées.

- La taille totale des valeurs des différentes variables n'est pas limitée.

- La fonction **DéclareContexteWebservice** peut être utilisée pour des données sensibles (mot de passe de l'utilisateur par exemple).

- Si deux variables sauvées ont le même nom (par exemple une dans le projet et l'autre dans une page), les deux variables sont mémorisées indépendamment.

- La fonction **DéclareContexteWebservice** renvoie <u><u><u><u>Faux</u></u></u></u> si une des variables n'a pas été restaurée.

- Toutes les variables passées à la fonction **DéclareContexteWebservice** lors de l'appel d'un Webservice pourront être récupérées lors de l'appel suivant. Les variables passées précédemment sont automatiquement sauvegardées une nouvelle fois.

- Les variables de type simple (entier, chaîne, ...) sont gérées, ainsi que les variables de type structure, classe, tableau ou tableau associatif. 

- Ne sont pas gérés : les tableaux fixes, les membres globaux de classes, les tableaux associatifs de structures locales et les types avancés du WLangage (comme par exemple les variables de type Connexion).







### Cas particulier : Utilisation d'un WebService intermédiaire
<a name="cas_particulier_utilisation_webservice_intermediaire_ELTPARAGRAPHE000096"></a>Dans certains cas, il peut être nécessaire d'utiliser un Webservice intermédiaire pour utiliser les variables. 

Examinons le cas suivant : 

- Un Webservice "WS1" utilise la fonction **DéclareContexteWebservice** pour une variable globale "globaleChaine". Ce Webservice contient 2 fonctions: 

	- "Ecrit(param)" qui affecte le "param" dans "globaleChaine" 

	- "Lit()" qui renvoie le contenu de "globaleChaine".




- Un exécutable client, consommateur de WS1, appelle "WS1.Ecrit("Coucou")", puis "WS1.Lit()" récupère bien la chaîne envoyée.

- Un Webservice intermédiaire "WS2", consommateur de WS1, contient 2 fonctions : 

	- "Ecrit(param)" qui appelle "WS1.Ecrit()".

	- "Lit()" qui appelle "WS1.Lit()".




- Un exécutable client, consommateur de WS2, appelle "WS2.Ecrit("Coucou")", puis "WS2.Lit()" NE récupère PAS la chaîne envoyée.




Solution : Dans le Webservice WS2, utiliser une fonction "EcritLit()" qui fait "WS1.Ecrit()" et "WS1.Lit()" dans le même traitement.



<a name="XComposante"></a>

## Composante :
wd280awws.dll
