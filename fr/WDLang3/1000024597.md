
## FTPRécupèreFichier (Fonction)

***En anglais : FTPGetFile***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Transfère un fichier d'un serveur FTP (File Transfer Protocol) sur le poste en cours. 

Remarque : Cette fonction permet de récupérer uniquement un seul fichier. Ce fichier doit exister sur le serveur FTP. Dans ce cas, la fonction **FTPRécupèreFichier** est plus rapide que la fonction [FTPRécupère](../WDLang3/3040002.md). 
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Récupération du fichier "/Document/Fichier.txt" présent sur le serveur FTP 
// dans le répertoire "D:\Temp" sur le poste en cours 
ResRécupère = FTPRécupèreFichier(7, "/Document/Fichier.txt", "D:\Temp")
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = FTPRécupèreFichier(<Identifiant de la connexion> , <Fichier à récupérer> , <Fichier/Répertoire destination> [, <Procédure WLangage> [, <Mode de transfert>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le transfert a été effectué, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md) avec la constante *errMessage*.
	Remarque : Le résultat peut être incorrect sur certains serveurs Unix : un fichier existant peut ne pas être trouvé.




**`<Identifiant de la connexion> : (Entier)`**

Identifiant de la connexion, obtenu avec la fonction [FTPConnecte](../WDLang3/3040016.md).

**`<Fichier à récupérer> : (Chaîne de caractères)`**

Nom et chemin absolu (ou relatif) du fichier à récupérer. Ce fichier est situé sur le serveur FTP. Les parties du chemin sont séparées par des "slash" (barre oblique normale, "/"). 
Attention : le nom du répertoire est case sensitive. Il faut utiliser la même casse que sur le serveur FTP (majuscules/minuscules). 
Il n'est pas possible de donner de caractères joker (\* ou ?). Pour récupérer plusieurs fichiers, utilisez préalablement la fonction [FTPListeFichier](../WDLang3/3040018.md) pour avoir le nom des fichiers à récupérer.
					
Un chemin absolu est du type "#XLTXLT#NomFichier&gt;". L'arborescence obtenue est "/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;".
Un chemin relatif est du type "&lt;NomRépertoire&gt;/&lt;NomFichier&gt;". L'arborescence obtenue est "/&lt;RépertoireCourantServeur&gt;/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;".
									
**Lors de la récupération du fichier** :

- si le paramètre &lt;Fichier/Répertoire destination&gt; est un répertoire existant sur le poste en cours, le fichier à récupérer est copié dans le répertoire destination.

- si le paramètre &lt;Fichier/Répertoire destination&gt; est un fichier existant sur le poste en cours, le fichier à récupérer est copié et renommé.




**`<Fichier/Répertoire destination> : (Chaîne de caractères)`**

Nom et chemin complet (ou relatif) du fichier (ou du répertoire) destination. Un chemin de type UNC peut être utilisé.

Si ce paramètre correspond à un nom d'un répertoire existant sur le poste client, un fichier du même nom que le fichier à récupérer est créé dans ce répertoire.

**`<Procédure WLangage> : (Nom de procédure)`**

Nom d'une procédure WLangage appelée automatiquement pour contrôler la progression du transfert. Cette procédure peut être une méthode globale de classe (de la forme &lt;Nom Classe&gt;::&lt;NomMéthodeGlobale&gt;).

**`<Mode de transfert> : (Constante optionnelle de type Entier)`**

Mode de transfert réalisé :					


|   |   |
| --- | --- |
| *ftpModeASCII* | Transfert réalisé en mode ASCII. Ce mode est utilisé pour un transfert entre deux systèmes d'exploitation différents, par exemple UNIX vers Windows : le fichier transféré est livré dans le format ASCII du système destinataire. |
| *ftpModeBinaire*<br>(Valeur par défaut) | Transfert réalisé en mode binaire. Le fichier est strictement identique entre l'envoi et la réception. |








## Remarques


### Gestion de la progression de transfert
<a name="gestion_progression_transfert_ELTPARAGRAPHE000093"></a>La fonction **FTPRécupèreFichier** est une fonction bloquante : aucune autre action ne peut être effectuée jusqu'à la fin du transfert en cours. 

Pour contrôler la progression du transfert, la fonction **FTPRécupèreFichier** peut appeler automatiquement une procédure WLangage &lt;Procédure WLangage&gt; à intervalles réguliers (tous les 64 Ko).

Cette procédure est déclarée de la manière suivante :

```txt
PROCEDURE <Nom de la procédure> (<Taille totale>, <Taille transférée>)
```


où : 						

- &lt;Taille totale&gt; est un entier correspondant à la taille totale du fichier en cours de transfert.

- &lt;Taille transférée&gt; est un entier correspondant au nombre d'octets déjà transférés.




Il est possible dans cette procédure :

- d'afficher une jauge de progression (via un champ Jauge par exemple),			

- de savoir si le transfert est terminé (&lt;Taille totale&gt;=&lt;Taille transférée&gt;).




La fonction **FTPRécupèreFichier** ne peut pas être interrompue tant que le transfert n'est pas terminé. Pour forcer l'interruption du parcours, il faut utiliser la ligne suivante dans la procédure &lt;Nom de la procédure&gt; :	


```wl
RENVOYER Faux
```


Dans les autres cas (pour poursuivre le parcours), la procédure &lt;Nom de la procédure&gt; DOIT renvoyer <u><u><u><u>Vrai</u></u></u></u>.

Si la procédure &lt;Nom de la procédure&gt; ne retourne aucune valeur (ni <u><u><u><u>Vrai</u></u></u></u>, ni <u><u><u><u>Faux</u></u></u></u>), une erreur est générée.
<a name="NOTE0_2"></a>


### Délai de transfert
<a name="delai_transfert_ELTPARAGRAPHE000144"></a>Par défaut, toutes les fonctions FTP échouent si aucune réponse du serveur FTP n'est reçue après 20 secondes. Ce délai peut être modifié lors de la connexion au serveur FTP avec la fonction [FTPConnecte](../WDLang3/3040016.md).
<a name="NOTE0_4"></a>


### Droits des utilisateurs
<a name="droits_des_utilisateurs_ELTPARAGRAPHE000172"></a>La récupération des fichiers présents sur un serveur FTP n'est possible que pour un utilisateur ayant les droits en lecture sur le serveur FTP. En règle générale, les utilisateurs "anonymes" ont les droits en lecture.					



<a name="NOTE0_5"></a>


### Chemin relatif et absolu
<a name="chemin_relatif_absolu_ELTPARAGRAPHE000180"></a>Les notions de chemin relatif et de chemin absolu sont très importantes dans une application FTP.

- Un chemin commençant par un slash est considéré comme un **chemin absolu** : il s'agit du chemin par rapport à la racine du serveur FTP (paramètre propre au serveur).
	ex: /pub/user/JULIE

- Si le chemin ne commence pas par un slash, il est considéré comme un **chemin relatif**, c'est-à-dire le chemin par rapport au répertoire en cours. Ce répertoire en cours peut être connu ou modifié avec la fonction [FTPRepEnCours](../WDLang3/3040003.md).




Lors de la connexion à un site FTP, le répertoire initial, le "home directory" de l'utilisateur n'est pas forcément la racine du serveur FTP. Il est donc conseillé d'utiliser des chemins relatifs.




<a name="NOTE0_7"></a>


### Serveur FTP de type AS/400
<a name="serveur_ftp_type_as400_ELTPARAGRAPHE000198"></a>La fonction **FTPRécupèreFichier** ne fonctionne pas correctement si le serveur FTP est présent sur un AS/400.

Dans ce cas, il convient d'utiliser la fonction [FTPCommande](../WDLang3/3040017.md) avec la commande FTP "RETR" (pour plus de détails sur les fonctions FTP, consultez la documentation du serveur FTP utilisé).





<a name="XComposante"></a>

## Composante :
wd280com.dll
