


## &lt;Variable mqttSession&gt;.Abonne (Fonction)

***En anglais : &lt;mqttSession variable&gt;.Subscribe***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Permet de s'abonner à une notification MQTT. 

Remarque : Cet abonnement peut être arrêté grâce aux fonctions [&lt;Variable mqttSession&gt;.Désabonne](../WDLang3/1000023086.md) et [&lt;Variable mqttSession&gt;.DésabonneTout](../WDLang3/1000023090.md). 


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
gMqttSession est un mqttSession
...
lbRésultat est un booléen
lbRésultat = gMqttSession.Abonne("sensors/sensor1/temprature1", mqttQualitéAuMoinsUneFois, ...
	Proc_MQTTAbonne)

PROCÉDURE INTERNE Proc_MQTTAbonne(pMqttSession est un mqttSession, ...
	Topic est une chaîne, unbuffer est un Buffer)
		Trace("Abonnement")
FIN
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = <Session MQTT>.Abonne(<Sujet> , <Qualité> , <Procédure>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'abonnement est mis en place,

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire.




**`<Session MQTT> : (Variable de type mqttSession)`**

Nom de la variable [mqttSession](../WDLang3/1000023023.md) correspondant à la session MQTT à manipuler.

**`<Sujet> : (Chaîne de caractères)`**

Sujet pour lequel l'abonnement est demandé.

**`<Qualité> : (Constante de type Entier)`**

Qualité demandée :


|   |   |
| --- | --- |
| *mqttQualitéAuMoinsUneFois* | Le message sera délivré au moins une fois. Le client transmettra le message plusieurs fois s'il le faut jusqu'à ce que le serveur (Broker) lui confirme que le message a été transmis sur le réseau. |
| *mqttQualitéAuPlusUneFois* | Le message sera délivré tout au plus une fois. Le message n'est pas stocké. Il est envoyé sans garantie de réception. Le serveur MQTT (broker) n'informe pas l'expéditeur qu'il a reçu le message. Le message peut être perdu si le client se déconnecte ou si le serveur s'arrête. |
| *mqttQualitéExactementUneFois* | Le message sera obligatoirement sauvegardé par l'émetteur. Il sera transmis tant que le récepteur ne confirme pas son envoi sur le réseau. L'émetteur utilise une phase de reconnaissance sophistiquée avec le serveur (broker) pour éviter une duplication des messages. Ce mode est plus lent mais plus sûr. |



**`<Procédure> : (Nom de procédure WLangage)`**

Nom de la procédure WLangage (également nommée "callback") exécutée à chaque nouvelle notification. 
**Il doit s'agir d'une procédure globale au projet** : l'utilisation d'une procédure interne n'est pas autorisée. Cette procédure est de la forme :

```txt
PROCEDURE <Nom de la procédure>(<Connexion> est un mqttSession, 
<Sujet> est une chaîne, <Message> est un Buffer)
```
où : 

- &lt;Connexion&gt; correspond à une variable [mqttSession](../WDLang3/1000023023.md) contenant les caractéristiques de la session MQTT. 

- &lt;Sujet&gt; correspond au sujet du message. 

- &lt;Message&gt; correspond au contenu du message.






<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280com.dll
