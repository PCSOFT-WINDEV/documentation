


## FTPEnvoie (Fonction)

***En anglais : FTPSend***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Transfère un fichier ou un répertoire sur un serveur FTP (File Transfer Protocol).



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003040014&name=ftpenvoie_fonction&product=WD">Voir des exemples supplémentaires</a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Transfert du fichier "C:\MesDocuments\Fichier.DOC"
// dans le répertoire "/Temp" sur le serveur FTP
ResEnvoie = FTPEnvoie(NumConnexion, "C:\MesDocuments\Fichier.DOC", "/Temp")
```
<a name="Exemple2"></a>

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = FTPEnvoie(<Identifiant de la connexion> , <Fichier/Répertoire à transférer> , <Fichier/Répertoire destination> [, <Procédure WLangage> [, <Mode de transfert>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le transfert a été effectué, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Le compte-rendu d'erreur détaillé peut être obtenu avec la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Identifiant de la connexion> : (Entier)`**

Identifiant de la connexion, obtenu avec la fonction [FTPConnecte](../WDLang3/3040016.md).


**`<Fichier/Répertoire à transférer> : (Chaîne de caractères)`**

Nom et chemin complet (ou relatif) du fichier (ou du répertoire) à transférer. Un chemin de type UNC peut être utilisé. Il n'est pas possible d'utiliser des caractères joker (\* ou ?).
***Si ce paramètre correspond à un répertoire***, tous les fichiers de ce répertoire sont transférés. Un répertoire de même nom est créé sur le serveur FTP à l'emplacement désigné par le paramètre &lt;Fichier/Répertoire destination&gt;.
***Si ce paramètre correspond à un fichier*** :

- Si le paramètre &lt;Fichier/Répertoire destination&gt; est un répertoire existant sur le serveur FTP, le fichier à transférer est copié dans le répertoire destination.

- Si le paramètre &lt;Fichier/Répertoire destination&gt; est un fichier existant sur le serveur FTP, le fichier à transférer est copié et renommé.




**`<Fichier/Répertoire destination> : (Chaîne de caractères)`**

Nom et chemin absolu (ou relatif) du fichier (ou du répertoire) destination. Ce fichier (ou ce répertoire) est situé sur le serveur FTP. Les parties du chemin sont séparées par des "slash" (barre oblique normale, "/").
Un chemin absolu est du type "/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;". L'arborescence obtenue est "/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;".
Un chemin relatif est du type "&lt;NomRépertoire&gt;/&lt;NomFichier&gt;". L'arborescence obtenue est "/&lt;RépertoireCourantServeur&gt;/&lt;NomRépertoire&gt;/&lt;NomFichier&gt;".

**`<Procédure WLangage> : (Nom de procédure)`**

Nom d'une procédure appelée automatiquement pour contrôler la progression du transfert.


**`<Mode de transfert> : (Constante optionnelle de type Entier)`**

Mode de transfert réalisé :


|   |   |
| --- | --- |
| *ftpModeASCII* | Transfert réalisé en mode ASCII. Ce mode est utilisé pour un transfert entre deux systèmes d'exploitation différents, par exemple UNIX vers Windows : le fichier transféré est livré dans le format ASCII du système destinataire. |
| *ftpModeBinaire*<br>(Valeur par défaut) | Transfert réalisé en mode binaire : Le fichier est strictement identique entre l'envoi et la réception. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 

### Gestion de la progression de transfert
<a name="gestion_progression_transfert_ELTPARAGRAPHE000116"></a>La fonction **FTPEnvoie** est une fonction bloquante : aucune autre action ne peut être effectuée jusqu'à la fin du transfert en cours. Pour contrôler la progression du transfert, la fonction **FTPEnvoie** peut appeler automatiquement la procédure &lt;Nom de la procédure&gt; à intervalles réguliers.

Cette procédure est déclarée de la manière suivante :

```txt
PROCEDURE <Nom de la procédure> (<Taille totale>, <Taille transférée>)
```


- &lt;Taille totale&gt; est un entier correspondant à la taille totale du fichier ou du répertoire en cours de transfert.

- &lt;Taille transférée&gt; est un entier correspondant au nombre d'octets déjà transférés.




Par exemple, il est possible :

- d'afficher une jauge de progression,

- de savoir si le transfert est terminé (dans ce cas, &lt;Taille totale&gt;=&lt;Taille transférée&gt;).




La fonction **FTPEnvoie** ne peut pas être interrompue tant qu'il reste des fichiers à transférer. Pour forcer l'interruption du parcours, utilisez la ligne suivante dans la procédure &lt;Nom de la procédure&gt; :

```wl
RENVOYER Faux
```
Dans les autres cas (pour poursuivre le parcours), la procédure &lt;Nom de la procédure&gt; DOIT renvoyer <u><u><u><u>Vrai</u></u></u></u>.

Si aucune valeur (ni <u><u><u><u>Vrai</u></u></u></u>, ni <u><u><u><u>Faux</u></u></u></u>) n'est retournée par la procédure &lt;Nom de la procédure&gt;, une erreur est générée.
<a name="NOTE0_2"></a>


### Délai de transfert
<a name="delai_transfert_ELTPARAGRAPHE000161"></a>Par défaut, toutes les fonctions FTP échouent si aucune réponse du serveur FTP n'est reçue après 20 secondes. Ce délai peut être modifié lors de la connexion au serveur FTP avec la fonction [FTPConnecte](../WDLang3/3040016.md).
<a name="NOTE0_3"></a>
<a name="NOTE0_4"></a>


### Droits des utilisateurs
<a name="droits_des_utilisateurs_ELTPARAGRAPHE000190"></a>L'envoi de fichiers sur un serveur FTP n'est possible que pour un utilisateur ayant les droits en écriture sur le serveur FTP. En règle générale, les utilisateurs "anonymes" n'ont pas les droits en écriture.
<a name="NOTE0_5"></a>


### Chemin relatif et absolu
<a name="chemin_relatif_absolu_ELTPARAGRAPHE000197"></a>Les notions de chemin relatif et de chemin absolu sont très importantes dans une application FTP.

- Un chemin commençant par un slash est considéré comme un **chemin absolu** : il s'agit du chemin par rapport à la racine du serveur FTP (paramètre propre au serveur).
	ex: /pub/user/JULIE

- Si le chemin ne commence pas par un slash, il est considéré comme un **chemin relatif**, c'est-à-dire le chemin par rapport au répertoire en cours. Ce répertoire en cours peut-être connu ou modifié avec la fonction [FTPRepEnCours](../WDLang3/3040003.md).


Lors de la connexion à un site FTP, le répertoire initial, le "home directory" de l'utilisateur n'est pas forcément la racine du serveur FTP. Il est donc conseillé d'utiliser des chemins relatifs.

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280com.dll
