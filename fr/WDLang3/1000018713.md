


## Email (Type de variable)

***En anglais : Email***
				



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Le type **Email** permet de manipuler le contenu d'un message électronique et les informations associées. Les caractéristiques de l'email peuvent être définies et modifiées à l'aide de différentes propriétés WLangage.

Ce type remplace et étend la structure [Email](../WDLang3/3032029.md) en permettant, par exemple, de manipuler plusieurs messages en même temps.

**Remarque** : Pour plus de détails sur la déclaration de ce type de variable et l'utilisation des propriétés WLangage, consultez [Déclaration d'une variable](../Motscles/1514032.md).




<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Envoi d'un email

// Construction du message
MonMessage est un Email

// Expéditeur
MonMessage.Expediteur = sExpediteur

// Destinataires
sDestinataire_1 est une chaîne = "aaa@gmail.com"
sDestinataire_2 est une chaîne = "bbb@gmail.com"
Ajoute(MonMessage.Destinataire, sDestinataire_1)
Ajoute(MonMessage.Destinataire, sDestinataire_2)


// Contenu du message
MonMessage.Sujet = SAI_Sujet
MonMessage.Message = RTFVersTexte(sNote)
MonMessage.HTML = RTFVersHTML(sNote)

// Ouverture une session SMTP
MaSession est un emailSessionSMTP
MaSession.AdresseServeur = sServeur
SI EmailOuvreSession(MaSession) = Faux ALORS RETOUR

// Envoi du message (la constante emailOptionEncodeEntête permet
// de prendre en compte les caractères accentués)
EmailEnvoieMessage(MaSession, MonMessage, emailOptionEncodeEntête)

// Fermeture de la session
EmailFermeSession(MaSession)
```

<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Propriétés spécifiques à la description des variables de type Email
<a name="proprietes_specifiques_description_des_variables_type_email_ELTPARAGRAPHE000059"></a>Les propriétés suivantes peuvent être utilisées pour manipuler une variable de type **Email** :

| **Nom** | **Type manipulé** | **Effet** |
| --- | --- | --- |
| AccuséRéception | Booléen | **En envoi,** permet de demander un accusé de réception au destinataire (<u><u><u><u>Vrai</u></u></u></u>). Le destinataire n'est pas obligé d'envoyer un accusé de réception.<br><br>**En réception,** permet de savoir si l'expéditeur a demandé un accusé de réception (<u><u><u><u>Vrai</u></u></u></u>) ou non (<u><u><u><u>Faux</u></u></u></u>).<br>Si la confirmation de lecture est demandée, elle est prioritaire sur l'accusé de réception.<br><br>Cette propriété vaut <u><u><u><u>Faux</u></u></u></u> par défaut.<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Cette propriété n'est pas gérée par Outlook sous Windows. |
| AdresseExpéditeur | Chaîne de caractères | Adresse à laquelle la réponse au message doit être envoyée (127 caractères maximum). Correspond au **Reply-To**. Pour plus de détails, consultez [Correspondance entre les propriétés et la norme RFC](#NOTE0_2).<br><br>Remarque : Si l'adresse contient des caractères spéciaux, des accents, utilisez la constante *emailOptionEncodeEntête* lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Sous Outlook**, cette variable est ignorée. Le nom du compte de la session en cours est utilisé pour remplir cette variable.<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Sous Lotus**, si l'expéditeur n'est pas renseigné, le login Lotus est utilisé. |
| AdresseRetourErreur | Chaîne de caractères | Adresse de retour en cas d'erreur. Cette adresse est gérée par les protocoles POP3, IMAP et SMTP. Pour plus de détails, consultez [Correspondance entre les propriétés et la norme RFC](#NOTE0_2). <br><br>Remarque : Si l'adresse contient des caractères spéciaux, des accents, utilisez la constante *emailOptionEncodeEntête* lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br> |
| Attache | Tableau de [emailAttache](../WDLang3/1000018752.md) | Contient la description des fichiers attachés.<br>Le nombre de fichiers attachés est illimité.<br>Pour plus de détails sur la gestion des fichiers attachés, consultez [emailAttache](../WDLang3/1000018752.md).<br><br>Remarque : Si la pièce jointe est remplie manuellement, il ne faut pas oublier de préciser la propriété **Nom** sinon l'image ne sera pas transmise dans l'email. Exemple : <br><br><pre><code>oEmail.Attache[1].Contenu = fChargeBuffer(fRepDonnées() +<br>	 ["\"] + "Email\" + sLogoSociété)<br>oEmail.Attache[1].ContentType = "image/gif"<br>oEmail.Attache[1].Nom = "logo.gif"</code></pre><br> |
| Catégorie | Chaîne de caractères | Liste de mots-clés associés à l'email. Les mots-clés sont séparés par des points virgules.<br><br>Remarque : Si un des mots-clés contient des caractères spéciaux, des accents, utilisez la constante *emailOptionEncodeEntête* lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md). |
| Cc | Tableau de chaînes de caractères | Contient les adresses des **destinataires en copie** : leur nom figure dans l'email reçu par les destinataires officiels (propriété **Destinataire**). <br>Les adresses sont limitées à 127 caractères. <br>Le nombre de destinataires en copie est limité à 200. En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| Cci | Tableau de chaînes de caractères | Contient les adresses des *destinataires non officiels* : leur nom ne figure pas dans l'email reçu par les destinataires officiels (propriété **Destinataire**). <br>Les adresses sont limitées à 127 caractères. Le nombre de destinataires non officiels est limité à 200. En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| Certificat | [Certificat](../WDLang1/1000019287.md) | Certificat utilisé pour signer l'email (entête, contenu et pièces jointes) avant son envoi.<br><br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Cette propriété n'est pas disponible. |
| Confidentialité | Constante de type Entier | Type de confidentialité de l'email. Les valeurs possibles sont les suivantes :<br><br>- ***emailConfidentiel*** : Utilisé par exemple pour les emails envoyés à l'intérieur d'une société. <br><br>- ***emailNormal*** (Valeur par défaut) : Aucune confidentialité. <br><br>- ***emailPersonnel*** : Utilisé par exemple pour les emails personnels. <br><br>- ***emailPrivé*** : Utilisé par exemple pour les emails privés.  <br><br><br>Cette propriété n'est pas gérée sous Lotus Notes. |
| ConfirmationLecture | Booléen | **En envoi**, permet de demander une confirmation de lecture au destinataire (<u><u><u><u>Vrai</u></u></u></u>). Le destinataire n'est pas obligé d'envoyer une confirmation de lecture.<br><br>**En réception**, permet de savoir si l'expéditeur a demandé une confirmation de lecture (<u><u><u><u>Vrai</u></u></u></u>) ou non.<br>Si la confirmation de lecture est demandée, elle est prioritaire sur l'accusé de réception.<br><br>Par défaut, cette propriété vaut <u><u><u><u>Faux</u></u></u></u>.<br><br>Pour plus de détails, consultez [Correspondance entre les propriétés et la norme RFC](#NOTE0_2).<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Cette propriété n'est pas gérée sous Lotus Notes. <br><br>Cette propriété est gérée par Outlook sous Windows. |
| DateRéception | Chaîne de caractères ou variable de type DateHeure | Date de réception du message. |
| Destinataire | Tableau de chaînes de caractères | Contient les adresses des *destinataires principaux*. Le nombre de destinataires est limité à 20. <br><br>En mode SMTP, il est possible de dépasser cette limite, mais certains serveurs n'acceptent pas toujours les emails ayant un nombre important de destinataires. |
| EnDehors | Booléen | Indique si un message a pu être lu sur le serveur : <br><br>- <u><u><u><u>Faux</u></u></u></u> si le message a été lu.<br><br>- <u><u><u><u>Vrai</u></u></u></u> si le message n'a pas été lu.<br><br><br> |
| Entête | Tableau de [emailEntête](../WDLang3/1000020774.md) | Entêtes de l'email. <br><br> |
| Expéditeur | Chaîne de caractères | Adresse de l'expéditeur. Cette adresse doit être une adresse email valide (et uniquement une adresse email). Pour plus de détails, consultez [Correspondance entre les propriétés et la norme RFC](#NOTE0_2).<br><br>Remarque : Si l'expéditeur contient des caractères spéciaux, des accents, utilisez la constante *emailOptionEncodeEntête* lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Sous Outlook**, cette variable est ignorée. Le nom du compte de la session en cours est utilisé pour remplir cette variable.<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) **Sous Lotus**, si l'expéditeur n'est pas renseigné, le login Lotus est utilisé. |
| HTML | Chaîne de caractères | Message avec une mise en forme HTML. Limité à 4 Go.<br><br>Cette propriété  est gérée uniquement en POP3 / SMTP. |
| ID | Chaîne de caractères | Identifiant unique de l'email. Cet identifiant est constant pour toute la durée de vie de l'email. Cet identifiant est initialisé lors de l'envoi de l'email (fonction [EmailEnvoieMessage](../WDLang3/3032005.md)).<br><br>Remarque : Si l'identifiant contient des caractères spéciaux, des accents, utilisez la constante *emailOptionEncodeEntête* lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Cette propriété est gérée par les logiciels de messagerie Outlook et Lotus Notes uniquement. |
| IdentifiantEmailAsynchrone | Chaîne de caractères | Identifiant de l'email (mode asynchrone uniquement). <br>WEBDEV uniquement<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Cette propriété n'est pas disponible. |
| Message | Chaîne de caractères | Texte du message (avec une mise en forme texte simple). Limité à 2 Go maximum (64Ko maximum dans le cas de Lotus Notes).<br><br>Remarque : Si le message contient des caractères spéciaux, des accents, utilisez la constante *emailOptionEncodeEntête* lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md). |
| MessageID | Chaîne de caractères | Identifiant unique de l'email. Cet identifiant est constant pour toute la durée de vie de l'email. Cet identifiant est utilisé pour suivre une conversation.<br><br>**Lors d'un envoi**, cette variable précise l'identifiant de l'email. Si cette variable correspond à une chaîne vide, l'identifiant sera fourni par le serveur. L'application qui génère l'identifiant doit s'assurer de l'unicité de cet identifiant.<br><br>**Lors de la réception**, cette variable précise l'identifiant de l'email.<br><br>Cet identifiant est de la forme &lt;Identifiant@domaine&gt;. Par exemple : 1@192.168.2.210<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Cette propriété n'est pas gérée sous Lotus Notes.<br><br><br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Cette propriété n'est pas gérée par Outlook sous Windows. |
| Priorité | Constante de type Entier | Type de priorité de l'email. Les valeurs possibles sont les suivantes :<br><br>- ***emailPrioritéBasse*** : utilisé par exemple pour les emails très peu urgents.   <br><br>- ***emailPrioritéHaute*** : utilisé par exemple pour les emails urgents.   <br><br>- ***emailPrioritéNormale*** (Valeur par défaut) : utilisé par exemple pour les emails non urgents.<br><br><br> |
| Référence | Chaîne de caractères | Identifiant unique d'un ou de plusieurs emails de référence liés à la conversation en cours.<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Cette propriété n'est pas gérée sous Lotus Notes.<br><br><br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Cette propriété n'est pas gérée par Outlook sous Windows. |
| Signature | Constante de type Entier | Etat de la signature de l'email : <br><br>- ***certificatExpiré*** : Signature valide mais certificat expiré. <br><br>- ***certificatInvalide*** : Signature ou certificat invalide. <br><br>- ***certificatNonFiable*** : Signature valide mais la racine de confiance du certificat est non fiable. <br><br>- ***certificatOK*** : Signature et certificat fiables. <br><br><br>Cette propriété est disponible en lecture seulement. <br><br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Cette propriété n'est pas disponible. |
| Source | Chaîne de caractères | Contient la source du message reçu (sujet, expéditeur, destinataire, contenu, ...).<br><br><br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) Cette propriété n'est pas gérée par Outlook sous Windows. |
| Sujet | Chaîne de caractères | Sujet du message. <br><br>Remarque : Si le sujet contient des caractères spéciaux, des accents, utilisez la constante *emailOptionEncodeEntête* lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md). |
| TexteBrut | Chaîne de caractères | Texte brut du message. Cette variable est disponible en réception uniquement. |


Remarque : Il est possible d'utiliser des caractères non latins dans les propriétés suivantes : **Sujet**, **Message**, **Catégorie**, **AdresseExpéditeur**, **Expéditeur**, **ID**. Dans ce cas, utilisez la constante *emailOptionEncodeEntête* lors de l'envoi du message avec la fonction [EmailEnvoieMessage](../WDLang3/3032005.md).
<a name="NOTE0_2"></a>


### Correspondance entre les propriétés et la norme RFC
<a name="correspondance_entre_les_proprietes_norme_rfc_ELTPARAGRAPHE000473"></a>


|   |   |   |   |   |
| --- | --- | --- | --- | --- |
|   | **Version 23 et précédentes** | **A partir de la version 24** |
|   | Envoi | Réception | Envoi | Réception |
| **From** | Propriété **Expéditeur** | Renseigne la propriété **Expéditeur**. | Propriété **Expéditeur** | Renseigne la propriété **Expéditeur**. |
| **Reply-To** | Propriété **AdresseExpéditeur** | Renseigne la propriété **AdresseExpéditeur**. | Propriété **AdresseExpéditeur** | Renseigne la propriété **AdresseExpéditeur**. |
| **Return-Path** | Propriété **AdresseExpéditeur** | Renseigne la propriété **AdresseExpéditeur** si le "Reply-To" est vide. | Propriété **AdresseRetourErreur** | Renseigne la propriété **AdresseRetourErreur**. |
| **Return-Receipt-To (AccuséReception)** | Propriété **AdresseExpéditeur** si renseigné, sinon propriété **Expéditeur**. | Met à <u><u><u><u>Vrai</u></u></u></u> la propriété **AccuséRéception** si la valeur reçue est non vide. | Propriété **AdresseExpéditeur** si renseigné, sinon propriété **Expéditeur**. | Met à <u><u><u><u>Vrai</u></u></u></u> la propriété **AccuséRéception** si la valeur reçue est non vide. |
| **Disposition-Notification-To (ConfirmationLecture)** | Propriété **AdresseExpéditeur** si renseigné, sinon propriété **Expéditeur**. | Met à <u><u><u><u>Vrai</u></u></u></u> la propriété **ConfirmationLecture** si la valeur reçue est non vide. | Propriété **AdresseExpéditeur** si renseigné, sinon propriété **Expéditeur**. | Met à <u><u><u><u>Vrai</u></u></u></u> la propriété **ConfirmationLecture** si la valeur reçue est non vide. |






<a name="NOTE0_3"></a>


### Fonctions WLangage
<a name="fonctions_wlangage_ELTPARAGRAPHE000562"></a>Les fonctions suivantes peuvent être utilisées pour manipuler une variable de type Email :



|   |   |
| --- | --- |
| [EmailChangeEtat](../WDLang3/1000019112.md) | Change l'état d'un email sur un serveur de messagerie. |
| [EmailChargeFichierAttaché](../WDLang3/1000019126.md) | Ajoute un fichier en attachement d'un email. |
| [EmailCherchePremier](../WDLang3/3032131.md) | Recherche un ou plusieurs emails selon des critères spécifiés dans le logiciel de messagerie (Outlook, logiciel de messagerie utilisant le protocole IMAP, ...). |
| [EmailCherchePremierNotes](../WDLang3/3032125.md) | Recherche un ou plusieurs emails selon des critères spécifiés, dans une base locale ou distante Lotus Notes ou Domino. |
| [EmailConstruitSource](../WDLang3/1000017225.md) | Génère le code source de l'email à envoyer à partir des variables actuellement présentes dans la structure [Email](../WDLang3/3032029.md) ou dans une variable de type [Email](../WDLang3/1000018713.md). |
| [EmailCopie](../WDLang3/1000019918.md) | Copie un email présent dans un répertoire vers un autre répertoire d'un serveur IMAP. |
| [EmailEnvoieMessage](../WDLang3/3032005.md) | Envoie un email selon le protocole utilisé (SMTP, MS Exchange, Lotus Notes, Outlook). |
| [EmailImporteHTML](../WDLang3/3032038.md) | Importe dans la structure Email ou dans une variable de type Email le contenu d'un fichier HTML afin de l'envoyer par email. |
| [EmailImporteSource](../WDLang3/1000017226.md) | Remplit une variable de type Email à partir du contenu de sa propriété **Source** ou les différentes variables de la structure email à partir du contenu de la variable **Email.Source**. |
| [EmailLitDernier](../WDLang3/3032010.md) | Lit le dernier email reçu selon le protocole utilisé (POP3 ou IMAP, MS Exchange, Lotus Notes ou Outlook). |
| [EmailLitEntêteDernier](../WDLang3/3032015.md) | Lit l'entête du dernier email reçu selon le protocole utilisé (POP3 ou IMAP, Lotus Notes ou Outlook). |
| [EmailLitEntêteMessage](../WDLang3/3032012.md) | Lit l'entête d'un email reçu selon le protocole utilisé (POP3 ou IMAP, Lotus Notes ou Outlook). |
| [EmailLitEntêtePrécédent](../WDLang3/3032019.md) | Lit l'entête de l'email précédant l'email en cours selon le protocole utilisé (POP3 ou IMAP, Lotus Notes ou Outlook). |
| [EmailLitEntêtePremier](../WDLang3/3032013.md) | Lit l'entête du premier email reçu selon le protocole utilisé (POP3 ou IMAP, Lotus Notes ou Outlook). |
| [EmailLitEntêteSuivant](../WDLang3/3032018.md) | Lit l'entête de l'email suivant l'email en cours selon le protocole utilisé (POP3 ou IMAP, Lotus Notes ou Outlook). |
| [EmailLitMessage](../WDLang3/3032016.md) | Lit un email reçu selon le protocole utilisé (POP3 OU IMAP, Lotus Notes ou Outlook). |
| [EmailLitPrécédent](../WDLang3/3032008.md) | Lit l'email précédent l'email en cours selon le protocole utilisé (POP3 ou IMAP, MS Exchange, Lotus Notes ou Outlook). |
| [EmailLitPremier](../WDLang3/3032014.md) | Lit le premier email reçu selon le protocole utilisé (POP3 ou IMAP, MS Exchange, Lotus Notes ou Outlook). |
| [EmailLitSuivant](../WDLang3/3032004.md) | Lit l'email reçu suivant l'email en cours selon le protocole utilisé (POP3 ou IMAP, MS Exchange, Lotus Notes ou Outlook). |
| [EmailRAZ](../WDLang3/3032023.md) | Ré-initialise toutes les variables de la structure email ou d'une variable de type Email. |
| [EmailRécupèreIndicateur](../WDLang3/1000021263.md) | Récupère les indicateurs définis sur un email d'une session IMAP. |
| [EmailSupprimeMessage](../WDLang3/3032027.md) | Permet de supprimer l'email en cours selon le protocole en cours (POP3, IMAP, MS Exchange, messagerie Lotus Notes ou Outlook). |








- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDMail.gif) ***Exemples complets (WINDEV)*** : **WD Mail** <br>Cette application est un client mail complet développé en WINDEV. Il s'appuie sur les objets Email.<br>Ce client mail permet de récupérer et d'envoyer des emails en utilisant les protocoles POP, IMAP et SMTP.<br>Il est possible d'appliquer des filtres sur le courrier entrant.<br>L'écriture d'un email s'appuie sur le champ Editeur HTML.<br>L'affichage des emails utilise le champ Affichage HTML.<br>L'application permet de gérer plusieurs comptes emails différents.


