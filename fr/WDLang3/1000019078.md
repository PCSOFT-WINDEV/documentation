


## &lt;Variable zipArchive&gt;.AjouteRépertoire (Fonction)

***En anglais : &lt;zipArchive variable&gt;.AddDirectory***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Ajoute et compresse automatiquement la totalité des fichiers d'un répertoire et de ses sous-répertoires dans une archive. Cette fonction est utilisable sur les archives de type CAB, ZIP, WDZ, 7z, TAR et TGZ (TAR.GZ).


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
MonArchive est un zipArchive
// Création de l'archive
ResCréation = MonArchive.Crée("C:\Temp\Archive.zip")
SI ResCréation = 0 ALORS
	// Ajoute la totalité des fichiers d'un répertoire 
	ResAjoutRép = MonArchive.AjouteRépertoire(...
			"C:\MonRépertoire\MesFichiers", Vrai, zipDisque)
FIN
// Affichage du message d'erreur si l'ajout n'a pas été effectué 
SI ResAjoutRép <> 0 ALORS Erreur(zipMsgErreur(ResAjoutRép))
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Ajouter les fichiers d'un répertoire en précisant le chemin à mémoriser

`<Résultat> = <Archive>.AjouteRépertoire(<Chemin du répertoire> [, <Sous-répertoire> [, <Portion du chemin à mémoriser> [, <Procédure WLangage> [, <Progression>]]]])`
---

**`<Résultat> : (Entier)`**



- 0 si l'ajout a été effectué, 

- Un code d'erreur (valeur supérieure à 0) dans le cas contraire. Pour plus de détails sur ces codes d'erreur, consultez les Remarques.




**`<Archive> : (Variable de type zipArchive)`**

Nom d'une variable de type [zipArchive](../WDLang3/1000018679.md) correspondant à l'archive dans laquelle le contenu du répertoire doit être ajouté.

**`<Chemin du répertoire> : (Chaîne de caractères)`**

Chemin du répertoire à ajouter dans l'archive (260 caractères maximum). Ce chemin peut être un chemin complet ou relatif au répertoire en cours. Si ce paramètre correspond à une chaîne vide (""), la fonction renvoie une erreur.
La taille des fichiers présents dans ce répertoire doit être inférieure à 4 Go. Dans le cas contraire, une erreur est générée.
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Le chemin d'accès au répertoire est un chemin complet ou relatif au répertoire de travail de l'application (connu avec la fonction [fRepDonnées](../WDLang1/3036001.md)). Seuls les fichiers présents dans le répertoire de travail peuvent être ajoutés à l'archive. 

**`<Sous-répertoire> : (Booléen optionnel)`**



- <u><u><u><u>Vrai</u></u></u></u> (valeur par défaut) si les sous-répertoires doivent être ajoutés, 

- <u><u><u><u>Faux</u></u></u></u> si les sous-répertoires ne doivent pas être ajoutés.




**`<Portion du chemin à mémoriser> : (Constante optionnelle)`**

Portion de chemin à mémoriser pour chaque fichier de l'archive :


|   |   |
| --- | --- |
| *zipDisque* | Mémorise le chemin complet et absolu du fichier (nom du disque, des répertoires, du fichier et l'extension du fichier). Par exemple : C:\\Répertoire\\Fichiers\\NomFichier.pdf<br>**Pour le format WDZ** : Le chemin complet du fichier (lettre du lecteur comprise) est mémorisé.<br>**Pour le format ZIP** : La lettre du lecteur n'est pas mémorisée. <br>**Pour le format 7z** : Cette constante a le même effet que la constante *zipRépertoire*.<br>![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png) Cette constante n'est pas disponible car il n'y a pas de racine de lecteur.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Cette constante a le même effet que la constante *zipRépertoire*. |
| *zipRelatif* | Le chemin passé en paramètre est considéré comme la racine de l'archivage. Le chemin mémorisé pour tous les fichiers et les sous-répertoires est relatif à cette racine. <br>Ainsi, si le répertoire ajouté est : "C:\\Temp\\Doc" contenant les éléments suivants :<br><br>- le fichier Test1.doc,<br><br>- le fichier Test2.doc dans le sous-répertoire SYS,<br><br><br>les informations mémorisées seront relatives au répertoire "C:\\Temp\\Doc" et seront les suivantes :<br><br>- Test1.doc,<br><br>- SYS\\Test2.Doc.<br><br><br> |
| *zipRépertoire*<br>(Valeur par défaut) | Mémorise les différents répertoires composant le chemin, le nom et l'extension du fichier. Par exemple : \\Répertoire\\Fichiers\\NomFichier.pdf |


**Archive au format .CAB** : Aucune de ces constantes n'est prise en compte. En effet, le format .CAB ne permet pas de stocker des chemins à l'intérieur de l'archive.

![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Ce paramètre n'est pas disponible : seuls le nom du fichier et son extension sont mémorisés.

**`<Procédure WLangage> : (Nom de procédure optionnel)`**

Nom de la procédure WLangage qui sera appelée avant l'ajout de chaque fichier. Cette procédure permet d'archiver une arborescence en omettant un ou plusieurs fichiers. 
Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction &lt;Variable zipArchive&gt;.AjouteRépertoire pour gérer l'ajout des fichiers](../WDLang3/1000025732.md). 



**`<Progression> : (Nom de champ ou nom de procédure)`**

Mode de gestion de la jauge. Ce paramètre peut correspondre : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) au nom d'un champ Jauge présent dans une fenêtre. Cette jauge affichera la progression de l'ajout et de la compression du fichier manipulé.  

- au nom d'une procédure WLangage. 
	Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction &lt;Variable zipArchive&gt;.AjouteRépertoire pour gérer la jauge](../WDLang3/1000025733.md). 




**Si vous manipulez une archive au format TAR ou TGZ (TAR.GZ)**, la jauge est mise à jour uniquement à la fin de l'ajout de chaque fichier.



![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre n'est pas disponible.


<a name="SYNTAXE2"></a>
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Non disponible en mode Universal Windows 10 App
### Ajouter les fichiers d'un répertoire en précisant le chemin à ignorer 

`<Résultat> = <Archive>.AjouteRépertoire(<Chemin du répertoire> [, <Sous-répertoire> [, <Portion du chemin à ignorer> [, <Procédure WLangage> [, <Progression>]]]])`
---

**`<Résultat> : (Entier)`**



- 0 si l'ajout a été effectué, 

- Un code d'erreur (valeur supérieure à 0) dans le cas contraire. Pour plus de détails sur ces codes d'erreur, consultez les Remarques.




**`<Archive> : (Variable de type zipArchive)`**

Nom  d'une variable de type [zipArchive](../WDLang3/1000018679.md) correspondant à l'archive dans laquelle le contenu du répertoire doit être ajouté.

**`<Chemin du répertoire> : (Chaîne de caractères)`**

Chemin du répertoire à ajouter dans l'archive (260 caractères maximum). Ce chemin peut être un chemin complet ou relatif au répertoire en cours. 
Si ce paramètre correspond à une chaîne vide (""), la fonction renvoie une erreur.
La taille des fichiers présents dans ce répertoire doit être inférieure à 4 Go. Dans le cas contraire, une erreur est générée

**`<Sous-répertoire> : (Booléen optionnel)`**



- <u><u><u><u>Vrai</u></u></u></u> (valeur par défaut) si les sous-répertoires doivent être ajoutés, 

- <u><u><u><u>Faux</u></u></u></u> si les sous-répertoires ne doivent pas être ajoutés.




**`<Portion du chemin à ignorer> : (Chaîne de caractères optionnelle)`**

Indique la portion de chemin du fichier à ne pas conserver dans l'archive. Par exemple, si le chemin complet du répertoire ajouté dans l'archive est : "C:\\Mes Documents\\Travail\\" et si le paramètre &lt;Portion du chemin à ignorer&gt; vaut "C:\\Mes Documents\\", seule la portion "Travail\\" sera mémorisée.

**`<Procédure WLangage> : (Nom de procédure optionnel)`**

Nom de la procédure WLangage qui sera appelée avant l'ajout de chaque fichier. Cette procédure permet d'archiver une arborescence en omettant un ou plusieurs fichiers. Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction &lt;Variable zipArchive&gt;.AjouteRépertoire pour gérer l'ajout des fichiers](../WDLang3/1000025732.md). 

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre est interdit.

**`<Progression> : (Nom de champ ou nom de procédure)`**

Mode de gestion de la jauge. Ce paramètre peut correspondre : 

- ![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) au nom d'un champ Jauge présent dans une fenêtre. Cette jauge affichera la progression de l'ajout et de la compression du fichier manipulé.  

- au nom d'une procédure WLangage. 
	Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction &lt;Variable zipArchive&gt;.AjouteRépertoire pour gérer la jauge](../WDLang3/1000025733.md).  




**Si vous manipulez une archive au format TAR ou TGZ (TAR.GZ)**, la jauge est mise à jour avant et à la fin de l'ajout de chaque fichier. 



![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Ce paramètre n'est pas disponible.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Conditions d'utilisation
<a name="conditions_utilisation_ELTPARAGRAPHE000534"></a>L'ajout de fichiers dans une archive ne peut être réalisé que si :

- L'archive existe (la création d'une archive s'effectue avec la fonction [&lt;Variable zipArchive&gt;.Crée](../WDLang3/1000019160.md)).

- L'archive est accessible en lecture et en écriture.

- L'archive est mono-partie.

- La taille du fichier est inférieure à 4 Go.




**Attention** :

- **Archives au format CAB** : L'ajout de fichiers doit se faire immédiatement après la création de l'archive. Ce format ne permet pas d'ajouter des fichiers dans une archive existante.

- **Archives au format RAR** : Cette fonction n'est pas disponible.

- **Archives au format 7z** : L'archive est entièrement compressée à chaque appel de la fonction **&lt;Variable zipArchive&gt;.AjouteRépertoire**.




Le nombre maximum de fichiers pouvant être intégrés :

- dans un fichier WDZ : 232-1. 

- dans un fichier ZIP : 65535. 

- dans un fichier CAB : 65535. 




**Remarque** : Si la constante *zipEntête64* est utilisée lors de la création de l'archive (fonction [&lt;Variable zipArchive&gt;.Crée](../WDLang3/1000019160.md)), il sera possible de créer des archives de plus de 4 gigas.
Rappel : 

- ![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Seules les archives au format ZIP, TAR et TGZ (TAR.GZ) sont disponibles.

- ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Seules les archives au format ZIP sont disponibles.



<a name="NOTE0_2"></a>


### Niveau de compression
<a name="niveau_compression_ELTPARAGRAPHE000584"></a>Par défaut, les fichiers ajoutés dans une archive au format Zip sont compressés. Il est possible de modifier le niveau de compression des fichiers ajoutés dans une archive grâce à la fonction [zipNiveauCompression](../WDLang3/3082054.md).
<a name="NOTE0_3"></a>


### Codes d'erreur
<a name="codes_erreur_ELTPARAGRAPHE000597"></a>Les codes d'erreur retournés sont les suivants :

- 1 : Le chemin passé en paramètre n'existe pas.

- 2 : Accès interdit : l'utilisateur n'a pas les droits nécessaires.

- 3 : L'archive est corrompue.

- 4 : Le chemin n'existe pas dans l'archive.

- 5 : Impossible d'écrire dans l'archive.

- 7 : Le fichier est déjà présent dans l'archive.

- 8 : Une archive ne peut pas être ajoutée à elle-même. Par exemple, l'archive "MonArchive" ne peut pas être ajoutée à l'archive "MonArchive".




Le message correspondant au code d'erreur peut être connu grâce à la fonction [zipMsgErreur](../WDLang3/3082034.md).
<a name="NOTE0_4"></a>


### Ajout d'un fichier déjà présent dans l'archive
<a name="ajout_fichier_deja_present_dans_archive_ELTPARAGRAPHE000620"></a>L'ajout d'un fichier déjà présent dans une archive provoque une erreur. Un fichier est identifié selon son chemin mémorisé. Il est donc impossible d'ajouter à l'archive deux fichiers de même nom ayant le même chemin relatif.
<a name="NOTE0_5"></a>


### Indice des fichiers dans l'archive
<a name="indice_des_fichiers_dans_archive_ELTPARAGRAPHE000630"></a>Lors de l'ajout d'un fichier dans une archive, un indice est automatiquement attribué au fichier. Cet indice correspond à l'ordre d'intégration des fichiers dans l'archive. Pour sélectionner un fichier de l'archive, il est possible d'utiliser :

- Soit l'indice de l'élément. (Remarque : l'indice d'un élément peut être connu grâce à la fonction [&lt;Variable zipArchive&gt;.ChercheFichier](../WDLang3/1000026330.md))

- Soit le chemin mémorisé de l'élément.




<a name="XComposante"></a>

## Composante :
wd280zip.dll
