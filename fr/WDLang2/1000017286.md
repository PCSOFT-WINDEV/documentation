
## JSONExécuteExterne (Fonction)

***En anglais : JSONExecuteExternal***

<DIV class="specObsolete">
	<IMG style="float:left;margin-right:10px;" src="https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=warning_big.png"><B>Avertissement</B><BR>
	A partir de la version <B>22</B>,  il est conseillé d'utiliser la fonction [JSONExécute](../WDLang2/1000017284.md). En effet, les Webservices retournant des données au format JSON utilisent désormais le protocole CORS pour simplifier la sécurité. 
</DIV><a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Appelle une URL serveur externe qui retourne des données au format JSON (JavaScript Object Notation). Les données serveur sont évaluées et transmises à la fonction de rappel (callback) sous forme d'un objet.

Cette fonction n'est pas bloquante. Les autres traitements continuent de s'exécuter normalement (que les données soient récupérées ou non).

Dès que le résultat est disponible, la fonction **JSONExécuteExterne** appelle automatiquement une procédure navigateur permettant de récupérer ce résultat.
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Exécution d'un service JSON sur google
// Google attend le nom de la procédure qui va traiter l'objet JSON 
// dans le paramètre qui a pour nom "callback"
// et ici la procédure qui va traiter l'objet s'appelle "AgendaGoogle"
JSONExécuteExterne(...
	"http://www.google.com/calendar/feeds/monsite@gmail.com" + ...
	"/public/full?alt=json-in-script&orderby=starttime&max-results=15&" + ...
	"singleevents=true&sortorder=ascending&futureevents=true", ...
	 "callback", AgendaGoogle)

// Cela génerera une URL d'appel à la fonction json de ce type :
// http://www.google.com/calendar/feeds/monsite@gmail.com/public/full?alt
// =json-in-script&orderby=starttime&max-results=15&singleevents=true&
// sortorder=ascending&futureevents=true&callback=AgendaGoogle
```


<a name="Exemple2"></a>



```wl
// Exécution d'un service JSON sur une page AWP
JSONExécuteExterne(...
	"http://monsite/monsite_WEB/FR/PAGE_Objet.awp?id=12", ...
	"JsonCallback", ReponseFonction)
// La page AWP attend donc un paramètre qui se nomme "JsonCallback" 
// qui contiendra le nom de la procédure a exécutée en retour
```



<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`JSONExécuteExterne(<URL de la page> , <Nom du paramètre> , <Nom de la procédure>)`
---

**`<URL de la page> : (Chaîne de caractères)`**

URL de la page renvoyant des données au format JSON.

**`<Nom du paramètre> : (Chaîne de caractères)`**

Nom du paramètre que WEBDEV va ajouter à l'URL pour indiquer au serveur contacté le nom de la procédure de traitement des données JSON. Le nom de ce paramètre dépend de la documentation de la fonction JSON appelée, il s'agit souvent de "callback".

**`<Nom de la procédure> : (Chaîne de caractères)`**

Nom de la procédure navigateur (globale ou locale) qui effectue le traitement des données JSON.
Cette procédure est le la forme :

```txt
PROCEDURE <Procédure navigateur> (<Résultat JSON de l'appel>)
```
Le paramètre passé à cette procédure est un objet dynamique, contenant les données JSON. Il doit être indiqué dans la déclaration de la procédure.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques




### Procédure de traitement des données JSON
<a name="procedure_traitement_des_donnees_json_ELTPARAGRAPHE000058"></a>Le résultat JSON doit être renvoyé sous la forme de code JSON entouré d'un appel à la procédure permettant de traiter ces données.

Le nom de cette procédure est directement transmis dans l'URL de l'appel à la page en tant que paramètre. Le nom de ce paramètre est spécifié dans la fonction **JSONExécuteExterne**.

Par exemple :


```wl
JSONExécuteExterne("http://MonSite/MonSite_WEB/FR/PAGE_Objet.awp?id=12", ...
	"JsonCallback", ReponseFonction)
```


permettra de construire l'URL suivante :



```wl
"http://MonSite/MonSite_WEB/FR/PAGE_Objet.awp?id=12&JsonCallback=ReponseFonction"
// WEBDEV a ajouté : &JsonCallback=ReponseFonction en plus 
// à la fin de l'URL pour indiquer la fonction de retour
```



<a name="NOTE0_2"></a>




### Page renvoyant les données au format JSON
<a name="page_renvoyant_les_donnees_format_json_ELTPARAGRAPHE000080"></a>La page renvoyant les données au format JSON peut être une page AWP, une page PHP ou tout autre type de page.

**Si cette page est une page WEBDEV,** cette page peut être au format AWP ou PHP. Cette page doit renvoyer les données dans un format JSON avec la fonction [ChaîneAffiche](../WDLang2/3012001.md). Il est également nécessaire d'utiliser la fonction [ChaîneVersUTF8](../WDLang1/3024042.md) pour obtenir un format valide.

Par exemple, le code suivant permet de créer la chaîne qui sera renvoyée. Cette chaîne contient le code permettant de définir un objet et un tableau. Le code utilisé est du code Javascript.

La fonction [PageParamètre](../WDLang2/3058026.md) permet de traiter le cas d'un appel externe. Dans ce cas, les données JSON renvoyées sont formatées avec le nom de la procédure de traitement.


```wl
// Chaîne contenant un objet JSON
sObjet est une chaîne = [	
	%1 ( {id: 12,
	liste:  [
		{nom: "smith", prénom: "john"},
		{nom: "dupond", prénom: "marie"},
		{nom: "martin", prénom: "lauré"}]
} );
]

// Ajout du nom de la procédure callback (à la place de %1)
// Ce nom est attendu dans un paramètre qui a pour nom "JsonCallback"
sObjet = ChaîneConstruit(sObjet, PageParamètre("JsonCallback"))

// Renvoie la chaîne de l'objet JSON 
// avec le nom de la procédure javascript à appeler
ChaîneAffiche(ChaîneVersUTF8(sObjet))
```



<a name="NOTE0_3"></a>




### IMPORTANT : Validité du JSON
<a name="important_validite_json_ELTPARAGRAPHE000106"></a>Aucune vérification n'est effectuée sur la validité du JSON reçu depuis le serveur. Il est nécessaire de s'assurer que la page appelée est une page de confiance pour ne pas risquer d'avoir une injection de JavaScript dans la page courante.


<a name="NOTE0_4"></a>




### Sécurité
<a name="securite_ELTPARAGRAPHE000115"></a>Pour renforcer la sécurité des données transmises, il est possible d'utiliser une page sécurisée (URL de type https).  



<a name="XComposante"></a>

## Composante :
WDJS.DLL
