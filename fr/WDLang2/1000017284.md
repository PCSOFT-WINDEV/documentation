
## JSONExécute (Fonction)

***En anglais : JSONExecute***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Appelle une URL serveur qui retourne des données au format JSON (JavaScript Object Notation). Les données serveur sont évaluées et retournées sous forme d'un objet.
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
MesContacts est un objet dynamique
MesContacts = JSONExécute(RepertoireWeb() + "FR/Page_Objet.awp?id=12")

// Traitement des données reçues
POUR i = 1 _A_ Dimension(MesContacts:Liste)
	ListeAjoute(LISTE_Liste_des_contacts, MesContacts:Liste[i]:Nom + ...
	" " + MesContacts:Liste[i]:Prenom)
FIN
```



<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Syntaxe synchrone : la fonction est bloquante jusqu'à la réception des données

`<Résultat> = JSONExécute(<URL de la page>)`
---

**`<Résultat> : (Objet dynamique)`**

Données renvoyées par le serveur. Ce résultat doit être affecté à un objet de type objet dynamique.

**`<URL de la page> : (Chaîne de caractères)`**

URL de la page renvoyant des données au format JSON. Cette URL peut être une URL partielle ou totale.

- Si l'URL ne commence pas par 'http:', cette URL est utilisée directement. Attention : le domaine doit être dans le domaine de la page courante (ou un sous-domaine), sinon l'appel échoue.

- Si l'URL commence par '/', l'URL est considérée comme chemin absolu dans le domaine courant.

- Dans tous les autres cas, l'URL est considérée comme chemin relatif au répertoire de la page courante.  





<a name="SYNTAXE2"></a>

### Syntaxe asynchrone : une procédure est exécutée à la réception des données

`JSONExécute(<URL de la page> , <Nom de la procédure>)`
---

**`<URL de la page> : (Chaîne de caractères)`**

URL de la page renvoyant des données au format JSON. Cette URL peut être une URL partielle ou totale.  

- Si l'URL ne commence pas par 'http:', cette URL est utilisée directement. Attention : le domaine doit être dans le domaine de la page courante (ou un sous-domaine), sinon l'appel échoue.

- Si l'URL commence par '/', l'URL est considérée comme chemin absolu dans le domaine courant.

- Dans tous les autres cas, l'URL est considérée comme chemin relatif au répertoire de la page courante.  




**`<Nom de la procédure> : (Chaîne de caractères)`**

Nom de la procédure navigateur (globale ou locale) qui effectue le traitement des données JSON.
Cette procédure est le la forme :

```txt
PROCEDURE <Procédure navigateur> (<Résultat JSON de l'appel>)
```
Le paramètre passé à cette procédure est un objet dynamique, contenant les données JSON. Il doit être indiqué dans la déclaration de la procédure.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques




### Interrogation d'un serveur du même domaine ou d'un domaine différent 
<a name="interrogation_serveur_meme_domaine_domaine_different_ELTPARAGRAPHE000055"></a>Dans le cas général, le serveur se trouve sur le domaine qui héberge le site. Dans ce cas, aucune manipulation spécifique ne doit être réalisée. 

Lors de l'interrogation d'un serveur d'un autre domaine : 

- le serveur doit implémenter le protocole CORS, 

- le site courant doit être autorisé à contacter le serveur. 




Pour plus de détails sur le protocole CORS (Cross-Origin Resource Sharing), consultez [https://www.w3.org/wiki/CORS](https://www.w3.org/wiki/CORS). 
<a name="NOTE0_2"></a>




### Page renvoyant les données au format JSON
<a name="page_renvoyant_les_donnees_format_json_ELTPARAGRAPHE000073"></a>La page renvoyant les données au format JSON peut être une page AWP, une page PHP ou un autre type de page.

**Si cette page est une page WEBDEV,** cette page peut être au format AWP ou PHP. Cette page doit renvoyer les données dans un format JSON avec la fonction [ChaîneAffiche](../WDLang2/3012001.md). Il est également nécessaire d'utiliser la fonction [ChaîneVersUTF8](../WDLang1/3024042.md) pour obtenir un format valide.

Par exemple, le code suivant permet de créer la chaîne qui sera renvoyée. Cette chaîne contient le code permettant de définir un objet et un tableau. Le code utilisé est du code Javascript.


```wl
sObjet est une chaîne = [
{id: 12,
Liste:  [
	{Nom: "smith", Prenom: "john"},
	{Nom: "dupond", Prenom: "marie"},
	{Nom: "martin", Prenom: "lauré"}]
}
]
ChaîneAffiche(ChaîneVersUTF8(sObjet))
```



<a name="NOTE0_3"></a>


### IMPORTANT : Validité du JSON
<a name="important_validite_json_ELTPARAGRAPHE000093"></a>Aucune vérification n'est effectuée sur la validité du JSON reçu depuis le serveur. Il est nécessaire de s'assurer que la page appelée est une page de confiance pour ne pas risquer d'avoir une injection de JavaScript dans la page courante.
<a name="NOTE0_4"></a>


### Sécurité
<a name="securite_ELTPARAGRAPHE000100"></a>Pour renforcer la sécurité des données transmises, il est possible d'utiliser une page sécurisée (URL de type https).  



<a name="XComposante"></a>

## Composante :
WDJS.DLL
