


## WEBDEV : Tâches planifiées et tâches différées
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000201"></a>
WEBDEV permet de mettre en place des tâches directement sur le serveur : chaque tâche est une procédure WLangage serveur. 

Les [tâches différées](#NOTE2_1) permettent de déporter des traitements qui prennent du temps sur le serveur d'application WEBDEV. Par exemple, l'envoi d'un email ou le calcul de statistiques. 

Les [tâches planifiées](#NOTE3_1) permettent d'exécuter de façon régulière une opération donnée. Par exemple, l'envoi d'un mailing sur les promotions en cours. 

Remarques : 

- Les tâches planifiées et les tâches différées correspondent à des procédures Serveur. 

- La mise en place de ces fonctionnalités nécessite un serveur d'application WEBDEV en version 180046 ou supérieure. 

- Le nombre de tâches planifiées associées à un site ou à un Webservice peut être visualisé dans l'administrateur WEBDEV (administrateur local ou distant). 

- Il est possible de gérer les tâches planifiées depuis l'administrateur WEBDEV (local ou distant). 

- Les tâches planifiées peuvent être définies par programmation.




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Tâches différées
<a name="taches_differees_ELTTEXTE000225"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000042"></a>Exemple de tâche différée : Quant l'internaute valide sa réservation, un email de confirmation lui est envoyé. L'envoi réel de l'email est effectué en différé sur le serveur. L'internaute n'est pas bloqué pendant l'envoi. 


### Mise en place via l'éditeur de code
<a name="mise_place_via_editeur_code_ELTPARAGRAPHE000047"></a>Pour mettre en place une tâche différée dans un site WEBDEV : 

1. Affichez sous l'éditeur de code la procédure serveur à exécuter en différé. 

2. Cliquez sur l'icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Proc_auto_Ico.gif)
 dans le bandeau de l'éditeur de code. ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WB_Tache_plan1.gif)

	**Remarque** : Il est également possible d'effectuer une des manipulations suivantes : 

	- Sélectionner l'option "Paramétrer les automatismes de la procédure" dans le menu contextuel de la procédure (volet "Explorateur de projet").

	- Sélectionner l'option "Propriétés" du menu contextuel de la procédure dans le volet "Code".


 **Attention** : 

- Les procédures multi-syntaxes ne peuvent pas être différées. 

- Il n'est pas possible d'ajouter une syntaxe à une procédure différée.

3. Dans la fenêtre de configuration de l'automatisme de la procédure, sélectionnez "Tâche WEBDEV", puis "Tâche différée" et configurez les différents paramètres de la tâche différée : ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WB_Tache_diff.gif)


	- Utilisation ou non du contexte HFSQL en cours.

- Durée maximale d'exécution. 

4. Validez. 

5. Pour lancer l'exécution de la procédure différée dans votre projet : 

	- soit utilisez la fonction [ExécuteProcédureDifférée](../WDLang2/1000020682.md). 

	- soit saisissez directement le nom de la fonction : une icône spécifique apparaît à coté du nom de la fonction : ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WB_Tache_diff_code.gif)



 **Remarque** : La fonction [EnModeProcédureDifférée](../WDLang1/1000020665.md) permet de savoir si la procédure en cours est exécutée en mode différée ou non. 

6. Lors du prochain déploiement du site, la tâche différée pourra être exécutée sur le serveur.  




**Remarque** : Il est possible de limiter la durée d'exécution des tâches planifiées ou différées : 

- au niveau du serveur : dans l'administrateur WEBDEV, dans l'onglet "Configuration", spécifiez la durée maximum d'une tâche. Si les tâches utilisées dépassent cette durée, elles seront automatiquement arrêtées. 

- au niveau d'un site ou d'un Webservice : dans l'administrateur WEBDEV, dans l'onglet "Sites" ou "Webservices", sélectionnez le site ou Webservice voulu et cliquez sur le bouton "Paramètres" pour spécifier la durée maximum d'une tâche. Dans ce cas, la durée maximale effective d'une tâche (d'un site ou d'un Webservice) ne pourra pas excéder celle configurée au niveau du serveur.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Tâches planifiées
<a name="taches_planifiees_ELTTEXTE000255"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000095"></a>Exemple de tâche planifiée : Tous les jours de la semaine, à 3 heures du matin, un email de relance est envoyé aux clients qui n'ont pas confirmé leur réservation. 


### Mise en place via l'éditeur de code
<a name="mise_place_via_editeur_code_ELTPARAGRAPHE000100"></a>Pour mettre en place une tâche planifiée dans un site WEBDEV : 

1. Affichez sous l'éditeur de code la procédure serveur à planifier. 

2. Cliquez sur l'icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Proc_auto_Ico.gif)
 dans le bandeau de l'éditeur de code. ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WB_Tache_plan1.gif)

	**Remarque** : Il est également possible d'effectuer une des manipulations suivantes : 

	- Sélectionner l'option "Paramétrer les automatismes de la procédure" dans le menu contextuel de la procédure (volet "Explorateur de projet").

	- Sélectionner l'option "Propriétés" du menu contextuel de la procédure dans le volet "Code".




3. **Attention** : 

	- Les procédures multi-syntaxes ne peuvent pas être planifiées. 

	- Il n'est pas possible d'ajouter une syntaxe à une procédure planifiée.  




4. Dans la fenêtre de configuration de l'automatisme de la procédure, sélectionnez "Tâches WEBDEV", puis Tâche planifiée" et configurez les différents paramètres de la planification : ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WB_Tache_plan2.gif)


	- Mois d'exécution.

- Jour d'exécution.

- Heure d'exécution.

- Durée maximale d'exécution.

5. Validez. 

6. Lors du prochain déploiement du site, la tâche planifiée sera exécutée sur le serveur selon les paramètres de planification indiqués. 




**Remarque** : Il est possible de limiter la durée d'exécution des tâches planifiées ou différées : dans l'administrateur WEBDEV, dans l'onglet "Configuration", spécifiez la durée maximum d'une tâche. Si les tâches utilisées dépassent cette durée, elles seront automatiquement arrêtées. 
Cette durée peut également être configurée pour les tâches d'un site spécifique (onglet "Sites", bouton "Paramètres") ou pour les tâches d'un Webservice spécifique (onglet "Webservices", bouton "Paramètres"). Dans ce cas la durée maximale effective d'une tâche ne peut pas excéder la durée maximale d'une tâche configurée pour le serveur.


### Mise en place par programmation
<a name="mise_place_par_programmation_ELTPARAGRAPHE000135"></a>WEBDEV propose de définir les tâches planifiées par programmation à l'aide de la famille de fonctions [ServeurApplixxx](../WDLang2/1000022790.md). 

La mise en place est simple. Vous devez : 

1. Définir les caractéristiques de la tâche planifiée grâce à une variable de type [ServeurAppliTâchePlanifiée](../WDLang2/1000022367.md). 

2. Ajouter la tâche planifiée avec la fonction [ServeurAppliAjouteTâchePlanifiée](../WDLang2/1000022347.md). 

3. Différentes fonctions permettent ensuite de manipuler les tâches planifiées : 
	


|   |   |
| --- | --- |
| [ServeurAppliExécuteTâchePlanifiée](../WDLang2/1000022350.md) | Lance immédiatement l'exécution d'une tâche planifiée sur un Serveur d'Application WEBDEV. |
| [ServeurAppliInfoTâchePlanifiée](../WDLang2/1000022789.md) | Lit la description d'une tâche planifiée. |
| [ServeurAppliListeTâchePlanifiée](../WDLang2/1000022352.md) | Renvoie la liste des tâches planifiées de l'application (site ou Webservice). |
| [ServeurAppliModifieTâchePlanifiée](../WDLang2/1000022348.md) | Modifie une tâche planifiée existante. |
| [ServeurAppliSupprimeTâchePlanifiée](../WDLang2/1000022349.md) | Supprime une tâche planifiée associée à l'application (site ou Webservice). |





