


## Connecteur Natif MySQL : Programmation à l'aide des fonctions HFSQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000251"></a>
Pour utiliser une base de données MySQL avec le Connecteur Natif (également appelé "Accès Natif"), il est nécessaire **d'importer la structure des tables MySQL dans l'analyse WINDEV ou WEBDEV**.

**Différences par rapport à la programmation SQL** : Pour manipuler les données MySQL, les requêtes ne sont pas obligatoires. En effet, vous pouvez directement utiliser les fonctions HFSQL pour lire vos données, effectuer des recherches, des filtres, ... Cependant, il est nécessaire d'importer la structure des fichiers MySQL dans l'analyse WINDEV ou WEBDEV.

**Remarque** : Les requêtes exécutées avec [HExécuteRequête](../WDLang4/3044080.md) et [HExécuteRequêteSQL](../WDLang4/3044084.md) sont automatiquement "corrigées" pour être compatibles avec MySQL.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Importation de la structure des fichiers de données
<a name="importation_structure_des_fichiers_donnees_ELTTEXTE000281"></a>


### Les étapes de l'importation
<a name="les_etapes_importation_ELTPARAGRAPHE000030"></a>Pour réaliser cette importation : 

1. Lancez l'éditeur d'analyses : cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Analyse.gif)
 parmi les boutons d'accès rapide.

2. Sous le volet "Analyse", dans le groupe "Création", déroulez "Importer" et sélectionnez "Importer des descriptions de fichiers / tables".

3. L'assistant se lance.  Une connexion à la base de données MySQL est automatiquement créée et associée aux fichiers de données importés dans l'analyse. Cette connexion devra être utilisée pour manipuler le fichier de données MYSQL par programmation.




Dans les différents écrans de l'assistant, choisissez les options suivantes :

- Type de base de données : MySQL. 

- Caractéristiques de la connexion : Serveur de données, Utilisateur et mot de passe, base de données.  

- L'application accédera aux données dans le format actuel.

- Lorsque la connexion est établie, il suffit de sélectionner les tables à importer dans l'analyse WINDEV ou WEBDEV. Ces tables pourront être manipulées par programmation grâce aux fonctions HFSQL du WLangage. Ces tables apparaîtront en bleu sous l'éditeur d'analyses.



<a name="NOTE2_2"></a>


### Prendre en compte les évolutions de la base de données MySQL
<a name="prendre_compte_les_evolutions_base_donnees_mysql_ELTPARAGRAPHE000062"></a>Pour prendre en compte les évolutions des tables importées sous l'éditeur d'analyses, sous le volet "Analyse", dans le groupe "Analyse", déroulez "Synchronisation" et sélectionnez "Mettre à jour l'analyse depuis les bases de données externes".

Un assistant se lance et permet au choix :

- soit d'analyser les différences pour les tables importées,

- soit d'analyser les différences pour toutes les tables MySQL.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Programmation
<a name="programmation_ELTTEXTE000311"></a>


### 1. Ouverture de la connexion
<a name="1_ouverture_connexion_ELTPARAGRAPHE000088"></a>Pour ouvrir la connexion à la base de données MySQL, utilisez la fonction [HOuvreConnexion](../WDLang4/3044107.md) en précisant le nom de la connexion à ouvrir. Ce nom de connexion a été défini lors de l'importation de la structure des fichiers dans l'analyse.

**Attention** : Si vous utilisez une autre syntaxe, le nom de la database à utiliser doit être spécifié.

Pour modifier certains paramètres de cette connexion (par exemple le nom d'utilisateur ou le mot de passe), utilisez la fonction [HConnecte](../WDLang4/3044263.md).

**Remarques** :

- Si vous tentez de lire directement le fichier (fonction **HLitPremier**, ...), la connexion associée à la description du fichier dans l'analyse sera automatiquement ouverte.

- Il est possible de fixer les paramètres "***Server Port***", "***Unix Socket***" et "***Client Flag***" pour la connexion au serveur MySQL. Il suffit d'ajouter les chaînes correspondantes dans les informations étendues de la connexion (fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md)).
	Exemple 1 : "Server Port=3306;" pour se connecter sur le port 3306 du serveur MySQL.
	Exemple 2 : "Server Port=3306; Client Flag=0;"
	...
	Pour plus de détails sur ces paramètres, consultez la documentation de MySQL (mot-clé = 'mysql_real_connect').

- Il est possible de paramétrer lors de la connexion **la gestion ou non des rubriques Unicode**. Il suffit d'ajouter dans les informations étendues de la connexion (fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md)) l'option "WD Unicode Support".

	- **Si "WD Unicode Support = 0"**, la gestion de Unicode est désactivée sur la connexion. Le serveur convertira lui-même si nécessaire toutes les valeurs dans l'alphabet utilisé par défaut. Dans ce cas, les performances sont meilleures, mais la gestion des rubriques Unicode n'est pas disponible. 

	- **Si "WD Unicode Support = 1"** (valeur pas défaut), la gestion de Unicode est activée sur la connexion. Tous les échanges avec le serveur sont réalisés en Unicode. Le Connecteur Natif gère les conversions éventuellement nécessaires. 




- Il est possible de spécifier la taille du cache dans les informations optionnelles de la connexion avec le mot-clé suivant "***WD Cache Size***". Dans ce cas, le paramètre fixé avec la propriété [CxTailleCache](../Proprietes/2512027.md) est ignoré. 
	Exemple :
	
	```txt
	"WD Cache Size = 10000; Server Port=3306;"
	```




<a name="NOTE3_2"></a>


### 2. Exécution de requêtes
<a name="2_execution_requetes_ELTPARAGRAPHE000142"></a>Les fonctions [HExécuteRequête](../WDLang4/3044080.md) et [HExécuteRequêteSQL](../WDLang4/3044084.md) permettent d'exécuter des requêtes sur la base de données en cours.

- **HExécuteRequête** : permet d'exécuter une requête prédéfinie avec l'éditeur de requêtes.

- **HExécuteRequêteSQL** : permet d'exécuter une requête en précisant directement le code SQL de la requête, et le nom qui sera attribué à ce code SQL.



```wl
// Initialisation de la requête "Client_84"
HExécuteRequête(CLIENT_84, "BaseMYSQL", hRequêteSansCorrection)
HExécuteRequêteSQL(ReqClient, "BaseMYSQL", hRequêteSansCorrection, ...
	"SELECT NOM FROM CLIENT")
```

<a name="NOTE3_3"></a>


### 3. Récupération du résultat
<a name="3_recuperation_resultat_ELTPARAGRAPHE000160"></a>Le parcours du résultat est réalisé avec toutes les fonctions de lecture classiques : [HLitPremier](../WDLang4/3044051.md), [HLitSuivant](../WDLang4/3044037.md), [HLitRecherche](../WDLang4/3044050.md), ...

Il n'est pas possible dans cette version de bloquer les enregistrements grâce aux options de blocage de ces fonctions. Seuls les blocages réalisés avec [SQLBloque](../WDLang4/3072003.md) sont gérés (voir [Connecteur Natif MySQL : gestion des blocages et des transactions](../WDMySQL/5517005.md)).
<a name="NOTE3_4"></a>


### 4. Fermeture de la connexion
<a name="4_fermeture_connexion_ELTPARAGRAPHE000184"></a>La fonction [HFermeConnexion](../WDLang4/3044095.md) permet de fermer la connexion à la base de données lorsque toutes les requêtes nécessaires ont été réalisées.

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Astuce sous Linux
<a name="astuce_sous_linux_ELTTEXTE000353"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Les erreurs ne pouvant pas être affichées sous Linux dans des fenêtres ou des pages, il est nécessaire de renvoyer les erreurs dans la console en utilisant la fonction [dbgSortieStandard](../WDLang1/3014020.md).

Par exemple :

```wl
SI PAS HOuvreConnexion(Ma_Connexion) ALORS
	dbgSortieStandard(HErreurInfo(hErrComplet))
FIN
```



