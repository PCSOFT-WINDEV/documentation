
## WDJournal : Sauvegarde de fichiers de données HFSQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000365"></a>
WDJournal permet de sauvegarder tous les fichiers de données HFSQL utilisés par une application WINDEV ou WEBDEV.

Pour réaliser cette sauvegarde, le fichier suivant est nécessaire :

- soit le fichier de l'analyse (.WDD),

- soit le fichier .REP contenant les différents chemins des fichiers de données gérés par le projet.




Cette sauvegarde peut être réalisée :

- En mode interactif (WDJournal est lancé).

- En mode "Ligne de commande". Le mode "Ligne de commande" permet d'inclure la gestion des sauvegardes de vos fichiers de données directement dans vos applications. Dans ce cas, l'utilisateur n'a aucune manipulation spécifique à réaliser.




**Important** : N'oublier pas de noter les références de toutes les sauvegardes effectuées (date de la sauvegarde, répertoire de la sauvegarde, nature de la sauvegarde, disquette contenant les fichiers ou les journaux, ...). Ces informations seront fondamentales pour restaurer les fichiers.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Mode Interactif
<a name="mode_interactif_ELTTEXTE000395"></a>


### Sauver des fichiers de données HFSQL associés à une analyse
<a name="sauver_des_fichiers_donnees_hfsql_associes_une_analyse_ELTPARAGRAPHE000032"></a>Pour sauver des fichiers de données HFSQL associés à une analyse : 

1. Lancez WDJournal.

2. Sélectionnez l'option "Sauvegardes .. Sauvegarde de données" (ou cliquez sur la flèche orange).

3. Sélectionnez à l'aide du bouton "Parcourir" :

	- Soit le fichier de l'analyse (.WDD) contenant la description des fichiers de données gérés par le projet.

	- Soit le fichier .REP contenant les différents chemins des fichiers de données gérés par le projet.




4. La liste des fichiers de données présents dans le .REP de l'application apparaît. Dans cette liste, il est possible de :

	- Supprimer des fichiers (fichiers .FIC, .MMO ou .NDX) avec le bouton "Enlever".

	- Ajouter des fichiers de données HFSQL (fichiers .FIC, .MMO ou .NDX) avec le bouton "Autres".

	- Enregistrer la liste des fichiers de données sous forme d'un fichier "Liste" (extension LST) avec le bouton "Enregistrer". Ce fichier liste pourra être relu directement avec WDJournal ou utilisé en mode ligne de commande. 
			Attention : A chaque enregistrement, le fichier "liste" n'est pas vidé.

	- Ouvrir une liste de fichiers de données existante avec le bouton "Ouvrir".




5. Validez la sauvegarde des fichiers de données listés en cliquant sur le bouton "OK".

6. Dans la fenêtre de sauvegarde qui s'ouvre, renseignez les éléments suivants :

	- Répertoire de la sauvegarde : Répertoire dans lequel le répertoire de sauvegarde sera créé.

	- Nom de la sauvegarde : Nom du répertoire dans lequel la sauvegarde va être réalisée.

	- Spécifiez les options de sauvegarde :

		- ***Ne pas créer de sous-répertoire du nom de la sauvegarde*** : Le répertoire de sauvegarde n'est pas créé.

		- ***Compression*** : permet de compacter les fichiers lors de la sauvegarde. Cette option permet de réduire la taille de stockage des sauvegardes. Un seul fichier archive de type WDZ sera créé. 
						Si cette option n'est pas cochée, les fichiers seront uniquement copiés dans le répertoire de sauvegarde.

		- ***Multi-volumes*** : permet de compacter les fichiers lors de la sauvegarde et de regrouper les fichiers dans des archives de 1.4 Mo. Cette option est conseillée pour réaliser une sauvegarde sur disquettes. Cette option active automatiquement le mode "Compression".

		- ***Ne pas sauver les index (.NDX)*** : permet de réduire la taille de la sauvegarde. Si cette option est cochée, il sera nécessaire de réindexer les fichiers de données après leur restauration. 
						Rappel : WINDEV propose différentes solutions pour réindexer des fichiers de données : WDOUTIL (non redistribuable), WDOptimiseur, WDMAP (non redistribuable), ou par programmation avec la fonction du WLangage **HRéindexe**.

		- ***Ne pas bloquer les fichiers*** : permet de sauvegarder les fichiers même si ils sont en cours d'utilisation. Cette option est déconseillée car la sauvegarde risque de contenir des enregistrements bloqués, qui ne seront plus accessibles. 
						Cette option est conseillée dans des cas très spécifiques, par exemple pour des applications lancées en tâche de fond, ouvrant les fichiers mais n'utilisant pas de transactions, ... Cette option peut aussi être utilisée avec des applications manipulant des fichiers de données indépendants (non reliés dans l'analyse).




7. Lancez la sauvegarde en cliquant sur le bouton "OK".






<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Mode ligne de commande
<a name="mode_ligne_commande_ELTTEXTE000419"></a>
Le mode ligne de commande permet deux types de sauvegardes :

- Sauvegarde de tous les fichiers de données décrits soit dans une analyse, soit dans le fichier .REP de l'application.

- Sauvegarde d'une liste de fichiers de données.




Pour plus de détails sur les différentes options, consultez le paragraphe précédent "Mode interactif".

**Remarque** : Un fichier WDJOURNAL.LOG est automatiquement créé. Ce fichier contient les opérations réalisées.


<a name="NOTE3_2"></a>


### Sauver tous les fichiers de données d'un fichier WDD ou d'un fichier .REP
<a name="sauver_tous_les_fichiers_donnees_fichier_wdd_fichier_rep_ELTPARAGRAPHE000089"></a>Pour sauver tous les fichiers de données d'un fichier WDD ou d'un fichier .REP, la syntaxe est :


```txt
WDJournal /APPLI=<NomCompletWdd ou NomCompletREP>
/REP = <RepSauve>
/COMPRESS = <Vrai / Faux>
/MUET = <Vrai / Faux>
/MULTI = <Vrai / Faux>
/SANSBLOCAGE = <Vrai / Faux>
/SANSINDEX = <Vrai / Faux>
/SANSSOUSREP = <Vrai / Faux>
```


Détail des paramètres :

| Paramètre | Signification |
| --- | --- |
| /APPLI = &lt;NomCompletWdd ou NomCompletREP&gt; | Chaîne de caractères contenant le nom complet de l'analyse (fichier ".WDD") ou le nom complet du fichier ".REP" de l'application. |
| /REP=&lt;RepSauve&gt; | Chemin où sont sauvegardés les fichiers |
| /COMPRESS=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", compresse les fichiers de données. Les fichiers seront enregistrés dans une archive (fichier .WDZ).<br>Dans le cas contraire, les fichiers ne seront pas compressés.<br>Par défaut, cette option vaut "Vrai". |
| /MUET=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", en cas d'erreur bloquante, toutes les opérations effectuées seront inscrites dans un fichier résultat (fichier .LOG). L'exécution de WDJournal ne sera pas bloquée.<br>Dans le cas contraire, une fenêtre s'affichera en cas d'erreur.<br>Par défaut, cette option vaut "Faux". |
| /MULTI=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", découpe l'archive de sauvegarde en fichiers de 1.4 Mo. Si cette option est utilisée, il n'est pas nécessaire de spécifier l'option de compression.<br>Dans le cas contraire, l'archive n'est pas découpée.<br>Par défaut, cette option vaut "Faux". |
| /SANSBLOCAGE=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", seuls les fichiers de données qui ne sont pas bloqués seront sauvegardés.<br>Dans le cas contraire, tous les fichiers de données sont sauvegardés.<br>Par défaut, cette option vaut "Faux". |
| /SANSINDEX=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", les index des fichiers de données ne sont pas sauvegardés.<br>Dans le cas contraire, les index sont sauvegardés.<br>Par défaut, cette option vaut "Faux". |
| /SANSSOUSREP=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", le sous-répertoire de sauvegarde ne sera pas créé. La sauvegarde sera effectuée directement dans le répertoire &lt;RepSauve&gt;.<br>Dans le cas contraire, un sous-répertoire de sauvegarde est créé.<br>Par défaut, cette option vaut "Faux". |


**Exemple** : La ligne de commande suivante permet de sauvegarder l'ensemble des fichiers de l'analyse "C:\\MonProjet\\MonAnalyse.WDD" dans le répertoire "D:\\Sauvegarde de mes projets". Ces fichiers sont ensuite compressés. Les fichiers d'index ne sont pas sauvegardés.

**Attention** : Si les noms de répertoire utilisent des espaces, il est nécessaire d'entourer le paramètre de guillemets.


```wl
LanceAppli("WDJournal /APPLI= C:\MonProjet\MonAnalyse.WDD " + ...
	"/REP=""D:\Sauvegarde de mes projets"" /COMPRESS=Vrai /SANSINDEX=Vrai")
```



<a name="NOTE3_3"></a>


### Sauver tous les fichiers de données d'une base Client/Serveur HFSQL
<a name="sauver_tous_les_fichiers_donnees_une_base_clientserveur_hfsql_ELTPARAGRAPHE000169"></a>Pour sauver tous les fichiers de données d'une base Client/Serveur HFSQL, la syntaxe est : 


```txt
WDJournal /SERVEUR = <Nom Serveur>
	/BD = <Nom de la base>
	/NOM = <Nom de l'utilisateur>
	/MDP_DB = <Mot de passe>
	/REP = <RepSauve>
	/COMPRESS = <Vrai / Faux>
	/MUET = <Vrai / Faux>
	/MULTI = <Vrai / Faux>
	/SANSSOUSREP = <Vrai / Faux>
	/LISTE = <NomFichier>
	/APPLI = <NomAppli>
```


Détail des paramètres :

| Paramètre | Signification |
| --- | --- |
| /SERVEUR=&lt;Nom du serveur&gt; | Chaîne de caractères contenant le nom du serveur HFSQL Client/Serveur ou l'adresse IP du serveur. |
| /BD = &lt;Nom de la base&gt; | Chaîne de caractères contenant le nom de la base HFSQL Client/Serveur à sauver. |
| /NOM = &lt;Nom de l'utilisateur&gt; | Chaîne de caractères contenant le nom de l'utilisateur se connectant à la base. |
| /MDP_DB = &lt;Mot de passe&gt; | Chaîne de caractères contenant le mot de passe associé à l'utilisateur pour la base de données. |
| /REP=&lt;RepSauve&gt; | Chemin où sont sauvegardés les fichiers |
| /COMPRESS=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", compresse les fichiers de données. Les fichiers seront enregistrés dans une archive (fichier .WDZ).<br>Dans le cas contraire, les fichiers ne seront pas compressés.<br>Par défaut, cette option vaut "Vrai". |
| /MUET=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", en cas d'erreur bloquante, toutes les opérations effectuées seront inscrites dans un fichier résultat (fichier .LOG). L'exécution de WDJournal ne sera pas bloquée.<br>Dans le cas contraire, une fenêtre s'affichera en cas d'erreur.<br>Par défaut, cette option vaut "Faux". |
| /MULTI=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", découpe l'archive de sauvegarde en fichiers de 1.4 Mo. Si cette option est utilisée, il n'est pas nécessaire de spécifier l'option de compression.<br>Dans le cas contraire, l'archive n'est pas découpée.<br>Par défaut, cette option vaut "Faux". |
| /SANSSOUSREP=&lt;Vrai / Faux&gt; | Si cette option correspond à la chaîne de caractères "Vrai", le sous-répertoire de sauvegarde ne sera pas créé. La sauvegarde sera effectuée directement dans le répertoire &lt;RepSauve&gt;.<br>Dans le cas contraire, un sous-répertoire de sauvegarde est créé.<br>Par défaut, cette option vaut "Faux". |
| /LISTE = &lt;NomFichier&gt; | Nom complet du fichier contenant la liste des fichiers de données à sauvegarder. Ce fichier au format texte contient un nom de fichier par ligne. Il peut être créé par WDJournal (bouton "Enregistrer").<br>Exemple : <br>  <br>E:\\WD Graphe Boursier\\Exe\\Action.FIC  <br><br>E:\\WD Graphe Boursier\\Exe\\Action2000.FIC <br><br>E:\\WD Graphe Boursier\\Exe\\Cours.FIC  <br><br><br> |
| /APPLI=&lt;NomAppli&gt; | Nom de l'application qui sera utilisé pour identifier la sauvegarde ("Sauvegarde automatique de " + &lt;NomAppli&gt;). |

**Exemple** : La ligne de commande suivante permet de sauvegarder l'ensemble des fichiers de la base "MabaseHF" dans le répertoire "D:\\Sauvegarde de mes projets". Ces fichiers sont ensuite compressés. Les fichiers d'index ne sont pas sauvegardés.


```wl
LanceAppli("WDJournal /SERVEUR=123.123.123.1"+...
	"/BD=MaBaseHF /NOM=Flo /MDP_DB=Test"+...
	"/REP=""D:\Sauvegarde de mes projet"" /COMPRESS=Vrai"+ ...
	"/SANSINDEX=Vrai" /APPLI="MaBaseHF")
```



<a name="NOTE3_4"></a>


### Sauver tous les fichiers de données présents dans une liste
<a name="sauver_tous_les_fichiers_donnees_presents_dans_une_liste_ELTPARAGRAPHE000255"></a>Pour sauver une liste de fichiers de données, il suffit de créer un fichier texte contenant les différents noms physiques des fichiers à sauvegarder. Ce fichier peut être créé avec WDJournal lancé en mode interactif.

La ligne de commande est la suivante :

```txt
WDJournal /LISTE = <NomFichier>
          /REP = <RepSauve>
          /COMPRESS = Vrai
          /MUET = Vrai
          /MULTI = Vrai
          /SANSBLOCAGE = Vrai
          /SANSINDEX = Vrai
          /SANSSOUSREP = Vrai
```


Le tableau ci-dessous liste les différents éléments pouvant être présents sur la ligne de commande :

| Paramètre | Signification |
| --- | --- |
| /LISTE = &lt;NomFichier&gt; | Nom du fichier contenant la liste des fichiers de données à sauvegarder. Ce fichier au format texte contient un nom de fichier par ligne. Il peut être créé par WDJournal (bouton "Enregistrer").<br>Exemple :<br>  E:\\WD Graphe Boursier\\Exe\\Action.FIC  <br><br><br>Nom du fichier contenant la liste des fichiers de données à sauvegarder. Ce fichier au format texte contient un nom de fichier par ligne. Il peut être créé par WDJournal (bouton "Enregistrer"). <br>Exemple : <br>  E:\\WD Graphe Boursier\\Exe\\Action.FIC  <br><br>E:\\WD Graphe Boursier\\Exe\\Action2000.FIC<br>  <br>E:\\WD Graphe Boursier\\Exe\\Cours.FIC  <br><br> |
| /REP=&lt;RepSauve&gt; | Chemin où sont sauvegardés les fichiers |
| /COMPRESS=Vrai | Si cette option correspond à la chaîne de caractères "Vrai", compresse les fichiers de données. Les fichiers seront enregistrés dans une archive (fichier .WDZ) |
| /MUET=Vrai | Si cette option correspond à la chaîne de caractères "Vrai", en cas d'erreur bloquante, toutes les opérations effectuées seront inscrites dans un fichier résultat (fichier .LOG). L'exécution de WDJournal ne sera pas bloquée. |
| /MULTI=Vrai | Si cette option correspond à la chaîne de caractères "Vrai", découpe l'archive de sauvegarde en fichiers de 1.4 Mo. Si cette option est utilisée, il n'est pas nécessaire de spécifier l'option de compression. |
| /SANSBLOCAGE=Vrai | Si cette option correspond à la chaîne de caractères "Vrai", seuls les fichiers de données qui ne sont pas bloqués seront sauvegardés. |
| /SANSINDEX=Vrai | Si cette option correspond à la chaîne de caractères "Vrai", les index des fichiers de données ne sont pas sauvegardés. |
| /SANSSOUSREP=Vrai | Si cette option correspond à la chaîne de caractères "Vrai", le sous-répertoire de sauvegarde ne sera pas créé. La sauvegarde sera effectuée directement dans le répertoire &lt;RepSauve&gt;. |


**Exemple** : La ligne de commande suivante permet de sauvegarder les fichiers présents dans la liste "C:\\MaListe.LST" dans la répertoire "D:\\Sauvegarde". Les fichiers en cours d'utilisation ne seront pas sauvegardés.


```wl
LanceAppli("WDJournal /LISTE=C:\MaListe.LST /REP=D:\Sauvegarde/SANSBLOCAGE=Vrai")
```





