


## HRaye (Fonction)

***En anglais : HCross***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Raye un enregistrement d'un fichier de données. L'enregistrement est supprimé logiquement et pourra éventuellement être récupéré.

Les opérations effectuées sont les suivantes :

- l'enregistrement est rendu inactif. Les données sont conservées (ce qui n'est pas le cas lors de la suppression d'un enregistrement avec la fonction [HSupprime](../WDLang4/3044018.md)).

- les index (correspondant aux clés de l'enregistrement) sont supprimés du fichier d'index.

- les mémos associés à l'enregistrement sont conservés.




Cette fonction peut être utilisée indifféremment avec les fichiers de données, les vues HFSQL Mobile ou les requêtes.


<a name="sample_code"></a>

## Exemple

<a name="Exemple1"></a>

```wl
// Raye l'enregistrement numéro 123
HRaye(Client, 123)
```
<a name="Exemple2"></a>

```wl
// Suppression (rayure) des commandes d'un client
HLitRecherchePremier(COMMANDE, NUMCLI, ValNumCli)
TANTQUE HTrouve() = Vrai
	HRaye()
	HLitSuivant()
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = HRaye([<Fichier de données> [, <Numéro d'enregistrement> [, <Options>]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'enregistrement a été rayé, 

- <u><u><u><u>Faux</u></u></u></u> en cas d'erreur (enregistrement bloqué, problème d'intégrité, ...). La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'obtenir plus de détails.




**`<Fichier de données> : (Chaîne de caractères optionnelle)`**

Nom du fichier de données HFSQL, de la requête ou de la vue manipulé. 
Si ce paramètre correspond à une chaîne vide (""), la fonction **HRaye** manipule le dernier fichier de données utilisé par la dernière fonction de gestion HFSQL (fonction commençant par la lettre H).

**`<Numéro d'enregistrement> : (Entier optionnel)`**

Numéro de l'enregistrement à rayer. 
Si ce paramètre n'est pas précisé (est égal à 0 ou à la constante *hNumEnrEnCours*), l'enregistrement en cours sera rayé.

**`<Options> : (Constante optionnelle)`**

Paramètre :

- le blocage de l'enregistrement rayé. Si aucune constante de blocage n'est spécifiée, l'enregistrement rayé n'est pas bloqué.
	


|   |   |
| --- | --- |
| *hBlocageEcriture* | Blocage en écriture : l'enregistrement rayé en cours pourra être lu et consulté (fonction [HLit](../WDLang4/3044047.md)) par une autre application mais ne pourra pas être ré-activé par une autre application. Seule l'application en cours pourra le ré-activer. |
| *hBlocageLectureEcriture* | Blocage en lecture/écriture : l'enregistrement rayé en cours ne pourra ni être consulté ni être ré-activé par une autre application. |
| *hBlocageNon*<br>(valeur par défaut) | Aucun blocage : l'enregistrement rayé ne sera pas bloqué. |



- la gestion de l'intégrité sur l'enregistrement rayé.
	


|   |   |
| --- | --- |
| *hIgnoreIntégrité* | Ignore le contrôle d'intégrité sur cette opération, même si le contrôle de l'intégrité automatique est branché (fonction [HGèreIntégrité](../WDLang4/3044058.md)). |
| *hVérifieIntégrité* | Contrôle l'intégrité de l'opération, même si le contrôle de l'intégrité automatique est débranché (fonction [HGèreIntégrité](../WDLang4/3044058.md)). |


	Si les deux constantes sont utilisées en même temps, une erreur WLangage est générée. Ces constantes n'ont pas d'effet sur la suppression en cascade.  






<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Manipulations d'un enregistrement rayé
<a name="manipulations_enregistrement_raye_ELTPARAGRAPHE000173"></a>

- Un enregistrement rayé ne sera lu :

	- ni par les fonctions de parcours : [HPremier](../WDLang4/3044113.md), [HDernier](../WDLang4/3044101.md), [HSuivant](../WDLang4/3044027.md), [HPrécédent](../WDLang4/3044112.md), [HLitPremier](../WDLang4/3044051.md), [HLitDernier](../WDLang4/3044140.md), [HLitSuivant](../WDLang4/3044037.md), [HLitPrécédent](../WDLang4/3044048.md), [HAvance](../WDLang4/3044154.md), [HRecule](../WDLang4/3044126.md)

	- ni par les fonctions de recherche : [HRecherchePremier](../WDLang4/3044125.md), [HLitRecherchePremier](../WDLang4/3044036.md), [HRechercheDernier](../WDLang4/3044129.md), [HLitRechercheDernier](../WDLang4/3044034.md).




- Un enregistrement rayé pourra être consulté grâce à la fonction [HLit](../WDLang4/3044047.md).

- Un enregistrement rayé pourra être réactivé grâce aux fonctions [HModifie](../WDLang4/3044042.md) ou [HEcrit](../WDLang4/3044092.md).

- La fonction [HEtat](../WDLang4/3044081.md) permet de connaître l'état d'un enregistrement (actif, rayé, supprimé, ...).

- L'emplacement physique d'un enregistrement rayé ne sera réutilisable (par la fonction [HAjoute](../WDLang4/3044147.md) par exemple) qu'après :

	- soit l'exécution de la fonction [HLibère](../WDLang4/3044064.md),

	- soit une réindexation (avec compactage).






<a name="NOTE0_2"></a>


### Nombre d'enregistrements rayés
<a name="nombre_enregistrements_rayes_ELTPARAGRAPHE000251"></a>La fonction [HNbEnr](../WDLang4/3044006.md) permet de connaître le nombre d'enregistrements rayés dans le fichier de données.

Remarque : Par compatibilité avec WEBDEV 1.5/WINDEV 5.5, il est aussi possible de connaître le nombre d'enregistrements rayés grâce à la variable *h.NbSup*.
<a name="NOTE0_3"></a>


### Version du fichier de données
<a name="version_fichier_donnees_ELTPARAGRAPHE000265"></a>En cas de succès de la fonction **HRaye**, le numéro de version du fichier de données est modifié. Ce numéro de version est donné par la fonction [HVersion](../WDLang4/3044020.md).
<a name="NOTE0_4"></a>


### Rayer un enregistrement à partir d'une requête
<a name="rayer_enregistrement_partir_une_requete_ELTPARAGRAPHE000280"></a>Il est possible de rayer un enregistrement :

- soit uniquement dans le résultat de la requête.

- soit directement dans les fichiers manipulés par la requête (constante *HModifieFichier*utilisée dans les fonctions [HExécuteRequête](../WDLang4/3044080.md) ou [HExécuteRequêteSQL](../WDLang4/3044084.md)). Dans ce cas, la constante *hAvecFiltre*est automatiquement sélectionnée.




Quel que soit le mode d'exécution de la requête (avec ou sans la constante *hAvecFiltre*), la fonction **HRaye** n'est utilisable que sur les requêtes mono-fichier.

Attention : 

- Il est impossible de rayer un enregistrement dans une requête utilisant les groupes ou les agrégats.

- La gestion de l'intégrité et des doublons n'est pas réalisée lors d'opérations sur les requêtes multi-fichiers : il est conseillé d'utiliser les transactions pour éviter tout problème.



<a name="NOTE0_5"></a>


### Cas particuliers
<a name="cas_particuliers_ELTPARAGRAPHE000308"></a>

- **Gestion des blocages** : 
	Si un problème de blocage apparaît lors de la "rayure" d'un enregistrement (tentative de rayure d'un enregistrement bloqué en écriture par exemple), l'enregistrement n'est pas modifié et la fonction [HErreurBlocage](../WDLang4/3044099.md) renvoie <u><u><u><u>Vrai</u></u></u></u>.

- **Gestion de l'intégrité référentielle**
	Si la gestion de l'intégrité référentielle est active (fonction [HGèreIntégrité](../WDLang4/3044058.md)), et si l'intégrité n'est pas vérifiée lors de la suppression, la fonction **HRaye** n'est pas exécutée. Il est nécessaire de tester la fonction [HErreurIntégrité](../WDLang4/3044086.md) après la fonction **HRaye**.

- **Enregistrements supprimés**
	La fonction **HRaye** ne doit pas être appelée sur un enregistrement précédemment supprimé. 



<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Fichiers xBase
<a name="fichiers_xbase_ELTPARAGRAPHE000349"></a>La fonction [HSupprime](../WDLang4/3044018.md) a le même effet que la fonction **HRaye** : l'enregistrement est rayé et non supprimé. L'enregistrement peut donc être réactivé par la fonction [HModifie](../WDLang4/3044042.md). Dans ce cas, la fonction [HEtat](../WDLang4/3044081.md) renvoie la constante *hEtatRaye* sur un enregistrement supprimé (et non la constante *hEtatSup*).

<a name="XComposante"></a>

## Composante :
wd280hf.dll
