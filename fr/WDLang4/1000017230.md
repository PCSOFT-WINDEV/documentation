


## HRestaureSauvegarde (Fonction)

***En anglais : HRestoreBackup***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Permet de restaurer : 

- une sauvegarde immédiate (effectuée grâce à la fonction [HSauvegarde](../WDLang4/1000017081.md) ou via le Centre de Contrôle HFSQL).

- une sauvegarde planifiée (décrite à l'aide de la fonction [HAjouteSauvegardePlanifiée](../WDLang4/1000018866.md) ou via le Centre de Contrôle HFSQL).


La sauvegarde restaurée peut être une sauvegarde complète ou différentielle.

**Attention: la restauration d'une sauvegarde doit être effectuée avec précaution.**

Pour effectuer cette opération, il est nécessaire d'avoir le droit de sauvegarde (*hDroitSauvegarde*) ainsi que le droit de bloquer la base de données (*hDroitBlocage*).

**Pour restaurer tout le serveur** (ou les bases __jnl et __trs), aucune autre application ne doit être connectée au serveur. La connexion utilisée ne doit pas être attachée à une base de données (lors de l'appel à la fonction [HOuvreConnexion](../WDLang4/3044107.md), le paramètre &lt;Base de données&gt; doit correspondre à chaîne vide ("")). 

**Pour restaurer uniquement des bases de données**, aucune connexion ne doit être faite sur la base à restaurer.

**Dupliquer une base de données** : Une syntaxe spécifique de la fonction **HRestaureSauvegarde** (syntaxe 2) permet de restaurer la sauvegarde d'une base de données sous un nom différent. Il est ainsi possible de faire une copie d'une base en la renommant. Par exemple : pour faire une copie de la base MaBase2008 en la renommant en MaBase2009, il suffit de faire une sauvegarde de MaBase2008 puis de la restaurer sous le nom MaBase2009.



<a name="Example1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000020402&name=hrestauresauvegarde_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
cnxServeur est une Connexion

// Restauration d'une sauvegarde
SI HRestaureSauvegarde(cnxServeur, IDSauvegarde) = Faux ALORS
	Erreur("Echec de la restauration de la sauvegarde" + HErreurInfo(hErrMessage))
FIN
```
<a name="Example2"></a>

```wl
cnxServeur est une Connexion

// Restauration d'une sauvegarde complète et différentielle
InfoSauvegarde = HInfoSauvegarde(cnxServeur, IDSauvegarde)
CheminSauvegarde_Diff = ExtraitChaîne(InfoSauvegarde, 4, TAB)

InfoSauvegarde = HInfoSauvegarde(cnxServeur, IDSauvegarde_Complète)
CheminSauvegarde_Comp = ExtraitChaîne(InfoSauvegarde, 4, TAB)

SI HRestaureSauvegarde(cnxServeur, CheminSauvegarde_Comp, CheminSauvegarde_Diff) = Faux ALORS
	Erreur("Echec de la restauration de la sauvegarde" + HErreurInfo(hErrMessage))
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Restauration d'une sauvegarde à partir de son identifiant ou de son chemin

`<Résultat> = HRestaureSauvegarde(<Connexion> , <Sauvegarde> [, <Jauge>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la restauration de la sauvegarde a été effectuée, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur.




**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion vers le serveur où la restauration doit être effectuée. Cette connexion correspond :

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Sauvegarde> : (Entier ou chaîne de caractères)`**

Peut correspondre à :

- **Identifiant de la sauvegarde**. Cet identifiant peut correspondre à l'identifiant d'une sauvegarde complète ou d'une sauvegarde différentielle. 
	Lors d'une sauvegarde immédiate, cet identifiant est renvoyé par la fonction [HSauvegarde](../WDLang4/1000017081.md). Cet identifiant peut également être obtenu grâce à la fonction [HInfoSauvegarde](../WDLang4/1000017083.md).
	Lors d'une sauvegarde planifiée, cet identifiant correspond à la propriété **Identifiant** de la variable [hDescriptionSauvegarde](../WDLang4/1000017455.md). 

- **Chemin et nom de la sauvegarde à restaurer**. Ce nom a été spécifié lors de la sauvegarde. Ce nom peut également être obtenu grâce à la fonction [HInfoSauvegarde](../WDLang4/1000017083.md). Si ce nom correspond à un chemin relatif, la sauvegarde sera recherchée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".




**`<Jauge> : (Nom de fenêtre optionnel, nom de champ optionnel ou entier optionnel)`**



- Nom de la fenêtre dans laquelle la jauge doit être affichée ou nom du champ de type Jauge.

- Identifiant (Handle) de la fenêtre qui affiche la jauge.





<a name="SYNTAXE2"></a>

### Restauration d'une sauvegarde sous un nom de base de données différent

`<Résultat> = HRestaureSauvegarde(<Connexion> , <Sauvegarde> , <Base de données source> , <Base de données destination> [, <Jauge>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la restauration de la sauvegarde a été effectuée, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur.




**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion vers le serveur où la restauration doit être effectuée. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Sauvegarde> : (Entier ou chaîne de caractères)`**

Peut correspondre :

- Identifiant de la sauvegarde renvoyé par la fonction [HSauvegarde](../WDLang4/1000017081.md). Cet identifiant peut également être obtenu grâce à la fonction [HInfoSauvegarde](../WDLang4/1000017083.md).  

- Chemin et nom de la sauvegarde à restaurer. Ce nom a été spécifié lors de la sauvegarde. Ce nom peut également être obtenu grâce à la fonction [HInfoSauvegarde](../WDLang4/1000017083.md). Si ce nom correspond à un chemin relatif, la sauvegarde sera recherchée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".




**`<Base de données source> : (Chaîne de caractères)`**

Nom de la base de données à restaurer présente dans la sauvegarde. Cette syntaxe permet de restaurer une seule base de données présente dans la sauvegarde.

**`<Base de données destination> : (Chaîne de caractères)`**

Nom de la base de données qui sera restaurée. Ce nom peut être différent de la base de données source. Dans ce cas, la fonction permet de faire une copie de la base de données avec renommage.

**`<Jauge> : (Nom de fenêtre optionnel, nom de champ optionnel ou entier optionnel)`**



- Nom de la fenêtre dans laquelle la jauge doit être affichée ou nom du champ de type Jauge.

- Identifiant (Handle) de la fenêtre qui affiche la jauge.





<a name="SYNTAXE3"></a>

### Restauration d'une sauvegarde différentielle présente dans un répertoire spécifique (disponible à partir de la version 15)

`<Résultat> = HRestaureSauvegarde(<Connexion> , <Sauvegarde complète> , <Sauvegarde différentielle> [, <Jauge>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la restauration de la sauvegarde a été effectuée, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur.




**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion vers le serveur où la restauration doit être effectuée. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Sauvegarde complète> : (Chaîne de caractères)`**

Chemin et nom de la sauvegarde complète à restaurer. Ce nom a été spécifié lors de la sauvegarde. Ce nom peut également être obtenu grâce à la fonction [HInfoSauvegarde](../WDLang4/1000017083.md). Si ce nom correspond à un chemin relatif, la sauvegarde sera recherchée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".

**`<Sauvegarde différentielle> : (Chaîne de caractères)`**

Chemin et nom de la sauvegarde différentielle à appliquer sur la sauvegarde complète. Ce nom a été spécifié lors de la sauvegarde. Ce nom peut également être obtenu grâce à la fonction [HInfoSauvegarde](../WDLang4/1000017083.md). Si ce nom correspond à un chemin relatif, la sauvegarde sera recherchée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".

**`<Jauge> : (Nom de fenêtre optionnel, nom de champ optionnel ou entier optionnel)`**



- Nom de la fenêtre dans laquelle la jauge doit être affichée ou nom du champ de type Jauge.

- Identifiant (Handle) de la fenêtre qui affiche la jauge.






<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Droits nécessaires pour restaurer une sauvegarde
<a name="droits_necessaires_pour_restaurer_une_sauvegarde_ELTPARAGRAPHE000310"></a>Pour restaurer une sauvegarde, l'utilisateur ou le groupe doit posséder :

- le droit de faire des sauvegardes (constante *hDroitSauvegarde*). Ce droit s'applique aux serveurs et aux bases de données.

- le droit de bloquer la base de données (constante *hDroitBlocage*). Ce droit s'applique aux bases de données.




Pour savoir si un utilisateur ou un groupe possède ces droits, utilisez la fonction [HInfoDroitServeur](../WDLang4/3044322.md) ou [HInfoDroitBaseDeDonnées](../WDLang4/3044320.md).

Pour modifier les droits d'un utilisateur ou d'un groupe d'utilisateurs, utilisez la fonction [HModifieDroitServeur](../WDLang4/3044328.md) ou [HModifieDroitBaseDeDonnées](../WDLang4/3044326.md).
<a name="NOTE0_2"></a>


### Restauration effectuée depuis le Centre de Contrôle HFSQL
<a name="restauration_effectuee_depuis_centre_controle_hfsql_ELTPARAGRAPHE000338"></a>Il est possible de restaurer une sauvegarde depuis le Centre de Contrôle HFSQL. Cette sauvegarde est disponible dans l'onglet "Sauvegardes" de la description du serveur.


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDDuplication.gif) ***Exemples didactiques (WINDEV)*** : **WD Duplication** <br>Cet exemple didactique montre comment il est possible de dupliquer une base de données sur un serveur.<br>La duplication s'effectue par programmation et permet de donner un nouveau nom à la base.<br>L'exemple s'appuie sur les fonctions de sauvegarde et de restauration de sauvegarde HFSQL.

<a name="XComposante"></a>

## Composante :
wd280hf.dll
