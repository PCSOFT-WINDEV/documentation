


## HTransactionFin (Fonction)

***En anglais : HTransactionEnd***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Valide la transaction en cours :

- les modifications effectuées sur le fichier de données depuis le début de la transaction (fonction [HTransactionDébut](../WDLang4/3044002.md) ou fonction [HTransaction](../WDLang4/1000023384.md)) sont validées.

- le fichier de transaction est supprimé (si la transaction est la dernière transaction en cours dans le cas d'une application réseau).

- les enregistrements bloqués en lecture par la transaction sont débloqués.





<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
MaConnexion1 est une Connexion

// Début de la transaction sur les fichiers de données associés à la connexion MaConnexion1
HTransactionDébut(MaConnexion1)

// Code permettant de préparer la commande à ajouter
// ...

QUAND EXCEPTION DANS
	// Ajout de la commande
	HAjoute(Commande) 
	// Validation de l'ajout
	HTransactionFin(MaConnexion1)
FAIRE
	// Suppression des lignes de commandes
	HTransactionAnnule(MaConnexion1)
FIN
```
<a name="Exemple2"></a>

```wl
// Début de la transaction sur les fichiers de données Commande et LigneCde
HTransactionDébut("C:\Temp\Transaction.trs", "Commande,LigneCde,-Client")

// Code permettant de préparer la commande à ajouter
// ...

QUAND EXCEPTION DANS
	// Ajout de la commande
	HAjoute(Commande) 
	// Validation de l'ajout
	HTransactionFin() 
FAIRE
	// Suppression des lignes de commandes
	HTransactionAnnule() 
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Valider une transaction en cours sur une connexion

`<Résultat> = HTransactionFin(<Connexion>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la transaction est terminée, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'obtenir plus de renseignements sur l'erreur. 




**Attention** : Si une transaction globale est commencée, la fonction ne fait rien. Il faut utiliser la syntaxe 2.

**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion à manipuler. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).


Si ce paramètre correspond à la constante *hAccèsHF7*, la transaction est réalisée sur les fichiers de données HFSQL ISAM.  


<a name="SYNTAXE2"></a>

### Valider une transaction globale en cours

`<Résultat> = HTransactionFin()`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la transaction est terminée, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'obtenir plus de renseignements sur l'erreur.  






<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Cas d'erreurs
<a name="cas_erreurs_ELTPARAGRAPHE000144"></a>

- Imbrication de transactions : Il est impossible d'imbriquer les transactions (c'est-à-dire d'appeler la fonction [HTransactionDébut](../WDLang4/3044002.md) ou la fonction [HTransaction](../WDLang4/1000023384.md) dans une transaction). Dans ce cas, l'erreur 70031 est générée.

- Une erreur fatale est affichée dans les cas suivants : 

	- Une transaction est débutée sur toutes les connexions alors qu'il existe au moins une connexion en transaction. 

	- Une transaction sur une connexion est débutée après avoir commencé une transaction sur toutes les connexions. 

	- Une transaction sur toutes les connexions est débutée alors qu'il existe au moins une connexion dont le mode d'isolation n'est pas "Read Uncommitted".






<a name="NOTE0_2"></a>


### Manipulations d'enregistrements pendant une transaction
<a name="manipulations_enregistrements_pendant_une_transaction_ELTPARAGRAPHE000166"></a>Pendant une transaction, il est nécessaire de suivre certaines règles lors de la manipulation des enregistrements. Pour plus de détails, consultez [Transactions : Manipuler les enregistrements lors d'une transaction](../WDLang4/3044336.md).
<a name="NOTE0_3"></a>


### Transactions et contexte HFSQL indépendant
<a name="transactions_contexte_hfsql_independant_ELTPARAGRAPHE000178"></a>Lors de la copie de contexte, si une transaction est en cours sur le premier contexte, le nouveau contexte n'est pas en transaction. Il faut rappeler la fonction [HTransactionDébut](../WDLang4/3044002.md) (ou la fonction [HTransaction](../WDLang4/1000023384.md)) pour démarrer une transaction dans le nouveau contexte.
<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### OLE DB et Connecteurs Natifs
<a name="ole_connecteurs_natifs_ELTPARAGRAPHE000189"></a>Seules les syntaxes avec connexion sont prises en compte par les Connecteurs Natifs (appelés également Accès Natifs) qui gèrent les transactions. Il est également possible d'utiliser la fonction [SQLTransaction](../WDLang4/3072029.md).

<a name="XComposante"></a>

## Composante :
wd280hf.dll
