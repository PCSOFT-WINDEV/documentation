


## &lt;Source&gt;.CréationSiInexistant (Fonction)

***En anglais : &lt;Source&gt;.CreationIfNotFound***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Effectue les opérations suivantes :

- Si le fichier de données n'existe pas, crée à vide un fichier de données (fichier d'extension ".FIC") avec le fichier d'index et le fichier mémo si nécessaire.
	La fonction est équivalente à la fonction [&lt;Source&gt;.Création](../WDLang4/1000024207.md).

- Si le fichier de données existe, ouvre le fichier de données. 
	La fonction est alors équivalente à la fonction [&lt;Source&gt;.Ouvre](../WDLang4/1000025043.md). 
	Pour optimiser l'appel à la fonction **&lt;Source&gt;.CréationSiInexistant**, l'ouverture du fichier de données peut être également réalisée uniquement au premier accès réalisé sur le fichier de données (en utilisant la constante *hOuvertureDifférée*).




**Remarque** : Il est possible d'activer la création automatique des fichiers de données inexistants lors de la description du projet (onglet "Fichiers" de la description du projet, option "Créer les fichiers de données automatiquement au moment de leur ouverture"). La fonction **&lt;Source&gt;.CréationSiInexistant** est automatiquement utilisée si le fichier de données n'existe pas lors de sa première manipulation.
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png) Si le fichier de données est journalé, il est possible de préciser l'emplacement des fichiers journaux.![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Si des contraintes d'intégrité ont été définies et si elles sont gérées, les liaisons sont mises à jour par le serveur lors de la création du fichier de données.
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple

<a name="3044254_Exemple2"></a>

```wl
// Création du fichier de données Commande (décrit dans l'analyse)
Client.CréationSiInexistant()
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = <Source>.CréationSiInexistant([<Mot de passe> [, <Chemin du fichier JNL> [, <Chemin du fichier JournalOpération>]] [, <Option>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le fichier de données a été créé ou ouvert, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur. En cas d'erreur fatale, un traitement spécifique est nécessaire pour continuer le programme et vérifier si le fichier de données a été créé (voir Notes).




**`<Source> : (Type correspondant à la source spécifiée)`**

Nom du fichier de données à utiliser. 



**`<Mot de passe> : (Chaîne de caractères optionnelle)`**



- Mot de passe associé au fichier de données. 

- Chaîne vide ("") si aucun mot de passe n'est utilisé.




**`<Chemin du fichier JNL> : (Chaîne de caractères optionnelle)`**

Chemin d'accès au fichier JNL associé au fichier de données journalé. Ce paramètre est pris en compte uniquement si le fichier de données est journalé. Dans ce cas, le fichier &lt;Nom du fichier&gt;JNL.fic sera créé à l'emplacement spécifié.
![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Ce paramètre ne doit pas être précisé. En effet, en HFSQL Client/Serveur, le chemin du fichier JNL est fixé et ne peut pas être modifié.![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Ce paramètre est ignoré.

**`<Chemin du fichier JournalOpération> : (Chaîne de caractères optionnelle)`**

Chemin d'accès du fichier JournalOpération et du fichier JournalIdentification associé au fichier de données journalé. Le fichier JournalOpération contient toutes les opérations effectuées sur le fichier de données journalé. Ce paramètre est pris en compte uniquement si le fichier de données est journalé.
![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Ce paramètre ne doit pas être précisé. En effet, en HFSQL Client/Serveur, le chemin du fichier des opérations est fixé et ne peut pas être modifié.![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Ce paramètre est ignoré.

**`<Option> : (Constante optionnelle)`**

Optimisation de l'ouverture des fichiers de données existants.


|   |   |
| --- | --- |
| *hChangeAlphabet* | L'alphabet défini avec la fonction [ChangeAlphabet](../WDLang1/3054001.md) sera pris en compte dans le nouveau fichier de données. Les tris, recherches (ou autres) sur des clés de type chaîne (chaînes, caractères, date et heure) seront effectuées selon cet alphabet. |
| *hOuvertureDifférée* | Si le fichier de données existe déjà, il ne sera ouvert que lors du premier accès au fichier de données. Si le fichier de données n'existe pas, il est créé et ouvert.<br><br>![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png) Cette constante est disponible uniquement en mode HFSQL Classic. |
| *hSansLiaison* | **Gestion de l'intégrité** : Les liaisons ne sont pas mises à jour sur le serveur (création, modification, suppression selon le cas).<br>**Rappel** : Par défaut, lors de la création d'un fichier de données, les liaisons sont mises à jour sur le serveur.<br>![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Cette constante est disponible uniquement en mode HFSQL Client/Serveur. |

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Ce paramètre est ignoré.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Caractéristiques du fichier de données créé
<a name="caracteristiques_fichier_donnees_cree_ELTPARAGRAPHE000408"></a>Les caractéristiques du fichier de données créé sont les suivantes :

- *Nom du fichier de données* :
	Nom physique défini lors de la description du fichier de données sous l'éditeur d'analyses. Ce nom peut être modifié avant la création du fichier de données grâce à la fonction [&lt;Source&gt;.ChangeNom](../WDLang4/1000024201.md).

- *Répertoire du fichier de données* :
	Répertoire défini lors de la description du fichier de données sous l'éditeur d'analyses. Ce répertoire peut être modifié avant la création du fichier de données par les fonctions [&lt;Source&gt;.ChangeRep](../WDLang4/1000024202.md) et [HSubstRep](../WDLang4/3044028.md).
	**Remarque** : Si l'UAC est actif (Windows Vista et supérieur), la localisation des données est spécifique : les données ne seront pas localisées dans le répertoire de l'application mais dans un répertoire spécifique de Windows. Dans ce cas, il est nécessaire de créer le répertoire des données de l'application (le chemin peut être obtenu à l'aide de la fonction [fRepDonnéesUtilisateur](../WDLang1/3036071.md)).

- L'ordre des rubriques créées dans le fichier physique est l'ordre physique des rubriques créées dans l'analyse et non l'ordre logique.

- *Contenu du fichier de données* :
	Le fichier de données créé est vide ce qui ne signifie pas que sa taille est nulle (le fichier de données contient un entête décrivant sa structure).


**Remarque** : Si le fichier de données existait déjà (même nom, même répertoire), ce fichier de données est ouvert. Si la constante *hOuvertureDifférée* est spécifiée, le fichier de données ne sera ouvert que lors du premier accès (permet d'optimiser la vitesse de la fonction **&lt;Source&gt;.CréationSiInexistant**).
<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Les différents fichiers créés
<a name="les_differents_fichiers_crees_ELTPARAGRAPHE000454"></a>Lors de la création d'un fichier de données, les fichiers suivants peuvent être créés en plus du fichier de données :

- **Un fichier d'index** (d'extension ".NDX") si une ou plusieurs clés ont été définies dans la description du fichier de données.

- **Un fichier mémo** (d'extension ".MMO") si une ou plusieurs rubriques de type mémo ont été définies dans la description du fichier de données.

- **Un fichier journal** (d'extension ".JNL"). Ce fichier est créé uniquement si l'option correspondante a été sélectionnée lors de la description du fichier de données (voir paragraphe suivant).
	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Ce fichier n'est pas créé.

- **Un fichier &lt;NomProjet&gt;.REP**. Ce fichier contient la liste des fichiers de données manipulés par l'application. Ce fichier est créé (ou complété) si la gestion du .REP est active (fonction [HGèreREP](../WDLang4/3044061.md)). Si la constante *hOuvertureDifférée* est spécifiée, le .REP sera mis à jour à l'ouverture automatique du fichier de données réalisée lors du premier accès au fichier de données. Pour plus de détails sur le fichier .REP, consultez [Fichier .REP](../WDLang4/3044186.md).
	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Ce fichier n'est pas créé.



<a name="NOTE0_3"></a>


### Gestion du mot de passe
<a name="gestion_mot_passe_ELTPARAGRAPHE000483"></a>Le mot de passe peut être défini :

- directement à la création ou à l'ouverture du fichier de données avec la fonction **&lt;Source&gt;.CréationSiInexistant**.

- avant la création du fichier de données grâce à la fonction [&lt;Source&gt;.MotDePasse](../WDLang4/1000025044.md).


**Attention** : Le mot de passe est indépendant du cryptage des données. Le cryptage des données doit être configuré lors de la description du fichier de données dans l'éditeur d'analyses (Onglet "Détail").
![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Le mot de passe n'est pas associé à un fichier de données mais à une base de données. Ce mot de passe doit être indiqué lors de la connexion (fonction [HConnecte](../WDLang4/3044263.md)).
<a name="NOTE0_4"></a>


### Gestion des erreurs fatales lors de la création d'un fichier de données
<a name="gestion_des_erreurs_fatales_lors_creation_fichier_donnees_ELTPARAGRAPHE000512"></a>En cas d'erreur fatale lors de la création d'un fichier de données, il peut être intéressant de continuer le programme tout en vérifiant si le fichier de données a tout de même été créé. Pour cela, il est conseillé de faire le traitement d'exception suivant :

```wl
QUAND EXCEPTION DANS
	Père.CréationSiInexistant()
FAIRE
	Erreur("Erreur HFSQL : " + HErreur())
SINON
	Trace("fichier créé")
FIN
```

<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Gestion des alphabets non latins 
<a name="gestion_des_alphabets_non_latins_ELTPARAGRAPHE000530"></a>Si la constante *hChangeAlphabet* est précisée, l'alphabet utilisé dans le fichier de données sera celui précisé par la fonction [ChangeAlphabet](../WDLang1/3054001.md). Les tris, recherches, ... sur des clés de type chaîne (Chaînes, caractères, date et heure) seront effectuées selon cet alphabet.

L'alphabet utilisé pourra ensuite être modifié avec la fonction [&lt;Source&gt;.Réindexe](../WDLang4/1000025060.md).

**Remarque** : la taille des rubriques de type chaîne spécifiée dans l'analyse est une taille en octets et non en caractères. Selon l'alphabet utilisé, il peut être nécessaire d'augmenter la taille de la rubrique (par exemple si les caractères utilisés sont codés sur 2 octets).

Pour plus de détails sur la gestion des alphabets non latins dans les fichiers de données, consultez [Gérer des alphabets spécifiques dans des fichiers de données](../WDLang1/3054017.md).
<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Réplication : Plage d'identifiants
<a name="replication_plage_identifiants_ELTPARAGRAPHE000559"></a>Les identifiants automatiques des fichiers des réplicas abonnés utilisent une plage d'identifiants différente de celle du fichier de réplica maître et des autres fichiers de réplicas abonnés.

Cette plage d'identifiants automatiques est inscrite dans l'entête de chaque fichier de données (extension ".FIC").
Cette plage est initialisée :

- lors de la création d'un fichier de données (fonctions [&lt;Source&gt;.Création](../WDLang4/1000024207.md), **&lt;Source&gt;.CréationSiInexistant**).

- grâce à l'outil [WDReplic](../WDReplic/3520016.md).

- lors de l'utilisation de la fonction [&lt;Source&gt;.InitAbonné](../WDLang4/1000024998.md).


Pour plus de détails, consultez les [conséquences de la mise en place de la réplication](../WDLang4/3044246.md).
<a name="NOTE0_7"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Priorité pour la définition de l'emplacement des fichiers du journal
<a name="priorite_pour_definition_emplacement_des_fichiers_journal_ELTPARAGRAPHE000600"></a>La définition de l'emplacement des fichiers journal se fait selon l'ordre de priorité suivant :

1. Emplacement spécifié lors de la création du fichier de données journalé (fonction **&lt;Source&gt;.CréationSiInexistant**).

2. Emplacement spécifié par la fonction [&lt;Source&gt;.ChangeRepJnl](../WDLang4/1000024203.md).

3. Emplacement spécifié dans l'analyse.

4. Emplacement du fichier de données journalé.




Si une autre application utilise la fonction [&lt;Source&gt;.DéclareExterne](../WDLang4/1000024214.md) sur un fichier de données journalé, les modifications effectuées par cette application sont enregistrées dans les fichiers journaux spécifiés dans l'entête du fichier de données HFSQL journalé.
![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) L'emplacement des fichiers du Journal est fixe et ne peut pas être modifié. Pour plus de détails, consultez [Fichiers du journal en mode Client/Serveur](../WDLang4/3044197.md). 
<a name="NOTE0_8"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) 

### Création ou ouverture d'une table existante
<a name="creation_ouverture_une_table_existante_ELTPARAGRAPHE000638"></a>Si la table existe déjà, la table est ouverte.

Si la table n'existe pas, la table est créée. Lors d'une création de table, WINDEV et WEBDEV tentent de créer les rubriques dans le type OLE DB correspondant au type HFSQL. Si ce type n'est pas supporté, le moteur HFSQL essaye successivement tous les types OLEDB "compatibles" jusqu'à trouver un type supporté par la base OLEDB.
<a name="NOTE0_9"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Gestion des index
<a name="gestion_des_index_ELTPARAGRAPHE000652"></a>Si l'ajout d'un index échoue, aucun message d'erreur n'est renvoyé par la fonction **&lt;Source&gt;.CréationSiInexistant**. La table est simplement créée sans l'index posant problème. Dans ce cas, il est possible de trouver des doublons dans une rubrique considérée comme clé unique par WINDEV ou WEBDEV si la base de données externe ne peut pas gérer de clé unique.
<a name="NOTE0_10"></a>


### Création du fichier de données à partir de sa description
<a name="creation_fichier_donnees_partir_description_ELTPARAGRAPHE000665"></a>Il est possible de créer directement le fichier de données à vide à partir de sa description dans l'éditeur d'analyses. Il suffit de sélectionner l'option "Créer le fichier des données" du menu contextuel du fichier de données (dans le graphe de l'analyse) et de sélectionner le répertoire dans lequel le fichier de données doit être créé.

<a name="XComposante"></a>

## Composante :
wd280hf.dll
