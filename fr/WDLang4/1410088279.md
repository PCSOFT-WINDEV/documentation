


## &lt;redisConnexion&gt;.Abonne (Fonction)

***En anglais : &lt;redisConnection&gt;.Subscribe***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Souscrit un abonnement à un canal de diffusion Redis. L'application sera alors notifiée des messages émis par les applications connectées au serveur Redis publiant des messages sur ce canal.
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
PROCÉDURE INTERNE OnRedis(nType est un entier, sChannel est chaîne, bufMessage est un Buffer)
	SELON nType
		CAS redisAbonnement
			Trace("Abonnement à " + sChannel) 
		CAS redisDésabonnement
			Trace("Désabonnement à " + sChannel) 
		CAS redisDéconnexion
			Trace("Déconnexion : " + sChannel)		
		CAS redisMessage
			Trace("Message sur " + sChannel+" : " + UTF8VersChaîne(bufMessage))
		AUTRE CAS
			Trace("Inconnu")
		FIN
	FIN

gRedis.Abonne("MonCanal", OnRedis)
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = <Connexion>.Abonne(<Canal> , <Procédure WLangage>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la souscription a été effectuée, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire.




**`<Connexion> : (Variable de type redisConnexion)`**

Nom de la variable de type [redisConnexion](../WDLang4/1000023527.md) correspondant à la connexion au serveur Redis.

**`<Canal> : (Chaîne de caractères)`**

Nom du canal de diffusion auquel il est nécessaire de s'abonner pour la réception des messages.

**`<Procédure WLangage> : (Nom de procédure)`**

Nom de la procédure WLangage (également nommée "callback") appelée : 

- lors de la réception d'un message, 

- lors de l'abonnement, 

- lors du désabonnement, 

- lors de la déconnexion. 


Cette procédure permet de traiter le message en cours. Elle sera appelée dans un thread spécifique. 
Cette procédure est de la forme :

```txt
PROCÉDURE <Nom de la procédure>(<Type>, <Canal abonnement>, <Message>)
```



- &lt;Type&gt; contient le type du message. Ce paramètre correspond à une des constantes suivantes : 
	


|   |   |
| --- | --- |
| *redisAbonnement* | L'application vient de s'abonner au canal &lt;Canal abonnement&gt;. |
| *redisDéconnexion* | La connexion au serveur Redis a été perdue.<br><br>Si la procédure renvoie <u><u><u><u>Faux</u></u></u></u>, l'application perd l'abonnement. Dans les autre cas, l'application essayera de se reconnecter au serveur Redis. |
| *redisDésabonnement* | L'application vient de se désabonner du canal &lt;Canal abonnement&gt;. |
| *redisMessage* | L'application vient de recevoir un message. Dans ce cas, &lt;Message&gt; contient le contenu du message. |



- &lt;Canal abonnement&gt; est une chaîne de caractères contenant le nom du canal pour lequel l'abonnement a été souscrit.

- &lt;Message&gt; est un buffer correspondant au contenu du message.






<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280big.dll
