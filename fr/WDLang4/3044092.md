


## HEcrit (Fonction)

***En anglais : HWrite***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Écrit un enregistrement dans le fichier de données sans mettre à jour les index correspondants à toutes les clés utilisées dans le fichier de données. Les mémos sont ajoutés si nécessaire (si la gestion des mémos est active, fonction [HGèreMémo](../WDLang4/3044139.md)).

Après l'exécution de la fonction **HEcrit** :

- les erreurs d'intégrité et de doublons ne sont pas testées.

- si un problème de blocage est rencontré (tentative de modification d'un enregistrement bloqué), la fonction [HErreurBlocage](../WDLang4/3044099.md) renvoie <u><u><u>Vrai</u></u></u> et l'enregistrement n'est pas modifié.

- le numéro de l'enregistrement en cours est modifié : l'enregistrement en cours correspond à l'enregistrement écrit.




**Remarques** :

- Pour mettre à jour les index pendant une écriture, utilisez les fonctions [HAjoute](../WDLang4/3044147.md) ou [HModifie](../WDLang4/3044042.md). 
	![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) La fonction **HEcrit** est équivalente à la fonction [HModifie](../WDLang4/3044042.md). Les index sur la base de données sont mis à jour.

- Si la valeur d'une clé est modifiée avec la fonction **HEcrit**, l'index sera déphasé. Il est nécessaire de ré-indexer (fonction [HRéindexe](../WDLang4/3044133.md)).

- Cette fonction peut être utilisée pour écrire un enregistrement dans une sélection réalisée par une requête (requête exécutée avec la constante *hAvecFiltre* uniquement).





<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Écriture d'un enregistrement à la fin d'un fichier de données
HEcrit(Client, HNbEnr() + 1)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = HEcrit([<Fichier de données> [, <Numéro d'enregistrement> [, <Options>]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'écriture dans le fichier de données a été effectuée,

- <u><u><u><u>Faux</u></u></u></u> en cas d'erreur (blocage, ...) : l'enregistrement n'est pas modifié. La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur.




**`<Fichier de données> : (Chaîne de caractères optionnelle)`**

Nom du fichier de données manipulé. Si ce nom n'est pas spécifié, la fonction **HEcrit** va manipuler le dernier fichier de données utilisé par la dernière fonction de gestion HFSQL (fonction commençant par la lettre H).

**`<Numéro d'enregistrement> : (Entier optionnel)`**

Numéro de l'enregistrement à écrire. L'enregistrement chargé en mémoire est ré-écrit sur l'enregistrement spécifié. 
Si ce numéro est supérieur au nombre d'enregistrements dans le fichier de données, des enregistrements supprimés intermédiaires seront créés pour que la lecture séquentielle du fichier de données (fonction [HLit](../WDLang4/3044047.md)) soit cohérente. 
Si ce paramètre n'est pas spécifié (égal à 0 ou à la constante *hNumEnrEnCours*), la fonction **HEcrit** va modifier l'enregistrement en cours dans le fichier de données.
![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) La fonction **HEcrit** modifie uniquement l'enregistrement en cours. Il est impossible de spécifier un numéro d'enregistrement différent de celui en cours (pour désigner l'enregistrement en cours, utilisez la constante *hNumEnrEnCours*).

**`<Options> : (Combinaison de constantes optionnelle)`**

Paramètre :

- **le mode de calcul de l'identifiant automatique** : Pour plus de détails sur la gestion de l'identifiant automatique lors de l'ajout d'un enregistrement, consultez [Gestion de l'identifiant automatique lors d'un ajout](../WDLang4/3044183.md).
	


|   |   |
| --- | --- |
| *hEcritureDéfaut*<br>(Valeur par défaut) | **Si l'enregistrement écrit n'est pas un enregistrement supprimé**, l'identifiant automatique (s'il existe) de l'enregistrement dans le fichier de données est ré-utilisé. <br>**Si l'enregistrement écrit est un enregistrement supprimé**, un nouvel identifiant automatique est calculé pour l'enregistrement.<br>Si la constante *hEcritureDéfaut* est précisée avec une des autres constantes, *hEcritureDéfaut* est ignorée. |
| *hFixeIDAuto* | L'identifiant automatique n'est pas calculé lors de l'écriture : la valeur de l'identifiant sera celle mémorisée au moment de l'écriture. <br>La prochaine valeur de l'identifiant calculée par le moteur HFSQL correspondra à la plus grande valeur de l'identifiant dans le fichier +1. |
| *hForceIDAuto* | L'identifiant automatique n'est pas calculé lors de l'écriture : la valeur de l'identifiant sera celle mémorisée au moment de l'écriture. |
| *hRecalculeIDAuto* | L'identifiant automatique de l'enregistrement sera re-calculé lors de l'écriture. Cette constante est prioritaire sur les constantes *hForceIDAuto* et *hFixeIDAuto*. |


	Si les trois constantes (*hForceIDAuto*, *hFixeIDAuto* et *hRecalculeIDAuto*) sont utilisées en même temps, une erreur WLangage est générée.

- **le mode de blocage de l'enregistrement.**
	Si aucune constante de blocage n'est utilisée, l'enregistrement écrit n'est pas bloqué.
	


|   |   |
| --- | --- |
| *hBlocageEcriture* | Blocage en écriture : l'enregistrement écrit sera bloqué en écriture. Cet enregistrement pourra être lu par une autre application mais ne pourra pas être modifié par une autre application. Seule l'application en cours pourra le modifier, ou le débloquer. |
| *hBlocageLectureEcriture* | Blocage en lecture/écriture : l'enregistrement écrit sera bloqué en lecture et en écriture. Cet enregistrement ne pourra ni être lu ni être modifié par une autre application. Seule l'application en cours pourra le modifier, le lire ou le débloquer. |
| *hBlocageNon* <br>(Valeur par défaut) | Aucun blocage : l'enregistrement écrit ne sera pas bloqué. |





![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Si le provider OLE DB ou le Connecteur Natif (également appelé Accès Natif) utilisé ne gère pas les blocages, les options de blocage seront sans effet.
![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) Le paramètre &lt;Options&gt; n'est pas pris en compte.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Gestion des identifiants automatiques
<a name="gestion_des_identifiants_automatiques_ELTPARAGRAPHE000234"></a>Par défaut, lors de l'ajout d'un enregistrement dans un fichier de données, la rubrique de type "Identifiant automatique" est automatiquement mise à jour.

Les constantes *hForceIDAuto* et *hFixeIDAuto* permettent de modifier le comportement par défaut de l'identifiant automatique.

Pour plus de détails sur la gestion de l'identifiant automatique lors de l'ajout d'un enregistrement, consultez [Gestion de l'identifiant automatique](../WDLang4/3044183.md).


![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) **Cas particuliers**

- Si la base de données génère un identifiant automatique, le moteur HFSQL conserve cette valeur. Si les constantes *hForceIDAuto* ou *hFixeIDAuto* sont précisées, le moteur HFSQL remplace la valeur générée par la valeur voulue.
	**Remarque** : la constante *hForceIDAuto* équivaut à *hFixeIDAuto* : l'identifiant automatique calculé par le moteur HFSQL lors du prochain ajout sera unique dans le fichier de données.

- Si la base de données ne génère pas d'identifiant automatique, le moteur HFSQL génère la valeur et l'affecte à l'identifiant automatique.



<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Langage Externe](https://doc.pcsoft.fr/ext/images/fr/LE.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Écriture d'enregistrements supprimés ou rayé
<a name="ecriture_enregistrements_supprimes_raye_ELTPARAGRAPHE000262"></a>Si le numéro d'enregistrement correspond à un enregistrement rayé ou supprimé, cet enregistrement est ré-activé.
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Langage Externe](https://doc.pcsoft.fr/ext/images/fr/LE.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Version du fichier de données après une écriture
<a name="version_fichier_donnees_apres_une_ecriture_ELTPARAGRAPHE000273"></a>Si l'enregistrement a été écrit (pas de problème de blocage, ...), le numéro de version du fichier de données est modifié. Pour connaître le numéro de version, utilisez la fonction [HVersion](../WDLang4/3044020.md).
<a name="NOTE0_4"></a>


### Gestion des mémos binaires
<a name="gestion_des_memos_binaires_ELTPARAGRAPHE000285"></a>Lors de la modification d'un enregistrement, les mémos sont modifiés si nécessaire (si la gestion des mémos est activée avec la fonction [HGèreMémo](../WDLang4/3044139.md)). 
**Rappel** : pour initialiser une rubrique de type mémo binaire, utilisez la fonction [HAttacheMémo](../WDLang4/3044173.md).
<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Langage Externe](https://doc.pcsoft.fr/ext/images/fr/LE.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Si vous utilisez la fonction HEcrit avec une base de données au format Hyper File 5.5 
<a name="vous_utilisez_fonction_docparampagetitleshort_avec_une_base_donnees_format_hyper_file_55_ELTPARAGRAPHE000304"></a>Les rubriques de type TEXTE seront automatiquement complétées par des espaces.
<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Parcours et écriture d'un enregistrement
<a name="parcours_ecriture_enregistrement_ELTPARAGRAPHE000318"></a>Si l'écriture est réalisée pendant un parcours, l'enregistrement écrit sera visible dans le parcours en cours uniquement. Si d'autres parcours ont été définis sur cette base de données, l'enregistrement écrit ne sera visible qu'après ré-initialisation de ces parcours.

<a name="XComposante"></a>

## Composante :
wd280hf.dll
