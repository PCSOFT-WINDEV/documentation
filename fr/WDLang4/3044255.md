


## HCréation (Fonction)

***En anglais : HCreation***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Crée à vide un fichier de données (fichier d'extension ".FIC") avec le fichier d'index et le fichier mémo si nécessaire.

Cette fonction permet également de supprimer tous les enregistrements d'un fichier de données. Dans ce cas, l'enregistrement en mémoire n'est pas annulé. Pour l'initialiser, utilisez la fonction [HRAZ](../WDLang4/3044118.md).

**Remarque** : Il est possible d'activer la création automatique des fichiers de données inexistants lors de la description du projet (onglet "Fichiers" de la description du projet, option "Créer les fichiers de données automatiquement au moment de leur ouverture"). La fonction **HCréation** est automatiquement utilisée si le fichier de données n'existe pas lors de sa première manipulation.
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png) Si le fichier de données est journalé, il est possible de préciser l'emplacement des fichiers journaux.![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Si des contraintes d'intégrité ont été définies et si elles sont gérées, les liaisons sont mises à jour sur le serveur.


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003044255&name=hcreation_fonction&product=WD">Voir des exemples supplémentaires</a>

```wl
// Création du fichier de données Commande (décrit dans l'analyse)
HCréation(Commande)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = HCréation(<Fichier de données> [, <Mot de passe> [, <Chemin du fichier JNL> [, <Chemin du fichier JournalOpération> [, <Option>]]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le fichier de données a été créé, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur. En cas d'erreur fatale, un traitement spécifique est nécessaire pour continuer le programme et vérifier si le fichier de données a été créé (voir Notes).




**`<Fichier de données> : (Chaîne de caractères)`**

Nom du fichier de données à créer.
![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) MySQL : le nom de la table ne doit pas contenir d'accent (Exemple : "FichierAccentué"). Ceci est un problème interne à MySQL (testé sur les versions 3.23.52-max-nt et 3.23.47-max-nt du serveur MySQL).

**`<Mot de passe> : (Chaîne de caractères optionnelle)`**



- Mot de passe associé au fichier de données. 
	![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Le mot de passe des fichiers HFSQL est insensible à la casse. 

- Chaîne vide ("") si aucun mot de passe n'est utilisé.




**`<Chemin du fichier JNL> : (Chaîne de caractères optionnelle)`**

Chemin d'accès au fichier JNL associé au fichier de données journalé. Ce paramètre est pris en compte uniquement si le fichier de données est journalé. Dans ce cas, le fichier &lt;Nom du fichier&gt;JNL.fic sera créé à l'emplacement spécifié.
![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Ce paramètre ne doit pas être précisé. En effet, en HFSQL Client/Serveur, le chemin du fichier JNL est fixé et ne peut pas être modifié.![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Ce paramètre est ignoré.

**`<Chemin du fichier JournalOpération> : (Chaîne de caractères optionnelle)`**

Chemin d'accès du fichier JournalOpération et du fichier JournalIdentification associé au fichier journalé. Le fichier JournalOpération contient toutes les opérations effectuées sur le fichier journalé. Ce paramètre est pris en compte uniquement si le fichier de données est journalé.
![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Ce paramètre ne doit pas être précisé. En effet, en HFSQL Client/Serveur, le chemin du fichier des opérations est fixé et ne peut pas être modifié.![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Ce paramètre est ignoré.

**`<Option> : (Constante optionnelle de type Entier)`**

Options de création du fichier de données :  


|   |   |
| --- | --- |
| *hChangeAlphabet* | L'alphabet défini avec la fonction [ChangeAlphabet](../WDLang1/3054001.md) sera pris en compte dans le nouveau fichier de données. Les tris, recherches, ... sur des clés de type chaîne (chaînes, caractères, date et heure) seront effectués selon cet alphabet. |
| *hSansLiaison* | Gestion de l'intégrité : Les liaisons ne sont pas mises à jour sur le serveur (création, modification, suppression selon le cas).<br>Rappel : par défaut, lors de la création d'un fichier de données, les liaisons sont mises à jour sur le serveur.<br>![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Cette constante est disponible uniquement en mode HFSQL Client/Serveur. |

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Ce paramètre est ignoré. 




<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Caractéristiques du fichier de données créé
<a name="caracteristiques_fichier_donnees_cree_ELTPARAGRAPHE000185"></a>Les caractéristiques du fichier de données créé sont les suivantes :

- Nom du fichier de données :
	Nom physique défini lors de la description du fichier de données sous l'éditeur d'analyses. Ce nom peut être modifié avant la création du fichier de données grâce à la fonction [HChangeNom](../WDLang4/3044141.md).

- Répertoire du fichier de données :
	Répertoire défini lors de la description du fichier de données sous l'éditeur d'analyses. Ce répertoire peut être modifié avant la création du fichier de données par les fonctions [HChangeRep](../WDLang4/3044168.md) et [HSubstRep](../WDLang4/3044028.md).

- Contenu du fichier de données :
	Le fichier de données créé est vide ce qui ne signifie pas que sa taille est nulle (le fichier de données contient un entête décrivant sa structure).

- L'ordre des rubriques créées dans le fichier physique est l'ordre physique des rubriques créées dans l'analyse et non l'ordre logique.




**Si le fichier de données existait déjà** : Si le fichier de données existait déjà (même nom, même répertoire), ce fichier de données est recréé : le fichier de données ne contient plus aucun enregistrement. Les fichiers d'index et mémo (s'ils existent) sont aussi recréés. Dans ce cas, les contraintes d'intégrité ne sont pas testées.

**Attention** : La re-création du fichier de données n'est possible que si le fichier de données n'est pas utilisé par une autre application. Si un fichier de données en cours d'utilisation doit être vidé, utilisez la fonction [HSupprime](../WDLang4/3044018.md) lors d'un parcours. Il est également possible d'utiliser la fonction [HSupprimeTout](../WDLang4/1000017331.md) pour supprimer tous les enregistrements d'un fichier de données.
<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Les différents fichiers créés
<a name="les_differents_fichiers_crees_ELTPARAGRAPHE000226"></a>Lors de la création d'un fichier de données, les fichiers suivants peuvent être créés en plus du fichier de données :

- ***Un fichier d'index*** (d'extension ".NDX") si une ou plusieurs clés ont été définies dans la description du fichier de données.

- ***Un fichier mémo*** (d'extension ".MMO") si une ou plusieurs rubriques de type mémo ont été définies dans la description du fichier de données. 

- ***Un fichier journal*** (d'extension ".JNL). Ce fichier est créé uniquement si l'option correspondante a été sélectionnée lors de la description du fichier de données.
	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Ce fichier n'est pas créé.

- **Un fichier &lt;NomProjet&gt;.REP**. Ce fichier contient la liste des fichiers de données manipulés par l'application. Ce fichier est créé (ou complété) si la gestion du .REP est active (fonction [HGèreREP](../WDLang4/3044061.md)). Pour plus de détails sur le fichier .REP, consultez [Fichier .REP](../WDLang4/3044186.md).
	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Ce fichier n'est pas créé.



<a name="NOTE0_3"></a>


### Gestion du mot de passe
<a name="gestion_mot_passe_ELTPARAGRAPHE000254"></a>

- Le mot de passe peut être défini :

	- directement à la création du fichier de données avec la fonction **HCréation**.

	- avant la création du fichier de données grâce à la fonction [HPasse](../WDLang4/3044108.md).




- Si le fichier de données existait et était protégé par mot de passe, le fichier de données est recréé, même si le mot de passe change ou n'existe plus.




**Attention** : Le mot de passe est indépendant du cryptage des données. Le cryptage des données doit être configuré lors de la description du fichier de données dans l'éditeur d'analyses (onglet "Détail").
![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Le mot de passe n'est pas associé à un fichier de données mais à une base de données. Ce mot de passe doit être indiqué lors de la connexion (fonction [HConnecte](../WDLang4/3044263.md)).
<a name="NOTE0_4"></a>


### Gestion des erreurs fatales lors de la création d'un fichier de données
<a name="gestion_des_erreurs_fatales_lors_creation_fichier_donnees_ELTPARAGRAPHE000281"></a>En cas d'erreur fatale lors de la création d'un fichier de données, il peut être intéressant de continuer le programme tout en vérifiant si le fichier de données a tout de même été créé. Pour cela, il est conseillé de faire le traitement d'exception suivant :

```wl
QUAND EXCEPTION DANS
	HCréation(PERE)
FAIRE
	Erreur("Erreur HFSQL : " + HErreur())
SINON
	Trace("fichier créé")
FIN
```

<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Gestion des alphabets non latins 
<a name="gestion_des_alphabets_non_latins_ELTPARAGRAPHE000298"></a>Si la constante *hChangeAlphabet* est précisée, l'alphabet utilisé dans le fichier de données sera celui précisé par la fonction [ChangeAlphabet](../WDLang1/3054001.md). Les tris, recherches, ... sur des clés de type chaîne (Chaînes, caractères, date et heure) seront effectués selon cet alphabet.

L'alphabet utilisé pourra ensuite être modifié avec la fonction [HRéindexe](../WDLang4/3044133.md).

**Remarque** : La taille des rubriques de type chaîne spécifiée dans l'analyse est une taille en octets et non en caractères. Selon l'alphabet utilisé, il peut être nécessaire d'augmenter la taille de la rubrique (par exemple si les caractères utilisés sont codés sur 2 octets).

Pour plus de détails sur la gestion des alphabets non latins dans les fichiers de données, consultez [Gérer des alphabets spécifiques dans des fichiers de données](../WDLang1/3054017.md).
<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Réplication : Plage d'identifiants
<a name="replication_plage_identifiants_ELTPARAGRAPHE000324"></a>Les identifiants automatiques des fichiers des réplicas abonnés utilisent une plage d'identifiants différente de celle du fichier du réplica maître et des autres fichiers de réplicas abonnés.

Cette plage d'identifiants automatiques est inscrite dans l'entête de chaque fichier de données (extension ".FIC").
Cette plage est initialisée :

- lors de la création d'un fichier de données (fonctions **HCréation**, [HCréationSiInexistant](../WDLang4/3044254.md)).

- grâce à l'outil [WDReplic](../WDReplic/3520016.md).

- lors de l'utilisation de la fonction [HInitAbonné](../WDLang4/3044013.md).




Pour plus de détails, consultez les [conséquences de la mise en place de la réplication](../WDLang4/3044246.md).
<a name="NOTE0_7"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Priorité pour la définition de l'emplacement des fichiers du journal
<a name="priorite_pour_definition_emplacement_des_fichiers_journal_ELTPARAGRAPHE000360"></a>La définition de l'emplacement des fichiers journal se fait selon l'ordre de priorité suivant :

1. Emplacement spécifié lors de la création du fichier de données journalé (fonction **HCréation**). 

2. Emplacement spécifié par la fonction [HChangeRepJNL](../WDLang4/3044164.md).

3. Emplacement spécifié dans l'analyse.

4. Emplacement du fichier de données journalé.




Si une autre application utilise la fonction [HDéclareExterne](../WDLang4/3044204.md) sur un fichier de données journalé, les modifications effectuées par cette application sont enregistrées dans les fichiers journaux spécifiés dans l'entête du fichier de données HFSQL journalé.
![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) L'emplacement des fichiers du Journal est fixe et ne peut pas être modifié. Pour plus de détails, consultez [Fichiers du journal en mode Client/Serveur](../WDLang4/3044197.md).
<a name="NOTE0_8"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) 

### Création d'une table existante
<a name="creation_une_table_existante_ELTPARAGRAPHE000393"></a>Si la table existait, la fonction **HCréation** tente d'effacer puis de recréer la table.

Par exemple : Utilisation d'une base de données Oracle

- avec le provider OLE DB "MSDAORA" : la création d'une nouvelle table est impossible. Si la table existe déjà; les enregistrements sont effacés.

- avec le provider OLE DB "oraOLEDB.Oracle" : la création d'une nouvelle table est possible ainsi que la re-création d'une table existante. Il est cependant impossible de créer des index ou des rubriques mémo.




Lors d'une création de table, WINDEV et WEBDEV tentent de créer les rubriques dans le type OLE DB correspondant au type HFSQL. Si ce type n'est pas supporté, WINDEV et WEBDEV essayent successivement tous les types OLE DB "compatibles" jusqu'à trouver un type supporté par la base OLE DB.
<a name="NOTE0_9"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Contraintes d'intégrités référentielles
<a name="contraintes_integrites_referentielles_ELTPARAGRAPHE000414"></a>Lors de la création d'une table, les contraintes d'intégrités référentielles décrites dans l'analyse ne sont pas créées sur la base.
<a name="NOTE0_10"></a>
![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) 

### OLE DB Oracle : Création d'une table contenant un mémo binaire
<a name="ole_oracle_creation_une_table_contenant_memo_binaire_ELTPARAGRAPHE000425"></a>Attention : la création d'une table Oracle contenant des mémos binaires échoue sous Oracle 7.x (car les LOB ne sont pas gérés dans cette version d'Oracle).
<a name="NOTE0_11"></a>
![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) 

### OLE DB : Création d'une table contenant des identifiants automatiques
<a name="ole_creation_une_table_contenant_des_identifiants_automatiques_ELTPARAGRAPHE000436"></a>Les identifiants automatiques ne seront créés dans la table que si le provider OLE DB supporte les identifiants automatiques.
<a name="NOTE0_12"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Gestion des index
<a name="gestion_des_index_ELTPARAGRAPHE000447"></a>Si l'ajout d'un index échoue, aucun message d'erreur n'est renvoyé par la fonction **HCréation**. La table est simplement créée sans l'index posant problème. Dans ce cas, il est possible de trouver des doublons dans une rubrique considérée comme clé unique par WINDEV et WEBDEV si la base de données externe ne peut pas gérer de clé unique.
<a name="NOTE0_13"></a>


### Création du fichier de données à partir de sa description
<a name="creation_fichier_donnees_partir_description_ELTPARAGRAPHE000459"></a>Il est possible de créer directement le fichier de données à vide à partir de sa description dans l'éditeur d'analyses. Il suffit de sélectionner l'option "Créer le fichier des données" et de sélectionner le répertoire dans lequel le fichier de données doit être créé.
<a name="NOTE0_14"></a>
![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Rubriques DATE et HEURE avec le Connecteur Natif SQL Server
<a name="rubriques_date_heure_avec_connecteur_natif_sql_server_ELTPARAGRAPHE000470"></a>Lors de l'utilisation de la fonction **HCréation**, le Connecteur Natif SQLServer crée des rubriques DATE et TIME si la version du serveur et la version de la couche client correspondent au moins à SQL Server 2008.
<a name="NOTE0_15"></a>
![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Fonction HCréation et Connecteur Natif SQLite
<a name="fonction_docparampagetitleshort_connecteur_natif_sqlite_ELTPARAGRAPHE000484"></a>La fonction **HCréation** peut échouer (erreur "database table is locked") si les conditions suivantes sont réunies : 

- le fichier à créer existe déjà.

- un parcours est en cours sur un autre fichier de la même base de données.




Ceci est dû à une limitation de la base de données SQLite. 

<a name="XComposante"></a>

## Composante :
wd280hf.dll
