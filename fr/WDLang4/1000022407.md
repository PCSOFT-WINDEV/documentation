


## HSurveille (Fonction)

***En anglais : HTrack***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Déclenche la surveillance des actions d'écriture (ajout, modification ou suppression) effectuées sur un fichier d'un serveur HFSQL. En cas de modification, une procédure spécifique peut être déclenchée. 

Cette surveillance peut être arrêtée via la fonction [HSurveilleStop](../WDLang4/1000022430.md). 


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Lance la surveillance du fichier de données Commande
// La procédure TraiteCommande est appelée pour tout ajout d'enregistrement dans le fichier de données
HSurveille(Commande, TraiteCommande, hNumEnrTous, hsAjout)
```

<a name="XSYNTAXE"></a>

## Syntaxe
<a name="SYNTAXE1"></a>

`<Résultat> = HSurveille(<Fichier de données> , <Procédure WLangage> [, <Numéro d'enregistrement> [, <Action à surveiller> [, <Mode d'exécution>]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si la surveillance du fichier de données est activée, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour plus de détails sur l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).




**`<Fichier de données> : (Chaîne de caractères optionnelle)`**

Nom du fichier de données HFSQL à manipuler. Ce fichier de données est associé à une connexion et à un serveur. 
Si ce paramètre correspond à une chaîne vide (""), la fonction **HSurveille** manipule le dernier fichier de données utilisé par la dernière fonction de gestion HFSQL (fonction commençant par la lettre H).

**`<Procédure WLangage> : (Nom de procédure)`**

Nom de la procédure WLangage (également appelée "callback") appelée lors d'un changement sur le fichier de données spécifié. 
Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction HSurveille](../WDLang4/1000024804.md).

**`<Numéro d'enregistrement> : (Entier optionnel)`**



- Numéro de l'enregistrement à surveiller. 

- Constante *hNumEnrTous* pour surveiller tous les enregistrements du fichier de données (c'est-à-dire tout le fichier de données). 




**`<Action à surveiller> : (Constante ou combinaison de constantes optionnelle)`**

Actions à surveiller pour lesquelles la procédure doit être lancée :  


|   |   |
| --- | --- |
| *hsAjout* | Surveille les opérations d'ajout d'enregistrements. |
| *hsModification* | Surveille les opérations de modification d'enregistrements. |
| *hsRaye* | Surveille les opérations de rayage d'enregistrements. |
| *hsSuppression* | Surveille les opérations de suppression d'enregistrements. |



**`<Mode d'exécution> : (Constante optionnelle)`**

Mode d'exécution de la procédure WLangage :  



|   |   |
| --- | --- |
| *hThreadSecondaire* | Exécution de la procédure WLangage dans un thread secondaire. |


Par défaut, la procédure WLangage est exécutée dans le thread principal.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Procédure WLangage exécutée dans le thread principal
<a name="procedure_wlangage_executee_dans_thread_principal_ELTPARAGRAPHE000143"></a>Par défaut, la procédure WLangage est appelée dans le thread principal de l'application, avec le contexte HFSQL correspondant à la procédure :

- Si la procédure est une procédure locale d'une fenêtre utilisant un contexte indépendant, le contexte utilisé sera celui de la fenêtre. 

- Si la procédure appartient à un composant utilisant un contexte indépendant, le contexte utilisé sera celui du composant.





|   |
| --- |
| **Attention** :<br>La procédure associée à la fonction **HSurveille** peut être appelée à n'importe quel moment dans l'application.<br>Si la procédure effectue des parcours HFSQL ou des déplacements dans des fichiers de données, cela impactera l'application (comme les timers).<br>Il peut donc être nécessaire d'utiliser : <br><br>- les fonctions [HSauvePosition](../WDLang4/3044136.md) et [HRetourPosition](../WDLang4/3044137.md) pour sauvegarder les contextes des fichiers manipulés.<br><br>- une variable de type [Alias](../WDLang4/1000021446.md) pour effectuer les manipulations sur des fichiers alias. <br><br><br>Il ne faut pas utiliser la fonction [Multitâche](../WDLang1/3015004.md) dans le code de la procédure. |


Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction HSurveille](../WDLang4/1000024804.md).


### Procédure WLangage exécutée dans un thread secondaire
<a name="procedure_wlangage_executee_dans_thread_secondaire_ELTPARAGRAPHE000194"></a>Si la procédure WLangage est appelée dans un thread secondaire : 

- une copie "légère" du contexte HFSQL est effectuée au moment du premier appel à la fonction **HSurveille**. Seuls les répertoires où se trouvent les fichiers de données en HFSQL Classic et/ou les connexions en HFSQL Client/Serveur sont mémorisés.

- il est interdit de manipuler l'UI (fenêtres, champs, ...) dans le thread secondaire. Lorsqu'un thread secondaire doit interagir avec l'utilisateur ou mettre à jour l'UI, il doit utiliser un traitement lancé depuis le thread principal. Ce traitement peut correspondre à :

	- une procédure globale du projet ou une procédure locale (d'une fenêtre, ...) appelée par la fonction [ExécuteThreadPrincipal](../WDLang1/1000019862.md),

	- l'événement "Demande de mise à jour de l'affichage" d'une fenêtre exécuté grâce à la fonction [DemandeMiseAJourUI](../WDLang1/1000023899.md).







Pour plus de détails sur cette procédure, consultez [Paramètres de la procédure utilisée par la fonction HSurveille](../WDLang4/1000024804.md).
<a name="NOTE0_2"></a>


### Cas particuliers
<a name="cas_particuliers_ELTPARAGRAPHE000225"></a>La surveillance est définie pour un fichier de données et une connexion : 

- Si le nom physique ou la connexion associés au nom logique du fichier de données change, le fichier surveillé par le serveur reste celui indiqué au moment de l'appel de la fonction **HSurveille**. 

- Si la connexion est fermée, la surveillance est automatiquement arrêtée.

- Si la connexion est perdue puis restaurée par la [reconnexion automatique](../WDLang4/3044188.md), la surveillance est maintenue.




Pour arrêter la surveillance du fichier de données, utilisez la fonction [HSurveilleStop](../WDLang4/1000022430.md). 
Les fonctions **HSurveille** et [HSurveilleStop](../WDLang4/1000022430.md) peuvent être utilisées dans un service Windows.

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280hf.dll
