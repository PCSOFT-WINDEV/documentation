
## Filtrer un fichier de données, une vue ou une requête
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000324"></a>
Un filtre permet de définir en programmation une sélection d'enregistrements correspondant à un ou plusieurs critères. Cette sélection d'enregistrements peut être réalisée sur un fichier de données HFSQL, une vue HFSQL ou une requête.

Les enregistrements de cette sélection pourront être lus et parcourus grâce aux fonctions de parcours ([HLitPremier](../WDLang4/3044051.md), [HLitSuivant](../WDLang4/3044037.md), ...). Il est ainsi possible, lors d'un parcours, de traiter directement tous les enregistrements sélectionnés.

**Par exemple**, pour envoyer un email spécifique à tous les clients des départements 34 à 36, il suffit :

- Créer un filtre sur le fichier de données Client pour sélectionner les clients des départements 34 à 36,

- Parcourir le fichier de données filtré et lancer pour chaque client une procédure permettant d'envoyer l'email.



<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=filtre_1.gif)


**Filtres ou requêtes ?**

- **Les filtres sont conseillés** lorsque la condition de sélection porte uniquement sur un seul fichier de données, une seule vue, ou une seule requête. Les filtres permettent de créer des conditions de sélection complexes sur les enregistrements, ou encore de sélectionner facilement les enregistrements présents dans un intervalle de valeurs.

- **Les requêtes sont conseillées** dès lors que la sélection d'enregistrements doit être réalisée sur plusieurs fichiers de données.








<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer un filtre
<a name="creer_filtre_ELTTEXTE000354"></a>
Un filtre est créé grâce à la fonction [HFiltre](../WDLang4/3044100.md). Ce filtre peut permettre de sélectionner :

- soit les enregistrements présents entre deux bornes : les bornes doivent concerner une rubrique clé.

- soit les enregistrements correspondant à une condition de sélection spécifique sur une rubrique.




Dans les deux cas, la fonction [HFiltre](../WDLang4/3044100.md) renvoie la rubrique optimale à utiliser pour parcourir les enregistrements filtrés. Cette rubrique peut être une clé ou non du fichier de données. Si le fichier de données n'est pas parcouru selon cette rubrique, le filtre ne sera pas pris en compte.


<a name="NOTE2_2"></a>


### Caractéristiques
<a name="caracteristiques_ELTPARAGRAPHE000065"></a>Un seul filtre par fichier de données (ou vue ou requête) peut être actif à un moment donné.



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Manipuler les filtres en WLangage
<a name="manipuler_les_filtres_wlangage_ELTTEXTE000384"></a>


### Fonctions WLangage
<a name="fonctions_wlangage_ELTPARAGRAPHE000075"></a>Les fonctions du WLangage permettant de gérer les filtres sont les suivantes :



|   |   |
| --- | --- |
| [HActiveFiltre](../WDLang4/3044158.md) | Active le filtre précédemment créé pour le fichier de données (la vue ou la requête) spécifié. |
| [HDésactiveFiltre](../WDLang4/3044085.md) | Désactive temporairement un filtre sur un fichier de données (une vue ou une requête). |
| [HFiltre](../WDLang4/3044100.md) | Définit et active un filtre sur un fichier de données, une vue ou une requête. |
| [HFiltreCommencePar](../WDLang4/3044098.md) | Définit et active un filtre de type "Commence par" sur un fichier, une vue ou une requête. |
| [HFiltreComprisEntre](../WDLang4/3044097.md) | Définit et active un filtre de type "Compris entre" sur un fichier, une vue ou une requête. |
| [HFiltreContient](../WDLang4/1000020267.md) | Définit et active un filtre de type "Contient" sur un fichier de données, une vue ou une requête. |
| [HFiltreIdentique](../WDLang4/3044105.md) | Définit et active un filtre permettant de rechercher la valeur exacte d'une rubrique de type chaîne. |






<a name="NOTE3_2"></a>


### Propriétés WLangage
<a name="proprietes_wlangage_ELTPARAGRAPHE000084"></a>Les propriétés du WLangage permettant de gérer les filtres sont les suivantes :


|   |   |
| --- | --- |
| [BorneMax](../Proprietes/2510009.md) | Récupère la borne maximale du filtre en cours (défini par la fonction [HFiltre](../WDLang4/3044100.md)) sur un fichier de données, une vue HFSQL ou une requête. |
| [BorneMin](../Proprietes/2510008.md) | Récupère la borne minimale du filtre en cours (défini par la fonction [HFiltre](../WDLang4/3044100.md)) sur un fichier de données, une vue HFSQL ou une requête. |
| [ConditionFiltre](../Proprietes/2512096.md) | Renvoie la condition de sélection mise en place par la fonction [HFiltre](../WDLang4/3044100.md) sur un fichier de données, une vue HFSQL ou une requête. |
| [FiltreAvecBornes](../Proprietes/2512097.md) | Permet de savoir si des bornes ont été précisées sur le filtre mis en place par la fonction [HFiltre](../WDLang4/3044100.md) sur un fichier de données, une vue HFSQL ou une requête. |
| [RubriqueFiltrée](../Proprietes/2512086.md) | Permet de connaître la rubrique sur laquelle un filtre a été mis en place par la fonction [HFiltre](../WDLang4/3044100.md) sur un fichier de données, une vue HFSQL ou une requête. |





<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Parcours et recherche dans une sélection d'enregistrements filtrés
<a name="parcours_recherche_dans_une_selection_enregistrements_filtres_ELTTEXTE000465"></a>


- Pour parcourir un ensemble d'enregistrements filtrés, il suffit d'utiliser les fonctions HFSQL de parcours.
	


|   |   |
| --- | --- |
| [HLitDernier](../WDLang4/3044140.md) | Positionne sur le dernier enregistrement correspondant au filtre (s'il existe). La fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u><u>Vrai</u></u></u></u> si plus aucun enregistrement ne correspond au filtre. |
| [HLitPrécédent](../WDLang4/3044048.md) | Positionne sur l'enregistrement précédent correspondant au filtre (s'il existe). La fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u><u>Vrai</u></u></u></u> si plus aucun enregistrement ne correspond au filtre. |
| [HLitPremier](../WDLang4/3044051.md) | Positionne sur le premier enregistrement correspondant au filtre (s'il existe). La fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u><u>Vrai</u></u></u></u> si plus aucun enregistrement ne correspond au filtre. |
| [HLitSuivant](../WDLang4/3044037.md) | Positionne sur l'enregistrement suivant correspondant au filtre (s'il existe). La fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u><u>Vrai</u></u></u></u> si plus aucun enregistrement ne correspond au filtre. |



- Pour parcourir un ensemble d'enregistrements filtrés, il suffit d'utiliser les fonctions HFSQL de recherche.
	


|   |   |
| --- | --- |
| [HLitRecherche](../WDLang4/3044050.md)/[HLitRecherchePremier](../WDLang4/3044036.md) | <br><br>	- **Si la recherche porte sur la clé de parcours**, recherche et positionne sur le premier enregistrement du filtre correspondant à la condition spécifiée (s'il existe). La fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u><u>Vrai</u></u></u></u> si plus aucun enregistrement ne correspond au filtre et à la condition de recherche.<br><br>	- **Si la recherche porte sur une autre rubrique**, recherche et positionne sur le premier enregistrement du fichier (non filtré) correspondant à la condition spécifiée (s'il existe). La fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u><u>Vrai</u></u></u></u> si plus aucun enregistrement ne correspond au filtre et à la condition de recherche.<br><br><br> |
| [HLitRechercheDernier](../WDLang4/3044034.md) | <br><br>	- **Si la recherche porte sur la clé de parcours**, recherche et positionne sur le dernier enregistrement du filtre correspondant à la condition spécifiée (s'il existe). La fonction [HTrouve](../WDLang4/3044104.md) renvoie <u><u><u><u>Vrai</u></u></u></u> si plus aucun enregistrement ne correspond au filtre et à la condition de recherche.<br><br>	- **Si la recherche porte sur une autre rubrique**, recherche et positionne sur le dernier enregistrement du fichier de données (non filtré) correspondant à la condition spécifiée (s'il existe). La fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u><u>Vrai</u></u></u></u> si plus aucun enregistrement ne correspond au filtre et à la condition de recherche.<br><br><br> |






<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Optimisation des filtres
<a name="optimisation_des_filtres_ELTTEXTE000489"></a>
Pour optimiser le parcours d'enregistrements filtrés :

- réalisez régulièrement des statistiques sur vos index,

- définissez des clés composées dans vos fichiers de données.





<a name="NOTE5_2"></a>


### Filtres et statistiques
<a name="filtres_statistiques_ELTPARAGRAPHE000247"></a>Les filtres sont basés sur les statistiques d'index HFSQL. Pour optimiser les parcours d'enregistrements filtrés, il est recommandé d'utiliser des statistiques récentes. Ces statistiques sont mises à jour grâce à la fonction [HStatCalcule](../WDLang4/3044134.md).

Il est donc conseillé de calculer régulièrement les statistiques des fichiers filtrés (surtout pour les fichiers de données souvent modifiés, par exemple ligne de commande). Ces statistiques sont automatiquement recalculées lors de la réorganisation (ou réindexation) des fichiers de données.

**Attention** : Selon la taille du fichier de données, le calcul des statistiques peut être long. De plus, ce calcul bloque le fichier de données : le fichier de données est inutilisable pendant cette période (HFSQL Classic uniquement). Il est conseillé de réaliser ce calcul lorsque la base de données est inutilisée (traitement de nuit par exemple)


<a name="NOTE5_3"></a>


### Filtres et clés composées
<a name="filtres_cles_composees_ELTPARAGRAPHE000262"></a>Si la condition du filtre porte sur plusieurs rubriques correspondant à une clé composée de votre fichier de données, la clé de parcours automatiquement choisie pour le filtre sera cette clé composée.

Par exemple :

- Un filtre est défini sur le fichier de données CLIENT. Ce filtre porte sur les rubriques NOM et PRENOM.

- Une clé composée NOM+PRENOM existe dans le fichier de données CLIENT.

- La clé composée sera automatiquement choisie comme clé de parcours du fichier de données filtré.




Pour plus de détails sur les clés composées et les filtres, consultez [Clés composées](../WDLang4/3044178.md).






