
## Vue matérialisée
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000225"></a>


### Définition
<a name="definition_ELTPARAGRAPHE000009"></a>Une vue matérialisée est une source de données physique définie par une requête SQL. Cette vue matérialisée est créée physiquement sur le serveur HFSQL. Elle peut être manipulée comme un fichier de données HFSQL par les applications qui accèdent à la base de données. 

L'application peut utiliser ou manipuler une vue matérialisée en utilisant les fonctions classiques de gestion des fichiers de données. Les données manipulées ne sont pas mises à jour automatiquement : il est nécessaire de demander la mise à jour des données. 
<a name="NOTE1_2"></a>


### Quand utiliser une vue matérialisée ?
<a name="quand_utiliser_une_vue_materialisee_ELTPARAGRAPHE000018"></a>L'utilisation d'une vue matérialisée présente plusieurs avantages : 

- **Indépendance vis-à-vis de la structure physique des données** : 
	La vue matérialisée correspond à une couche d'abstraction entre l'organisation des données et l'utilisation des données. Si la structure physique des données évolue, le code de l'application ne change pas. Seule la requête de base de la vue doit être adaptée à la nouvelle structure.

- **Accélération des traitements**
	L'utilisation d'une vue matérialisée est intéressante si l'extraction des données de la vue est un processus long et si les données n'ont pas une obligation de temps réel. Par exemple :

	- statistiques,

	- reporting,

	- data binding,

	- sélections pour mailings,

	- ciblages,

	- création de fichiers de données "à plat",

	- ...









<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer une vue matérialisée
<a name="creer_une_vue_materialisee_ELTTEXTE000255"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000043"></a>Il existe plusieurs méthodes pour créer une vue matérialisée : 

- Création de la vue matérialisée depuis l'éditeur d'analyses. Dans ce cas, pour utiliser la vue matérialisée, une mise à jour des données sur le serveur est nécessaire. Cette mise à jour peut être effectuée : 

	- via la modification automatique des données (effectuée lors de l'installation de l'application par exemple). 

	- via la fonction [HMiseAJourVue](../WDLang4/1000021520.md). 




- Création de la vue matérialisée en utilisant directement le code SQL ["CREATE MATERIALIZED VIEW"](../Editeurs/2034001.md) dans l'application. 



<a name="NOTE2_2"></a>


### Création depuis l'éditeur d'analyses
<a name="creation_depuis_editeur_analyses_ELTPARAGRAPHE000062"></a>Pour créer une vue matérialisée depuis l'éditeur d'analyses : 

1. Lancez l'assistant de création de vues : 

	- Dans le ruban, sous le volet "Analyse", dans le groupe "Création", déroulez "Nouveau" et sélectionnez "Vue". 

	- Sous le volet "Analyse", sélectionnez le dossier "Vues" puis sélectionnez l'option "Nouvelle vue" du menu contextuel. 




2. Dans l'assistant, sélectionnez "Créer une vue matérialisée" puis passez à l'écran suivant (flèche en bas de l'assistant). 

3. Indiquez le nom de la vue à créer puis sélectionnez le mode d'édition de la requête de base de la vue : 

	- Assistant. Dans ce cas, la requête de la vue est créée via l'assistant de création de requêtes. La requête est affichée graphiquement. Il est possible à tout moment de modifier la requête via l'assistant.  

	- Code SQL. Dans ce cas, vous saisissez directement le code SQL de sélection des éléments sélectionnés par la vue. 




4. La vue matérialisée est créée. Par défaut, elle n'est pas associée à une connexion. Pour associer la vue à une connexion définie sous l'éditeur d'analyses : 

	- Sous le volet "Analyse", sélectionnez la vue matérialisée qui vient d'être créée. 

	- Dans le menu contextuel (clic droit), sélectionnez l'option "Description de la vue". 

	- Dans la fenêtre qui s'affiche, vous pouvez modifier le nom de la vue matérialisée et spécifier la connexion associée à la vue matérialisée. 

	- Validez. 




5. Générez l'analyse pour utiliser la vue matérialisée dans le code de l'application : sous le volet "Analyse", dans le groupe "Analyse", déroulez "Génération" et sélectionnez "Génération". 




Remarques : 

- Une clé ou une clé composée sera créée selon le "ORDER BY" défini. 

- Les vues matérialisées ne peuvent pas contenir de paramètres. 



<a name="NOTE2_3"></a>


### Création en utilisant le code SQL
<a name="creation_utilisant_code_sql_ELTPARAGRAPHE000091"></a>Pour créer une vue matérialisée en utilisant du code SQL, il suffit d'utiliser l'instruction CREATE MATERIALIZED VIEW dans le code SQL de la requête. Par exemple : 

```wl
Req_Vue est une Source de Données

// Création de la vue matérialisée
MonCodeVueMatérialisée est une chaîne
MonCodeVueMatérialisée = [
	Create materialized view Vue_Client
	AS SELECT * FROM Client
]
HExécuteRequêteSQL(Req_Vue, ConnexionHFSQL, MonCodeVueMatérialisée)
```


**Attention** : Le code SQL de création de la vue matérialisée doit faire référence uniquement aux rubriques et aux fichiers de données définis dans l'analyse. Par exemple, il n'est pas possible d'utiliser dans ce code des références à des requêtes stockées.  

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Utiliser une vue matérialisée
<a name="utiliser_une_vue_materialisee_ELTTEXTE000291"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000103"></a>Pour utiliser une vue matérialisée, il suffit d'utiliser les fonctions HFSQL d'accès aux fichiers de données. Le paramètre &lt;Nom du fichier&gt; correspondra au nom de la vue matérialisée. 

Comme un fichier de données classique, une vue matérialisée peut être : 

- parcourue par les fonctions HFSQL (POUR TOUT, HLit\*, ...),

- associée à un champ (champ Table, Liste, ...). 




Remarque : Si la vue matérialisée n'a pas été créée sous l'éditeur d'analyses, il est nécessaire d'utiliser la fonction [HDéclareExterne](../WDLang4/3044204.md) avant de la manipuler. 




### Droits sur une vue matérialisée
<a name="droits_sur_une_vue_materialisee_ELTPARAGRAPHE000119"></a>Une vue matérialisée correspond à un fichier de données. La gestion des droits se fait comme pour les fichiers de données. Ces droits peuvent être paramétrés : 

- via le Centre de Contrôle HFSQL. 

- via la fonction [HModifieDroitVue](../WDLang4/1000021368.md). 




Remarque : La fonction [HInfoDroitVue](../WDLang4/1000021475.md) permet de connaître les droits actuels sur la vue matérialisée. 


### Modification du contenu d'une vue matérialisée
<a name="modification_contenu_une_vue_materialisee_ELTPARAGRAPHE000140"></a>Le contenu d'une vue matérialisée est mis à jour : 

- via l'instruction SQL ["REFRESH MATERIALIZED VIEW"](../Editeurs/2034001.md). 

- via la fonction [HRafraîchitVue](../WDLang4/1000021376.md). 

- via une tâche planifiée de rafraîchissement. Cette tâche est définie grâce à une variable du type [hPlanificationVueMatérialisée](../WDLang4/1000021444.md). Cette tâche peut ensuite être manipulée grâce aux fonctions suivantes : 


|   |   |
| --- | --- |
| [HAjoutePlanification](../WDLang4/1000021447.md) | Crée une tâche planifiée sur un serveur HFSQL : <br><br>	- procédure stockée, <br><br>	- sauvegarde, <br><br>	- optimisation, <br><br>	- rafraîchissement d'une vue matérialisée.<br><br><br> |
| [HExécutePlanification](../WDLang4/1000021453.md) | Exécute immédiatement une tâche planifiée sans tenir compte de sa planification : <br><br>	- procédure stockée, <br><br>	- sauvegarde, <br><br>	- optimisation, <br><br>	- rafraîchissement d'une vue matérialisée.<br><br><br> |
| [HModifiePlanification](../WDLang4/1000021450.md) | Modifie une tâche planifiée sur un serveur HFSQL : <br><br>	- procédure stockée, <br><br>	- sauvegarde, <br><br>	- optimisation, <br><br>	- rafraîchissement d'une vue matérialisée.<br><br><br> |
| [HSupprimePlanification](../WDLang4/1000021448.md) | Supprime une tâche planifiée sur un serveur HFSQL : <br><br>	- procédure stockée, <br><br>	- sauvegarde, <br><br>	- optimisation, <br><br>	- rafraîchissement d'une vue matérialisée.<br><br><br> |





### Index sur une vue matérialisée
<a name="index_sur_une_vue_materialisee_ELTPARAGRAPHE000161"></a>Il est possible de créer un index sur une vue matérialisée à l'aide de l'instruction [CREATE INDEX](../Editeurs/2034001.md). Si la vue matérialisée est rafraîchie, les index sont mis à jour automatiquement : il n'est pas nécessaire de recréer les index.





<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Fonctions WLangage permettant de manipuler une vue matérialisée
<a name="fonctions_wlangage_permettant_manipuler_une_vue_materialisee_ELTTEXTE000383"></a>
Les fonctions WLangage permettant de manipuler les vues matérialisées sont les suivantes : 



|   |   |
| --- | --- |
| [HInfoVue](../WDLang4/1000021619.md) | Renvoie des informations sur une vue matérialisée. |
| [HMiseAJourVue](../WDLang4/1000021520.md) | Crée ou met à jour la description d'une vue SQL ou d'une vue matérialisée depuis l'analyse vers un serveur HFSQL. |
| [HRafraîchitVue](../WDLang4/1000021376.md) | Demande le recalcul du contenu d'une vue matérialisée. |












