


## HInfoSauvegarde (Fonction)

***En anglais : HInfoBackup***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Renvoie des informations sur une ou plusieurs sauvegardes effectuées sur un serveur HFSQL Client/Serveur.

Les sauvegardes ont été réalisées grâce à la fonction [HSauvegarde](../WDLang4/1000017081.md) (ou via le Centre de Contrôle HFSQL) et peuvent être restaurées par la fonction [HRestaureSauvegarde](../WDLang4/1000017230.md) (ou via le Centre de Contrôle HFSQL).



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Affiche les informations sur les sauvegardes dans un champ Table
sEtat est une chaîne = HInfoSauvegarde(gcnxConnexion)
sLig est une chaîne
POUR TOUTE CHAINE sLig DE sEtat SEPAREE PAR EOT
	SI sLig ~="" ALORS CONTINUER
	TableAjoute(TABLE_Sauvegardes)
	nInd est un entier = TableOccurrence(TABLE_Sauvegardes)
	TABLE_Sauvegardes.COL_IDSauvegarde[nInd] = ExtraitChaîne(sLig, 1)
	TABLE_Sauvegardes.COL_DateHeure[nInd] = ExtraitChaîne(sLig, 2)
	TABLE_Sauvegardes.COL_Filtre[nInd] = ExtraitChaîne(sLig, 3)
	TABLE_Sauvegardes.COL_Nom[nInd] = ExtraitChaîne(sLig, 4)
	TABLE_Sauvegardes.COL_Description[nInd] = ExtraitChaîne(sLig, 5)
	TABLE_Sauvegardes.COL_Etat[nInd] = ...
			SELON(Val(ExtraitChaîne(sLig, 6)) + 1, ...
				"En cours", "Effectuée", "Annulée", "Erreur")
	TABLE_Sauvegardes.COL_PourMille[nInd] = ExtraitChaîne(sLig, 7)
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Informations sur les sauvegardes effectuées sur le serveur

`<Résultat> = HInfoSauvegarde(<Connexion>)`
---

**`<Résultat> : (Chaîne de caractères)`**

Description des sauvegardes réalisées sur le serveur spécifié. Cette description est de la forme : 

```txt
<Identifiant de la sauvegarde 1> + TAB + <Date de la sauvegarde 1> + TAB + 
<Fichiers sauvegardés> + TAB + <Chemin de la destination de la sauvegarde 1> + TAB + 
<Description> + TAB + <Etat> + TAB + <Pour mille> + TAB + <Message d'erreur> + TAB + 
<Type> + TAB + <Identifiant de la sauvegarde complète> + TAB + <Avec index> + TAB + 
<Compression> + EOT
```
où :

- &lt;Fichiers sauvegardés&gt; est la liste des données sauvegardées séparées par des points virgule (";"). 
	&lt;Etat&gt; correspond à un entier (ou à une constante de type Entier) permettant de connaître l'état de la sauvegarde :
	


|   |   |   |
| --- | --- | --- |
| *hSvgAnnulée* | 2 | Sauvegarde annulée |
| *hSvgEnCours* | 0 | Sauvegarde en cours |
| *hSvgErreur* | 3 | Erreur lors de la sauvegarde |
| *hSvgTerminée* | 1 | Sauvegarde terminée |



- &lt;Pour mille&gt; correspond au taux de réalisation de la sauvegarde si la sauvegarde est en cours (exprimé en pour mille).

- &lt;Message d'erreur&gt; est le message d'erreur si la sauvegarde a échoué.

- &lt;Type&gt; correspond à un entier (ou à une constante de type Entier) permettant de connaître le type de la sauvegarde : 
	


|   |   |   |
| --- | --- | --- |
| *hSvgComplète* | 0 | Sauvegarde complète |
| *hSvgDifférentielle* | 1 | Sauvegarde différentielle |



- &lt;Identifiant de la sauvegarde complète&gt; correspond à l'identifiant de la sauvegarde complète correspondante dans le cas d'une sauvegarde différentielle.

- &lt;Avec index&gt; : Permet de savoir si la sauvegarde contient les index : 

	- 0 si la sauvegarde des index n'a pas été effectuée, 

	- 1 si la sauvegarde des index a été effectuée. 




- &lt;Compression&gt; : Constante correspondant à la compression de la sauvegarde :

	- *zipFormatAucun* : la sauvegarde n'est pas compressée.

	- *zipFormatZip* : la sauvegarde est compressée. 





Remarque : le séparateur utilisé entre les différentes descriptions est "EOT" (et non "RC") car les différents paramètres de la description peuvent contenir des Retours Chariot (RC). 

**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion vers le serveur dont on veut lister les sauvegardes. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).





<a name="SYNTAXE2"></a>

### Informations sur une sauvegarde spécifique

`<Résultat> = HInfoSauvegarde(<Connexion> , <Identifiant de la sauvegarde>)`
---

**`<Résultat> : (Chaîne de caractères)`**

Description de la sauvegarde spécifiée sur le serveur spécifié. Cette description est de la forme :

```txt
<Identifiant de la sauvegarde 1> + TAB + <Date de la sauvegarde 1> + TAB + 
<Fichiers sauvegardés> + TAB + <Chemin de la destination de la sauvegarde 1> + TAB + 
<Description> + TAB + <Etat> + TAB + <Pour mille> + TAB + <Message d'erreur> + TAB + 
<Type> + TAB + <Identifiant de la sauvegarde complète> + TAB + <Avec index> + TAB + 
<Compression> + EOT
```

où :

- &lt;Fichiers sauvegardés&gt; est la liste des données sauvegardées séparées par des points virgule (";"). 
	&lt;Etat&gt; correspond à un entier (ou à une constante de type Entier) permettant de connaître l'état de la sauvegarde :
	


|   |   |   |
| --- | --- | --- |
| *hSvgAnnulée* | 2 | Sauvegarde annulée |
| *hSvgEnCours* | 0 | Sauvegarde en cours |
| *hSvgErreur* | 3 | Erreur lors de la sauvegarde |
| *hSvgTerminée* | 1 | Sauvegarde terminée |



- &lt;Pour mille&gt; correspond au taux de réalisation de la sauvegarde si la sauvegarde est en cours (exprimé en pour mille).

- &lt;Message d'erreur&gt; est le message d'erreur si la sauvegarde a échoué.
	&lt;Type&gt; correspond à un entier (ou à une constante de type Entier) permettant de connaître le type de la sauvegarde :
	


|   |   |   |
| --- | --- | --- |
| *hSvgComplète* | 0 | Sauvegarde complète |
| *hSvgDifférentielle* | 1 | Sauvegarde différentielle |



- &lt;Identifiant de la sauvegarde complète&gt; correspond à l'identifiant de la sauvegarde complète correspondante dans le cas d'une sauvegarde différentielle.

- &lt;Avec index&gt; : Permet de savoir si la sauvegarde contient les index : 

	- 0 si la sauvegarde des index n'a pas été effectuée, 

	- 1 si la sauvegarde des index a été effectuée. 




- &lt;Compression&gt; : Constante correspondant à la compression de la sauvegarde : 

	- *zipFormatAucun* : la sauvegarde n'est pas compressée.

	- *zipFormatZip* : la sauvegarde est compressée. 





Remarque : le séparateur utilisé entre les différentes descriptions est "EOT" (et non "RC") car les différents paramètres de la description peuvent contenir des Retours Chariot (RC). 

**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion vers le serveur qui a réalisé la sauvegarde. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Identifiant de la sauvegarde> : (Entier)`**

Identifiant de la sauvegarde dont on veut obtenir les caractéristiques. Cet identifiant est fourni par la fonction [HSauvegarde](../WDLang4/1000017081.md).  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Divers
<a name="divers_ELTPARAGRAPHE000277"></a>

- La fonction **HInfoSauvegarde** permet de lister les tâches effectuées ou les tâches en cours. Les tâches planifiées et non effectuées ne sont pas listées.

- Les sauvegardes réalisées avec le Centre de Contrôle HFSQL et celles réalisées par programmation sont listées.

- Les dates et heures sont exprimées en temps universel (UTC).



<a name="NOTE0_2"></a>


### Droits nécessaires
<a name="droits_necessaires_ELTPARAGRAPHE000293"></a>Pour obtenir des informations sur une sauvegarde, l'utilisateur ou le groupe doit posséder : 

- pour chaque base concernée par la sauvegarde, le droit de faire des sauvegardes (constante *hDroitSauvegarde*) ou le droit de se connecter (constante *hDroitConnexion* ou *hDroitConnexionCryptée*). 

- pour une sauvegarde du serveur complet, le droit de faire des sauvegardes (constante *hDroitSauvegarde*) au niveau du serveur. 




Pour savoir si un utilisateur ou un groupe possède ces droits, utilisez la fonction [HInfoDroitServeur](../WDLang4/3044322.md) ou [HInfoDroitDaseDeDonnées](../WDLang4/3044320.md).

Pour modifier les droits d'un utilisateur ou d'un groupe d'utilisateurs, utilisez la fonction [HModifieDroitServeur](../WDLang4/3044328.md) ou [HModifieDroitBaseDeDonnées](../WDLang4/3044326.md).


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDDuplication.gif) ***Exemples didactiques (WINDEV)*** : **WD Duplication** <br>Cet exemple didactique montre comment il est possible de dupliquer une base de données sur un serveur.<br>La duplication s'effectue par programmation et permet de donner un nouveau nom à la base.<br>L'exemple s'appuie sur les fonctions de sauvegarde et de restauration de sauvegarde HFSQL.

<a name="XComposante"></a>

## Composante :
wd280hf.dll
