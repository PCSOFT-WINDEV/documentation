
## Notifications d'un serveur HFSQL
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000203"></a>
Un serveur HFSQL peut réaliser plusieurs opérations qui nécessitent l'envoi d'une notification : 

- Un serveur peut rencontrer différents problèmes sans qu'aucun utilisateur (ou développeur) ne s'en aperçoive. 
	Par exemple : 

	- une tâche planifiée peut être en échec. 

	- une sauvegarde automatique peut échouer. 

	- un noeud peut devenir inactif dans un cluster HFSQL, ...




- Un serveur peut également réaliser des opérations automatiquement (mise à jour automatique, recherche de clés pour optimiser les requêtes, ...). La réalisation et le compte-rendu de ces opérations nécessitent une notification. 




Le Centre de Contrôle HFSQL permet de : 

- consulter l'historique des incidents/notifications survenus sur le serveur. Pour plus de détails, consultez [Historique des incidents/notifications](#NOTE2_1). 

- être averti en cas d'incident (par email ou via la messagerie des Centres de Contrôle). Pour plus de détails, consultez [Recevoir les notifications (via email ou WDBal)](#NOTE3_1). 


Remarque : Ces manipulations sont également disponibles par programmation. 



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Historique des incidents/notifications
<a name="historique_des_incidentsnotifications_ELTTEXTE000233"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000043"></a>Pour chaque problème rencontré sur le serveur HFSQL, une notification est créée. Les caractéristiques de cette notification sont les suivantes : 

- Date et heure de l'incident. 

- Message détaillant l'incident. 

- Catégorie de l'incident : Information, Avertissement, Critique, Erreur. 

	- Information : Informations sur les événements survenus sur le serveur. 
			Exemple : 

		- Mise à jour automatique du serveur HFSQL avec redémarrage. 

		- Suggestion d'ajout de clés et de clés composées pour optimiser la vitesse des requêtes. 




- Avertissement : Evénements qui n'amènent pas de dysfonctionnement mais sur lesquels il faut réfléchir.
			Exemple : Résolution d'un conflit de modification pour la réplication. S'il y en a beaucoup il faut sûrement revoir l'architecture de l'application (si cela reste rare, il n'y a pas lieu de s'inquiéter).

- Critique : Dysfonctionnements dont on ne peut pas renvoyer l'erreur à l'utilisateur.
			Exemples : Erreur WLangage dans une procédure stockée utilisée par une tâche planifiée, échec de la connexion vers un serveur répliqué, ...

- Erreur : Problème de gestion de cache Windows. 




L'historique des notifications est consultable : 

- depuis le Centre de Contrôle HFSQL. 

- par programmation. 



<a name="NOTE2_2"></a>


### Historique des notifications affiché dans le Centre de Contrôle HFSQL
<a name="historique_des_notifications_affiche_dans_centre_controle_hfsql_ELTPARAGRAPHE000075"></a>Le Centre de Contrôle HFSQL permet de consulter à tout moment l'historique des incidents survenus sur le serveur.

Pour consulter cet historique : 

1. Lancez le Centre de Contrôle HFSQL. 

2. Sélectionnez le serveur voulu. 

3. Affichez l'onglet "Notifications". 

4. La liste des notifications envoyées par le serveur est affichée. Il est possible de : 

	- supprimer une notification. 

	- actualiser la liste. 






<a name="NOTE2_3"></a>


### Accéder à l'historique des notifications par programmation
<a name="acceder_historique_des_notifications_par_programmation_ELTPARAGRAPHE000092"></a>L'historique des notifications est enregistré dans un fichier HFSQL présent dans la base de données système du serveur : "Alert.fic". 

Il est possible de manipuler ce fichier de données par programmation de la façon suivante : 


```wl
PROCEDURE HFCS_RécupèreDernièreNotifications(sServeur, sUser="Admin", sPassword="") : chaîne
// Paramètres de la connexion au serveur dont on veut la dernière notification
cnxConnexion est une Connexion
cnxConnexion.Provider = hAccèsHFClientServeur
cnxConnexion.Serveur = sServeur
cnxConnexion.Utilisateur = sUser
cnxConnexion.MotDePasse = sPassword
cnxConnexion.BaseDeDonnées = "__System"

// Par défaut, ne renvoie rien
RETOUR = ""
// Fichiers des notifications du serveur
sdAlert est une Source de Données
SI HDéclareExterne("Alert.fic", sdAlert, cnxConnexion) ALORS
	// Dernière notification en date
	SI HLitDernier(sdAlert, Date) ALORS
		// Récupère l'enregistrement
		RETOUR = HEnregistrementVersChaîne(sdAlert)
	FIN
	// Libère le fichier déclaré
	HAnnuleDéclaration(sdAlert)
	// Libère la connexion
	HFermeConnexion(cnxConnexion)
SINON
	// Echec de l'accès au serveur
	Erreur("Erreur lors de la récupération des notifications : " + HErreurInfo(hErrComplet))
FIN
```




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Recevoir les notifications (via email ou WDBal)
<a name="recevoir_les_notifications_via_email_wdbal_ELTTEXTE000269"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000106"></a>Par défaut, les notifications sont présentes dans le Centre de Contrôle HFSQL. Mais il est également possible d'être averti en temps réel lorsqu'un problème survient sur le serveur HFSQL. Il suffit de configurer le système de notification du serveur HFSQL. 

Cette configuration peut être effectuée : 

- via le Centre de Contrôle HFSQL. 

- par programmation. 





<a name="NOTE3_2"></a>


### Centre de Contrôle HFSQL
<a name="centre_controle_hfsql_ELTPARAGRAPHE000119"></a>Pour configurer l'envoi des notifications HFSQL depuis le Centre de Contrôle HFSQL : 

1. Lancez le Centre de Contrôle HFSQL. 

2. Sélectionnez le serveur voulu. 

3. Dans le ruban, dans le groupa "Paramètres", cliquez sur "Configuration du serveur".

4. Dans la liste des configurations possibles, cliquez sur "Notifications". L'écran de configuration des notifications apparaît : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CC_HF_Gestion_Serveur%20-%20HC%20N%B0014.gif&type=thumb)


5. Configurez le ou les modes d'envoi des notifications : 

	- dans l'onglet "Envoi par email", indiquez les caractéristiques du serveur SMTP qui sera utilisé pour l'envoi des notifications par email. 

	- dans la zone "Envoi par messagerie (WDBal)", indiquez les caractéristiques de la base des Centres de Contrôle qui sera utilisée pour l'envoi des notifications.


 Remarques : 

- Le bouton "Récupérer la configuration de la machine" permet de récupérer la configuration du poste en cours. 

- La base des Centres de Contrôle peut aussi bien être en mode Classic qu'en mode Client/Serveur. 

6. Créez les destinataires des notifications : 

	- Le bouton ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Notif_HF_Email.gif)
 permet d'ajouter un destinataire pour l'envoi par email. Indiquez l'adresse email du destinataire et validez. 

	- Le bouton ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Notif_HF_Bal.gif)
 permet d'ajouter un destinataire pour l'envoi via la messagerie WDBal des Centres de Contrôle. Sélectionnez les intervenants concernés et validez. 

	- Dans la liste des destinataires, pour chaque destinataire, sélectionnez le niveau de gravité minimum des incidents concernés par l'envoi de notifications.




7. Cliquez sur le bouton "Appliquer" pour valider la configuration. 





<a name="NOTE3_3"></a>


### Programmation
<a name="programmation_ELTPARAGRAPHE000151"></a>Pour configurer l'envoi des notifications HFSQL par programmation, le WLangage met à votre disposition plusieurs fonctions WLangage : 



|   |   |
| --- | --- |
| [HNotifAjouteDestinataireCC](../WDLang4/1000020387.md) | Ajoute des destinataires pour les notifications envoyées via les Centres de Contrôle (outil de messagerie WDBal). |
| [HNotifAjouteDestinataireEmail](../WDLang4/1000020386.md) | Ajoute des destinataires pour les notifications envoyées par email. |
| [HNotifConfigure](../WDLang4/1000020390.md) | Spécifie et configure le serveur utilisé pour l'envoi des notifications par le serveur HFSQL. |
| [HNotifListeDestinataireCC](../WDLang4/1000020391.md) | Renvoie la liste des destinataires d'une notification envoyée via les Centres de Contrôle (outil de messagerie WDBal). |
| [HNotifListeDestinataireEmail](../WDLang4/1000020388.md) | Renvoie la liste des destinataires d'une notification par email. |
| [HNotifSupprimeDestinataireCC](../WDLang4/1000020398.md) | Supprime les destinataires d'une notification envoyée via les Centres de Contrôle (outil de messagerie WDBal). |
| [HNotifSupprimeDestinataireEmail](../WDLang4/1000020399.md) | Supprime les destinataires d'une notification par email. |










