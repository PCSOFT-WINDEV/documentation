


## HBloqueNumEnr (Fonction)

***En anglais : HLockRecNum***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Bloque un enregistrement et restreint l'accès à cet enregistrement pour toutes les autres applications. L'enregistrement pourra ensuite être débloqué grâce à la fonction [HDébloqueNumEnr](../WDLang4/3044194.md).

**Remarque** : Après l'exécution de la fonction **HBloqueNumEnr**, plusieurs cas peuvent se présenter :

- L'enregistrement est déjà bloqué par une autre application : le blocage ne peut pas être effectué.

- Le fichier de données contenant l'enregistrement est bloqué en totalité : le blocage ne peut pas être effectué.


Par défaut, une [gestion automatique des erreurs de blocages et des conflits de modification](../WDLang4/3044188.md) est effectuée (sauf dans le code des procédures stockées). A tout moment, il est possible de personnaliser ou de débrancher cette gestion automatique des erreurs avec la fonction [HSurErreur](../WDLang4/3044017.md).

Lors d'un problème de blocage, la fonction [HErreurBlocage](../WDLang4/3044099.md) renvoie <u><u><u>Vrai</u></u></u>.

**Attention** : Cette fonction **HBloqueNumEnr** doit être utilisée avec précaution : en effet, lors du blocage, l'enregistrement n'est pas re-lu. Il peut donc avoir été supprimé ou modifié depuis le dernier accès à cet enregistrement. Il est conseillé d'utiliser la fonction [HLit](../WDLang4/3044047.md) avec option de blocage.

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Cette fonction est disponible uniquement pour les fichiers de données HFSQL. Elle n'est pas disponible pour les fichiers de données accédés par JDBC. 
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Blocage d'un enregistrement du fichier de données Client
HBloqueNumEnr(Client, hNumEnrEnCours, hBlocageLectureEcriture)
// Traitement sur l'enregistrement
...
// Redonner l'accès à l'enregistrement
HDébloqueNumEnr()
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = HBloqueNumEnr([<Fichier de données> [, <Enregistrement à bloquer>]] [, <Blocage>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'opération a été réalisée,

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur.




**`<Fichier de données> : (Chaîne de caractères optionnelle)`**

Nom du fichier de données manipulé. 
Si ce nom n'est pas spécifié, la fonction **HBloqueNumEnr** va manipuler le dernier fichier de données utilisé par la dernière fonction de gestion HFSQL (fonction commençant par la lettre H).

**`<Enregistrement à bloquer> : (Entier optionnel)`**

Numéro de l'enregistrement à bloquer. 
Si ce paramètre n'est pas spécifié, la fonction **HBloqueNumEnr** va manipuler l'enregistrement en cours.

![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) La fonction **HBloqueNumEnr** bloque uniquement l'enregistrement en cours. Il est impossible de spécifier un numéro d'enregistrement différent de celui en cours (Pour désigner l'enregistrement en cours, utilisez la constante *hNumEnrEnCours*).

**`<Blocage> : (Constante optionnelle de type entier)`**

Permet de déterminer le type de blocage effectué sur l'enregistrement.


|   |   |
| --- | --- |
| *hBlocageEcriture*<br>(valeur par défaut) | **Blocage en écriture** : l'enregistrement du fichier de données pourra être lu par une autre application mais ne pourra pas être modifié par une autre application.<br>Il sera impossible pour cette autre application de bloquer l'enregistrement ou le fichier de données. |
| *hBlocageLectureEcriture* | **Blocage en lecture/écriture** : l'enregistrement du fichier de données ne pourra ni être lu ni être modifié par une autre application. <br>Il sera impossible pour cette autre application de bloquer l'enregistrement ou le fichier de données. |
| *hBlocageNon* | **Aucun blocage** : l'enregistrement pourra être lu ou modifié par une autre application. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Modification du type de blocage sur un enregistrement
<a name="modification_type_blocage_sur_enregistrement_ELTPARAGRAPHE000181"></a>Pour modifier le type de blocage d'un enregistrement, appelez la fonction **HBloqueNumEnr** avec le type de blocage souhaité. Il n'est pas nécessaire de débloquer l'enregistrement au préalable.
<a name="NOTE0_2"></a>


### Influence du mode de blocage
<a name="influence_mode_blocage_ELTPARAGRAPHE000193"></a>Si le fichier de données est en mode de blocage *hModeMono* (voir la fonction [HMode](../WDLang4/3044039.md)), la fonction **HBloqueNumEnr** n'a aucun effet.
<a name="NOTE0_3"></a>


### Echec du blocage
<a name="echec_blocage_ELTPARAGRAPHE000208"></a>Si l'enregistrement est déjà bloqué, la demande de blocage est répétée H.NbEssais fois (50 par défaut).

Si au bout des H.NbEssais tentatives le fichier de données ne peut être bloqué, la fonction [HErreurBlocage](../WDLang4/3044099.md) renvoie <u><u><u><u>Vrai</u></u></u></u>. La variable H.Niveau indique si l'enregistrement ou le fichier de données est bloqué.
<a name="NOTE0_4"></a>


### Nombre de blocages
<a name="nombre_blocages_ELTPARAGRAPHE000226"></a>Le nombre d'enregistrements pouvant être bloqués individuellement dans un fichier de données est illimité.
<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Connecteur Natif SQL Server : Blocage uniquement en écriture
<a name="connecteur_natif_sql_server_blocage_uniquement_ecriture_ELTPARAGRAPHE000237"></a>La fonction **HBloqueNumEnr** ne bloque qu'en écriture, pas en lecture. La fonction **HBloqueNumEnr** empêche donc une modification de l'enregistrement par un autre poste.

La fonction **HBloqueNumEnr** utilisée sur un enregistrement bloqué ne renvoie PAS d'erreur de blocage (car seule une lecture est effectuée).

Par contre, la fonction [HModifie](../WDLang4/3044042.md) renverra une erreur de blocage sur l'enregistrement bloqué.
<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) 

### Gestion des blocages en OLE DB
<a name="gestion_des_blocages_ole_ELTPARAGRAPHE000264"></a>La fonction **HBloqueNumEnr** n'est pas supportée. Cette fonction génère l'erreur non fatale "Opération invalide sur ce type de base".
<a name="NOTE0_7"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Persistance du blocage
<a name="persistance_blocage_ELTPARAGRAPHE000278"></a>Avec les Connecteurs Natifs SQLServer et Sybase, la relecture d'un enregistrement bloqué par la fonction **HBloqueNumEnr** débloque celui-ci.

<a name="XComposante"></a>

## Composante :
wd280hf.dll
