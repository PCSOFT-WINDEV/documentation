


## HSauvegarde (Fonction)

***En anglais : HBackup***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Réalise la sauvegarde du contenu d'un serveur HFSQL : toutes les bases de données du serveur, une ou plusieurs bases de données, un ou plusieurs fichiers de données. Cette sauvegarde peut être réalisée alors qu'une ou plusieurs bases de données sont en cours d'utilisation.

**La sauvegarde effectuée correspondra à l'état de la base de données au début de la sauvegarde : la base de données sauvegardée est cohérente.** Certaines opérations sont interdites pendant la sauvegarde : suppression de fichiers de données et de bases de données, mise à jour de procédures stockées.

La description de la sauvegarde peut être réalisée grâce à la variable de type [hDescriptionSauvegarde](../WDLang4/1000017455.md). Dans ce cas, il est possible de définir :

- une procédure stockée à exécuter AVANT la sauvegarde. Cette procédure peut si nécessaire annuler la sauvegarde.

- une procédure stockée à exécuter APRES la sauvegarde.  




Pour restaurer cette sauvegarde, utilisez la fonction [HRestaureSauvegarde](../WDLang4/1000017230.md).

Pour supprimer physiquement cette sauvegarde, utilisez la fonction [HSupprimeSauvegarde](../WDLang4/1000017373.md).



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
MaConnexion est une Connexion

Sauvegarde_Doc est une hDescriptionSauvegarde
Sauvegarde_Doc.Description = "Sauvegarde Doc"
Sauvegarde_Doc.AvecIndex = Vrai
Sauvegarde_Doc.Destination = "Doc/Sauvegarde"
Sauvegarde_Doc.Source = "Doc/*"
Sauvegarde_Doc.ProcédureAvant = "mabase:ColDoc.Vérif" 
Sauvegarde_Doc.ProcédureAprès = "mabase:ColDoc.VérifSauvegarde"
HSauvegarde(MaConnexion, Sauvegarde_Doc)
```
<a name="Exemple2"></a>

```wl
gcnxConnexion est une Connexion

// Sauvegarde la base de données wdcomptes dans le répertoire "Sauvegarde"
SI HSauvegarde(gcnxConnexion, "wdcomptes/*", "wdcomptes/Sauvegarde", Vrai, ...
			"Sauvegarde " + DateSys()) = 0 ALORS
	Erreur(HErreurInfo(hErrComplet))
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Syntaxe utilisant le type hDescriptionSauvegarde (avec appel de procédures stockées)

`<Résultat> = HSauvegarde(<Connexion> , <Définition de la sauvegarde>)`
---

**`<Résultat> : (Entier)`**



- Identifiant de la sauvegarde, 

- 0 en cas d'erreur. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'identifier l'erreur. 


La fonction **HSauvegarde** n'est pas bloquante : elle lance la sauvegarde et rend la main à l'application.

**Remarque** : Si une procédure stockée est exécutée avant la sauvegarde et si elle renvoie <u><u><u><u>Faux</u></u></u></u> alors la sauvegarde est annulée.

**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion vers le serveur à sauvegarder. Cette connexion correspond :

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Définition de la sauvegarde> : (Variable de type hDescriptionSauvegarde)`**

Nom de la variable de type [hDescriptionSauvegarde](../WDLang4/1000017455.md) contenant la description de la sauvegarde à réaliser. Dans ce type de variable, il est possible de définir une procédure stockée à exécuter avant la sauvegarde et une procédure stockée à exécuter après la sauvegarde.  


<a name="SYNTAXE2"></a>

### Syntaxe conservée par compatibilité avec la version 12

`<Résultat> = HSauvegarde(<Connexion> , <Données à sauvegarder> , <Destination de la sauvegarde> [, <Sauvegarde des index> [, <Description> [, <Jauge>]]])`
---

**`<Résultat> : (Entier)`**



- Identifiant de la sauvegarde, 

- 0 en cas d'erreur. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'identifier l'erreur. 


La fonction **HSauvegarde** n'est pas bloquante : elle lance la sauvegarde et rend la main à l'application.

**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion vers le serveur à sauvegarder. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Données à sauvegarder> : (Chaîne de caractères)`**

Filtre décrivant les informations à sauvegarder. Les valeurs possibles sont les suivantes :


|   |   |
| --- | --- |
| *\** | Sauvegarde toutes les bases du serveur, les journaux, les bases systèmes (utilisateurs, groupes, droits). |
| *Nom de la base/\** | Sauvegarde toute la base : fichiers de données, liaisons, procédures stockées, triggers. |
| *Nom de la base/Nom fichier 1* | Sauvegarde le fichier de données  &lt;Nom Fichier 1&gt; de la base &lt;Nom de la base&gt;. |
| *Nom de la base 1/Nom fichier 1 + TAB + Nom de la base 2/Nom fichier 2 + ...* | Liste d'éléments à sauvegarder. Le séparateur utilisé peut être la tabulation (TAB) ou le point virgule (";"). |
| *System* | Sauvegarde les bases systèmes (utilisateurs, groupes, droits). |



**`<Destination de la sauvegarde> : (Chaîne de caractères)`**

Nom et destination de la sauvegarde. La sauvegarde sera réalisée sur le serveur, dans un emplacement défini par ce nom. Si ce nom correspond à un chemin relatif, la sauvegarde sera placée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier :

- le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".

- l'année, il suffit d'utiliser la chaîne de caractères "%%ANNEE%%" (par exemple 2008).

- le mois sur 2 chiffres, il suffit d'utiliser la chaîne de caractères "%%MOIS%%" (par exemple 03).

- le jour, il suffit d'utiliser la chaîne de caractères "%%JOUR%%".

- l'heure, il suffit d'utiliser la chaîne de caractères "%%HEURE%%".

- les minutes, il suffit d'utiliser la chaîne de caractères "%%MINUTE%%".




**`<Sauvegarde des index> : (Booléen optionnel)`**



- <u><u><u><u>Vrai</u></u></u></u> (valeur par défaut) pour sauvegarder les index, 

- <u><u><u><u>Faux</u></u></u></u> pour ne pas les sauvegarder. Ne pas sauvegarder les index permet de réduire la taille des sauvegardes. Cependant, la reconstruction des index allongera le temps de restauration.




**`<Description> : (Chaîne de caractères optionnelle)`**

Description de la sauvegarde.

**`<Jauge> : (Nom de champ optionnel)`**

Nom du champ Jauge présent dans la fenêtre. Ce champ est utilisé pour voir uniquement la progression de la phase d'initialisation de la sauvegarde (et non la progression de la sauvegarde). Cette option est disponible uniquement en WINDEV.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Droits nécessaires pour effectuer une sauvegarde
<a name="droits_necessaires_pour_effectuer_une_sauvegarde_ELTPARAGRAPHE000235"></a>Pour effectuer une sauvegarde, l'utilisateur ou le groupe doit posséder le droit de faire des sauvegardes (constante *hDroitSauvegarde*). Ce droit s'applique aux serveurs et aux bases de données.

Pour savoir si un utilisateur ou un groupe possède ce droit, utilisez la fonction [HInfoDroitServeur](../WDLang4/3044322.md) ou [HInfoDroitDaseDeDonnées](../WDLang4/3044320.md).

Pour modifier les droits d'un utilisateur ou d'un groupe d'utilisateurs, utilisez la fonction [HModifieDroitServeur](../WDLang4/3044328.md) ou [HModifieDroitBaseDeDonnées](../WDLang4/3044326.md).
<a name="NOTE0_2"></a>


### Caractéristiques de la sauvegarde
<a name="caracteristiques_sauvegarde_ELTPARAGRAPHE000260"></a>La sauvegarde effectuée correspondra à l'état de la base de données au début de la sauvegarde.

Pendant la sauvegarde, il est interdit de :

- supprimer des fichiers et des bases de données,

- mettre à jour des procédures stockées.   



<a name="NOTE0_3"></a>


### Sauvegarde effectuée depuis le Centre de Contrôle HFSQL
<a name="sauvegarde_effectuee_depuis_centre_controle_hfsql_ELTPARAGRAPHE000274"></a>Il est possible de réaliser une sauvegarde depuis le Centre de Contrôle HFSQL. Cette sauvegarde est disponible dans l'onglet "Sauvegardes" de la description du serveur (bouton "Nouvelle sauvegarde").
<a name="NOTE0_4"></a>


### Sauvegardes planifiées
<a name="sauvegardes_planifiees_ELTPARAGRAPHE000283"></a>Il est possible de planifier les sauvegardes effectuées sur le serveur :

- soit à l'aide des tâches planifiées gérées par le WLangage (fonction [HAjouteTâche](../WDLang4/1000017091.md)).

- soit à l'aide du Centre de Contrôle HFSQL (onglet "Tâches Planifiées" de la description du serveur).





- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDDuplication.gif) ***Exemples didactiques (WINDEV)*** : **WD Duplication** <br>Cet exemple didactique montre comment il est possible de dupliquer une base de données sur un serveur.<br>La duplication s'effectue par programmation et permet de donner un nouveau nom à la base.<br>L'exemple s'appuie sur les fonctions de sauvegarde et de restauration de sauvegarde HFSQL.

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280hf.dll
