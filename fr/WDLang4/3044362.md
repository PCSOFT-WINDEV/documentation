
## Gestion du load balancing (équilibrage dynamique de charge du serveur)
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000144"></a>
La machine serveur qui héberge un moteur de base de données HFSQL peut être très sollicitée.

Le serveur HFSQL dispose d'un système d'équilibrage de charge.
Ce système est destiné à fournir du temps machine à tous les process, à empêcher un process de monopoliser l'ensemble des ressources de la machine serveur.
Par défaut, l'équilibrage de charge est actif.

Deux modes différents sont disponibles :

- **Le mode automatique**, qui partage les ressources au prorata inverse du nombre d'accès au serveur. Un traitement gourmand en ressources partagera son temps d'exécution avec des traitements plus légers. Ainsi, un traitement lourd ne pénalisera pas les autres accès.

- **Le mode prioritaire**, qui partage les ressources selon une priorité définie. Un traitement avec une priorité maximale utilisera la quasi-totalité des ressources du serveur. Il est donc possible de limiter les ressources d'un poste client qui lance un grand nombre d'accès simultanés : il pénalisera ainsi moins les autres utilisateurs.




Le mode prioritaire peut être géré "à chaud", sans avoir à relancer le serveur par programmation (fonctions [HPriorité](../WDLang4/3044352.md) et [HPrioritéClient](../WDLang4/3044353.md)).





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Principe
<a name="principe_ELTTEXTE000174"></a>
Pour chaque utilisateur, un indice de charge est calculé pour ses opérations réalisés sur le serveur. Cet indice de charge est calculé en temps réel. Selon cet indice de charge, plus ou moins de ressources sont allouées à cet utilisateur.

En mode automatique, seule cette charge est prise en compte.

En mode prioritaire, les fonctions [HPriorité](../WDLang4/3044352.md) et [HPrioritéClient](../WDLang4/3044353.md) permettent de faire varier la charge de l'utilisateur.

Le calcul de la charge de chaque utilisateur est réalisé à partir de différents coefficients. Il est possible de faire varier l'importance de chaque compteur dans la formule de calcul de la charge engendrée par un utilisateur sur le serveur. Ce paramétrage (fonctionnalité très avancée) peut être réalisé grâce aux constantes de la fonction [HGèreServeur](../WDLang4/3044359.md).

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Désactiver l'équilibrage de charge : augmentation de la vitesse ?
<a name="desactiver_equilibrage_charge_augmentation_vitesse_ELTTEXTE000198"></a>
Dans certains cas, l'absence d'équilibrage de charge permet de booster les temps de réponse.
Il est possible d'observer une nette amélioration des performances en particulier sur des machines serveur très puissantes.

**Mais chaque cas, chaque serveur, chaque architecture est un cas particulier. Il n'y a pas de règle générale !**

NOTRE SUGGESTION : sur vos serveurs en exploitation, effectuez des tests (des mesures de performances) avec l'équilibrage de charge actif et désactivé.
N'hésitez pas à effectuer vos mesures à différentes période de la journée, de la semaine, pendant l'exécution de batchs lourds, etc.
Par exemple, en général, sur les serveurs utilisés principalement de jour, il est conseillé de désactiver l'équilibrage de charge pour l'exécution des batchs de nuit.
Vous constaterez ainsi sur chaque configuration le meilleur paramétrage à sélectionner.

**Pour désactiver l'équilibrage, 2 méthodes sont disponibles** :

- Par programmation : à l'aide de la fonction HGèreServeur(connexion, hecActif, faux). Cette méthode ne nécessite pas de redémarrer le serveur (voir [HGèreServeur](../WDLang4/3044359.md)). Elle s'applique immédiatement.
	Cette méthode par programmation permet donc d'affiner le paramétrage en fonction de traitements particuliers

- Par paramétrage manuel dans le [fichier HFCONF.INI](../WDLang4/3044345.md) : ajoutez la ligne LoadEnable=0 dans la section [INIT]. Cette méthode nécessite de redémarrer le serveur.









