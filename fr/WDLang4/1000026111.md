


## &lt;Source&gt;.ExécuteRequêteAsynchrone (Fonction)

***En anglais : &lt;Source&gt;.ExecuteQueryAsynchronous***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Exécute une requête de type SELECT de manière asynchrone. Cette requête peut correspondre à : 

- une requête créée sous l'éditeur de requêtes. 

- une variable de type Requête SQL. 




Conditions d'utilisation : 

- **Ce mode est prévu pour des requêtes ayant un temps d'exécution de plusieurs secondes. Pour une requête immédiate ou quasi immédiate, ce mécanisme ralentit "trop" la requête.** 

- La requête doit être de type "SELECT" : elle doit renvoyer des enregistrements. 

- L'exécution d'une requête en mode asynchrone peut être effectuée uniquement à partir du contexte principal. Dans les autres cas, il est nécessaire d'utiliser des threads.

- Cette fonction ne permet pas de passer les paramètres à une requête paramétrée. Les paramètres doivent être passés avant l'exécution de la requête.



<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
REQ_MaRequete.ExécuteRequêteAsynchrone(hRequêteDéfaut, 
							MaProcedurePourChaqueEnregistrement, MaProcedureFinale)

PROCÉDURE INTERNE MaProcedurePourChaqueEnregistrement(enreg est un Enregistrement de REQ_MaRequete)
	Trace("Procédure de traitement de chaque enregistrement " + enreg.NomRubrique)
FIN

PROCÉDURE INTERNE MaProcedureFinale(MonRes est un entier)
	Trace("Procédure de traitement du résultat final")
	SELON MonRes
		CAS heraOK : 
		Trace("La requête et le traitement des enregistrements se sont bien exécutés.")
		CAS heraAnnulée : 
		Trace("Un traitement a renvoyé Faux. La requête et les procédures ont été annulées.")
		AUTRE CAS : 
		Trace("Une procédure ou l'exécution de la requête a rencontré une erreur.")
	FIN
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Exécuter une requête (sans connexion)

`<Résultat> = <Nom de la requête>.ExécuteRequêteAsynchrone([<Mode>, ] <Procédure WLangage pour chaque enregistrement> [, <Procédure WLangage de fin>])`
---

**`<Résultat> : (booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'initialisation de la requête a été effectuée (le code SQL de la requête est valide), 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. La fonction  [HErreur](../WDLang4/3044088.md) permet d'obtenir plus d'informations sur le problème rencontré.




**`<Nom de la requête> : (Source de données)`**

Nom de la requête à exécuter : 

- Nom logique de la requête à initialiser.
	Si une requête de même nom est déjà déclarée, elle est remplacée par la nouvelle requête.

- Nom d'une variable de type [Requête SQL](../Motscles/1514082.md).




**`<Mode> : (Constante optionnelle de type Entier)`**

Option pour l'initialisation de la requête :


|   |   |
| --- | --- |
| *hRequêteDéfaut*<br>(valeur par défaut) | Initialisation de la requête. |
| *hRequêteSansCorrection* | ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Le moteur HFSQL n'effectue aucune vérification de la requête. Cette option doit être utilisée si la requête comporte des ordres spécifiques à un type de connexion (Oracle, SQL Server, ...).<br><br>Attention : si cette constante est utilisée :<br><br>- il est nécessaire de préciser le nom de la connexion (paramètre &lt;Connexion&gt;).<br><br>- il n'est pas possible d'annuler une condition en l'affectant à NULL. <br><br><br> |
| *hRequêteSansCorrectionHF* | ![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png) Le moteur HFSQL n'effectue aucune vérification du format de fichier de données (complété par des espaces ou non). <br>A utiliser si la requête manipule à la fois des fichiers de données HFSQL au format complété par des espaces et des fichiers de données HFSQL au format non complété par des espaces. |


![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Android et Java (accès par JDBC) : Ce paramètre peut correspondre uniquement aux constantes *hRequêteDéfaut* ou *hRequêteSansCorrection*. Si une autre constante est utilisée, elle sera ignorée. 

**`<Procédure WLangage pour chaque enregistrement> : (Nom de procédure)`**

Procédure WLangage (également nommée "callback") exécutée pour chaque enregistrement trouvé correspondant à la requête. Cette procédure est de la forme :

```txt
PROCEDURE <Nom de la procédure>(UnEnreg est un Enregistrement)
```
où &lt;UnEnreg&gt; est une variable de type [Enregistrement](../WDLang4/1000020962.md) correspondant à l'enregistrement en cours (pour la requête exécutée). 

Par défaut, le procédure renvoie <u><u><u><u>Vrai</u></u></u></u> et passe à l'enregistrement suivant. 

Si cette procédure renvoie <u><u><u><u>Faux</u></u></u></u>, la requête est annulée et la procédure &lt;Procédure WLangage de fin&gt; est exécutée.

**`<Procédure WLangage de fin> : (Nom de procédure optionnel)`**

Procédure WLangage (également nommée "callback") exécutée à la fin de l'exécution de la requête. Cette procédure est de la forme :

```txt
PROCEDURE <Nom de la procédure>(nRésultat est un entier)
```
où &lt;nRésultat&gt; est une constante de type Entier qui peut correspondre aux valeurs suivantes : 


|   |   |
| --- | --- |
| *heraAnnulée* | La procédure exécutée pour chaque enregistrement a renvoyé <u><u><u><u>Faux</u></u></u></u>. La requête et les différentes procédures ont été annulées. |
| *heraErreur* | La requête et/ou la procédure appelée pour chaque enregistrement ont rencontré une erreur. Il est possible de connaître l'erreur avec la fonction [HErreurInfo](../WDLang4/3044071.md). |
| *heraOK* | La requête et la procédure exécutée pour chaque enregistrement se sont correctement déroulées. |

Remarque : La requête est détruite lorsque tous les enregistrements ont été parcourus. La &lt;Procédure WLangage de fin&gt; permet uniquement de savoir comment s'est terminé le parcours.


<a name="SYNTAXE2"></a>

### Exécuter une requête via une connexion

`<Résultat> = <Nom de la requête>.ExécuteRequêteAsynchrone([<Connexion> [, <Mode>, ]] <Procédure WLangage pour chaque enregistrement> [, <Procédure WLangage de fin>])`
---

**`<Résultat> : (booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'initialisation de la requête a été effectuée (le code SQL de la requête est valide), 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. La fonction  [HErreur](../WDLang4/3044088.md) permet d'obtenir plus d'informations sur le problème rencontré.




**`<Nom de la requête> : (Source de données)`**

Nom de la requête à exécuter : 

- Nom logique de la requête à initialiser.
	Si une requête de même nom est déjà déclarée, elle est remplacée par la nouvelle requête.

- Nom d'une variable de type [Requête SQL](../Motscles/1514082.md).




**`<Connexion> : (Chaîne de caractères optionnelle)`**

Nom d'une connexion, définie sous l'éditeur d'analyses ou dynamiquement avec la fonction [HDécritConnexion](../WDLang4/3044205.md). La requête sera exécutée via cette connexion.
![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Si ce paramètre n'est pas précisé et si la requête concerne des fichiers de données accédés par OLE DB ou par un Connecteur Natif, la requête est exécutée via la connexion utilisée par le premier fichier de données rencontré dans la requête. Si la connexion utilisée par un fichier de données est modifiée avant l'utilisation de la fonction **&lt;Source&gt;.ExécuteRequêteAsynchrone**, la nouvelle connexion sera utilisée.

**`<Mode> : (Constante optionnelle de type Entier)`**

Option pour l'initialisation de la requête :


|   |   |
| --- | --- |
| *hRequêteDéfaut*<br>(valeur par défaut) | Initialisation de la requête. |
| *hRequêteSansCorrection* | ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Le moteur HFSQL n'effectue aucune vérification de la requête. Cette option doit être utilisée si la requête comporte des ordres spécifiques à un type de connexion (Oracle, SQL Server, ...).<br><br>Attention : si cette constante est utilisée :<br><br>- il est nécessaire de préciser le nom de la connexion (paramètre &lt;Connexion&gt;).<br><br>- il n'est pas possible d'annuler une condition en l'affectant à NULL. <br><br><br> |
| *hRequêteSansCorrectionHF* | ![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png) Le moteur HFSQL n'effectue aucune vérification du format de fichier de données (complété par des espaces ou non). <br>A utiliser si la requête manipule à la fois des fichiers de données HFSQL au format complété par des espaces et des fichiers de données HFSQL au format non complété par des espaces. |


![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Android et Java (accès par JDBC) : Ce paramètre peut correspondre uniquement aux constantes *hRequêteDéfaut* ou *hRequêteSansCorrection*. Si une autre constante est utilisée, elle sera ignorée. 

**`<Procédure WLangage pour chaque enregistrement> : (Nom de procédure)`**

Procédure WLangage (également nommée "callback") exécutée pour chaque enregistrement trouvé correspondant à la requête. Cette procédure est de la forme :

```txt
PROCEDURE <Nom de la procédure>(UnEnreg est un Enregistrement)
```
où &lt;UnEnreg&gt; est une variable de type [Enregistrement](../WDLang4/1000020962.md) correspondant à l'enregistrement en cours (pour la requête exécutée). 

Par défaut, le procédure renvoie <u><u><u><u>Vrai</u></u></u></u> et passe à l'enregistrement suivant. 

Si cette procédure renvoie <u><u><u><u>Faux</u></u></u></u>, la requête est annulée et la procédure &lt;Procédure WLangage de fin&gt; est exécutée.

**`<Procédure WLangage de fin> : (Nom de procédure optionnel)`**

Procédure WLangage (également nommée "callback") exécutée à la fin de l'exécution de la requête. Cette procédure est de la forme :

```txt
PROCEDURE <Nom de la procédure>(nRésultat est un entier)
```
où &lt;nRésultat&gt; est une constante de type Entier qui peut correspondre aux valeurs suivantes : 


|   |   |
| --- | --- |
| *heraAnnulée* | La procédure exécutée pour chaque enregistrement a renvoyé <u><u><u><u>Faux</u></u></u></u>. La requête et les différentes procédures ont été annulées. |
| *heraErreur* | La requête et/ou la procédure appelée pour chaque enregistrement ont rencontré une erreur. Il est possible de connaître l'erreur avec la fonction [HErreurInfo](../WDLang4/3044071.md). |
| *heraOK* | La requête et la procédure exécutée pour chaque enregistrement se sont correctement déroulées. |

Remarque : La requête est détruite lorsque tous les enregistrements ont été parcourus. La &lt;Procédure WLangage de fin&gt; permet uniquement de savoir comment s'est terminé le parcours.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Pourquoi utiliser la constante hRequêteSansCorrection
<a name="pourquoi_utiliser_constante_hrequetesanscorrection_ELTPARAGRAPHE000459"></a>Par défaut, WINDEV et WEBDEV interprètent les requêtes SQL sur OLE DB et sur ODBC via le provider OLE DB. Pour que la requête ne soit pas interprétée, utilisez la constante *hRequêteSansCorrection*.

La constante *hRequêteSansCorrection* peut par exemple être utilisée si vous saisissez directement le code SQL de votre requête sous l'éditeur de requêtes.

| hRequêteSansCorrection n'est pas spécifié | hRequêteSansCorrection est spécifié |
| --- | --- |
| Détermination automatique de la connexion associée aux fichiers de données présents dans la requête. | La connexion à utiliser doit être précisée dans la fonction **HExécuteRequêteSQL**. |
| Remplacement de tous les signes propriétaires PC SOFT (exemple : ']=' commence par) par leur équivalent en SQL standard. | Aucun remplacement n'est effectué. Il est nécessaire d'utiliser les signes SQL standard. |
| Formatage des dates et des heures selon le format utilisé par la base de données.<br>Par exemple, sous WINDEV et WEBDEV, les dates sont au format 'AAAAMMJJ' alors que sous Access, les dates sont au format #AAAAJJMM# ou #AAAAMMJJ# selon la langue du système. | Aucun formatage n'est effectué. Il est nécessaire d'utiliser le format reconnu par la base de données. |
| Formatage des flottants (le séparateur de décimal peut être '.' ou ',') | Aucun formatage des flottants n'est réalisé. |
| Selon la base de données utilisée, remplacement des noms d'alias par les noms complets des rubriques dans les clauses Where, Order by et Group by<br>Par exemple, le moteur JET (Access, DBase, ...) n'accepte pas de noms d'alias dans la clause Where d'une requête | Aucun remplacement n'est effectué. Il est nécessaire d'utiliser directement dans le code de la requête les noms complets des rubriques dans les clauses Where, Order by et Group by. |


<a name="NOTE0_2"></a>


### Passage de paramètres à la requête
<a name="passage_parametres_requete_ELTPARAGRAPHE000503"></a>Pour passer des paramètres à une requête paramétrée avant de l'exécuter, il est également nécessaire d'utiliser la syntaxe suivante :

```txt
<Nom de la requête>.<Nom du paramètre 1> = xxx
<Nom de la requête>.<Nom du paramètre 2> = xxx
<Nom de la requête>.<Nom du paramètre 3> = xxx
<Nom de la requête>.ExécuteRequêteAsynchrone(<Procédure>)
SI ErreurDétectée = Vrai ALORS ...
```

**Remarque** : A chaque exécution de la requête paramétrée, la structure des paramètres de la requête est ré-initialisée.

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280hf.dll
