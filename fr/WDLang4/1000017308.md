
## Comment sauvegarder des bases de données HFSQL Client/Serveur ?
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000188"></a>
La sauvegarde des bases de données HFSQL Client/Serveur peut être déclenchée :

- [dans le Centre de Contrôle HFSQL](#NOTE2).

- [par programmation](#NOTE3).








<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Sauvegardes dans le Centre de Contrôle HFSQL
<a name="sauvegardes_dans_centre_controle_hfsql_ELTTEXTE000218"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000028"></a>Le Centre de Contrôle HFSQL permet de créer et de gérer aussi bien : 

- des sauvegardes complètes ou différentielles,

- des sauvegardes immédiates ou planifiées. 



<a name="NOTE2_2"></a>


### Effectuer une sauvegarde
<a name="effectuer_une_sauvegarde_ELTPARAGRAPHE000247"></a>**Remarque** : Les sauvegardes réalisées de cette façon sont nécessairement complètes. Les sauvegardes différentielles ne peuvent être faites que par le biais de sauvegardes planifiées.

Pour effectuer une sauvegarde : 

1. Connectez-vous si nécessaire à un serveur HFSQL. 

2. Double-cliquez sur le nom du serveur HFSQL dans l'arborescence. 

3. La partie droite du Centre de Contrôle affiche un onglet au nom du serveur. 

4. Cliquez sur l'onglet "Sauvegardes".

5. Dans le ruban, dans le groupe "Sauvegardes", déroulez "Nouvelle sauvegarde" et sélectionnez "Nouvelle sauvegarde à chaud". L'assistant de création d'une sauvegarde se lance.

6. Indiquez le contenu de la sauvegarde :

	- Tout le contenu du serveur.

	- Une base de données spécifique.

	- Une sélection de bases de données et / ou de fichiers de données.




7. Passez à l'étape suivante de l'assistant et indiquez les options de sauvegarde : 

	- si le résultat de la sauvegarde doit être compressé dans un fichier zip. 

	- si la sauvegarde doit contenir les fichiers d'index (fichiers d'index NDX et fichiers d'index full-text FTX). Si les fichiers d'index ne sont pas sauvegardés, la taille de la sauvegarde sera réduite, mais le temps de restauration sera plus long. Remarque : si les fichiers d'index ne sont pas sauvegardés, il sera nécessaire de fournir les mots de passe des fichiers au moment de la restauration pour permettre leur réindexation.




8. Passez à l'étape suivante de l'assistant. 

9. Indiquez l'emplacement de la sauvegarde en spécifiant le répertoire de sauvegarde. Si ce nom correspond à un chemin relatif, la sauvegarde sera réalisée dans le sous-répertoire "Backup" du serveur HFSQL. L'assistant permet de définir un sous-répertoire de "backup" ("Sauvegardes" par défaut). Il est également possible d'ajouter la date et l'heure (sous la forme "Année\\Mois\\Jour\\Heure-Minute") au nom du répertoire pour identifier facilement la sauvegarde.
	Remarque : Les sauvegardes sont réalisées dans un sous-répertoire numéroté (par exemple "backup\\Sauvegardes\\1"). Ainsi, si plusieurs sauvegardes sont réalisées, les fichiers correspondants ne seront pas écrasés par une nouvelle sauvegarde.

10. Passez à l'étape suivante de l'assistant. 

11. Indiquez les actions associées à la sauvegarde : 

	- Procédure stockée avant ou après la sauvegarde : Dans ce cas, l'étape suivante de l'assistant permet d'indiquer :

		- le nom de la base contenant la procédure stockée à exécuter,

		- le nom de la collection de procédures contenant la procédure stockée à exécuter,

		- le nom de la procédure à exécuter.




- Webhook exécutée après la sauvegarde : Dans ce cas, l'étape suivante de l'assistant permet d'indiquer l'URL de la webhook (du service REST) à laquelle le résultat de la sauvegarde doit être envoyé. 

12. Donnez une description à votre sauvegarde et validez.

13. La sauvegarde est automatiquement lancée. Vous pouvez suivre la sauvegarde dans le Centre de Contrôle HFSQL.




**Remarque** : Il est également possible de réaliser une sauvegarde depuis l'onglet "Sauvegardes" d'une base de données sélectionnée dans l'arbre à gauche de l'écran.
<a name="NOTE2_3"></a>


### Effectuer une sauvegarde planifiée
<a name="effectuer_une_sauvegarde_planifiee_ELTPARAGRAPHE000293"></a>Pour effectuer une sauvegarde planifiée : 

1. Connectez-vous si nécessaire à un serveur HFSQL. 

2. Double-cliquez sur le nom du serveur HFSQL dans l'arborescence. 

3. La partie droite du Centre de Contrôle affiche un onglet au nom du serveur. 

4. Cliquez sur l'onglet "Sauvegardes".

5. Dans le ruban, dans le groupe "Sauvegardes", déroulez "Nouvelle sauvegarde" et sélectionnez "Nouvelle sauvegarde planifiée". L'assistant de création d'une sauvegarde se lance.

6. Indiquez le contenu de la sauvegarde : tout le contenu du serveur, une base de données spécifique, une sélection de bases de données et / ou de fichiers.

7. Passez à l'étape suivante de l'assistant et indiquez les options de sauvegarde : 

	- si le résultat de la sauvegarde doit être compressé au format zip.

	- si la sauvegarde doit contenir les fichiers d'index (fichiers d'index NDX et fichiers d'index full-text FTX). Si les fichiers d'index ne sont pas sauvegardés, la taille de la sauvegarde sera réduite, mais le temps de restauration sera plus long. Remarque : si les fichiers d'index ne sont pas sauvegardés, il sera nécessaire de fournir les mots de passe des fichiers au moment de la restauration pour permettre leur réindexation.




8. Passez à l'étape suivante de l'assistant. 

9. Choisissez un scénario de planification parmi les scénarios prédéfinis. Vous pouvez également opter pour une planification personnalisée. Dans ce cas, les étapes suivantes de l'assistant vous guideront dans la construction de la planification.

10. Passez à l'étape suivante de l'assistant. 

11. Indiquez l'emplacement de la sauvegarde en spécifiant le répertoire de sauvegarde. Si ce nom correspond à un chemin relatif, la sauvegarde sera réalisée dans le sous-répertoire "Backup" du serveur HFSQL. L'assistant permet de définir un sous-répertoire de "backup" ("Sauvegardes" par défaut). Il est également possible d'ajouter la date et l'heure (sous la forme "Année\\Mois\\Jour\\Heure-Minute") au nom du répertoire pour identifier facilement la sauvegarde.
	Remarque : Les sauvegardes sont réalisées dans un sous-répertoire numéroté (par exemple "backup\\Sauvegardes\\1"). Ainsi, si plusieurs sauvegardes sont réalisées, les fichiers correspondants ne seront pas écrasés par une nouvelle sauvegarde.

12. Passez à l'étape suivante de l'assistant. 

13. Indiquez les actions associées à la sauvegarde : 

	- Procédure stockée avant ou après la sauvegarde : Dans ce cas, l'étape suivante de l'assistant permet d'indiquer :

		- le nom de la base contenant la procédure stockée à exécuter,

		- le nom de la collection de procédures contenant la procédure stockée à exécuter,

		- le nom de la procédure à exécuter.




- Webhook exécutée après la sauvegarde : Dans ce cas, l'étape suivante de l'assistant permet d'indiquer l'URL de la webhook (du service REST) à laquelle le résultat de la sauvegarde doit être envoyé. 

14. Indiquez si vous souhaitez limiter le nombre de sauvegardes conservées sur le serveur.

15. Donnez une description à votre sauvegarde et validez.

16. La sauvegarde sera automatiquement lancée selon la planification indiquée. Vous pouvez suivre la sauvegarde dans le Centre de Contrôle HFSQL.



<a name="NOTE2_4"></a>


### Manipulations sur les sauvegardes
<a name="manipulations_sur_les_sauvegardes_ELTPARAGRAPHE000334"></a>Le Centre de Contrôle HFSQL permet de manipuler les différentes sauvegardes réalisées. Il est possible de :

- Effectuer une sauvegarde.

- Restaurer une sauvegarde.

- Restaurer une sauvegarde présente dans un répertoire spécifique.

- Supprimer une sauvegarde. Pour supprimer une sauvegarde, il est nécessaire d'être "Super utilisateur".

- Relancer une sauvegarde (option disponible dans "Autres actions"). 

- Récupérer une sauvegarde sur le poste client (option disponible dans "Autres actions"). 




Pour effectuer ces manipulations : 

1. Connectez-vous si nécessaire à un serveur HFSQL. 

2. Double-cliquez sur le nom du serveur HFSQL dans l'arborescence. 

3. La partie droite du Centre de Contrôle affiche un onglet au nom du serveur.

4. Sélectionnez l'onglet "Sauvegardes".

5. Sélectionnez la sauvegarde à manipuler. 

6. Les options spécifiques à la gestion des sauvegardes sont placées dans le groupe "Sauvegardes" du ruban. Elles permettent de : 

	- créer une nouvelle sauvegarde (à chaud ou planifiée), 

	- relancer une sauvegarde,

	- restaurer une sauvegarde,

	- supprimer une sauvegarde, 

	- récupérer une sauvegarde. Cette option est disponible uniquement pour les sauvegardes réalisées sous forme d'un fichier ZIP. Il suffit d'indiquer l'emplacement où doit être enregistré le fichier de sauvegarde. 









<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Sauvegardes par programmation
<a name="sauvegardes_par_programmation_ELTTEXTE000365"></a>
Plusieurs fonctions WLangage sont à votre disposition pour gérer les sauvegardes par programmation. Il est possible d'effectuer : 

- des sauvegardes complètes ou différentielles,

- des sauvegardes immédiates ou planifiées. 



<a name="NOTE3_2"></a>


### Créer une sauvegarde immédiate par programmation
<a name="creer_une_sauvegarde_immediate_par_programmation_ELTPARAGRAPHE000064"></a>Pour créer une sauvegarde immédiate par programmation : 

1. Définissez les caractéristiques de la sauvegarde à l'aide d'une variable de type [hDescriptionSauvegarde](../WDLang4/1000017455.md). Si la sauvegarde est immédiate, seule une sauvegarde complète peut être réalisée. 

2. Exécutez la sauvegarde grâce à la fonction [HSauvegarde](../WDLang4/1000017081.md).



<a name="NOTE3_3"></a>


### Créer une sauvegarde planifiée par programmation
<a name="creer_une_sauvegarde_planifiee_par_programmation_ELTPARAGRAPHE000080"></a>Pour créer une sauvegarde planifiée par programmation : 

1. Définissez les caractéristiques de la sauvegarde à l'aide d'une variable de type [hDescriptionSauvegarde](../WDLang4/1000017455.md) et ses options de planification. Il est possible de définir une sauvegarde différentielle associée à une sauvegarde complète.  

2. Ajoutez la sauvegarde planifiée grâce à la fonction [HAjouteSauvegardePlanifiée](../WDLang4/1000018866.md). 



<a name="NOTE3_4"></a>


### Fonctions WLangage permettant de gérer les sauvegardes (complètes, différentielles, planifiées, immédiates)
<a name="fonctions_wlangage_permettant_gerer_les_sauvegardes_completes_differentielles_planifiees_immediates_ELTPARAGRAPHE000096"></a>Le WLangage met également à votre disposition les fonctions suivantes pour gérer les sauvegardes : 



|   |   |
| --- | --- |
| [HAjouteSauvegardePlanifiée](../WDLang4/1000018866.md) | Ajoute une planification de sauvegarde complète (avec ou sans sauvegarde différentielle) sur le serveur défini par la connexion. |
| [HAnnuleSauvegarde](../WDLang4/1000017082.md) | Annule une sauvegarde en cours. |
| [HExécuteSauvegardePlanifiée](../WDLang4/1000018937.md) | Force le déclenchement d'une sauvegarde planifiée. |
| [HInfoSauvegarde](../WDLang4/1000017083.md) | Renvoie des informations sur une ou plusieurs sauvegardes effectuées sur un serveur HFSQL Client/Serveur. |
| [HListeSauvegardePlanifiée](../WDLang4/1000018868.md) | Liste les sauvegardes complètes et différentielles qui ont été planifiées sur un serveur HFSQL Client/Serveur. |
| [HModifieSauvegardePlanifiée](../WDLang4/1000018932.md) | Modifie une planification de sauvegarde. |
| [HRécupèreSauvegarde](../WDLang4/1000022468.md) | Récupère en local le contenu d'une sauvegarde compressée (au format ZIP) réalisée sur un serveur HFSQL. |
| [HRestaureSauvegarde](../WDLang4/1000017230.md) | Permet de restaurer : <br><br>- une sauvegarde immédiate (effectuée grâce à la fonction [HSauvegarde](../WDLang4/1000017081.md) ou via le Centre de Contrôle HFSQL),<br><br>- une sauvegarde planifiée (décrite à l'aide de la fonction [HAjouteSauvegardePlanifiée](../WDLang4/1000018866.md) ou via le Centre de Contrôle HFSQL.<br><br><br> |
| [HSauvegarde](../WDLang4/1000017081.md) | Réalise la sauvegarde du contenu d'un serveur HFSQL : toutes les bases de données du serveur, une ou plusieurs bases de données, un ou plusieurs fichiers de données. |
| [HSupprimeSauvegarde](../WDLang4/1000017373.md) | Supprime une sauvegarde précédemment effectuée avec la fonction [HSauvegarde](../WDLang4/1000017081.md). |
| [HSupprimeSauvegardePlanifiée](../WDLang4/1000018870.md) | Supprime une planification de sauvegarde sur un serveur HFSQL Client/Serveur. |





<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Remarques
<a name="remarques_ELTTEXTE000498"></a>


### Caractéristiques de la sauvegarde
<a name="caracteristiques_sauvegarde_ELTPARAGRAPHE000107"></a>La sauvegarde effectuée correspondra à l'état de la base de données au début de la sauvegarde.

Pendant la sauvegarde, il est interdit de :

- supprimer des fichiers de données et des bases de données,

- mettre à jour des procédures stockées.   





<a name="NOTE4_2"></a>


### Gestion d'une procédure avant et/ou après
<a name="gestion_une_procedure_avant_etou_apres_ELTPARAGRAPHE000120"></a>Il est possible d'appeler une procédure stockée avant ou après la sauvegarde. Ces procédures peuvent prendre des paramètres. 

**Gestion d'une procédure avant** : 
La procédure stockée appelée AVANT la sauvegarde peut prendre des paramètres. Cette procédure est de la forme : 

```txt
PROCEDURE <Nom de la procédure>(<Données à sauvegarder>, ...
		<Destination de la sauvegarde>, <Description>)
```
Ces paramètres sont optionnels. Ils vous permettront de manipuler les indications suivantes dans le code de la procédure stockée :

- ***&lt;Données à sauvegarder&gt;*** : Chaîne de caractères correspondant aux informations à sauvegarder. Correspond à la propriété **Source**. Les valeurs possibles sont les suivantes :
	


|   |   |
| --- | --- |
| *\** | Sauvegarde toutes les bases de données du serveur, les journaux, les bases de données systèmes (utilisateurs, groupes, droits). |
| *Nom de la base de données 1/Nom Fichier1 + TAB + Nom de la base de données 2/Nom Fichier2 + ...* | Liste d'éléments à sauvegarder. Le séparateur utilisé peut être la tabulation (TAB) ou le point virgule (";"). |
| *Nom de la base de données/\** | Sauvegarde toute la base de données : fichiers, liaisons, procédures stockées, triggers. |
| *Nom de la base de données/Nom Fichier1* | Sauvegarde le fichier &lt;Nom Fichier1&gt; de la base de données &lt;Nom de la base de données&gt;. |
| *System* | Sauvegarde les bases de données systèmes (utilisateurs, groupes, droits). |



- ***&lt;Destination de la sauvegarde&gt;*** : Nom et destination de la sauvegarde. Correspond à la propriété **Destination**. La sauvegarde sera réalisée sur le serveur, dans un emplacement défini par ce nom. Si ce nom correspond à un chemin relatif, la sauvegarde sera placée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier :

	- le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".

	- l'année, il suffit d'utiliser la chaîne de caractères "%%ANNEE%%" (par exemple 2008).

	- le mois sur 2 chiffres, il suffit d'utiliser la chaîne de caractères "%%MOIS%%" (par exemple 03).

	- le jour, il suffit d'utiliser la chaîne de caractères "%%JOUR%%".

	- l'heure, il suffit d'utiliser la chaîne de caractères "%%HEURE%%".

	- les minutes, il suffit d'utiliser la chaîne de caractères "%%MINUTE%%".




- ***&lt;Description&gt;*** : Description de la sauvegarde. Correspond à la propriété **Description**.




**Gestion d'une procédure après** : 
La procédure stockée appelée APRES la sauvegarde peut prendre des paramètres. Cette procédure est de la forme : 

```txt
PROCEDURE <Nom de la procédure>(<Données à sauvegarder>, <Destination de la sauvegarde>, ...
			<Description>, <Etat>, <Message d'erreur>)
```
Ces paramètres sont optionnels. Ils vous permettront de manipuler les indications suivantes dans le code de la procédure stockée :

- ***&lt;Données à sauvegarder&gt;*** : Chaîne de caractères correspondant aux informations à sauvegarder. Correspond à la propriété **Source**. Les valeurs possibles sont les suivantes :
	


|   |   |
| --- | --- |
| *\** | Sauvegarde toutes les bases de données du serveur, les journaux, les bases de données systèmes (utilisateurs, groupes, droits). |
| *Nom de la base de données 1/Nom Fichier1 + TAB + Nom de la base de données 2/Nom Fichier2 + ...* | Liste d'éléments à sauvegarder. Le séparateur utilisé peut être la tabulation (TAB) ou le point virgule (";"). |
| *Nom de la base de données/\** | Sauvegarde toute la base de données : fichiers, liaisons, procédures stockées, triggers. |
| *Nom de la base de données/Nom Fichier1* | Sauvegarde le fichier &lt;Nom Fichier1&gt; de la base de données &lt;Nom de la base de données&gt;. |
| *System* | Sauvegarde les bases de données systèmes (utilisateurs, groupes, droits). |



- ***&lt;Destination de la sauvegarde&gt;*** : Nom et destination de la sauvegarde. Correspond à la propriété **Destination**. La sauvegarde sera réalisée sur le serveur, dans un emplacement défini par ce nom. Si ce nom correspond à un chemin relatif, la sauvegarde sera placée dans le sous-répertoire "Backup" du serveur HFSQL. Pour spécifier :

	- le répertoire du service Manta, il suffit d'utiliser la chaîne de caractères "%%EXE%%".

	- l'année, il suffit d'utiliser la chaîne de caractères "%%ANNEE%%" (par exemple 2008).

	- le mois sur 2 chiffres, il suffit d'utiliser la chaîne de caractères "%%MOIS%%" (par exemple 03).

	- le jour, il suffit d'utiliser la chaîne de caractères "%%JOUR%%".

	- l'heure, il suffit d'utiliser la chaîne de caractères "%%HEURE%%".

	- les minutes, il suffit d'utiliser la chaîne de caractères "%%MINUTE%%".




- ***&lt;Description&gt;*** : Description de la sauvegarde. Correspond à la propriété **Description**.

- ***&lt;Etat&gt;*** :  entier (ou constante de type Entier) permettant de connaître l'état de la sauvegarde :
	


|   |   |   |
| --- | --- | --- |
| *hSvgAnnulée* | 2 | Sauvegarde annulée |
| *hSvgEnCours* | 0 | Sauvegarde en cours |
| *hSvgErreur* | 3 | Erreur lors de la sauvegarde |
| *hSvgTerminée* | 1 | Sauvegarde terminée |



- ***&lt;Message d'erreur&gt;*** : Message d'erreur s'il existe sous forme de chaîne de caractères.





<a name="NOTE4_3"></a>


### Gestion d'une webhook
<a name="gestion_une_webhook_ELTPARAGRAPHE000136"></a>Une webhook permet de déclencher un traitement automatiquement via un service REST. Il suffit de renseigner l'URL du service REST.  

Une requête de type POST sera effectuée sur l'URL fournie. L'URL reçoit un contenu de type 'application/json' correspondant aux informations sur la sauvegarde effectuée. Par exemple : 
```txt
{
	"identifier" : "283",
	"destination" : "c:\backup\283\monbackup.zip",
	"state" : "completed"
}
```
où : 

- "identifier" correspond à l'identifiant de la sauvegarde. 

- "destination" correspond à la destination de la sauvegarde. 

- "state" correspond à l'état de la sauvegarde. Différents états sont possibles : 'completed', 'canceled' ou 'error'.







