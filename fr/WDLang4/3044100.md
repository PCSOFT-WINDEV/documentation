


## HFiltre (Fonction)

***En anglais : HFilter***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Définit et active un filtre sur un fichier de données, une vue ou une requête.

Après son exécution, les cas suivants sont les plus fréquents :

- le filtre ne peut pas être créé : la fonction **HFiltre** renvoie une chaîne vide. La fonction [HErreur](../WDLang4/3044088.md) permet de récupérer l'identifiant de l'erreur.

- le filtre est créé : la fonction **HFiltre** renvoie la clé de parcours optimale à utiliser pour réaliser le parcours du fichier de données, de la vue ou de la requête.





<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Filtre simple avec une condition : 
// Rechercher les clients d'une ville

CléParcours est une chaîne
maville est une chaîne

maville = "MONTPELLIER"
CléParcours = HFiltre(Client, "VILLE='" + maville + "'")
HLitPremier(Client, CléParcours)
TANTQUE HEnDehors() = Faux
	// Traitement de l'enregistrement 
	...
	HLitSuivant(Client, CléParcours)
FIN
// Annule le filtre
HDésactiveFiltre(Client)
```

```wl
// Filtre réalisé avec une clé de parcours bornée et une condition : 
// la clé de parcours est fixée

CléParcours est une chaîne
// Filtre les factures comprises entre le 1/1/2005 et le
// 31/12/2005 dont le total est supérieur à 1500 Euros TTC
// avec une remise dont le type est passé en paramètres (rubrique texte)
CléParcours = HFiltre(Facture, DateFacture, "20050101", "20051231", ...
	ChaîneConstruit("TotalTTC>1500 ET TypeRemise = '%1'" + , ...
	Remplace(sTypeRemise, "'", "\'")))
// La fonction Remplace permet de préfixer les apostrophes
// que peut contenir sTypeRemise d'un antislash
SI CléParcours <> "" ALORS
	HLitPremier(Facture, CléParcours)
	TANTQUE HEnDehors() = Faux
		// Traitement de l'enregistrement : envoi d'une lettre de remerciement
		Envoi_Lettre()
		HLitSuivant(Facture, CléParcours)
	FIN
FIN
...
// Annule le filtre
HDésactiveFiltre(Facture)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Filtre construit avec une clé de parcours bornée et une condition

`<Résultat> = HFiltre(<Fichier de données> , <Clé de parcours> , <Borne minimale> [, <Borne maximale> [, <Condition de sélection>]])`
---

**`<Résultat> : (Chaîne de caractères)`**

Rubrique de parcours. Correspond : 

- soit à la clé de parcours du fichier de données si le filtre est activé. 

- soit à une chaîne vide ("") si le filtre ne peut pas être mis en place. 




**`<Fichier de données> : (Chaîne de caractères)`**

Nom du fichier de données, de la vue HFSQL ou de la requête manipulé.

**`<Clé de parcours> : (Chaîne de caractères)`**

Nom de la rubrique clé utilisée pour parcourir le fichier de données, la vue ou la requête. Cette rubrique doit être une clé de parcours du fichier de données, de la vue ou de la requête. C'est sur cette rubrique que s'appliquent les bornes minimales et maximales.

**`<Borne minimale> : (Type de la rubrique de parcours)`**

Valeur minimale incluse de la rubrique de parcours (si la clé de parcours est définie avec un sens de parcours ascendant dans l'analyse). Les enregistrements correspondant à cette valeur minimale seront inclus dans le filtre. Dans le cas d'un parcours descendant (c'est-à-dire si la clé de parcours est définie avec un sens de parcours descendant dans l'analyse), c'est la valeur maximale de la rubrique de parcours. 
Le type de ce paramètre doit correspondre au type de la rubrique de parcours. Par exemple, si la rubrique de parcours est une chaîne, la borne minimale doit être une chaîne.

**`<Borne maximale> : (Type de la rubrique de parcours, paramètre optionnel)`**

Valeur maximale incluse de la rubrique de parcours (cas d'un parcours ascendant). Les enregistrements correspondant à cette valeur maximale seront inclus dans le filtre. Le type de ce paramètre doit correspondre au type de la rubrique de parcours. Par exemple, si la rubrique de parcours est une chaîne, la borne maximale doit être une chaîne. 
Dans le cas d'un parcours descendant, c'est la valeur minimale de la rubrique de parcours.
Si ce paramètre n'est pas précisé, la borne maximale du filtre correspond à la valeur du paramètre &lt;Borne minimale&gt;.

**`<Condition de sélection> : (Chaîne de caractères optionnelle)`**

Condition de sélection pour créer le filtre (voir Notes). Cette condition de sélection peut être une chaîne de caractères au format Ansi ou Unicode.


<a name="SYNTAXE2"></a>

### Filtre construit avec une condition

`<Résultat> = HFiltre(<Fichier de données> , <Condition de sélection>)`
---

**`<Résultat> : (Chaîne de caractères)`**

Rubrique de parcours. Correspond : 

- soit à la clé de parcours du fichier de données si le filtre est activé 

- soit à une chaîne vide si le filtre ne peut pas être mis en place




**`<Fichier de données> : (Chaîne de caractères)`**

Nom du fichier de données, de la vue HFSQL ou de la requête manipulé.

**`<Condition de sélection> : (Chaîne de caractères)`**

Condition de sélection pour créer le filtre (voir NOTES). Cette condition de sélection peut être une chaîne de caractères au format Ansi ou Unicode.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Borne minimale et borne maximale sur une rubrique clé de type texte ou clé composée
<a name="borne_minimale_borne_maximale_sur_une_rubrique_cle_type_texte_cle_composee_ELTPARAGRAPHE000146"></a>Si la borne minimale et la borne maximale sont identiques :

- pour réaliser **un filtre à l'identique sur une valeur**, il suffit de préciser cette valeur dans le paramètre "Borne min".
	Par exemple, pour sélectionner les clients dont le nom correspond à "Dupon" :
	
	```wl
	HFiltre(Client, Nom, "Dupon")
	```

	Le client "Dupontel" ne sera pas sélectionné.

- pour réaliser **un filtre générique sur une valeur**, il suffit de :

	- compléter la borne minimale avec la constante *hValMin* pour lui donner la valeur minimale.

	- compléter la borne maximale avec la constante *hValMax* pour lui donner la valeur maximale.


 Par exemple, pour sélectionner les clients dont le nom commence par "Dupon" :
	
	```wl
	HFiltre(Client, Nom, "Dupon" + hValMin, "Dupon" + hValMax)
	```

	Les clients "Dupon" et "Dupontel" seront sélectionnés.


Remarques :

- La constante *hValMin* est équivalente à Caract(0).

- La constante *hValMax* est équivalente à Caract(255).



<a name="NOTE0_2"></a>


### Filtre et parcours filtré
<a name="filtre_parcours_filtre_ELTPARAGRAPHE000187"></a>Après l'exécution de la fonction **HFiltre**, le parcours du fichier de données doit obligatoirement être effectué sur la rubrique renvoyée par la fonction **HFiltre**. Si une autre rubrique est utilisée pour le parcours du fichier de données, le filtre ne sera pas pris en compte.

Lorsqu'un filtre est défini et activé sur un fichier de données (une vue ou une requête), tout enregistrement lu correspond au filtre. Si il n'y a plus d'enregistrement correspondant au filtre lors du parcours :

- la fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u><u>Vrai</u></u></u></u>.

- l'enregistrement en cours correspond au dernier enregistrement lu avec le filtre.




Par exemple :

| Sur un fichier de données filtré, après la fonction : | l'enregistrement en cours est : |
| --- | --- |
| HLitPremier | le premier enregistrement du fichier de données correspondant au filtre |
| HLitDernier | le dernier enregistrement du fichier de données correspondant au filtre |
| **HLitSuivant** (ou **HAvance**) | l'enregistrement suivant (ou le nième suivant) correspondant au filtre |
| **HLitPrécédent** (ou **HRecule**) | l'enregistrement précédent (ou le nième précédent) correspondant au filtre |


<a name="NOTE0_3"></a>


### Condition de sélection
<a name="condition_selection_ELTPARAGRAPHE000237"></a>La syntaxe générale d'une condition a la forme suivante :

"NomCli&gt;'Dupont' et (CodePos=34 ou CodePos=32)"

Les opérateurs acceptés sont variables en fonction du type des rubriques utilisées dans la condition :


|   |   |   |
| --- | --- | --- |
| &gt; | Plus grand | Valable pour tous les types |
| &gt;= | Plus grand ou égal | Valable pour tous les types |
| &lt; | Plus petit | Valable pour tous les types |
| &lt;&gt; | Différent | Valable pour tous les types |
| &lt;= | Plus petit ou égal | Valable pour tous les types |
|  = | Strictement égal | Valable pour tous les types |
| ] | Contient : prend en compte la casse des caractères | Valable pour les types chaîne uniquement |
| ]= | Commence par : prend en compte la casse des caractères | Valable pour les types chaîne uniquement |
| ~] | Contient : ne prend pas en compte la casse des caractères | Valable pour les types chaîne uniquement |
| ~~ | Égalité très souple : ne différencie pas les caractères majuscules des caractères minuscules, ne tient pas compte des espaces situés avant et après la chaîne à tester, ne tient pas compte des caractères accentués minuscules, ne tient pas compte des espaces et des ponctuations à l'intérieur des chaînes. | Valable pour les types chaîne uniquement |
| ~= | Environ égal : ne tient pas compte des espaces à droite, ni des accents, ni de la casse des caractères | Valable pour les types chaîne uniquement |

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Les opérateurs ~~ et ~= ne doivent pas être utilisés. Ces opérateurs sont interdits.

**Remarques sur la condition de sélection** :

- Les chaînes constantes doivent être encadrées de simples quotes.

- Si le nom de la rubrique contient des simples quotes, elles doivent être doublées. 
	Par exemple : ‘Rubrique‘‘avec‘‘quotes‘

- Les comparaisons entre chaînes se font en fonction des paramètres spécifiés pour les index.

- Les mémos binaires et les clés composées ne peuvent pas faire partie d'une condition de sélection. 
	Pour les clés composées, il est conseillé d'utiliser la première syntaxe. Il n'est pas possible d'utiliser la syntaxe suivante :
	
	```wl
	HFiltre(NOMFICHIER, "CLECOMP~]'AAA' ET CLECOMP]='" + ...
		HConstruitValClé(NOMFICHIER, CLECOMP, 0) + "'")
	```


- Si une chaîne de caractères (constante ou variable) contient une simple quote, il faut faire précéder cette simple quote par un anti-slash ( \\ ).

- Pour optimiser le parcours du filtre, utilisez la fonction [HStatCalcule](../WDLang4/3044134.md) sur le fichier de données avant de créer le filtre. En effet, le moteur HFSQL analyse la condition de sélection et s'appuie ensuite sur ces statistiques pour déterminer les rubriques les plus discriminantes qui permettront d'optimiser le parcours du fichier de données.

- Cette condition de sélection peut être une chaîne de caractères au format Ansi ou Unicode.



<a name="NOTE0_4"></a>


### Activation/Désactivation d'un filtre
<a name="activationdesactivation_filtre_ELTPARAGRAPHE000351"></a>La fonction [HDésactiveFiltre](../WDLang4/3044085.md) permet de désactiver un filtre.

La fonction [HActiveFiltre](../WDLang4/3044158.md) permet de ré-activer un filtre.

Lorsque le fichier de données (la requête ou la vue) est fermé (fonction [HFerme](../WDLang4/3044073.md) par exemple), le filtre est supprimé.

A un même instant, il ne peut exister qu'un seul filtre sur un fichier de données (une requête ou une vue). Si la fonction **HFiltre** est utilisée plusieurs fois, seul le dernier filtre sera pris en compte : le(s) filtre(s) précédent(s) seront supprimés.
<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png) 

### Filtre sur une clé composée
<a name="filtre_sur_une_cle_composee_ELTPARAGRAPHE000380"></a>Pour construire un filtre sur une clé composée, plusieurs méthodes sont disponibles :

- Méthode 1 : Utilisation d'une liste de valeurs dans la fonction **HFiltre**.

- Méthode 2 : Utilisation de l'instruction [POUR TOUT](../Motscles/1510013.md).

- Méthode 3 : Utilisation de la fonction [HConstruitValClé](../WDLang4/3044258.md).




Pour plus de détails sur l'utilisation des clés composées dans les filtres, consultez [Clés composées et Filtres](../WDLang4/3044178.md).

**Exemple d'utilisation de la méthode 1 : Utilisation d'une liste de valeurs**

La valeur de la clé composée sur laquelle le filtre doit être effectué peut être directement construite dans la fonction **HFiltre** grâce à la syntaxe suivante :

```txt
HFiltre(<Nom du fichier>, <Nom de la clé composée>, 
	[<Liste des valeurs pour la borne minimale de la clé composée>], 
	[<Liste des valeurs pour la borne maximale de la clé composée>])
```


**Exemple** : Recherche de tous les enregistrements du fichier CLIENT dont le nom et le prénom sont compris entre "AA","Barnabé" et "Philomène" et "Tartuffe".

```wl
HFiltre(Client, NomPrenom, ["AA","Philomène"], ["Barnabé","Tartuffe"])
```
Dans cet exemple, "AA","Zorro" est renvoyé par le filtre alors que "Philomène","Zorro" n'est pas renvoyé.

**Exemple** : Recherche de tous les enregistrements du fichier Taches dont les tâches sont comprises entre le 15/03/2021 00h00 et le 25/03/2021 00h00.

```wl
HFiltre(Taches, DateDébutTacheHeureDébutTache, [20210315,0000], [20210325,0000])
```

<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Fichiers de données non HFSQL
<a name="fichiers_donnees_non_hfsql_ELTPARAGRAPHE000434"></a>

- Le filtre peut être créé à partir de n'importe quelle rubrique (rubrique clé ou non clé).

- L'exécution de la fonction **HFiltre** rend automatiquement le filtre actif.

- Les modifications apportées par les fonctions **HFiltre** et [HDésactiveFiltre](../WDLang4/3044085.md) sont prises en compte uniquement lors de l'utilisation des fonctions [HLitPremier](../WDLang4/3044051.md)/[HPremier](../WDLang4/3044113.md), [HLitDernier](../WDLang4/3044140.md)/[HDernier](../WDLang4/3044101.md) ou [HLitRecherchePremier](../WDLang4/3044036.md)/[HLitRechercheDernier](../WDLang4/3044034.md).




<a name="XComposante"></a>

## Composante :
wd280hf.dll
