


## HRechercheDernier (Fonction)

***En anglais : HSeekLast***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Positionne sur le dernier enregistrement du fichier de données dont la valeur d'une rubrique spécifique est inférieure ou égale à une valeur recherchée. ***L'enregistrement n'est pas lu***.
Le numéro de l'enregistrement en cours est modifié uniquement lorsqu'il est renvoyé par la fonction [HNumEnr](../WDLang4/3044063.md). Pour les fonctions manipulant par défaut le numéro de l'enregistrement en cours (fonctions [HSupprime](../WDLang4/3044018.md), [HLit](../WDLang4/3044047.md), [HModifie](../WDLang4/3044042.md), ...), la valeur de ce numéro n'est pas mise à jour : il faut utiliser la fonction [HNumEnr](../WDLang4/3044063.md)(). Par exemple : ne pas faire : 

```wl
HSupprime(Client)
```
mais 

```wl
HSupprime(Client, HNumEnr())
```
La lecture se fait de la plus petite à la plus grande valeur de la rubrique de parcours (consultez les remarques pour plus de détails).

**Attention** : ***L'enregistrement chargé en mémoire n'est pas modifié***. Les variables HFSQL (par exemple Client.Nom, c'est-à-dire la rubrique *Nom* du fichier *Client*) ne sont pas mises à jour.

En général, la fonction **HRechercheDernier** permet de se positionner dans le fichier de données pour effectuer une boucle de parcours parmi les enregistrements correspondant à une condition. La fonction [HSuivant](../WDLang4/3044027.md) permet de se positionner sur l'enregistrement suivant correspondant à la condition.

Après l'exécution de la fonction **HRechercheDernier**, plusieurs cas peuvent se présenter :

- un enregistrement correspondant à la condition a été trouvé : la fonction [HTrouve](../WDLang4/3044104.md) renvoie <u><u><u>Vrai</u></u></u>

- le fichier de données est vide ou il n'existe pas d'enregistrement correspondant à la condition : la fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u>Vrai</u></u></u>




**Remarques** : 

- Par défaut, les fonctions [HRecherchePremier](../WDLang4/3044125.md) et [HRechercheDernier](../WDLang4/3044129.md) permettent de réaliser une recherche à l'identique.

- Par défaut, la fonction **HRechercheDernier** effectue une recherche générique.





La lecture se fait de la plus petite à la plus grande valeur de la rubrique de parcours (consultez les notes pour plus de détails).

**Attention** : ***L'enregistrement chargé en mémoire n'est pas modifié***. Les variables HFSQL (par exemple Client.Nom, c'est-à-dire la rubrique *Nom* du fichier *Client*) ne sont pas mises à jour.

En général, la fonction **HRechercheDernier** permet de se positionner dans le fichier de données pour effectuer une boucle de parcours parmi les enregistrements correspondant à une condition.

Après l'exécution de la fonction **HRechercheDernier**, plusieurs cas peuvent se présenter :

- un enregistrement correspondant à la condition a été trouvé, bloqué (si nécessaire) et chargé en mémoire : la fonction [HTrouve](../WDLang4/3044104.md) renvoie <u><u><u>Vrai</u></u></u>. 

- le fichier de données est vide ou il n'existe pas d'enregistrement correspondant à la condition : la fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u>Vrai</u></u></u>.

- la fonction tente de bloquer un enregistrement déjà bloqué en lecture : la fonction [HErreurBlocage](../WDLang4/3044099.md) renvoie <u><u><u>Vrai</u></u></u> et la fonction [HEnDehors](../WDLang4/3044094.md) renvoie <u><u><u>Vrai</u></u></u>.




**Remarque** : la recherche peut être annulée grâce à la fonction [HAnnuleRecherche](../WDLang4/3044157.md).


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Recherche du dernier enregistrement pour lequel le nom du Client est Dupond
HRechercheDernier(Client, Nom, "Dupond")
```
<a name="Exemple2"></a>

```wl
// Cet exemple permet de rechercher tous les clients 
// ayant un chiffre d'affaires inférieur à une valeur donnée. 
HRechercheDernier(Client, ChiffreAffaires, X)
TANTQUE PAS HEnDehors(Client)
	AjouterClientListe()
	HPrécédent(Client, ChiffreAffaires)
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = HRechercheDernier(<Fichier de données> , <Rubrique clé> , <Valeur recherchée> [, <Options>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le positionnement sur l'enregistrement a été effectué (correspond à la valeur de [HTrouve](../WDLang4/3044104.md)). 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. Ce problème peut être dû :

	- soit à un problème de positionnement (fichier de données vide, ...) : la fonction [HTrouve](../WDLang4/3044104.md) renvoie <u><u><u><u>Faux</u></u></u></u> et la fonction [HErreur](../WDLang4/3044088.md) renvoie 0.

	- soit à une erreur : la fonction [HErreur](../WDLang4/3044088.md) renvoie un entier différent de 0. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'obtenir plus de détails.







**`<Fichier de données> : (Chaîne de caractères)`**

Nom du fichier de données HFSQL manipulé.

**`<Rubrique clé> : (Chaîne de caractères)`**

Nom de la rubrique clé sur laquelle la recherche doit être effectuée.

**`<Valeur recherchée> : (Type correspondant à la valeur)`**

Valeur de la rubrique recherchée.

**`<Options> : (Constante ou combinaison de constantes optionnelle)`**

Paramètre :

- le mode de blocage de l'enregistrement recherché

- le type de recherche effectué.





|   |   |
| --- | --- |
| *hBlocageEcriture* | Blocage en écriture : l'enregistrement pourra être lu par une autre application mais ne pourra pas être modifié par une autre application. |
| *hBlocageLectureEcriture* | Blocage en lecture/écriture : l'enregistrement ne pourra ni être lu ni être modifié par une autre application.<br>![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) Blocage en écriture seulement. Fonctionnement équivalent à la constante *hBlocageEcriture*. |
| *hBlocageNon* | Aucun blocage : l'enregistrement pourra être lu ou modifié par une autre application pendant la lecture. |
| *hGénérique* | Recherche générique (voir Notes)<br>Par défaut (constante non spécifiée), la recherche effectuée est une recherche à l'identique. |
| *hLimiteParcours* | Le parcours s'arrêtera dès que la dernière valeur recherchée sera trouvée. L'enregistrement en cours correspondra à ce dernier enregistrement trouvé.<br>[HTrouve](../WDLang4/3044104.md) vaudra <u><u><u><u>Faux</u></u></u></u> et [HEnDehors](../WDLang4/3044094.md) vaudra <u><u><u><u>Vrai</u></u></u></u>.<br>Cette constante permet d'optimiser la vitesse de recherche en mode Client/Serveur. |
| *hRespecteFiltre* | Le parcours prendra en compte le filtre mis en place avec la fonction [HFiltre](../WDLang4/3044100.md), même si la clé de parcours utilisée n'est pas optimisée pour le filtre. Rappel : la fonction [HFiltre](../WDLang4/3044100.md) renvoie la clé de parcours optimisée pour le filtre.<br>**Attention** : Dans ce cas, sur des fichiers de données de taille importante, des problèmes de performances peuvent survenir.<br>![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) Cette variable ne peut pas être utilisée.Par défaut, le parcours suivant la fonction **HRechercheDernier** ne prend pas en compte le filtre. |

![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Ce paramètre est ignoré.![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Si le provider OLE DB ou le Connecteur Natif utilisé ne gère pas les blocages, les options de blocage seront sans effet.![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) Le mode de blocage spécifié avec la fonction **HRechercheDernier** restera effectif lors des appels aux fonctions [HPrécédent](../WDLang4/3044112.md) et [HSuivant](../WDLang4/3044027.md).

Pour modifier le mode de blocage, il est nécessaire d'utiliser :

- soit les fonctions [HRecherchePremier](../WDLang4/3044125.md) ou **HRechercheDernier**,

- soit les fonctions [HDernier](../WDLang4/3044101.md) ou [HPremier](../WDLang4/3044113.md).






<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Recherche générique/Recherche à l'identique
<a name="recherche_generiquerecherche_identique_ELTPARAGRAPHE000286"></a>

- **Recherche générique** (essentiellement sur les rubriques de type Chaîne de caractères) : ***Recherche tous les enregistrements commençant par la valeur indiquée***. 
	Par exemple : Lors d'une recherche générique de la chaîne "Martin" pour la rubrique NOM, tous les enregistrements dont la rubrique Nom commence par "Martin" correspondront à la recherche. Ainsi, l'enregistrement contenant "Martinez" correspondra à la recherche (la fonction **HTrouve** renvoie <u><u><u><u>Vrai</u></u></u></u>).

- **Recherche à l'identique** : ***Recherche tous les enregistrements correspondant exactement à la valeur indiquée***. 
	Par exemple : Lors d'une recherche à l'identique sur la chaîne "Matin" pour la rubrique NOM, la fonction **HTrouve** renvoie <u><u><u><u>Vrai</u></u></u></u> uniquement pour les enregistrements dont la rubrique vaut exactement "Martin".

- Exemples de recherches effectuées sur le fichier CLIENT trié par nom : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=hlitrechpremier.gif)






|   |   |   |   |   |   |
| --- | --- | --- | --- | --- | --- |
| Valeur cherchée | Options | **HRechercheDernier** positionne sur l'enregistrement | **HTrouve** renvoie | HEnDehors renvoie | Explications |
| Durand |   | 6 | Vrai | Faux | Durand existe.<br>Le début du fichier de données n'a pas encore été atteint. |
| Dupuis |   | 5 | Faux | Faux | Dupuis n'existe pas. Positionnement sur la première valeur inférieure (Dupont).<br>Le début du fichier de données n'a pas encore été atteint. |
| Dupon | HGénérique | 5 | Vrai | Faux | Dupon n'existe pas mais la recherche est générique et il existe un Dupont (entre autres).<br>Le début du fichier de données n'a pas encore été atteint. |
| Dupon |   | L'enregistrement n'a pas été trouvé (pas de déplacement) | Faux | Faux | Dupon n'existe pas.<br>Le début du fichier de données n'a pas encore été atteint. |
| Bernard |   | L'enregistrement n'a pas été trouvé (pas de déplacement) | Faux | Vrai | Bernard n'existe pas.<br>Positionnement sur la première valeur inférieure (cette valeur n'existe pas) : Le début du fichier de données est donc atteint. |


<a name="NOTE0_2"></a>


### Recherche sur une clé composée
<a name="recherche_sur_une_cle_composee_ELTPARAGRAPHE000388"></a>Plusieurs méthodes permettent de faire une recherche sur une clé composée :

- Utilisation d'une liste de valeurs.

- Utilisation de la fonction [HConstruitValClé](../WDLang4/3044258.md).




**Utilisation d'une liste de valeurs**

Pour faire une recherche sur une clé composée, il est possible d'utiliser la syntaxe suivante :

```txt
HRechercheDernier(<Nom du fichier>, <Nom de la clé composée>, ...
	[<Valeur de recherche du premier élément de la clé composée>, 
	<Valeur de recherche du deuxième élément de la clé>, ...])
```
Exemple :

```wl
// Recherche de l'enregistrement
HRechercheDernier(Client, Nom_Prénom, ["Moulin", "Françoise"])
```
![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) Les recherches génériques sur les clés composées fonctionnent uniquement si toutes les composantes de la clé composée sont de type Texte. Dans le cas contraire, une recherche à l'identique est effectuée.
<a name="NOTE0_3"></a>


### Recherche sur une rubrique tableau
<a name="recherche_sur_une_rubrique_tableau_ELTPARAGRAPHE000418"></a>La recherche se fait uniquement sur le premier élément du tableau (élément d'indice 1). Pour effectuer une recherche sur les autres éléments du tableau, utilisez des filtres ou des requêtes.
<a name="NOTE0_4"></a>


### Recherche et filtre
<a name="recherche_filtre_ELTPARAGRAPHE000427"></a>Si un filtre est actif (fonction [HFiltre](../WDLang4/3044100.md)), la recherche tient compte du filtre.
![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) Si un filtre est actif, la recherche ne tient pas compte du filtre.
<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png)![Langage Externe](https://doc.pcsoft.fr/ext/images/fr/LE.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Blocages
<a name="blocages_ELTPARAGRAPHE000444"></a>Les blocages ne s'appliquent que lorsque un enregistrement a été trouvé.

Par défaut (pas de mode de blocage spécifié dans le paramètre &lt;Options&gt;), aucun blocage de l'enregistrement n'est réalisé.

Si un blocage est demandé (constantes *hBlocageEcriture* ou *hBlocageLectureEcriture*), la lecture de l'enregistrement sera réalisée uniquement si cet enregistrement n'est pas déjà bloqué.

**Rappel** : Un enregistrement bloqué peut être débloqué avec la fonction [HDébloqueNumEnr](../WDLang4/3044194.md).

![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Si le provider OLE DB ou le Connecteur Natif utilisé ne gère pas les blocages, les options de blocage seront sans effet.

<a name="XComposante"></a>

## Composante :
wd280hf.dll
