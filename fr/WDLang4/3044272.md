
## Les triggers
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Définition
<a name="definition_ELTTEXTE000156"></a>
Un trigger est une procédure WLangage appelée automatiquement par le moteur HFSQL à chaque modification (ajout, suppression, modification, ...) d'un enregistrement d'un fichier de données.

Un trigger permet d'associer un traitement WLangage à une ou plusieurs fonctions HFSQL sans se préoccuper de l'emplacement de ces fonctions dans le code. Même s'il s'agit de fenêtres ou de code créés par un assistant, les triggers associés aux fonctions HFSQL utilisées sont exécutés.







<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Utilisation des triggers
<a name="utilisation_des_triggers_ELTTEXTE000186"></a>


### Bases de données concernées
<a name="bases_donnees_concernees_ELTPARAGRAPHE000031"></a>Les triggers s'appliquent sur tous les types de fichiers de données :

- HFSQL Classic,

- HFSQL Client/Serveur,

- Connecteurs Natifs (Oracle, AS/400, ...),

- ODBC,

- OLE DB, ...





<a name="NOTE2_2"></a>


### HFSQL Classic et HFSQL Client/Serveur
<a name="hfsql_classic_hfsql_clientserveur_ELTPARAGRAPHE000045"></a>HFSQL Classic et HFSQL Client/Serveur permettent de définir des triggers.

**En mode HFSQL Classic**, les triggers sont manipulés par programmation, à l'aide de fonctions WLangage. Ces triggers sont utilisables sur toutes les bases de données. Pour plus de détails, consultez [Les triggers](../WDLang4/3044271.md).

**En mode Serveur**, deux types de triggers sont disponibles :

- Les triggers exécutés sur le client. Ces triggers sont équivalent au mode Classic et sont manipulés par programmation.

- Les triggers Serveur exécutés sur le serveur. Ces triggers sont associés à des procédures stockées présentes sur le serveur. Ces triggers sont définis directement dans l'analyse (pour une utilisation avancée, ils peuvent être également définis et manipulés par programmation). Pour plus de détails, consultez [Les triggers serveur](../WDLang4/3044369.md).




**Remarque : Triggers et threads** : Si des fonctions déclenchent des triggers dans des threads différents, la procédure exécutée dans le trigger utilise le contexte HFSQL correspondant à celui de la fonction en cours (un contexte HFSQL par thread).
<a name="NOTE2_3"></a>


### Avantages
<a name="avantages_ELTPARAGRAPHE000067"></a>L'utilisation d'un trigger permet de :

- Diminuer la taille du code. Par exemple, les traitements associés à une ou plusieurs fonctions HFSQL (vérification de doublon, test de cohérence des données, ...) peuvent être regroupés grâce à l'utilisation d'un trigger.

- Simplifier la lecture du code .

- Simplifier les évolutions futures de l'application.


**Attention** : Une modification de fichier qui passe par une requête ne déclenche pas les triggers client (constante *hModifieFichier* utilisée dans [HExécuteRequête](../WDLang4/3044080.md)).  



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Types de triggers disponibles
<a name="types_triggers_disponibles_ELTTEXTE000222"></a>
Deux types de trigger sont disponibles : 

- Les triggers "AVANT" :
	Un trigger "AVANT" est appelé *avant* l'exécution d'une fonction HFSQL ([HAjoute](../WDLang4/3044147.md), [HModifie](../WDLang4/3044042.md), [HSupprime](../WDLang4/3044018.md), ...) ou une fonction de gestion des champs Table fichier.
	Un trigger "AVANT" permet par exemple de vérifier la cohérence des données des rubriques d'un enregistrement. Avec ce type de trigger, il est possible d'initialiser une variable HFSQL pour annuler l'exécution de la fonction HFSQL associée.

- Les triggers "APRÈS" :
	Un trigger "APRÈS" est appelé *après* l'exécution d'une fonction HFSQL (sauf si le programme a été interrompu pendant l'exécution de cette fonction) ou une fonction de gestion des champs Table fichier. 
	Un trigger "APRÈS" permet par exemple de gérer le traitement des erreurs.







- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDTrigger.gif) ***Exemples didactiques (WINDEV)*** : **WD Trigger** <br>Cet exemple montre comment utiliser les triggers avec WINDEV.<br>Un trigger est une procédure en WLangage appelée automatiquement par le moteur HFSQL à chaque exécution d'une fonction HFSQL. <br><br>Dans cet exemple, nous abordons deux thèmes principaux :<br>1/ comment brancher un trigger sur une fonction HFSQL<br>2/ quel code utiliser dans la fonction appelée par le trigger.<br><br>Résumé de l'exemple livré avec WINDEV :	<br>Cette application permet de saisir les notes de frais des collaborateurs d'une société.<br>Deux modes sont utilisables :<br>- le mode avec les droits en lecture/écriture <br>- le mode avec les droits en lecture seulement. <br>Ce sont les triggers qui permettront de contrôler l'accès aux fichiers en fonction du mode en cours. <br>Dans l'exemple, les triggers permettent également d'écrire dans un fichier journal les différents événements.<br>Ce fichier journal est directement consultable dans l'application.


