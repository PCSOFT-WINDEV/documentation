


## &lt;Source&gt;.DécritTrigger (Fonction)

***En anglais : &lt;Source&gt;.DescribeTrigger***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Ajoute ou modifie un trigger sur un fichier de données HFSQL. Un trigger est une procédure en WLangage appelée automatiquement par le moteur HFSQL à chaque exécution d'une fonction HFSQL. Les requêtes de type UPDATE, INSERT ou DELETE déclenchent également l'exécution du trigger (Attention : le trigger n'est pas déclenché sur des tables accédées via un Connecteur Natif). 

Pour plus de détails, consultez [Gestion des triggers](../WDLang4/3044271.md). 

![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Cette fonction est disponible uniquement côté client. Utilisez la fonction [&lt;Variable Connexion&gt;.DécritTriggerServeur](../WDLang4/1000022653.md) pour décrire un trigger serveur pour une base de données HFSQL Client/Serveur.


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Dans le code d'initialisation du projet
LOCAL
	ResultatTrigger est un booléen

// Création du Trigger pour le fichier Client
ResultatTrigger = Client.DécritTrigger("HAJOUTE,HMODIFIE," + ...
			 "HSUPPRIME,HRAYE,HECRIT", "VerifDroitUtilisateur", hTriggerAvant)
// Avec "VerifDroitUtilisateur" une procédure globale du projet
SI ResultatTrigger = Faux ALORS
	 Erreur("Erreur sur un trigger : " + HErreurInfo)
	 RETOUR
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = <Fichier de données HFSQL>.DécritTrigger(<Liste de fonctions HFSQL> , <Procédure WLangage> , <Type du trigger>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'opération a été réalisée, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'identifier l'erreur.




**`<Fichier de données HFSQL> : (Nom de fichier)`**

Nom logique d'un fichier de données HFSQL.

**`<Liste de fonctions HFSQL> : (Chaîne de caractères)`**

Nom d'une ou de plusieurs fonctions HFSQL ou TableXXX sur lesquelles le trigger doit être mis en place. Pour indiquer plusieurs noms de fonctions, il faut séparer les noms des fonctions par une virgule (","). Il est possible de définir des triggers sur les fonctions suivantes :

- [&lt;Source&gt;.Modifie](../WDLang4/1000025038.md)

- [&lt;Source&gt;.Ajoute](../WDLang4/1000024187.md)

- [&lt;Source&gt;.Supprime](../WDLang4/1000025071.md)

- [&lt;Source&gt;.Ecrit](../WDLang4/1000024331.md)

- [&lt;Source&gt;.Raye](../WDLang4/1000025051.md)




**`<Procédure WLangage> : (Nom de procédure)`**

Nom de la procédure WLangage à exécuter lors du déclenchement du trigger sur la/les fonctions HFSQL spécifiées.

**`<Type du trigger> : (Constante de type Entier)`**

Indique le type du trigger.


|   |   |
| --- | --- |
| *hTriggerAprès* | La procédure est exécutée après la fonction HFSQL. |
| *hTriggerAvant* | La procédure est exécutée avant la fonction HFSQL. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Trigger sur les fonctions de manipulation des tables
<a name="trigger_sur_les_fonctions_manipulation_des_tables_ELTPARAGRAPHE000275"></a>Les fonctions de manipulation des tables ([&lt;Table&gt;.Ajoute](../WDLang1/1000023600.md), [&lt;Table&gt;.AjouteLigne](../WDLang1/1000023404.md), [&lt;Table&gt;.Supprime](../WDLang1/1000024289.md), [&lt;Table&gt;.Modifie](../WDLang1/1000024273.md), ... ) utilisent implicitement les fonctions HFSQL suivantes : [&lt;Source&gt;.Ajoute](../WDLang4/1000024187.md), [&lt;Source&gt;.Supprime](../WDLang4/1000025071.md) et [&lt;Source&gt;.Modifie](../WDLang4/1000025038.md).

Lors de l'utilisation d'une de ces fonctions de manipulation de table, si un trigger est défini pour la fonction HFSQL correspondante, le trigger est automatiquement déclenché.
<a name="NOTE0_2"></a>


### Variables permettant de gérer les triggers
<a name="variables_permettant_gerer_les_triggers_ELTPARAGRAPHE000322"></a>Une procédure de type trigger ne reçoit aucun paramètre. Toutefois, un certain nombre de variables d'état HFSQL sont positionnées avant chaque appel :


|   |   |
| --- | --- |
| H.Action | Caractère initialisé à "A" pour un trigger Avant, "P" pour un trigger après. |
| H.AFaire | Pendant l'exécution d'un trigger avant :<br><br>- annulation de l'exécution de la fonction HFSQL en cours en affectant **"A"** à la variable d'état HFSQL : H.AFaire = "A". Dans ce cas, l'action n'est pas effectuée et la fonction (HAjoute, HModifie, ...) renvoie <u><u><u><u>Vrai</u></u></u></u> (pas d'erreur).<br><br>- annulation de l'exécution de la fonction HFSQL en cours en affectant **"E"** à la variable d'état HFSQL : H.AFaire = "E". Dans ce cas, l'action n'est pas effectuée et la fonction (HAjoute, HModifie, ...) renvoie <u><u><u><u>Faux</u></u></u></u>. Le message d'erreur est le suivant : "L'action sur le fichier XXX a été interrompue par le trigger".<br><br><br> |
| H.FonctionTrigger | Chaîne de caractères : Nom de la fonction HFSQL qui a déclenché le trigger |
| H.NomFichier | Chaîne de caractères : Nom logique du fichier de données dont le trigger est activé |


**Remarque** : Dans le cas où un trigger "AVANT" et un trigger "APRÈS" sont associés à une fonction HFSQL, si le trigger "AVANT" annule l'exécution de la fonction HFSQL (en positionnant H.AFaire à "A") le trigger "APRÈS" n'est pas déclenché.

<a name="XComposante"></a>

## Composante :
wd280hf.dll
