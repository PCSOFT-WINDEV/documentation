
## HCréeRéplicaAbonné (Fonction)

***En anglais : HCreateSubscriberReplica***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Crée le fichier de description d'un réplica abonné. Le fichier correspondant au réplica abonné a pour extension RPL.

Cette fonction est utilisable avec la réplication journalée et/ou avec la réplication universelle.

**Attention** : Lors de la création d'un réplica abonné, il est nécessaire :

- d'avoir créé le réplica maître (fonction [HCréeRéplicaMaître](../WDLang4/3044175.md)).

- d'avoir accès au réplica maître.


![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png) Seule la réplication universelle est disponible. 

Remarque : La réplication n'est pas disponible lors de l'accès à une base de données via .




<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple

![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 
```wl
// Création du fichier de réplica maître dans le répertoire C:\RPL\France
// en spécifiant un nom de fichier
HCréeRéplicaMaître("C:\RPL\France\ReplicaFrance.RPM")
// Création du réplica abonné
HCréeRéplicaAbonné("C:\RPL\France\", "C:\RPL\USA", 1)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Réplication universelle

`<Résultat> = HCréeRéplicaAbonné(<Répertoire du Réplica Maître> , <Répertoire du Réplica Abonné> , <Identifiant> , <Taille de la plage des identifiants> , <Liste des tables à répliquer> [, <Modification automatique>])`
---

**`<Résultat> : (Entier)`**



- Identifiant du Réplica Abonné qui a été créé, 

- 0 si le réplica abonné n'a pas été créé.




**`<Répertoire du Réplica Maître> : (Chaîne de caractères)`**

Répertoire où le fichier de description du Réplica Maître (fichier RPM) a été créé (fonction [HCréeRéplicaMaître](../WDLang4/3044175.md)). Ce répertoire peut être un répertoire réseau ou un chemin UNC. 
Si ce paramètre correspond à une chaîne vide (""), le fichier de description sera recherché dans le répertoire en cours des fichiers de données HFSQL (défini sous l'éditeur d'analyses ou par programmation). 
**Attention** : Ce répertoire doit être accessible lors de l'exécution de la fonction **HCréeRéplicaAbonné**.

**`<Répertoire du Réplica Abonné> : (Chaîne de caractères)`**

Répertoire où le fichier de description du Réplica Abonné doit être créé. Ce fichier a pour nom **Replica_&lt;Identifiant&gt;.RPL**. 
Si ce paramètre correspond à une chaîne vide (""), le fichier de description sera créé dans le répertoire en cours des fichiers de données HFSQL (défini sous l'éditeur d'analyses ou par programmation).

**`<Identifiant> : (Entier ou chaîne de caractères)`**

Identifiant du Réplica Abonné. Cet identifiant pourra être utilisé par la fonction [hCréeRéplicaTransportable](../WDLang4/3044209.md). 
Si l'identifiant spécifié existe déjà, une erreur WLangage est générée.

**`<Taille de la plage des identifiants> : (Entier)`**

Ce paramètre est ignoré.

**`<Liste des tables à répliquer> : (Chaîne de caractères)`**

Cette liste est de la forme : 

```txt
<NomTable>[+TAB+<NomRubriqueDate>][+<RC>+<NomTable>[+TAB+<NomRubriqueDate>]]...
```


**Attention** : L'ordre des tables est important. L'ordre des tables est l'ordre des dépendances des tables. 
Si les enregistrements d'un fichier 1 sont liés aux enregistrements d'un fichier 2 et si l'enregistrement doit être présent dans le fichier 2 pour que l'ajout dans le fichier 1 respecte les règles d'intégrité, il faut placer le fichier 1 en premier dans la liste. 
Par exemple, dans le cas des fichiers "Client", "Commande" et "Ligne de commande" (qui sont reliées par des liaisons de cardinalités (0,n) - (1,1)), il faut placer le fichier "Client" en premier (pour ajouter une commande il faut un client), puis le fichier "Commande" (pour ajouter une ligne de commande il faut une commande) et enfin le fichier "Ligne de commande".

Le nom de la rubrique Date est obligatoire pour des bases de données différentes de HFSQL. Cette rubrique doit correspondre à une rubrique du fichier de données mise à jour lors d'un ajout ou d'une modification. Cette opération doit être effectuée par l'application.  

**`<Modification automatique> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> pour prendre en compte la modification automatique des données. Dans ce cas : 

	- Une modification de la structure de la base de données maître sera reportée sur la base de données abonnée.

	- Les nouvelles rubriques seront prises en compte par la réplication. 




- <u><u><u><u>Faux</u></u></u></u> (valeur par défaut). La modification automatique des données effectuée sur la base de données maître n'est pas reportée sur la base de données abonnée. 


Attention :

- Pour des réplications existantes, il est nécessaire de recréer une réplication (et notamment les abonnés) pour mettre en place ce mécanisme.

- Ce mécanisme ne fonctionne pas en cas d'ajout ou de suppression d'une clé unique. 

- Ce paramètre est disponible uniquement pour une réplication entre des bases de données HFSQL (Classic ou Client/Serveur). 





<a name="SYNTAXE2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png) 
### Réplication journalée (entre des bases de données HFSQL)

`<Résultat> = HCréeRéplicaAbonné(<Répertoire du Réplica Maître> , <Répertoire du Réplica Abonné> [, <Identifiant> [, <Taille de la plage des identifiants>]])`
---

**`<Résultat> : (Entier)`**



- Identifiant du Réplica Abonné qui a été créé, 

- 0 si le réplica abonné n'a pas été créé.




**`<Répertoire du Réplica Maître> : (Chaîne de caractères)`**

Répertoire où le fichier de description du Réplica Maître (fichier RPM) a été créé (fonction [HCréeRéplicaMaître](../WDLang4/3044175.md)). Ce répertoire peut être un répertoire réseau ou un chemin UNC. 
Si ce paramètre correspond à une chaîne vide (""), le fichier de description sera recherché dans le répertoire en cours des fichiers de données HFSQL (défini sous l'éditeur d'analyses ou par programmation). 
**Attention** : ce répertoire doit être accessible lors de l'exécution de la fonction **HCréeRéplicaAbonné**.

**`<Répertoire du Réplica Abonné> : (Chaîne de caractères)`**

Répertoire où le fichier de description du Réplica Abonné doit être créé. Ce fichier a pour nom **Replica_&lt;Identifiant&gt;.RPL**. 
Si ce paramètre correspond à une chaîne vide (""), le fichier de description sera créé dans le répertoire en cours des fichiers de données HFSQL (défini sous l'éditeur d'analyses ou par programmation).

**`<Identifiant> : (Entier ou chaîne de caractères optionnel)`**

Identifiant du Réplica Abonné. Cet identifiant pourra être utilisé par la fonction [hCréeRéplicaTransportable](../WDLang4/3044209.md). 
Si ce paramètre correspond à une chaîne vide (""), un identifiant est automatiquement renvoyé par la fonction. Si l'identifiant spécifié existe déjà, une erreur WLangage est générée.

**`<Taille de la plage des identifiants> : (Entier optionnel)`**

Taille de la plage des numéros d'identifiants automatiques réservés pour ce réplica. Ces identifiants seront utilisés pour tous les nouveaux enregistrements créés par ce réplica. 

- Si ce paramètre n'est pas spécifié, la taille de la plage d'identifiants réservés est de 1 milliard. 

- Si ce paramètre vaut 0, aucune plage d'identifiants automatiques n'est réservée.  






<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Réplication journalée : Répertoires de création des fichiers nécessaires à la réplication et à la journalisation
<a name="replication_journalee_repertoires_creation_des_fichiers_necessaires_replication_journalisation_ELTPARAGRAPHE000182"></a>La réplication journalée est étroitement liée à la journalisation. Lors de la mise en place de la réplication dans une application, la journalisation est automatiquement activée.

Pour tous les fichiers manipulés (fichiers de données, fichiers journal ou fichiers de la réplication), il est possible de définir les différents chemins des fichiers physiques correspondant aussi bien sous l'éditeur d'analyses que par programmation.

Par défaut, l'arborescence des fichiers est la suivante (exemple pour l'application GesCom) :

![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Replic_repertoire.gif)


Le tableau ci-dessous présente la valeur par défaut de ces différents répertoires et leur mode de configuration aussi bien sous l'éditeur d'analyses que par programmation.

|   | Valeur par défaut | Où le configurer sous l'éditeur d'analyses ? | Comment changer la valeur par défaut par programmation ? |
| --- | --- | --- | --- |
| **Répertoire des fichiers de données** | Répertoire de l'exécutable. | <br><br>- Pour tous les fichiers de données de l'application : onglet "Détail" de la description de l'analyse<br><br>- Pour chaque fichier de données : onglet "Info" de la description du fichier de données.<br><br><br> | Pour modifier le répertoire par défaut des fichiers de données de l'application, utilisez la fonction [HSubstRep](../WDLang4/3044028.md).<br>Lors de la création des fichiers de la journalisation et de la réplication, les répertoires créés seront relatifs à ce nouveau répertoire.<br>Remarque : Pour modifier uniquement le répertoire d'un des fichiers de données, utilisez la fonction [HChangeRep](../WDLang4/3044168.md). |
| **Répertoire des fichiers de la réplication** | Sous-répertoire RPL du répertoire par défaut des fichiers de données. | Onglet "Journal\\Réplica" de la description de l'analyse. | Précisez le répertoire voulu dans les fonctions [HCréeRéplicaMaître](../WDLang4/3044175.md) et [HCréeRéplicaAbonné](../WDLang4/3044253.md). |
| **Répertoire des fichiers de la journalisation** | Sous-répertoire JNL du répertoire par défaut des fichiers de données. | <br><br>- Pour tous les fichiers de données de l'application : onglet "Journal\\Réplica" de la description de l'analyse.<br><br>- Pour chaque fichier de données : onglet "Divers" de la description du fichier de données.<br><br><br> | Pour modifier le répertoire des fichiers journaux, utilisez la fonction [HChangeRepJNL](../WDLang4/3044164.md).<br> Cette fonction permet :<br><br>- soit de changer le répertoire du fichier Journal (Fichier JNL)<br><br>- soit de changer le répertoire du fichier JNL et des fichiers de journalisation (fichiers JournalIdentification et JournalOpération).<br><br><br> |


**Attention** : Pour gérer la réplication journalée dans une application, la table des opérations du journal (fichier JournalOpération.fic) doit être identique pour tous les fichiers de données en réplication dans une même analyse.

<a name="XComposante"></a>

## Classification Métier / UI :
Code métier
## Composante :
wd280rpl.dll
