


## Les clés composées
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000400"></a>
Une clé composée est une rubrique clé composée de plusieurs autres rubriques. Ces rubriques peuvent être des rubriques texte ou numérique.

Une clé composée permet de simplifier les recherches effectuées simultanément sur plusieurs critères.

Les clés composées sont des rubriques binaires. Leur valeur ne peut pas être affichée directement (dans une trace ou dans un champ).

Les thèmes abordés dans cette page sont les suivants :

- [Créer une clé composée](#NOTE2_1)

- [Valeur d'une clé composée](#NOTE3_1)

- [Utiliser une clé composée pour réaliser des recherches à l'identique](#NOTE4_1)

- [Utiliser une clé composée pour réaliser des recherches génériques](#NOTE5_1)

- [Utiliser une clé composée pour réaliser des filtres](#NOTE6_1)






<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Créer une clé composée
<a name="creer_une_cle_composee_ELTTEXTE000424"></a>
La création d'une clé composée est réalisée directement sous l'éditeur d'analyses.

Pour créer une clé composée dans la description d'un fichier de données :

1. Affichez la description des rubriques du fichier de données : 

	- Sélectionnez le fichier de données sous l'éditeur. 

	- Affichez le menu contextuel (clic droit) et sélectionnez l'option "Description des rubriques".




2. Cliquez sur l'icône ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Manipulations_rubriques%20-%20HC%20N%B0001%207.gif). Un écran permettant de construire la clé composée apparaît.

3. Dans le tableau de gauche, la liste des rubriques existantes dans le fichier de données apparaît. Double-cliquez sur les rubriques devant participer à la clé composée. Ces rubriques apparaissent dans le tableau de droite.

4. Ré-organisez si nécessaire les rubriques composant la clé composée. 
	**Attention** : l'ordre des rubriques est très important car il détermine l'ordre de tri. Ainsi, la clé composée "Nom + Département" sera triée sur le nom puis sur le département.

5. Spécifiez le sens de parcours et les paramètres de recherche pour chaque composant de la clé.

6. Validez. La clé composée apparaît dans la liste des rubriques du fichier de données.



<a name="NOTE2_2"></a>


### Clé composée et liaison
<a name="cle_composee_liaison_ELTPARAGRAPHE000071"></a>Il est possible d'utiliser des clés composées dans des liaisons entre fichiers de données. Lors de la description de l'analyse, la clé composée présente dans le fichier de données lié apparaît alors non plus comme une clé composée mais comme une ***clé binaire***. Il ne sera pas possible d'accéder aux différentes composantes de la clé composée dans le fichier de données relié.

**Remarques** : 

- La gestion de l'intégrité référentielle est gérée sur une clé de liaison de type clé composée.

- La gestion des modifications en cascade n'est pas gérée sur une clé de liaison de type clé composée. 




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Valeur d'une clé composée
<a name="valeur_une_cle_composee_ELTTEXTE000454"></a>


### Présentation
<a name="presentation_ELTPARAGRAPHE000085"></a>Une clé composée est stockée sous forme de chaîne binaire. Sa valeur ne peut pas être affichée (ni dans un champ, ni sous le débogueur, ...).
<a name="NOTE3_2"></a>


### Ajout d'un enregistrement contenant une clé composée
<a name="ajout_enregistrement_contenant_une_cle_composee_ELTPARAGRAPHE000092"></a>Lors de l'ajout ou de la modification d'un enregistrement contenant une clé composée, la valeur de la clé composée est automatiquement définie en fonction des valeurs des différentes composantes de la clé. Aucune programmation spécifique n'est nécessaire.
<a name="NOTE3_3"></a>


### Ajout d'un enregistrement contenant une clé composée dans un fichier de données relié
<a name="ajout_enregistrement_contenant_une_cle_composee_dans_fichier_donnees_relie_ELTPARAGRAPHE000099"></a>Lors de l'ajout d'un enregistrement contenant une clé composée dans un fichier de données relié, il est nécessaire de construire la valeur de la clé. En effet, dans le fichier de données relié, la clé composée n'est pas considérée comme une clé composée, mais comme une clé binaire. Il est donc nécessaire de lui affecter une valeur.

Cette valeur peut être affectée :

- soit directement. Par exemple, un enregistrement a été ajouté dans le fichier de données Client. Pour ajouter la valeur de la clé dans le fichier de données relié, il suffit de réaliser une affectation directe : 
	
	```wl
	FichierLiaison.NomDate = Client.NomDate
	```


- soit à l'aide de la fonction [HConstruitValClé](../WDLang4/3044258.md). Cette fonction permet de construire la valeur de la clé composée à partir de ses composantes.



<a name="NOTE3_4"></a>


### Construire la valeur d'une clé composée pour réaliser une recherche ou un filtre
<a name="construire_valeur_une_cle_composee_pour_realiser_une_recherche_filtre_ELTPARAGRAPHE000116"></a>Lors de la réalisation d'un filtre ou d'une recherche sur une clé composée, il est nécessaire de définir la valeur de la clé composée (par exemple pour définir les bornes minimales et maximales du filtre).

Plusieurs solutions sont à votre disposition pour construire la valeur d'une clé composée pour une recherche ou un filtre :

- Méthode 1 : Utilisation d'une liste de valeurs dans la fonction [HFiltre](../WDLang4/3044100.md).

- Méthode 2 : Utilisation de l'instruction [POUR TOUT](../Motscles/1510013.md).

- Méthode 3 : Utilisation de la fonction [HConstruitValClé](../WDLang4/3044258.md).

- Méthode 4 : Utilisation de la fonction [HConvertX](../WDLang4/3044260.md) (méthode conservée pour compatibilité avec WINDEV 5.5)




**Méthode 1 : Liste de valeurs**

Il suffit d'indiquer la liste des valeurs que chaque composante de la clé composée doit prendre pour le filtre ou pour la recherche. La clé composée est donc construite directement dans la syntaxe de la fonction de filtre ou de recherche.

**Exemple** : Recherche de tous les enregistrements du fichier de données Client dont le nom et le prénom sont compris entre "AA","Barnabé" et "Philomène" et "Tartuffe".

```wl
HFiltre(Client, NomPrenom, ["AA","Philomène"], ["Barnabé","Tartuffe"])
```
Dans cet exemple, "AA","Zorro" est renvoyé par le filtre alors que "Philomène","Zorro" n'est pas renvoyé.

**Exemple** : Recherche de tous les enregistrements du fichier de données Taches dont les tâches sont comprises entre le 15/03/2011 00h00 et le 25/03/2011 00h00.

```wl
HFiltre(Taches, DateDébutTacheHeureDébutTache, [20110315,0000], [20110325,0000])
```


**Méthode 2 : Utilisation de l'instruction POUR TOUT**

Il suffit d'indiquer la liste des valeurs que chaque composant de la clé composée doit prendre pour le filtre ou pour la recherche. La clé composée est donc construite directement dans la syntaxe de la fonction de filtre ou de recherche.

**Exemple** : Recherche des clients de type prospects habitant dans le département du Rhône.

```wl
POUR TOUT Contacts AVEC CCDépartement = ["Prospect", 69]
...
FIN
```


**Méthode 3 : Utilisation de la fonction HConstruitValClé**

Il est possible de construire la valeur d'une clé composée avec la fonction [HConstruitValClé](../WDLang4/3044258.md). Il suffit de préciser dans cette fonction, le fichier de données concerné, le nom de la clé et les valeurs des composantes.

Par exemple, pour construire la valeur de la clé composée "NOMDATE" correspondant à "NOMCLIENT+DATE_ENTREE" du fichier de données Client, il suffit d'utiliser la ligne de code :

```wl
HConstruitValClé(Client, NOMDATE, "MOULIN","03/11/85")
```


**Méthode 4 : Utilisation de la fonction HConvertX (méthode conservée pour compatibilité avec WINDEV 5.5)**

Il est nécessaire de :

- compléter les composantes texte sur toute leur taille avec la constante *hValMin*.

- convertir les composantes numériques grâce à la fonction [HConvert](../WDLang4/3044260.md).




Exemple :

```wl
MaCléComposée = Complète(Client.NomClient, Dimension(Client.Nom), hValMin)) + ...
	Complète(Client.Prénom, Dimension (Client.Prénom), hValMin)
```

<a name="NOTE3_5"></a>


### Propriétés WLangage permettant de manipuler les clés composées
<a name="proprietes_wlangage_permettant_manipuler_les_cles_composees_ELTPARAGRAPHE000183"></a>Les principales propriétés permettant de manipuler les clés composées par programmation sont les suivantes :



|   |   |
| --- | --- |
| [Binaire](../Proprietes/2512001.md) | La propriété **Binaire** permet de savoir si une rubrique est de type binaire ou non. |
| [CléComposée](../Proprietes/2512004.md) | La propriété **CléComposée** permet de savoir si une rubrique est une clé composée. |
| [Composante](../Proprietes/2512020.md) | La propriété **Composante** permet de paramétrer les différentes composantes d'une clé composée. |
| [FormuleClé](../Proprietes/2512035.md) | La propriété **FormuleClé** permet de paramétrer les différentes composantes d'une clé composée. |
| [NbComposante](../Proprietes/2512058.md) | La propriété **NbComposante** permet de connaître le nombre d'éléments d'une clé composée. |





<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Utiliser une clé composée pour réaliser des recherches à l'identique
<a name="utiliser_une_cle_composee_pour_realiser_des_recherches_identique_ELTTEXTE000529"></a>


### Recherche à l'identique avec HLitRecherchePremier
<a name="recherche_identique_avec_hlitrecherchepremier_ELTPARAGRAPHE000193"></a>Pour effectuer une recherche à l'identique sur la valeur d'une clé composée, il faut :

1. Construire la valeur de la clé à rechercher avec la fonction [HConstruitValClé](../WDLang4/3044258.md). Toutes les valeurs des composants de la clé doivent être indiquées.

2. Utiliser la fonction [HLitRecherchePremier](../WDLang4/3044036.md).




**Remarque** : Par défaut, la fonction [HLitRecherchePremier](../WDLang4/3044036.md) permet de réaliser une recherche à l'identique.

```wl
ValCléComp est un Buffer
ValCléComp = HConstruitValClé(Client, Nom_CP, "Moulin", "34000")
HLitRecherchePremier(Client, Nom_CP, ValCléComp)
TANTQUE HTrouve() = Vrai
	...
	HLitSuivant(Client, Nom_CP)
FIN
```

<a name="NOTE4_2"></a>


### Recherche à l'identique et HLitRecherche
<a name="recherche_identique_hlitrecherche_ELTPARAGRAPHE000215"></a>Pour effectuer une recherche à l'identique sur la valeur d'une clé composée, il faut :

1. Construire la valeur de la clé à rechercher avec la fonction [HConstruitValClé](../WDLang4/3044258.md). Toutes les valeurs des composants de la clé doivent être indiquées.

2. Utiliser la fonction [HLitRecherche](../WDLang4/3044050.md) avec la constante ***hIdentique***.




Remarque : Par défaut, la fonction [HLitRecherche](../WDLang4/3044050.md) permet de réaliser une recherche générique. Pour réaliser une recherche à l'identique, il faut spécifier la constante *hIdentique*.

```wl
ValCléComp est un Buffer
ValCléComp = HConstruitValClé(Client, Nom_CP, "Moulin", "34000")
HLitRecherche(Client, Nom_CP, ValCléComp, hIdentique)
TANTQUE HTrouve() = Vrai
	...
	HLitSuivant(Client, Nom_CP)
FIN
```


<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Utiliser une clé composée pour réaliser des recherches génériques
<a name="utiliser_une_cle_composee_pour_realiser_des_recherches_generiques_ELTTEXTE000559"></a>


### Recherche générique avec HLitRecherchePremier
<a name="recherche_generique_avec_hlitrecherchepremier_ELTPARAGRAPHE000239"></a>Pour effectuer une recherche générique sur la valeur d'une clé composée, il faut :

1. Construire la valeur de la clé à rechercher avec la fonction [HConstruitValClé](../WDLang4/3044258.md). Seules les valeurs des premiers composants de la clé peuvent être indiquées.

2. Utiliser la fonction [HLitRecherchePremier](../WDLang4/3044036.md) avec la constante ***hGénérique***.




**Remarque** : Par défaut, la fonction [HLitRecherchePremier](../WDLang4/3044036.md) permet de réaliser une recherche à l'identique. Pour réaliser une recherche générique, il suffit de préciser la constante ***hGénérique***.

```wl
ValCléComp est un Buffer
ValCléComp = HConstruitValClé(Client, Nom_CP, "Moulin")
HLitRecherchePremier(Client, Nom_CP, ValCléComp, hGénérique)
TANTQUE HTrouve() = Vrai
	...
	HLitSuivant(Client, Nom_CP)
FIN
```

<a name="NOTE5_2"></a>


### Recherche générique avec HLitRecherche
<a name="recherche_generique_avec_hlitrecherche_ELTPARAGRAPHE000261"></a>Pour effectuer une recherche générique sur la valeur d'une clé composée, il faut :

1. Construire la valeur de la clé à rechercher avec la fonction [HConstruitValClé](../WDLang4/3044258.md). Seules les valeurs des premiers composants de la clé peuvent être indiquées.

2. Utiliser la fonction [HLitRecherche](../WDLang4/3044050.md).




Remarque : Par défaut, la fonction [HLitRecherche](../WDLang4/3044050.md) permet de réaliser une recherche générique. Pour réaliser une recherche à l'identique, il faut spécifier la constante *hIdentique*.

```wl
ValCléComp est un Buffer
ValCléComp = HConstruitValClé(Client, Nom_CP, "Moulin")
HLitRecherche(Client, Nom_CP, ValCléComp)
TANTQUE HTrouve() = Vrai
	...
	HLitSuivant(Client, Nom_CP)
FIN
```


<a name="NOTE6"></a>
<a name="NOTE6_1"></a>


## Utiliser une clé composée pour réaliser des filtres
<a name="utiliser_une_cle_composee_pour_realiser_des_filtres_ELTTEXTE000589"></a>


### Fonctions disponibles pour réaliser des filtres
<a name="fonctions_disponibles_pour_realiser_des_filtres_ELTPARAGRAPHE000285"></a>En plus de la fonction [HFiltre](../WDLang4/3044100.md), le WLangage propose différentes fonctions permettant de réaliser des filtres spécifiques. Ces fonctions peuvent manipuler des clés composées :



|   |   |
| --- | --- |
| [HFiltre](../WDLang4/3044100.md) | Définit et active un filtre sur un fichier de données, une vue ou une requête. |
| [HFiltreCommencePar](../WDLang4/3044098.md) | Définit et active un filtre de type "Commence par" sur un fichier, une vue ou une requête. |
| [HFiltreComprisEntre](../WDLang4/3044097.md) | Définit et active un filtre de type "Compris entre" sur un fichier, une vue ou une requête. |
| [HFiltreIdentique](../WDLang4/3044105.md) | Définit et active un filtre permettant de rechercher la valeur exacte d'une rubrique de type chaîne. |




<a name="NOTE6_2"></a>


### Filtre entre deux valeurs données (deux bornes)
<a name="filtre_entre_deux_valeurs_donnees_deux_bornes_ELTPARAGRAPHE000296"></a>Pour filtrer les enregistrements entre deux valeurs spécifiques d'une clé composée, il faut :

1. Créer les valeurs de chacune des bornes avec la fonction [HConstruitValClé](../WDLang4/3044258.md).

2. Créer le filtre avec la fonction [HFiltre](../WDLang4/3044100.md) en précisant les deux bornes.

3. Parcourir les enregistrements sélectionnés.



```wl
sCléFiltre1 = HConstruitValClé(CLIENT, NOM_CP, "MOULIN", "34000")
sCléFiltre2 = HConstruitValClé(CLIENT, NOM_CP, "MOULIN", "34999")
sCléParcours = HFiltre(Client, NOM_CP, sCléFiltre1, sCléFiltre2)
HLitPremier(Client, sCléParcours)
TANTQUE Pas HEnDehors()
	...
	HLitSuivant(Client, sCléParcours)
Fin
```

<a name="NOTE6_3"></a>


### Filtre à partir d'une valeur donnée
<a name="filtre_partir_une_valeur_donnee_ELTPARAGRAPHE000315"></a>Pour filtrer les enregistrements à partir d'une valeur donnée (sans préciser de borne maximale), il faut : 

1. Créer la valeur de la borne minimale avec la fonction [HConstruitValClé](../WDLang4/3044258.md).

2. Créer le filtre avec la fonction [HFiltre](../WDLang4/3044100.md) en précisant la borne minimale et la borne maximale. Dans ce cas, la borne maximale est égale à la constante *hValMax*.

3. Parcourir les enregistrements sélectionnés.



```wl
sCléFiltre = HConstruitValClé(CLIENT, NOM_CP, "MOULIN", "34000")
sCléParcours = HFiltre(Client, NOM_CP, sCléFiltre, hValMax)
HLitPremier(Client, sCléParcours)
TANTQUE Pas HEnDehors()
	...
	HLitSuivant(Client, sCléParcours)
FIN
```

<a name="NOTE6_4"></a>


### Filtre sur les premiers composants de la clé
<a name="filtre_sur_les_premiers_composants_cle_ELTPARAGRAPHE000334"></a>Pour filtrer les enregistrements sur les premiers composants d'une clé composée et réaliser un tri sur les composants suivants, il faut :

1. Créer les valeurs minimales et maximales de la clé composée avec la fonction [HConstruitValClé](../WDLang4/3044258.md). Seules les premières composantes peuvent être indiquées.

2. Créer le filtre avec la fonction [HFiltre](../WDLang4/3044100.md) en précisant la borne minimale et la borne maximale. Dans ce cas, il faut ajouter la constante *hValMin* à la borne minimale et *hValMax* à la borne maximale. Remarques : *hValMin* est équivalent à Caract(0) et *hValMax* est équivalent à caract(255).

3. Parcourir les enregistrements sélectionnés.



<a name="NOTE6_5"></a>


### Remarque : Filtre avec condition de sélection
<a name="remarque_filtre_avec_condition_selection_ELTPARAGRAPHE000351"></a>Si la condition du filtre porte sur plusieurs rubriques correspondant à une clé composée du fichier de données, la clé de parcours automatiquement choisie pour le filtre sera cette clé composée.


