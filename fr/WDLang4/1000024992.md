


## &lt;Source&gt;.ImporteTexte (Fonction)

***En anglais : &lt;Source&gt;.ImportText***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Importe un fichier Texte dans un fichier de données au format HFSQL Classic ou Client/Serveur (fichier de données décrit sous l'éditeur d'analyses, ou déclaré par les fonctions [&lt;Source&gt;.Déclare](../WDLang4/1000024213.md), [&lt;Source&gt;.DéclareExterne](../WDLang4/1000024214.md) ou [&lt;Source&gt;.DécritFichier](../WDLang4/1000024215.md)).

**Remarque** : Si le fichier de données HFSQL manipulé n'existe pas physiquement, ce fichier de données est automatiquement créé.


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Importe le nom, l'adresse et le logo (mémo binaire) des clients.
// On réinitialise les autres rubriques.
// Une ligne du fichier d'importation contient donc 3 ou 5 colonnes :
// - Nom, - Adresse, - Nom du fichier pour le logo
// (si le nom du fichier pour le logo est différent
// de chaîne vide, 2 colonnes supplémentaires)
// - Le type du mémo (IMG), - Un commentaire
SI Client.ImporteTexte("C:\UnExemple\Client.txt", ...
			"NOM,ADRESSE,LOGO", hValDéfaut, "Jauge1") = Faux ALORS
	Erreur("Importation impossible")
SINON
	// Traitement
FIN
```
<a name="Exemple2"></a>
<a name="3044011_Exemple2"></a>

```wl
// Ce fichier sera importé
sCheminFichierTexte est une chaîne = "ImportJoueur.txt"

// Contenu de ce fichier (2 lignes) :
// "JoueurImport1","19850618"
// "JoueurImport2","19900512"

// sNomJoueur et dDateNaissance sont 2 rubriques du fichier Joueur de type chaîne et Date

SI Joueur.ImporteTexte(sCheminFichierTexte, "sNomJoueur,dDateNaissance", ...
    "," + Caract(127) + """" + Caract(127) + RC + Caract(127) + ".") ALORS
	...
SINON
	...
FIN
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = <Source>.ImporteTexte(<Chemin complet du fichier texte> , <Liste des rubriques> , <Séparateurs> [, <Options> [, <Jauge>]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'opération a été réalisée, 

- <u><u><u><u>Faux</u></u></u></u> en cas d'erreur. La fonction [HErreur](../WDLang4/3044088.md) permet d'obtenir plus d'informations sur le problème rencontré.




**`<Source> : (Type correspondant à la source spécifiée)`**

Nom du fichier de données au format HFSQL dans lequel l'importation doit être réalisée.

**`<Chemin complet du fichier texte> : (Chaîne de caractères)`**

Chemin d'accès complet au fichier texte à importer.

**`<Liste des rubriques> : (Chaîne de caractères)`**

Liste des noms des rubriques du fichier texte. Les noms peuvent être délimités par des simples quotes et sont séparés par des virgules ou RC. Les noms des rubriques de type clé composées sont ignorées.

Si ce paramètre n'est pas précisé ou correspond à une chaîne vide (""), toutes les rubriques sont importées (sauf les clés composées) dans l'ordre physique de description.

**`<Séparateurs> : (Chaîne de caractères)`**

Liste des séparateurs utilisés pour les colonnes, les chaînes, les lignes et les décimales.
Les différents séparateurs sont séparés par le caractères caract(127) (pour compatibilité avec WINDEV 5.5). 
```txt
<Séparateur de colonnes> + Caract(127) + <Séparateur de chaînes> + Caract(127) + 
<Séparateur de lignes> + Caract(127) +<Séparateur de décimales>
```


- &lt;Séparateur de colonnes&gt; : Chaîne de caractères (par défaut ",").

- &lt;Séparateur de chaînes&gt; : Caractère (par défaut ")

- &lt;Séparateur de lignes&gt; : Chaîne de caractères (par défaut RC, c'est-à-dire Caract(13)+Caract(10))

- &lt;Séparateur de décimales&gt; : Caractère (par défaut "." ou ",")




**`<Options> : (Constante ou combinaison de constantes de type Entier (optionnel))`**

Paramètre le type d'importation à effectuer :


|   |   |
| --- | --- |
| *hCopieIDAuto* | L'identifiant automatique est recopié. Il n'est pas recalculé. |
| *hImpCréation* | Si le fichier de données d'importation existe, il est écrasé. |
| *hImpIgnorePremièreLigne* | La première ligne du fichier importé est ignorée. |
| *hImpIgnoreLigneInvalide* | Les lignes dont la structure est invalide ne sont pas importées : l'importation continue sur les lignes suivantes. <br>La structure est invalide si il manque des données pour une ou plusieurs rubriques, ou s'il manque des séparateurs de chaîne. |
| *hImpIgnoreRubriqueVide* | Si une ou plusieurs rubriques ne sont pas renseignées dans le fichier texte, les lignes correspondantes sont quand même importées.<br>Les rubriques manquantes contiennent :<br><br>- soit la valeur par défaut des rubriques si la constante *hValDéfaut* est spécifiée.<br><br>- soit la valeur des rubriques dans l'enregistrement en cours avant l'appel de la fonction **&lt;Source&gt;.ImporteTexte**.<br><br><br> |
| *hImpInterruptible* | L'importation peut être interrompue avec la touche Echap du clavier (paramètre non pris en compte sur des fichiers de données au format 5.5). <br>Si l'importation est interrompue, les enregistrements importés sont conservés dans le fichier de données. Une ré-indexation (non interruptible) est automatiquement réalisée si nécessaire. |
| *hImpNormal*<br>(valeur par défaut) | Si le fichier de données d'importation existe déjà, il est complété avec les données importées, sinon le fichier de données est créé.<br>Pas de gestion d'intégrité ni de gestion de doublons.<br>Les rubriques non importées prennent la valeur de l'enregistrement en cours.<br>Les délimiteurs de chaînes sont utilisés.<br>Les identifiants automatiques sont recalculés.<br>![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) La gestion de l'intégrité et des doublons est toujours activée. |
| *hImpOEMVersANSI* | Les chaînes importées sont automatiquement converties d'OEM vers ANSI. |
| *hImpSansDélimiteur* | Les séparateurs de chaînes, s'ils existent, font partie de la rubrique. |
| *hImpTestDoublon* | Active la gestion des doublons sur les clés uniques lors de l'importation (la gestion des doublons est activée uniquement sur les clés uniques et non sur l'enregistrement complet).<br>![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) La gestion des doublons est toujours activée. |
| *hImpTestIntégrité* | Teste l'intégrité lors de l'importation.<br>![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) La gestion de l'intégrité est toujours activée. |
| *hValDéfaut* | Pour les rubriques non importées, les valeurs de l'enregistrement en cours sont réinitialisées :<br><br>- soit avec leur valeur par défaut si la constante *hValDéfaut* est spécifiée.<br><br>- soit avec la valeur des rubriques correspondantes dans l'enregistrement en cours avant l'appel de la fonction **&lt;Source&gt;.ImporteTexte** si la constante *hValDéfaut* n'est pas spécifiée.<br><br><br> |



**`<Jauge> : (Nom de champ ou nom de fenêtre optionnel)`**



- Nom de la fenêtre dans laquelle la jauge doit être affichée, 

- Nom du champ de type Jauge utilisé pour afficher la progression.






<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Importation d'une rubrique de type mémo texte
<a name="importation_une_rubrique_type_memo_texte_ELTPARAGRAPHE000381"></a>

- Constante *hImpSansDelimiteur* non précisée : 
	Le texte à importer peut contenir des &lt;Séparateur de lignes&gt; ou des &lt;Séparateur de colonnes&gt;. Le texte à importer ne peut pas contenir de &lt;Séparateur de chaînes&gt;.

- Constante *hImpSansDelimiteur* précisée :
	Le texte à importer ne peut pas contenir des &lt;Séparateur de lignes&gt; ou des &lt; Séparateur de colonnes&gt; sinon ils seront pris en compte en tant que tels. Le texte à importer peut contenir des &lt;Séparateur de chaînes&gt;.



<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Importation d'une rubrique de type mémo binaire
<a name="importation_une_rubrique_type_memo_binaire_ELTPARAGRAPHE000398"></a>Pour un rubrique de type mémo binaire, 3 colonnes sont associées dans le fichier texte.

- ** Colonne 1** : chemin complet du fichier binaire à ajouter au mémo. C'est une chaîne de caractères. Si cette chaîne est vide alors les deux colonnes suivantes ne doivent pas être précisées dans le fichier texte.

- ** Colonne 2** : type du mémo. C'est une chaîne de caractères qui vaut :

	- "IMG" pour indiquer que le fichier est de type image.

	- "WAV" pour indiquer que le fichier est de type son.

	- "OLE" pour indiquer que le fichier  est de type OLE.

	- "BIN" ou autre pour indiquer que le fichier est un fichier binaire quelconque.




- ** Colonne 3** : message d'information. C'est une chaîne de caractères (65535 caractères maximum. Si plus grand, la chaîne est tronquée).




**Structure du fichier texte à importer :**

Soit les rubriques suivantes à importer : 

- &lt;NOM&gt; : rubrique texte

- &lt;AGE&gt; : rubrique numérique

- &lt;PRENOM&gt; : rubrique texte

- &lt;COMMENTAIRE&gt; : mémo texte

- &lt;PHOTO&gt; : mémo binaire image


Soit les délimiteurs suivants utilisés : 

- &lt;Séparateur de chaîne&gt; : "

- &lt;Séparateur de colonne&gt; : ,

- &lt;Séparateur de ligne&gt; : RC




Si la constante *hImpSansDelimiteur* est non précisée : "NOM", AGE, "PRENOM", "COMMENTAIRE", "fichier du mémo PHOTO", "type du fichier PHOTO", "info du mémo PHOTO"+RC

Si la constante *hImpSansDelimiteur* est précisée : NOM, AGE, PRENOM, COMMENTAIRE, fichier du mémo PHOTO, type du mémo PHOTO, info du mémo PHOTO+RC

Chaque contenu peut être vide.
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Importation d'une rubrique indicée
<a name="importation_une_rubrique_indicee_ELTPARAGRAPHE000441"></a>La fonction **&lt;Source&gt;.ImporteTexte** ne permet pas d'importer des rubriques indicées.
<a name="NOTE0_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Procédures stockées](https://doc.pcsoft.fr/ext/images/fr/PS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Importation d'une rubrique de type Heure
<a name="importation_une_rubrique_type_heure_ELTPARAGRAPHE000456"></a>La fonction **&lt;Source&gt;.ImporteTexte** enregistre des heures non valides si les heures à importer ne sont pas dans un des formats disponibles dans l'analyse.

Rappel : les formats disponibles dans l'analyse sont :

- HH

- HHMM

- HHMMSS

- HHMMSSCC




<a name="XComposante"></a>

## Composante :
wd280hf.dll
