


## &lt;Source&gt;.DupliqueEnregistrement (Fonction)

***En anglais : &lt;Source&gt;.DuplicateRecord***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Duplique l'enregistrement lu dans un fichier de données : l'enregistrement présent en mémoire est ajouté dans le fichier de données (la requête ou la vue). Les index correspondant à toutes les clés utilisées dans le fichier de données sont mis à jour automatiquement. Les mémos éventuels sont ajoutés si la gestion des mémos est active (fonction [&lt;Source&gt;.GèreMémo](../WDLang4/1000024987.md)).

Après l'exécution de la fonction **&lt;Source&gt;.DupliqueEnregistrement** :

- Une gestion automatique des erreurs est disponible pour plusieurs types d'erreurs : Erreur de doublons, Erreur d'intégrité, Erreur de mot de passe, Erreur de conflit de modification et d'état lors du conflit de modification, Erreur de blocage, ... Pour plus de détails, consultez [Gestion assistée des erreurs HFSQL](../WDLang4/3044188.md).

- Si la gestion des doublons est activée et si le fichier de données contient une clé unique, la fonction [HErreurDoublon](../WDLang4/3044077.md) renvoie <u><u><u>Vrai</u></u></u> si la valeur de la clé ajoutée n'est pas unique. L'enregistrement n'est pas ajouté.

- L'enregistrement ajouté devient l'enregistrement en cours. L'identifiant automatique est automatiquement renseigné. Par défaut, le parcours en cours n'est pas affecté.




**Note** : La totalité de l'enregistrement en mémoire (le contenu de l'enregistrement précédemment lu) est écrit dans le fichier de données. 

Remarques : 

- Cette fonction peut être utilisée également sur une vue ou sur une requête.

- La fonction **&lt;Source&gt;.DupliqueEnregistrement** est identique à la fonction [&lt;Source&gt;.Ajoute](../WDLang4/1000024187.md).





<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Duplique l'enregistrement en cours
Client.DupliqueEnregistrement()
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = <Source>.DupliqueEnregistrement([<Options>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'enregistrement a été ajouté, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème (erreur d'intégrité, de doublons, ...). La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur.




**`<Source> : (Type correspondant à la source spécifiée)`**

Nom du fichier de données, de la vue ou de la requête manipulé. 

**`<Options> : (Constante optionnelle)`**

Permet de paramétrer :

- l'influence de l'ajout sur le parcours en cours.

- le mode de calcul de l'identifiant automatique. Pour plus de détails, consultez [Gestion de l'identifiant automatique lors d'un ajout](../WDLang4/3044183.md).

- le mode de blocage de l'enregistrement ajouté.

	- ![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : La gestion des blocages n'est pas disponible sur les bases de données accédées par JDBC.




- la gestion des doublons.

- la gestion de l'intégrité.


![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) Ce paramètre n'est pas pris en compte.


|   |   |
| --- | --- |
| *hAffecteParcours* | **Influence de l'ajout sur le parcours** : L'ajout affecte le parcours. <br>Par exemple, la fonction [&lt;Source&gt;.LitSuivant](../WDLang4/1000025035.md) utilisée après la fonction **&lt;Source&gt;.DupliqueEnregistrement** positionne sur l'enregistrement suivant l'enregistrement ajouté.<br>La constante *hAffecteParcours* est prioritaire sur la constante *hEcritureDéfaut*. |
| *hBlocageEcriture* | **Mode de blocage de l'enregistrement ajouté** : Blocage en écriture : l'enregistrement ajouté sera bloqué en écriture. Cet enregistrement pourra être lu par une autre application mais ne pourra pas être modifié par une autre application. Seule l'application en cours pourra le modifier ou le débloquer.<br><br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Cette constante n'est pas disponible. |
| *hBlocageLectureEcriture* | **Mode de blocage de l'enregistrement ajouté** : Blocage en lecture/écriture : l'enregistrement ajouté sera bloqué en lecture et en écriture. Cet enregistrement ne pourra ni être lu ni être modifié par une autre application. Seule l'application en cours pourra le modifier, le lire ou le débloquer.<br><br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Cette constante n'est pas disponible. |
| *hBlocageNon* (valeur par défaut) | **Mode de blocage de l'enregistrement ajouté** : Aucun blocage : l'enregistrement ajouté ne sera pas bloqué.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Cette constante n'est pas disponible. |
| *hEcritureDéfaut*<br>(valeur par défaut) | **Influence de l'ajout sur le parcours** : L'ajout n'affecte pas le parcours en cours. <br>Par exemple, la fonction [&lt;Source&gt;.LitSuivant](../WDLang4/1000025035.md) utilisée après la fonction **&lt;Source&gt;.DupliqueEnregistrement** positionne sur l'enregistrement suivant l'enregistrement en cours avant l'ajout.<br>La constante *hAffecteParcours* est prioritaire sur la constante *hEcritureDéfaut*. |
| *hFixeIDAuto* | **Mode de calcul de l'identifiant automatique** : L'identifiant automatique n'est pas calculé lors de l'ajout : la valeur de l'identifiant sera celle mémorisée au moment de l'ajout. <br><u><u><u><u>La prochaine valeur de l'identifiant calculée par le moteur HFSQL correspondra à la plus grande valeur de l'identifiant dans le fichier +1. </u></u></u></u><br>Si les constantes *hFixeIDAuto* et *hForceIDAuto* sont utilisées en même temps, une erreur WLangage est générée.<br>![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) SQLServer CE : La constante *hFixeIDAuto* ne peut pas être utilisée. |
| *hForceIDAuto* | **Mode de calcul de l'identifiant automatique** : L'identifiant automatique n'est pas calculé lors de l'ajout. L'identifiant correspond :<br><br>- soit à la valeur affectée à la rubrique par programmation (par exemple CLCLEUNIK = 7)<br><br>- soit à la valeur par défaut de l'identifiant spécifiée dans l'éditeur d'analyses (si le fichier de données vient d'être ouvert, sans lecture d'enregistrement)<br><br>- soit à la valeur de l'identifiant présent en mémoire (valeur de l'identifiant pour le dernier enregistrement lu dans le fichier de données).<br><br><br>Après l'ajout de l'enregistrement, le prochain identifiant automatique calculé par défaut par le moteur HFSQL sera calculé sans tenir compte de la valeur ajoutée par *hForceIDAuto*.<br>Si les constantes *hFixeIDAuto* et *hForceIDAuto* sont utilisées en même temps, une erreur WLangage est générée.<br>![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) SQLServer CE : La constante *hForceIDAuto* ne peut pas être utilisée. |
| *hIgnoreDoublon* | **Mode de gestion des doublons** : Ignore le contrôle des doublons pour cette opération, même si le contrôle automatique des doublons est branché (fonction [&lt;Source&gt;.GèreDoublon](../WDLang4/1000024985.md)).<br>Si les constantes *hIgnoreDoublon* et *hVérifieDoublon* sont utilisées en même temps, une erreur WLangage est générée.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Cette constante n'est pas disponible. |
| *hIgnoreIntégrité* | **Mode de gestion de l'intégrité** : Ignore le contrôle d'intégrité sur cette opération d'ajout, même si le contrôle de l'intégrité automatique est branché (fonction [&lt;Variable Connexion&gt;.GèreIntégrité](../WDLang4/1000023960.md)).<br>Si les constantes *hIgnoreIntégrité* et *hVérifieIntégrité* sont utilisées en même temps, une erreur WLangage est générée.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Cette constante n'est pas disponible. |
| *hVérifieDoublon* | **Mode de gestion des doublons** : Contrôle les doublons pour cette opération, même si le contrôle des doublons est débranché (fonction [&lt;Source&gt;.GèreDoublon](../WDLang4/1000024985.md)).<br>Si les constantes *hIgnoreDoublon* et *hVérifieDoublon* sont utilisées en même temps, une erreur WLangage est générée.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Cette constante n'est pas disponible. |
| *hVérifieIntégrité* | **Mode de gestion de l'intégrité** : Contrôle l'intégrité de l'opération, même si le contrôle de l'intégrité automatique est débranché (fonction [&lt;Variable Connexion&gt;.GèreIntégrité](../WDLang4/1000023960.md)).<br>Si les constantes *hIgnoreIntégrité* et *hVérifieIntégrité* sont utilisées en même temps, une erreur WLangage est générée.<br>![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) Accès par JDBC : Cette constante n'est pas disponible. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Gestion des Identifiants automatiques
<a name="gestion_des_identifiants_automatiques_ELTPARAGRAPHE000464"></a>Par défaut, lors de l'ajout d'un enregistrement dans un fichier de données, la rubrique de type "Identifiant automatique" est automatiquement mise à jour. Il n'est pas nécessaire de relire l'enregistrement pour connaître la valeur de l'identifiant automatique. Il suffit d'utiliser la syntaxe &lt;Nom Fichier&gt;.&lt;Nom rubrique Identifiant automatique&gt;.

Les constantes *hForceIDAuto* et *hFixeIDAuto* permettent de modifier le comportement par défaut de l'identifiant automatique.

Pour plus de détails sur la gestion de l'identifiant automatique lors de l'ajout d'un enregistrement, consultez [Gestion de l'identifiant automatique lors d'un ajout](../WDLang4/3044183.md).
![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) **Cas particulier**

- Si la base de données génère un identifiant automatique, le moteur HFSQL conserve cette valeur. Si les constantes *hForceIDAuto* ou *hFixeIDAuto* sont précisées, le moteur HFSQL remplace la valeur générée par la valeur voulue. 
	Remarque : la constante *hForceIDAuto* équivaut à *hFixeIDAuto* : l'identifiant automatique calculé par le moteur HFSQL lors du prochain ajout sera unique dans le fichier de données.

- Si la base de données ne génère pas d'identifiant automatique, le moteur HFSQL génère la valeur et l'affecte à l'identifiant automatique.



<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Réutilisation des enregistrements supprimés ou libérés
<a name="reutilisation_des_enregistrements_supprimes_liberes_ELTPARAGRAPHE000491"></a>Lors de l'ajout d'un nouvel enregistrement, le moteur HFSQL optimise le remplissage du fichier de données. L'espace correspondant aux enregistrements supprimés ou libérés est utilisé prioritairement lors de l'ajout d'un nouvel enregistrement.

Les enregistrements rayés ne sont pas ré-utilisés.
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Version du fichier de données après un ajout
<a name="version_fichier_donnees_apres_ajout_ELTPARAGRAPHE000505"></a>Si l'enregistrement a été ajouté au fichier de données (pas d'erreur de doublons ou d'intégrité), le numéro de version du fichier de données est modifié. Pour connaître le numéro de version, utilisez la fonction [&lt;Source&gt;.Version](../WDLang4/1000025082.md).
<a name="NOTE0_4"></a>


### Ajout d'un enregistrement dans une requête
<a name="ajout_enregistrement_dans_une_requete_ELTPARAGRAPHE000520"></a>L'ajout d'un enregistrement dans une requête peut être effectué :

- soit uniquement dans le résultat de la requête.

- soit directement dans les fichiers de données manipulés par la requête (constante *hModifieFichier* utilisée dans les fonctions [&lt;Source&gt;.ExécuteRequête](../WDLang4/1000024944.md) ou [&lt;Source&gt;.ExécuteRequêteSQL](../WDLang4/1000024948.md)). Dans ce cas, la constante *hAvecFiltre* est automatiquement sélectionnée.




Quel que soit le mode d'exécution de la requête (avec ou sans la constante *hAvecFiltre*), l'ajout d'enregistrement dans une requête n'est possible que pour les requêtes mono fichier. Les rubriques calculées précisées lors de l'ajout sont ignorées. Elles sont automatiquement calculées.

Attention :

- Tout ajout dans une requête utilisant les groupes ou les agrégats est interdit.

- La gestion de l'intégrité et des doublons n'est pas réalisée lors d'opérations sur les requêtes multi-fichiers : il est conseillé d'utiliser les transactions pour éviter tout problème.



<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/fr/UNIVERSALAPP.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png)![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) 

### Ajout d'enregistrements dans une vue
<a name="ajout_enregistrements_dans_une_vue_ELTPARAGRAPHE000552"></a>Il est possible d'ajouter des enregistrements dans une vue réalisée sur des fichiers de données au format HFSQL Classic. Ces enregistrements sont uniquement ajoutés en mémoire. Pour les ajouter dans le fichier de données lié à la vue (cas d'une vue simple par exemple), il faut utiliser la fonction [&lt;Source&gt;.VueVersFichier](../WDLang4/1000025084.md).
<a name="NOTE0_6"></a>


### Parcours et ajout d'enregistrements
<a name="parcours_ajout_enregistrements_ELTPARAGRAPHE000567"></a>Il est possible de paramétrer l'influence de l'ajout d'un enregistrement pendant le parcours d'un fichier de données (constantes *hEcritureDéfaut* et *hAffecteParcours*). Le fonctionnement des versions précédentes est conservé grâce à la constante *hAffecteParcours*).
![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png)![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) **Cas particuliers** : Si l'ajout est réalisé pendant un parcours, le nouvel enregistrement sera visible dans le parcours en cours uniquement. Si d'autres parcours ont été définis sur cette base de données, le nouvel enregistrement ne sera visible qu'après ré-initialisation de ces parcours.
<a name="NOTE0_7"></a>


### Problème de lenteur lors du premier ajout ou de la première suppression dans un fichier de données HFSQL
<a name="probleme_lenteur_lors_premier_ajout_premiere_suppression_dans_fichier_donnees_hfsql_ELTPARAGRAPHE000580"></a>Un problème de lenteur inexpliqué peut apparaître lors du premier accès à un enregistrement d'un fichier de données HFSQL. Pour corriger ce problème :

- Désactivez l'antivirus pour l'analyse des fichiers .FIC, .NDX, .MMO et .REP.

- Désactivez l'option "Restauration du système" sous Windows XP.



<a name="NOTE0_8"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) 

### Ajout dans une base de données au format Hyper File 5.5
<a name="ajout_dans_une_base_donnees_format_hyper_file_55_ELTPARAGRAPHE000595"></a>**Si vous utilisez la fonction HDupliqueEnregistrement avec une base de données au format Hyper File 5.5 :**

- Les options d'ajout (paramètre &lt;Options&gt;) ne sont pas prises en compte.

- Les rubriques de type TEXTE seront automatiquement complétées par des espaces.

- La fonction **&lt;Source&gt;.DupliqueEnregistrement** ne peut pas être utilisée avec une vue créée sur des fichiers de données au format Hyper File 5.5.




<a name="XComposante"></a>

## Composante :
wd280hf.dll
