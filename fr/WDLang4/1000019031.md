
## Installation et configuration de HFSQL Cluster
			



## Configuration requise
<a name="configuration_requise_ELTTEXTE000224"></a>
Pour installer un HFSQL Cluster, il est nécessaire de disposer : 

- de plusieurs machines correspondant aux noeuds du cluster. 

- d'une machine permettant d'abriter le coordinateur (ce poste peut être un des noeuds du cluster). 

- d'un serveur DNS. En effet, l'accès au cluster se fait en partageant un nom de machine virtuelle associé aux adresses IP des différents noeuds.




**Rappel** : Un cluster doit être composé d'au moins trois machines. Pour que le coordinateur puisse être installé sur la même machine qu'un noeud, il est nécessaire que le cluster se compose d'au moins trois noeuds. Si le cluster ne contient que deux noeuds, le coordinateur doit obligatoirement se trouver sur une troisième machine.

**Attention** : Tous les serveurs et postes doivent être des postes Windows. Les clusters ne sont pas disponibles sous Linux. 




|   |
| --- |
| **Attention** : <br>L'utilisation de HFSQL Cluster nécessite l'usage d'un pack d'installation spécifique. <br>Ce pack est disponible gratuitement en téléchargement sur le site de PC SOFT, dans l'espace de téléchargement des modules communs à la version 28. |






### Conseils
<a name="conseils_ELTPARAGRAPHE000022"></a>Afin d'éviter les écarts de performances, il est recommandé que les configurations de chacun des noeuds du cluster soient du même ordre de puissance (processeur et mémoire). 

**La configuration minimale** pour installer HFSQL Cluster est la suivante (pour chaque noeud) :

- Système d'exploitation : toutes les versions serveurs de Windows dont le support est assuré par l'éditeur.  Les éditions 32 et 64 bits sont supportées. 

- Mémoire : 512 Mo

- Disque : 20 Mo pour les éléments du cluster + taille des bases de données

- Réseau : 100 Mbps entre les noeuds. Les adresses IP des noeuds doivent être fixes.




**La configuration recommandée** pour installer HFSQL Cluster peut beaucoup varier selon la taille des bases de données, leur complexité et le nombre de clients. La configuration suivante sera robuste dans la plupart des cas (pour chaque noeud) :

- Système d'exploitation : Windows Server dans une version en cours de support par l'éditeur.
	Il est conseillé d'utiliser : 

	- la version la plus récente afin d'intégrer les protocoles de sécurité les plus actuels,

	- dans tous les cas une version qui n'est pas à la fin de son cycle de vie ([https://docs.microsoft.com/fr-fr/lifecycle/faq/general-lifecycle](https://docs.microsoft.com/fr-fr/lifecycle/faq/general-lifecycle)).




- Processeur : un processeur multicoeurs est recommandé

- Mémoire : 4 Go

- Disque : un système de disque en RAID




**Remarques** : 

- La machine qui abrite le service du coordinateur du cluster requiert une configuration bien moins puissante. Typiquement, le coordinateur peut être placé :

	- soit sur l'un des noeuds,

	- soit sur le même serveur que le DNS du réseau local,

	- soit sur une autre machine.




- Le port 4997 utilisé par le coordinateur du cluster doit être ouvert dans le pare-feu Windows.

- Les ports utilisés par les noeuds et le port 4998 doivent être ouverts dans le pare-feu Windows sur chaque machine serveur.










## Création d'un cluster
<a name="creation_cluster_ELTTEXTE000269"></a>
Pour créer un cluster :

1. Lancez l'assistant d'installation de HFSQL Cluster.

2. Acceptez les termes de la licence pour poursuivre l'installation.

3. Sélectionnez l'option "Créer un nouveau cluster".

4. Un texte récapitulatif vous rappelle brièvement le principe d'un cluster et les étapes de sa mise en place. Passez au plan suivant. 

5. Vous pouvez choisir de convertir un serveur HFSQL existant en premier noeud du nouveau cluster ou installer un cluster vierge. Dans le cas de la conversion d'un serveur existant, indiquez le nom du serveur (et le port d'écoute de HFSQL).

6. Saisissez les paramètres d'installation du coordinateur. Ces paramètres sont :

	- Le nom de la machine sur laquelle le service du coordinateur doit être installé.

	- Le mot de passe d'administration du cluster. Ce mot de passe sera utilisé dans le [Centre de Contrôle HFSQL](../CCHF/3540001.md) ou en programmation pour les opérations de maintenance du cluster (ajout de noeuds, arrêt et redémarrage, ...)

	- Le nom DNS du cluster : il s'agit du nom à partir duquel le cluster sera accessible sur le réseau. Pour plus de détails, consultez le paragraphe ["Configuration du DNS pour l'accès au cluster"](#DNS).




7. Décrivez la composition du cluster. Vous pouvez ajouter les différents noeuds du cluster. 
	Si vous avez choisi de convertir un serveur HFSQL existant, celui-ci sera automatiquement proposé.
	**Rappel** : Un cluster doit être composé d'au moins trois machines. Pour que le coordinateur puisse être installé sur la même machine qu'un noeud, il est nécessaire que le cluster se compose d'au moins trois noeuds. Si le cluster ne contient que deux noeuds, le coordinateur doit obligatoirement se trouver sur une troisième machine.

8. Saisissez le numéro de port à utiliser pour les connexions HFSQL. Ce numéro de port sera partagé par tous les noeuds du cluster. Il doit donc être disponible sur chaque machine abritant un noeud du cluster. Passez au plan suivant. 

9. Le résumé de la configuration choisie s'affiche. Vous pouvez revenir sur les plans précédents de l'assistant pour modifier la configuration du cluster.

10. Cliquez sur le bouton "Suivant". Un pack d'installation personnalisé est automatiquement créé. Vous pouvez : 

	- Continuer l'installation. Les différents postes composant le cluster doivent être accessibles. 

	- Utiliser un package d'installation. Ce package doit être exécuté sur chaque poste composant le cluster. 







**Remarque** : Il n'est possible d'installer qu'un seul coordinateur sur une machine donnée. Si deux clusters sont installés sur le même réseau, leurs coordinateurs respectifs doivent se trouver sur deux machines différentes.

<a name="DNS"></a>


## Configuration du DNS pour l'accès au cluster
<a name="configuration_dns_pour_acces_cluster_ELTTEXTE000293"></a>
Pour permettre l'accès au cluster, il est nécessaire d'ajouter un enregistrement dans votre serveur DNS pour chaque noeud. L'installation du cluster et des noeuds prend en charge cette opération automatiquement. Lorsque la modification automatique du DNS n'est pas possible (serveur DNS non supporté, problème de droits, etc.), il est nécessaire de faire l'ajout d'enregistrements manuellement.

**Remarque** : Pour assurer un fonctionnement correct du système DNS, il est impératif que les adresses IP des noeuds ne varient pas. Si les serveurs obtiennent leur adresse IP par le biais d'un DHCP, il est nécessaire de configurer celui-ci pour réserver une adresse fixe à chacun des noeuds du cluster.

**Caractéristiques des enregistrements DNS à créer** :

- Enregistrement de type (A) si les noeuds sont en IPv4 et de type (AAAA) si ils sont en IPv6.

- L'adresse IP de l'enregistrement est celle du noeud.

- Le nom de l'enregistrement est le nom DNS du cluster. Ce nom peut être choisi librement. Il ne doit pas correspondre au nom d'une machine réelle.




Lorsqu'une application cliente souhaite se connecter au cluster, elle récupère les enregistrements DNS correspondant au nom choisi pour le cluster : ce nom est celui qui est donné comme adresse de serveur dans la [variable de type Connexion](../WDLang4/1514073.md) ou dans les fonctions [HOuvreConnexion](../WDLang4/3044107.md) ou [HDécritConnexion](../WDLang4/3044205.md). Parmi les différentes adresses IP obtenues, le poste client sélectionnera le noeud auquel se connecter.

L'enregistrement de DNS peut être créé après l'installation du cluster, en utilisant Centre de Contrôle HFSQL. 


### Configurer le DNS depuis le Centre de Contrôle HFSQL
<a name="configurer_dns_depuis_centre_controle_hfsql_ELTPARAGRAPHE000122"></a>Pour configurer le DNS depuis le Centre de Contrôle HFSQL :

1. Lancez le Centre de Contrôle HFSQL.

2. Connectez-vous au cluster en indiquant l'adresse du coordinateur.

3. Si le nom DNS du cluster n'a pas encore été configuré, une ligne s'affiche dans la table "Problèmes potentiels".

4. Cliquez sur l'icône de résolution du problème (au bout de la ligne).

5. Indiquez le serveur DNS à configurer, le nom de domaine à utiliser (généralement, le nom de domaine du poste local) ainsi que les paramètres d'authentification s'ils sont nécessaires pour la connexion au serveur DNS.

6. Validez la fenêtre.

7. Saisissez dans la boîte de dialogue le nom DNS qui sera utilisé par les postes client pour se connecter au cluster.

8. Validez la boîte de dialogue.








## Installation d'un nouveau noeud
<a name="installation_nouveau_noeud_ELTTEXTE000323"></a>
Tous les noeuds suivant le premier doivent obligatoirement être de nouveaux serveurs HFSQL.

Il est également possible d'installer un nouveau serveur en tant que premier noeud du cluster. Dans ce cas, le cluster ne contiendra aucune base initiale.

**Remarques** :

- Il est possible d'utiliser des serveurs HFSQL 32 bits et 64 bits comme noeuds d'un même cluster.

- Tous les serveurs d'un cluster doivent utiliser le même port d'écoute. Ce port doit être choisi lors de l'installation.





### Installer un nouveau serveur HFSQL sur le poste local comme noeud d'un cluster
<a name="installer_nouveau_serveur_hfsql_sur_poste_local_comme_noeud_cluster_ELTPARAGRAPHE000148"></a>Pour installer un nouveau serveur HFSQL sur le poste local comme noeud d'un cluster : 

1. Lancez l'assistant d'installation de HFSQL Cluster.

2. Choisissez l'option "Ajouter un noeud à un cluster existant".

3. Saisissez les paramètres d'accès au coordinateur : nom de la machine et mot de passe d'administration.

4. Modifiez la composition du cluster. Il est possible d'ajouter plusieurs noeuds en une seule opération.

5. Un récapitulatif vous permet de contrôler la configuration du cluster avant d'appliquer les modifications.

6. Cliquez sur le bouton "Suivant". Un pack d'installation personnalisé est automatiquement créé. Vous pouvez : 

	- Continuer l'installation. Les différents postes composant le cluster doivent être accessibles. 

	- Utiliser un package d'installation. Ce package doit être exécuté sur chaque poste composant le cluster. 











## Désinstallation
<a name="desinstallation_ELTTEXTE000353"></a>


### Désinstaller un nœud ou un cluster
<a name="desinstaller_nœud_cluster_ELTPARAGRAPHE000165"></a>Pour désinstaller un noeud d'un cluster ou un cluster en entier :

1. Sur le poste du coordinateur, lancez l'assistant d'installation de HFSQL Cluster. 

2. Sélectionnez l'option "Désinstaller un cluster ou des noeuds". 

3. Indiquez le mot de passe du coordinateur. 

4. Cochez les éléments à désinstaller. 

5. Validez. La désinstallation est effectuée. 




**Remarque** : Il est également possible d'effectuer cette désinstallation depuis le Centre de Contrôle HFSQL. Dans ce cas, il est possible d'exclure temporairement un noeud du cluster sans avoir besoin de le désinstaller. 






