
## SQLBloque (Fonction)

***En anglais : SQLLock***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Permet de bloquer :

- La table de données dans sa totalité, en lecture et en écriture. Ces données sont inaccessibles aux autres postes.

- Les enregistrements sélectionnés par la requête. Ces données sont inaccessibles aux autres postes. Cette méthode permet par exemple de mettre à jour des enregistrements. Le résultat de la requête n'est pas retourné.




La fonction **SQLBloque** peut être utilisée sur tous les Accès Natifs (sauf SQLite et XML) ainsi que sur certains providers OLE DB (selon les capacités du provider et de la base de données). Cette fonction n'a aucun effet pour des tables manipulées par des drivers ODBC.


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
Req est une chaîne
// Début de transaction pour bloquer
SQLTransaction(sqlDébut)
// Bloque toute la table
SQLBloque("CLIENT", "Table")
// Exécute la requête
Req = "UPDATE CLIENT SET NOMCLIENT = 'DUPOND' WHERE REFCLIENT = 1043"
SQLExec(Req, "REQ1")
// Débloquer le fichier
SQLTransaction(sqlFin)
```


<a name="Exemple2"></a>





```wl
ReqBloque, ReqUpdate sont des chaînes
// Début de transaction pour bloquer
SQLTransaction(sqlDébut)
// Définition de Requête
ReqBloque = "SELECT * FROM CLIENT WHERE REFCLIENT = 1043"
// Bloquer le résultat de la requête SELECT
SQLBloque(ReqBloque)
// Définition d'une requête de mise à jour
ReqUpdate = "UPDATE CLIENT SET NOMCLIENT = 'DUPOND' WHERE REFCLIENT = 1043"
// Exécution d'une requête de mise à jour
SQLExec(ReqUpdate, "REQ1")
// Débloquer les enregistrements
SQLTransaction(sqlFin)
```



<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Bloquer une table de données dans sa totalité 

`<Résultat> = SQLBloque(<Nom de la table> , <"Table">)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le blocage a été effectué, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire.




**`<Nom de la table> : (Chaîne de caractères)`**

Nom de la table de données à bloquer.

**`<"Table"> : (Chaîne de caractères)`**

"Table" : Chaîne de caractères permettant de bloquer une table de données dans sa totalité.  


<a name="SYNTAXE2"></a>

### Bloquer les enregistrements sélectionnés par une requête

`<Résultat> = SQLBloque(<Texte de la requête>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le blocage a été effectué, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire.




**`<Texte de la requête> : (Chaîne de caractères)`**

Texte de la requête permettant de sélectionner les enregistrements à bloquer.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques




### Comment bloquer une table ou les enregistrements d'une requête ? 
<a name="comment_bloquer_une_table_les_enregistrements_une_requete_ELTPARAGRAPHE000080"></a>Pour bloquer une table (ou les enregistrements d'une requête) :

1. Débutez une transaction (fonction [SQLTransaction](../WDLang4/3072029.md) avec la constante *sqlDébut*).

2. Bloquez les enregistrements (fonction **SQLBloque**).
	Attention : si vous bloquez les enregistrements d'une requête, la requête est exécutée mais le résultat n'est pas renvoyé.

3. Débloquez les enregistrements en terminant la transaction (fonction [SQLTransaction](../WDLang4/3072029.md) avec la constante *sqlFin*).





<a name="NOTE0_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Accès Natif ORACLE
<a name="acces_natif_oracle_ELTPARAGRAPHE000105"></a>Il est possible de paramétrer le comportement de la fonction **SQLBloque** lorsque l'enregistrement est bloqué (attente infinie, compte-rendu de blocage immédiat, ...). Ce paramétrage est réalisé dans les options du programme WDORAINS.
<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) 

### Accès Natif MySQL
<a name="acces_natif_mysql_ELTPARAGRAPHE000117"></a>Les fonctions **SQLBloque** et [SQLTransaction](../WDLang4/3072029.md) permettent de gérer les blocages et les transactions uniquement sur les tables MySQL de type "InnoDB".

<a name="XComposante"></a>

## Composante :
wd280hf.dll
