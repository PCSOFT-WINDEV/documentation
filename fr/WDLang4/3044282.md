


## HCopieFichier (Fonction)

***En anglais : HCopyFile***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Effectue une copie d'un fichier de données HFSQL (fichiers .fic, .ndx, .ftx et .mmo s'ils existent) :

- du serveur HFSQL sur le serveur (pour faire une sauvegarde par exemple).

- du serveur HFSQL sur le client (pour faire une sauvegarde en local par exemple).

- du client sur le serveur HFSQL (pour mettre à jour les fichiers de données par exemple).

- d'un serveur HFSQL vers un autre serveur HFSQL. 





<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000021620&name=hcopiefichier_fonction&product=WD">Voir des exemples supplémentaires</a>
<a name="Exemple1"></a>

```wl
// Copie des fichiers de données du serveur vers le serveur
// avec renommage et changement de répertoire
HCopieFichier(MaConnexion, ".\sauvegarde\fichierclient_sov.fic", MaConnexion, ".\fichierclient.fic")
```
<a name="Exemple2"></a>

```wl
// Copie des fichiers de données du poste serveur vers le poste client
HCopieFichier("", "C:\Données\Client.fic", MaConnexion, "client.fic")
```
<a name="Exemple3"></a>

```wl
// Copie des fichiers de données du poste client vers le poste serveur
HCopieFichier(MaConnexion, "client.fic", "", "C:\Données\Client.fic")
```
<a name="Exemple4"></a>

```wl
// Copie le(les) fichiers de données d'un serveur vers un autre serveur
HCopieFichier("CNX", "client.fic", "CNX2", "rep\client.fic", hSansIndex, JAUGE_MaJauge)
```
<a name="Exemple5"></a>

```wl
// Copie le fichier de données CLIENT d'un client sur lui-même (sauvegarde)
sMonRepertoireDestination est une chaîne = ComplèteRep(fRepExe()) + "RepertoireTest\"
SI PAS fRépertoireExiste(sMonRepertoireDestination) ALORS fRepCrée(sMonRepertoireDestination)
HCopieFichier("", sMonRepertoireDestination + "CLIENT.FIC", "", ...
		ComplèteRep(fRepExe()) + "CLIENT.FIC", hCopieIndex)
```
<a name="Exemple6"></a>

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = HCopieFichier(<Connexion destination> , <Fichier de données destination> , <Connexion source> , <Fichier de données source> [, <Mode de copie> [, <Champ Jauge> [, <Mot de passe>]]])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si le fichier de données a été copié, 

- <u><u><u><u>Faux</u></u></u></u> en cas d'erreur. La fonction [HErreur](../WDLang4/3044088.md) permet d'identifier l'erreur.




**`<Connexion destination> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion dans laquelle le fichier de données doit être copié. Cette connexion correspond :

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).


Si ce paramètre correspond à une chaîne vide, la destination sera le poste local. 

**`<Fichier de données destination> : (Chaîne de caractères)`**

Nom et chemin du fichier de données destination. Si ce chemin et ce fichier de données n'existent pas sur le serveur, ils seront automatiquement créés. 
Si le fichier de données destination est sur le serveur, le chemin est relatif à la base de données.
Attention : l'extension du fichier '.fic' doit être spécifiée. 

**`<Connexion source> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion à partir de laquelle le fichier de données doit être copié. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Fichier de données source> : (Chaîne de caractères)`**

Nom et chemin du fichier de données source (à copier). Si le fichier de données source est sur le serveur, le chemin est relatif à la base de données.
Attention : 

- l'extension du fichier '.fic' doit être spécifiée.

- le fichier '.mmo' s'il existe sera automatiquement copié. 




**`<Mode de copie> : (Constante optionnelle de type Entier)`**

Mode de copie utilisée :



|   |   |
| --- | --- |
| *hCopieIndex* | Le ou les index du fichier de données sont copiés (fichier NDX et fichier FTX s'il existe). |
| *hCopieSiInexistant* | Copie le fichier de données uniquement s'il n'existe pas à l'emplacement indiqué sur le poste destination. |
| *hCréeIndex* | Le ou les index du fichier de données ne sont pas copiés (fichier NDX et fichier FTX s'il existe). Ils sont automatiquement re-créés sur la destination par ré-indexation. <br>Si le fichier de données est protégé par mot de passe, le paramètre &lt;Mot de passe&gt; doit être spécifié. |
| *hSansIndex* | Le ou les index du fichier de données ne sont pas copiés (fichier NDX et fichier FTX s'il existe). |



**`<Champ Jauge> : (Nom de champ optionnel)`**

Nom du champ Jauge présent dans la fenêtre et permettant de voir la progression de la copie.

**`<Mot de passe> : (Chaîne de caractères optionnelle)`**

Mot de passe du fichier de données (s'il existe). Ce mot de passe est nécessaire si la constante *hCréeIndex* est utilisée.  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Fonctionnement de la fonction HCopieFichier
<a name="fonctionnement_fonction_docparampagetitleshort_ELTPARAGRAPHE000216"></a>

- Le fichier de données copié est débloqué, ainsi que les enregistrements contenus dans le fichier de données.

- Si l'index n'existe pas ou si l'index est corrompu, alors l'index n'est pas copié.

- Pour copier le fichier de données, le mot de passe n'est pas nécessaire. Cependant, le fichier de données copié reste protégé par mot de passe.

- La copie de fichiers de données vers un serveur défini comme source d'un serveur de réplication SPARE n'est pas possible. 

- Fichier de données en transaction : il est conseillé avant de copier le fichier de données de :

	- bloquer le fichier de données en lecture/écriture (fonction [HBloqueFichier](../WDLang4/3044153.md)).

	- annuler les transactions interrompues (fonction [HTransactionAnnule](../WDLang4/3044001.md)).






<a name="NOTE0_2"></a>


### Conditions d'utilisation
<a name="conditions_utilisation_ELTPARAGRAPHE000240"></a>

- Il est également possible de copier un fichier de données du poste client vers ce même poste client. Dans ce cas, la fonction est équivalente à la fonction [fCopieFichier](../WDLang1/3036004.md).

- Cette fonction permet d'effectuer des copies vers un serveur HFSQL (en mode Client/Serveur). Cette fonction ne peut pas être utilisée avec un serveur externe (Oracle ou autre).

- Pour toute copie d'un fichier de données HFSQL présent sur un poste local vers le serveur, tous les utilisateurs doivent avoir libéré préalablement ce fichier de données. Aucune connexion au fichier de données ne doit être en cours sinon la copie échouera. Pour éviter toute connexion au fichier de données, il est possible de : 

	- Interdire l'accès à la base de données (fonction [HInterditAccèsBaseDeDonnées](../WDLang4/3044286.md)), 

	- Déconnecter les clients (fonction [HDéconnecteClient](../WDLang4/3044339.md)),

	- Effectuer la copie des fichiers (fonction [HCopieFichier](../WDLang4/3044282.md)),

	- Rétablir l'accès à la base de données (fonction [HFinInterditAccèsBaseDeDonnées](../WDLang4/3044287.md)). 




- Cas des fichiers de données répliqués (réplication entre serveurs) : Dans le cas d'un fichier de données répliqué, la fonction **HCopieFichier** ne doit pas être utilisée pour copier un fichier de données vers le serveur : la copie est impossible. Par contre, il est possible de réaliser une copie d'un fichier de données du serveur vers le poste client. 



<a name="NOTE0_3"></a>


### Noms de fichiers de données et de répertoires sur le serveur
<a name="noms_fichiers_donnees_repertoires_sur_serveur_ELTPARAGRAPHE000275"></a>

- Le nom des fichiers de données (fichiers .fic, .ndx, .ftx et .mmo s'ils existent) sur le serveur ne doivent pas comporter d'accents.

- Sur un serveur LINUX, le nom des fichiers de données doit être en minuscules.




<a name="XComposante"></a>

## Composante :
wd280hf.dll
