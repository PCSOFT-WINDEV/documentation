


## HAjouteTâche (Fonction)

***En anglais : HAddTask***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Ajoute une tâche planifiée sur un serveur HFSQL. 

**Compatibilité version 12** : Pour compatibilité avec la version 12, il est également possible de définir une tâche grâce à la structure [HTâchePlanifiée](../WDLang4/1000017180.md). Cette tâche exécutera la procédure stockée indiquée (ou réalisera une sauvegarde de la base de données).




<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
MaTâche est une hTâchePlanifiée
MaTâche.Description = "Sauvegarde planifiée " + RC + ...
	DateVersChaîne(DateSys(), maskDateSystème) + ...
	" à " + HeureVersChaîne(HeureSys(), "HH:MM:SS")
MaTâche.Mois = "*"
MaTâche.JourDeLaSemaine = "*"
MaTâche.JourDuMois = "*"
MaTâche.Heure = SAI_Heure.Heure
MaTâche.Minute = SAI_Heure.Minute
MaTâche.NombreExécution = 1
MaTâche.Procédure = "HBackup"
Ajoute(MaTâche.Paramètre, gsNomBaseCS + "/LOG_TACHES.FIC")
Ajoute(MaTâche.Paramètre, gsNomBaseCS + ".SauvegardePlanifiée")
Ajoute(MaTâche.Paramètre, Vrai)
Ajoute(MaTâche.Paramètre, MaTâche.Description)
nID est un entier = HAjouteTâche(gsConnexionCS, MaTâche)
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Création d'une tâche à partir d'une variable hTâchePlanifiée

`<Résultat> = HAjouteTâche(<Connexion> , <Tâche planifiée>)`
---

**`<Résultat> : (Entier)`**



- Identifiant de la tâche planifiée, 

- -1 en cas d'erreur. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'identifier l'erreur.




**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion pour laquelle une tâche doit être ajoutée. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Tâche planifiée> : (Variable de type hTâchePlanifiée)`**

Nom de la variable de type [hTâchePlanifiée](../WDLang4/1000017448.md) manipulée.


<a name="SYNTAXE2"></a>

### Création d'une tâche à partir de la structure HTâchePlanifiée (compatibilité version 12)

`<Résultat> = HAjouteTâche(<Connexion> , <Procédure stockée> [, <Paramètre 1> [... [, <Paramètre N>]]])`
---

**`<Résultat> : (Chaîne de caractères)`**



- Identifiant de la tâche planifiée, 

- -1 en cas d'erreur. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'identifier l'erreur.




**`<Connexion> : (Chaîne de caractères ou variable de type Connexion)`**

Connexion pour laquelle une tâche doit être ajoutée. Cette connexion correspond : 

- soit au nom de la connexion définie sous l'éditeur d'analyses ou grâce aux fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md).

- soit au nom d'une variable de type [Connexion](../WDLang4/1514073.md).




**`<Procédure stockée> : (Procédure WLangage)`**

Nom de la procédure stockée WLangage qui sera exécutée lors du déclenchement de la tâche. Ce paramètre est de la forme "&lt;Nom de la base&gt;\\&lt;Nom de la procédure stockée&gt;". Si ce nom correspond à "***HSauvegarde***" (ou "HBackup"), la tâche planifiée déclenchera une sauvegarde.

**`<Paramètre 1> : (Type du paramètre optionnel)`**

Paramètre à passer à la procédure stockée. Dans le cas d'une sauvegarde, les paramètres à passer sont ceux de la fonction [HSauvegarde](../WDLang4/1000017081.md), mis à part la connexion.



**`<Paramètre N> : (Type du paramètre optionnel)`**

Paramètre à passer à la procédure stockée. Dans le cas d'une sauvegarde, les paramètres à passer sont ceux de la fonction [HSauvegarde](../WDLang4/1000017081.md), mis à part la connexion.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Droits nécessaires
<a name="droits_necessaires_ELTPARAGRAPHE000154"></a>Pour ajouter une tâche, il est nécessaire de posséder :

- le droit correspondant (constante *hDroitGèreTâche*) sur le serveur,

- pour chaque base concernée, le droit de connexion (constante *hDroitConnexion* ou *hDroitConnexionCryptée*),

- le droit d'exécuter la commande liée à la tâche planifiée.


La tâche sera exécutée avec le compte de l'utilisateur qui a créé la tâche.

**Attention** : Si le serveur est éteint, la tâche planifiée ne sera pas réalisée. La tâche planifiée sera réalisée à la prochaine date disponible lorsque le serveur sera allumé.

<a name="XComposante"></a>

## Composante :
wd280hf.dll
