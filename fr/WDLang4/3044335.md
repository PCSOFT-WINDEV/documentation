
## Transactions : Sécurisez vos traitements sur des fichiers de données HFSQL 
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000194"></a>
Ce chapitre aborde les sujets suivants :

- [Présentation des transactions : Qu'est-ce qu'une transaction, utiliser les transactions selon ses besoins, etc.](#NOTE2_1)

- [Principe : gestion des transactions sur des fichiers de données HFSQL et cas particuliers](#NOTE3_1).

- [Manipuler les transactions par programmation](../WDLang4/3044336.md).

- [Gestion des cas particuliers (panne de courant, rétablir la cohérence de la base de données, etc)](../WDLang4/3044337.md).

- [Gestion avancée : les fichiers créés lors d'une transaction, gestion de l'identifiant du poste](../WDLang4/3044337.md).




![Java](https://doc.pcsoft.fr/ext/images/fr/JAVA.png) La gestion des transactions est disponible uniquement pour les bases de données HFSQL Client/Serveur. 



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Qu'est-ce qu'une transaction ?
<a name="questce_quune_transaction_ELTTEXTE000224"></a>
Une transaction est un ensemble d'opérations indissociables : soit toutes les opérations de la transaction sont réalisées, soit aucune opération n'est réalisée. La gestion des transactions est le meilleur moyen d'assurer la cohérence d'un ensemble d'écritures indissociables sur des fichiers de données HFSQL.

**Par exemple**, dans une application bancaire, une opération de virement consiste en un débit pour un compte et un crédit pour un second compte. Il est nécessaire de gérer ces deux opérations dans une seule et même transaction afin d'éviter toute incohérence (en cas de rupture de courant en cours d'opération par exemple).
<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=transaction.gif)



<a name="NOTE2_2"></a>


### Utiliser les transactions selon ses besoins
<a name="utiliser_les_transactions_selon_ses_besoins_ELTPARAGRAPHE000055"></a>Selon votre situation, voici quelques conseils pour optimiser la gestion des transactions dans vos applications ou sites :

- **Réaliser des transactions dans des applications installées sur des postes fiables (onduleur, une seule application en cours, ...) : transaction disque**
	Dans ce cas, les transactions sont utilisées uniquement dans le but de pouvoir annuler simplement une suite d'opérations. Il est possible d'afficher des fenêtres au milieu d'une transaction, de réaliser différents traitements relativement longs, ...
	Chaque opération réalisée pendant la transaction est enregistrée dans un fichier de transaction. L'enregistrement manipulé est bloqué en écriture jusqu'à la validation ou l'annulation de la transaction.

- **Réaliser des écritures fiables dans des fichiers de données (domaine bancaire, comptable, ...).**
	Les transactions permettent d'assurer la sécurité d'un ensemble d'opérations. Dans ce cas, il est nécessaire de regrouper toutes les opérations d'écriture dans votre code afin de les exécuter dans une transaction. Le code exécuté pendant la transaction ne doit pas afficher de fenêtres, réaliser de parcours de fichiers de données, ... Ce code doit uniquement comprendre les opérations de modification des fichiers de données. 
	Chaque opération réalisée pendant la transaction est enregistrée dans un fichier de transaction. L'enregistrement manipulé est bloqué en écriture jusqu'à la validation ou l'annulation de la transaction.






<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Principe
<a name="principe_ELTTEXTE000254"></a>


### Principe des transactions sur des fichiers de données HFSQL
<a name="principe_des_transactions_sur_des_fichiers_donnees_hfsql_ELTPARAGRAPHE000076"></a>Chaque opération d'écriture effectuée lors d'une transaction est mémorisée dans un fichier des transactions. A tout moment, il est possible d'annuler la transaction : toutes les opérations effectuées depuis le début de la transaction seront annulées.

Lorsque les opérations d'écriture incluses dans la transaction sont terminées, le programme peut valider les opérations de la transaction.

**Remarques** : 

- ![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png) Le mode d'isolation des transactions est le mode "**READ UNCOMMITED**". 

- ![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Le mode d'isolation des transactions est défini avec la fonction [HTransactionIsolation](../WDLang4/1000020926.md). Le mode d'isolation par défaut est le mode "**READ UNCOMMITED**". 

- ![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/fr/HF55.png) Les transactions ne sont pas disponibles sur des fichiers de données Hyper File 5.5.



<a name="NOTE3_2"></a>


### Cas particuliers
<a name="cas_particuliers_ELTPARAGRAPHE000102"></a>

- **Erreur du programme**, la transaction est automatiquement abandonnée.

- **Appel de la fonction [FinProgramme](../WDLang1/3013033.md)**, la transaction est automatiquement abandonnée.

- **Annulation d'un test depuis l'éditeur,** la transaction est automatiquement abandonnée.

- **Panne de courant ou arrêt brusque de l'application** (arrêt de l'application par le gestionnaire de tâches par exemple) : 
	Lorsque l'application est relancée, la cohérence de la base de données peut être rétablie :

	- ![HFSQL Classic](https://doc.pcsoft.fr/ext/images/fr/HF.png) Par l'outil [WDTRANS](../WDTrans/3524005.md) (ou [WDOptimiseur](../WDOptimiseur/3519002.md)). 

	- ![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Par le Centre de Contrôle HFSQL.

	- Au premier appel de la fonction [HTransactionDébut](../WDLang4/3044002.md). 

	- Par la fonction [HTransactionAnnule](../WDLang4/3044001.md). 







![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Cas particuliers spécifiques à HFSQL Client/Serveur :

- Si le Client est perdu, la transaction est annulée.

- Le redémarrage du serveur annule les transactions en cours. Attention : la transaction n'est pas annulée si la transaction porte sur un fichier de données avec mot de passe sécurisé. La transaction sera annulée à la prochaine ouverture du fichier de données.




Pour plus de détails sur les différents modes de rétablissement de la cohérence des données, consultez [Gestion des cas particuliers](../WDLang4/3044337.md).


- ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=WDTransaction.gif) ***Exemples didactiques (WINDEV)*** : **WD Transaction** <br>Ce programme réalisé avec WINDEV est basé sur une analyse simplifiée du type COMMANDE, LIGNECOMMANDE, STOCK. Il illustre le fonctionnement des transactions lors du passage d'une commande.


