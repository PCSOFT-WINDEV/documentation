
## Connecteur Natif PostgreSQL : Spécificités et remarques
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000297"></a>
Les paragraphes suivants présentent les remarques générales et les spécificités du Connecteur Natif PostgreSQL.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Remarques générales
<a name="remarques_generales_ELTTEXTE000321"></a>


### Versions nécessaires
<a name="versions_necessaires_ELTPARAGRAPHE000018"></a>**Attention** : Cette version du Connecteur Natif PostgreSQL ne fonctionne qu'avec :

- WINDEV 28 ou WEBDEV 28.

- PostgreSQL à partir de la version 7.4 (les tests ont été réalisés avec la version 8.3.6 et la version 9.1.3).



<a name="NOTE2_2"></a>


### Utilisation d'ordres WLangage dans les requêtes SQL
<a name="utilisation_ordres_wlangage_dans_les_requetes_sql_ELTPARAGRAPHE000032"></a>Dans les requêtes SQL, il n'est pas possible d'utiliser des ordres WLangage. 


<a name="NOTE2_3"></a>


### Gestion de fichiers de taille importante
<a name="gestion_fichiers_taille_importante_ELTPARAGRAPHE000040"></a>Lors de la manipulation de fichiers de taille importante, tous les enregistrements sont chargés en mémoire. Pour réduire l'occupation mémoire, il est conseillé de :

- utiliser un filtre (fonction [HFiltre](../WDLang4/3044100.md)) avant d'initialiser un parcours (fonction [HLitPremier](../WDLang4/3044051.md) / [HLitDernier](../WDLang4/3044140.md), ...).

- utiliser des requêtes dont les conditions de sélection soient suffisamment discriminantes.

- éviter les recherches.



<a name="NOTE2_4"></a>


### Support de Unicode avec les fonctions HFSQL
<a name="support_unicode_avec_les_fonctions_hfsql_ELTPARAGRAPHE000060"></a>Pour utiliser des chaînes Unicode, il est nécessaire de spécifier le charset "UTF8" lors de la création de la base de données PostgreSQL. Dans ce cas, toutes les chaînes seront des chaînes Unicode.

**Lorsque Unicode est supporté sur la connexion (mode par défaut),**le type des rubriques texte des requêtes exécutées avec la constante *hRequêteSansCorrection* est Unicode. Si une chaîne Unicode est affectée dans une chaîne ANSI, WINDEV et WEBDEV font automatiquement la conversion en utilisant l'alphabet défini avec la fonction [ChangeAlphabet](../WDLang1/3054001.md).

**Attention** : La fonction [ChangeAlphabet](../WDLang1/3054001.md) doit être utilisée AVANT d'ouvrir la connexion. Il est nécessaire de fermer et de ré-ouvrir la connexion après chaque appel de la fonction [ChangeAlphabet](../WDLang1/3054001.md) pour que les données soient correctement converties dans l'alphabet spécifié.

**Si la connexion est ANSI** (option "WD Unicode Support = 0" dans les informations étendues spécifiées avec les fonctions [HDécritConnexion](../WDLang4/3044205.md) ou [HOuvreConnexion](../WDLang4/3044107.md)), le type des rubriques texte des requêtes exécutées avec la constante *hRequêteSansCorrection*est ANSI.

Pour plus de détails sur les connexions Unicode ou ANSI, consultez [Programmation d'une base de données PostgreSQL avec les fonctions HFSQL](../WDPostgreSQL/5518003.md).
<a name="NOTE2_5"></a>


### Gestions des alphabets avec les fonctions SQL
<a name="gestions_des_alphabets_avec_les_fonctions_sql_ELTPARAGRAPHE000093"></a>Tous les échanges sont réalisés dans l'alphabet (charset) courant. Une erreur survient lors de la connexion si le serveur ne gère pas les conversions depuis ou vers l'alphabet courant.

Dans ce cas, il faut utiliser la fonction [ChangeAlphabet](../WDLang1/3054001.md) avant la fonction [SQLConnecte](../WDLang4/3072005.md) pour sélectionner un alphabet compatible avec le serveur.
<a name="NOTE2_6"></a>


### Certificats SSL
<a name="certificats_ssl_ELTPARAGRAPHE000110"></a>Le Connecteur Natif PostgreSQL gère les connexions utilisant des certificats SSL. 

Pour gérer les connexions utilisant des certificats SSL : 

1. **Sur le poste serveur** : Utiliser un serveur PostgreSQL gérant les connexions SSL. Consultez la documentation PostgreSQL pour savoir comment générer les fichiers de certificat SSL et configurer le serveur pour n'autoriser que les connexions SSL. 

2. **Sur le poste client** : Utiliser une couche client PostgreSQL compilée avec la gestion des connexions SSL. 

3. Par défaut, la couche client PostgreSQL va chercher les fichiers de certificat SSL dans le répertoire : %APPDATA%\\postgresql. Par exemple : "C:\\Users\\Florence\\appData\\roaming\\postgresql". Il est possible de renommer et de placer ces fichiers dans des répertoires différents en indiquant leurs emplacements dans la chaîne de connexion grâce aux mots-clés : SSL Cret, SSL Key, SSL CA. 

4. Utiliser les mot-clés correspondant aux options SSL dans les informations de connexion. Les mots-clés reconnus sont : 

	- SSL Key

	- SSL Cert

	- SSL CA

	- SSL CRL

	- SSL Mode







Ces paramètres correspondent aux paramètres de même nom de la fonction **PQconnectdb**. 

Remarque : Par défaut, le Connecteur Natif essaie d'ouvrir une connexion SSL, puis en cas d'échec une connexion non SSL. 
Pour contrôler le mode d'ouverture de la connexion, il faut ajouter le mot-clé "SSL Mode" dans les informations étendues de la connexion, suivi du mode souhaité.

Exemple d'informations étendues pour utiliser les certificats par défaut : Les fichiers postgresql.crt, postgresql.key, Root.crt sont présents dans le répertoire %APPDATA%\\postgresql : 

```txt
Server Port=5432;SSL Mode = verify-full
```


Exemple d'informations étendues pour utiliser des certificats renommés :

```txt
Server Port=5432; 
SSL CA = C:\Certificats SSL\CA.crt ; 
SSL Cert = C:\Certificats SSL\my.crt ; 
SSL Key = C:\Certificats SSL\my.key ; 
SSL Mode = verify-full
```


Pour plus de détails, consultez la page d'aide [Informations optionnelles de connexion](../WDLang4/9000124.md). 



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Spécificités générales
<a name="specificites_generales_ELTTEXTE000375"></a>


### Blocage des enregistrements
<a name="blocage_des_enregistrements_ELTPARAGRAPHE000150"></a>Les options de blocage (***hBlocageEcriture*** et ***hBlocageLectureEcriture***) utilisables avec les fonctions HFSQL ne sont pas gérées. En effet, les blocages sont liés aux transactions. Il ne peut pas y avoir de blocage sans une transaction en cours et seule la fin de la transaction permet de retirer le blocage.  
<a name="NOTE3_2"></a>


### Enregistrements identiques
<a name="enregistrements_identiques_ELTPARAGRAPHE000157"></a>Le Connecteur Natif PostgreSQL n'est pas capable de différencier deux enregistrements identiques (dont les valeurs de toutes les rubriques sont égales, sans tenir compte des rubriques de type mémo).

En cas de modification ou de suppression d'enregistrement, tous les enregistrements identiques seront modifiés ou supprimés.
<a name="NOTE3_3"></a>


### Rubriques de type Tableau
<a name="rubriques_type_tableau_ELTPARAGRAPHE000166"></a>Les rubriques de type Tableau ne sont pas gérées par le Connecteur Natif. Si vous utilisez une rubrique tableau, seule la valeur de l'indice 1 du tableau sera manipulable avec les fonctions HFSQL (en écriture et en lecture).
<a name="NOTE3_4"></a>


### Indexation partielle des mémos et indexation full-text
<a name="indexation_partielle_des_memos_indexation_fulltext_ELTPARAGRAPHE000173"></a>L'indexation partielle des mémos ainsi que l'indexation full-text ne sont pas prises en compte :

- lors de l'importation des tables PostgreSQL dans l'analyse.

- lors de l'utilisation de la fonction [HCréation](../WDLang4/3044255.md).




Si ces fonctionnalités sont définies dans l'analyse, elles seront prises en compte uniquement lors de l'exécution de requêtes SQL (avec la constante *hRequêteSansCorrection*).
<a name="NOTE3_5"></a>


### Requêtes imbriquées
<a name="requetes_imbriquees_ELTPARAGRAPHE000188"></a>La correction des requêtes imbriquées n'est pas gérée dans cette version de le Connecteur Natif PostgreSQL. Il est cependant possible d'utiliser la constante *hRequêteSansCorrection*.

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Spécificités pour les fonctions HFSQL et SQL
<a name="specificites_pour_les_fonctions_hfsql_sql_ELTTEXTE000423"></a>
Les spécificités pour l'utilisation des fonctions HFSQL et SQL avec le Connecteur Natif PostgreSQL sont les suivantes :

| Spécificités | Fonctions concernées |
| --- | --- |
| Requête multi-fichier : <br>Les fonctions **HAjoute**, **HModifie** et **HSupprime** ne sont pas supportées. | [HAjoute](../WDLang4/3044147.md)<br>[HModifie](../WDLang4/3044042.md)<br>[HSupprime](../WDLang4/3044018.md) |




<a name="NOTE4_2"></a>


### Gestion des identifiants automatiques
<a name="gestion_des_identifiants_automatiques_ELTPARAGRAPHE000221"></a>La gestion des constantes *hForceIDAuto*et *hFixeIDAuto* est identique à la gestion réalisée par le moteur HFSQL.

Pour ré-initialiser la valeur de départ de la séquence d'un identifiant automatique après l'utilisation de la fonction [HAjoute](../WDLang4/3044147.md) avec la constante *hForceIDAuto*, exécutez la requête suivante avec la constante *hRequêteSansCorrection* :


```txt
ALTER SEQUENCE "<NomDufichier>_<NomRubrique>_seq" 
RESTART WITH [ Identifiant du début ]
```


Exemple : Pour que le prochain Identifiant automatique généré par PostgreSQL commence à 5, la requête à utiliser est :


```txt
ALTER SEQUENCE "MonFichier_IdAuto_seq" RESTART WITH 5
```

<a name="NOTE4_3"></a>


### Ordres SQL non gérés
<a name="ordres_sql_non_geres_ELTPARAGRAPHE000239"></a>Les ordres SQL suivants ne sont pas gérés sur une source de données PostgreSQL :

- TOP

- CHARACTER_LENGTH

- BIN

- OCT

- HEX

- LOG10

- PATINDEX

- LEFT(Chaîne, taille)





