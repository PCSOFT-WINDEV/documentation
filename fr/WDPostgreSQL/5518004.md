
## Connecteur Natif PostgreSQL : Programmation à l'aide des fonctions SQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000138"></a>
Il est possible d'utiliser les fonctions SQL pour manipuler la base de données PostgreSQL.

**Différences par rapport à la programmation HFSQL** : L'utilisation des fonctions SQL pour manipuler des données PostgreSQL n'implique pas une importation de la structure des fichiers dans l'analyse. Cependant, les données doivent être manipulées uniquement par requêtes. Il n'est pas possible de lire directement le contenu des fichiers PostgreSQL.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Programmation
<a name="programmation_ELTTEXTE000162"></a>




### 1. Ouverture de la connexion
<a name="1_ouverture_connexion_ELTPARAGRAPHE000021"></a>La fonction [SQLConnecte](../WDLang4/3072005.md) permet d'ouvrir une connexion à une base de données PostgreSQL par le Connecteur Natif. Il est nécessaire de passer en paramètre à la fonction **SQLConnecte** le type de la base utilisée, ici PostgreSQL.

**Remarque** : le nom de la source de données PostgreSQL (ici "BasePostgreSQL") est le nom du poste où la base de données est disponible ou bien son adresse IP. Dans tous les cas, le nom de la "DataBase" doit être spécifié.
  

```wl
NumConnexion = SQLConnecte("BasePostgreSQL", "", "", "", "PostgreSQL")
// ou 
// NumConnexion = SQLConnecte("BasePostgreSQL", "Utilisateur", "MotDePasse", "MaDataBase", ...
// "PostgreSQL")
 
// Connexion à une base de données PostgreSQL distante
NumConnexion = SQLConnecte("192.168.1.51", "Utilisateur", "MotDePasse", "test", "PostgreSQL")
```


**Gestion des alphabets** : Tous les échanges sont réalisés dans l'alphabet (charset) courant. Une erreur survient lors de la connexion si le serveur ne gère pas les conversions depuis ou vers l'alphabet courant. Dans ce cas, il faut utiliser la fonction [ChangeAlphabet](../WDLang1/3054001.md) avant la fonction [SQLConnecte](../WDLang4/3072005.md) pour sélectionner un alphabet compatible avec le serveur.
<a name="NOTE2_2"></a>


### 2. Exécution de requêtes
<a name="2_execution_requetes_ELTPARAGRAPHE000043"></a>L'exécution de requêtes est réalisée grâce à la fonction [SQLExec](../WDLang4/3072007.md). La fonction **SQLExec** attend en paramètres le texte de la requête SQL et le nom qui sera donné à cette requête.


```wl
SQLExec("SELECT NOM, PRENOM, POSTE, PHOTO FROM CLIENT", "REQ1")
```

<a name="NOTE2_3"></a>


### 3. Récupération du résultat
<a name="3_recuperation_resultat_ELTPARAGRAPHE000055"></a>Plusieurs modes de récupération du résultat sont disponibles :

- [SQLPremier](../WDLang4/3072017.md) : Permet de récupérer le résultat et initialise un parcours du résultat de type [SQLPremier/SQLCol](../WDLang4/3072025.md).

- [SQLTable](../WDLang4/3072031.md) : Permet de récupérer le résultat de la requête dans un champ Table par programmation de l'application WINDEV ou du site WEBDEV. Il est possible de récupérer le résultat de la requête par Fetch partiel.

- [SQLFetch (SQLAvance)](../WDLang4/3072011.md) : Permet de parcourir les différentes lignes résultat de la requête. Le parcours du résultat de la requête est du type [SQLAvance/SQLLitCol](../WDLang4/3072025.md).




La fonction [SQLBloque](../WDLang4/3072003.md) permet de bloquer soit les enregistrements de la table, soit les enregistrements sélectionnés par la requête. Le timeout (attente maximale) pour bloquer ou modifier un enregistrement bloqué est par défaut infini sur une base PostgreSQL. Pour modifier le timeout, il est conseillé d'utiliser l'option "WD Command Timeout" dans les informations optionnelles de la fonction [SQLConnecte](../WDLang4/3072005.md). Dans ce cas, lorsque le timeout sera atteint, une erreur sera renvoyée par la base.
<a name="NOTE2_4"></a>


### 4. Fermeture de la connexion
<a name="4_fermeture_connexion_ELTPARAGRAPHE000086"></a>La fonction [SQLFerme](../WDLang4/3072015.md) permet de fermer la connexion à la base de données lorsque toutes les requêtes nécessaires ont été réalisées.


