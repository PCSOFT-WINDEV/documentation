


## Buffer (Type de variable)
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000381"></a>
Le type Buffer correspond à une zone mémoire binaire.

**Grâce à ce type, un code manipulant du binaire sera portable entre une application WINDEV standard et une application WINDEV Mobile.**

***Sous WINDEV***, une variable de type chaîne de caractères peut aussi bien contenir des caractères que des données binaires (une image par exemple).

***Sous WINDEV Mobile***, si une variable de type chaîne de caractères contient des données binaires, ces données peuvent être erronées (conversion malencontreuse par exemple). Pour manipuler des données binaires, nous vous conseillons d'utiliser une variable de type Buffer.

Le type Buffer ne gère pas de marqueur spécifique de fin et permet de stocker des 0 binaires.

Deux types de variables sont disponibles :

- **Buffer** : Ce type permet de manipuler une zone mémoire dont la taille est dynamique : elle s'adapte automatiquement au contenu du buffer.

- **Buffer sur** : Ce type permet de manipuler une zone mémoire dont la taille (en octets) est fixée à la compilation. Ce type est un type avancé permettant de réaliser certaines manipulations spécifiques en mémoire, d'utiliser certaines API Windows.




Remarque : Les variables de type Buffer sont encodés en base64 en JSON et en XML.





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Pourquoi utiliser le type Buffer ?
<a name="pourquoi_utiliser_type_buffer_ELTTEXTE000405"></a>
Sous WINDEV, il est possible d'utiliser le code suivant pour manipuler des octets en binaire :

```wl
S est une chaîne = Caract(1) + Caract(0)
```


La zone mémoire correspondante est : 



|   |   |
| --- | --- |
| 0 | 1 |


Ce même code exécuté en Ansi et en Unicode n'a pas le même comportement.

Pour avoir un code identique en ANSI et en UNICODE, il est nécessaire de remplacer la chaîne par un buffer. Le code devient alors :

```wl
S est un Buffer
S[[1]] = 1
S[[2]] = 0
```


<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Le type Buffer : Syntaxe et manipulations
<a name="type_buffer_syntaxe_manipulations_ELTTEXTE000429"></a>


### Déclarer une variable de type Buffer
<a name="declarer_une_variable_type_buffer_ELTPARAGRAPHE000121"></a>

- &lt;Nom de la variable&gt; **est un** Buffer


**OU**

- &lt;Nom de la variable 1&gt;, &lt;Nom de la variable 2&gt; **sont des** Buffers




**Détail de la syntaxe**


|   |   |
| --- | --- |
| **&lt;Nom de la variable&gt; :** | Nom de la variable à déclarer. |


Remarques :

- Les mots-clés <u><u><u><u>un</u></u></u></u>, <u><u><u><u>une</u></u></u></u> et <u><u><u><u>des</u></u></u></u> ne sont pas obligatoires : ce sont des mots d'agrément.

- Par défaut, une variable de type Buffer est vide.




Exemple :

```wl
MonBuffer est un Buffer
```



### Déclarer et initialiser une variable de type Buffer
<a name="declarer_initialiser_une_variable_type_buffer_ELTPARAGRAPHE000166"></a>Pour déclarer et initialiser une variable de type Buffer, il est possible d'utiliser la syntaxe suivante : 

```txt
<Nom de la variable> est un Buffer = [<Valeur hexa 1>, <valeur hexa 2>, ..., <Valeur hexa N>]
```


**Détail de la syntaxe**


|   |   |
| --- | --- |
| **&lt;Nom de la variable&gt; :** | Nom de la variable à déclarer. |
| **Valeur hexa** | Valeur hexadécimale. |


Exemple : 

```wl
b est un Buffer = [0x01, 0x02, 0x03]
```

<a name="NOTE3_2"></a>


### Manipulations sur les variables de type Buffer
<a name="manipulations_sur_les_variables_type_buffer_ELTPARAGRAPHE000190"></a>Les variables de type Buffer peuvent être manipulés de la même façon qu'une variable de type Chaîne de caractères. 

**Pour affecter une variable Buffer**, utilisez une des syntaxes suivantes :

- affectation d'une chaîne à une variable de type Buffer : 
	***&lt;Nom de la variable Buffer&gt; = &lt;Ma Chaîne&gt;***. 
	Par exemple :
	
	```wl
	MonBuffer est un Buffer
	MonBuffer = "WINDEV est formidable"
	// En ANSI, la variable MonBuffer contient : WINDEV est formidable
	// En UNICODE, la variable MonBuffer contient : 
	// W0i0n0D0e0v0 0e0s0t0 0f0o0r0m0i0d0a0b0l0e0
	```


- affectation d'un octet de la variable Buffer : 
	***&lt;Nom de la variable Buffer&gt; [[&lt;Indice de l'octet&gt;]] = &lt;Code ASCII de l'octet&gt;***. 
	Par exemple : 
	
	```wl
	MonBuffer est un Buffer
	MonBuffer[[1]] = 65 // MonBuffer contient "A"
	```





**Utilisation des fonctions** : 

- Les fonctions [Gauche](../WDLang1/3024001.md), [Droite](../WDLang1/3024016.md) et [Milieu](../WDLang1/3024023.md) sont utilisables sur les variables de type Buffer. Pour plus de détails sur la syntaxe à utiliser, consultez l'aide de ces fonctions. 
	

- La fonction [Taille](../WDLang1/3024031.md) permet de connaître la taille réelle des données contenues dans la variable de type Buffer (en octets).




**Utilisation des opérateurs** : 
L'opérateur [[ ]] permet d'accéder :

- à un octet de la variable de type Buffer. Par exemple : 
	
	```wl
	MonBuffer est un Buffer
	MonBuffer = "WINDEV est formidable"
	MonBuffer[[1]] = "W"
	```


- à une partie de la variable de type Buffer. Par exemple : 
	
	```wl
	MonBuffer est un Buffer
	MonBuffer = "WINDEV est formidable"
	Info(MonBuffer[[8 A 15]])
	```





**Comparaison de buffers** :

Il est possible de comparer un buffer ou une portion de buffer à un buffer en littéral. 

Il est possible d'écrire par exemple : 

```txt
SI MonBuffer = [1,2,3] ALORS ...

SI MonBuffer[1 SUR 2] = [1,2] ALORS ...
```


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Le type 'Buffer sur' : Syntaxe et manipulations avancées
<a name="type_buffer_sur_syntaxe_manipulations_avancees_ELTTEXTE000465"></a>


### Déclarer une variable de type Buffer sur
<a name="declarer_une_variable_type_buffer_sur_ELTPARAGRAPHE000278"></a>
```txt
<Nom de la variable> est un Buffer sur <Taille du buffer>
```
**OU**

```txt
<Nom de la variable 1>, <Nom de la variable 2> sont des Buffers sur <Taille des buffers>
```


**Détail de la syntaxe**


|   |   |
| --- | --- |
| **&lt;Nom de la variable&gt; :** | Nom de la variable à déclarer. |
| **&lt;Taille du buffer&gt; :** | Taille en octets du buffer. |


Remarques :

- Les mots-clés <u><u><u><u>un</u></u></u></u>, <u><u><u><u>une</u></u></u></u> et <u><u><u><u>des</u></u></u></u> ne sont pas obligatoires : ce sont des mots d'agrément.

- Par défaut, une variable de type 'Buffer sur' est remplie avec le caractère '0'.




Exemples : 

```wl
MonBuffer est un Buffer sur 4
MonBuffer = "ABCDE" // MonBuffer contient "ABCD"
MonBuffer = "ZZ"    // MonBuffer contient "ZZCD"
```

<a name="NOTE4_2"></a>


### Manipulations des variables de type 'Buffer sur' (appelés buffers fixes)
<a name="manipulations_des_variables_type_buffer_sur_appeles_buffers_fixes_ELTPARAGRAPHE000322"></a>Les buffers fixes se manipulent de la même manière que les buffers simples. Cependant, quelques différences doivent être prises en compte.

En effet, en cours d'exécution, la taille réelle des données contenues dans la variable de type Buffer n'est pas connue :

- Lors d'une écriture plus longue que la taille de la variable Buffer, l'écriture est tronquée à la taille de la variable Buffer.

- Lors d'une écriture plus petite que la taille de la variable Buffer, la partie non écrite de la variable Buffer conserve sa valeur précédente.




Pour manipuler ce type de variable Buffer, il est conseillé de toujours stocker la taille réelle du buffer dans une variable de type Entier.

Rappel : le type Buffer gère automatiquement sa taille. Lors de l'utilisation d'un buffer fixe, il est recommandé de copier rapidement sa valeur dans un buffer automatique.

```txt
// Utilisation d'une API retournant la taille d'un buffer
bBufferFixe est un Buffer sur 200
nTaille est un entier
// Appel de l'API
nTaille = API(<Nom API>, <Paramètres>, bBufferFixe,200)
// Copie du buffer
bBuffer est un Buffer
bBuffer = Gauche(bBufferFixe, nTaille)
```



