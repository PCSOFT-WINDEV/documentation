
## Comment créer une requête avec une jointure externe ?
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000141"></a>
En langage SQL, une jointure externe permet d'exclure ou d'inclure des enregistrements d'un fichier de données qui ont ou qui n'ont pas de correspondances dans des fichiers liés. 

Par défaut, lors de la création d'une requête entre 2 fichiers de données liés, seuls les enregistrements qui ont une correspondance entre les 2 fichiers sont traités. Pour traiter les enregistrements qui n'ont pas de correspondance, il est nécessaire d'ajouter une **jointure externe**.

Nous allons voir comment effectuer une jointure externe en utilisant : 

- [une requête SQL réalisée à l'aide de l'éditeur de requêtes](#NOTE2_1).

- [une requête réalisée par programmation](#NOTE3_1). 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Requête SQL avec une jointure externe vers un fichier de données (éditeur de requêtes)
<a name="requete_sql_avec_une_jointure_externe_vers_fichier_donnees_editeur_requetes_ELTTEXTE000165"></a>
Cette requête permet de sélectionner les enregistrements d'un fichier de données (fichier principal) avec une correspondance (jointure) vers un autre fichier de données (fichier secondaire ou fichier lié), sachant que tous les enregistrements du fichier principal n'ont pas obligatoirement de correspondance dans le fichier secondaire. 

Dans cet exemple, nous réalisons la sélection des enregistrements du fichier CLIENT (fichier principal) avec la somme des commandes du fichier COMMANDE (fichier secondaire) de chaque client. Certains clients peuvent ne pas avoir de commandes. Il est donc nécessaire d'ajouter dans la requête une **jointure externe** pour traiter les clients qui n'ont pas de commandes.

Les différentes étapes pour créer cette requête SQL avec une jointure externe sont les suivantes : 

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif) parmi les boutons d'accès rapide. 

	- Dans la fenêtre qui s'affiche, cliquez sur "Requêtes". 

	- L'assistant de création d'une requête se lance.




2. Choisissez de créer une requête de sélection (option "Sélection (SELECT)"). <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_jointure%20-%20HC%20N%B0001.gif&type=thumb)

	Passez à l'étape suivante de l'assistant.

3. La fenêtre de description de la requête s'affiche.

4. Donnez un nom et un libellé à la requête : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_jointure%20-%20HC%20N%B0002.gif&type=thumb)


5. Dans la zone de gauche de la fenêtre de description, choisissez les rubriques du fichier de données à manipuler (dans notre exemple, le fichier CLIENT et les rubriques NomClient, Société et Ville puis le fichier COMMANDE et la rubrique TOTALHT). 

6. Double-cliquez sur les noms des rubriques pour les ajouter dans la liste des rubriques de la requête : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_jointure%20-%20HC%20N%B0003.gif&type=thumb)


7. Pour effectuer la somme des commandes, dans la partie droite de l'éditeur, cliquez sur le bouton "Somme". La fenêtre suivante apparaît sous l'éditeur :<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_jointure%20-%20HC%20N%B0004.gif&type=thumb)


8. Validez. La fenêtre de description de la requête est mise à jour : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_jointure%20-%20HC%20N%B0005.gif)


9. Validez la fenêtre de description de la requête. La requête suivante apparaît sous l'éditeur : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Jointure%20-%20HC%20N%B0006.gif)


10. Pour ajouter la jointure externe, double-cliquez sur la zone "Jointure". <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Jointure%20-%20HC%20N%B0006%201.gif)


11. La fenêtre de description de la jointure est affichée. 

12. Pour sélectionner le sens de la jointure externe, cochez la case "inclure..." correspondant au sens souhaité. Dans notre exemple, les enregistrements du fichier CLIENT qui n'ont pas de commandes sont inclus. <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Jointure%20-%20HC%20N%B0007.gif&type=thumb)


13. Validez. La fenêtre de description de la requête est mise à jour. <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_jointure%20-%20HC%20N%B0008.gif)


14. Enregistrez la requête (Ctrl + S). 

15. Visualisez le code SQL en appuyant sur la touche F2 : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_jointure%20-%20HC%20N%B0009.gif)


16. Testez la requête (GO dans les boutons d'accès rapide). 

17. La requête peut être exécutée dans le programme à l'aide de la fonction [HExécuteRequête](../WDLang4/3044080.md). 




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Requête SQL avec une jointure externe en programmation
<a name="requete_sql_avec_une_jointure_externe_programmation_ELTTEXTE000189"></a>
Les requêtes SQL peuvent être écrites directement par programmation dans le code WLangage. Pour cela, il faut : 

1. Créer une variable de type [Source de données](../WDLang4/1514053.md) pour représenter la requête en exécution. 

2. Créer une variable de type chaîne de caractères pour contenir le code SQL de la requête et écrire le code SQL dans cette variable. 

3. Exécuter la requête SQL à l'aide de la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md).

4. Parcourir le résultat à l'aide des fonctions HLitXXX.




Exemple de code


```wl
Src1 est une Source de Données
sCodeSQL est une chaîne

// Sélection de produits dont le prix est supérieur à ...
sCodeSQL = [
SELECT 
	CLIENT.NomClient AS NomClient,	
	CLIENT.Societe AS Societe,	
	CLIENT.Ville AS Ville,	
	SUM(COMMANDE.TotalHT) AS la_somme_TotalHT
FROM 
	CLIENT
	LEFT OUTER JOIN
	COMMANDE
	ON CLIENT.NumClient = COMMANDE.NumClient
GROUP BY 
	CLIENT.NomClient,	
	CLIENT.Societe,	
	CLIENT.Ville
]

HExécuteRequêteSQL(Src1, hRequêteDéfaut, sCodeSQL)
POUR TOUT Src1
	TRACE(Src1.NomClient, Src1.Societe, Src1.la_somme_TotalHT)

FIN
```







