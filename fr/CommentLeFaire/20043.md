
## Comment faire une requete SQL pour filtrer des enregistrements ? 
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>
Pour effectuer un filtre (ou une sélection) d'enregistrements provenant d'un fichier de données, il est possible d'effectuer une boucle de parcours et d'utiliser la fonction [HFiltre](../WDLang4/3044100.md). 

Un moyen plus efficace pour effectuer ce filtre (ou sélection) consiste à utiliser une requête SQL.

Nous allons voir comment effectuer un filtre en utilisant : 

- [une requête SQL réalisée à l'aide de l'éditeur de requêtes](#NOTE2_1).

- [une requête réalisée par programmation](#NOTE3_1). 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Requête SQL avec une sélection d'enregistrements du fichier de données
<a name="requete_sql_avec_une_selection_enregistrements_fichier_donnees_ELTTEXTE000168"></a>
Cette requête permet de sélectionner les enregistrements d'un fichier de données correspondant à une condition de sélection. 

Dans cet exemple, nous réalisons la sélection des enregistrements du fichier CLIENT dont la ville est égale à un paramètre.

Les différentes étapes pour créer cette requête SQL avec un filtre sont les suivantes : 

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif)
 parmi les boutons d'accès rapide. 

	- Dans la fenêtre qui s'affiche, cliquez sur "Requêtes". 

	- L'assistant de création d'une requête se lance.




2. Choisissez de créer une requête de sélection (option "Sélection (SELECT)"). 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0001.gif&type=thumb)
]
	Passez à l'étape suivante de l'assistant.

3. La fenêtre de description de la requête s'affiche.

4. Donnez un nom et un libellé à la requête : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0002.gif&type=thumb)


5. Dans la zone de gauche de la fenêtre de description, choisissez les rubriques du fichier de données à manipuler (dans notre exemple, le fichier CLIENT et les rubriques NomClient, Société et Ville). 

6. Double-cliquez sur les noms des rubriques pour les ajouter dans la liste des rubriques de la requête : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0003.gif)


7. Pour effectuer le filtre (sélection), dans la partie droite de l'éditeur, cliquez sur le bouton "Condition de sélection".
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0004.gif)


8. Cliquez sur "Nouvelle condition...". 

9. Dans la fenêtre qui s'affiche : 

	- Sélectionnez l'opération ("est égal" dans notre exemple).

	- Sélectionnez "Paramètre" pour pouvoir passer à la requête une valeur saisie par l'utilisateur.

	- Donnez un nom au paramètre. 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0005.gif)





10. Validez. La fenêtre de description de la requête est mise à jour : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0006.gif)


11. Validez la fenêtre de description de la requête. La requête apparaît sous l'éditeur : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0007.gif)


12. Enregistrez la requête (Ctrl + S). 

13. Visualisez le code SQL en appuyant sur la touche F2 : 
![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0008.gif)


14. Testez la requête (GO dans les boutons d'accès rapide). 

15. La requête peut être exécutée dans le programme à l'aide de la fonction [HExécuteRequête](../WDLang4/3044080.md). Il est nécessaire d'initialiser le(s) paramètre(s) attendu(s) dans le code. 

16. Exemple de code d'appel depuis le clic d'un bouton : 
	
	```wl
	REQ_Filtre.ParamVille = "Paris"
	HExécuteRequête(REQ_Filtre)
	```





<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Requête SQL avec un filtre en programmation
<a name="requete_sql_avec_filtre_programmation_ELTTEXTE000192"></a>
Les requêtes SQL peuvent être écrites directement par programmation dans le code WLangage. Pour cela, il faut : 

1. Créer une variable de type [Source de données](../WDLang4/1514053.md) pour représenter la requête en exécution. 

2. Créer une variable de type chaîne de caractères pour contenir le code SQL de la requête et écrire le code SQL dans cette variable. 

3. Exécuter la requête SQL à l'aide de la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md).

4. Parcourir le résultat à l'aide des fonctions HLITXXX.




Exemple de code : 

```wl
Src1 est une Source de Données
sCodeSQL est une chaîne

// Sélection de produits dont le prix est supérieur à ...
sCodeSQL = [
SELECT PRODUIT.Reference AS Reference,	
	PRODUIT.Libprod AS Libprod,	
	PRODUIT.Prixht AS Prixht
FROM PRODUIT
WHERE PRODUIT.Prixht > %1
]

moPrix est un monétaire
moPrix = SAI_PRIX // valeur provenant d'un champ de saisie

sCodeSQL = ChaîneConstruit(sCodeSQL, moPrix)

HExécuteRequêteSQL(Src1, hRequêteDéfaut, sCodeSQL)
POUR TOUT Src1
	TRACE(Src1.Reference , Src1.Libprod, Src1.Prixht)

FIN
```





