
## Comment faire une requete SQL pour obtenir un somme ? 
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>
Pour effectuer une somme de valeurs provenant d'un fichier de données, il est possible d'effectuer une boucle de parcours et de cumuler une valeur dans une variable de type numérique. 

Un moyen plus efficace pour effectuer cette somme consiste à utiliser une requête SQL.

Nous allons voir comment effectuer une somme en utilisant : 

- une requête SQL réalisée à l'aide de l'éditeur de requêtes : 

	- [Requête SQL de type somme sur la totalité du fichier de données](#NOTE2_1).

	- [Requête SQL de type somme sur un regroupement](#NOTE3_1).




- [une requête réalisée par programmation](#NOTE4_1). 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Requête SQL de type Somme sur la totalité du fichier de données
<a name="requete_sql_type_somme_sur_totalite_fichier_donnees_ELTTEXTE000186"></a>
Une requête de type Somme permet de cumuler une valeur présente dans tous les enregistrements d'un fichier de données. 

Dans cet exemple, nous réalisons la somme de toutes les commandes du fichier COMMANDE.

Les différentes étapes pour créer cette requête SQL de type somme sont les suivantes : 

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif) parmi les boutons d'accès rapide. 

	- Dans la fenêtre qui s'affiche, cliquez sur "Requêtes". 

	- L'assistant de création d'une requête se lance.




2. Choisissez de créer une requête de sélection (option "Sélection (SELECT)"). <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0001.gif&type=thumb)

	Passez à l'étape suivante de l'assistant.

3. La fenêtre de description de la requête s'affiche.

4. Donnez un nom et un libellé à la requête : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0002.gif&type=thumb)


5. Dans la zone de gauche de la fenêtre de description, choisissez la rubrique du fichier de données pour laquelle la somme doit être effectuée (TotalHT dans notre exemple). 

6. Double-cliquez sur le nom de la rubrique pour l'ajouter dans la liste des rubriques de la requête : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0003.gif)


7. Dans la partie droite de l'éditeur, cliquez sur le bouton "Somme". La fenêtre suivante s'affiche : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0004.gif)


8. Validez. La fenêtre de description de la requête est mise à jour : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0005.gif)


9. Validez la fenêtre de description de la requête. La requête apparaît sous l'éditeur : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0006.gif)


10. Enregistrez la requête (Ctrl + S). 

11. Visualisez le code SQL en appuyant sur la touche F2 : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0007.gif)


12. Testez la requête (GO dans les boutons d'accès rapide). 

13. La requête peut être exécutée dans le programme à l'aide de la fonction [HExécuteRequête](../WDLang4/3044080.md).




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Requête SQL de type somme sur un regroupement
<a name="requete_sql_type_somme_sur_regroupement_ELTTEXTE000210"></a>
Il est possible de créer une requête qui effectue le cumul d'une valeur suivant un critère de regroupement. 

Dans cet exemple, nous allons réaliser la somme des commandes par mode de livraison.

Les étapes pour réaliser une requête de type Somme sur un regroupement sont les suivantes : 

1. Créez une requête de type Somme (voir paragraphe précédent). 

2. Sélectionnez dans le fichier de données la rubrique servant d'argument de regroupement. Dans notre exemple, nous allons choisir le libellé du mode de livraison. 

3. Ajoutez cette rubrique aux rubriques de la requête (double-cliquez sur le nom de la rubrique par exemple). <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0008.gif)


4. Validez la fenêtre de description de la requête. La requête apparaît sous l'éditeur : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0009.gif)


5. Enregistrez la requête (Ctrl + S). 

6. Visualisez le code SQL en appuyant sur la touche F2 : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0010.gif)


7. Testez la requête (GO dans les boutons d'accès rapide). 

8. La requête peut être exécutée dans le programme à l'aide de la fonction [HExécuteRequête](../WDLang4/3044080.md).








<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Requête SQL de type somme sur un regroupement en programmation
<a name="requete_sql_type_somme_sur_regroupement_programmation_ELTTEXTE000234"></a>
Les requêtes SQL peuvent être écrites directement par programmation dans le code WLangage. Pour cela, il faut : 

1. Créer une variable de type [Source de données](../WDLang4/1514053.md) pour représenter la requête en exécution. 

2. Créer une variable de type chaîne de caractères pour contenir le code SQL de la requête et écrire le code SQL dans cette variable. 

3. Exécuter la requête SQL à l'aide de la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md).

4. Parcourir le résultat à l'aide des fonctions HLITXXX.




**Exemple de code**


```wl
Src1 est une Source de Données
sCodeSQL est une chaîne

// Somme des commandes par mode de règlement
sCodeSQL = [
SELECT REGLEMENT.LibReglement, SUM(COMMANDE.TotalHT) AS SommeCommandes
FROM COMMANDE, REGLEMENT
WHERE COMMANDE.IDReglement=REGLEMENT.IDReglement
GROUP BY LibReglement
]

HExécuteRequêteSQL(Src1, hRequêteDéfaut, sCodeSQL)
POUR TOUT Src1
	TRACE(Src1.LibReglement, Src1.SommeCommandes)
FIN
```





