
## Comment faire une requête SQL pour obtenir un TOP 10 ?
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000147"></a>
Pour effectuer un **TOP 10** (ou les 10 meilleurs d'une sélection) d'enregistrements provenant d'un fichier de données, il est possible d'effectuer une boucle de parcours puis d'utiliser une condition pour sortir de la boucle au bout du 10ème passage. 

Un moyen plus efficace pour effectuer ce **TOP 10** consiste à utiliser une requête SQL.

Nous allons voir comment effectuer un **TOP 10** en utilisant : 

- [une requête SQL réalisée à l'aide de l'éditeur de requêtes](#NOTE2_1).

- [une requête réalisée par programmation](#NOTE3_1). 




Ben entendu, il est possible d'appliquer cette méthode à un TOP 3, ou tout autre **TOP** correspondant à une sélection des N meilleurs ou moins bons résultats.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Requête SQL TOP 10 sous l'éditeur de requêtes
<a name="requete_sql_top_10_sous_editeur_requetes_ELTTEXTE000171"></a>
Cette requête permet de réaliser un **TOP 10**, c'est-à-dire les 10 meilleurs résultats d'une sélection d'enregistrements d'un fichier de données. 

Dans cet exemple, nous réalisons le **TOP 10** des 10 meilleures commandes.

Les différentes étapes pour créer cette requête SQL avec un filtre sont les suivantes : 

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif) parmi les boutons d'accès rapide. 

	- Dans la fenêtre qui s'affiche, cliquez sur "Requêtes". 

	- L'assistant de création d'une requête se lance.




2. Choisissez de créer une requête de sélection (option "Sélection (SELECT)"). <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0001.gif&type=thumb)

	Passez à l'étape suivante de l'assistant.

3. La fenêtre de description de la requête s'affiche.

4. Donnez un nom et un libellé à la requête : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0002.gif&type=thumb)


5. Dans la zone de gauche de la fenêtre de description, choisissez les rubriques du fichier de données à manipuler (dans notre exemple, le fichier COMMANDE et les rubriques NumCommande et TotalTTC). 

6. Double-cliquez sur les noms des rubriques pour les ajouter dans la liste des rubriques de la requête : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0003.gif)


7. Un **TOP** est basé sur un tri. Dans l'exemple, nous allons trier les commandes sur la rubrique TotalTTC par ordre décroissant. Pour effectuer ce tri, dans la partie droite de l'éditeur, cliquez sur le bouton "Trier".<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0004.gif)


8. Dans le menu qui s'affiche, sélectionnez "Trier sur la rubrique sélectionnée". 

9. Dans la fenêtre qui s'affiche : 

	- Sélectionnez l'ordre de tri ("Décroissant" dans notre exemple). <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0005.gif)


	- Validez. 

10. Pour effectuer le **TOP**, dans la partie droite de l'éditeur, cliquez sur le bouton "Les n premiers...".<br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0003%201.gif)


11. Dans la fenêtre qui s'affiche : 

	- Sélectionnez l'option "Sélectionner les premiers enregistrements (TOP)".

	- Saisissez le nombre d'enregistrements à sélectionner (dans notre exemple, 10 pour un **TOP 10**). <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0006.gif)





12. Validez la fenêtre. 

13. Validez la fenêtre de description de la requête. La requête apparaît sous l'éditeur : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0007.gif)


14. Enregistrez la requête (Ctrl + S). 

15. Visualisez le code SQL en appuyant sur la touche F2 : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_TOP10%20-%20HC%20N%B0008.gif)


16. Testez la requête (GO dans les boutons d'accès rapide). 

17. La requête peut être exécutée dans le programme à l'aide de la fonction [HExécuteRequête](../WDLang4/3044080.md). 




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Requête SQL avec un "TOP n" en programmation
<a name="requete_sql_avec_top_programmation_ELTTEXTE000195"></a>
Les requêtes SQL peuvent être écrites directement par programmation dans le code WLangage. Pour cela, il faut : 

1. Créer une variable de type [Source de données](../WDLang4/1514053.md) pour représenter la requête en exécution. 

2. Créer une variable de type chaîne de caractères pour contenir le code SQL de la requête et écrire le code SQL dans cette variable. 

3. Exécuter la requête SQL à l'aide de la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md).

4. Parcourir le résultat à l'aide des fonctions HLITXXX.




Exemple de code


```wl
Src1 est une Source de Données
sCodeSQL est une chaîne

// Sélection des 5 meilleurs clients basés sur la somme des commandes ...
sCodeSQL = [
SELECT TOP 5 
	CLIENT.NumClient AS NumClient,
	CLIENT.NomClient AS NomClient,
	CLIENT.Ville AS Ville,
	SUM(COMMANDE.TotalTTC) AS la_somme_TotalTTC
FROM 
	CLIENT,	
	COMMANDE
WHERE 
	CLIENT.NumClient = COMMANDE.NumClient

GROUP BY 
	CLIENT.NumClient,
	CLIENT.NomClient,
	CLIENT.Ville
ORDER BY 
	la_somme_TotalTTC DESC
]

HExécuteRequêteSQL(Src1, hRequêteDéfaut, sCodeSQL)
POUR TOUT Src1
	TRACE(Src1.NumClient, Src1.NomClient, Src1.Ville)
FIN
```





