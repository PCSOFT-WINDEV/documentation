
## Comment faire une requête SQL pour compter ?
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>
Pour effectuer un comptage d'enregistrements dans un fichier de données, il est possible d'effectuer une boucle de parcours et d'incrémenter une variable de type entier. 

Un moyen plus efficace pour effectuer ce comptage consiste à utiliser une requête SQL.

Nous allons voir comment effectuer un comptage en utilisant : 

- [Méthode 1 : une requête SQL réalisée à l'aide de l'éditeur de requêtes](#NOTE2_1).

	- [Requête SQL de comptage sur la totalité du fichier de données](#NOTE2_1). 

	- [Requête SQL de comptage sur un regroupement](#NOTE3_1). 




- [Méthode 2 : une requête réalisée par programmation](#NOTE4_1).




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Requête SQL de comptage sur la totalité du fichier de données
<a name="requete_sql_comptage_sur_totalite_fichier_donnees_ELTTEXTE000191"></a>
Cette requête de comptage permet de compter tous les enregistrements d'un fichier de données. Les images présentent le comptage de tous les enregistrements du fichier CLIENT.

Les différentes étapes pour créer cette requête SQL de comptage sont : 

1. Cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=ico_nouveau.gif) parmi les boutons d'accès rapide. 

	- Dans la fenêtre qui s'affiche, cliquez sur "Requêtes". 

	- L'assistant de création d'une requête se lance.




2. Choisissez de créer une requête de sélection (option "Sélection (SELECT)"). <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_Comptage%20-%20HC%20N%B0001.gif&type=thumb)

	Passez à l'étape suivante de l'assistant.

3. La fenêtre de description de la requête s'affiche.

4. Donnez un nom et un libellé à la requête : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_Comptage%20-%20HC%20N%B0002.gif&type=thumb)


5. Choisissez une rubrique (identifiant par exemple) dans le fichier de données où le comptage doit être réalisé. 

6. Ajoutez cette rubrique à la liste des rubriques de la requête.   <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_Comptage%20-%20HC%20N%B0003.gif)


7. Dans la partie droite de l'éditeur, cliquez sur le bouton "Comptage". Dans le menu qui s'affiche, sélectionnez "Compter sur la rubrique sélectionnée" : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_Comptage%20-%20HC%20N%B0004.gif)
La fenêtre suivante s'affiche : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_Comptage%20-%20HC%20N%B0005.gif&type=thumb)


8. Validez. La fenêtre de description de la requête est mise à jour : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_comptage%20-%20HC%20N%B0006.gif)


9. Validez la fenêtre de description de la requête. La requête apparaît sous l'éditeur : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_comptage%20-%20HC%20N%B0007.gif)


10. Enregistrez la requête (Ctrl + S). 

11. Visualisez le code SQL en appuyant sur la touche F2 : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_comptage%20-%20HC%20N%B0008.gif)


12. Testez la requête (GO dans les boutons d'accès rapide). 

13. La requête peut être exécutée dans le programme à l'aide de la fonction [HExécuteRequête](../WDLang4/3044080.md).




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Requête SQL de comptage sur un regroupement
<a name="requete_sql_comptage_sur_regroupement_ELTTEXTE000215"></a>
Il est possible de créer une requête qui compte les enregistrements suivant un critère de regroupement. 

Dans cet exemple, nous allons réaliser le comptage du nombre de clients par département.

Les étapes pour réaliser une requête de type Comptage sur un regroupement sont les suivantes : 

1. Créez une requête de type Comptage (voir paragraphe précédent).

2. Sélectionnez dans le fichier de données la rubrique servant d'argument de regroupement. Dans notre exemple, nous allons choisir le code postal.

3. Ajoutez cette rubrique aux rubriques de la requête (double-cliquez sur le nom de la rubrique par exemple). <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_comptage%20-%20HC%20N%B0009.gif)


4. Nous allons ajouter une nouvelle action, pour réaliser un regroupement seulement sur le département. Dans la partie droite de la fenêtre de description, cliquez sur "Année, département" et sélectionnez l'option "Département". <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_comptage%20-%20HC%20N%B0010.gif)
La fenêtre suivante s'affiche : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_comptage%20-%20HC%20N%B0011.gif)


5. Validez. La fenêtre de description de la requête est mise à jour : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_comptage%20-%20HC%20N%B0012.gif)


6. Validez la fenêtre de description de la requête. La requête apparaît sous l'éditeur : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requete_comptage%20-%20HC%20N%B0013.gif)


7. Enregistrez la requête (Ctrl + S). 

8. Visualisez le code SQL en appuyant sur la touche F2 : <br>![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=CLF_Requ%EAte_comptage%20-%20HC%20N%B0014.gif)


9. Testez la requête (GO dans les boutons d'accès rapide). 

10. La requête peut être exécutée dans le programme à l'aide de la fonction [HExécuteRequête](../WDLang4/3044080.md).








<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Requête SQL de comptage sur un regroupement en programmation
<a name="requete_sql_comptage_sur_regroupement_programmation_ELTTEXTE000239"></a>
Les requêtes SQL peuvent être écrites directement par programmation dans le code. Pour cela, il faut : 

1. Créer une variable de type Source de données pour représenter la requête en exécution

2. Créer une variable de type chaîne de caractères pour contenir le code SQL et écrire le code SQL dans cette variable

3. Exécuter la requête SQL à l'aide de la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md)

4. Parcourir le résultat à l'aide des fonctions HLITXXX.




**Exemple de code**


```wl
Src1 est une Source de Données
sCodeSQL est une chaîne

// Compte le nombre de commandes par type de règlement
sCodeSQL = [
SELECT REGLEMENT.LibReglement, COUNT(COMMANDE.IDCommande) AS NombreCommandes
FROM COMMANDE, REGLEMENT
WHERE COMMANDE.IDReglement=REGLEMENT.IDReglement
GROUP BY LibReglement
]

HexecuteRequêteSQL(Src1, hRequêteDéfaut, sCodeSQL)
POUR TOUT Src1
	TRACE(Src1.LibReglement, Src1.NombreCommandes)
FIN
```







