


## GraveurAjouteRépertoire (Fonction)

***En anglais : BurnerAddDirectory***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Ajoute la totalité des fichiers d'un répertoire à la compilation. Lorsque tous les fichiers voulus seront ajoutés à la compilation, la gravure du CD ou du DVD pourra être réalisée (fonction [GraveurEnregistre](../WDLang6/3061006.md)).

Pour chaque fichier ajouté, la fonction **GraveurAjouteRépertoire** appelle automatiquement une procédure spécifique écrite en WLangage. Cette procédure permet de manipuler le fichier en cours.

**Remarque** : Pour ajouter un fichier à la compilation, utilisez la fonction [GraveurAjouteFichier](../WDLang6/3061001.md).
<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple
<a class="notetitle" target="_blank" href="$DOC$=1000003061002&name=graveurajouterepertoire_fonction&product=WD">Voir des exemples supplémentaires</a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Code Utilisateur (MCU)](https://doc.pcsoft.fr/ext/images/fr/MCU.png) 
```wl
// Gravure d'un CD de type données 
GraveurTypeMédia(médiaType_CD_ROM_XA) 
// Ajout des fichiers présents dans "C:\MonRépertoire" et dans ses sous-répertoires
// L'ajout peut être interrompu avec la touche Echap du clavier
ResAjout est un booléen 
ResAjout = GraveurAjouteRépertoire("C:\MonRépertoire", ...
	graveurAjoutRécursif + graveurAjoutInterruptible)
```
<a name="Exemple2"></a>

```wl
// Gravure d'un CD de type données 
GraveurTypeMédia(médiaType_CD_ROM_XA) 
// Ajout des fichiers présents dans "C:\MonRépertoire"
// La procédure ProcAjoutFichier sera appelée automatiquement pour chaque fichier ajouté
ResAjout est un booléen 
ResAjout = GraveurAjouteRépertoire("C:\MonRépertoire", "", ProcAjoutFichier)
// Pour visualiser cet exemple en totalité, cliquez sur le lien "Exemple"
```
<a name="Exemple3"></a>

```wl
// Gravure d'un CD de type audio
GraveurTypeMédia(médiaType_CDDA_CDROM) 
// Ajout des fichiers de type ".WAV" présents dans "C:\MesMusiques"
ResAjout est un booléen 
ResAjout = GraveurAjouteRépertoire("C:\MesMusiques\*.WAV")  
// Pour visualiser cet exemple en totalité, cliquez sur le lien "Exemple"
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

`<Résultat> = GraveurAjouteRépertoire(<Répertoire à ajouter> [, <Répertoire sur le CD ou DVD> [, <Procédure WLangage> [, <Pointeur>]]] [, <Options>])`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si les fichiers du répertoire ont été ajoutés à la compilation, 

- <u><u><u><u>Faux</u></u></u></u> dans le cas contraire. Pour connaître le libellé de l'erreur, utilisez la fonction [ErreurInfo](../WDLang1/3013008.md).


**Remarque** : Il est nécessaire qu'un CD ou DVD soit présent dans le graveur. Ce CD ou DVD doit contenir assez d'espace pour graver une nouvelle session.

**`<Répertoire à ajouter> : (Chaîne de caractères)`**

Chemin et nom générique des fichiers à ajouter dans la compilation (260 caractères maximum). Ce chemin peut être un chemin complet, relatif ou de type UNC.
Les caractères génériques (\* et ?) sont autorisés.
Dans le cas d'une compilation de type audio, ces fichiers doivent correspondre à des fichiers ".WAV" (44100 Hz, 16 bits).


**`<Répertoire sur le CD ou DVD> : (Chaîne de caractères optionnelle)`**

Chemin du répertoire sur le CD ou sur le DVD. Ce chemin doit commencer par le caractère "antislash" ("\\"). Par défaut, l'arborescence du répertoire sera recréée à partir de la racine du CD/DVD.
Dans le cas d'une compilation de type audio, ce paramètre n'est pas pris en compte. En effet, l'ensemble des fichiers sera automatiquement ajouté à la racine du CD/DVD.

**`<Procédure WLangage> : (Nom de procédure optionnelle)`**

Nom de la procédure WLangage ("callback") appelée pour chaque fichier ajouté. Cette procédure permet de manipuler le fichier en cours.
Cette procédure est de la forme :

```txt
PROCEDURE <Nom de la procédure>(<Chemin>, <Nom du fichier>, <Change>, 
<Pointeur de la procédure>)
```

Les paramètres de cette procédure sont optionnels.
Il n'est pas nécessaire de passer des paramètres à cette procédure. En effet, ces paramètres sont renseignés automatiquement à chaque fichier traité.
Selon la valeur renvoyée par cette procédure, le fichier traité peut être ajouté ou non à la compilation (voir Notes).

**`<Pointeur> : (Entier optionnel)`**

Pointeur passé à la procédure &lt;Nom de la procédure&gt;.

**`<Options> : (Combinaison de constantes de type Entier, paramètre optionnel)`**

Type de parcours effectué pour l'ajout des fichiers des répertoires :


|   |   |
| --- | --- |
| *graveurAjoutInterruptible* | Le parcours peut être interrompu en utilisant la touche ECHAP.<br> |
| *graveurAjoutNonRécursif* | Le parcours est non récursif. Les sous-répertoires ne sont pas pris en compte. |
| *graveurAjoutRécursif*<br>(Valeur par défaut) | Le parcours est récursif. Les sous-répertoires sont automatiquement pris en compte. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Procédure manipulant chaque fichier ajouté
<a name="procedure_manipulant_chaque_fichier_ajoute_ELTPARAGRAPHE000110"></a>Pour chaque fichier ajouté, la fonction **GraveurAjouteRépertoire** appelle automatiquement la procédure &lt;Nom de la procédure&gt;. Cette procédure est une procédure locale ou globale.

Cette procédure doit être déclarée de la façon suivante :

```txt
PROCEDURE <Nom de la procédure> (<Chemin>, <Nom du fichier>, <Change>, <Pointeur de la procédure>)
```


- &lt;Chemin&gt; est le chemin du fichier manipulé (il contient toujours un "\\" à la fin; par exemple, "C:\\Fichiers\\").

- &lt;Nom du fichier&gt; est une chaîne de caractères contenant le nom du fichier trouvé.

- &lt;Change&gt; est une constante qui vaut :

	- *flPremierFichier* lorsque le fichier est le premier listé dans le &lt;Chemin&gt;,

	- *flChangeRépertoire* lorsque le fichier est le premier listé dans un sous-répertoire de &lt;Chemin&gt; (cela signifie qu'il y a eu changement de répertoire),

	- *flFichier* dans tous les autres cas.


 Voici les différentes valeurs pouvant être prises par &lt;Change&gt; :
	

| Fichier en cours | &lt;Change&gt; |
| --- | --- |
| Rep\\Fichier 1 | *flPremierFichier* |
| Rep\\Fichier n | *flFichier* |
| Rep\\SousRep 1\\Fichier 1 | *flChangeRépertoire* |
| Rep\\SousRep 1\\Fichier m | *flFichier* |
| Rep\\SousRep 2\\Fichier 1 | *flChangeRépertoire* |
| Rep\\SousRep 2\\Fichier x | *flFichier* |



- &lt;Pointeur de la procédure&gt; est un entier qui vaut la valeur passé dans le paramètre &lt;Pointeur&gt; de la fonction **GraveurAjouteRépertoire**. Si le paramètre &lt;Pointeur&gt; n'est pas précisé, &lt;Pointeur&gt; vaut 0.




Pour récupérer la valeur du &lt;Pointeur de la procédure&gt;, affectez la valeur du &lt;Pointeur de la procédure&gt; à la valeur du &lt;Pointeur&gt; dans la procédure avec la fonction [Transfert](../WDLang1/3014015.md).

**Remarque** : Les paramètres de cette procédure sont optionnels : il est possible par exemple de ne spécifier que le nom et le chemin.

Indiquez si nécessaire la valeur de retour de la procédure à l'aide du mot-clé [RENVOYER](../Motscles/1510007.md). Les différentes valeurs possibles sont les suivantes :

- **0** : le fichier n'est pas ajouté à la compilation et l'énumération des fichiers s'arrête.

- **1** : le fichier est ajouté à la compilation et l'énumération des fichiers continue.

- ** 2** : le fichier n'est pas ajouté à la compilation et l'énumération des fichiers continue.




Exemple :

```wl
PROCEDURE AjoutElément(Répertoire, Nom, Change)
Trace(Répertoire + TAB, Nom + TAB, Change + TAB)
// Graver le fichier et continuer énumération
RENVOYER 1
// Ne pas graver le fichier et s'arrêter
// RENVOYER 0
// Ne pas graver le fichier et continuer
// RENVOYER 2
```

<a name="NOTE0_2"></a>


### Prise en compte des fichiers listés
<a name="prise_compte_des_fichiers_listes_ELTPARAGRAPHE000186"></a>Pour chaque fichier listé, il est possible :

- soit d'ajouter le fichier à la compilation et de continuer l'énumération des fichiers. Utilisez la ligne suivante dans la procédure &lt;Nom de la procédure&gt; :
	
	```wl
	RENVOYER  1
	```


- soit de ne pas ajouter le fichier à la compilation et de continuer l'énumération des fichiers. Utilisez la ligne suivante dans la procédure &lt;Nom de la procédure&gt; : 
	
	```wl
	RENVOYER 2
	```


- soit de ne pas ajouter le fichier à la compilation et d'arrêter l'énumération des fichiers. Utilisez la ligne suivante dans la procédure &lt;Nom de la procédure&gt; : 
	
	```wl
	RENVOYER 0
	```





Si la procédure &lt;Nom de la procédure&gt; ne retourne aucune valeur, le fichier est ajouté à la compilation et l'énumération des fichiers continue.
<a name="NOTE0_3"></a>


### Compilation
<a name="compilation_ELTPARAGRAPHE000205"></a>Une compilation correspond à l'ensemble des fichiers à graver sur un CD ou un DVD. Cette compilation sera prise en compte lors du prochain appel de la fonction [GraveurEnregistre](../WDLang6/3061006.md).

Une compilation est automatiquement créée lors du premier appel de la fonction [GraveurAjouteFichier](../WDLang6/3061001.md) ou de la fonction **GraveurAjouteRépertoire**. Une seule compilation à la fois peut être créée.

Une compilation est automatiquement supprimée :

- soit lors du changement du type du CD/DVD à graver (fonction [GraveurTypeMédia](../WDLang6/3061013.md)).

- soit lors de la sélection du graveur utilisé par défaut (fonction [GraveurSélectionne](../WDLang6/3061012.md)).

- soit après l'appel de la fonction [GraveurEnregistre](../WDLang6/3061006.md) (uniquement si la gravure a été lancée, &lt;Résultat&gt; à <u><u><u><u>Vrai</u></u></u></u>).

- soit lors de l'annulation de la gravure (fonction [GraveurAnnuleGravure](../WDLang6/3061003.md)).

- soit lors de la fermeture de l'application WINDEV ou du site WEBDEV en cours.



<a name="NOTE0_4"></a>


### Ajout de plusieurs fichiers identiques
<a name="ajout_plusieurs_fichiers_identiques_ELTPARAGRAPHE000247"></a>Si le même fichier est ajouté plusieurs fois à la compilation :

- dans le cas d'un CD/DVD de type audio : ce fichier sera présent sur le CD/DVD autant de fois qu'il a été ajouté.

- dans le cas d'un CD/DVD de type données : seul le dernier fichier ajouté (même nom, même répertoire de destination) sera présent sur le CD/DVD.



<a name="NOTE0_5"></a>


### Configuration nécessaire 
<a name="configuration_necessaire_ELTPARAGRAPHE000257"></a>![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png) La gravure de CD est disponible uniquement sous Windows XP et supérieur. La gravure de DVD est disponible sous Windows Vista, et sous Windows XP en utilisant la mise à jour KB932716 pour Windows XP (cette mise à jour doit être téléchargée depuis le site de Microsoft et installée car elle n'est pas prise en compte par le mécanisme de Live Update). 

<a name="XComposante"></a>

## Composante :
wd280grv.dll
