


## gpwOuvreConnexion (Fonction)

***En anglais : gpwOpenConnection***



<a name="XUtilisation"></a>
<a name="Utilisation"></a>
<a name="description"></a>
Ouvre une connexion à une base de données spécifique Client/Serveur pour gérer les fichiers du groupware utilisateur en mode Client/Serveur. La connexion reste ouverte jusqu'à la fin de l'application.

La fonction **gpwOuvreConnexion** permet de définir et ouvrir une connexion pour les fichiers de données du groupware utilisateur. Pour utiliser la même connexion sur tous les fichiers de données de l'application, il suffit d'utiliser la fonction [HChangeConnexion](../WDLang4/3044150.md). Ensuite, la fonction [gpwOuvre](../WDLang6/3041002.md) permet d'indiquer le positionnement des fichiers de données permettant de gérer les droits, et des fichiers de données permettant d'identifier les utilisateurs.


<a name="Exemple1"></a>
<a name="sample_code"></a>

## Exemple


```wl
// Utilisation des fichiers du groupware utilisateur avec une base de données MySQL 
SI gpwOuvreConnexion("gpwCx", "Test", "MotPasseMySQL", ... 
	"Serveur_apollon", "TEST", hAccèsNatifMySQL) = Faux ALORS 
	Erreur(HErreurInfo()) 
SINON 
	// Les fichiers de données du groupware utilisateur 
	// sont automatiquement créés 
	// si l'utilisateur a les droits sur MySQL. 
	nRes est un entier = gpwOuvre() 
	// Si le login a échoué 
	SI nRes <> gpwOk ALORS 
		SELON nRes 
			CAS gpwErreur : 
				Erreur("Erreur à l'initialisation.", ErreurInfo()) 
			CAS gpwUtilisateurInconnu : 
				Erreur("Utilisateur inconnu.") 
			CAS gpwMotPasseInvalide : 
				Erreur("Mot de passe invalide.") 
		FIN 
	FIN 
	// Utilisation de la même connexion pour tous les fichiers de données 
	HChangeConnexion("*", "gpwCx") 
	Trace(HNbEnr(CEDEX)) 
FIN
```
<a name="Exemple2"></a>

```wl
// Changer le mot de passe des fichiers de données du groupware utilisateur 
// par programmation
// Exemple avec le fichier de données GPWUTILISATEUR
gpwInitAnalyse()
GPWUTILISATEUR est une Source de Données
CNX_GPWu_HFCS est une Connexion
sMotDePasseGPWu est une chaîne = "PCSGPW2001"

// Paramètres de la connexion
CNX_GPWu_HFCS.Provider = hAccèsHFClientServeur
CNX_GPWu_HFCS.Utilisateur = "UserServerHf"
CNX_GPWu_HFCS.MotDePasse = "MotDePasseServerHF"
CNX_GPWu_HFCS.Serveur = "ServeurHF"
CNX_GPWu_HFCS.BaseDeDonnées = "GPWu"
CNX_GPWu_HFCS.Cryptage = hCryptageNon

// Ouverture de la connexion
gpwOuvreConnexion(CNX_GPWu_HFCS)
HChangeConnexion(GPWUTILISATEUR, CNX_GPWu_HFCS)
HPasse(GPWUTILISATEUR, sMotDePasseGPWu)
HCréationSiInexistant(GPWUTILISATEUR)
HChangeMotDePasse(GPWUTILISATEUR, "TEST")

CAS ERREUR:
Erreur(HErreurInfo() + RC + ErreurInfo())
```

<a name="XSYNTAXE"></a>
<a name="SYNTAXE1"></a>

## Syntaxe

### Définir et ouvrir une connexion

`<Résultat> = gpwOuvreConnexion(<Nom de la connexion> , <Nom de l'utilisateur> [, <Mot de passe>] , <Source des données> [, <Base de données>] , <Provider OLE DB ou Connecteur Natif> [, <Accès> [, <Informations étendues>]] , <Options supplémentaires>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'opération a été réalisée, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'identifier l'erreur. 


L'ouverture effective de la connexion n'est pas réalisée par la fonction **gpwOuvreConnexion**. La fonction peut renvoyer <u><u><u><u>Vrai</u></u></u></u> même si les valeurs passées en paramètre sont incorrectes. 

Utilisez la fonction [gpwOuvre](../WDLang6/3041002.md) pour indiquer le positionnement des fichiers de données permettant de gérer les droits, et les fichiers de données permettant d'identifier les utilisateurs. Les répertoires indiqués doivent être relatifs au répertoire du serveur.

**`<Nom de la connexion> : (Chaîne de caractères)`**

Nom de la nouvelle connexion à définir et à ouvrir. Ce nom ne doit pas être déjà utilisé par une autre connexion (connexion définie dans l'analyse, ou définie avec la fonction [HOuvreConnexion](../WDLang4/3044107.md) ou [HDécritConnexion](../WDLang4/3044205.md)).

**`<Nom de l'utilisateur> : (Chaîne de caractères)`**

Nom de l'utilisateur utilisé pour se connecter à la base de données Client/Serveur. Ce paramètre peut être récupéré grâce à la propriété [CxUtilisateur](../Proprietes/2512026.md).

**`<Mot de passe> : (Chaîne de caractères optionnelle)`**

Mot de passe de la connexion à la base de données Client/Serveur (si ce mot de passe existe). Si aucun mot de passe n'est nécessaire, utilisez une chaîne vide ("") ou le mot-clé NULL.

**`<Source des données> : (Chaîne de caractères)`**

Chemin complet de la source de données. La connexion sera créée et ouverte pour cette source de données. Ce paramètre peut être récupéré grâce à la propriété [CxBaseDeDonnées](../Proprietes/2512047.md).

**`<Base de données> : (Chaîne de caractères optionnelle)`**

Nom de la base de données à utiliser sur la source de données. Si ce paramètre n'est pas nécessaire, utilisez une chaîne vide (""). Ce paramètre peut être récupéré grâce à la propriété [CxInitialCatalog](../Proprietes/2512018.md).

**`<Provider OLE DB ou Connecteur Natif> : (Chaîne de caractères ou Constante)`**



- Nom du provider OLE DB utilisé. Pour retrouver facilement la chaîne à utiliser, utilisez l'option "Connexion" de l'éditeur d'analyses (voir Notes).
	
	ou




- une des constantes suivantes :
	


|   |   |
| --- | --- |
| *hAccèsHF7* | Pseudo-connexion à une base HFSQL Classic (monoposte ou réseau) |
| *hAccèsHFClientServeur* | Connexion à une base HFSQL Client/Serveur |
| *hAccèsNatifAS400* | Accès Natif/Connecteur Natif AS/400 (module optionnel) |
| *hAccèsNatifDB2* | Accès Natif/Connecteur Natif DB2 (module optionnel) |
| *hAccèsNatifInformix* | Accès Natif/Connecteur Natif Informix (module optionnel) |
| *hAccèsNatifMySQL* | Accès Natif/Connecteur Natif MySQL (module optionnel) |
| *hAccèsNatifOracle* | Accès Natif/Connecteur Natif Oracle (module optionnel) |
| *hAccèsNatifPostgreSQL* | Accès Natif/Connecteur Natif PostgreSQL (module optionnel) |
| *hAccèsNatifProgress* | Accès Natif Progress (module optionnel) |
| *hAccèsNatifSQLServer* | Accès Natif/Connecteur Natif SQL Server (module optionnel) |
| *hAccèsNatifSybase* | Accès Natif/Connecteur Natif Sybase (module optionnel) |
| *hAccèsNatifxBase* | Accès Natif/Connecteur Natif xBase |
| *hODBC* | Provider OLE DB pour ODBC. <br>Permet d'accéder à une source de données ODBC déclarée dans les sources de données ODBC de Windows. |
| *hOledbAccess97* | Provider OLE DB pour Access 97 |
| *hOledbAccess2000* | Provider OLE DB pour Access 2000 |
| *hOledbDBase5* | Provider OLE DB pour DBase 5 |
| *hOledbExcel97* | Provider OLE DB pour Excel 97 |
| *hOledbExcel2000* | Provider OLE DB pour Excel 2000 |
| *hOledbLotus4* | Provider OLE DB pour Lotus 4 |
| *hOledbOracle* | Provider OLE DB pour Oracle |
| *hOledbSQLServer* | Provider OLE DB pour SQL Server |




![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) Attention : Pour utiliser une connexion OLE DB, il est nécessaire : 


- d'installer le MDAC version 2.6 minimum (installation réalisée avec WINDEV ou WEBDEV et lors de la création du programme d'installation)

- d'installer le provider OLE DB correspondant à la base de données manipulée. 
	Ce paramètre peut être récupéré grâce à la propriété [CxProviderOLEDB](../Proprietes/2512033.md).




**`<Accès> : (Constante optionnelle)`**

Paramètre le type d'accès à la base.


|   |   |
| --- | --- |
| *hOLecture* | La base de données est accessible uniquement en lecture. Seule la lecture des enregistrements est possible. Il n'est pas possible d'en ajouter ou d'en supprimer. |
| *hOLectureEcriture*<br>(valeur par défaut) | La base de données est accessible en lecture et en écriture. Il est possible aussi bien de lire des enregistrements que d'écrire de nouveaux enregistrements. |


Ce paramètre peut être récupéré grâce à la propriété [CxAccès](../Proprietes/2512015.md).

**`<Informations étendues> : (Chaîne de caractères optionnelle)`**

Informations optionnelles insérées dans la chaîne de connexion à la base de données. Si des mots-clés spécifiques sont reconnus, les informations correspondantes sont extraites de la chaîne de connexion. Le reste de la chaîne de connexion est envoyé à la base de données. Les paramètres extraits sont ensuite traités spécifiquement par le Connecteur Natif ou l'accès OLE DB utilisé. 
Ces mots-clés doivent être indiqués de la manière suivante : "&lt;Mot-clé&gt; = &lt;Valeur&gt;".

![Connecteurs Natifs (Accès Natifs)](https://doc.pcsoft.fr/ext/images/fr/AN.png) Les mots-clés reconnus pour le Connecteur Natif MySQL : 


|   |   |
| --- | --- |
| Server Port | Pour plus de détails sur ces paramètres, consultez la documentation de MySQL (mot-clé = 'mysql_real_connect'). |
| Unix Socket |
| Client Flag |



![OLE DB](https://doc.pcsoft.fr/ext/images/fr/OLEDB.png) Les mots-clés reconnus pour l'accès par un provider OLE DB :


|   |   |
| --- | --- |
| WD Command Timeout | Fixe la durée maximale (en secondes) de l'exécution d'une commande (Timeout de commande). Ne fonctionne pas sur le Connecteur Natif MySQL. |
| WD Connect Timeout | Fixe la durée maximale (en secondes) de la tentative de connexion (Timeout de connexion). Ne fonctionne pas sur le Connecteur Natif MySQL. |

 


![HFSQL Client/Serveur](https://doc.pcsoft.fr/ext/images/fr/HFCS.png) Les mots-clés reconnus pour l'accès par HFSQL Client/Serveur :


|   |   |
| --- | --- |
| CRYPTAGE | Active le cryptage des informations transmises entre le Client et le Serveur. Ce mot-clé peut prendre deux valeurs :<br><br>- RAPIDE<br><br>- RC5_16 pour utiliser un cryptage RC5 à 16 boucles.<br><br><br> |

Ce paramètre peut être récupéré grâce à la propriété [CxInfosEtendues](../Proprietes/2512017.md).

**`<Options supplémentaires> : (Constante)`**

Si ce paramètre n'est pas spécifié, le moteur HFSQL détermine automatiquement les meilleurs paramètres à utiliser en fonction de la base accédée et du provider OLE DB utilisé.

Pour forcer certains paramètres, il est possible de combiner les constantes suivantes :

- **Emplacement des curseurs**
	


|   |   |
| --- | --- |
| *hCurseurClient* | Curseur géré par le MDAC. Offre souvent plus de fonctionnalités qu'un curseur serveur. Un curseur client est obligatoirement un curseur statique. |
| *hCurseurServeur* | Curseur géré par la base de données. Ce curseur peut répercuter facilement les changements effectués par d'autres utilisateurs sur les données. |






- **Type de curseur**
	


|   |   |
| --- | --- |
| *hCurseurDynamique* | Curseur offrant de nombreuses fonctionnalités, mais consommant beaucoup de mémoire. Ce curseur autorise tous les types de déplacement. Il permet d'accéder à toutes les modifications, ajouts et suppressions réalisées par les autres utilisateurs. |
| *hCurseurForwardOnly* | Curseur rapide et consommant peu de mémoire. Le déplacement se fait du premier enregistrement au dernier. Les données modifiées par les autres utilisateurs ne sont pas visibles. |
| *hCurseurOpenKeySet* | Curseur manipulant un jeu d'enregistrements figé. Seules des clés correspondant à l'enregistrement sont stockées et non les enregistrements (peu de ressources mémoire utilisées). Les enregistrements supprimés ne sont plus accessibles. Les modifications réalisées par les autres utilisateurs sont visibles (mais pas les ajouts). |
| *hCurseurStatique* | Récupère une copie de tous les enregistrements de la requête en mémoire (consommation mémoire importante). Tous les types de déplacement sont autorisés. |






- **Mode de blocage**
	


|   |   |
| --- | --- |
| *hCurseurLectureSeule* | Le jeu d'enregistrements manipulé ne pourra pas être modifié. |
| *hCurseurOptimiste* | L'enregistrement n'est verrouillé que lors de sa mise à jour |
| *hCurseurPessimiste* | L'enregistrement est verrouillé dès son édition pour être modifié. |




Attention : tous les providers OLE DB ne gèrent pas tous les types de curseur.

Ce paramètre peut être récupéré grâce à la propriété [CxOptionsCurseur](../Proprietes/2512042.md).  


<a name="SYNTAXE2"></a>

### Ouvrir une connexion définie avec une variable de type Connexion

`<Résultat> = gpwOuvreConnexion(<Connexion manipulée>)`
---

**`<Résultat> : (Booléen)`**



- <u><u><u><u>Vrai</u></u></u></u> si l'opération a été réalisée, 

- <u><u><u><u>Faux</u></u></u></u> en cas de problème. La fonction [HErreurInfo](../WDLang4/3044071.md) permet d'identifier l'erreur. 




L'ouverture effective de la connexion n'est pas réalisée par la fonction **gpwOuvreConnexion**. La fonction peut renvoyer <u><u><u><u>Vrai</u></u></u></u> même si les valeurs passées en paramètre sont incorrectes. 
Utilisez la fonction [gpwOuvre](../WDLang6/3041002.md) pour indiquer le positionnement des fichiers de données permettant de gérer les droits, et les fichiers de données permettant d'identifier les utilisateurs. Les répertoires indiqués doivent être relatifs au répertoire du serveur.

**`<Connexion manipulée> : (Variable de type Connexion)`**

Nom de la variable de type [Connexion](../WDLang4/1514073.md) à ouvrir. Ce nom ne doit pas être déjà utilisé par une autre connexion (connexion définie dans l'analyse, ou définie avec la fonction [HOuvreConnexion](../WDLang4/3044107.md) ou [HDécritConnexion](../WDLang4/3044205.md)).



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Remarques


### Utiliser une chaîne de caractères pour le provider OLE DB
<a name="utiliser_une_chaine_caracteres_pour_provider_ole_ELTPARAGRAPHE000371"></a>Pour trouver facilement la chaîne de caractères à utiliser pour définir le provider OLE DB, il est conseillé de procéder de la manière suivante :

1. Dans l'éditeur d'analyses, affichez la fenêtre de description des connexions : sous le volet "Analyse", dans le groupe "Connexion", cliquez sur "Connexions".

2. Sélectionnez le provider à utiliser (combo "Connexion par").

3. La chaîne de caractères correspondant au provider s'affiche. Cette chaîne de caractères peut être utilisée dans la syntaxe 2 à la place des constantes. ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=HOuvreConnexion.gif)




<a name="NOTE0_2"></a>


### En cas d'échec, la description de la connexion n'est pas conservée
<a name="cas_echec_description_connexion_nest_pas_conservee_ELTPARAGRAPHE000395"></a>Si l'ouverture de la connexion échoue, la description de cette connexion n'est pas validée. Il est ainsi possible de re-définir une connexion du même nom.

Par exemple, si la tentative de connexion échoue avec le mot de passe par défaut, il est possible de réaliser une nouvelle tentative avec un autre mot de passe.
<a name="NOTE0_3"></a>


### Deux connexions sont ouvertes sur le serveur
<a name="deux_connexions_sont_ouvertes_sur_serveur_ELTPARAGRAPHE000404"></a>Deux contextes HFSQL sont utilisés par le Groupware Utilisateur. Il est donc normal d'observer dans le Centre de Contrôle HFSQL deux connexions pour une unique instance de l'application.
<a name="NOTE0_4"></a>


### Validité de la connexion
<a name="validite_connexion_ELTPARAGRAPHE000411"></a>La fonction **gpwOuvreConnexion** se comporte comme la fonction [HDécritConnexion](../WDLang4/3044205.md) : cette fonction ne fait pas immédiatement la connexion. 

La fonction **gpwOuvreConnexion** note les paramètres de connexion à utiliser lorsqu'il faudra par la suite se connecter. 

Afin de valider cette connexion, vous pouvez appeler la fonction [HOuvreConnexion](../WDLang4/3044107.md) avant la fonction **gpwOuvreConnexion** avec les mêmes paramètres. Ainsi, les paramètres de connexion seront déjà vérifiés lors de l'appel de la fonction **gpwOuvreConnexion**.
<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/fr/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/fr/WINDOWS.png)![Linux](https://doc.pcsoft.fr/ext/images/fr/LX.png) 

### Pseudo connexion à une base de données HFSQL Classic
<a name="pseudo_connexion_une_base_donnees_hfsql_classic_ELTPARAGRAPHE000442"></a>Des fichiers de données OLE DB ou natifs sont décrits sous l'éditeur d'analyses. Pour manipuler ces descriptions avec une base de données HFSQL Classic, le paramètre &lt;Provider OLE DB ou Connecteur Natif&gt; doit correspondre à la constante *hAccèsHF7*.

Les fichiers de données au format HFSQL Classic correspondant à la description des fichiers OLE DB ou natifs seront créés si nécessaire dans le répertoire défini par le paramètre &lt;Source des données&gt;.

<a name="XComposante"></a>

## Composante :
wd280gpu.dll
