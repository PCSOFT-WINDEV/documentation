


## Connecteur Natif Oracle : Programmation à l'aide des fonctions HFSQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000233"></a>
Pour utiliser une base de données Oracle avec le Connecteur Natif (également appelé Accès Natif), il est nécessaire **d'importer la structure des tables Oracle dans l'analyse WINDEV ou WEBDEV**. 

**Différences par rapport à la programmation SQL** : Pour manipuler les données Oracle, les requêtes ne sont pas obligatoires. En effet, vous pouvez directement utiliser les fonctions HFSQL pour lire vos données, effectuer des recherches, des filtres, ... Cependant, il est nécessaire d'importer la structure des fichiers de données Oracle dans l'analyse WINDEV ou WEBDEV.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Importation de la structure des fichiers de données
<a name="importation_structure_des_fichiers_donnees_ELTTEXTE000263"></a>


### Les étapes de l'importation
<a name="les_etapes_importation_ELTPARAGRAPHE000022"></a>Pour réaliser cette importation : 

1. Lancez l'éditeur d'analyses : cliquez sur ![](https://doc.pcsoft.fr/fr-FR/images/image.awp?langid=5&name=Ico_Analyse.gif) parmi les boutons d'accès rapide.

2. Sous le volet "Analyse", dans le groupe "Création", déroulez "Importer" et sélectionnez "Importer des descriptions de fichiers / tables".

3. L'assistant se lance. Une connexion à la base de données Oracle est automatiquement créée et associée aux fichiers de données importés dans l'analyse. Cette connexion devra être utilisée pour manipuler le fichier de données Oracle par programmation.




Dans les différents écrans de l'assistant, choisissez les options suivantes :

- Type de base de données : Oracle. 

- Caractéristiques de la connexion : Serveur de données, Utilisateur et mot de passe, base de données.  

- L'application accédera aux données dans le format actuel.

- Lorsque la connexion est établie, il suffit de sélectionner les tables à importer dans l'analyse WINDEV ou WEBDEV. Ces tables pourront être manipulées par programmation grâce aux fonctions HFSQL du WLangage. Ces tables apparaîtront en bleu sous l'éditeur d'analyses.




**Remarque : Gestion des synonymes** 

Si la base de données Oracle contient des synonymes, ceux-ci seront importés sous l'éditeur d'analyses comme une nouvelle description de fichier. 

Attention : Quelque soit l'origine de la description de fichier (table, vue ou synonyme), la fonction [HCréation](../WDLang4/3044255.md) crée toujours une table. 
<a name="NOTE2_2"></a>


### Cas particulier : Gestion de l'identifiant automatique
<a name="cas_particulier_gestion_identifiant_automatique_ELTPARAGRAPHE000065"></a>Le type Identifiant automatique n'existant pas sur Oracle, l'importation d'une table Oracle ne crée pas de rubriques de ce type.

Cependant, il est possible sous l'éditeur d'analyses, de modifier les rubriques de type "Entier sur 4 " et/ou "Entier sur 8" pour les définir comme identifiant automatique. Dans ce cas, ces identifiants automatiques seront gérés par le Connecteur Natif Oracle (en ajout ou en modification) grâce à une "Séquence" Oracle nommée "WINDEV_SEQ". Si cette séquence n'existe pas, le Connecteur Natif Oracle crée cette séquence automatiquement.

**Pour faire des ajouts ou des modifications d'enregistrements avec identifiant automatique**, il est nécessaire :

- de modifier l'analyse. En effet, pour une rubrique "Entier sur 4 " ou "Entier sur 8", cette rubrique peut être passée en type "Identifiant auto". Dans ce cas, le Connecteur Natif Oracle gérera cette rubrique comme un identifiant automatique.

- soit de créer l'objet "séquence" nommé "WINDEV_SEQ" dans la base Oracle

- soit de donner le privilège "CREATE SEQUENCE" à l'utilisateur.



<a name="NOTE2_3"></a>


### Prendre en compte les évolutions de la base de données Oracle
<a name="prendre_compte_les_evolutions_base_donnees_oracle_ELTPARAGRAPHE000080"></a>Pour prendre en compte les évolutions des tables importées sous l'éditeur d'analyses, sous le volet "Analyse", dans le groupe "Analyse", déroulez "Synchronisation" et sélectionnez "Mettre à jour l'analyse depuis les bases de données externes".

Un assistant se lance et permet au choix :

- soit d'analyser les différences pour les tables importées,

- soit d'analyser les différences pour toutes les tables Oracle.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Programmation
<a name="programmation_ELTTEXTE000299"></a>


### 1. Ouverture de la connexion
<a name="1_ouverture_connexion_ELTPARAGRAPHE000106"></a>Pour ouvrir la connexion à la base de données Oracle, utilisez la fonction [HOuvreConnexion](../WDLang4/3044107.md) en précisant le nom de la connexion à ouvrir. Ce nom de connexion a été défini lors de l'importation de la structure des fichiers dans l'analyse.

Pour modifier certains paramètres de cette connexion (par exemple le nom d'utilisateur ou le mot de passe), utilisez la fonction [HConnecte](../WDLang4/3044263.md).

**Remarques** : 

- Si vous tentez de lire directement le fichier (fonction [HLitPremier](../WDLang4/3044051.md), ...), la connexion associée à la description du fichier dans l'analyse sera automatiquement ouverte.

- Il est possible d'effectuer une authentification externe de la connexion.



<a name="NOTE3_2"></a>


### 2. Exécution de requêtes
<a name="2_execution_requetes_ELTPARAGRAPHE000131"></a>Les fonctions [HExécuteRequête](../WDLang4/3044080.md) et [HExécuteRequêteSQL](../WDLang4/3044084.md) permettent d'exécuter des requêtes sur la base de données en cours.

- [HExécuteRequête](../WDLang4/3044080.md) : permet d'exécuter une requête prédéfinie avec l'éditeur de requêtes.

- [HExécuteRequêteSQL](../WDLang4/3044084.md) : permet d'exécuter une requête en précisant directement le code SQL de la requête, et le nom qui sera attribué à ce code SQL.



```wl
// Initialisation de la requête "REQ_Client_84"
HExécuteRequête(REQ_CLIENT_84, "BaseOracle", hRequêteSansCorrection)

HExécuteRequêteSQL(REQ_RequeteClient, "BaseOracle", hRequêteSansCorrection, ...
		"SELECT NOM FROM CLIENT")
```

<a name="NOTE3_3"></a>


### 3. Récupération du résultat
<a name="3_recuperation_resultat_ELTPARAGRAPHE000153"></a>Le parcours du résultat est réalisé avec toutes les fonctions de lecture classiques : [HLitPremier](../WDLang4/3044051.md), [HLitSuivant](../WDLang4/3044037.md), [HLitRecherche](../WDLang4/3044050.md), ...

Il est possible de bloquer les enregistrements grâce aux options de blocage de ces fonctions.

**Remarque** : Les constantes *hBlocageEcriture* et *hBlocageLectureEcriture* ont le même effet : blocage en écriture. En effet, les blocages en lecture ne sont pas supportés par Oracle.
<a name="NOTE3_4"></a>


### 4. Fermeture de la connexion
<a name="4_fermeture_connexion_ELTPARAGRAPHE000173"></a>La fonction [HFermeConnexion](../WDLang4/3044095.md) permet de fermer la connexion à la base de données lorsque toutes les requêtes nécessaires ont été réalisées.
<a name="NOTE3_5"></a>


### Remarques
<a name="remarques_ELTPARAGRAPHE000183"></a>

- **Les champs de type "Table fichier" basés sur des requêtes sont optimisés** : il est possible de trier le contenu du champ Table en cliquant sur une de ses colonnes.

- Pour éviter de ré-exécuter plusieurs fois la même requête lors du parcours de son résultat, il est conseillé d'utiliser la constante *hSansRafraîchir* (par exemple si un seul poste modifie les données).





