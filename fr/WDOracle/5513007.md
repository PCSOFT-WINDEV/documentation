
## Connecteur Natif Oracle : Spécificités et remarques
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000368"></a>
Les paragraphes suivants présentent les remarques générales et les spécificités du Connecteur Natif Oracle.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Remarques générales
<a name="remarques_generales_ELTTEXTE000392"></a>


### Versions nécessaires
<a name="versions_necessaires_ELTPARAGRAPHE000018"></a>**Attention** : Cette version du Connecteur Natif Oracle fonctionne uniquement avec WINDEV 28 et WEBDEV 28. 
<a name="NOTE2_2"></a>


### Unicode sur Oracle
<a name="unicode_sur_oracle_ELTPARAGRAPHE000029"></a>

- Pour gérer Unicode sur Oracle, il est nécessaire d'installer au minimum la couche client version 9i. 

- Si les conditions suivantes sont remplies, le mémo unicode est tronqué à 4000 caractères :

	- Utilisation de la condition de sélection LIKE avec la clause ESCAPE,

	- Mémo Unicode,

	- Serveur en version 9. 






<a name="NOTE2_3"></a>


### Le blocage d'un fichier de données (table) se fait dans une transaction
<a name="blocage_fichier_donnees_table_fait_dans_une_transaction_ELTPARAGRAPHE000041"></a>La fonction [HBloqueFichier](../WDLang4/3044153.md) débute une transaction avant de bloquer la table en mode Exclusif. La fonction [HDébloqueFichier](../WDLang4/3044160.md) valide la transaction et débloque la table.
<a name="NOTE2_4"></a>


### Gestion de l'identifiant automatique en écriture : utilisation d'une séquence Oracle
<a name="gestion_identifiant_automatique_ecriture_utilisation_une_sequence_oracle_ELTPARAGRAPHE000054"></a>Le type Identifiant automatique n'existant pas sur Oracle, l'importation d'une table Oracle ne crée pas de rubriques de ce type.

Cependant, il est possible sous l'éditeur d'analyses, de modifier les rubriques de type "Entier sur 4 " et / ou "Entier sur 8" pour les définir comme identifiant automatique. Dans ce cas, ces identifiants automatiques seront gérés par le Connecteur Natif Oracle (en ajout ou en modification) grâce à une "Séquence" Oracle nommée "WINDEV_SEQ". Si cette séquence n'existe pas, le Connecteur Natif Oracle crée cette séquence automatiquement.

**Pour faire des ajouts ou des modifications d'enregistrements avec identifiant automatique**, il est nécessaire :

- de modifier l'analyse. En effet, pour une rubrique "Entier sur 4 " ou "Entier sur 8", cette rubrique peut être passée en type "Identifiant auto". Dans ce cas, le Connecteur Natif Oracle gérera cette rubrique comme un identifiant automatique.

- soit de créer l'objet "séquence" nommé "WINDEV_SEQ" dans la base Oracle.

- soit de donner le privilège "CREATE SEQUENCE" à l'utilisateur.



<a name="NOTE2_5"></a>


### Format des dates
<a name="format_des_dates_ELTPARAGRAPHE000069"></a>Lors de l'insertion ou de la modification d'une date dans une requête exécutée par la fonction [SQLExec](../WDLang4/3072007.md), le format spécifié par défaut pour le Connecteur Natif Oracle est le suivant : "AAAAMMJJHHmmSS".

En WINDEV 5.5, le format des dates dépendait des paramètres spécifiés lors de la connexion (paramètres de configuration par défaut de la couche client Oracle).

En WINDEV, pour modifier le format des dates par défaut, dans la fenêtre de description de la connexion utilisée, sélectionnez "Format par défaut de la connexion" dans la combo "Format des dates". Dans cette combo, il est également possible de spécifier un format de date personnalisé. Dans ce cas, ce format doit être compatible avec les requêtes d'insertion (ordre INSERT) et de modification (ordre UPDATE).

**Remarque** : Les dates vides correspondent à des chaînes complétées par des 0. 
<a name="NOTE2_6"></a>


### Numéro d'enregistrement
<a name="numero_enregistrement_ELTPARAGRAPHE000085"></a>Il n'est pas possible de spécifier un numéro d'enregistrement différent de zéro dans les fonctions [HEcrit](../WDLang4/3044092.md) et [HLit](../WDLang4/3044047.md). Le numéro d'enregistrement "zéro" correspond à l'enregistrement en cours.

De même, les fonctions [HBloqueNumEnr](../WDLang4/3044152.md) et [HDébloqueNumEnr](../WDLang4/3044194.md) ne peuvent être utilisées que sur l'enregistrement en cours.
<a name="NOTE2_7"></a>


### Liste des tables accédées par le Connecteur Natif Oracle selon le schéma SYS
<a name="liste_des_tables_accedees_par_connecteur_natif_oracle_selon_schema_sys_ELTPARAGRAPHE000106"></a>La liste des tables auxquelles le Connecteur Natif Oracle tente d'accéder selon le schéma SYS sont les suivantes :

- V$VERSION

- ALL_OBJECTS

- ALL_IND_COLUMNS

- SYS.ALL_TABLES

- SYS.ALL_VIEWS

- Optionnel : SYS.ALL_SOURCE




Par défaut, ces tables sont bloquées en lecture par Oracle. Il peut être nécessaire d'autoriser le SELECT sur ces tables.
<a name="NOTE2_8"></a>


### Gestion des synonymes
<a name="gestion_des_synonymes_ELTPARAGRAPHE000124"></a>Le Connecteur Natif Oracle gère les synonymes : 

- Il est possible d'accéder à un fichier directement par son nom ou son synonyme. 

- Les synonymes sont listés avec les vues par la fonction [HListeFichier](../WDLang4/3044045.md). 

- Les synonymes sont importés en tant que description de fichier dans l'analyse.




Attention : la fonction [HCréation](../WDLang4/3044255.md) utilisée sur une description de fichier présente dans l'analyse crée toujours une table, quelque soit son origine (table, vue ou synonyme). 
<a name="NOTE2_9"></a>


### Valeurs par défaut des rubriques
<a name="valeurs_par_defaut_des_rubriques_ELTPARAGRAPHE000145"></a>Les valeurs par défaut des rubriques sont gérées par le Connecteur Natif Oracle. Ces valeurs par défaut peuvent être : 

- une valeur, 

- une formule SQL. Dans ce cas, l'expression SQL doit être reconnue par le moteur HFSQL et par la base Oracle. 



<a name="NOTE2_10"></a>


### Gestion des rubriques calculées
<a name="gestion_des_rubriques_calculees_ELTPARAGRAPHE000157"></a>Des rubriques calculées peuvent être utilisées dans les fichiers de données. 

La gestion des rubriques calculées est disponible à partir de Oracle version 11g minimum.  



<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Spécificités générales
<a name="specificites_generales_ELTTEXTE000470"></a>


### Options de l'analyse
<a name="options_analyse_ELTPARAGRAPHE000169"></a>

- Que les options "Sensible à la casse", "Sensible à l'accentuation", "Sensible à la ponctuation" soient cochées ou non dans l'éditeur d'analyses, la recherche sera toujours sensible à la casse, à l'accentuation et à la ponctuation.

- Les options de l'analyse concernant les index full-text ne sont pas gérées par le Connecteur Natif Oracle.

- Les options de l'analyse concernant l'indexation partielle des mémos texte ne sont pas gérées par le Connecteur Natif Oracle.



<a name="NOTE3_2"></a>


### Chaînes vides et valeur NULL
<a name="chaines_vides_valeur_null_ELTPARAGRAPHE000178"></a>Les valeurs "Chaîne vide" sont interprétées par Oracle comme la valeur NULL. Lors d'un parcours ascendant, l'ordre ORDER BY rejette toutes les valeurs NULL à la fin du parcours.
<a name="NOTE3_3"></a>


### Rubriques de type Tableau
<a name="rubriques_type_tableau_ELTPARAGRAPHE000185"></a>Les rubriques de type Tableau ne sont pas gérées par le Connecteur Natif Oracle. Si vous utilisez une rubrique tableau, seule la valeur de l'indice 1 du tableau sera manipulable avec les fonctions HFSQL (en écriture et en lecture).

Pour gérer ce type de rubrique, il est nécessaire de modifier la structure de vos fichier des données pour remplacer les rubriques indicées par plusieurs rubriques. 
**Remarque** : En programmation il sera possible d'utiliser l'indirection pour manipuler ces rubriques de façon générique. 

Le code suivant avec une rubrique indicée :

```wl
nIndiceRubrique est un entier
POUR nIndiceRubrique = 1 A 10
	Fichier.RubriqueTableau[nIndiceRubrique] = "Valeur"
FIN
```


Devient avec des rubriques dont le nom contient un numéro:


```wl
nIndiceRubrique est un entier
POUR nIndiceRubrique = 1 A 10
	{"Fichier.RubriqueTableau" + nIndiceRubrique, indRubrique} = "Valeur"
FIN
```

<a name="NOTE3_4"></a>


### Contraintes d'intégrité référentielle
<a name="contraintes_integrite_referentielle_ELTPARAGRAPHE000203"></a>Les contraintes d'intégrité référentielle décrites dans l'analyse ne sont pas automatiquement créées sur la base de données avec la fonction [HCréation](../WDLang4/3044255.md).

Les contraintes d'intégrité référentielle doivent être décrites dans la base de données accédée.
<a name="NOTE3_5"></a>


### Blocage des enregistrements
<a name="blocage_des_enregistrements_ELTPARAGRAPHE000215"></a>Les options de blocage (constantes ***hBlocageEcriture*** et ***hBlocageLectureEcriture***) utilisables avec les fonctions HFSQL ont le même effet : blocage en écriture. En effet, les blocages en lecture ne sont pas supportés par Oracle.
<a name="NOTE3_6"></a>


### Utilisation d'une requête (avec l'option hRequêteSansCorrection) avec les fonctions HAjoute, HModifie, ou HSupprime
<a name="utilisation_une_requete_avec_option_hrequetesanscorrection_avec_les_fonctions_hajoute_hmodifie_hsupprime_ELTPARAGRAPHE000222"></a>Si vous manipulez une requête avec la constante ***hRequêteSansCorrection***, il est nécessaire de démarrer une transaction avant d'utiliser cette requête avec les fonctions [HAjoute](../WDLang4/3044147.md), [HModifie](../WDLang4/3044042.md) ou [HSupprime](../WDLang4/3044018.md). Cette transaction permet d'éviter l'erreur "ORA2002 : Extraction en rupture de séquence" lors du parcours de la requête.

Exemple :


```wl
S1 est une Source de Données
SQLTransaction(sqlDébut, MaConnexion)
HExécuteRequêteSQL(S1, MaConnexion, hRequêteSansCorrection, "select * from commande")
HLitPremier(S1)
TANTQUE PAS HEnDehors(S1)
	HLitRecherchePremier(Client, CLCléUnique, S1.CLCléUnique)
	SI HTrouve(Client) ALORS
		Client.NbCommande = Commande.NbCommande
		HModifie(Client)
	FIN
	HLitSuivant(S1)
FIN
SQLTransaction(sqlFin, MaConnexion)
```


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Spécificités concernant les fonctions HFSQL et SQL
<a name="specificites_concernant_les_fonctions_hfsql_sql_ELTTEXTE000524"></a>
Les spécificités concernant l'utilisation des fonctions HFSQL avec le Connecteur Natif Oracle sont les suivantes :  

| Spécificités | Fonctions concernées |
| --- | --- |
| La constante ***hAffecteParcours*** n'est pas prise en compte. A la fin de l'opération, le parcours continue à partir de l'enregistrement en cours avant l'ajout ou la modification. | [HAjoute](../WDLang4/3044147.md), [HModifie](../WDLang4/3044042.md) |
| La constante ***hDistinct*** n'est pas prise en compte : tous les enregistrements (y compris les doublons) sont parcourus. | [HAvance](../WDLang4/3044154.md), [HRecule](../WDLang4/3044126.md),<br>[HLitPrécédent](../WDLang4/3044048.md), [HLitSuivant](../WDLang4/3044037.md)<br>[HPrécédent](../WDLang4/3044112.md), [HSuivant](../WDLang4/3044027.md) |
| **Requête multi-fichiers.**<br>Les fonctions **HAjoute**, **HModifie** et **HSupprime** ne sont pas supportées. | [HAjoute](../WDLang4/3044147.md),<br>[HModifie](../WDLang4/3044042.md),<br>[HSupprime](../WDLang4/3044018.md) |
| Les fonctions **HRecherche\***, **HPremier**, **HSuivant** permettent de se positionner sur un enregistrement sans le lire.<br>Dans cette version, ces fonctions lisent également l'enregistrement. Ce problème sera corrigé dans une prochaine version. | [HRecherche](../WDLang4/3044130.md),<br>[HPremier](../WDLang4/3044113.md),<br>[HSuivant](../WDLang4/3044027.md) |
| Après une erreur de doublons sur la fonction **HModifie**, la fonction **HLit** (utilisée avec la constante *hNumEnrEnCours*) ne lit pas l'enregistrement demandé.<br>Ce problème sera corrigé dans une prochaine version. | [HLit](../WDLang4/3044047.md) |
| Après la fonction **HAjoute**, l'enregistrement n'est pas relu par le Connecteur Natif. Si les valeurs de l'enregistrement sont modifiées par la base de données (trigger sur Insert, ...), il est nécessaire d'utiliser la fonction **HLit** pour récupérer les valeurs modifiées. | [HAjoute](../WDLang4/3044147.md) |






