
## Connecteur Natif Oracle : Exécuter plusieurs fois une même requête
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Présentation
<a name="presentation_ELTTEXTE000190"></a>
Dans certains cas, il peut être intéressant d'exécuter plusieurs fois une même requête en modifiant uniquement un ou plusieurs paramètres. Un cas courant consiste à exécuter plusieurs fois une requête d'insertion pour ajouter plusieurs enregistrements dans un fichier.

Plusieurs solutions peuvent être mises en place : 

1. Exécuter directement la requête (avec la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md)) autant de fois que nécessaire en modifiant à chaque fois le ou les paramètre(s) voulu(s).

2. Préparer la requête à exécuter (fonction [HPrépareRequêteSQL](../WDLang4/3044119.md)) ainsi que les différents paramètres à modifier puis exécuter la requête autant de fois que nécessaire avec la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md). Cette seconde solution est beaucoup plus rapide et optimise le temps de parcours du résultat de la requête (cas d'une requête de type SELECT).




**Cette page d'aide présente la mise en place de cette seconde solution.**



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Comment le faire ?
<a name="comment_faire_ELTTEXTE000214"></a>


### Les étapes
<a name="les_etapes_ELTPARAGRAPHE000035"></a>Pour préparer et exécuter une requête plusieurs fois, il faut :

1. Déclarer une source de données. Cette source de données contiendra le résultat de la requête SQL.

2. Déclarer les types des différentes variables de la requête.
	Les variables sont récupérées dans le type spécifié en WLangage. Par défaut les variables sont de type texte.
	Des conversions peuvent donc se produire du type natif de la base vers le type WLangage qui peuvent entraîner arrondis ou des formatages inattendus (par exemple une Date transformée en chaîne).
	Il est donc conseillé de spécifier de façon adéquate les types WLangage des variables avant d'exécuter la requête. Ceci est peut être fait :

	- soit en initialisant la valeur de la variable (types simples : entier, chaîne, flottant)

	- soit en spécifiant le type attendu grâce à la propriété [Type](../Proprietes/2510131.md) (non supporté dans cette version)




3. Préparer la requête avec la fonction [HPrépareRequêteSQL](../WDLang4/3044119.md).

4. Indiquer la valeur du ou des différents paramètres à prendre en compte et exécuter la requête à l'aide de la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md). Seul le nom de la source de données correspondant à la requête doit être spécifié.




Cette dernière étape doit être répétée autant de fois que nécessaire.


<a name="NOTE2_2"></a>


### Remarques
<a name="remarques_ELTPARAGRAPHE000068"></a>

- La fonction [HPrépareRequêteSQL](../WDLang4/3044119.md) doit être utilisée avec :

	- le nom de la connexion,

	- la constante ***hRequêteSansCorrection***.  




- Les variables déclarées doivent être identiques à celles utilisées. Dans le cas contraire, une erreur WLangage est affichée.

- Dans l'appel à la procédure stockée, il est nécessaire d'utiliser la syntaxe spécifique à la base de données utilisée, y compris pour la syntaxe des paramètres. Ainsi, pour Oracle, les paramètres sont spécifiés avec la syntaxe **:NomParam**.
	Attention : le caractère ":" doit être suivi d'au moins une lettre (la syntaxe :1 est interdite). 
	Il est possible d'utiliser plusieurs fois le même paramètre. Dans ce cas, la variable correspondante sera ré-utilisée.

- Pour exécuter une requête sans que le bind ne soit activé, il est nécessaire d'utiliser la constante ***hSansBind*** dans la fonction [HExécuteRequêteSQL](../WDLang4/3044084.md).  




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Exemple
<a name="exemple_ELTTEXTE000244"></a>
On veut exécuter plusieurs fois une requête d'insertion dans la table PERSONNE. 3 paramètres sont modifiés à chaque ajout :

- le nom. 

- le prénom.

- l'âge.





<a name="NOTE3_2"></a>


### 1. Déclaration de la source de données
<a name="1_declaration_source_donnees_ELTPARAGRAPHE000103"></a>La source de données permet de manipuler les différentes variables qui seront modifiées à chaque exécution de la requête :


```wl
sdInsert est une Source de Données
```



<a name="NOTE3_3"></a>


### 2. Déclaration des variables
<a name="2_declaration_des_variables_ELTPARAGRAPHE000113"></a>Dans cet exemple, trois variables vont être modifiées. Les trois variables pourraient être déclarées. Cependant, seule la variable **age_personne** va être déclarée.

Pour préciser le type d'une variable de la requête, affectez cette variable avec une variable existante du type voulu.


```wl
sdInsert.age_personne = 0 // Force le type à entier
 
// autre solution :
// B est un entier
sdInsert.age_personne = B
```



<a name="NOTE3_4"></a>


### 3. Préparation de la requête
<a name="3_preparation_requete_ELTPARAGRAPHE000125"></a>La requête va être préparée à être exécutée plusieurs fois grâce à la fonction [HPrépareRequêteSQL](../WDLang4/3044119.md).


```wl
HPrépareRequêteSQL(sdInsert, Connexion, hRequêteSansCorrection, ...
		"INSERT INTO PERSONNE VALUES (:nom, :prenom, :age_personne)")
```



<a name="NOTE3_5"></a>


### 4. Valeurs des paramètres et ré-exécution de la requête
<a name="4_valeurs_des_parametres_reexecution_requete_ELTPARAGRAPHE000138"></a>Il ne reste plus qu'à spécifier la valeur des paramètres pour chaque exécution de la requête.


```wl
I est un entier
POUR I = 1 A 10
	sdInsert.nom = "Nom " + I
	sdInsert.prenom = "Prénom " + I
	sdInsert.age_personne = i
	HExécuteRequêteSQL(sdInsert)
FIN
```





