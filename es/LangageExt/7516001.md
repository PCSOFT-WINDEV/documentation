
## Lenguaje externo: Programación en Pascal
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000181"></a>
Vamos a llamar a los elementos desarrollados en WINDEV (proyecto, ventanas, ... análisis) del lenguaje pascal. El código WLanguage utilizado desde el lenguaje externo se compilará dinámicamente y se ejecutará durante la llamada.

**Este modo se ilustra en City.PAS** (en formato Pascal) suministrado en el subdirectorio "ExternalLanguages\\Pascal" del directorio instalación de WINDEV.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Implementación
<a name="implementacion_ELTTEXTE000205"></a>




### 1. Incluyendo los archivos de la interfaz Pascal de WINDEV
<a name="1_incluyendo_los_archivos_interfaz_pascal_windev_ELTPARAGRAPHE000022"></a>

Si está utilizando una base de datos en su aplicación, el primer paso consiste en generar su análisis. En la description de este análisis, especifique el lenguaje de programación utilizado así como el directorio que contendrá los archivos fuente.

A través de la generación se genera un esqueleto de programa (\*.pas). Esta operación también creará el archivo.h (ver abajo) necesario para utilizar sus archivos de datos.

Los siguientes archivos deben estar incluidos en un proyecto Pascal para poder llamar a la interfaz Pascal de WINDEV:

- Squelet.PAS (contiene la description del análisis)

- &lt;Nombre de análisis&gt;.H

- WDHF.PAS

- WINDEV.PAS




Los archivos.h y.pas que describen la estructura de los archivos de datos serán generados automáticamente por WINDEV al generar el análisis.
<a name="NOTE2_2"></a>


### 2. Incluyendo las declaraciones HFSQL
<a name="2_incluyendo_las_declaraciones_hfsql_ELTPARAGRAPHE000040"></a>

Los archivos .h y .pas correspondientes a la description de los archivos de análisis deben ser añadidos al proyecto Pascal. Las declaraciones de los ficheros de datos se incluyen en el fichero cuya extensión es.h.

Por ejemplo, en el código City.pas (suministrado con WINDEV en el directorio "ExternalLanguages\\Pascal"), estos archivos son "CityPas.H" y "Squelet.PAS".

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Declaración e inicialización
<a name="declaracion_inicializacion_ELTTEXTE000235"></a>




### 1. Declarar el contexto HFSQL y los contextos de trabajo de cada archivo
<a name="1_declarar_contexto_hfsql_los_contextos_trabajo_cada_archivo_ELTPARAGRAPHE000052"></a>

Si la aplicación debe gestionar archivos de datos, se debe declarar un contexto de trabajo HFSQL, así como un contexto de trabajo para cada archivo de datos.

Estas declaraciones se realizan en el proyecto City.pas a través de las siguientes líneas:


```txt
{------------- include of the descriptions of the files used --------------}
{ write for each file $I .WDR }
{$I CityPas.h}	(* record    *)
var DP:typeDP;
var VI:typeVI;
{$F+}			{ compilation directive  $F+ mandatory at the beginning }
procedure HDescribeRecord;
{Describes each file of the analysis}
VAR
lArrItmST:array[0..1] of longint;
sTypeST: String;
lArrItmCI:array[0..1] of longint;
sTypeCI: String;
begin
lArrItmDP[0]:= 31; lArrItmDP[1]:= 3;
sTypeDP:= '11';
EL_HDescribeRecord(gCtx, stringtoptr('STATE'), 34, 
longint(@lArrItmST[0]), 2, stringtoptr(sTypeST), @ST);
lArrItmVI[0]:= 41; lArrItmVI[1]:= 6;
sTypeVI:= '11';
EL_HDescribeRecord(gCtx, stringtoptr('CITY'), 47, 
longint(@lArrItmCI[0]), 2, stringtoptr(sTypeCI), @CI);
End;
procedure HInit;
VAR
{Creating the context}
sAnalysisName:String;
sPassword:String;
begin
gCtx:= EL_CreateHFContext(2);
sAnalysisName:= 'CITYPAS.WDD';
sPassword:= ' ';
{Describing each record}
HDescribeRecord;
{Initializing HF}
	CALLWD('HFCTX');
If EL_Hinitshare(gCtx,WDLong) = 0 Then
begin
CALLWD('Error,Error initializing the HF context');
End
{opening the analysis}
else
begin
If HOpenAnalysis(gCtx, sAnalysisName, sPassword, ' ', ' ', ' ') = 0 Then
begin
CALLWD('Error,Error opening the analysis');
End;
End;
End;
```

<a name="NOTE3_2"></a>




### 2. Inicialización de contextos HFSQL
<a name="2_inicializacion_contextos_hfsql_ELTPARAGRAPHE000064"></a>

Si su aplicación está llamando a una base de datos, el acceso a HFSQL debe prepararse ahora.. La siguiente prueba se utiliza para comprobar si esta inicialización se realiza correctamente:


```txt
{Creating the context}
begin
HInit;
End;
```

<a name="NOTE3_3"></a>


### 3. Carga de la biblioteca WINDEV (WDL)
<a name="3_carga_biblioteca_windev_wdl_ELTPARAGRAPHE000073"></a>

La biblioteca WINDEV (extensión.WDL) contiene todos los elementos del proyecto (ventanas, informes, clases, consultas, análisis,...). Por lo tanto, debe ser cargado en la memoria para que sus componentes puedan ser llamados.

La operación de carga es realizada por CALLWD('LIBRA,disco ....') de la siguiente manera:

**Atención**: Si la biblioteca a cargar contiene ventanas, el código de cada una de estas ventanas debe ser incluido en el correspondiente archivo ".WDW" ("Incluir el código compilado" debe ser comprobado en la pestaña "Detalles" de la description de cada ventana).


```txt
begin{ Opening the library }
{ if WDInt is not null, the library was not found! }
CALLWD('LIBRA,disk,city.wdl');	{ Open the library. }
if WDInt0 then
begin
	{ Library not found }
	CALLWD('Error,The CITY.WDL library must be found in the parent directory.');
	{ indicate to WINDEV that the program will be ended }
	{ use HFDone only if an HFSQL database is used }
	HFDone;
	WDEnd;
	Halt;
end;
...
end;
```


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Ejecutar códigos WINDEV desde el idioma externo
<a name="ejecutar_codigos_windev_desde_idioma_externo_ELTTEXTE000271"></a>


### 1. Llamar a un código de WLanguage
<a name="1_llamar_codigo_wlanguage_ELTPARAGRAPHE000088"></a>

Todas las funciones WLanguage se pueden llamar desde el idioma externo. El comportamiento de estas funciones WLanguage, así como los valores devueltos, son idénticos tanto si se llaman:

- de WINDEV o

- desde la interfaz del lenguaje externo




Para conocer los parámetros y los valores de retorno de una función WLanguage, consulte la ayuda en línea o la documentación sobre WLanguage.

La llamada a un WLanguage Procedure desde la interfaz externa se hace a través de **CallWD**. Por ejemplo:


```txt
open the first window of the program that contains the menu }
CALLWD('OPEN,menu.wdw);
```


Notará que el parámetro esperado por **Llame a CallWD** es una cadena de caracteres que contiene el código de WLanguage a ejecutar.

Al igual que WLanguage codificado en WINDEV, esta cadena no distingue entre mayúsculas y minúsculas (caracteres en mayúscula / minúscula). Por lo tanto, el comando "Info" también puede escribirse como "INFO".
<a name="NOTE4_2"></a>


### 2. Recuperación de los eventos lanzados en las ventanas WINDEV
<a name="2_recuperacion_los_eventos_lanzados_las_ventanas_windev_ELTPARAGRAPHE000108"></a>

La entrada en las ventanas WINDEV requiere recuperar los eventos desencadenados en estas ventanas.

Para recuperar los eventos de usuario (haga clic en un menú, en un botón, etc.), debe implementar un sistema basado en un bucle en su programa Pascal.. Este bucle permanecerá Active mientras se abra la ventana WINDEV y se utilizará para interceptar cada acción del usuario.

Para averiguar el tipo de acción que realiza el usuario, tiene la posibilidad de utilizar una cadena de caracteres Variable (en WLanguage) llamada **'WDKey**'. Esta Variable se usará en su código WLanguage para señalar al programa Pascal qué botón ha sido pulsado, por ejemplo.

Ejemplo: Código Pascal


```txt
{ open the first window of the program that contains the menu }
CALLWD('OPEN,menu.wdw);
{ the program loops until the File Exit option }
{ is selected }
while( WDKey<>'ESC' ) do
begin
{ perform the input of the menu }
CALLWD('SCREEN,input');
	{------------------------------------------------}
{ Decode the selected option.	  }
{ WDString contains the sequence of shortcut letters }
{ that are used to select the menu choice }
{------------------------------------------------}
if( WDKey='FQ' ) then WDKey:='ESC';{ Exit              }
if( WDKey='RN' ) then FindCity;      { Search by City }
if( WDKey='RD' ) then FindState;      { Search by State }
if( WDKey='DD' ) then LstState;      { Display the list.    }
if( WDKey='DI' ) then LstPrint;     { Print.         }
if( WDKey='DC' ) then LstConfig;      { Configure the printout   }
end;
```


Código de "File .. Exit" de la ventana "Menu" de WINDEV (WLanguage):


```txt
if( WDKey='FQ' ) then WDKey:='ESC';{ Exit from the loop }
```


Cuando el usuario haga clic en el menú "Archivo .. Salir", se devolverá **WDKey** al código Pascal para realizar la siguiente acción.

<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Finalización de la aplicación
<a name="finalizacion_aplicacion_ELTTEXTE000301"></a>
Para finalizar el uso de la interfaz externa, todo lo que tiene que hacer es llamar a **HFDoneShare** y **Hecho en WDD** que no esperan ningún parámetro. Por ejemplo:


```txt
{ Done... }
{ use HFDoneShare only if an HFSQL database is used }
HFDoneShare;
WDEnd;
end.
```



