


## Conector Nativo SQL Server: Programación con funciones HFSQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000261"></a>
Para utilizar una base de datos SQL Server con Conector Nativo, **la estructura de las tablas de SQL Server debe importarse en el análisis del modelo de datos**. 

**Diferencias con respecto a la programación SQL**: Las consultas no son necesarias para manipular los datos de SQL Server. De hecho, las funciones HFSQL se pueden utilizar directamente para leer datos, realizar búsquedas e implementar filtros., ... Sin embargo, la estructura de los archivos de SQL Server debe ser importada a editor de análisis.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Importación de la estructura de los ficheros
<a name="importacion_estructura_los_ficheros_ELTTEXTE000291"></a>


### Los pasos de importación
<a name="los_pasos_importacion_ELTPARAGRAPHE000022"></a>

Para realizar esta importación: 

1. Inicie la editor de análisis: haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Ico_Analyse.gif) en los botones de acceso rápido.

2. En la pestaña "Análisis", en el grupo "Creación", despliegue "Importar" y seleccione "Importar descripciones de archivos/tablas...".

3. El asistente se abre. Se establece automáticamente una conexión con la base de datos del servidor SQL y associated con los archivos importados en el análisis. Esta conexión se utilizará para manipular el archivo de datos de SQL Server a través de la programación.




En los diferentes pasos de la asistente, elija las siguientes opciones:

- Tipo de base de datos: SQL Server. 

- Características de la conexión: Servidor de datos, usuario y contraseña, base de datos.  

- La aplicación accederá a los datos en el formato actual.

- Una vez establecida la conexión, basta con seleccionar las tablas que se importarán en el análisis WINDEV o WEBDEV.. Estas tablas pueden manejarse mediante programación con las funciones HFSQL de WLanguage. Estas tablas se mostrarán en azul en el editor de análisis.



<a name="NOTE2_2"></a>


### Teniendo en cuenta la evolución de la base de datos SQL Server
<a name="teniendo_cuenta_evolucion_base_datos_sql_server_ELTPARAGRAPHE000054"></a>

Para tener en cuenta las evoluciones de las tablas importadas en el editor de análisis, vaya a la pestaña "Análisis", al grupo "Análisis", amplíe "Sincronización " y seleccione "Actualizar análisis a partir de bases de datos externas".

Una asistente comienza, permitiéndole:

- analizar las diferencias para las tablas importadas.

- analizar las diferencias para todas las tablas de SQL Server.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Programación
<a name="programacion_ELTTEXTE000321"></a>


### 1. Establecimiento de la conexión
<a name="1_establecimiento_conexion_ELTPARAGRAPHE000080"></a>

Para establecer la conexión con la base de datos de SQL Server, utilice [HOpenConnection](../WDLang4/3044107.md) y especifique el nombre de la conexión a abrir. El nombre de la conexión se definió al importar la estructura de los archivos en el análisis.. 

Para modificar algunos parámetros de esta conexión (nombre de usuario o contraseña, por ejemplo), llame a [HConnect](../WDLang4/3044263.md).

**Observaciones**:

- Si intenta leer el archivo directamente ([HReadFirst](../WDLang4/3044051.md), ...), se abrirá automáticamente la conexión asociada al archivo description en el análisis.

- El [información opcional de conexión](../WDLang4/9000124.md) sirve para configurar el comportamiento del Conector Nativo (formato de la fecha, resultado de las concatenaciones, etc.).

- Por Default, la versión instalada de la Conector Nativo SQL Server se utiliza. Si ha instalado tanto la Conector Nativo SQL Server vía OLE DB como vía ODBC, la Conector Nativo vía OLE DB será utilizada. Puede seleccionar la versión a utilizar. El [H.SQLServerMode](../WDLang4/3044276.md) Variable se utiliza para forzar un modo a través de los siguientes valores:

	- 0 para forzar la Conector Nativo SQL Server a través de OLE DB.

	- 3 para forzar a la Conector Nativo SQL Server a través de ODBC.


Este Variable debe ser modificado antes de utilizar [HDescribeConnection](../WDLang4/3044205.md) y/o [HOpenConnection](../WDLang4/3044107.md).

- Puede utilizar información específica ampliada (en [HOpenConnection](../WDLang4/3044107.md) o [HDescribeConnection](../WDLang4/3044205.md)):

	- ***WD Cache Size***: Define el número de registros que deben ser leídos al mismo tiempo por un cursor del servidor.. Por defecto, este valor se establece en 100.

	- ***WD Cursor Location***: Si "WD Cursor Location = SERVER", le da la posibilidad de usar un cursor de servidor para todas las búsquedas realizadas en esta conexión. El tipo de cursor del servidor utilizado es FAST_FORWARD. Para más detalles, consulte la documentación sobre SQL Server. Este tipo de cursor se puede utilizar para:
			    - Limitar los recursos reservados en el servidor durante las operaciones de búsqueda. 
			    - Limite el número de conexiones abiertas por el acceso nativo para gestionar las múltiples búsquedas en paralelo..
			Atención: 

		- En la mayoría de los casos, las búsquedas realizadas con los cursores del servidor son más lentas que las búsquedas realizadas en modo Default. 

		- Los cursores del servidor pueden no ser compatibles con algunos tipos de consultas. 

		- El rendimiento se ve afectado por el tamaño de la caché.
						**Observación**: Los cursores del servidor se utilizan automáticamente cuando una conexión está en transacción.




- **SQL Azure**: Si el nombre del servidor es tal como: NombreServidor.base de datos.windows.net, el login debe tener el siguiente formato: login@NombreServidor. 



<a name="NOTE3_2"></a>


### 2. Ejecutar las consultas
<a name="2_ejecutar_las_consultas_ELTPARAGRAPHE000145"></a>

[HExecuteQuery](../WDLang4/3044080.md) y [HExecuteSQLQuery](../WDLang4/3044084.md) se utilizan para ejecutar consultas en la base de datos actual.

- **HExecuteQuery**: se usa para ejecutar una consulta preestablecida con el editor de consultas.

- **HExecuteSQLQuery**: se utiliza para ejecutar una consulta especificando el código SQL de la consulta y el nombre que se asignará a este código SQL.



```wl
// Initialize the "Customer_84" query
HExecuteQuery(CUSTOMER_84, "SQLServerDatabase", hQueryWithoutCorrection)
HExecuteSQLQuery(CustomerQry, "SQLServerDatabase", hQueryWithoutCorrection, ...
		"SELECT NAME FROM CUSTOMER")
```

<a name="NOTE3_3"></a>


### 3. Recuperación del resultado
<a name="3_recuperacion_del_resultado_ELTPARAGRAPHE000162"></a>

El resultado se lee mediante funciones de lectura estándar: [HReadFirst](../WDLang4/3044051.md), [HReadNext](../WDLang4/3044037.md), [HReadSeek](../WDLang4/3044050.md)...

Los registros no pueden ser bloqueados por las opciones de bloqueo de estas funciones.
<a name="NOTE3_4"></a>


### 4. Cierre de la conexión
<a name="4_cierre_conexion_ELTPARAGRAPHE000180"></a>

[HCloseConnection](../WDLang4/3044095.md) se utiliza para cerrar la conexión con la base de datos una vez que se han ejecutado todas las consultas necesarias.
<a name="NOTE3_5"></a>


### Optimización
<a name="optimizacion_ELTPARAGRAPHE000189"></a>

- **TLos controles "Browsing tabla" basados en consultas se optimizan**: el contenido de la control Tabla se puede ordenar haciendo clic en una de sus columnas.

- Para evitar volver a ejecutar la misma consulta varias veces al navegar por su resultado, le recomendamos utilizar la constante ***hNoRefresh*** (por ejemplo, si un solo equipo modifica los datos).

- Cada búsqueda en una tecla requiere la creación de un "cursor".. Este "cursor" se ejecuta en una "tarea" de SQL SERVER. Para evitar almacenar procesos inútiles en el servidor, le recomendamos que utilice: 

	- [HClose](../WDLang4/3044073.md) en las mesas una vez terminada la navegación,

	- [HCancelDeclaration](../WDLang4/3044174.md) para las consultas de navegación.






<a name="NOTE3_6"></a>


### SQL Azure
<a name="sql_azure_ELTPARAGRAPHE000207"></a>

SQL Azure requiere la presencia de un "índice agrupado" en los archivos de datos.
Si los archivos de datos son creados por [HCreation](../WDLang4/3044255.md), el Conector Nativo automatic crea el "índice agrupado" si la descripción del archivo de datos contiene un identificador automatic.


