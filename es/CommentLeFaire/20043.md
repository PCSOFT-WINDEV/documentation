
## ¿Cómo crear una consulta SQL para filtrar registros?
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>
Para filtrar (o seleccionar) los registros procedentes de un archivo de datos, tiene la posibilidad de realizar un bucle de exploración y de utilizar [HFilter](../WDLang4/3044100.md). 

El mejor método para realizar este filtro (o selección) consiste en utilizar una consulta SQL.

Veamos cómo realizar un filtro usando: 

- [una consulta SQL creada con el editor de consultas](#NOTE2_1).

- [una consulta creada mediante programación](#NOTE3_1). 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Consulta SQL con una selección de registros de archivos
<a name="consulta_sql_con_una_seleccion_registros_archivos_ELTTEXTE000168"></a>
Esta consulta se utiliza para seleccionar los registros de fichero correspondientes a una condición de selección.. 

En este ejemplo, queremos seleccionar los registros cuya ciudad es igual a un parámetro específico del archivo CLIENTE.

Los pasos para crear esta consulta SQL con filtro son los siguientes: 

1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_nouveau.gif) en los botones de acceso rápido. 

	- En la ventana que se muestra, haga clic en "Consultas". 

	- El asistente de creación de consultas se abre.




2. Seleccione crear una consulta de selección (opción "Selección (SELECT)"). <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0001.gif&type=thumb)
]
	Pase a la etapa siguiente del asistente.

3. La ventana de descripción de la consulta se abre.

4. Dar un nombre y una leyenda a la consulta: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0002.gif&type=thumb)


5. En la sección izquierda de la ventana de description, elija los elementos del archivo que se utilizarán (en nuestro ejemplo, el archivo CLIENTE y los elementos Nombre del cliente, Empresa y Ciudad). 

6. Haga doble clic en los nombres de los elementos para añadirlos a la lista de elementos de consulta: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0003.gif)


7. Para aplicar el filtro (selección), haga clic en "Condición de selección" en la sección derecha del editor.<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0004.gif)


8. Haga clic en "Nueva condición...". 

9. En la ventana que aparece: 

	- Seleccione la operación ("es igual" en nuestro ejemplo).

	- Seleccione "Parámetro" para poder pasar el valor escrito por el usuario a la consulta.

	- Dar un nombre al parámetro. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0005.gif)





10. Validar. La ventana de consulta description se actualiza: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0006.gif)


11. Valide la ventana de descripción de la consulta. La consulta se muestra en el editor: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0007.gif)


12. Guardar la consulta (Ctrl + S). 

13. Presione F2 para ver el código SQL: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Filtre%20-%20HC%20N%B0008.gif)


14. Ejecutar la prueba de consulta (GO en los botones de acceso rápido). 

15. La consulta puede ser ejecutada en el programa por [HExecuteQuery](../WDLang4/3044080.md). Los parámetros esperados se deben inicializar en el código. 

16. Ejemplo de llamada desde un clic de botón: 
	
	```wl
	QRY_Filter.ParamCity = "Paris"
	HExecuteQuery(QRY_Filter)
	```





<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Consultas SQL con filtro a través de la programación
<a name="consultas_sql_con_filtro_traves_programacion_ELTTEXTE000192"></a>
Las consultas SQL pueden escribirse directamente mediante programación en el código WLanguage. Para ello, es necesario: 

1. Crear una Variable de tipo [Fuente de datos](../WDLang4/1514053.md) para representar la consulta en tiempo de ejecución. 

2. Crear una cadena de caracteres Variable para contener el código SQL de la consulta y escribir el código SQL en este Variable. 

3. Ejecute la consulta SQL con [HExecuteSQLQuery](../WDLang4/3044084.md).

4. Explore el resultado con las funciones HReadXXX.




Ejemplo de código: 


```wl
Src1 is Data Source
sSQLCode is string

// Select the products whose price is greater than ...
sSQLCode = [
SELECT PRODUCT.Reference AS Reference,	
	PRODUCT.ProdCap AS ProdCap,	
	PRODUCT.Pricebt AS Pricebt
FROM PRODUCT
WHERE PRODUCT.Pricebt > %1
]

cyPrice is currency
cyPrice = EDT_PRICE // value coming from an edit control

sSQLCode = StringBuild(sSQLCode, cyPrice)

HExecuteSQLQuery(Src1, hQueryDefault, sSQLCode)
FOR EACH Src1
	TRACE(Src1.Reference , Src1.ProdCap, Src1.Pricebt)

END
```



