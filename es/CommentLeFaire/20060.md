
## ¿Cómo se crea una consulta SQL a get una suma?
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>
Para realizar una suma de valores provenientes de un archivo de datos, tienes la capacidad de realizar un bucle de navegación y de sumar un valor en un Variable numérico. 

El mejor método para realizar esta suma consiste en utilizar una consulta SQL.

Veamos cómo realizar una suma usando: 

- una consulta SQL creada con el editor de consultas: 

	- [Consulta de Suma SQL en todo el archivo de datos](#NOTE2_1).

	- [Consulta de suma SQL en una agrupación](#NOTE3_1).




- [una consulta creada mediante programación](#NOTE4_1). 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Consulta de Suma SQL en todo el archivo de datos
<a name="consulta_suma_sql_todo_archivo_datos_ELTTEXTE000185"></a>
Una consulta de Suma se usa para sumar un valor encontrado en todos los registros de un archivo de datos. 

En este ejemplo, vamos a realizar la suma de todas las órdenes encontradas en el archivo ORDER.

Los pasos para crear esta consulta de suma SQL son los siguientes: 

1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_nouveau.gif) en los botones de acceso rápido. 

	- En la ventana que se muestra, haga clic en "Consultas". 

	- El asistente de creación de consultas se abre.




2. Seleccione crear una consulta de selección (opción "Selección (SELECT)"). <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0001.gif&type=thumb)

	Pase a la etapa siguiente del asistente.

3. La ventana de descripción de la consulta se abre.

4. Dar un nombre y una leyenda a la consulta: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0002.gif&type=thumb)


5. En la sección izquierda de la ventana de description, elija el elemento del archivo para el cual se realizará la suma (TotalBT en nuestro ejemplo). 

6. Haga doble clic en el nombre del elemento para agregarlo a la lista de elementos de consulta.: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0003.gif)


7. En la sección derecha del editor, haga clic en el botón "Suma. La siguiente ventana se abre: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0004.gif)


8. Validar. La ventana de consulta description se actualiza: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0005.gif)


9. Valide la ventana de descripción de la consulta. La consulta se muestra en el editor: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0006.gif)


10. Guardar la consulta (Ctrl + S). 

11. Presione F2 para ver el código SQL: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0007.gif)


12. Ejecutar la prueba de consulta (GO en los botones de acceso rápido). 

13. La consulta se puede ejecutar en el programa por [HExecuteQuery](../WDLang4/3044080.md).




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Consulta de suma SQL en una agrupación
<a name="consulta_suma_sql_una_agrupacion_ELTTEXTE000209"></a>
Tiene la capacidad de crear una consulta que realice la suma de un valor según un criterio de grupo.. 

En este ejemplo, vamos a realizar la suma u órdenes por modo de entrega.

Los pasos para crear una consulta de suma en una agrupación son los siguientes: 

1. Crear una consulta de suma (ver párrafo anterior). 

2. En el archivo de datos, seleccione el elemento que se utilizará como argumento de grupo. En nuestro ejemplo, vamos a elegir el título del modo de entrega. 

3. Añada este elemento a los elementos de consulta (haga doble clic en el nombre del elemento, por ejemplo).. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0008.gif)


4. Valide la ventana de descripción de la consulta. La consulta se muestra en el editor: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0009.gif)


5. Guardar la consulta (Ctrl + S). 

6. Presione F2 para ver el código SQL: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_Somme%20-%20HC%20N%B0010.gif)


7. Ejecutar la prueba de consulta (GO en los botones de acceso rápido). 

8. La consulta se puede ejecutar en el programa por [HExecuteQuery](../WDLang4/3044080.md).








<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Consulta de suma SQL sobre una agrupación mediante programación
<a name="consulta_suma_sql_sobre_una_agrupacion_mediante_programacion_ELTTEXTE000233"></a>
Las consultas SQL pueden escribirse directamente mediante programación en el código WLanguage. Para ello, es necesario: 

1. Crear una Variable de tipo [Fuente de datos](../WDLang4/1514053.md) para representar la consulta en tiempo de ejecución. 

2. Crear una cadena de caracteres Variable para contener el código SQL de la consulta y escribir el código SQL en este Variable. 

3. Ejecute la consulta SQL con [HExecuteSQLQuery](../WDLang4/3044084.md).

4. Explore el resultado con las funciones HReadXXX.




**Ejemplo de código**


```wl
Src1 is Data Source
sSQLCode is string

// Sum or orders by payment mode
sSQLCode = [
SELECT PAYMENT.PaymentCap, SUM(ORDER.TotalBT) AS SumOrders
FROM ORDER, PAYMENT
WHERE ORDER.PaymentID=PAYMENT.PaymentID
GROUP BY PaymentCap
]

HExecuteSQLQuery(Src1, hQueryDefault, sSQLCode)
FOR EACH Src1
	TRACE(Src1.PaymentCap, Src1.SumOrders)
END
```



