
## ¿Cómo crear una consulta SQL para contar?
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>
Para contar los registros en un archivo de datos, tienes la capacidad de realizar un bucle de navegación y de incrementar un entero Variable. 

El mejor método para realizar este recuento consiste en utilizar una consulta SQL.

Veamos cómo realizar un conteo usando: 

- [Método 1: una consulta SQL creada con el editor de consultas](#NOTE2_1).

	- [Consulta de recuento SQL en todo el archivo de datos](#NOTE2_1). 

	- [Consulta de recuento SQL en una agrupación](#NOTE3_1). 




- [Método 2: una consulta creada mediante programación](#NOTE4_1).




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Consulta de recuento SQL en todo el archivo de datos
<a name="consulta_recuento_sql_todo_archivo_datos_ELTTEXTE000189"></a>
Esta consulta de conteo se usa para contar todos los registros encontrados en un archivo de datos. Las imágenes presentan el recuento de todos los registros encontrados en el archivo del CLIENTE.

Los diferentes pasos para crear esta consulta de recuento SQL son los siguientes: 

1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_nouveau.gif) en los botones de acceso rápido. 

	- En la ventana que se muestra, haga clic en "Consultas". 

	- El asistente de creación de consultas se abre.




2. Seleccione crear una consulta de selección (opción "Selección (SELECT)"). <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_Comptage%20-%20HC%20N%B0001.gif&type=thumb)

	Pase a la etapa siguiente del asistente.

3. La ventana de descripción de la consulta se abre.

4. Dar un nombre y una leyenda a la consulta: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_Comptage%20-%20HC%20N%B0002.gif&type=thumb)


5. Elija un elemento (identificador por ejemplo) en el archivo de datos donde se realizará el recuento. 

6. Añadir este elemento a la lista de elementos de consulta.   <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_Comptage%20-%20HC%20N%B0003.gif)


7. En la sección derecha del editor, haga clic en el botón "Contar. En el menú que aparece en pantalla, seleccione "Contar con el elemento seleccionado".: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_Comptage%20-%20HC%20N%B0004.gif)
 Aparece la siguiente ventana: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_Comptage%20-%20HC%20N%B0005.gif&type=thumb)


8. Validar. La ventana de consulta description se actualiza: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_comptage%20-%20HC%20N%B0006.gif)


9. Valide la ventana de descripción de la consulta. La consulta se muestra en el editor: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_comptage%20-%20HC%20N%B0007.gif)


10. Guardar la consulta (Ctrl + S). 

11. Presione F2 para ver el código SQL: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_comptage%20-%20HC%20N%B0008.gif)


12. Ejecutar la prueba de consulta (GO en los botones de acceso rápido). 

13. La consulta se puede ejecutar en el programa por [HExecuteQuery](../WDLang4/3044080.md).




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Consulta de recuento SQL en una agrupación
<a name="consulta_recuento_sql_una_agrupacion_ELTTEXTE000213"></a>
Tiene la capacidad de crear una consulta que cuente los registros según un criterio de grupo.. 

En este ejemplo, vamos a contar el número de clientes por estado.

Los pasos para crear una consulta de recuento en una agrupación son los siguientes: 

1. Crear una consulta de recuento (ver párrafo anterior)

2. En el archivo de datos, seleccione el elemento que se utilizará como argumento de grupo. En nuestro ejemplo, vamos a elegir el código postal.

3. Añada este elemento a los elementos de consulta (haga doble clic en el nombre del elemento, por ejemplo).. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_comptage%20-%20HC%20N%B0009.gif)


4. Vamos a añadir una nueva acción para realizar un agrupamiento sólo en el estado. En la sección derecha de la ventana de description, haga clic en "Año, estado" y seleccione "Estado". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_comptage%20-%20HC%20N%B0010.gif)
 Aparece la siguiente ventana: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_comptage%20-%20HC%20N%B0011.gif)


5. Validar. La ventana de consulta description se actualiza: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_comptage%20-%20HC%20N%B0012.gif)


6. Valide la ventana de descripción de la consulta. La consulta se muestra en el editor: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requete_comptage%20-%20HC%20N%B0013.gif)


7. Guardar la consulta (Ctrl + S). 

8. Presione F2 para ver el código SQL: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=CLF_Requ%EAte_comptage%20-%20HC%20N%B0014.gif)


9. Ejecutar la prueba de consulta (GO en los botones de acceso rápido). 

10. La consulta se puede ejecutar en el programa por [HExecuteQuery](../WDLang4/3044080.md).








<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Consulta de recuento SQL sobre una agrupación mediante programación
<a name="consulta_recuento_sql_sobre_una_agrupacion_mediante_programacion_ELTTEXTE000237"></a>
Las consultas SQL pueden escribirse directamente mediante programación en el código. Para ello, es necesario: 

1. Crear una fuente de datos Variable para representar la consulta en tiempo de ejecución

2. Crear una cadena de caracteres Variable para contener el código SQL y escribir el código SQL en este Variable

3. Ejecute la consulta SQL con [HExecuteSQLQuery](../WDLang4/3044084.md)

4. Explore el resultado con las funciones HReadXXX.




**Ejemplo de código**


```wl
Src1 is Data Source
sSQLCode is string

// Counts the number of orders by payment type
sSQLCode = [
SELECT PAYMENT.PaymentCap, COUNT(ORDER.OrderID) AS NumberOrders
FROM ORDER, PAYMENT
WHERE ORDER.PaymentID=PAYMENT.PaymentID
GROUP BY PaymentCap
]

HExecuteSQLQuery(Src1, hQueryDefault, sSQLCode)
FOR EACH Src1
	TRACE(Src1.PaymentCap, Src1.NumberOrders)
END
```



