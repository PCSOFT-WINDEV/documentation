
## Android 10: Modificación del comportamiento de las aplicaciones
			

<DIV class="specObsolete">
	<IMG style="float:left;margin-right:10px;" src="https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=warning_big.png"><B>Advertencia</B><BR>
	A partir de la versión <B>26 (93)</B>, WINDEV Mobile es compatible con Android 11. Para obtener más información, consulte [Android 11: Modificación del comportamiento de las aplicaciones](../Editeurs/9000201.md). 
</DIV><a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000232"></a>
Después de cada nueva versión de Android, Google requiere que se aumente el nivel de API "TargetSdkVersion" para publicar aplicaciones en Google Play. Con el lanzamiento de Android 10, Google ahora requiere que las aplicaciones suban el nivel de API a 29 para poder implementarlas. Este nuevo nivel de API se aplica a partir del:

- 3 de agosto de 2020 para las nuevas aplicaciones,

- 2 de noviembre de 2020 para las aplicaciones actualizadas.




**Las aplicaciones tendrán los siguientes cambios**:

1. **En Android 10**

	- Cuando una aplicación está en segundo plano, no se puede abrir ninguna ventana. Para obtener más información, consulte [Comportamiento de aplicaciones en segundo plano](#NOTE1_1b). 

	- Ya no es posible obtener un identificador único para el dispositivo con las funciones [SysIMEI](../WDLang1/3073029.md) y [SysSerialNum](../WDLang1/3073033.md). Las aplicaciones "Device owner" no se ven afectadas por esta restricción.

	- Ya no es posible manipular los parámetros de conexión WiFi mediante programación. Las siguientes funciones provocan un error fatal cuando se utilizan en Android 10 o posterior: [WiFiActivate](../WDLang3/1000019350.md) (sintaxis para cambiar solo la activación), [WiFiAddNetwork](../WDLang3/1000019351.md), [WiFiDeleteNetwork](../WDLang3/1000019357.md), [WiFiConnect](../WDLang3/1000019352.md) y [WiFiListNetwork](../WDLang3/1000019356.md).
			Las aplicaciones "Device owner" no se ven afectadas por esta restricción.

	- Ya no es posible obtener el contenido del portapapeles si la aplicación está en segundo plano.. En ese caso, la función [Clipboard](../WDLang1/3063004.md) devolverá una cadena vacía.




2. **En Android 10 con nivel de API 29**: 

	- Las aplicaciones ya no pueden acceder a los archivos ubicados en el almacenamiento externo, fuera de sus directorios específicos (función [SysDirExternalStorage](../WDLang1/1000021793.md) con constantes sseApp\*).
			Ya no se puede acceder a estos archivos en modo de lectura o escritura. Por lo tanto, no deben utilizarse rutas de archivo fijas o construidas a partir de las funciones [SysDirStorageCard](../WDLang1/3073034.md) o [SysDirExternalStorage](../WDLang1/1000021793.md) con las constantes ssePublicxxx. Esta restricción será definitiva a partir de Android 11, nivel de API 30. En Android 10 (nivel de API 29), es posible seguir accediendo a algunas de estas ubicaciones, por lo que pueden utilizarse con esta versión de WINDEV Mobile (para ello, el atributo *requestLegacyExternalStorage* se agrega automáticamente). No obstante, se recomienda realizar las adaptaciones necesarias en las aplicaciones que acceden a estas ubicaciones.

	- Android 10 ha implementado un nuevo permiso para las funciones que permiten obtener la ubicación del dispositivo: ACCESS_BACKGROUND_LOCATION. 
			Este permiso se añade automáticamente cuando se utiliza una de las siguientes funciones en la aplicación para permitir su uso en segundo plano: 
			


|   |   |
| --- | --- |
| [BeaconDetectBackground](../WDLang3/1000023112.md) | Notifica a la aplicación cuando el dispositivo entra o sale del rango de transmisión de un conjunto de balizas. |
| [BeaconDetectPrecise](../WDLang3/1000023115.md) | Permite buscar balizas cerca del dispositivo. |
| [BTLEListDevice](../WDLang3/1000021882.md) | Devuelve la lista de dispositivos Bluetooth Low Energy. |
| [BTListDevice](../WDLang3/1000017132.md) | Devuelve la lista de dispositivos Bluetooth accesibles. |
| [geoTrackingEnable](../WDLang3/1000021583.md) | Permite seguir la ubicación en una aplicación WINDEV Mobile. |
| [GPSDetectPosition](../WDLang3/1000019209.md) | Pide ser notificado cuando el dispositivo se acerca a una ubicación determinada. |
| [GPSFollowMovement](../WDLang3/1000019206.md) | Solicita que se le notifique periódicamente la ubicación actual del dispositivo. |
| [GPSGetPosition](../WDLang3/1000019205.md) | Recupera información sobre la posición actual del dispositivo. |
| [GPSInfo](../WDLang3/1000019208.md) | Devuelve información sobre el proveedor de ubicación utilizado por la aplicación para las funciones de geolocalización. |
| [GPSInitParameter](../WDLang3/1000019204.md) | Inicializa los parámetros de las funciones de geolocalización de WLanguage y busca un proveedor de ubicación. |
| [GPSLastPosition](../WDLang3/1000019239.md) | Recupera la información sobre la última posición conocida del dispositivo. |
| [GPSStatus](../WDLang3/1000019207.md) | Recupera el estado de activación del proveedor de geolocalización o pide ser notificado cuando cambia el estado. |
| [GPSStopDetection](../WDLang3/1000019240.md) | Detiene la detección de la ubicación activada por [GPSDetectPosition](../WDLang3/1000019209.md). |
| [MapFollowMovement](../WDLang3/1000019953.md) | Muestra la ubicación actual del dispositivo en una control Mapa y actualiza la ubicación a medida que se mueve. |
| [MobileNetworkConnectionInfo](../WDLang3/1000020176.md) | Devuelve información sobre la conexión actual a los datos a través de la red móvil. |
| [WiFiDetectAccessPoint](../WDLang3/1000019353.md) | Inicia la detección de los puntos de acceso Wi-Fi a los que se puede acceder desde el dispositivo. |




**Observación**: El siguiente error puede aparecer cuando se publica una aplicación en el Play Store: "La clave privada no se cifró correctamente o no se admite este tipo de clave". Se debe volver a crear el archivo de firma de la aplicación (este archivo se puede crear en el asistente de generación de la aplicación). 
**Atención**: Si hay identificadores basados en el archivo de firma (por ejemplo, el identificador de Google Map), es necesario volver a generarlos con la nueva clave. 


### Recordatorio: nivel de API al que se orienta la app ("TargetSdkVersion")
<a name="recordatorio_nivel_api_que_orienta_app_targetsdkversion_ELTPARAGRAPHE000084"></a>

Cuando se compila una aplicación para Android, el APK generado incluye un nivel de API "TargetSdkVersion" del SDK de Android. Con este nivel de API, Android determina las funcionalidades que se pueden incluir en la aplicación, y las reglas de seguridad que se deben aplicar a la misma.

El nivel de API de una aplicación ("TargetSdkVersion") puede verse en el asistente de generación del APK, en la etapa "Configuración": 

1. Haga clic en "Configuración avanzada",

2. En la ventana "Configuración avanzada", seleccione "Editar manifiesto",

3. Despliegue el nodo "uses-sdk",

4. la línea "android:targetSdkVersion" muestra el nivel de API.


El nivel de API se puede modificar. Esto significa que es posible especificar el nivel de API 29 en una aplicación WINDEV Mobile generada sin la actualización 118 661. Pero en este caso la aplicación no tendrá un framework adaptado a las especificidades de este nivel de API. Por lo tanto, esta solución debe evitarse, ya que Android aplicará reglas de seguridad diferentes de aquellas para las que se ha probado la aplicación.

Para obtener más información, consulte [el sitio de Google](https://developer.android.com/studio/publish/versioning). 

<a name="NOTE1_1b"></a>


## Comportamiento de aplicaciones en segundo plano
<a name="comportamiento_aplicaciones_segundo_plano_ELTTEXTE000379"></a>


### Presentación
<a name="presentacion_ELTPARAGRAPHE000106"></a>

A partir de Android 10, Google no permite que una aplicación abra una ventana si está en segundo plano (Activity) [https://developer.android.com/guide/components/activities/background-starts](https://developer.android.com/guide/components/activities/background-starts). Este es un cambio muy importante que afecta a todas las aplicaciones Android, incluidas las que se generan con WINDEV Mobile. Las aplicaciones "Device owner" son la única excepción. En este modo específico, las aplicaciones aún pueden abrir las ventanas.

Una aplicación que se ha ejecutado correctamente en versiones anteriores, tendrá restricciones si se instala en Android 10:

- cuando la aplicación está en segundo plano, no es posible abrir una ventana (mediante las funciones [OpenMobileWindow](../WDLang1/1000021018.md), [Info](../WDLang1/3021011.md), [Error](../WDLang1/3021013.md), [Dialog](../WDLang1/3021015.md), etc.),

- no se pueden utilizar funciones WLanguage que abran una ventana ([SMSRunApp](../WDLang3/1000020864.md), etc.),

- el framework de Android de la aplicación también se bloqueará y no podrá abrir una ventana estando en segundo plano. La apertura de una ventana en segundo plano a través del framework es necesaria para las siguientes funcionalidades:

	- recibir una notificación push,

	- detectar la entrada o salida de una región beacon (función [BeaconDetectBackground](../WDLang3/1000023112.md)),

	- recibir una nueva ubicación cuando el seguimiento (tracking) de la ubicación está activado (función [geoTrackingProcedure](../WDLang3/1000021585.md)),

	- ejecutar tareas en segundo plano (funciones [BackgroundTaskxxx](../WDLang3/1000023472.md)).

	- ejecutar la aplicación cuando se inicia el dispositivo Android.







Estas restricciones se aplican a todas las aplicaciones generadas con WINDEV Mobile 25 "Update 2" y versiones anteriores.
<a name="NOTE2_1"></a>


### Cambios a partir de WINDEV Mobile 25 Update 3
<a name="cambios_partir_windev_mobile_25_update_3_ELTPARAGRAPHE000153"></a>

El framework de Android de las aplicaciones WINDEV Mobile ha sido modificado para tener en cuenta este requisito de Google. Todas las adaptaciones necesarias están incluidas a partir de WINDEV Mobile 25 Update 3. 

A partir de WINDEV Mobile 25 Update 3, las notificaciones push, el seguimiento de la ubicación y la detección de balizas (beacon), ... se han restablecido. Además, se ha mejorado el mecanismo de seguridad de WLanguage para provocar un error fatal si se llama a una función que abre una ventana cuando la aplicación está en segundo plano (ver lista de funciones relacionadas). 

Para asegurarse de que una aplicación funciona correctamente en Android 10, es necesario:

- usar al menos WINDEV Mobile 25 Update 3 para generarla,

- verificar todos los procesos que se pueden ejecutar desde la aplicación en segundo plano: estos procesos no deben abrir ninguna ventana. Para optimizar el código, es posible: 

	- utilizar la función [InBackgroundMode](../WDLang1/1000023457.md) para determinar si el proceso actual se está ejecutando en segundo plano.

	- utilizar la función [ExeInfo](../WDLang1/3035001.md) para saber si la aplicación se inicia al mismo tiempo que el dispositivo. En este caso, si se llama a esta función con la constante **exeLaunch** como parámetro, se devuelve la constante **exeStartup**.

	- Si una aplicación debe interactuar con el usuario cuando está en segundo plano, se recomienda mostrar una notificación. Al hacer clic en la notificación, la aplicación volverá al primer plano y podrá abrir una ventana desde el procedimiento llamado con la propiedad **ActionClick** de la notificación (la propiedad **ActivateApplication** de la variable [Notification](../WDLang3/1000019441.md) debe estar establecida en True).




- al desarrollar la aplicación en un dispositivo Android, utilice el registro Android para identificar el origen de un posible bloqueo durante la ejecución en segundo plano. Dado que no se puede abrir una ventana cuando la aplicación está en segundo plano, el mecanismo de seguridad de WLanguage no puede transmitir ninguna información. Los errores se registran en el [registro Android](../Editeurs/9000108.md).





### Lista de funciones relacionadas
<a name="lista_funciones_relacionadas_ELTPARAGRAPHE000182"></a>Las siguientes funciones provocan un error fatal si se realiza una llamada desde un código ejecutado en segundo plano: 



|   |   |
| --- | --- |
| [AlbumPicker](../WDLang3/1000020186.md) | Recupera una foto, imagen o video almacenado en el álbum de fotos del dispositivo móvil. |
| [AppointmentCreate](../WDLang3/1000020691.md) | Muestra la ventana de creación de la aplicación nativa Appointment para la gestión de los Appointment que se encuentran en el dispositivo Android. |
| [AppointmentDisplay](../WDLang3/1000020692.md) | Muestra una Appointment en la aplicación nativa de gestión de Appointment s que se encuentra en el dispositivo móvil (Android o iOS). |
| [AppOpenForm](../WDLang1/1000020980.md) | inaugura: <br><br>- el formulario de una aplicación en Android (Play Store), iOS (App Store) o Windows (Windows Store) para que el usuario le dé una marca y/o a comment la.<br><br>- el formulario para configurar las compras In-App de una aplicación. <br><br><br> |
| [AuthIdentify](../WDLang3/1000022219.md) | Realiza una autenticación utilizando el protocolo OAuth 2.0 en cualquier Webservice. |
| [BCCapture](../WDLang5/1000019456.md) | Decodifica la información almacenada en un código de barras utilizando la cámara del dispositivo (Android, iPhone, iPad). |
| [BTChangeVisibility](../WDLang3/1000017129.md) | Cambia la visibilidad de una radio Bluetooth. |
| [CheckUserIdentity](../WDLang3/1000021348.md) | Permite comprobar la identidad real del usuario actual a través de la comprobación biométrica. |
| [Confirm](../WDLang1/3021007.md) | Muestra un mensaje en un cuadro de diálogo estándar que propone la opciones "Sí", "No", "Cancelar", y devuelve la respuesta del usuario. |
| [ConfirmAsynchronous](../WDLang1/1000025305.md) | Muestra un mensaje no bloqueante en un cuadro de diálogo estándar con las respuestas "Sí", "No", "Cancelar" y llama a un procedimiento WLanguage con la respuesta del usuario. |
| [ContactCreate](../WDLang3/1000019556.md) | Muestra la ventana de creación de Contact de la aplicación nativa de gestión de Contact que se encuentra en el dispositivo (Android, iPhone o iPad, Universal Windows). |
| [ContactDisplay](../WDLang3/1000019506.md) | Abre el formulario de una Contact en la aplicación nativa de gestión de Contact del dispositivo (Android, iPhone o iPad, Universal Windows). |
| [ContactEdit](../WDLang3/1000019507.md) | Abre el formulario de una Contact en modo de edición en la aplicación nativa de Contact s del dispositivo (Android, iPhone, iPad, Universal Windows). |
| [ContactSelect](../WDLang3/1000019508.md) | Muestra la lista de contactos encontrados en el dispositivo (Android, iPhone o iPad, Universal Windows). |
| [DatePicker](../WDLang1/1000020018.md) | Abre el selector de fecha del sistema. |
| [Dialog](../WDLang1/3021015.md) | Muestra un cuadro de mensaje y devuelve el valor del botón pulsado por el usuario. |
| [DialogAsynchronous](../WDLang1/1000025310.md) | Muestra un cuadro de mensaje no bloqueante y llama a un procedimiento WLanguage con el valor del botón pulsado por el usuario. |
| [EmailOpenMail](../WDLang2/3032021.md) | Abre el software de mensajería Default: <br><br>- de usuario Web en el ordenador del navegador.<br><br>- del usuario en el ordenador Windows actual.<br><br>- en la Phone.  <br><br><br> |
| [EmailRunApp](../WDLang3/1000019564.md) | Inicia la aplicación nativa para enviar mensajes de correo electrónico que se encuentran en el equipo actual.: <br><br>- Ordenador con Windows,<br><br>- Dispositivo móvil (Android, iPhone, iPad). <br><br><br> |
| [Error](../WDLang1/3021013.md) | Muestra un mensaje de error personalizado en una ventana de error del sistema. |
| [ErrorAsynchronous](../WDLang1/1000025306.md) | Muestra un mensaje de error personalizado en una ventana de error del sistema no bloqueante. |
| [ErrorBuild](../WDLang1/1000018878.md) | Muestra un mensaje de error personalizado en una ventana de error del sistema. |
| [ExeRun](../WDLang1/3035006.md) | Inicia la ejecución de un programa (un ejecutable por ejemplo) desde la aplicación actual. |
| [FBStartSession](../WDLang5/1000021835.md) | Permite autenticarse e iniciar sesión en Faceboook. |
| [geoRunApp](../WDLang3/1000019954.md) | Inicia la aplicación nativa de mapas del dispositivo para mostrar: <br><br>- una ubicación geográfica específica, <br><br>- una ruta entre dos lugares.<br><br><br> |
| [GglPrintDocument](../WDLang5/1000020420.md) | Imprime un Document (archivo de texto o PDF, imágenes, Word o Excel Document, ...) usando el servicio Cloud Print de Google. |
| [gpwAuthLogin](../WDLang6/1000023597.md) | Le permite conectarse al User Groupware utilizando la autenticación con una cuenta como Facebook, Google, Microsoft, etc. |
| [inAppPurchaseProduct](../WDLang3/1000020873.md) | Envía una solicitud de compra de un producto "In-App" associated con la solicitud. |
| [Info](../WDLang1/3021011.md) | Muestra un mensaje personalizado en una ventana de información del sistema. |
| [InfoAsynchronous](../WDLang1/1000025269.md) | Muestra un mensaje personalizado no bloqueante en una ventana de información del sistema. |
| [InfoBuild](../WDLang1/1000018879.md) | Muestra un mensaje personalizado en una ventana de información del sistema. |
| [Input](../WDLang1/3021016.md) | Muestra un mensaje que permite al usuario escribir una información. |
| [KioskDisable](../WDLang3/1000024426.md) | Desactiva el modo kiosco para la aplicación actual. |
| [KioskEnable](../WDLang3/1000024425.md) | Cambia la aplicación Android en curso a modo kiosco. |
| [NFCReadTag](../WDLang3/1000020416.md) | Inicia la lectura de una etiqueta NFC o permite la detección de etiquetas NFC para la ventana actual. |
| [NFCSendTag](../WDLang3/1000020418.md) | Envía una etiqueta NFC a otro dispositivo. |
| [NFCWriteTag](../WDLang3/1000020417.md) | Inicia la escritura de datos en una etiqueta NFC. |
| [OKCancel](../WDLang1/3021004.md) | Muestra un mensaje en un cuadro de diálogo estándar que propone "OK" y "Cancel" y devuelve la elección del usuario. |
| [OKCancelAsynchronous](../WDLang1/1000025308.md) | Muestra un mensaje en un cuadro de diálogo estándar no bloqueante que propone las respuestas "OK" y "Cancelar" y llama a un procedimiento WLanguage con la respuesta del usuario. |
| [OpenMobileWindow](../WDLang1/1000021018.md) | Abre una ventana en una aplicación móvil. |
| [ShellExecute](../WDLang1/3035007.md) | Abre un Document en su aplicación associated. |
| [SMSRunApp](../WDLang3/1000020864.md) | Inicia la aplicación nativa de envío de SMS que se encuentra en el dispositivo (Android o iPhone/iPad). |
| [SpeechRecognitionTrigger](../WDLang1/1000020013.md) | Activa el servicio de reconocimiento de voz del dispositivo. |
| [SpeechSynthesisInitialize](../WDLang3/1000020171.md) | Inicializa los parámetros de síntesis de voz para la aplicación actual. |
| [SpeechSynthesisReadFile](../WDLang3/1000020172.md) | Lee el contenido del archivo especificado utilizando el motor de síntesis de voz que se encuentra en el dispositivo. |
| [SpeechSynthesisReadText](../WDLang3/1000019805.md) | Lee el texto especificado utilizando el motor de texto a voz del dispositivo. |
| [StartShare](../WDLang1/1000020620.md) | Abre una ventana emergente que permite seleccionar la aplicación que se utilizará para compartir una Resource (texto o Document). |
| [SysBatteryOptimBackground](../WDLang1/1000026008.md) | Se utiliza para gestionar la optimización de la batería: <br><br>- Identifica el modo de optimización de la batería para la aplicación actual. <br><br>- Indica al usuario que deshabilite la optimización de la batería para una aplicación determinada en el dispositivo.<br><br><br>Esta función puede utilizarse para indicar al sistema operativo que deje de impedir que la aplicación se ejecute en la Background. |
| [tapiDialerCall](../WDLang3/1000019235.md) | Abre la aplicación de telefonía por defecto (marcador) que se encuentra en la Phone y marca el número especificado. |
| [tapiDialerDisplay](../WDLang3/1000019236.md) | Abre la aplicación de telefonía Default (marcador) y muestra el número especificado. No se realiza ninguna llamada. |
| [TimePicker](../WDLang1/1000020019.md) | Abre el selector de hora del sistema. |
| [URISelect](../WDLang3/1000024026.md) | Abre una ventana del sistema para seleccionar una Resource de: <br><br>- desde el sistema de archivos de dispositivos, <br><br>- desde la nube (Google Drive, Microsoft OneDrive, etc.) <br><br>- o desde uno de los gestores de contenidos instalados en el dispositivo.<br><br><br> |
| [VideoStartApp](../WDLang1/1000019368.md) | Inicia la aplicación de la cámara nativa del dispositivo para Record un video o para tomar una foto. |
| [Warning](../WDLang1/3021009.md) | Muestra un mensaje personalizado en una ventana de advertencia del sistema. |
| [WarningAsynchronous](../WDLang1/1000025270.md) | Muestra un mensaje personalizado en una ventana de advertencia del sistema no bloqueante. |
| [YesNo](../WDLang1/3021005.md) | Muestra un mensaje en un cuadro de diálogo estándar que propone la opciones "Sí" y "No", y devuelve la respuesta del usuario. |
| [YesNoAsynchronous](../WDLang1/1000025272.md) | Muestra un mensaje en un cuadro de diálogo estándar no bloqueante con las respuestas "Sí" y "No" y llama a un procedimiento WLanguage con la respuesta del usuario. |






