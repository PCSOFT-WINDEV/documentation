


## &lt;gglConnection Variable&gt;.Conectar (Función)



<a name="XUse"></a>
<a name="Use"></a>
<a name="description"></a>
Gestiona la autenticación en un servidor de Google (mediante el modo de autenticación "OAuth 2.0"). Esta función se ejecuta automáticamente cuando se ejecuta una función Gglxxx. 

**Observaciones**: 

- Le recomendamos utilizar la función **&lt;gglConnection Variable&gt;.Conectar** (sintaxis 2) para agrupar las solicitudes de autorización realizadas por Google. 

- La desconexión se realiza automáticamente al cerrar la aplicación. 



<a name="Example1"></a>
<a name="sample_code"></a>

## Ejemplo


```wl
// Connection by using the "OAuth 2.0" authentication mode
Cnt is gglConnection
Cnt.Email = "email_final_user@gmail.com"
Cnt.ClientID = "387756281032-qffa6dajjd5348iqhi558dkd98xxxxxx.apps.googleusercontent.com" 
Cnt.ClientSecret = "S13DCA6KkYh1EgPv9-jLxxxh" 
// During the connection, the user will have to validate the services used
// (For more details, see the additional examples)
IF Cnt.Connect() =False THEN
	Error(ErrorInfo())
END
```

<a name="XSYNTAX"></a>
<a name="SYNTAX1"></a>

## Sintaxis

### Conectando con la autenticación básica

`<Result> = <Google connection>.Connect()`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True</u></u></u></u> si se realizó la autenticación,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. Para obtener más información sobre el error, utilice la función [ErrorInfo](../WDLang1/3013008.md).




**`<Google connection>: (Variable de tipo gglConnection)`**

Nombre de la variable de tipo [gglConnection](../WDLang5/1000018009.md) que se utilizará.


<a name="SYNTAX2"></a>

### Conectarse especificando los servicios utilizados

`<Result> = <Google connection>.Connect(<Google service>)`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True</u></u></u></u> si se realizó la autenticación,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. Para obtener más información sobre el error, utilice la función [ErrorInfo](../WDLang1/3013008.md).




**`<Google connection>: (Variable de tipo gglConnection)`**

Nombre de la variable de tipo [gglConnection](../WDLang5/1000018009.md) a manipular.

**`<Google service>: (Constante o combinación de constantes de tipo Integer)`**

Servicio de Google para habilitar (la aplicación debe acceder a estos servicios): 


|   |   |
| --- | --- |
| *gglServiceCalendar* | "Servicio"Google Calendar: Google Calendar |
| *gglServiceContacts* | "Servicio"Contactos de Google: Gestión de contactos de Google |
| *gglServiceDocuments* | "Servicio"Lista de documentos de Google: Gestión de documentos |
| *gglServicePicasa* | "Picasa" service |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Observaciones


### Posibles casos de error: 
<a name="posibles_casos_error_ELTPARAGRAPHE000260"></a>

- La conexión de INTERNET no es válida.

- La autenticación no se realizó correctamente.



<a name="NOTE0_2"></a>


### Requisitos previos para la autenticación OAuth 2.0
<a name="requisitos_previos_para_autenticacion_oauth_20_ELTPARAGRAPHE000275"></a>

Para conectarse con la autenticación OAuth 2.0, la aplicación debe estar declarada en la consola del desarrollador de Google.: [https://developers.google.com/console](https://developers.google.com/console). 
En la consola: 

1. Haga clic en "Crear un proyecto".. Indique el nombre de su proyecto. Se propone automáticamente un identificador para su proyecto. 

2. Validar

3. El proyecto se crea. 

4. En el menú de la izquierda, haga clic en "API and authentication" y luego en "API".. 

5. Seleccione los servicios requeridos por la aplicación: 

	- Para acceder a los Calendar s, elija "Calendar API" (categoría "Google Apps API s"). 

	- Para acceder a los contactos, seleccione "Contactos API" (categoría "Google Apps API s").. 

	- Para acceder a los documentos de Google, seleccione "Drive API" (categoría "Google Apps API s").. 

	- Para acceder a los álbumes de Picasa y a los documentos, no es necesario seleccionar un API específico.. 




6. En el menú de la izquierda, haga clic en "Identificadores".. 

7. A continuación, haga clic en el botón "Crear un identificador de cliente. 

	- Seleccione el tipo de aplicación: "Aplicación instalada".

	- La pantalla de autorización debe configurarse durante la primera creación del identificador de cliente..   

	- En la pantalla de autorización, en el área "Nombre del producto", introduzca el nombre de su solicitud, por ejemplo. 

	- Haga clic en "Guardar". 

	- Se vuelve a visualizar la pantalla para crear el identificador de cliente.. 

		- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) En el caso de las aplicaciones WINDEV, seleccione "Aplicación instalada" y luego "Otros".




- Validar. Se crean los identificadores de cliente: 

	- Identificación del cliente. Este identificador debe almacenarse. Se utilizará en la [gglConnection](../WDLang5/1000018009.md) Variable. 

	- Código secreto del cliente. Este identificador debe almacenarse. Se utilizará en la [gglConnection](../WDLang5/1000018009.md) Variable. 

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Redirección URI. Compruebe si se especifica "http://localhost".. 



<a name="NOTE0_3"></a>


### Autenticación OAuth 2.0
<a name="autenticacion_oauth_20_ELTPARAGRAPHE000354"></a>

La llamada a **&lt;gglConnection Variable&gt;.Conectar** desencadena: 

1. La apertura de una ventana de inicio de sesión para el usuario final. Si se especifica el **Email** Property del [gglConnection](../WDLang5/1000018009.md) Variable, Google rellena previamente la ventana de conexión con el correo electrónico especificado Address. La ventana de inicio de sesión no se muestra si el usuario ya está conectado.. 

2. La apertura de la ventana de autorización. El usuario final debe permitir que la aplicación acceda a su cuenta. Esta ventana se cierra automáticamente cuando el usuario acepta o cancela. 




Observaciones:

- Si se utiliza la sintaxis 1 (conexión con la autenticación básica), se mostrará una ventana de autorización cada vez que se intente acceder a un nuevo servicio.. 

- Si se utiliza la sintaxis 2 (conexión especificando los servicios utilizados), se mostrará una ventana de autorización para todos los servicios solicitados al principio de la aplicación.. 

- La ventana de autorización se puede visualizar durante el primer inicio de la aplicación si se gestiona la persistencia de la conexión (véase el párrafo siguiente).. 





<a name="NOTE0_4"></a>


### Persistencia de la conexión
<a name="persistencia_conexion_ELTPARAGRAPHE000399"></a>

Al conectarse a los servicios de Google, los tokens de autenticación no se guardan. Por lo tanto, es necesario volver a conectarse y permitir el acceso a la aplicación cada vez que se ejecute (es decir, cada vez que se utilice un [gglConnection](../WDLang5/1000018009.md) Variable "en blanco"). 

Para que la autorización de acceso sea persistente, todo lo que tiene que hacer es llamar a las funciones de serialización de WLanguage. 

Ejemplo de implementación de la persistencia utilizando un archivo XML: 

```wl
let sAuthPersistenceFile = SysDir(srLocalAppData) + [fSep] + "gglauth.xml"

cnt is gglConnection 
// If connection already established
IF fFileExist(sAuthPersistenceFile) THEN 
	// Restore the connection 
	let bufDeserialize = fLoadBuffer(sAuthPersistenceFile) 
	Deserialize(cnt, bufDeserialize, psdXML) 
ELSE 
	// New connection 
	cnt.Email = "email@gmail.com" 
	cnt.ClientID = "387756281032-qffa6dajjd5348iqhi558xxxxxxxx.apps.googleusercontent.com" 
	cnt.ClientSecret = "Sxxxxx-jLMwwh" 
END 

IF cnt.Connect(gglServiceCalendar) THEN 
	// Save the connection in order to re-use it later 
	bufSerialize is Buffer 
	Serialize(cnt, bufSerialize, psdXML) 
	fSaveBuffer(sAuthPersistenceFile, bufSerialize) 
END
```

Observación: Los tokens de autentificación de un **gglConnection** Variable pueden ser borrados a través de [&lt;gglConnection Variable&gt;.Desconectar](../WDLang5/1000021459.md). 

<a name="XComponent"></a>

## Componente:
wd280ggl.dll
