
## HSynchronizeReplica( Función)



<a name="XUse"></a>
<a name="Use"></a>
<a name="description"></a>
Sincroniza la réplica maestra y la réplica del suscriptor.: las operaciones realizadas en una de las réplicas se transfieren a la otra réplica.

**Tsu función puede ser usada en una replicación basada en log (entre archivos de datos HFSQL) o una replicación universal.**

**Observaciones**:

- En el caso de una replicación basada en un registro, sólo se tendrán en cuenta los archivos de datos del análisis con la opción "Gestionar la replicación de este archivo" marcada.

- ![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png) Sólo la replicación universal funciona con los archivos de datos de HFSQL Client/Server.

- ![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/us/UNIVERSALAPP.png) Solo está disponible la replicación universal. 





	<B><B><B>Advertencia</B></B></B>

	A partir de la versión <B><B><B>17</B></B></B>, los archivos de replicación creados con una aplicación o un sitio en la versión 17 (o posterior) no pueden ser gestionados por una aplicación o un sitio en la versión 16 (o anterior).
Las aplicaciones o los sitios en la versión 17 (o posterior) continúan a manipular los ficheros de replicación creados con una aplicación o un sitio en la versión 16 (o anterior). 








<a name="Example1"></a>
<a name="sample_code"></a>

## Ejemplo
<a class="notetitle" target="_blank" href="$DOC$=1000003044014&name=hsynchronizereplica_funcion&product=WD">Ver ejemplos adicionales</a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/us/HF55.png) 
```wl
// "Entering Orders" application for salesmen
// "[Enter the orders in the database]" button
// (the database is found on "X:\CORPDATA")
HSynchronizeReplica("X:\CORPDATA", "C:\SUBSCRIBER", rplToMaster)
```
<a name="Example2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/us/HF55.png) 
```wl
// "Catalog" application for salesmen
// "[Retrieve the new references]" button
// (the database is found on "X:\CORPDATA")
HSynchronizeReplica("X:\CORPDATA", "", rplToSubscriber)
```
<a name="Example3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/us/HF55.png) 
```wl
// In Montpellier: Prepare to send messages to Paris
HCreateMovableReplica("P:\MSG\MSG.RPM", "Paris", "C:\Temp\MsgMPL.WDZ")
// Send the file (by FTP for example)
FTPSend(ConnectionNum, "c:\temp\MsgMPL.WDZ", ...
			"FTP.PCSOFT_PARIS.FR\MSG\MsgMPL.WDZ") 
----------------
// In Paris: Retrieve the messages from Montpellier
HSynchronizeReplica("Z:\MSG", "\\FTPSERVER\MSG\MsgMPL.WDZ", rplToMaster)
```

<a name="XSYNTAX"></a>
<a name="SYNTAX1"></a>

## Sintaxis

### Sincronización con la gestión de conflictos de automatic

`<Result> = HSynchronizeReplica(<Master replica> , <Subscriber replica> , <Replication direction> [, <Management of conflicts>])`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True</u></u></u></u> si la operación fue exitosa,

- <u><u><u><u>False</u></u></u></u> en caso contrario.




**`<Master replica>: (Cadena de caracteres)`**

Ubicación de la réplica maestra. Dependiendo del tipo de replicación y de la dirección, este parámetro puede corresponder a:

- la ruta del archivo de replicación (archivo xxxx.RPM) para la base de datos maestra.

- el nombre del archivo móvil creado por [HCreateMoveableReplica](../WDLang4/3044209.md). 

- una cadena vacía ("""). Los ficheros de datos actuales se consideran la base de datos maestra. El archivo correspondiente a la réplica maestra (.RPM) se busca en el directorio de replicación especificado en el análisis (subdirectorio RPL de archivos de datos por Default), o en el directorio especificado con [HChangeRplDir](../WDLang4/3044236.md).




En la mayoría de los casos, esta ruta corresponde o bien a la ruta completa de un fichero situado en un directorio de red, o bien a la ruta de una réplica móvil (llave USB, anexo Email, fichero recuperado por FTP).
Para obtener más información, consulte [los comentarios](#NOTE0_1).

**`<Subscriber replica>: (Cadena de caracteres)`**

Ubicación de la réplica del abonado. Dependiendo del tipo de replicación y de la dirección, este parámetro puede corresponder a:

- el ruta del archivo de replicación (archivo xxxx.RPL) para la base de datos de suscriptores.

- el nombre del archivo móvil creado por [HCreateMoveableReplica](../WDLang4/3044209.md)

- una cadena vacía ("""). Los archivos de datos actuales se consideran como la base de datos de suscriptores.. El archivo correspondiente a la réplica del suscriptor (.RPL) se busca en el directorio de replicación especificado en el análisis (subdirectorio RPL de los archivos de datos por Default), o en el directorio especificado por [HChangeRplDir](../WDLang4/3044236.md).




En la mayoría de los casos, esta ruta corresponde o bien a la ruta completa de un fichero situado en un directorio de red, o bien a la ruta de una réplica móvil (llave USB, anexo Email, fichero recuperado por FTP).
Para obtener más información, consulte [los comentarios](#NOTE0_1).

**`<Replication direction>: (Constante de tipo Integer)`**

Dirección en la que se realizará la replicación:


|   |   |
| --- | --- |
| *rplBidirectional* | Actualizar la base de datos maestra Y la base de datos de suscriptores.<br><br>**Replicación universal**: la replicación bidireccional no está disponible. |
| *rplToMaster* | Actualizar la base de datos maestra según la base de datos de suscriptores.<br><br>&lt;Réplica maestra&gt; corresponde a la réplica maestra, &lt;Réplica de suscriptor&gt; corresponde a la réplica móvil creada a partir de la base de datos de suscriptores. |
| *rplToSubscriber* | Actualizar la base de datos de suscriptores según la base de datos maestra.<br><br>&lt;La réplica maestra corresponde a la réplica móvil creada a partir de la base de datos maestra, la réplica de suscriptor corresponde a la réplica de suscriptor. |



**`<Management of conflicts>: (Constante opcional de tipo Integer)`**

Constante que indica el modo de gestión de los conflictos:


|   |   |
| --- | --- |
| *rplMasterFirst*<br>(Valor predeterminado) | Los datos encontrados en la base de datos maestra tienen prioridad durante la reproducción. |
| *rplMostRecentFirst* | Los datos más recientes tienen prioridad. Atención, los datos más recientes se evalúan en función de la hora de la réplica del abonado. |
| *rplSubscriberFirst* | Los datos encontrados en la base de datos de suscriptores tienen prioridad durante la reproducción. |





**Atención: Por Default, el maestro tiene como prioridad**: al realizar una reproducción de suscriptor a maestro, los datos maestros no se actualizarán. Le recomendamos que utilice otra constante (*rplMostRecentFirst* por ejemplo).


<a name="SYNTAX2"></a>

### Sincronización con la gestión de conflictos personalizada (WLanguage Procedure)

`<Result> = HSynchronizeReplica(<Master replica> , <Subscriber replica> , <Replication direction> [, <Filter procedure>])`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True</u></u></u></u> si la operación fue exitosa,

- <u><u><u><u>False</u></u></u></u> en caso contrario.




**`<Master replica>: (Cadena de caracteres)`**

Ubicación de la réplica maestra. Dependiendo del tipo de replicación y de la dirección, este parámetro puede corresponder a:

- el ruta del archivo de replicación (archivo xxxx.RPM) para la base de datos maestra.

- el nombre del archivo móvil creado por [HCreateMoveableReplica](../WDLang4/3044209.md).

- una cadena vacía ("""). Los ficheros de datos actuales se consideran como la base de datos maestra.. El archivo correspondiente a la réplica maestra (.RPM) se busca en el directorio de replicación especificado en el análisis (subdirectorio RPL de archivos de datos por Default), o en el directorio especificado con [HChangeRplDir](../WDLang4/3044236.md).




En la mayoría de los casos, esta ruta corresponde a la ruta completa de un fichero situado en un directorio de red o a la ruta de una réplica móvil (llave USB, anexo Email, fichero recuperado por FTP).
Para más detalles, consulte las observaciones.

**`<Subscriber replica>: (Cadena de caracteres)`**

Ubicación de la réplica del abonado. Dependiendo del tipo de replicación y de la dirección, este parámetro puede corresponder a:

- el ruta del archivo de replicación (archivo xxxx.RPL) para la base de datos de suscriptores.

- el nombre del archivo móvil creado por [HCreateMoveableReplica](../WDLang4/3044209.md)

- una cadena vacía ("""). Los archivos de datos actuales se consideran como la base de datos de suscriptores.. El archivo correspondiente a la réplica del suscriptor (.RPL) se busca en el directorio de replicación especificado en el análisis (subdirectorio RPL de los archivos de datos por Default), o en el directorio especificado por [HChangeRplDir](../WDLang4/3044236.md).




En la mayoría de los casos, esta ruta corresponde a la ruta completa de un fichero situado en un directorio de red o a la ruta de una réplica móvil (llave USB, anexo Email, fichero recuperado por FTP).
Para obtener más información, consulte [los comentarios](#NOTE0_1).

**`<Replication direction>: (Constante de tipo Integer)`**

Dirección en la que se realizará la replicación:


|   |   |
| --- | --- |
| *rplBidirectional* | Actualizar la base de datos maestra Y la base de datos de suscriptores.<br><br>**Replicación universal**: la replicación bidireccional no está disponible. |
| *rplToMaster* | Actualizar la base de datos maestra según la base de datos de suscriptores.<br><br>&lt;La réplica maestra corresponde a la réplica móvil creada a partir de la base de datos maestra, la réplica de suscriptor corresponde a la réplica de suscriptor. |
| *rplToSubscriber* | Actualizar la base de datos de suscriptores según la base de datos maestra.<br><br>&lt;Réplica maestra&gt; corresponde a la réplica maestra, &lt;Réplica de suscriptor&gt; corresponde a la réplica móvil creada a partir de la base de datos de suscriptores. |



**`<Filter procedure>: (Nombre de procedimiento opcional)`**

Nombre de un WLanguage Procedure que se encuentra en el proyecto WINDEV o WEBDEV (este nombre debe ser incluido entre comillas). Esta Procedure debe ser creada en su aplicación. Este Procedure no espera ningún parámetro. 
Este procedimiento se llama antes de cada operación realizada en el archivo de destino. Varias variables pueden ser usadas en este Procedure. 
Si este procedimiento devuelve <u><u><u><u>False</u></u></u></u>, la operación no se realiza. Este Procedure está acostumbrado:

- filtrar los registros que no deben ser replicados.

- gestionar los conflictos, ajustando los valores antes de que se produzca un error duplicado.




Para más detalles, véase el ejemplo de **HSynchronizeReplica**.



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Observaciones
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/us/HF55.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### ¿Qué archivos de datos se pueden replicar?
<a name="¿que_archivos_datos_pueden_replicar_ELTPARAGRAPHE000270"></a>

Se puede realizar la sincronización:

- entre dos bases de datos relacionado por red.

- entre una base de datos y una réplica móvil (creada por [HCreateMoveableReplica](../WDLang4/3044209.md)).




No se puede realizar ninguna réplica hacia una réplica móvil. Debe crear una réplica móvil con la base de datos y replicar desde la base de datos remota.

**Atención**: **Si realiza una actualización de automatic de sus archivos de datos**, todas las réplicas deben estar sincronizadas antes de esta operación. De lo contrario, todas las modificaciones realizadas desde la última sincronización y la modificación de automatic se perderán.
<a name="NOTE0_2"></a>


### Parámetros de sincronización
<a name="parametros_sincronizacion_ELTPARAGRAPHE000287"></a>

El tabla a continuación presenta las diferentes combinaciones de parámetros que deben utilizarse según el tipo y la dirección de la replicación:

| Dirección de replicación | &lt;Réplica del Maestro | &lt;Réplica de suscriptor | Dirección de repetición&gt; &lt;Dirección de repetición |
| --- | --- | --- | --- |
| **Replicación de maestro a suscriptor**<br>Esta replicación se realiza en el ordenador del abonado | Nombre de la réplica móvil (\*.RPA) creada a partir del maestro, con su eventual ruta | Nombre de la réplica del suscriptor (\*.RPL), con su eventual ruta. | *rplToSubscriber* |
| **Replicación de suscriptor a maestro**<br>Esta replicación se realiza en el equipo maestro | Nombre de la réplica maestra (\*.RPM), con su eventual ruta. | Nombre de la réplica móvil (\*.RPA) creada a partir del suscriptor, con su eventual ruta. | *rplToMaster* |


<a name="NOTE0_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/us/HF55.png) 

### Bloqueo de registros durante la replicación basada en el registro
<a name="bloqueo_registros_durante_replicacion_basada_registro_ELTPARAGRAPHE000325"></a>

Durante la replicación, el archivo JournalOpération.Fic se bloquea: no puede escribir, modificar o guardar registros en los archivos con registros en la base de datos de destino.
<a name="NOTE0_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/us/HF55.png) 

### Errores duplicados y/o errores de integridad
<a name="errores_duplicados_errores_integridad_ELTPARAGRAPHE000334"></a>

Si se produce un error de duplicación o de integridad, se activa la [mecanismo estándar para la gestión de errores de automatic](../WDLang4/3044188.md). Si el motor HFSQL devuelve un error, la replicación se interrumpe: sólo se reproduce una parte de los datos.

Replicación universal: Si se produce un error de integridad durante la replicación, esta continúa, pero la función devuelve <u><u><u><u>False</u></u></u></u>.

Para obtener los detalles de los errores, debe leer los sub-errores HFSQL con [HError](../WDLang4/3044088.md) (con las constantes *hSubErrFirst* y *hSubErrNext*) y luego llamar a [HErrorInfo](../WDLang4/3044071.md).
<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/us/HF55.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Las variables se inicializan automáticamente en el WLanguage Procedure
<a name="las_variables_inicializan_automaticamente_wlanguage_procedure_ELTPARAGRAPHE000360"></a>

| Variable | escribir a máquina | description y el valor |
| --- | --- | --- |
| Archivo RPL.file | Cadena de caracteres | Nombre del archivo cuyos datos se replicarán |
| Operación RPL | Constante de tipo Integer | Operación HFSQL que será replicada:<br><br>- **rplHAdd**: replicar una adición<br><br>- **rplHModify**: replicar una modificación<br><br>- **rplHDelete**: replicar una supresión<br><br><br> |
| Conflicto RPL | Constante de tipo Integer | Indica si se ha detectado un conflicto durante la replicación.. Los valores posibles son los siguientes:<br><br>- **rplNoConflict**: no se detectó ningún conflicto<br><br>- **rplModifyConflict**: El Record fue modificado tanto en la réplica de origen como en la de destino<br><br>- **rplDeleteConflict**: La Record fue borrada de la réplica de destino y fue modificada o borrada en la réplica de origen.<br><br><br>Para forzar la replicación si se produce un conflicto, inicialice la variable RPL.Conflict con la variable *rplNoConflict*.<br><br>De lo contrario, la replicación se realizará sólo si el conflicto es un conflicto de modificación y si los datos a replicar provienen de la base de datos maestra. |
| Dirección RPL | Constante de tipo Integer | Indica la dirección de la replicación (useful para una replicación bidireccional):<br><br>- **rplToSubscriber**: replicación de maestro a suscriptor<br><br>- **rplToMaster**: replicación de suscriptor a maestro<br><br><br> |
| Número de operación RPL | Integro | Número de la operación actual. Este valor se incluye entre 1 y RPL.OperationMax. Este Variable le permite manejar fácilmente una barra de progreso. |
| Operación RPLMax | Integro | Número total de operaciones a replicar. Este Variable le permite manejar fácilmente una barra de progreso. |
| RPL.SourceAlias | Cadena de caracteres | Nombre del alias de origen del archivo replicado (RPL.File). Este archivo contiene los valores de los elementos que serán copiados ([HAdd](../WDLang4/3044147.md)) o añadidos ([HModify](../WDLang4/3044042.md)) en el archivo actualmente replicado. |
| RPL.TargetAlias | Cadena de caracteres | Nombre del alias de destino del archivo replicado (RPL.File). Este archivo contiene los valores de los elementos antes de realizar la copy o la eliminación en el archivo actualmente replicado. |


<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![Hyper File 5.5](https://doc.pcsoft.fr/ext/images/us/HF55.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Ejemplo: Replicando los datos incluso si se produce un conflicto (usando un WLanguage Procedure): 
<a name="ejemplo_replicando_los_datos_incluso_produce_conflicto_usando_wlanguage_procedure_ELTPARAGRAPHE000444"></a>

Este ejemplo se utiliza para forzar la replicación de datos incluso si se produce un conflicto de modificación.. Para ello, solo se debe forzar el valor de la variable **RPL.Conflict** con la constante *rplNoConflict*.


```wl
IF RPL.Conflict = rplModifyConflict THEN
	RPL.Conflict = rplNoConflict
	RETURN True
END
```



### Función de replicación y WithSpace
<a name="funcion_replicacion_withspace_ELTPARAGRAPHE000656"></a>

La replicación no es compatible con [WithSpace](../WDLang4/3044142.md) en el código de la aplicación cliente. Esta función cambia el comportamiento de HFSQL. El uso de esta función en la aplicación cliente puede afectar a la eficiencia de la replicación.

A partir de la versión 21 actualización 3 (versión 210065), las funciones de sincronización (replicación universal programada o asistida) devuelven un error a la aplicación cliente si se ha aplicado [WithSpace](../WDLang4/3044142.md) a al menos uno de los archivos replicados. 


### Vida útil de la réplica móvil
<a name="vida_util_replica_movil_ELTPARAGRAPHE000454"></a>

La réplica se destruye al final de la replicación en caso de éxito. La reproducción de la réplica provocará errores (por ejemplo, una adición provoca un error de duplicación). La réplica utiliza el archivo .syn que también se destruye (otro archivo .syn lo sustituye con la información inútilmente borrada). 

Una réplica "móvil" se traslada (copia) entre el maestro y el abonado o entre el abonado y el maestro.. Para almacenar un archivo, basta con almacenar el archivo fuente (el creado por [HCreateMoveableReplica](../WDLang4/3044209.md)). 




### Replicación y filtro
<a name="replicacion_filtro_ELTPARAGRAPHE000465"></a>

Al navegar por los datos a replicar, la replicación tiene en cuenta los filtros colocados por [HFilter](../WDLang4/3044100.md). 

Por lo tanto, para una replicación universal programada sin servidor de replicación, se puede utilizar [HFilter](../WDLang4/3044100.md) para limitar los datos a sincronizar. 

Por el contrario, para una replicación realizada mediante un servidor de replicación, se deben desactivar todos los filtros antes de realizar la replicación con la función **HSynchronizeReplica**. 

Observación: [HClose](../WDLang4/3044073.md) sirve para borrar todos los filtros definidos por [HFilter](../WDLang4/3044100.md) en un archivo de datos.

<a name="XComponent"></a>

## Componente:
wd280rpl.dll
