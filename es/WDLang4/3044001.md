


## HTransactionCancel (Función)



<a name="XUse"></a>
<a name="Use"></a>
<a name="description"></a>
**Si una transacción está en curso**cancela todas las operaciones realizadas en los ficheros de datos de la operación desde el inicio de la operación.. En este caso, la transacción se cancela sin interrumpir la ejecución del programa.

**Si no hay ninguna transacción en curso**restablece la consistencia de la base de datos y cancela la transacción fallida (por ejemplo, un fallo de alimentación).. 
Observación: Una transacción que ha fallado puede ser cancelada por cualquier programa.
El fichero de transacción se destruye automáticamente si no se comparte.. Se desbloquean los registros bloqueados por las operaciones de escritura realizadas durante la transacción.




<a name="Example1"></a>
<a name="sample_code"></a>

## Ejemplo


```wl
MyConnection is Connection

// Start transaction on data files associated with MyConnection
HTransactionStart(MyConnection)
Add_Order()
WHEN EXCEPTION IN
	// Add the order
	HAdd(Orders) 
	// Validate the addition
	HTransactionEnd(MyConnection)
DO
	// Delete the order lines
	HTransactionCancel(MyConnection)
END
```
<a name="Example2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 
```wl
// Start transaction on the Orders and OrdLine data files
HTransactionStart("C:\Temp\Transaction.trs", "Orders, OrderLine, -Customer")
Add_Order()
WHEN EXCEPTION IN
	// Add the order
	HAdd(Orders) 
	// Validate the addition
	HTransactionEnd()
DO
	// Delete the order lines
	HTransactionCancel()
END
```
<a name="Example3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png) 
```wl
// Start transaction on the Orders and OrdLine data files
HTransactionStart("Orders, OrderLine, -Customer")
Add_Order()
WHEN EXCEPTION IN
	// Add the order
	HAdd(Orders)
	// Validate the addition
	HTransactionEnd() 
DO
	// Delete the order lines
	HTransactionCancel() 
END
```

<a name="XSYNTAX"></a>
<a name="SYNTAX1"></a>

## Sintaxis

### Cancelar una transacción en curso o una transacción interrumpida en una conexión Client/Server

`<Result> = HTransactionCancel(<Connection>)`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True STRIMEULB</u></u></u></u> si la transacción fue cancelada,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. [HErrorInfo](../WDLang4/3044071.md) devuelve más detalles sobre el error. 




**Atención**: 

- Si una transacción está en curso en la conexión, se cancela. 

- Si no hay ninguna transacción en curso, las transacciones interrumpidas se cancelan para la conexión especificada.. 




**`<Connection>: (Cadena de caracteres o variable de tipo Connection)`**

Conexión a utilizar. Esta conexión corresponde a: 

- el nombre de la conexión definida en el editor de análisis o con las funciones [HDescribeConnection](../WDLang4/3044205.md) o [HOpenConnection](../WDLang4/3044107.md).

- el nombre de una variable de tipo [Conexión](../WDLang4/1514073.md).


Si este parámetro corresponde a la constante *hAccessHF7*, la transacción se cancelará en los archivos HFSQL Classic (ISAM).


<a name="SYNTAX2"></a>

### Cancelación de una transacción en curso o de una transacción interrumpida en todas las conexiones (HFSQL Classic o Cliente/Servidor)

`<Result> = HTransactionCancel([<Transaction file>])`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True STRIMEULB</u></u></u></u> si la transacción fue cancelada,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. [HErrorInfo](../WDLang4/3044071.md) devuelve más detalles sobre el error. 


**Atención**: 

- ![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) Si no se especifica el parámetro &lt;Archivo de transacción&gt;, la transacción actual se cancela.

- **Si hay una transacción en curso**, se cancelan TODAS las transacciones en curso (transacciones HFSQL Classic y/o transacciones HFSQL Client/Server).

- **Si no hay ninguna transacción en curso**, se cancelan TODAS las transacciones interrumpidas (en HFSQL Classic y en Cliente/Servidor).




**`<Transaction file>: (Cadena de caracteres opcional)`**

![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) Nombre y ruta del archivo de la transacción a Cancel: 

- Este parámetro debe ser idéntico al nombre especificado en [HTransactionStart](../WDLang4/3044002.md) (o en [HTransaction](../WDLang4/1000023384.md)).

- Si no se especifica este parámetro y si no hay ninguna transacción en curso, se tiene en cuenta el archivo de transacción Default. 

- Si una transacción está en curso, se cancela y se ignora el nombre del fichero de transacción.


![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) Este parámetro no se tiene en cuenta.


<a name="SYNTAX3"></a>

### Cancelar una transacción interrumpida en una base de datos Client/Server (se debe utilizar si no hay ninguna transacción en curso)

`<Result> = HTransactionCancel(<Connection> , <Database>)`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True STRIMEULB</u></u></u></u> si la transacción fue cancelada,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. [HErrorInfo](../WDLang4/3044071.md) devuelve más detalles sobre el error.


**Atención**: 

- Sólo se cancelan las transacciones interrumpidas en la base de datos especificada.

- Las transacciones en curso no se cancelan. 




**`<Connection>: (Cadena de caracteres o variable de tipo Connection)`**

Conexión a utilizar. Esta conexión corresponde a: 

- el nombre de la conexión definida en el editor de análisis o con las funciones [HDescribeConnection](../WDLang4/3044205.md) o [HOpenConnection](../WDLang4/3044107.md).

- el nombre de una variable de tipo [Conexión](../WDLang4/1514073.md).


Si este parámetro corresponde a la constante *hAccessHF7*, sólo se cancelarán las transacciones interrumpidas en modo HFSQL Classic.

**`<Database>: (Cadena de caracteres)`**

Nombre de la base de datos correspondiente. Se produce un error si este parámetro corresponde a una cadena vacía (""").


<a name="SYNTAX4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 
### Cancelar una transacción (se utilizará si no hay ninguna transacción en curso)

`<Result> = HTransactionCancel(<Transaction file> , <Connection>)`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True STRIMEULB</u></u></u></u> si la transacción fue cancelada,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. [HErrorInfo](../WDLang4/3044071.md) devuelve más detalles sobre el error. 




**Atención**: 

- Si no se especifica el parámetro &lt;Archivo de transacción&gt;, la transacción actual se cancela.

- Si hay una operación "general" en curso, se cancelan TODAS las operaciones en curso (operaciones HFSQL Classic y/o operaciones HFSQL Client/Server).

- Si una transacción está en curso en la conexión, se cancela. 

- Si no hay ninguna transacción en curso, sólo se cancelan las transacciones interrumpidas para la conexión especificada.




**`<Transaction file>: (Cadena de caracteres)`**

Nombre y ruta del archivo de la transacción a Cancel. 
Este parámetro debe ser idéntico al nombre especificado en [HTransactionStart](../WDLang4/3044002.md) (o en [HTransaction](../WDLang4/1000023384.md)).

**`<Connection>: (Cadena de caracteres o variable de tipo Connection)`**

Conexión a utilizar. Esta conexión corresponde a: 

- el nombre de la conexión definida en el editor de análisis o con las funciones [HDescribeConnection](../WDLang4/3044205.md) o [HOpenConnection](../WDLang4/3044107.md).

- el nombre de una variable de tipo [Conexión](../WDLang4/1514073.md).


Si este parámetro corresponde a la constante *hAccessHF7*, sólo se cancelarán las transacciones interrumpidas en modo HFSQL Classic.


<a name="SYNTAX5"></a>

### Cancelar una transacción específica, relacionada con una conexión

`<Result> = HTransactionCancel(<Connection> , <Transaction to cancel>)`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True STRIMEULB</u></u></u></u> si la transacción fue cancelada,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. [HErrorInfo](../WDLang4/3044071.md) devuelve más detalles sobre el error.


Atención: Sólo se cancelan las transacciones interrumpidas en la base de datos especificada.

**`<Connection>: (Cadena de caracteres o variable de tipo Connection)`**

Conexión a utilizar. Esta conexión corresponde a: 

- el nombre de la conexión definida en el editor de análisis o con las funciones [HDescribeConnection](../WDLang4/3044205.md) o [HOpenConnection](../WDLang4/3044107.md).

- el nombre de una variable de tipo [Conexión](../WDLang4/1514073.md).


Si este parámetro corresponde a la constante *hAccessHF7*, sólo se cancelará la operación interrumpida en modo HFSQL Classic.

**`<Transaction to cancel>: (Integro)`**

Identificador de la transacción que se cancelará para la conexión especificada. Este identificador es devuelto por [HTransactionList](../WDLang4/3044351.md).  



<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Observaciones


### Ubicación y acceso a los archivos de datos
<a name="ubicacion_acceso_los_archivos_datos_ELTPARAGRAPHE000362"></a>

Antes de llamar a la función **HTransactionCancel**, los archivos de datos manipulados por la transacción cancelada deben ser:

- localizados ([HSubstDir](../WDLang4/3044028.md), [HChangeName](../WDLang4/3044141.md), etc.).

- accesible ( [HPass](../WDLang4/3044108.md) , etc.).



<a name="NOTE0_2"></a>


### Detección de un error
<a name="deteccion_error_ELTPARAGRAPHE000385"></a>

Cuando el programa detecta un error (gestión de errores con WHILE EXCEPTION, por ejemplo), la función **HTransactionCancel** permite:

- restaurar los archivos de datos en su estado inicial.

- cancel todas las operaciones realizadas en los archivos de datos desde la llamada a [HTransactionStart](../WDLang4/3044002.md) (o [HTransaction](../WDLang4/1000023384.md)).



<a name="NOTE0_3"></a>


### Consejo: Restaurar la consistencia de la base de datos
<a name="consejo_restaurar_consistencia_base_datos_ELTPARAGRAPHE000405"></a>

Si se produce una avería (corte de corriente, reinicio,...) durante una transacción, los archivos de datos pueden dañarse.: la transacción no fue ni validada ni cancelada. El archivo de la transacción se encuentra todavía en el equipo.

Para restaurar la consistencia de la base de datos, debe proponer en su aplicación:

- una opción utilizada para mantener la consistencia de la base de datos. 
	Esta opción puede, por ejemplo, llamar a la función **HTransactionCancel** o a las funciones [HTransactionStart](../WDLang4/3044002.md)/[HTransactionEnd](../WDLang4/3044032.md).

- gestión del error 70034 en el código de inicialización del proyecto mediante la palabra clave WHEN EXCEPTION.
	Así, cuando se produzca el error 70034, la coherencia de la base de datos se restaurará mediante la función **HTransactionCancel**, o [HTransactionStart](../WDLang4/3044002.md)/[HTransactionEnd](../WDLang4/3044032.md).




**Observación**: esta operación puede ser bastante larga (según el número de operaciones realizadas en la transacción).
<a name="NOTE0_4"></a>


### Casos de error
<a name="casos_error_ELTPARAGRAPHE000441"></a>

- Operaciones de anidamiento: Las transacciones no se pueden anidar (es decir, no se puede llamar a [HTransactionStart](../WDLang4/3044002.md) o [HTransaction](../WDLang4/1000023384.md) en una transacción). En este caso, se produce el error 70031.

- Se muestra un error fatal en los siguientes casos: 

	- Se inicia una transacción en todas las conexiones mientras haya al menos una conexión en la transacción.. 

	- Se inicia una operación en una conexión mientras que ya se ha iniciado una operación en todas las conexiones.. 

	- Se inicia una transacción en todas las conexiones mientras haya al menos una conexión cuyo modo de aislamiento no sea "Lectura no comprometida".






<a name="NOTE0_5"></a>


### Transacciones y contexto HFSQL independiente
<a name="transacciones_contexto_hfsql_independiente_ELTPARAGRAPHE000463"></a>

Al copiar un contexto, si una transacción está en curso en el primer contexto, el nuevo contexto no está en la transacción.. Debe llamar a [HTransactionStart](../WDLang4/3044002.md) (o [HTransaction](../WDLang4/1000023384.md)) para iniciar una transacción en el nuevo contexto.
<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### OLE DB y Conectores Nativos
<a name="ole_conectores_nativos_ELTPARAGRAPHE000474"></a>

Sólo las sintaxis con conexión son tenidas en cuenta por la Conectores Nativos que soporta las transacciones. También se puede utilizar la función [SQLTransaction](../WDLang4/3072029.md).

<a name="XComponent"></a>

## Componente:
wd280hf.dll
