


## Replicación universal asistida mediante programación
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000310"></a>
La replicación asistida a través de la programación se utiliza para implementar una replicación en una aplicación existente mientras se controla la sincronización en la propia aplicación. El usuario inicia la sincronización directamente a través de la aplicación, sin utilizar ninguna aplicación externa.

La replicación asistida mediante programación permite utilizar todos los modos de replicación disponibles:

- réplica directa, <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=replication_directe_prog.gif)


- replicación por servidor con réplica inmediata o periódica. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=replication_serveur_prog.gif)







<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Base de datos HFSQL Classic: Implementar una replicación mediante programación
<a name="base_datos_hfsql_classic_implementar_una_replicacion_mediante_programacion_ELTTEXTE000340"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 

### Etapa 1: Programar el acceso a los archivos HFSQL Classic localmente
<a name="etapa_1_programar_acceso_los_archivos_hfsql_classic_localmente_ELTPARAGRAPHE000029"></a>

Si una aplicación utiliza la replicación universal asistida, accede a una base de datos local que sólo contiene los datos necesarios.. La base de datos principal (base de datos maestra) sólo se utiliza durante la sincronización.

Por lo tanto, la aplicación debe ser modificada para poder acceder a los archivos de datos locales.. Debes programar:

- la creación (si es necesario) de los archivos locales.

- el acceso a estos archivos locales (con [HChangeDir](../WDLang4/3044168.md), [HSubstDir](../WDLang4/3044028.md), [HChangeName](../WDLang4/3044141.md), ...).



<a name="NOTE3_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 

### Etapa 2: Descripción de la réplica
<a name="etapa_2_descripcion_replica_ELTPARAGRAPHE000052"></a>

La description de la réplica se realiza en un archivo ".WER" creado por ReplicEdit. ReplicEdit está acostumbrado a:

- definir los ficheros tenidos en cuenta por la replicación, los filtros tenidos en cuenta a la hora de actualizar los datos. Para obtener más información, consulte [Creación de una réplica con ReplicEdit](../ReplicEdit/3526501.md).

- configurar la ubicación de los archivos maestros (pestaña "General" en la ventana description de los archivos en ReplicEdit). Para obtener más información, consulte [Opciones de replicación definidas en ReplicEdit](../ReplicEdit/3526502.md).



<a name="NOTE3_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 

### Etapa 3: Programación de la réplica
<a name="etapa_3_programacion_replica_ELTPARAGRAPHE000070"></a>

La base de datos local se inicializa cuando se realiza la primera sincronización entre la aplicación y la base de datos maestra.. La base de datos maestra se encuentra en el archivo WER generado por ReplicEdit.

**Para una replicación directa asistida:** Ejemplo de código que se puede utilizar:


```wl
// Initializes the replication by passing the zip code to take into account
IF ReplicInfo("MyReplication", replicInitialized) = False THEN
	ReplicInitialize("MyReplication", 47012)
END

// Starts the synchronization
ReplicSynchronize("MyReplication")
```


La base de datos local debe ser inicializada una sola vez por [ReplicInitialize](../WDLang4/1000017195.md).

Entonces, se requiere una única sincronización de datos ([ReplicSynchronize](../WDLang4/1000017196.md))

**Para una replicación asistida con servidor de replicación**: Si se realiza una replicación asistida con servidor de replicación, se debe llamar a [ReplicOpen](../WDLang4/1000017194.md) antes de [ReplicInitialize](../WDLang4/1000017195.md) para especificar los parámetros del servidor de replicación. Ejemplo:


```wl
// Starts the replication on the replication server
ReplicOpen("MyReplication", "", "ReplicationServer", "Flora", "password")

// Initializes the replication by passing the zip code to take into account
IF ReplicInfo("MyReplication", replicInitialized) = False THEN
	ReplicInitialize("MyReplication", 47012)
END

// Starts the synchronization
ReplicSynchronize("MyReplication")
```

<a name="NOTE3_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png) 

### Etapa 4: Implementación de la aplicación
<a name="etapa_4_implementacion_aplicacion_ELTPARAGRAPHE000103"></a>

El programa instalación está preparado como para cualquier aplicación estándar.

**Importante**: Al crear el programa instalación, no pida instalar la replicación asistida (desmarque "Instalar y configurar los módulos para la replicación universal asistida").
Recordatorio: Para crear el programa de instalación, en la pestaña "Proyecto", en el grupo "Generación", despliegue "Procedimiento de instalación" y seleccione "Crear procedimiento de instalación".

**Replicación asistida directa (sin servidor de replicación)**: El archivo.WER debe estar incluido en la lista de archivos instalados por la aplicación.. El archivo.WER debe contener todas las características de las rutas a los ficheros de datos maestros utilizados por la aplicación.. El archivo.WER no se puede incluir en la biblioteca (archivo WDL).

Si la ubicación de los archivos de datos de la base de datos maestra se desconoce al crear el archivo.WER, debe especificarse para cada ordenador del usuario final instalado.. Esta operación se puede realizar:

- en el ordenador del usuario final directamente. Para ello, ReplicEdit debe ser suministrado al usuario. Sin embargo, el usuario tendrá acceso a todas las características de reproducción. Esta solución puede causar problemas de seguridad.

- por el desarrollador, una vez que el usuario final haya especificado la ruta de la base de datos maestra. A continuación, el.WER se transmite al usuario final para su actualización.




**Replicación asistida con servidor de replicación**: Si realiza una replicación asistida con servidor de replicación, el archivo.WER debe desplegarse en el servidor de replicación con toda la información relativa a la base de datos maestra.. Para obtener más información, consulte [Servidor para Replicación Universal Asistida](../WDLang4/1000017227.md).  

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Base de datos HFSQL Client/Server: Implementar una replicación mediante programación
<a name="base_datos_hfsql_clientserver_implementar_una_replicacion_mediante_programacion_ELTTEXTE000382"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Etapa 1: Programación local del acceso a los archivos
<a name="etapa_1_programacion_local_del_acceso_los_archivos_ELTPARAGRAPHE000142"></a>

Si una aplicación utiliza la replicación universal asistida, accede a una base de datos local que sólo contiene los datos necesarios.. La base de datos principal (base de datos maestra) sólo se utiliza durante la sincronización.

Por lo tanto, la aplicación debe ser modificada para poder acceder a los archivos de datos locales.. Debes programar:

- la creación (si es necesario) de los archivos locales.

- el acceso a estos archivos locales.




El **criterio** es sencillo:

- **Definición de las conexiones a nivel de análisis**: Las conexiones deben describirse a nivel de análisis. Cada archivo es associated con una conexión.

- **Configuración de las conexiones con ReplicEdit**: ReplicEdit se utiliza para configurar estas conexiones con el fin de acceder a las bases de datos maestras.

- **Programación del acceso a los archivos locales**: El código de la aplicación se utilizará para cambiar cada conexión a una conexión HFSQL Classic con el fin de utilizar los archivos localmente.




**Implementación**: Si su aplicación utiliza archivos de datos que requieren o más conexiones (HFSQL Client/Server, accesos nativos, archivos OLE DB, ...): recomendamos que realice las siguientes operaciones:

- en el editor de análisis: si sus archivos son associated sin conexión, cree tantas conexiones de prueba como sean necesarias. Por ejemplo, si se utilizan datos HFSQL Client/Server y datos Oracle, se deben definir dos conexiones de prueba en el análisis.

- en tu código, modifica las conexiones associated con los archivos: todo lo que tienes que hacer es modificar los parámetros de las conexiones de prueba a manipular los archivos locales de HFSQL Classic. Por ejemplo, el siguiente código se utiliza para definir una conexión local en archivos HFSQL:
	
	```wl
	HOpenConnection("HF_local", "", "", "", "", hAccessHF7)
	HChangeConnection("*", "HF_local")
	```




<a name="NOTE4_2"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Paso 1 bis: Uso de una base de datos que no está en formato HFSQL
<a name="paso_1_bis_uso_una_base_datos_que_esta_formato_hfsql_ELTPARAGRAPHE000169"></a>

Para implementar la replicación universal en bases de datos externas (Oracle, etc.), se debe crear un campo de tipo ***DateTime*** en cada archivo que tiene en cuenta la replicación. Este elemento deberá ser actualizado por la aplicación cuando se modifique o añada un Record.

Si las bases de datos utilizan zonas horarias diferentes, le recomendamos que utilice un formato universal (por ejemplo, fecha y hora GMT).

**Ejemplo: Gestionar un elemento específico para la réplica entre una base de datos HFSQL y una base de datos MySQL**:

Se implementa un trigger para rellenar automáticamente el ítem "Itm_DateTime" que se encuentra en la base de datos MySQL:

- Código del trigger
	
	```wl
	TriggerResult is boolean
	TriggerResult = HDescribeTrigger("*", "HADD,HMODIFY,HDELETE,HCROSS,HWRITE", ...
		"AddDateTime", hTriggerBefore)
	IF TriggerResult = False THEN Error(HErrorInfo())
	```


- Procedure llamada por el gatillo
	
	```wl
	PROCEDURE AddDateTime()
	TestReplic.Itm_DateTime = DateSys()+TimeSys()
	```




<a name="NOTE4_3"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Etapa 2: Descripción de la réplica
<a name="etapa_2_descripcion_replica_ELTPARAGRAPHE000178"></a>

La replicación se describe en ReplicEdit. Esta herramienta está acostumbrada a:

- definir los ficheros tenidos en cuenta por la replicación, los filtros tenidos en cuenta a la hora de actualizar los datos. Para obtener más información, consulte [Creación de una réplica con ReplicEdit](../ReplicEdit/3526501.md).

- configurar la ubicación de los ficheros maestros. Todo lo que tiene que hacer es redefinir las conexiones del análisis. La lista de conexiones es devuelta por "Replicación... description de conexiones" de ReplicEdit. Para obtener más información, consulte [Opciones de replicación definidas en ReplicEdit](../ReplicEdit/3526502.md).




Esta información se guarda en un archivo ".WER" creado por ReplicEdit.
<a name="NOTE4_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/us/WINDOWS.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Etapa 3: Programación de la réplica
<a name="etapa_3_programacion_replica_ELTPARAGRAPHE000198"></a>

La base de datos local se inicializa cuando se realiza la primera sincronización entre la aplicación y la base de datos maestra.. Las conexiones a la base de datos maestra se definen en el archivo WER generado por ReplicEdit.

**Para una replicación directa asistida:** Ejemplo de código que se puede utilizar:


```wl
// Initialize the replication by passing the zip code 
// to take into account
IF ReplicInfo("MyReplication", replicInitialized) = False THEN
	ReplicInitialize("MyReplication", 47012)
END

// Starts the synchronization
ReplicSynchronize("MyReplication")
```


La base de datos local debe ser inicializada una sola vez por [ReplicInitialize](../WDLang4/1000017195.md).

Entonces, se requiere una única sincronización de datos ([ReplicSynchronize](../WDLang4/1000017196.md))

**Para una replicación asistida con servidor de replicación**: Si se realiza una replicación asistida con servidor de replicación, se debe llamar a [ReplicOpen](../WDLang4/1000017194.md) antes de [ReplicInitialize](../WDLang4/1000017195.md) para especificar los parámetros del servidor de replicación.


```wl
// Starts the replication on the replication server
ReplicOpen("MyReplication", "", "ReplicationServer", "Flora", "password")

// Initialize the replication by passing the zip code 
// to take into account
IF ReplicInfo("MyReplication", replicInitialized) = False THEN
	ReplicInitialize("MyReplication", 47012)
END

// Starts the synchronization
ReplicSynchronize("MyReplication")
```

<a name="NOTE4_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Etapa 4: Implementación de la aplicación
<a name="etapa_4_implementacion_aplicacion_ELTPARAGRAPHE000231"></a>

El programa instalación está preparado como para cualquier aplicación estándar. El archivo.WER debe estar incluido en la lista de archivos instalados por la aplicación.. El archivo.WER debe contener todas las características de las conexiones a las bases de datos maestras utilizadas por la aplicación.

**Importante**: Al crear el programa instalación, no pida instalar la replicación asistida (desmarque "Instalar y configurar los módulos para la replicación universal asistida").
Recordatorio: Para crear el programa de instalación, en la pestaña "Proyecto", en el grupo "Generación", despliegue "Procedimiento de instalación" y seleccione "Crear procedimiento de instalación".

**Replicación asistida directa (sin servidor de replicación)**:  El archivo.WER debe estar incluido en la lista de archivos instalados por la aplicación.. El archivo.WER debe contener todas las características de las rutas a los ficheros de datos maestros utilizados por la aplicación.. El archivo.WER no se puede incluir en la biblioteca (archivo WDL).

Si los parámetros para la conexión a las bases de datos maestras son desconocidos cuando se crea el archivo.WER, deben especificarse para cada ordenador de usuario final instalado.. Esta operación se puede realizar:

- en el ordenador del usuario final directamente. Para ello, ReplicEdit debe ser suministrado al usuario. Sin embargo, el usuario tendrá acceso a todas las características de reproducción. Esta solución puede causar problemas de seguridad.

- por el desarrollador, una vez que el usuario final haya especificado la ruta de la base de datos maestra. A continuación, el.WER se transmite al usuario final para su actualización.




**Para una replicación asistida con servidor de replicación**: Si está realizando una replicación asistida con servidor de replicación, el archivo.WER debe desplegarse en el servidor de replicación con la información relativa a las conexiones a las bases de datos maestras.. Para obtener más información, consulte [Servidor para Replicación Universal Asistida](../WDLang4/1000017227.md).  




