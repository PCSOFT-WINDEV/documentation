


## Desencadenantes de la aplicación
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## ¿Qué es un desencadenante?
<a name="¿que_desencadenante_ELTTEXTE000275"></a>


### Definition
<a name="definition_ELTPARAGRAPHE000011"></a>

Un disparador es un procedimiento WLanguage llamado automáticamente por el motor HFSQL cada vez que se realiza una modificación (adición, eliminación, modificación, ...) en un Record de un archivo de datos.

Un trigger sirve para asociar un lenguaje WL Process a una o varias funciones HFSQL ([HAdd](../WDLang4/3044147.md), [HModify](../WDLang4/3044042.md), [HDelete](../WDLang4/3044018.md), ...) sin tener que preocuparse de la ubicación de estas funciones en el código fuente. Los disparadores associated con las funciones HFSQL utilizadas se ejecutan incluso si se trata de una ventana o un código creado por un asistente.

Observación: Los disparadores también operan con las funciones de gestión de controles Tabla basadas en un archivo de datos: [TableAdd](../WDLang1/3074017.md), [TableAddLine](../WDLang1/3074006.md), [TableModify](../WDLang1/3074019.md), [TableModifyLine](../WDLang1/3074028.md), [TableDelete](../WDLang1/3074032.md), ...

El uso de un gatillo le permite hacerlo:

- Reducir el tamaño del código. Por ejemplo, el uso de un trigger permite agrupar los procesos associated con una o más funciones HFSQL (comprobación de duplicados, consistencia de datos, ...).

- Facilitar la lectura del código.

- Simplificar las evoluciones futuras de la aplicación.




Los disparadores se pueden aplicar a todo tipo de archivos de datos:

- HFSQL

- Accesos nativos (Oracle, AS/400, ....)

- ODBC

- OLE DB




Observaciones: 

- Con una base de datos HFSQL Client/Server, también tiene la posibilidad de definir disparadores del servidor. Para obtener más información, consulte [Disparadores de servidor](../WDLang4/3044369.md). 

- Cuando se modifican los archivos de datos a través de una consulta, se disparan los triggers del servidor, los triggers simples o los triggers del cliente. 








<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Tipos de disparadores disponibles
<a name="tipos_disparadores_disponibles_ELTTEXTE000305"></a>
Hay dos tipos de desencadenantes disponibles:

- Los disparadores "ANTES":
	Un disparador "ANTES" se llama: 

	- *antes de* ejecutando una función HFSQL ([HAdd](../WDLang4/3044147.md), [HModify](../WDLang4/3044042.md), [HDelete](../WDLang4/3044018.md), ...). 

	- *antes de* ejecutando una función de gestión del controles Tabla basada en un archivo de datos.
			Un disparador "ANTES" puede utilizarse, por ejemplo, para comprobar la coherencia de los datos de los artículos de un Record. Con este tipo de disparador, se puede inicializar un Variable HFSQL para cancelar la ejecución de la función HFSQL de associated.




- El"DESPUÉS" se activa:
	Un disparador "DESPUÉS" se llama: 

	- *después de* ejecutar una función HFSQL (excepto si el programa se interrumpió durante la ejecución de esta función). 

	- *después de* que ejecuta una función de gestión del controles Tabla basada en un archivo de datos. 
			Un disparador "DESPUÉS" puede ser usado para manejar el Process de los errores por ejemplo.







<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Manejar los disparos a través de la programación
<a name="manejar_los_disparos_traves_programacion_ELTTEXTE000329"></a>


### Las funciones de WLanguage
<a name="las_funciones_wlanguage_ELTPARAGRAPHE000112"></a>Se utilizan varias funciones WLanguage para manipular los disparadores:



|   |   |
| --- | --- |
| [HActivateTrigger](../WDLang4/3044155.md) | Vuelve a activar un disparador que fue desactivado por [HDeactivateTrigger](../WDLang4/3044089.md). |
| [HDeactivateTrigger](../WDLang4/3044089.md) | Deshabilita un disparador. |
| [HDeleteTrigger](../WDLang4/3044090.md) | Elimina un trigger. |
| [HDescribeTrigger](../WDLang4/3044074.md) | Añade o modifica un activador en un archivo de datos HFSQL. |
| [HListTrigger](../WDLang4/3044231.md) | Devuelve la lista de disparadores aplicados a uno o más archivos de datos HFSQL. |
| [HSetTrigger](../WDLang4/3044065.md) | Habilita o no el manejo de disparadores. |
| [HTriggerRecordBefore](../WDLang4/1000025873.md) | Recupera el valor de la Record actual antes de que se ejecuten los disparadores. |




<a name="NOTE3_2"></a>


### Creación de un desencadenante
<a name="creacion_desencadenante_ELTPARAGRAPHE000120"></a>

Para crear un disparador "ANTES" o un disparador "DESPUÉS", utilice [HDescribeTrigger](../WDLang4/3044074.md) en la inicialización Process del proyecto. Se puede crear el desencadenante:

- En uno o más archivos de análisis,

- Para una o más funciones HFSQL ([HAdd](../WDLang4/3044147.md), [HModify](../WDLang4/3044042.md), [HDelete](../WDLang4/3044018.md), [TableAdd](../WDLang1/3074017.md), [TableAddLine](../WDLang1/3074006.md), ...).




El asociado WLanguage Procedure se ejecuta cada vez que se ejecuta un disparador.

**Observación**: Un desencadenante es global para el proyecto.
<a name="NOTE3_3"></a>


### Creando una Procedure dirigida por un disparador
<a name="creando_una_procedure_dirigida_por_disparador_ELTPARAGRAPHE000152"></a>

Un disparador Procedure no acepta ningún parámetro. Sin embargo, algunas variables de estado HFSQL se colocan antes de cada llamada:


|   |   |
| --- | --- |
| *H.NombreDeArchivo* | Cadena de caracteres: Nombre lógico del fichero cuyo trigger está habilitado. |
| *H.Action* | Carácter inicializado a "A" para un Antes del disparo y a "P" para un Después del disparo. |
| *Función Trigger H.* | Cadena de caracteres: Nombre de la función HFSQL que activó el trigger. |
| *H.ToDo* | Durante la ejecución de un trigger anterior:<br><br>- cancelar la ejecución de la función HFSQL asignando **"A"** al estado HFSQL Variable: H.ToDo = "A". <br>	En este caso, la acción no se realiza y la función (HAdd, HModify, etc.) devuelve <u><u><u><u>True</u></u></u></u> (sin error).<br><br>- Cancelar la ejecución de la función HFSQL actual asignando **"E"** al estado HFSQL Variable: H.ToDo = "E". <br>	En este caso, la acción no se realiza y la función (HAdd, HModify, etc.) devuelve <u><u><u><u>False</u></u></u></u>. El mensaje de error es el siguiente: "La acción en el archivo XXX fue interrumpida por el gatillo".<br><br><br> |


**Observación**: Cuando un trigger "ANTES" y un trigger "DESPUÉS" se associated con una función HFSQL, si "ANTES" cancela la ejecución de la función HFSQL (poniendo H.ToDo en "A"), "DESPUÉS" no se ejecuta.

En el código de Procedure, la palabra clave [MiArchivo](../Motscles/1511019.md) obtiene y maneja el nombre del archivo sobre el que se disparó el trigger. Para un disparador "DESPUÉS", si el comando HFSQL no se ejecutó correctamente, el Procedure associated con el disparador no se ejecuta.
<a name="NOTE3_4"></a>


### Pruebas automatizadas y activadores
<a name="pruebas_automatizadas_activadores_ELTPARAGRAPHE000199"></a>

Si las pruebas automatizadas activan desencadenantes que utilizan cuadros de diálogo ([YesNo](../WDLang1/3021005.md), [Confirme](../WDLang1/3021007.md), ...), estos cuadros de diálogo deben desactivarse cuando la prueba sea ejecutada por [InAutomaticTestMode](../WDLang1/3014027.md). 
<a name="NOTE3_5"></a>


### Disparadores y alias de archivos de datos
<a name="disparadores_alias_archivos_datos_ELTPARAGRAPHE000215"></a>

Los activadores pueden definirse en los alias de los archivos de datos. 

- El alias debe haber sido descrito antes de llamar a [HDescribeTrigger](../WDLang4/3044074.md).

- El nombre del alias debe especificarse en [HDescribeTrigger](../WDLang4/3044074.md). 







