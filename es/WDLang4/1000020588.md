


## Replicación del servidor HFSQL
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000173"></a>
La replicación entre servidores HFSQL consiste en replicar automáticamente los datos de servidor a servidor, de forma asíncrona.. Esta replicación también puede hacerse con un servidor SPARE. 

Ejemplo simple: una empresa puede tener varios servidores HFSQL en diferentes ubicaciones, un servidor en cada sucursal por ejemplo. La replicación entre servidores se utiliza para replicar los datos de cada servidor.. 

Se pueden implementar varios métodos de replicación: 

- los **replicación lineal**: Dos o más servidores son relacionado de dos en dos. 

- los **replicación en estrella**: Por ejemplo, la sede y los organismos utilizan servidores HFSQL. Las agencias pueden sincronizar sus datos con la sede en tiempo regular interval. 

- los **replicación en estructura de árbol**: Por ejemplo, una multinacional puede sincronizar sus agencias por Continent, luego por Country. 




En todas estas configuraciones, la replicación está definida por un par de servidores. La replicación puede ser: 

- unidireccional o bidireccional. 
	**En una replicación unidireccional**los datos fluyen en una sola dirección. Las actualizaciones se realizan desde un servidor maestro a un servidor de suscriptores.. 
	 **En una replicación bidireccional**el dato se sincroniza en ambos sentidos. Las actualizaciones se realizan en cada uno de los servidores. 

- periódico o continuo. 
	Se realiza una réplica periódica en un tiempo preestablecido interval: cada noche a las 20:00, ...
	Se realiza una replicación continua cada vez que se modifica la base de datos (puede existir un tiempo muerto entre la modificación inicial y la actualización realizada en los otros servidores).




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Implementación de la replicación de servidores HFSQL
<a name="implementacion_replicacion_servidores_hfsql_ELTTEXTE000203"></a>
La replicación de servidores HFSQL puede ser implementada: 

- desde el Centro de Control HFSQL. Para obtener más información, consulte [Centro de Control HFSQL: implementar una replicación](../CCHF/3540002.md). 

- mediante programación mediante funciones WLanguage. Para obtener más información, consulte [Implementar una replicación mediante programación](../WDLang4/1000020587.md). 





|   |
| --- |
| **Atención**: La implementación de la replicación entre varios servidores HFSQL requiere algunas adaptaciones en la aplicación (ver el siguiente párrafo).<br>Si no se realizan estas adaptaciones, es posible que la aplicación no funcione correctamente y que se pierdan datos. |



<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Condición previa
<a name="condicion_previa_ELTTEXTE000227"></a>
La implementación de la replicación unidireccional o bidireccional entre varios servidores HFSQL requiere hacer algunos cambios en la aplicación.

**Estos cambios no son necesarios en una réplica de reserva**.

**1. En cuanto al análisis de la aplicación**
En el análisis, los ficheros de datos implicados en la replicación de los servidores HFSQL deben tener: 

- un identificador de automatic en 8 bytes. Si el identificador automatic está codificado en 4 bytes, debe ser modificado. 
	**Atención**: Esta modificación puede provocar modificaciones en el código de la aplicación. Por ejemplo, cuando se manejan identificadores de archivos con variables enteras. 

	- Busca "n is int = file.autoid" en tu aplicación para reemplazar el entero por un entero de 8 bytes.

	- Compruebe si los identificadores de su archivo se pasan a procedimientos que esperan un número entero.. En este caso, debe eliminar el tipo de la declaración de la Procedure, o utilizar un entero de 8 bytes. 




- una clave primaria (es decir, una clave única simple o compuesta que no acepta un valor nulo y cuyos componentes no aceptan un valor nulo). 




**2. En cuanto a la solicitud**

- no se debe utilizar [HCross](../WDLang4/3044121.md). 

- Un archivo no se puede copiar si se replica: no se debe utilizar [HCopyFile](../WDLang4/3044282.md). 
	Observación: Para una replicación unidireccional: 

	- el copy al servidor maestro no está permitido.

	- el copy del servidor maestro está permitido.




- No se puede restaurar un archivo replicado: [HRestoreBackup](../WDLang4/1000017230.md) no puede utilizarse. 

- Los clusters HFSQL no deben ser usados en los datos replicados.. 




**3. Seleccione la información a replicar**: La implementación de la replicación de servidores reduce el rendimiento de los servidores HFSQL. Le aconsejamos que implemente la replicación entre servidores sólo para los archivos de datos realmente afectados por la replicación.. No dude en excluir algunos archivos de la replicación. 

**Atención**:

- La replicación bidireccional entre varios servidores HFSQL requiere el uso de direcciones IP fijas o "reverse-DNS".: debe encontrarse el nombre del servidor en el que se creó la réplica. 

- La comunicación del servidor HFSQL del suscriptor al servidor HFSQL maestro utilizará la IP Address que el servidor maestro utilizó para Contact el suscriptor al crear la réplica. Esta IP Address (utilizada por el servidor suscriptor para Contact el servidor maestro) se puede encontrar a través del Centro HFSQL control del servidor suscriptor en la configuración de la replicación (campo "Servidor de destino").




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## FAQ sobre la replicación entre servidores HFSQL
<a name="faq_sobre_replicacion_entre_servidores_hfsql_ELTTEXTE000295"></a>


### Cuando se implementa una réplica entre servidores HFSQL, ¿por qué los identificadores de automatic están codificados en 8 bytes?
<a name="cuando_implementa_una_replica_entre_servidores_hfsql_¿por_que_los_identificadores_automatic_estan_codificados_8_bytes_ELTPARAGRAPHE000069"></a>

Cuando la clave primaria es un identificador de automatic, el servidor debe comprobar la unicidad de los identificadores en todos los servidores que participan en la replicación.

Para ello, cada servidor de replicación utiliza un rango de valores diferentes para los identificadores automatic de los registros creados.

Para que el rango de identificadores de automatic utilizados por cada servidor sea lo suficientemente amplio, los identificadores de automatic deben estar codificados en 8 bytes. 


### ¿Por qué se añaden los valores de los identificadores de automatic una vez que se implementó la replicación del servidor tan alta?
<a name="¿por_que_anaden_los_valores_los_identificadores_automatic_una_vez_que_implemento_replicacion_del_servidor_tan_alta_ELTPARAGRAPHE000078"></a>

Cada servidor que participa en la replicación utiliza un rango diferente de identificadores automatic basados en el identificador del servidor de replicación.

El primer rango de identificadores de automatic (el que comienza en 0) no será usado por ningún servidor que participe en la replicación: esta gama de identificadores se reserva a los datos existentes al implementar la primera réplica.

Por lo tanto, tan pronto como se cree un nuevo Record en una réplica del servidor, si se asigna un identificador automatic al archivo, el valor de este identificador será un valor alto.


### ¿Cuál es la configuración de red necesaria para la replicación del servidor de set?
<a name="¿cual_configuracion_red_necesaria_para_replicacion_del_servidor_set_ELTPARAGRAPHE000087"></a>

La replicación del servidor utiliza el puerto 4996 para transferir datos.

- En una réplica bidireccional, el puerto 4996 debe estar abierto en ambos servidores (maestro y suscriptor). 

- En una réplica unidireccional o de repuesto, el puerto 4996 puede estar abierto sólo en el servidor de suscripción o de repuesto.





### Se modificó la estructura de los archivos en el análisis (adición, modificación o eliminación de elementos).. ¿Cómo aplicar las modificaciones a los archivos encontrados en los servidores HFSQL con una replicación de servidor?
<a name="modifico_estructura_los_archivos_analisis_adicion_modificacion_eliminacion_elementos_¿como_aplicar_las_modificaciones_los_archivos_encontrados_los_servidores_hfsql_con_una_replicacion_servidor_ELTPARAGRAPHE000095"></a>

Todo lo que tienes que hacer es aplicar la modificación de la estructura (modificación de datos de automatic) al servidor de replicación maestro. Esta modificación de datos del automatic puede ser ejecutada: 

- desde el editor de análisis, 

- al instalar la aplicación

- mediante programación. 




Durante la siguiente sincronización de datos entre servidores, la modificación de la estructura de archivos se aplicará automáticamente a los servidores HFSQL del suscriptor.. Los procedimientos almacenados y los disparadores del servidor también se actualizarán durante esta sincronización.


### Replicación del servidor: ¿Las transacciones se gestionan en los servidores HFSQL?
<a name="replicacion_del_servidor_¿las_transacciones_gestionan_los_servidores_hfsql_ELTPARAGRAPHE000106"></a>

Cuando se modifican, añaden o eliminan registros en una transacción en un servidor HFSQL en modo de replicación, los registros se replican en los servidores suscriptores sólo cuando se valida la transacción. 

Si la transacción se cancela (rollback), no se realizará ninguna replicación para los registros relevantes.. 

Si la transacción es validada, todas las operaciones en transacción serán transmitidas a los servidores replicados.


### Replicación del servidor: ¿Qué tipo de seguridad se utiliza para la replicación del servidor?
<a name="replicacion_del_servidor_¿que_tipo_seguridad_utiliza_para_replicacion_del_servidor_ELTPARAGRAPHE000115"></a>

La comunicación entre servidores es autenticada. También está encriptado.


### Replicación del servidor : ¿Cómo se ejecutan los triggers del servidor?
<a name="replicacion_del_servidor_¿como_ejecutan_los_triggers_del_servidor_ELTPARAGRAPHE000120"></a>

Un servidor disparador associated con una actualización de archivos se ejecuta en el servidor HFSQL para el cual la función que activa el disparador se llama. 

Todos los registros modificados se sincronizan mediante replicación del servidor. 

Por lo tanto, si un disparador de servidor realiza modificaciones en los datos, estas modificaciones se aplicarán automáticamente a los servidores replicados sin tener que ejecutar los disparadores en los servidores replicados.


