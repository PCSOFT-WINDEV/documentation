


## HLockRecNum (Función)



<a name="XUse"></a>
<a name="Use"></a>
<a name="description"></a>
Bloquea un registro y e impide que las demás aplicaciones accedan a él. El registro podrá desbloquearse con la función [HUnlockRecNum](../WDLang4/3044194.md).

**Observación**: Tras la llamada a **HLockRecNum**pueden darse varios casos:

- El registro ya está bloqueado por otra aplicación: no se puede realizar el bloqueo.

- El archivo de datos que contiene el registro está completamente bloqueado.: no se puede realizar el bloqueo.


Por defecto, se realiza una [gestión automática de errores de bloqueo y de conflictos de modificación](../WDLang4/3044188.md) (excepto en el código de procedimientos almacenados). La gestión automática de errores se puede personalizar o desactivar en cualquier momento con la función [HOnError](../WDLang4/3044017.md).

La función [HErrorLock](../WDLang4/3044099.md) devuelve <u><u><u>True</u></u></u> si se produce un problema de bloqueo.

**Atención**: La función **HLockRecNum** debe utilizarse con precaución: durante el bloqueo, el registro no se vuelve a leer. Por lo tanto, puede que se haya eliminado o modificado desde la última vez que se accedió a él. Se recomienda utilizar [HRead](../WDLang4/3044047.md) con una opción de bloqueo.

![Java](https://doc.pcsoft.fr/ext/images/us/JAVA.png) Esta función sólo está disponible para los archivos de datos HFSQL. No está disponible para los archivos de datos a los que accede con JDBC. 
<a name="Example1"></a>
<a name="sample_code"></a>

## Ejemplo


```wl
// Lock a record in the Customer data file
HLockRecNum(Customer, hCurrentRecNum, hLockReadWrite)
// Process on the record
...
// Restore access to the record
HUnlockRecNum()
```

<a name="XSYNTAX"></a>
<a name="SYNTAX1"></a>

## Sintaxis

`<Result> = HLockRecNum([<Data file> [, <Record to lock>]] [, <Lock>])`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True</u></u></u></u> si se realizó la operación, 

- <u><u><u><u>False</u></u></u></u> si se produce un problema. La función [HError](../WDLang4/3044088.md) permite identificar el error.




**`<Data file>: (Cadena de caracteres opcional)`**

Nombre del archivo de datos utilizado. 
Si no se especifica este nombre, la función **HLockRecNum** utilizará el último archivo de datos utilizado por la última función HFSQL (que empieza por "H").

**`<Record to lock>: (Entero opcional)`**

Número del registro a bloquear. 
Si no se especifica este parámetro, **HLockRecNum** manipular el Record actual.

![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) La función **HLockRecNum** solo bloquea el registro actual. No se puede especificar un número de Record que no sea el actual (para especificar el número actual de Record, utilice la constante *hRecNumCurrent*).

**`<Lock>: (Constante opcional de tipo Integer)`**

Sirve para definir el tipo de bloqueo establecido en el Record.


|   |   |
| --- | --- |
| *hLockNo* | **Ningún bloqueo**: otras aplicaciones pueden leer o modificar el registro. |
| *hLockReadWrite* | **Bloqueo de lectura/escritura**: otras aplicaciones no pueden leer ni modificar el registro del archivo de datos. <br>La otra aplicación no podrá bloquear el Record o el el archivo de datos. |
| *hLockWrite*<br>(valor predeterminado) | **Bloqueo de escritura**: otras aplicaciones pueden leer el registro del archivo de datos pero no modificarlo.<br>La otra aplicación no podrá bloquear el Record o el el archivo de datos. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Observaciones


### Modificar el tipo de bloqueo en un registro
<a name="modificar_tipo_bloqueo_registro_ELTPARAGRAPHE000176"></a>

Para modificar el tipo de bloqueo de un registro, llame a la función **HLockRecNum** con el tipo de bloqueo deseado. No es necesario desbloquear el registro.
<a name="NOTE0_2"></a>


### Efecto del modo de bloqueo
<a name="efecto_del_modo_bloqueo_ELTPARAGRAPHE000187"></a>

Si el modo de bloqueo el archivo de datos está configurado como *hModeMono* (véase [HMode](../WDLang4/3044039.md)), **HLockRecNum** no tiene ningún efecto.
<a name="NOTE0_3"></a>


### Error de bloqueo
<a name="error_bloqueo_ELTPARAGRAPHE000201"></a>

Si el registros ya está bloqueado, la solicitud de bloqueo se repite HNbRetry veces (50 por defecto).

Si al cabo de H.NbRetry intentos no se puede bloquear el archivo de datos, la función [HErrorLock](../WDLang4/3044099.md) devuelve <u><u><u><u>True</u></u></u></u>. La variable H.Level indica si el registro o el archivo de datos está bloqueado.
<a name="NOTE0_4"></a>


### Número de bloqueos
<a name="numero_bloqueos_ELTPARAGRAPHE000219"></a>

El número de registros que se pueden bloquear individualmente en un archivo de datos es ilimitado.
<a name="NOTE0_5"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Procedimientos almacenados](https://doc.pcsoft.fr/ext/images/us/PS.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Conector Nativo SQL Server: Bloqueo de escritura
<a name="conector_nativo_sql_server_bloqueo_escritura_ELTPARAGRAPHE000230"></a>

**HLockRecNum** bloquea el record en modo escritura, no en modo lectura. Por lo tanto, la función **HLockRecNum** impide que otro equipo modifique el registro.

Al utilizar la función **HLockRecNum** en un registro bloqueado, esta NO devuelve errores de bloqueo (porque solo se realiza una lectura).

Sin embargo, la función [HModify](../WDLang4/3044042.md) devolverá un error de bloqueo en el registro bloqueado.
<a name="NOTE0_6"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Procedimientos almacenados](https://doc.pcsoft.fr/ext/images/us/PS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png) 

### Gestión de bloqueos en OLE DB
<a name="gestion_bloqueos_ole_ELTPARAGRAPHE000254"></a>

La función **HLockRecNum** no está soportada. Esta función genera el error no fatal "Operación no válida en este tipo de base de datos".
<a name="NOTE0_7"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### Persistencia del bloqueo
<a name="persistencia_del_bloqueo_ELTPARAGRAPHE000267"></a>

Con los Conectores Nativos SQLServer y Sybase, un registro bloqueado con la función **HLockRecNum** se desbloquea cuando se vuelve a leer.

<a name="XComponent"></a>

## Componente:
wd280hf.dll
