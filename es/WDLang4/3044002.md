


## HTransactionStart (Función)



<a name="XUse"></a>
<a name="Use"></a>
<a name="description"></a>
Inicia una transacción en los archivos de datos (HFSQL o accedido a través de una Conector Nativo) y crea el archivo de transacción.

**¿Cuál es la información que se guarda en el archivo de transacciones?** Cuando una función WLanguage modifica un archivo de datos o de índices durante durante una transacción, los anteriores valores del registro y la operación realizada se almacenan en el archivo de transacciones.

![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png) Esta función propone dos modos de funcionamiento de las operaciones: 

- La transacción puede iniciarse en una conexión: En este caso, se inicia una transacción sólo para los archivos associated a esta conexión. Este modo es necesario para gestionar el [niveles de aislamiento de las transacciones](../WDLang4/1000017316.md). 

- La transacción puede iniciarse en todas las conexiones HFSQL (existentes o futuras).. En este caso, **HTransactionStart** inicia tanto una transacción HFSQL Classic (ISAM) como una transacción HFSQL Client/Server.




**Observación**: Esta función es equivalente a la función [HTransaction](../WDLang4/1000023384.md).
<a name="Example1"></a>
<a name="sample_code"></a>

## Ejemplo


```wl
MyConnection1 is Connection

// Start transaction on data files associated with MyConnection1
HTransactionStart(MyConnection1)

// Code used to prepare the order to added
// ...

WHEN EXCEPTION IN
	// Add the order
	HAdd(Orders) 
	// Validate the addition
	HTransactionEnd(MyConnection1)
DO
	// Delete the order lines
	HTransactionCancel(MyConnection1)
END
```
<a name="Example2"></a>

```wl
// Start transaction on the Orders and OrdLine data files
HTransactionStart("C:\Temp\Transaction.trs", "Orders,OrdLine,-Customer")

// Code used to prepare the order to added
// ...

WHEN EXCEPTION IN
	// Add the order
	HAdd(Orders) 
	// Validate the addition
	HTransactionEnd() 
DO
	// Delete the order lines
	HTransactionCancel() 
END
```

<a name="XSYNTAX"></a>
<a name="SYNTAX1"></a>

## Sintaxis

### Iniciar una transacción Client/Server en una conexión específica

`<Result> = HTransactionStart(<Connection> [, <List of data files>])`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True STRIMEULB</u></u></u></u> si se ha iniciado la transacción,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. [HErrorInfo](../WDLang4/3044071.md) devuelve más detalles sobre el error.




**`<Connection>: (Cadena de caracteres o variable de tipo Connection)`**

Nombre de la conexión a utilizar. Esta conexión corresponde a: 

- el nombre de la conexión definida en el editor de análisis o con las funciones [HDescribeConnection](../WDLang4/3044205.md) o [HOpenConnection](../WDLang4/3044107.md).

- el nombre de una variable de tipo [Conexión](../WDLang4/1514073.md).


Si este parámetro corresponde a la constante *hAccessHF7*, la transacción se realizará en archivos HFSQL ISAM. 

**`<List of data files>: (Cadena de caracteres opcional)`**

Lista de los nombres lógicos de uno o varios ficheros de datos a tener en cuenta (o no) en la operación (en este caso, el nombre de el archivo de datos va precedido del signo "-").


|   |   |
| --- | --- |
| **Si no se especifica este parámetro** | Todos los archivos de datos utilizados durante la transacción serán tenidos en cuenta en la transacción. |
| **Si todos los archivos de datos se prefijan con el signo "-"**<br>Por ejemplo: "-Cliente, -Producto" | Todos los archivos de datos especificados en la lista y utilizados durante la transacción no serán tenidos en cuenta por la transacción.<br>Todos los archivos de datos no especificados en la lista serán tenidos en cuenta y utilizados durante la transacción. |
| &lt;b&gt;Si ningún archivo de datos de la lista lleva el prefijo "-"&lt;/b&gt;<br>Por ejemplo: "Cliente, producto" | Todos los archivos de datos especificados en la lista y utilizados durante la transacción serán tenidos en cuenta en la transacción. <br>Todos los archivos de datos no especificados y manipulados durante la transacción serán ignorados en la misma. |
| **Si algunos archivos de datos tienen el prefijo "-" y otros no son**<br>Por ejemplo: "Cliente, Producto" (equivalente a "Producto") | Todos los archivos de datos de la lista con el prefijo "-" y utilizados durante la transacción serán ignorados en la transacción.<br>Todos los archivos de datos de la lista que no lleven el prefijo "-" y que se utilicen durante la transacción se tendrán en cuenta en la transacción.<br>Los archivos no especificados en la lista serán excluidos de la transacción. |

![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) Este parámetro no se tiene en cuenta. Todos los archivos de datos de associated con la conexión están en transacción en el servidor nativo.


<a name="SYNTAX2"></a>

### Iniciar una transacción Cliente/Servidor en una conexión específica o una transacción ISAM

`<Result> = HTransactionStart(<Connection> , <Transaction file> , <List of data files>)`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True STRIMEULB</u></u></u></u> si se ha iniciado la transacción,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. [HErrorInfo](../WDLang4/3044071.md) devuelve más detalles sobre el error.




**`<Connection>: (Cadena de caracteres o variable de tipo Connection)`**

Conexión a utilizar. Esta conexión corresponde a:

- el nombre de la conexión definida en el editor de análisis o con las funciones [HDescribeConnection](../WDLang4/3044205.md) o [HOpenConnection](../WDLang4/3044107.md).

- el nombre de una variable de tipo [Conexión](../WDLang4/1514073.md).


Si este parámetro corresponde a una cadena vacía ("") o a la constante *hAccessHF7*, la transacción se realiza en los archivos de datos HFSQL ISAM.

**`<Transaction file>: (Cadena de caracteres)`**

![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) Nombre completo del archivo de transacciones (utilizado para registrar las operaciones realizadas en la transacción). Este archivo se borrará automáticamente al utilizar [HTransactionEnd](../WDLang4/3044032.md) o [HTransactionCancel](../WDLang4/3044001.md). 
Si este nombre corresponde a una cadena vacía, el fichero de transacción se creará en el directorio de ficheros de aplicación y se denominará: &lt;Nombre del proyecto&gt;_$TRS_OPERATION.TRS.![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) Este parámetro no se tiene en cuenta. Este parámetro se tiene en cuenta sólo para las transacciones de HFSQL Classic (transacciones ISAM).

**`<List of data files>: (Cadena de caracteres)`**

Lista de los nombres lógicos de uno o varios ficheros de datos a tener en cuenta (o no) en la operación (en este caso, el nombre de el archivo de datos va precedido del signo "-").


|   |   |
| --- | --- |
| **Si no se especifica este parámetro** | Todos los archivos de datos utilizados durante la transacción serán tenidos en cuenta en la transacción. |
| **Si todos los archivos de datos se prefijan con el signo "-"**<br>Por ejemplo: "-Cliente, -Producto" | Todos los archivos de datos especificados en la lista y utilizados durante la transacción no serán tenidos en cuenta por la transacción.<br>Todos los archivos de datos no especificados en la lista serán tenidos en cuenta y utilizados durante la transacción. |
| &lt;b&gt;Si ningún archivo de datos de la lista lleva el prefijo "-"&lt;/b&gt;<br>Por ejemplo: "Cliente, producto" | Todos los archivos de datos especificados en la lista y utilizados durante la transacción serán tenidos en cuenta en la transacción. <br>Todos los archivos de datos no especificados y manipulados durante la transacción serán ignorados en la misma. |
| **Si algunos archivos de datos tienen el prefijo "-" y otros no son**<br>Por ejemplo: "Cliente, Producto" (equivalente a "Producto") | Todos los archivos de datos de la lista con el prefijo "-" y utilizados durante la transacción serán ignorados en la transacción.<br>Todos los archivos de datos de la lista que no lleven el prefijo "-" y que se utilicen durante la transacción se tendrán en cuenta en la transacción.<br>Los archivos de datos no especificados en la lista serán excluidos de la transacción. |

![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) Este parámetro no se tiene en cuenta. Todos los archivos de datos de associated con la conexión están en transacción en el servidor nativo.


<a name="SYNTAX3"></a>

### Iniciar una transacción ISAM y/o Cliente/Servidor en todas las conexiones HFSQL Client/Server (existentes o futuras)

`<Result> = HTransactionStart([<Transaction file> [, <List of files>]])`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True STRIMEULB</u></u></u></u> si se ha iniciado la transacción,

- <u><u><u><u>False</u></u></u></u> si se produce un problema. [HErrorInfo](../WDLang4/3044071.md) devuelve más detalles sobre el error.




**`<Transaction file>: (Cadena de caracteres opcional)`**

![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) Nombre completo del archivo de transacciones (utilizado para registrar las operaciones realizadas en la transacción). Este archivo se borrará automáticamente al utilizar [HTransactionEnd](../WDLang4/3044032.md) o [HTransactionCancel](../WDLang4/3044001.md). 
Si no se especifica este nombre o si corresponde a una cadena vacía, el fichero de transacción se creará en el directorio de los ficheros de datos de la aplicación y se denominará: &lt;Nombre del proyecto&gt;_$TRS_OPERATION.TRS.![HFSQL Client/Server](https://doc.pcsoft.fr/ext/images/us/HFCS.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) Este parámetro no se tiene en cuenta. Este parámetro se tiene en cuenta sólo para las transacciones de HFSQL Classic (transacciones ISAM).

**`<List of files>: (Cadena de caracteres opcional)`**

Lista de los nombres lógicos de uno o varios ficheros de datos a tener en cuenta (o no) en la operación (en este caso, el nombre de el archivo de datos va precedido del signo "-").


|   |   |
| --- | --- |
| **Si no se especifica este parámetro** | Todos los archivos de datos utilizados durante la transacción serán tenidos en cuenta en la transacción. |
| **Si todos los archivos de datos se prefijan con el signo "-"**<br>Por ejemplo: "-Cliente, -Producto" | Todos los archivos de datos especificados en la lista y utilizados durante la transacción no serán tenidos en cuenta por la transacción.<br>Todos los archivos de datos no especificados en la lista serán tenidos en cuenta y utilizados durante la transacción. |
| &lt;b&gt;Si ningún archivo de datos de la lista lleva el prefijo "-"&lt;/b&gt;<br>Por ejemplo: "Cliente, producto" | Todos los archivos de datos especificados en la lista y utilizados durante la transacción serán tenidos en cuenta en la transacción. <br>Todos los archivos de datos no especificados y manipulados durante la transacción serán ignorados en la misma. |
| **Si algunos archivos de datos tienen el prefijo "-" y otros no son**<br>Por ejemplo: "Cliente, Producto" (equivalente a "Producto") | Todos los archivos de datos de la lista con el prefijo "-" y utilizados durante la transacción serán ignorados en la transacción.<br>Todos los archivos de datos de la lista que no lleven el prefijo "-" y que se utilicen durante la transacción se tendrán en cuenta en la transacción.<br>Los archivos de datos no especificados en la lista serán excluidos de la transacción. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Observaciones
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 

### Aplicación de red (base de datos ISAM)
<a name="aplicacion_red_base_datos_isam_ELTPARAGRAPHE000380"></a>

En la red, el archivo de transacción se puede crear en un disco local o en una unidad de red.

- **Si el archivo de transacción está instalado en un ordenador local**este archivo contendrá información sobre las transacciones realizadas por el ordenador actual. En este caso, el fichero de transacción se borra cuando finaliza la transacción.

- **Si el archivo de transacción está instalado en una unidad de red (recomendado),** este archivo contendrá información sobre las transacciones realizadas por varios ordenadores. Cada ordenador está identificado por un número único. En este caso, el fichero de transacción se borra cuando finaliza la última transacción.



<a name="NOTE0_2"></a>


### Bloqueo de registros
<a name="bloqueo_registros_ELTPARAGRAPHE000392"></a>

Los registros añadidos, modificados o eliminados en una transacción se bloquean en el modo de escritura.
<a name="NOTE0_3"></a>


### Casos de error
<a name="casos_error_ELTPARAGRAPHE000401"></a>

- Operaciones de anidamiento: Las transacciones no se pueden anidar (es decir, no se puede llamar a **HTransactionStart** en una transacción). En este caso, se produce el error 70031.

- Se muestra un error fatal en los siguientes casos: 

	- Se inicia una transacción en todas las conexiones mientras haya al menos una conexión en la transacción.. 

	- Se inicia una operación en una conexión mientras que ya se ha iniciado una operación en todas las conexiones.. 

	- Se inicia una transacción en todas las conexiones mientras haya al menos una conexión cuyo modo de aislamiento no sea "Read Uncommitted".. 






<a name="NOTE0_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![HFSQL Classic](https://doc.pcsoft.fr/ext/images/us/HF.png) 

### Archivos temporales creados durante la transacción (base de datos ISAM)
<a name="archivos_temporales_creados_durante_transaccion_base_datos_isam_ELTPARAGRAPHE000423"></a>

Durante la transacción, se crean ficheros temporales (extensión".TRX") en el directorio que contiene los ficheros de datos (ficheros".FIC").. Estos archivos temporales no deben ser borrados. De lo contrario, los datos tratados por la transacción podrían resultar dañados.

**Observación**: Estos archivos temporales se eliminan automáticamente al final de la transacción.
<a name="NOTE0_5"></a>


### Manipular registros durante una transacción
<a name="manipular_registros_durante_una_transaccion_ELTPARAGRAPHE000434"></a>

Durante una transacción, se deben cumplir algunas reglas al manipular registros. Para obtener más información, consulte [Transacciones: Manipular registros durante una transacción](../WDLang4/3044336.md).
<a name="NOTE0_6"></a>


### Transacciones y contexto HFSQL independiente
<a name="transacciones_contexto_hfsql_independiente_ELTPARAGRAPHE000446"></a>

Al copiar un contexto, si una transacción está en curso en el primer contexto, el nuevo contexto no está en la transacción.. Se debe llamar a la función **HTransactionStart** para iniciar una transacción en el nuevo contexto.
<a name="NOTE0_7"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png)![OLE DB](https://doc.pcsoft.fr/ext/images/us/OLEDB.png)![Conectores Nativos](https://doc.pcsoft.fr/ext/images/us/AN.png) 

### OLE DB y Conectores Nativos
<a name="ole_conectores_nativos_ELTPARAGRAPHE000459"></a>

Sólo las sintaxis con conexión son tenidas en cuenta por los Accesos Nativos que soportan las transacciones.. También se puede utilizar la función [SQLTransaction](../WDLang4/3072029.md).

<a name="XComponent"></a>

## Componente:
wd280hf.dll
