
## Gestión del clúster HFSQL
			



## Presentación
<a name="presentacion_ELTTEXTE000346"></a>
La mayoría de las tareas de gestión del clúster HFSQL se realizan a través del programa [Centro de Control HFSQL](../CCHF/3540001.md).

Las tareas de gestión más comunes son:

- [Inicio del cluster](#Starting).

- [Detener el cluster](#Stopping).

- [Resincronización del cluster después de un fallo](#Synchro).

- [Corrección de los posibles problemas señalados por el Centro HFSQL control](#Problem).

- [Gestión de las bases de datos del cluster HFSQL](#AdminData).




**Observación**: La adición y la supresión de nodos a/de un cluster HFSQL se describen en [Instalación y configuración de HFSQL Cluster](../WDLang4/1000019031.md). 




|   |
| --- |
| **Atención**: <br>Se requiere un paquete específico de instalación para utilizar HFSQL Cluster. <br>Este paquete puede descargarse sin coste adicional en el sitio de PC SOFT, en la sección de descargas de módulos comunes a la versión 28. |









## Conexión con el coordinador
<a name="conexion_con_coordinador_ELTTEXTE000385"></a>
Para conectarse al coordinador a través del HFSQL control Center: 

1. Iniciar el Centro de Control HFSQL. 

2. En la ventana de inicio, haga clic en "Conectar a un clúster HFSQL".. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Administration_cluster%20-%20HC%20N%B0001.gif&type=thumb)


3. En el apartado "Nueva conexión" introduzca: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Administration_cluster%20-%20HC%20N%B0002.gif&type=thumb)


	- el Address del coordinador. 

- la contraseña para la gestión de clústeres (opcional). Esta contraseña fue elegida cuando [instalación del cluster](../WDLang4/1000019031.md). 

	- Esta contraseña debe ser especificada para gestionar los nodos del cluster. 

	- Esta contraseña no es necesaria para administrar las bases de datos del clúster.

4. Validar. Las características del clúster se muestran en el Centro HFSQL control. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Administration_cluster%20-%20HC%20N%B0004.gif&type=thumb)



**Observaciones**: 

- Para la gestión de las bases de datos se debe utilizar la opción "Conectarse a un clúster HFSQL".. Las bases de datos de clúster se gestionan como las bases de datos de HFSQL Client/Server.

- Si HFSQL control Center ya está funcionando, puede utilizar el menú desplegable para conectarse a un clúster: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Administration_cluster%20-%20HC%20N%B0003.gif)





<a name="Start"></a>


## Inicio del cluster
<a name="inicio_del_cluster_ELTTEXTE000409"></a>


### Inicio de automatic en el arranque
<a name="inicio_automatic_arranque_ELTPARAGRAPHE000075"></a>

El clúster HFSQL se inicia automáticamente al arrancar los distintos servidores del clúster.

El cluster comienza en el siguiente orden:

1. Puesta en marcha del servicio del coordinador (servicio ClusterManager).

2. Iniciar los servidores HFSQL de los diferentes nodos.

3. Conectar los nodos con el coordinador.

4. Comprobación de la sincronización de todas las bases de datos. 
	En caso de desincronización, se inicia una sincronización en los nodos cuya base de datos no se actualiza.. Si ningún nodo posee una base de datos actualizada con seguridad (por ejemplo, si el clúster fue detenido por un fallo general de alimentación), deberá elegir manualmente el nodo que se utilizará como fuente de datos para la sincronización.. Para conocer los detalles de esta Procedure, véase [Resincronización del cluster](#Synchro).

5. El clúster está a disposición de Process las solicitudes de conexión de las aplicaciones cliente.





### Arranque manual después de una parada forzada
<a name="arranque_manual_despues_una_parada_forzada_ELTPARAGRAPHE000093"></a>

Si el clúster se ha detenido voluntariamente a través de HFSQL control Center (opción "Detener clúster") o con [HClusterStop](../WDLang4/1000019058.md), puede reiniciarlo con el botón "Iniciar" de HFSQL control Center o con [HClusterStart](../WDLang4/1000019057.md).

<a name="Stopping"></a>


## Detener el cluster
<a name="detener_cluster_ELTTEXTE000439"></a>


### automatic se detiene al apagar los servidores
<a name="automatic_detiene_apagar_los_servidores_ELTPARAGRAPHE000109"></a>

Cuando un servidor que aloja un nodo de un clúster HFSQL se desactiva, el nodo se excluye automáticamente del clúster.. Su base de datos se volverá a sincronizar automáticamente cuando se reinicie el servidor.

Atención: Detener el servicio ClusterManager no detiene el cluster.


### Detener el cluster manualmente
<a name="detener_cluster_manualmente_ELTPARAGRAPHE000116"></a>

El clúster puede detenerse manualmente a través de HFSQL control Center mediante el botón "Stop" que se encuentra en la interfaz de gestión.

Se puede reiniciar como se indica en [Inicio del cluster](#Start)





## Fallo de uno o más nodos
<a name="fallo_uno_mas_nodos_ELTTEXTE000469"></a>
Varios casos pueden ocurrir cuando uno o más nodos de un Cluster HFSQL fallan (fallo de hardware, fallo del sistema operativo o problemas de red).

La siguiente tabla presenta los diferentes escenarios para un clúster de **N** nodos de los cuales **n** están activos:


| Número de nodos<br>habilitado (= *n*) | Efecto |
| --- | --- |
| n &gt; N/2 | Más de la mitad de los nodos están habilitados: el clúster funciona como de costumbre. |
| n = N/2 | Exactamente la mitad de los nodos están habilitados: el clúster funciona normalmente si el coordinador está habilitado, de lo contrario el clúster se detiene. |
| n &lt; N/2 | Menos de la mitad de los nodos están habilitados: el grupo se detiene. |


Esta regla de funcionamiento impide que el cluster se divida en dos secciones (fenómeno"split-brain") tras un fallo de la red y que cada sección siga funcionando de forma independiente y desincronice las bases de datos.. Sólo la sección que contiene más de la mitad de los nodos seguirá siendo Active. Si el grupo se divide en dos segmentos de igual tamaño, se utiliza la presencia del coordinador para decidir entre los grupos.

<a name="Synchro"></a>


## Resincronización del cluster
<a name="resincronizacion_del_cluster_ELTTEXTE000493"></a>
Una sincronización de las bases de datos se realiza cuando se inicia un cluster o cuando se añade un nodo.

Pueden presentarse dos casos:

- **TEl grupo se inicia y los nodos Active tienen una base de datos síncrona**. 
	El nuevo nodo se sincroniza automáticamente con el estado actual del resto del cluster.. No hay ninguna acción que realizar. Tan pronto como el nuevo nodo se sincroniza, se une al cluster y procesa las peticiones de conexión de las aplicaciones cliente.

- **El cluster se detiene y ningún nodo posee la versión más actualizada de la base de datos.**. 
	En la mayoría de los casos, este caso se produce después de un fallo general (fallo de alimentación, caída de la red, etc.).. En este caso, el clúster no puede reiniciarse automáticamente.. Para seleccionar uno de los nodos como fuente para la sincronización se debe utilizar HFSQL control Center. Su base de datos será usada como reference y los otros nodos serán sincronizados de acuerdo a ella.
	**Observación**: El nodo reference debe ser elegido con mucho cuidado. De hecho, las bases de datos de los otros nodos serán sobrescritos por la base de datos del nodo reference.




Observación: Durante la sincronización, en el HFSQL control Center se muestra una barra de progreso que permite seguir el avance de la sincronización (en la columna "Estado" de tabla para la gestión de nodos, por ejemplo). También tiene la posibilidad de seguir el progreso de la sincronización a través de [HClusterSincronizaciónInfo](../WDLang4/1000021974.md). [HClusterSincronizaciónErrorInfo](../WDLang4/1000021975.md) se utiliza para averiguar el último error de sincronización. 

<a name="Problem"></a>


## Corrección de los posibles problemas señalados por el Centro HFSQL control
<a name="correccion_los_posibles_problemas_senalados_por_centro_hfsql_control_ELTTEXTE000517"></a>
HFSQL control Center puede señalar una serie de problemas relativos al estado de un cluster HFSQL y puede corregir automáticamente algunos de ellos. La lista de problemas potenciales es la siguiente:


### Sin fuente de sincronización
<a name="sin_fuente_sincronizacion_ELTPARAGRAPHE000194"></a>




|   |   |
| --- | --- |
| **Problema** | Esperando una fuente de sincronización. |
| **Motivo** | Ninguno de los nodos del cúmulo incluye una base de datos para una sincronización de automatic. |
| **Resolución** | Elija un nodo reference para la sincronización.<br><br>Consulte [Resincronización del cluster](#Synchro). |




### Ninguna IP Address es associated con el nombre DNS
<a name="ninguna_address_associated_con_nombre_dns_ELTPARAGRAPHE000216"></a>




|   |   |
| --- | --- |
| **Problema** | Ninguna dirección IP es associated con el nombre DNS (&lt;nombre DNS&gt;) del clúster (&lt;nombre del clúster&gt;). |
| **Motivo** | Ninguna entrada DNS corresponde al nombre DNS elegido para el cluster. Las computadoras cliente no pueden conectarse a las bases de datos del cluster. |
| **Resolución** | Añadir una entrada DNS para la IP de cada nodo de clúster correspondiente al nombre DNS elegido para el clúster.. Esta operación puede realizarse automáticamente desde el HFSQL control Center. |




### Falta un nodo en el DNS Record del cúmulo
<a name="falta_nodo_dns_record_del_cumulo_ELTPARAGRAPHE000233"></a>




|   |   |
| --- | --- |
| **Problema** | Un nodo del clúster se instala en el equipo (&lt;Nombre del ordenador&gt;) mientras que su dirección IP (&lt;Dirección IP&gt;) no es associated con el nombre DNS del clúster (&lt;Nombre DNS&gt;). |
| **Motivo** | Uno de los nodos del cluster no está referenciado en el DNS bajo el nombre DNS elegido para el cluster.. este nodo nunca será utilizado por las aplicaciones cliente. |
| **Resolución** | Añadir una entrada DNS para la IP del nodo correspondiente al nombre DNS elegido para el cluster. Esta operación puede realizarse automáticamente desde el HFSQL control Center. |




### Una entrada DNS no corresponde a un nodo
<a name="una_entrada_dns_corresponde_nodo_ELTPARAGRAPHE000250"></a>




|   |   |
| --- | --- |
| **Problema** | El &lt;Nombre de la computadora&gt; computadora (dirección IP: &lt;dirección IP&gt;) es associated con el nombre DNS del cluster (&lt;nombre DNS&gt;) mientras que no corresponde a un nodo de este cluster. |
| **Motivo** | El DNS Record del nombre del cluster contiene un IP Address que no corresponde a un nodo. Si una aplicación cliente intenta conectarse a este Address, no recibirá ninguna respuesta y el tiempo de conexión será mayor. |
| **Resolución** | Eliminar la entrada extra de DNS. Esta operación puede realizarse automáticamente desde el HFSQL control Center. |




### El cúmulo es associated sin el nombre del DNS
<a name="cumulo_associated_sin_nombre_del_dns_ELTPARAGRAPHE000267"></a>




|   |   |
| --- | --- |
| **Problema** | No se ha introducido ningún nombre de DNS para el cluster. |
| **Motivo** | Las aplicaciones cliente no pueden conectarse al cluster. |
| **Resolución** | Elegir un nombre DNS para el cluster y asociarlo con todas las IPs de los diferentes nodos.. Esta operación puede realizarse automáticamente desde el HFSQL control Center. |



<a name="AdminData"></a>


## Gestión de las bases de datos HFSQL
<a name="gestion_las_bases_datos_hfsql_ELTTEXTE000571"></a>
El método para administrar las bases de datos de un clúster HFSQL es el mismo que el método para administrar un servidor HFSQL independiente.. Debe conectarse a la base de datos desde el HFSQL control Center.

Si la conexión a la base de datos desde el HFSQL control Center se establece utilizando el nombre DNS del cluster, esta conexión utiliza cualquier nodo del cluster (según el algoritmo de balanceo de carga).

Si la conexión a la base de datos se establece utilizando explícitamente el nombre de un nodo (ignorando el algoritmo para el equilibrio de carga), la base de datos de este nodo se ve. En este caso, tiene la posibilidad de ver la lista de usuarios conectados al nodo.

**Observaciones**

- Independientemente del método de conexión utilizado, los datos visualizados son estrictamente los mismos debido al mecanismo de replicación del cluster.

- Si el clúster está esperando una sincronización, no puede conectarse a la base de datos.

- Si un nodo está actualmente resincronizado, no puede conectarse a la base de datos de este nodo.





