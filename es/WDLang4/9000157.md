
## Vista SQL
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000219"></a>


### Definition
<a name="definition_ELTPARAGRAPHE000009"></a>

Una vista SQL es una fuente de datos virtual definida mediante una consulta SQL. Se crea en el servidor HFSQL y puede ser utilizado por las aplicaciones que acceden a la base de datos. 

La aplicación puede utilizar o manipular una vista SQL realizando una consulta en la vista SQL. Cuando se ejecuta la consulta, la vista SQL en la que se basa la consulta se vuelve a ejecutar automáticamente. Los datos utilizados están siempre actualizados. 
<a name="NOTE1_2"></a>


### ¿Cuándo debo utilizar una vista SQL?
<a name="¿cuando_debo_utilizar_una_vista_sql_ELTPARAGRAPHE000018"></a>

La utilización de una vista SQL presenta varias ventajas: 

- Independencia con respecto a la estructura física de los datos. 

- Seguridad. 




Veamos con más detalle estas ventajas: 

- **Independencia con respecto a la estructura física de los datos**: 
	La vista SQL corresponde a un nivel de abstracción entre la estructura de datos y el uso de los mismos. Si la estructura física de los datos evoluciona, las consultas SQL de la aplicación no cambian. Sólo hay que adaptar el código SQL de la vista a la nueva estructura.

- **Seguridad y derechos**
	También se puede utilizar una vista SQL con fines de confidencialidad. Algunos elementos pueden estar ocultos en la vista. 
	Ejemplo: Un expediente de personal contiene los apellidos, el nombre, Address, el número de teléfono personal y el número de la oficina. A este archivo sólo pueden acceder las personas autorizadas. 
	Puede crear una vista SQL de este archivo que contenga sólo el apellido y el número de oficina. Dado que el creador de la vista tiene derechos sobre el archivo de Personal, el contenido de la vista será accesible para los usuarios que no están autorizados a ver el archivo. Sin embargo, la información confidencial no será accesible. 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Creación de una vista SQL
<a name="creacion_una_vista_sql_ELTTEXTE000249"></a>


### Presentación
<a name="presentacion_ELTPARAGRAPHE000043"></a>

Se pueden utilizar varios métodos para crear una vista SQL: 

- Creación de la vista SQL desde la editor de análisis. En este caso, para utilizar la vista, los datos deben ser actualizados en el servidor. Esta actualización se puede realizar: 

	- a través de la modificación de datos de automatic (realizada al instalar la aplicación por ejemplo). 

	- mediante [HUpdateView](../WDLang4/1000021520.md). 




- Creación de la vista SQL mediante el comando ["CREAR VISTA"](../Editeurs/2034001.md) SQL directamente en la aplicación. 



<a name="NOTE2_2"></a>


### Creación a partir de la editor de análisis
<a name="creacion_partir_editor_analisis_ELTPARAGRAPHE000062"></a>

Para crear una vista SQL a partir de editor de análisis: 

1. Inicie la creación de la vista asistente: 

	- En la cinta de opciones, en la pestaña "Análisis", en el grupo "Creación", expanda "Nuevo" y seleccione "Ver". 

	- En el panel "Análisis", seleccione la carpeta "Vistas" y luego la opción "Nueva vista" del menú contextual. 




2. En el asistente, seleccione "Crear una vista" y luego pase a la siguiente pantalla (flecha en la parte inferior del asistente). 

3. Especifique el nombre de la vista que desea crear y seleccione el modo de edición de la consulta base para la vista.: 

	- Asistente. En este caso, la consulta de la vista se crea a través de la asistente para la creación de la consulta. La consulta se muestra gráficamente. La consulta puede ser modificada en cualquier momento a través de asistente.  

	- Código SQL. En este caso, se introduce directamente el código SQL para seleccionar los elementos seleccionados por la vista. 




4. Se crea la vista SQL. Por defecto, no es associated con una conexión. Para asociar la vista con una conexión definida en la editor de análisis: 

	- En el panel "Análisis", seleccione la vista SQL que acaba de crear. 

	- En el menú contextual (clic con el botón derecho del ratón), seleccione "description de la vista". 

	- En la ventana que se muestra, puede modificar el nombre de la vista SQL y especificar la conexión associated con la vista SQL. 

	- Validar. 




5. Generar el análisis para utilizar la vista SQL en el código de la aplicación: en la pestaña "Análisis", en el grupo "Análisis", amplíe "Generación" y seleccione "Generación". 




Observación: En una consulta de creación de una vista SQL, algunas opciones no están disponibles: 

- Las vistas SQL no están ordenadas. 

- Las vistas SQL no pueden contener parámetros. 



<a name="NOTE2_3"></a>


### Creación mediante el uso del código SQL
<a name="creacion_mediante_uso_del_codigo_sql_ELTPARAGRAPHE000091"></a>Para crear una vista SQL utilizando el código SQL, todo lo que hay que hacer es utilizar el comando CREATE VIEW en el código SQL de la consulta. Por ejemplo: 


```wl
Qry_View is Data Source


// Create view
MySQLViewCode is string
MySQLViewCode = [
	Create view Customer_View
	AS SELECT * FROM Customer
]
HExecuteSQLQuery(Qry_View, HFSQLConnection, MySQLViewCode)
```


<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Utilización de una vista SQL
<a name="utilizacion_una_vista_sql_ELTTEXTE000285"></a>


### Presentación
<a name="presentacion_ELTPARAGRAPHE000102"></a>

Para utilizar una vista SQL, todo lo que hay que hacer es crear consultas basadas en la vista SQL. Estas consultas se pueden crear: 

- a través del editor de consultas. 
	Si la vista SQL se crea en la editor de análisis, la vista aparece en la lista de elementos disponibles para crear la consulta. 

- mediante código SQL. 




Ejemplo de código SQL: 


```wl
Qry_View is Data Source

// Create view
MySQLViewCode is string
MySQLViewCode = [
	Create view Customer_View
	AS SELECT * FROM Customer
]
HExecuteSQLQuery(Qry_View, HFSQLConnection, MySQLViewCode)
```



```wl
MyQry is Data Source
MyQryCode = "SELECT Name FROM View_Customer
HExecuteSQLQuery(MyQry, HFSQLConnection, MyQryCode)
```


Observación: El parámetro **HFSQLConnection** debe ser especificado si la vista no fue creada en el editor de análisis o si la vista definida en el editor de análisis no fue associated con una conexión. 

Al igual que una consulta estándar, el resultado de la consulta basada en la vista SQL puede ser: 

- explorados por las funciones HFSQL (FOR EACH, HRead\*, ...).

- associated con un control (control Tabla, control List Box, ...). 





### Derechos sobre una vista
<a name="derechos_sobre_una_vista_ELTPARAGRAPHE000125"></a>

El acceso a las fuentes de datos referenciadas por la vista se realiza con los derechos del creador de la vista. 

El usuario de la vista tiene derechos sobre la vista. Estos derechos pueden ser configurados: 

- a través de HFSQL control Center (no disponible en esta versión). 

- mediante [HModifyViewRights](../WDLang4/1000021368.md). 




Observaciones: 

- [HInfoViewRights](../WDLang4/1000021475.md) se utiliza para conocer los derechos actuales de la vista. 

- Tiene la posibilidad de conceder derechos para crear una vista con [HModifyDatabaseRights](../WDLang4/3044326.md). 





### Modificación del contenido de una vista SQL
<a name="modificacion_del_contenido_una_vista_sql_ELTPARAGRAPHE000148"></a>

El contenido de los archivos fuente de la vista SQL puede modificarse mediante los comandos SQL: 

- INSERTAR EN

- ACTUALIZACIÓN




Para utilizar estos comandos, debe cumplir con las siguientes reglas: 

- La vista SQL debe basarse en un único archivo de datos. 

- La vista SQL no debe incluir ningún comando Unions, "Group By", aggregate, "Having" o "Distinct".. 

- Para una consulta UPDATE, sólo se pueden modificar los elementos simples (no los calculados). 

- Para una consulta INSERT: 

	- sólo se pueden añadir los elementos simples (no hay elementos calculados).

	- la vista debe exportar todos los elementos del fichero que deben tener un valor (especialmente las claves únicas distintas de los identificadores automatic). 











<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Funciones del lenguaje WL utilizadas para manipular una vista SQL
<a name="funciones_del_lenguaje_utilizadas_para_manipular_una_vista_sql_ELTTEXTE000321"></a>
Las siguientes funciones de WLanguage se utilizan para manipular las vistas SQL: 



|   |   |
| --- | --- |
| [HInfoDatabaseRights](../WDLang4/3044320.md) | Permite conocer los permisos otorgados a un usuario o grupo sobre una base de datos. |
| [HInfoViewRights](../WDLang4/1000021475.md) | Permite conocer los permisos otorgados a un usuario o grupo sobre una vista SQL o una vista materializada. |
| [HListFile](../WDLang4/3044045.md) | Devuelve la lista de archivos:<br><br>- encontrado en el análisis actual o en un análisis específico reconocido por el motor HFSQL. Los archivos definidos por [HDeclare](../WDLang4/3044203.md), [HDeclareExternal](../WDLang4/3044204.md) y [HDescribeFile](../WDLang4/3044206.md) se tienen en cuenta.<br><br>- disponible en una conexión a través de un acceso nativo o a través de un controlador OLE DB.<br><br>- para un grupo de archivos definidos en la editor de análisis.<br><br><br> |
| [HModifyDatabaseRights](../WDLang4/3044326.md) | Modifica los derechos concedidos a un usuario o a un grupo para una base de datos HFSQL Client/Server. |
| [HModifyViewRights](../WDLang4/1000021368.md) | Modifica los derechos concedidos a un usuario o a un grupo en una vista SQL o en una vista materializada. |
| [HUpdateView](../WDLang4/1000021520.md) | Crea o actualiza la descripción de una vista SQL o vista materializada del análisis a un servidor HFSQL. |






