
## Transacciones en modo HFSQL Client/Server
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000215"></a>
Para mantener la máxima compatibilidad entre las aplicaciones HFSQL Classic (monopuesto o multipuesto) y las aplicaciones HFSQL Client/Server, el mecanismo de transacción en modo HFSQL Client/Server es similar al del modo HFSQL Classic.

Esta página de ayuda presenta las diferencias entre los modos de funcionamiento.

Para más detalles sobre las transacciones, véase [Las transacciones](../WDLang4/3044335.md).

![Java](https://doc.pcsoft.fr/ext/images/us/JAVA.png) Las transacciones se pueden utilizar únicamente con los archivos de datos de HFSQL Client/Server.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Principio
<a name="principio_ELTTEXTE000245"></a>


### Principio de las transacciones en los archivos HFSQL Client/Server y en los archivos HFSQL Classic
<a name="principio_las_transacciones_los_archivos_hfsql_clientserver_los_archivos_hfsql_classic_ELTPARAGRAPHE000031"></a>

Cada operación de escritura realizada durante una transacción se almacena en un archivo de transacción.. La transacción puede ser cancelada en cualquier momento: todas las operaciones realizadas desde el inicio de la transacción se cancelarán. 

La transacción se cancela automáticamente:

- cuando se produce un error fatal en el programa (la aplicación está cerrada).

- durante la llamada a [EndProgram](../WDLang1/3013033.md).

- cuando el modo de prueba se detiene desde el editor.

- cuando se produce un corte de corriente o cuando la aplicación se apaga inesperadamente.

- cuando el cliente pierde o cierra la conexión.

- cuando se reinicia el servidor. Atención: la transacción no se cancela si se asigna una contraseña segura al archivo implicado en la transacción. La transacción será cancelada durante la próxima apertura de del archivo de datos.



**Aislamiento de las transacciones**
El motor HFSQL propone aislar las transacciones: las modificaciones realizadas en una transacción se aíslan de las modificaciones realizadas en otras transacciones que se ejecutan al mismo tiempo, hasta que la primera se confirme. 

Existen varios modos de aislamiento: 

- "READ UNCOMMITTED": Leer los datos no comprometidos (modo Default).  

- "READ COMMITTED": Lectura de datos confirmados. 

- "REPEATABLE READ": Transacciones Snapshot (instantánea)




Para obtener más información, consulte [Aislamiento de las transacciones](../WDLang4/1000017316.md). 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Gestión avanzada
<a name="gestion_avanzada_ELTTEXTE000275"></a>


### Ficheros creados por una operación
<a name="ficheros_creados_por_una_operacion_ELTPARAGRAPHE000070"></a>

Varios tipos de archivos de datos HFSQL se crean cuando se implementan las transacciones: 

- **el registro de operaciones en transacción**: Fichero en formato HFSQL que contiene las diferentes operaciones realizadas sobre los ficheros de aplicación tenidos en cuenta por la operación. Este archivo se crea con [HTransactionStart](../WDLang4/3044002.md) (o [HTransaction](../WDLang4/1000023384.md)). Se llama TRSOPERATION.TRS.

- **el registro de identificación**: Archivo que contiene la información utilizada para identificar la transacción (nombre del cliente, ordenador,...). Este archivo se llama TRSOperationInfoClient.TRS.

- **el registro de valores**: Archivo associated con cada archivo de datos que se tiene en cuenta en la transacción. Este archivo se llama &lt;FileName&gt;.TRX. Para cada operación realizada en la transacción, este fichero contiene:

	- el contenido de la Record después de la operación (durante una supresión por ejemplo).

	- el contenido de la Record después de la operación (durante una adición por ejemplo).






<a name="NOTE3_2"></a>


### Organización de archivos en el servidor
<a name="organizacion_archivos_servidor_ELTPARAGRAPHE000090"></a>


|   |   |
| --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Transactions_CS.gif) | **1. Directorio TRS**<br>Este directorio contiene:<br><br>- El registro de operaciones en transacción.<br><br>- El log de identificación<br><br>- Para cada archivo de datos en transacción de cada base de datos, el correspondiente archivo de valores. La estructura de árbol utilizada corresponde a la estructura de árbol de los archivos de datos associated con la base de datos.<br><br><br>**Por ejemplo**, si el archivo de órdenes de DataApplicationA está en transacción, el subdirectorio __TRS\\DataApplicationA contendrá el archivo Orders.TRX.<br>**Otro ejemplo**: si el archivo del cliente de DataApplicationB está en transacción, el subdirectorio __TRS\\DataApplicationB\\Customer contendrá el archivo Customer.TRX.<br>**2. Directorio de la base de datos** DataApplicationA<br>**3. Directorio de la base de datos** DataApplicationB |




<a name="NOTE3_3"></a>


### Identificador de el equipo que realiza la transacción
<a name="identificador_equipo_que_realiza_transaccion_ELTPARAGRAPHE000115"></a>

El ordenador que realiza la transacción se identifica según el mismo método en HFSQL Classic y en HFSQL Client/Server: De forma predeterminada, el equipo está identificado con un número único y el nombre del equipo (definido en Windows). 

Para identificar fácilmente a el equipo que realiza las operaciones en transacción, [HComputer](../WDLang4/3044111.md) permite definir un identificador propio de el equipo. Este identificador sustituye al nombre de el equipo. Este identificador se guarda en el registro de operaciones en transacción y puede ser consultado a través del Centro HFSQL control.

El cliente se identifica por:  

- [HComputer](../WDLang4/3044111.md) (idéntica a HFSQL Classic).

- Nombre e IP Address del ordenador. 

- Nombre de la aplicación, que es ExecutableName (ProjectName).




Esta información puede ser recuperada por [HTransactionInterrupted](../WDLang4/3044026.md) si la transacción se interrumpe. 
<a name="NOTE3_4"></a>


### Errores específicos de la gestión de las operaciones en modo HFSQL Client/Server
<a name="errores_especificos_gestion_las_operaciones_modo_hfsql_clientserver_ELTPARAGRAPHE000140"></a>

**74020: La clave de acceso del fichero de transacción no corresponde a la clave de acceso del fichero fuente.** 
El archivo de datos (en modo HFSQL Client/Server) y el archivo de transacción no utilizan la misma contraseña. 

**70032: Problema del modo de aislamiento**
Este error puede ocurrir en los siguientes casos: 

- Está intentando utilizar [HTransactionIsolation](../WDLang4/1000020926.md) en archivos de datos que no están en formato Cliente/Servidor. 

- Está intentando utilizar un modo de aislamiento mientras la transacción no se realiza en una conexión.. 

- Está intentando utilizar [HTransactionIsolation](../WDLang4/1000020926.md) cuando la transacción ya ha sido iniciada por [HTransactionStart](../WDLang4/3044002.md) (o [HTransaction](../WDLang4/1000023384.md)). 







