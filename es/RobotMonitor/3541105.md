


## Robot de monitorización: Configuración de los parámetros del robot
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000301"></a>
Desde el monitor, puedes cambiar las opciones de configuración:

- del robot,

- del contra-robot,

- del monitor.




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Configuración de los parámetros del robot
<a name="configuracion_los_parametros_del_robot_ELTTEXTE000325"></a>
Los parámetros del robot corresponden a los parámetros especificados en la asistente para configurar el robot.

**Para visualizar los parámetros del robot**: 

1. En el menú, vaya al grupo "Ajustes", seleccione "Configurar" y luego "Parámetros del robot de vigilancia".

2. Una ventana muestra las características del robot:

	- Nombre, ordenador, directorio de acceso.

	- Opciones de alerta. Estas opciones se pueden configurar para: 

		- alerta a través de WDBal,

		- alerta a través de Email,

		- alerta a través de un programa de terceros,


 Puede configurar los informes enviados a través de Email o WDBal. 




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Opciones de alerta
<a name="opciones_alerta_ELTTEXTE000349"></a>


### Alerta de WDBal
<a name="alerta_wdbal_ELTPARAGRAPHE000042"></a>

La pestaña "WDBal" se utiliza para configurar el envío de informes de error a través de la mensajería de PC SOFT denominada WDBal.. Para utilizar este modo de mensaje de alerta, la base de datos de los centros de control debe ser accesible desde la el equipo donde el robot está instalado.
<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Param_robot%20-%20HC%20N%B0001.gif)


Si la opción de envío de mensajes a través de WDBal está activada (opción "Send via WDBal enabled" marcada), este modo de alerta será utilizado por Default para todas las comprobaciones del monitor. Cada usuario puede definir parámetros específicos

La sección "Configuración de WDBal" sirve para definir el modo de acceso a los datos de los Centros control:

- En el modo de red compartida: directorio de los archivos de datos.

- En modo HFSQL Client/Server: servidor utilizado, puerto y base de datos, así como usuario y contraseña. 



<a name="NOTE3_2"></a>


### Alerta de Email
<a name="alerta_email_ELTPARAGRAPHE000062"></a>

La pestaña "Email" se utiliza para configurar el envío de informes de error por parte de Email. Para utilizar este modo de mensaje de alerta, un servidor SMTP debe ser accesible desde el equipo donde el robot está instalado.
<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Param_robot%20-%20HC%20N%B0002.gif)


Si la opción de envío de mensajes por correo electrónico está activada (opción "Send via email enabled" marcada), este modo de alerta será utilizado por Default para todas las comprobaciones del monitor. Cada usuario puede definir parámetros específicos

La sección "Configuración de Email" permite definir las características del servidor SMTP utilizado:

- Servidor y puerto SMTP. 

- Usuario y contraseña de associated para usar el servidor SMTP.

- Seguridad utilizada. 



<a name="NOTE3_3"></a>


### Usando un programa específico
<a name="usando_programa_especifico_ELTPARAGRAPHE000083"></a>

La pestaña "Otro programa" le permite: 

- configurar el error reporte para que se envíe a un programa específico. Este programa de terceros manipular los mensajes de alerta. 
	Para utilizar este modo de mensaje de alerta, especifique la ruta del ejecutable deseado. Este ejecutable debe ser accesible desde el ordenador instalación del robot. 

- especificar un Webhook. El webhook será llamado después de cada ejecución de la prueba, pasando un archivo JSON como parámetro. 
	Para utilizar un webhook, basta con especificar la URL del webhook a llamar. 



<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Param_robot%20-%20HC%20N%B0003.gif)


**Envía el error reporte a un programa de terceros**
En este modo, el error reporte es un fichero XML. La ruta del error reporte será pasada en el comando Line al programa específico y deberá ser procesada por este programa.

El formato del archivo XML es el siguiente: 

```xml
<Test>
<TestNumber>%1</TestNumber>
<TestName>%2</TestName>
<TestCategory>%3</TestCategory>
<TestPriority>%4</TestPriority>
<TestSyntax>
%5
</TestSyntax>
<TestSolution>
%6
</TestSolution>
<ErrorDate>%7</ErrorDate>
<ErrorTime>%8</ErrorTime>
<CustomErrorMessage>
%9
</CustomErrorMessage>
<ErrorMessage>
%10
</ErrorMessage>
</Test>
<Test>
...
</Test>
```

En este código:

- %1 = Número que identifica la prueba

- %2 = Nombre de la prueba

- %3 = Nombre de la categoría de prueba

- %4 = Prioridad de la prueba

- %5 = Sintaxis de la prueba (parámetros de associated)

- %6 = Solución propuesta para el ensayo

- %7 = Fecha del error

- %8 = Hora del error

- %9 = Mensaje de error especificado en el formulario de la prueba

- %1 0 = Mensaje de error devuelto por el robot




Si la opción de enviar mensajes a través de otro programa está activada (opción "Send via another program enabled" marcada), este modo de alerta será utilizado por Default para todas las comprobaciones en el monitor.

**Webhook call**
La llamada se realizará después de cada prueba ejecutada, pasando un archivo JSON como parámetro. 

El archivo JSON tiene el siguiente formato: 


```txt
{
  "RobotName": "Robot name",
  "ControlName": "Name of the check",
  "ControlCategory": "Category name",
  "Severity": "Error severity level"
  "ResponsibleList": "Supervisor",
  "FirstError": "DateTime of the first error",
  "ErrorMessage": "Error message",
  "IsError": 0/1
  "CustomError": "Custom message"
}
```


Los elementos del fichero JSON son:

- RobotName: nombre del robot de supervisión (useful si tiene varios robots en su organización y si quiere dirigirlos a todos al mismo webhook).

- NombreControl: nombre (título) del cheque.

- ControlCategory: nombre (título) de la categoría de comprobación.

- Gravedad: nivel de gravedad del control. En la versión 26, este parámetro es siempre set a "Error".

- Lista de Responsables: lista de usuarios que reciben alertas sobre esta comprobación.

- PrimerError: fecha y hora del primer error notificado. Este miembro se puede utilizar para determinar cuánto tiempo ha pasado desde que se detectó un error en una comprobación determinada.

- IsError: booleano que indica si la comprobación contiene errores.

- Mensaje de error: mensaje de error de la comprobación.

- CustomError: mensaje de error adicional (especificado en los ajustes de comprobación, desde el monitor del robot).




Observación: Si quieres hacer una llamada de webhook en WEBDEV: 

1. Crear un proyecto WEBDEV con una Página WEBDEV Active en blanco. 

2. En la página de Active WEBDEV: 

	- Declarar la estructura de exportación: 
			
		```wl
		// Export structure
		STWebHookExport is Structure
			RobotName is string
			ControlName is string
			ControlCategory is string
			Severity is string
			ResponsibleList is string
			FirstError	is DateTime
			ErrorMessage is string
			IsError is boolean
			CustomError is string
		END
		
		garrWebhookInfo is array of STWebHookExport
		```


	- Recuperar y deserializar los datos antes de utilizarlos: 
			
		```wl
		bufPOSTData is Buffer = PageParameter(paramBuffer)
		Deserialize(garrWebhookInfo,bufPOSTInfo,psdJSON)
		```









<a name="NOTE3_4"></a>


### Configurar el status reporte
<a name="configurar_status_reporte_ELTPARAGRAPHE000167"></a>La pestaña "Configuración del estado reporte" permite configurar el asunto del mensaje enviado (por Email o por WDBal).<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Param_robot%20-%20HC%20N%B0004.gif)


- La sección "Objeto de Email enviado" se utiliza para construir el título del mensaje. Las macros se utilizan para get información específica (nombre del robot, número de comprobaciones en el error, ...).

- La sección "Modo de alerta" se utiliza para elegir el modo de alerta: 

	- ** "Alerta continua" modo** (por Default): 
			Si una determinada comprobación encuentra errores varias veces en una fila (por ejemplo, si el servidor no responde durante varios minutos), el robot enviará sistemáticamente una alerta por cada error.

	- **Modo "Fallo/Reanudación"**
			Si una determinada comprobación se equivoca varias veces en una fila (por ejemplo, si el servidor no responde durante varios minutos), el robot realizará las siguientes operaciones: 
			**1.** El robot enviará una alerta cuando se detecte el primer error..
			**2.** El robot enviará alertas intermedias cada xx minutos. El tiempo de espera entre cada operación de envío se puede configurar.
			También tiene la posibilidad de no enviar ningún mensaje intermedio.
			**3.** El robot enviará un mensaje cuando la comprobación ya no sea Error( si el servidor se reinicia por ejemplo).
			**Observaciones**:

		- El modo "Fallo/Reanudación" se aplica a todos los controles (no se puede especificar para un control concreto).

		- Si este modo está habilitado y el robot monitoriza los elementos sensibles, le aconsejamos que envíe mensajes intermedios.

		- Ejemplo de progreso: 
						

| momento | Status de la verificación | Modo de alerta continua | Modo de fallo/reanudación |
| --- | --- | --- | --- |
| Tiempo T | Comprobación con errores | Envío de alertas | Envío de alertas |
| Tiempo T+1 | Comprobación con errores | Envío de alertas | No hay envío de alertas |
| Tiempo T+2 | Comprobación con errores | Envío de alertas | No hay envío de alertas |
| Tiempo T+3 | Comprobación con errores | Envío de alertas | No hay envío de alertas |
| Tiempo T+4 | Comprobación con errores | Envío de alertas | No hay envío de alertas |
| Tiempo T+5 | Verificación correcta | No hay envío de alertas | Envío de alertas |








