
## Lección 4.7. Consumir un Webservice
<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Esta lección abarcará los siguientes temas
<a name="esta_leccion_abarcara_los_siguientes_temas_ELTTEXTE000238"></a>


- Presentación.

- Importar y consumir un Webservice.

- Consumir un Webservice REST.





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=dur%E9e.png)<br> | <br>Tiempo estimado: 10 min |



| [Lección anterior](../TutoWM/1410087581.md) | [Tabla de contenido](../TutoWM/1410087586.md) | [Siguiente lección](../TutoWM/1410087576.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000285"></a>
En la mayoría de los casos, un Webservice es una aplicación a la que se puede acceder a través de protocolos estándar de Internet. Los servicios Web permiten que varios equipos conectados a través de Internet interactúen entre sí.

A través de los servicios Web, se pueden ejecutar procedimientos y procesos en un servidor Web remoto (.NET, SOAP o J2EE) desde un equipo cliente.

Con WINDEV Mobile, estos servicios Web pueden utilizarse como cliente, a través del protocolo SOAP en HTTP (el protocolo estándar de Internet para la transferencia de páginas HTML) y con las funciones SOAPxx, DotNetxx y J2EExx.

Independientemente de la plataforma del servidor Web (.NET, J2EE, etc.), se puede acceder a un servicio Web mediante el protocolo SOAP.|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Con WINDEV Mobile, no es necesario ser un experto. <br>¡Un asistente se encarga de "casi" todo! |




<a name="NOTE2_2"></a>


### Ejemplo práctico
<a name="ejemplo_practico_ELTPARAGRAPHE000041"></a>

Un Webservice específico de este tutorial le permitirá probar las diferentes operaciones que se pueden realizar en un Webservice.

Al integrar el Webservice en el proyecto "WM Product Management", se puede consultar una base de datos de proveedores para comprobar si un producto está disponible utilizando su referencia.

Primero, importaremos el Webservice en el proyecto "WM Product Management", y luego lo utilizaremos en la aplicación para comprobar la disponibilidad del producto a través de una ficha de producto.

- Para seguir esta lección, abra el proyecto "WM Product Management" en el que trabajó en la lección anterior.

	1. Vaya a la página de inicio de WINDEV Mobile (Ctrl + &lt;).  

	2. En la página de inicio, haga clic en "Tutorial", luego en "Part 4 - Development of an Android/iOS application", haga doble clic en "Android/iOS product management - Exercise".

	3. Un cuadro de diálogo le pide que abra el proyecto en el que trabajó en la lección anterior. Puede abrir la copia local o el proyecto original. Seleccione "Abrir la copia local". 
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WM.png) | Corregido | Hay un proyecto completado disponible. Este proyecto contiene las ventanas que crearemos en esta lección. Para abrir el proyecto completado, vaya a la página de inicio y haga clic en "Tutorial", luego en "Part 4 - Development of an Android/iOS application", haga doble clic en "Android/iOS product management - Answers". |











<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Importar un Webservice
<a name="importar_webservice_ELTTEXTE000351"></a>


- Para importar un Webservice al proyecto:

	1. En la pestaña "Proyecto", en el grupo "Proyecto", despliegue "Importar" y seleccione "Un Webservice".

	2. El asistente de importación se abre automáticamente. Pase a la etapa siguiente.

	3. Especifique la dirección a la que debe importarse la descripción WSDL del Webservice: 
			
		```txt
		https://examples.webdev.info/WSTUTORIALV2_WEB/awws/WSTutorialV2.awws?wsdl
		```

			Recordatorio: El Webservice permite consultar la base de datos de un proveedor para comprobar las existencias de un producto utilizando su referencia.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_MP%20-%20Consommation%20WS%20-%20HC%20N%B0001.jpg&type=thumb)


	4. Pase a la etapa siguiente. El Webservice se ha importado correctamente.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_MP%20-%20Consommation%20WS%20-%20HC%20N%B0002.jpg&type=thumb)




Veamos más de cerca los elementos que se muestran en el panel "Explorador de proyectos": <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_MP%20-%20Consommation%20WS%20-%20HC%20N%B0003.jpg)
La estructura contiene:

- el nombre del Webservice (WSTutorialV2, en este ejemplo),

- el nombre de cada función (ProductInStock, en este ejemplo).




Para ver la sintaxis de llamada del Webservice, haga doble clic en el nombre de la función en el panel "Explorador de proyectos". El editor de código muestra la descripción de la función, con el prototipo para llamar a la función:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_MP%20-%20Consommation%20WS%20-%20HC%20N%B0004.jpg&type=thumb)


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Consumir un Webservice
<a name="consumir_webservice_ELTTEXTE000375"></a>
En nuestro ejemplo "WM Product Management", integraremos la llamada al Webservice en la ventana interna que muestra los detalles del producto. Vamos a crear un botón "Stock" para comprobar la disponibilidad del producto a través del Webservice.



- Para utilizar el Webservice:

	1. Abra la ventana interna "IW_Product" en el editor (haga doble clic en ella en el panel "Explorador de proyectos").

	2. Reduzca el ancho del control "Reorder". 

	3. Elimine el control "Quantity". 

	4. Agregue un control Botón:

		- En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Bouton_WM_GAF.jpg).

		- Haga clic en la ventana junto al control "Reorder.".

		- El control se crea automáticamente.




5. Modifique las características del control (seleccione "Descripción" en el menú contextual). Defina "BTN_Stock" como nombre y "Stock" como título.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_MP%20-%20Consommation%20WS%20-%20HC%20N%B0005.jpg)




- Vamos a probar el Webservice:

	1. Abra la ventana WIN_Advanced_LIST_Products (pulse CTRL + E, por ejemplo). 

	2. Pruebe la ventana (haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_GO_Fen_WM_GAF.jpg) en los botones de acceso rápido).

	3. Haga doble clic en un producto: la ficha del producto se abre. 

	4. Haga clic en "Stock".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_MP%20-%20Consommation%20WS%20-%20HC%20N%B0006.jpg&type=thumb)


	5. Valide la ventana de información y cierre el simulador. 




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Consumir un Webservice REST
<a name="consumir_webservice_rest_ELTTEXTE000399"></a>
En nuestro ejemplo, consumimos un Webservice SOAP. Ahora vamos a consumir un Webservice REST. En este caso, no es necesario importar el Webservice a la aplicación. Solo necesita llamar al procedimiento del Webservice deseado. 

En nuestro ejemplo, hemos implementado un Webservice REST que realiza el mismo proceso que el Webservice SOAP utilizado anteriormente. Este Webservice REST puede utilizarse para obtener información sobre las existencias del producto especificado utilizando la siguiente dirección: 

```txt
https://examples.webdev.info/product/<Product reference>
```






- Veamos cómo utilizar el Webservice REST en nuestro ejemplo. 

	1. Vuelva al editor y abra el código del control BTN_Stock. 

	2. Defina el código existente como comentario (seleccione las líneas de código y pulse Ctrl + //). 

	3. Escriba el siguiente código: 
			
		```wl
		// Display REST Webservice response
		h is httpRequest
		h.Method = httpGet
		h.URL = "https://examples.webdev.info/product/" + EDT_Reference
		h.ContentType = "application/json"
		
		r is restResponse = RESTSend(h)
		Content is ANSI string
		
		IF r.StatusCode = 200 THEN // Request successfully completed
			Content = r.Content
			Info(Content)
		ELSE
			Info("An error has occurred " +  ErrorInfo() + r.StatusCode + r.DescriptionStatusCode)
		END
		```
Este código permite: 

		- Declarar una variable de tipo [httpRequest](../WDLang3/1000021158.md). Esta variable define los parámetros de la consulta enviada al Webservice REST. Las propiedades de esta variable son: 

			- El método utilizado: GET en este caso. 

			- La URL de llamada al Webservice: en este caso, la URL que presentamos anteriormente. En este ejemplo, la referencia del producto corresponde al valor del control EDT_Reference.

			- El tipo de contenido del mensaje HTTP que se enviará al servidor. En este caso, el mensaje está en formato JSON. 




- Enviar la solicitud al servidor y obtener la respuesta utilizando la función [RESTSend](../WDLang3/1000021476.md). La respuesta es una variable de tipo [restResponse](../WDLang3/1000021477.md). 

- Definir el formato de la respuesta. 

4. Cierre el editor de código y guarde la ventana (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WM_GAF.jpg) o Ctrl + S).




- Vamos a probar el Webservice:

	1. Si es necesario, abra la ventana WIN_Advanced_LIST_Products (pulse CTRL + E, por ejemplo). 

	2. Pruebe la ventana (haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_GO_Fen_WM_GAF.jpg) en los botones de acceso rápido).

	3. Haga doble clic en un producto: la ficha del producto se abre. 

	4. Haga clic en "Stock". 

	5. Valide la ventana de información y cierre el simulador. 







| [Lección anterior](../TutoWM/1410087581.md) | [Tabla de contenido](../TutoWM/1410087586.md) | [Siguiente lección](../TutoWM/1410087576.md) |
| --- | --- | --- |




