
## Gestionar los semáforos en subprocesos: limitar la ejecución simultánea de un código
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000206"></a>
Los semáforos limitan la ejecución simultánea de un código (procedimiento, línea de código, etc.) a uno o más subprocesos en un momento dado. Un semáforo se puede compartir entre varias aplicaciones.

Por ejemplo: Dos subprocesos específicos se utilizan en una aplicación bancaria:

- un subproceso para depositar fondos en una cuenta

- un subproceso para retirar fondos de una cuenta.


En un momento dado, solo puede haber un depósito o retiro.



**Observación**: Existen otros sistemas que permiten proteger una sección de código: 

- Las exclusiones mutuas (Mutex) limitan la ejecución simultánea de un código (procedimiento, línea de código, etc.) **a un solo subproceso** en un momento dado. Un Mutex se puede compartir entre varias aplicaciones. Para obtener más información, consulte [Gestionar la exclusión mutua en subprocesos](../WDLang1/1000019475.md).

- Las secciones críticas limitan la ejecución simultánea de un código (procedimiento, línea de código, etc.) **a un subproceso** en un momento dado en una sola aplicación. Para obtener más información, consulte [Gestionar secciones críticas](../WDLang1/1000021292.md). 






<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Principio
<a name="principio_ELTTEXTE000230"></a>
El semáforo se crea con la función [SemaphoreCreate](../WDLang1/3077012.md).

1. El subproceso n°1 ejecuta la función [SemaphoreStart](../WDLang1/3077008.md): no hay ningún subproceso en el semáforo.

2. El subproceso n°1 ejecuta la sección de código protegida por el semáforo.

3. Mientras que el subproceso n°1 ejecuta el código protegido por el semáforo, el subproceso n°2 ejecuta la función [SemaphoreStart](../WDLang1/3077008.md): dado que el hilo n°1 está ejecutando el código protegido por el semáforo, el hilo n°2 debe esperar a que se libere el semáforo.

4. El subproceso n°1 ejecuta la función [SemaphoreEnd](../WDLang1/3077010.md): ningún subproceso ejecuta el código del semáforo.

5. El subproceso n°2 puede ejecutar el código protegido por el semáforo.

6. El subproceso n°2 ejecuta la función [SemaphoreEnd](../WDLang1/3077010.md): ningún subproceso ejecuta el código del semáforo.



<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=semaphore.gif)


<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## ¿Cómo implementar un semáforo?
<a name="¿como_implementar_semaforo_ELTTEXTE000254"></a>


### Etapas:
<a name="etapas_ELTPARAGRAPHE000094"></a>

Las etapas para implementar un semáforo son las siguientes:

1. Crear un semáforo con la función [SemaphoreCreate](../WDLang1/3077012.md). El semáforo se asocia a un nombre.

2. Llamar a la función [SemaphoreStart](../WDLang1/3077008.md) antes de la sección de código que se va a proteger.

3. Llamar a la función [SemaphoreEnd](../WDLang1/3077010.md) para delimitar la sección de código que se va a proteger. Las líneas de código que se encuentran después de [SemaphoreEnd](../WDLang1/3077010.md) no se protegerán.

4. Destruir el semáforo con la función [SemaphoreDestroy](../WDLang1/3077011.md).



<a name="NOTE3_2"></a>


### Observaciones
<a name="observaciones_ELTPARAGRAPHE000121"></a>

- Las secciones de código protegidas por un semáforo deben ser lo más cortas posible y tratar solo los procesos "críticos".

- Se puede utilizar un semáforo con el mismo nombre para proteger varias secciones de código. Solo un subproceso puede estar en una de las áreas protegidas por el semáforo en un momento dado.

- Cuando hay un subproceso en espera, no se utilizan los recursos del procesador.

- Los semáforos se utilizan tanto en el subproceso principal con en los secundarios (creados con la función [ThreadExecute](../WDLang1/3077024.md)). Se debe evitar bloquear el subproceso principal. Si se bloquea el subproceso principal (en espera), no se puede ejecutar la aplicación.

- Las funciones [SemaphoreStart](../WDLang1/3077008.md) y [SemaphoreEnd](../WDLang1/3077010.md) deben utilizarse en el mismo proceso (en un procedimiento, por ejemplo).

- Los semáforos se pueden compartir o no entre las diferentes aplicaciones que se ejecutan en el equipo. Al crear los semáforos, especifique cómo se compartirán (función [SemaphoreCreate](../WDLang1/3077012.md)).




![Java](https://doc.pcsoft.fr/ext/images/us/JAVA.png) En Java, los semáforos son únicos para la aplicación que los creó. No se pueden compartir entre varias aplicaciones.
<a name="NOTE3_3"></a>


### Funciones de gestión de semáforos
<a name="funciones_gestion_semaforos_ELTPARAGRAPHE000149"></a>Las siguientes funciones WLanguage permiten gestionar los semáforos:



|   |   |
| --- | --- |
| [SemaphoreCreate](../WDLang1/3077012.md) | Crea un semáforo. |
| [SemaphoreDestroy](../WDLang1/3077011.md) | Destruye explícitamente un semáforo. |
| [SemaphoreEnd](../WDLang1/3077010.md) | Permite que uno o más hilos salgan del área protegida por el semáforo. |
| [SemaphoreStart](../WDLang1/3077008.md) | Cierra la actual Thread hasta que se abra el semáforo (es decir, hasta que se disponga de un espacio "libre" en la sección protegida). |




<a name="NOTE3_4"></a>


### Ejemplo
<a name="ejemplo_ELTPARAGRAPHE000157"></a>

Para hacer una asignación compartida entre varios subprocesos, se debe encapsular en un semáforo la asignación de las variables y la lectura de estas mismas.


