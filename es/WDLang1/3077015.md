
## Abrir una ventana desde un hilo secundario
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000128"></a>
Un hilo secundario no puede abrir directamente una ventana con las funciones estándar de WLanguage como: [Open](../WDLang1/3038035.md), [Use](../WDLang1/3038044.md), etc.

Sin embargo, es posible que necesite abrir una ventana a partir de un hilo secundario. Por ejemplo, si se utiliza un hilo para gestionar las llamadas entrantes, cuando se detecta la llamada, se puede abrir una ventana con las características de la persona que llama.

La solución consiste en abrir la ventana desde un código ejecutado por el hilo principal. 

Se pueden utilizar los siguientes métodos para ejecutar el código del hilo principal desde un hilo secundario:

- Ejecutar un procedimiento global del proyecto o un procedimiento local de una ventana con la función [ExecuteMainThread](../WDLang1/1000019862.md),

- Ejecutar el evento "Solicitud para actualizar la visualización" de una ventana con la función [RequestUpdateUI](../WDLang1/1000021378.md),

- Establecer un diálogo a través de mensajes entre hilos (funciones [PostMessage](../WDLang1/3015001.md) y [Event](../Proprietes/1000017990.md)). 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Abrir una ventana desde un hilo secundario a través de un diálogo de mensajes
<a name="abrir_una_ventana_desde_hilo_secundario_traves_dialogo_mensajes_ELTTEXTE000152"></a>


### Principio
<a name="principio_ELTPARAGRAPHE000046"></a>

Para abrir una ventana desde un hilo secundario:

1. Cuando el hilo secundario quiere abrir una ventana, envía un mensaje al hilo principal con la función [PostMessage](../WDLang1/3015001.md). Este mensaje indica al hilo principal la ventana que debe abrirse, así como los parámetros necesarios para abrirla.

2. El hilo principal utiliza un evento específico, que corresponde a la solicitud para abrir una ventana. Cuando se produce este evento, el procedimiento WLanguage abre la ventana (con la función [Open](../WDLang1/3038035.md), por ejemplo) con los parámetros especificados.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Ejemplo
<a name="ejemplo_ELTTEXTE000176"></a>


### El método mencionado anteriormente se utiliza en el ejemplo WD Instant messaging.
<a name="metodo_mencionado_anteriormente_utiliza_ejemplo_instant_messaging_ELTPARAGRAPHE000064"></a>

El código de apertura de la ventana principal permite:

- implementar un evento para gestionar la apertura de la ventana en el hilo principal.

- ejecutar los hilos secundarios.





```wl
// Implement an event 
// to manage the opening of the "chat" window
gnEventID = Event("ChatOpening", "*.*", "ChatStart")
IF gnEventID = 0 THEN
	// Error when implementing 
	// the event used to manage the "chat" window
	Error("Unable to manage the window for chat opening", ErrorInfo())
	// The application cannot operate without this event
	EndProgram()
END

// Listen to the requests for connection and for presence tests
ThreadExecute("ThreadPresence", threadNormal, "ListenPresenceRequest")
ThreadExecute("ThreadRequest", threadNormal, "ListenConnectionRequest")
```


Por ejemplo, la ventana se abre en el código del procedimiento ***EscucharSolicitudInicioMensaje***. Este procedimiento se ejecuta en un hilo. El código utilizado para abrir la ventana desde el hilo es el siguiente:


```wl
// Ask to open the "chat" window 
PostMessage(Handle(WIN_Main),"ChatStart", FILE_CONTACT.CONTACTID, FILE_CONTACT.CONTACTID)
```


El mensaje "IniciarChat" se envía a la ventana principal (identificada por su Handle). Este mensaje contiene los parámetros que se deben pasar a la ventana. El mensaje es manipulado por el evento definido en el código de apertura de la ventana. Cuando se recibe el mensaje, el procedimiento "AbrirChat" se ejecuta automáticamente. Este procedimiento abre la ventana.

El código del procedimiento es el siguiente: 


```wl
PROCEDURE ChatOpening(nParam,nContact)
OpenSister(WIN_Message, nContact)
```



