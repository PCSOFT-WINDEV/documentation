
## Lección 3.2. Sitio de Intranet con datos: Páginas de adición y modificación


<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Esta lección abarcará los siguientes temas
<a name="esta_leccion_abarcara_los_siguientes_temas_ELTTEXTE000935"></a>


- Crear una página en modo Sesión para mostrar una lista de productos.

- Crear una página de ficha de producto en modo Sesión.

- Agregar y modificar productos.





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=dur%E9e.png)<br> | <br>Tiempo estimado: 50 min |

| [Lección anterior](../TutoWB/1410087488.md) | [Tabla de contenido](../TutoWB/1410087510.md) | [Siguiente lección](../TutoWB/1410087491.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000982"></a>
Vamos a crear las diferentes páginas del sitio WEBDEV en modo Sesión para mostrar, agregar y modificar productos. Esto le permitirá entender:

- cómo utilizar WEBDEV para crear páginas en modo Sesión,

- cómo acceder a la base de datos.


También podrá utilizar algunas funcionalidades prácticas de WEBDEV.



- Abra el ejemplo de formación "Full WEBDEV Site":

	1. Inicie WEBDEV si es necesario. 

	2. Vaya a la página de inicio de WEBDEV (Ctrl +&lt;).

	3. En la página de inicio, haga clic en "Tutorial", luego en "Parts 3 to 6", haga doble clic en "Full WEBDEV Site - Exercise".
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WB.png) | Corregido | Hay un proyecto completado disponible. Este proyecto contiene las diferentes páginas creadas en esta lección. Para abrir el proyecto completado, vaya a la página de inicio y haga clic en "Tutorial", luego en "Parts 3 to 6", haga doble clic en "Full WEBDEV Site - Answers". |











<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Crear una página en modo Sesión para mostrar una lista de productos
<a name="crear_una_pagina_modo_sesion_para_mostrar_una_lista_productos_ELTTEXTE001024"></a>
Para crear la página que mostrará la lista de productos, vamos a crear una página en blanco, y luego agregaremos los controles: esto nos permitirá ver todos los pasos necesarios para crear este tipo de página.
<a name="NOTE3_2"></a>


### Crear una página con un modelo
<a name="crear_una_pagina_con_modelo_ELTPARAGRAPHE000054"></a>

- Para crear una página en blanco:

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Cr%E9er_WB_GAF.jpg) en los botones de acceso rápido (o presione Ctrl + N).

	2. La ventana de creación de nuevos elementos se abre: haga clic en "Página", y luego en "Página".

	3. El asistente de creación de páginas se abre. 

	4. Seleccione el modelo predefinido "Menú".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0002.jpg&type=thumb)

			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Un modelo de páginas permite agrupar una parte de la interfaz y diferentes procesos en un solo elemento.<br><br>Se recomienda utilizar modelos de páginas para obtener una interfaz coherente y fácil de reutilizar. |





	5. Asegúrese de que la opción "Crear: una página y el modelo" (en la parte inferior de la ventana) esté seleccionada.

	6. Valide el asistente ("OK").

	7. La nueva página aparece en el editor.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Al validar el asistente de creación de páginas, WEBDEV crea automáticamente:<br><br>		- la página que se mostrará en el navegador. Esta página se muestra inmediatamente en el editor y se puede modificar.<br><br>		- el modelo de páginas asociado, que corresponde al modelo predefinido que elegimos anteriormente. Puede hacer cambios en el modelo de páginas. Veremos cómo hacerlo más adelante en esta lección.<br><br><br> |





	8. La ventana para guardar la página se abre. Introduzca "List of products" en el título de la página. El nombre de la página "PAGE_List_of_products" se completa automáticamente.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0003.jpg)


	9. Valide.




- Esta página contiene diferentes controles en un diseño predefinido. En este caso, eliminaremos estos controles:

	1. Seleccione los controles de la página (presione Ctrl + A).
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | En el editor, solo se puede acceder a los controles de la página. Los controles y eventos del modelo no se pueden editar. Todos los controles de la página (incluidos los controles del modelo) se seleccionan presionando Ctrl + A. Sin embargo, los controles del modelo de páginas no se pueden modificar. |





	2. Elimine los controles (tecla Supr).

	3. Solo los controles del modelo de páginas permanecen en la página.

	4. Guarde los cambios realizados en la página: haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) en los botones de acceso rápido (o presione Ctrl + S).






<a name="NOTE3_3"></a>


### Crear controles
<a name="crear_controles_ELTPARAGRAPHE000101"></a>

Vamos a insertar un control Looper para crear la lista de productos. Este control estará vinculado al archivo de datos "Product".|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | **¿Qué es un control Looper?**<br><br>Un control Looper muestra una lista de elementos en una página Web. Un control Looper incluye una serie de filas que pueden contener varios controles y repetirse un número determinado de veces.<br><br>Cada fila puede contener datos diferentes. |






- Para crear el control Looper:

	1. En la pestaña "Creación", en el grupo "Datos", despliegue "Looper" y seleccione "Looper".

	2. Haga clic en la esquina superior izquierda de la página, justo debajo del menú: el asistente de creación del control Looper se abre.

	3. El asistente pregunta cómo se va a rellenar el control Looper:

		- de un archivo de datos o consulta,

		- de una variable WLanguage,

		- mediante programación (veremos esta opción en otra lección).


 En este caso, el control Looper mostrará todos los productos: seleccione "Mostrar datos provenientes de un archivo o consulta".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0004.jpg&type=thumb)




- Vamos a cambiar la posición del control en la página:

	1. Seleccione el control.

	2. Mueva el control al área superior izquierda de la página. Cuando el control alcanza el borde del área de visualización del modelo de páginas, se muestran líneas verdes: estas líneas le ayudan a posicionar el control dentro del área de visualización.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0009.jpg&type=thumb)


	3. Si es necesario, reduzca: 

	- el tamaño de las columnas para que todo el control se ajuste a la página. 

	- el tamaño de los controles en las columnas para que se ajusten a ellas. 


Veamos con detenimiento el control Looper que acabamos de crear: los datos ya se muestran en el control, incluso en el editor. 

**Este concepto es conocido como "Live data"**: el contenido de los archivos de datos ubicados en el equipo de desarrollo se utiliza en las páginas o reportes manipulados en el editor. Esta funcionalidad es útil para definir el tamaño de los controles en una página, por ejemplo.



- Vamos a ocultar el control que contiene el identificador del producto. ¿Por qué ocultarlo en lugar de eliminarlo? Porque este identificador nos va a servir en el resto de nuestro proyecto de desarrollo.

	1. Seleccione el control STC_ProductID". Este control contiene el identificador (control con un número en la parte superior del Looper).

	2. Abra la ventana de descripción del control (seleccione "Descripción" en el menú contextual).

	3. En la pestaña "UI", deseleccione la opción "Visible".

	4. Valide la ventana de descripción del control.







- Vamos a modificar el menú de la página para incluir una opción que permita mostrar la lista de productos. El menú se encuentra en el modelo de páginas. Por lo tanto, vamos a modificar el modelo de páginas.

	1. Abra el menú contextual del menú de la página PAGE_List_of_products (haga clic derecho en "HOME", por ejemplo) y seleccione "Abrir modelo".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0010.jpg)


	2. El modelo de páginas aparece en el editor. Seleccione el menú del modelo de páginas.

3. Haga clic derecho para abrir el menú contextual y seleccione "Editar menú". Un contorno amarillo aparece alrededor del menú. Este contorno indica que el menú está en modo de edición: se puede modificar.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0011.jpg&type=thumb)




- Para actualizar las páginas que utilizan el modelo:

	1. En la barra del modelo, haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0011%201.jpg): este botón aplica los cambios realizados en el modelo a todas las páginas que lo utilizan.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Si no aplica los cambios a las páginas, se le pedirá que sincronice los modelos antes de probar o implementar una página. |





	2. En nuestro caso, solo se propone una página.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0012.jpg&type=thumb)


	3. Valide la ventana de actualización del modelo (botón "OK"). 

4. Cierre el modelo de páginas.




- En el modelo de páginas "Menú" que estamos utilizando, la opción "ITEMS" (artículos) está seleccionada: esta opción de menú aparece en azul. Sin embargo, la página que acabamos de crear muestra la lista de productos. Necesitamos establecer "LIST OF PRODUCTS" como la opción seleccionada de forma predeterminada. 
	Para ello, vamos a sobrescribir la opción de menú del modelo de páginas y cambiar la opción de menú seleccionada. Para hacer este cambio, vamos a sobrescribir el menú, y luego la opción de menú deseada. 




- Realice las siguientes acciones: 

	1. Abra el menú contextual del menú (haga clic derecho en "LIST OF PRODUCTS", por ejemplo) y seleccione "Sobrescribir control". 

	2. Abra de nuevo el menú contextual del menú y seleccione "Editar menú". El menú pasa al modo de edición: un contorno amarillo aparece alrededor del menú. 

	3. Abra el menú contextual de "LIST OF PRODUCTS" y seleccione "Sobrescribir control". 

	4. Abra el menú contextual de "LIST OF PRODUCTS" y seleccione "Poner esta opción de menú en el estado seleccionado". 

	5. Presione Esc para salir del modo de edición. 

	6. Guarde la página (Ctrl + S). 







La página está lista para ser probada.
<a name="NOTE3_4"></a>


### Prueba de la página
<a name="prueba_pagina_ELTPARAGRAPHE000254"></a>

- Vamos a probar la página que acabamos de crear.

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido.

	2. La página se muestra automáticamente en el navegador.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Liste%20produits%20-%20HC%20N%B0013.jpg&type=thumb)


	3. Puede desplazarse por los productos con la barra de desplazamiento de la página.




- Cierre el navegador. El editor de WEBDEV aparece de nuevo.




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Modificar los productos utilizando una página de ficha de producto en modo Sesión
<a name="modificar_los_productos_utilizando_una_pagina_ficha_producto_modo_sesion_ELTTEXTE001174"></a>
Ahora que tenemos la lista de productos, vamos a ver cómo modificar uno. Crearemos una página para ver y editar los detalles del producto.
<a name="NOTE4_2"></a>


### Crear la página
<a name="crear_pagina_ELTPARAGRAPHE000277"></a>

- Para crear la página que muestra los detalles del producto:

	1. Cree una nueva página en blanco.

		- Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Cr%E9er_WB_GAF.jpg) en los botones de acceso rápido.

		- La ventana de creación de nuevos elementos se abre: haga clic en "Página", y luego en "Página".

		- El asistente de creación de páginas se abre automáticamente. 

		- En la sección "Basado en un modelo del proyecto", elija "PAGETPL_Menu" y valide el asistente.




2. La ventana para guardar la página se abre. Introduzca el título de la página: "Product form". El nombre de la página "PAGE_Product_form" se completa automáticamente. 

3. Valide.



<a name="NOTE4_3"></a>


### ¿Cuál es la función de esta página?
<a name="¿cual_funcion_esta_pagina_ELTPARAGRAPHE000295"></a>

En esta página, los usuarios podrán editar las características del producto seleccionado en el control Looper. Este tipo de página se llama "Ficha" porque corresponde a una ficha descriptiva del elemento deseado.

En nuestro caso, esta página mostrará el contenido de los diferentes campos del archivo de datos "Product".

En primer lugar, tenemos que indicar qué producto se mostrará. Para ello, simplemente declare un parámetro en la página.

- Para declarar un parámetro en la página:

	1. Presione F2. El editor de código muestra los diferentes eventos de la página.

	2. En el evento "Declaraciones globales", reemplace el código existente por el siguiente código WLanguage:
			
		```wl
		PROCEDURE MyPage(NumProductToDisplay is 8-byte int)
		```


	3. Analicemos este código WLanguage:

		- La palabra clave PROCEDURE del evento "Declaraciones globales" permite asociar un procedimiento a la apertura de la página.

		- El nombre del procedimiento es "MyPage". En tiempo de ejecución, esta palabra clave será reemplazada automáticamente por el nombre de la página actual. 

		- El procedimiento espera la variable **NumProductToDisplay** (entero de 8 bytes) como parámetro. Esta variable corresponde al identificador del producto que se mostrará en la página. Esta variable es del mismo tipo que el campo ProductID correspondiente descrito en el archivo de datos Product.




4. Cierre el editor de código.



<a name="NOTE4_4"></a>


### Crear controles Campo de entrada
<a name="crear_controles_campo_entrada_ELTPARAGRAPHE000319"></a>

Vamos a crear los controles Campo de entrada que mostrarán la información del producto seleccionado.



- Para crear los controles en la página:

	1. Abra el panel "Análisis" si es necesario: en la cinta de opciones, en la pestaña "Inicio", en el grupo "Entorno", despliegue "Paneles", haga clic en "Paneles" y seleccione "Análisis". Los diferentes archivos de datos definidos en el análisis "Full_WEBDEV_Site" se muestran en el panel.

	2. Haga clic en la flecha a la izquierda del archivo de datos "Product": los campos del archivo de datos aparecen.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%201%20%20-%20HC%20N%B0001.jpg)


	3. Seleccione todos los campos que se muestran en el panel (excepto "ProductID"). Puede seleccionar varios elementos manteniendo pulsada la tecla Ctrl.

4. Arrastre los campos y suéltelos en la página que creó anteriormente.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%201%20%20-%20HC%20N%B0002.jpg&type=thumb)




- Mueva los controles en la página para obtener la siguiente UI:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%201%20%20-%20HC%20N%B0004.jpg&type=thumb)





- Amplíe el control Imagen que muestra la imagen asociada al producto.




- Vamos a alinear los controles Campo de entrada y a establecer un mismo tamaño:

	1. Seleccione el control "Caption" y luego, seleccione todos los controles Campo de entrada de la página (mantenga pulsada la tecla Ctrl y haga clic en los controles). El primer control seleccionado se utilizará como referencia para establecer el tamaño de los otros controles.

	2. Vaya a la pestaña "Alineación" del menú de WEBDEV. Esta pestaña contiene todas las opciones de alineación disponibles para los controles.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%201%20%20-%20HC%20N%B0005.jpg&type=thumb)


	3. Vamos a alinear los bordes externos e internos de los controles. Haga clic en la opción "Justificar (Int. y Ext.)".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%201%20%20-%20HC%20N%B0006.jpg&type=thumb)



<a name="NOTE4_5"></a>


### Mostrar datos en la página
<a name="mostrar_datos_pagina_ELTPARAGRAPHE000372"></a>

La página de la ficha de producto mostrará el producto seleccionado en el control Looper. En los eventos WLanguage de la página, vamos a escribir el código para:

- buscar el producto que se mostrará.

- mostrar datos en la página.




- Para buscar datos y mostrarlos en la página:

	1. Haga clic en la página en el editor. 

	2. Presione F2. El editor de código muestra los diferentes eventos de la página.

	3. En el evento "Declaraciones globales", escriba el siguiente código debajo del código escrito anteriormente:
			
		```wl
		Product.ReadSeekFirst(ProductID, NumProductToDisplay)
		IF Product.Found() = False THEN
			// Display the list of products
			PAGE_List_of_products.Display()
		END
		Product.ToPage()
		```


	4. Analicemos este código WLanguage:

		- La función [&lt;Archivo de datos&gt;.ReadSeekFirst](../WDLang4/1000025034.md) busca el primer registro del archivo de datos Product cuyo campo ProductID sea igual al valor de NumProductToDisplay. NumProductToDisplay corresponde al parámetro pasado a la página.

		- La función [&lt;Archivo de datos&gt;.Found](../WDLang4/1000025076.md) comprueba si se encontró un registro. Esta función se utiliza principalmente en sitios a los que acceden varios usuarios. Permite evitar errores causados por otros usuarios (registros eliminados, etc.). En este caso, si no se encuentra el registro ([&lt;Archivo de datos&gt;.Found](../WDLang4/1000025076.md) devuelve False), se vuelve a mostrar la lista de productos.

		- La función [&lt;Fuente&gt;.ToPage](../WDLang4/1000021401.md) obtiene los datos del registro actual en el archivo de datos y los muestra en los controles de la página. En nuestro caso, el registro actual corresponde al registro encontrado con la función [&lt;Archivo de datos&gt;.ReadSeekFirst](../WDLang4/1000025034.md).




5. Cierre el editor de código.



<a name="NOTE4_6"></a>


### Crear controles Botón
<a name="crear_controles_boton_ELTPARAGRAPHE000411"></a>

La página "PAGE_Product_form" le permitirá modificar un producto de la lista de productos.

Vamos a agregar dos controles Botón: un botón de cancelación y un botón de validación. 

- El botón de cancelación simplemente volverá a mostrar la página anterior.

- El botón de validación comprobará los datos introducidos y guardará los cambios.




** Botón Cancel**

- Para crear el control Botón "Cancel":

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en "Botón".

	2. Haga clic debajo de los controles Campo de entrada para crear el control Botón.

	3. Cambie el texto del control (presione la barra espaciadora para editar el texto): escriba "Cancel".







- Introduzca el código WLanguage del botón "Cancel":

	1. Seleccione el control y presione F2. Los eventos asociados al control se abren.

	2. Introduzca el siguiente código WLanguage en el evento "Clic xxx (servidor )" del control Botón:
			
		```wl
		PageDisplay(PreviousPage())
		```


	3. Analicemos este código:

		- La función [PageDisplay](../WDLang2/3058008.md) muestra una página específica.

		- La función [PreviousPage](../WDLang2/3058017.md) obtiene el nombre de la página anterior.

		- Esta línea de código muestra la página anterior.




4. Guarde los cambios (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) o Ctrl + S).

5. Cierre el editor de código.


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | De forma predeterminada, los controles Botón que se crean en una página envían los valores de los controles al servidor (botón "submit"). Este es el caso más común.<br><br>Hay otras dos opciones disponibles:<br><br>- Restablecer los controles de la página.<br><br>- Ninguna acción. Este modo se debe utilizar para botones que solo realicen acciones en el navegador.<br><br><br><br><br>Estas opciones se pueden seleccionar en la pestaña "General" de la ventana de descripción del control Botón (opción "Durante la acción"). |





**Botón OK**

- Para crear el control Botón "OK":

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en "Botón".

	2. Enseguida, haga clic a la izquierda del botón "Cancel" para crear el nuevo control.

	3. Cambie el texto del control: escriba "OK". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%202%20-%20HC%20N%B0006.jpg&type=thumb)
El botón "OK" permitirá:

		- verificar los datos introducidos: esto consiste en comprobar si el usuario rellenó los distintos campos de la página. Además, no requiere ningún acceso al servidor y puede realizarse en código Navegador.

		- guardar los datos introducidos en el archivo de datos Product. Esta operación se realiza en código Servidor. Los datos se envían al servidor y luego se guardan en el archivo de datos.







- Escriba el código del botón "OK":

	1. Seleccione el botón "OK" y presione F2. Los eventos asociados al control Botón se abren.

	2. En el evento "Clic xxx (navegador)" del control Botón, escriba el siguiente código para comprobar los datos introducidos:
			
		```wl
		IF EDT_Reference ~= "" THEN
			Error("Enter a reference.") 
			SetFocusAndReturnToUserInput(EDT_Reference)
		END
		IF EDT_Caption ~= "" THEN
			Error("Type a caption.")
			SetFocusAndReturnToUserInput(EDT_Caption)
		END
		IF EDT_Description ~= "" THEN
			Error("Enter a description.")
			SetFocusAndReturnToUserInput(EDT_Description)
		END
		IF EDT_PriceBT = 0 THEN
			Error("Type a price.")
			SetFocusAndReturnToUserInput(EDT_PriceBT)
		END
		```


	3. Analicemos este código WLanguage:

		- Por cada control Campo de entrada en la página, verificamos si se introdujo un valor.

		- El operador '~=' comprueba si los valores son iguales, sin tener en cuenta las mayúsculas y minúsculas, ni la puntuación.

		- Si no se introduce ningún valor, un mensaje de error le pide al usuario que introduzca un valor (función [Error](../WDLang1/3021013.md)). La ejecución del código se detiene y el foco de entrada se establece en el control Campo de entrada correspondiente con la función [SetFocusAndReturnToUserInput](../WDLang1/1410088107.md).




4. En el evento "Clic xxx (servidor)" del control Botón, escriba el siguiente código WLanguage para guardar los datos:
			
		```wl
		Product.FromPage()
		Product.Modify()
		PAGE_List_of_products.Display()
		```


5. Analicemos este código WLanguage:

	- La función [&lt;Archivo de datos&gt;.FromPage](../WDLang4/1000021405.md) actualiza los campos del registro actual con los datos de los controles enlazados. Esta función equivale a las siguientes líneas de código:
						
			```wl
			Product.Reference = EDT_Reference
			Product.Caption = EDT_Caption
			Product.Description = EDT_Description
			...
			```

						Nuestra página utiliza menos de 10 controles y ya podemos notar las ventajas. Estas ventajas son mucho más notorias en las páginas que contienen un mayor número de controles: ¡una sola línea de código asigna todos los valores!

	- La función [&lt;Archivo de datos&gt;.Modify](../WDLang4/1000025038.md) actualiza el registro actual en el archivo de datos.

	- La función [&lt;Página&gt;.Display](../WDLang2/1000021661.md) muestra otra página. En nuestro caso, se vuelve a mostrar la página "PAGE_List_of_products".



<a name="NOTE4_7"></a>


### Gestión de la imagen del producto
<a name="gestion_imagen_del_producto_ELTPARAGRAPHE000545"></a>

En el archivo de datos Product, se utiliza un campo para almacenar la imagen asociada al producto.

Ya insertamos un control Imagen en la página para ver la imagen. Ahora vamos a definir las opciones para que los usuarios puedan cambiar la imagen del producto.

Los usuarios podrán cargar una imagen desde su equipo y ésta se enlazará a un campo en el archivo de datos. Vamos a utilizar un control Upload.|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | La carga consiste en copiar un archivo del equipo cliente al servidor.<br><br>Por el contrario, la descarga consiste en copiar un archivo del servidor al equipo cliente. |



|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | WEBDEV incluye dos controles específicos para subir archivos:<br><br>- un control Upload para subir un solo archivo,<br><br>- un control Upload para subir varios archivos.<br><br><br>En este ejemplo, el usuario subirá un solo archivo a la vez, por lo que utilizaremos un solo control Upload. |







- Para crear el control Upload:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", despliegue "Botón". Enseguida, aparece una lista con botones predefinidos.

	2. Seleccione "Subir archivos (Upload)".

	3. Haga clic en la ubicación en la que deseada crear el control (debajo del control Imagen, por ejemplo).  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%202%20-%20HC%20N%B0005.jpg&type=thumb)






|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | El control Upload incluye:<br><br>- una celda que contiene: <br><br>	- un control Estático,<br><br>	- un control Looper para mostrar las características de los archivos a cargar. <br><br><br><br><br>- un botón que permite al usuario seleccionar el archivo a cargar,<br><br>- un botón que permite al usuario enviar los archivos al servidor. <br><br><br> |




Vamos a adaptar el código del control para subir archivos en nuestro sitio.



- Para configurar el control Upload:

	1. Abra el código del botón "ADD": seleccione el control y presione F2.

	2. Diferentes eventos WLanguage están asociados al control Upload. Vamos a modificar el evento "Recepción de archivos subidos" para copiar la imagen en el directorio de datos del sitio.

	3. Escriba el siguiente código en el evento "Recepción de archivos subidos" (ignore los errores de compilación, los corregiremos más tarde):
			
		```wl
		UploadCopyFile(MySelf, fDataDir(), UploadFileName(MySelf, False))
		ImagePath = fDataDir() + [fSep()] + UploadFileName(MySelf, False)
		IMG_Visual = ImagePath
		```


	4. Analicemos este código:

		- La función [UploadCopyFile](../WDLang2/3012023.md) guarda el archivo cargado por el usuario en el servidor. En nuestro caso, el archivo se copia en el directorio de datos (devuelto por la función [fDataDir](../WDLang1/3036001.md)). El nombre del archivo se conserva.

		- La ruta de la imagen cargada se almacena en la variable global ***ImagePath***.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | **¿Por qué utilizar una variable global?**<br><br>Aquí se requiere una variable global porque la ruta de la imagen se utilizará en el código del botón "OK" para guardar la nueva imagen en el archivo de datos.<br><br>Para obtener más información, consulte los [anexos](../TutoWB/1410087226.md) sobre las condiciones de uso de las variables locales y globales. |





		- La función [fSep](../WDLang1/1000019647.md) obtiene el separador a utilizar en el sistema operativo del servidor ("\\" para Windows y "/" para Linux). Así, el sitio es totalmente independiente del servidor en el que está instalado.

		- A continuación, la imagen cargada se muestra en el control Imagen IMG_Visual.




5. En el editor de código, la variable ***ImagePath*** se muestra en rojo y un error de compilación aparece en el panel de errores: "El identificador 'ImagePath' es desconocido o inaccesible". Aún no hemos declarado la variable global.

6. Para declarar la variable global:

	- Vaya al evento "Declaraciones globales" de la página (por ejemplo, en el editor de código, vaya a la pestaña "Código" y seleccione "Declaraciones globales" en el cuadro cuadro combinado que contiene la lista de todos los eventos).  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%202%20-%20HC%20N%B0004.jpg&type=thumb)


La imagen se pude subir al servidor. Ahora solo tenemos que guardar la imagen en la base de datos.



- Para guardar la imagen en el archivo de datos Product:

	1. Abra el código del botón "OK":

		- Seleccione el botón "OK".

		- Presione F2.




2. En el evento "Clic xxx (servidor)" del control Botón, introduzca el siguiente código DESPUÉS de la llamada a la función [PageToFile](../WDLang4/3044022.md):
			
		```wl
		IF ImagePath<>"" THEN
			Product.Visual = fLoadBuffer(ImagePath) 
		END
		```


3. Analicemos este código WLanguage:

	- Este código comprueba el contenido de la variable global ***ImagePath***. Si la variable no corresponde a una cadena vacía, significa que el usuario cargó la imagen correctamente. En este caso, el campo "Visual" del archivo de datos Product se actualiza con el contenido binario de la imagen. Este contenido se obtiene con la función [fLoadBuffer](../WDLang1/1000019410.md). 

	- La función [&lt;Archivo de datos&gt;.Modify](../WDLang4/1000025038.md) (que ya se utiliza en el código) guarda los cambios en el archivo de datos.



<a name="NOTE4_8"></a>


### Abrir la ficha de producto desde la lista de productos
<a name="abrir_ficha_producto_desde_lista_productos_ELTPARAGRAPHE000685"></a>

Ahora, veamos cómo abrir la ficha del producto seleccionado en la lista de productos. El principio es muy sencillo: el usuario selecciona el producto en el control Looper y ve los detalles mediante un control Enlace.



- Vamos a modificar la página "PAGE_List_of_products" para crear un control Enlace:

	1. Seleccione la página "List of products": haga clic en "PAGE_List_of_products" en las pestañas de documentos abiertos:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%202%20-%20HC%20N%B0003.jpg)


	2. En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en "Enlace".

3. Luego, haga clic dentro del control Looper (abajo a la derecha, por ejemplo) para crear el control Enlace.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%202%20-%20HC%20N%B0002.jpg&type=thumb)




- El control Enlace "Modify" debe abrir la página "PAGE_Product_form". Vamos a abrir esta página mediante programación. 

	1. Seleccione el enlace "Modify" y abra los eventos WLanguage asociados (F2).

	2. En la ventana de código que aparece, escriba el siguiente código en el evento "Clic xxx (servidor)":
			
		```wl
		PAGE_Product_form.Display(ATT_ProductID[LOOP_Product])
		```

			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | La entrada predictiva lo guiará para escribir el código: al escribir el paréntesis de apertura "(", una lista desplegable muestra los nombres de todas las páginas del proyecto. Solo tiene que seleccionar la página deseada con el teclado o el ratón.<br><br>Si el nombre de la página deseada no aparece en la lista, significa que aún no se ha guardado. |





	3. Analicemos este código WLanguage:

		- La función [&lt;Página&gt;.Display](../WDLang2/1000021661.md) abre la página "PAGE_Product_form".

		- La página abierta espera como parámetro el identificador del producto a mostrar. Este identificador corresponde al identificador del producto seleccionado en el control Looper. Para obtener el identificador, se especifica el atributo que contiene el identificador (ATT_ProductID) para la fila actual. Los corchetes permiten especificar la fila y LOOP_Product obtiene la fila actual en el control Looper.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | De forma predeterminada, ATT_ProductID devuelve el valor del atributo de la fila seleccionada. El código se puede escribir de la siguiente manera:<br><br><pre><code>PAGE_Product_form.Display(ATT_ProductID)</code></pre><br> |








4. Guarde los cambios (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) o Ctrl + S).

5. Cierre la ventana de código.




Hemos creado los elementos necesarios para modificar los productos. Ahora vamos a probarlos.

- Pruebe el proyecto (haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Projet_WB_GAF.jpg) en los botones de acceso rápido).

	1. El editor le pide que seleccione la primera página del modo Sesión. En este caso, seleccione la página "PAGE_List_of_products" y valide.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | La primera página del modo Sesión corresponde a la primera página que se abre al iniciar el sitio en modo Sesión.<br><br>La primera página del proyecto en modo Sesión se puede definir:<br><br>		- al probar el proyecto.<br><br>		- en el panel "Explorador de proyectos": seleccione la página deseada, y luego abra el menú contextual y seleccione "Primera página del proyecto en modo sesión".<br><br><br>Cuando se define la primera página del modo Sesión, aparece un "1" rojo pequeño a la izquierda del nombre de la página en el panel "Explorador de proyectos". |





	2. El sitio se abre.

	3. En la lista de productos:

		- Haga clic en el enlace "Modify".

		- La página con los detalles del producto se abre.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%202%20-%20HC%20N%B0001.jpg&type=thumb)


		- Cambie el precio del producto y valide.

- El nuevo precio del producto aparece en la lista de productos.




- Cierre las páginas para detener la prueba.




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Agregar un nuevo producto a través de la página "Product form"
<a name="agregar_nuevo_producto_traves_pagina_product_form_ELTTEXTE001384"></a>
Acabamos de ver cómo modificar un producto. Ahora veremos cómo agregar un producto. Para ello, no es necesario crear una nueva página: vamos a utilizar la página "PAGE_Product_form" y la adaptaremos para agregar elementos.



- En primer lugar, cambiaremos el modo de apertura de la página "PAGE_Product_form":

	1. Seleccione la página "Product form": haga clic en "PAGE_Product_form" en las pestañas de documentos abiertos.

	2. Presione F2 para abrir los eventos WLanguage de la página.

	3. En el evento "Declaraciones globales", asignaremos un valor predeterminado al parámetro pasado a la página. Cuando se modifica un registro, el parámetro pasado siempre corresponde al identificador del producto que se va a modificar. Pero cuando se agrega un registro, el elemento aún no tiene un identificador. Para esto, estableceremos "-1" como el valor predeterminado.

	4. Reemplace la siguiente línea de código en el evento "Declaraciones globales":
			
		```wl
		PROCEDURE MyPage(NumProductToDisplay is 8-byte int)
		```

			por el código:
			
		```wl
		PROCEDURE MyPage(NumProductToDisplay is 8-byte int=-1)
		```


	5. Ahora vamos a definir el valor "-1" (cuando se agrega un registro). Reemplace el siguiente código:
			
		```wl
		Product.ReadSeekFirst(ProductID, NumProductToDisplay)
		IF Product.Found() = False THEN
			// Display the list of products
			PAGE_List_of_products.Display()
		END
		Product.ToPage()
		```

			por el código:
			
		```wl
		IF NumProductToDisplay = -1 THEN
			Product.Reset()
		ELSE
			Product.ReadSeekFirst(ProductID, NumProductToDisplay)
			IF Product.Found() = False THEN
				// Display the list of products
				PAGE_List_of_products.Display()
			END
		END
		Product.ToPage()
		```

			Analicemos este código:

		- Si el valor del identificador es -1, significa que se agrega un producto. En este caso, se ejecuta la función [Reset](../WDLang4/1000025052.md). Esta función inicializa las variables de los campos del archivo de datos "Product" con los valores predeterminados para agregar un nuevo registro.

		- Si el identificador del producto tiene un valor diferente de -1, se utiliza el código para abrir el formulario en modo de edición.




6. Cierre la ventana de código.




- El botón "OK" también debe agregar el registro.

	1. Seleccione el botón "OK" en "PAGE_Product_form".

	2. Abra los eventos WLanguage asociados al control (F2).

	3. El código del evento "Clic xxx (navegador)" no debe cambiar: las verificaciones a realizar son las mismas. Solo se debe modificar el código Servidor.

	4. En el evento "Clic xxx (servidor)", reemplace el código existente por el siguiente código:
			
		```wl
		Product.FromPage()
		IF ImagePath <> "" THEN
			Product.Visual = fLoadBuffer(ImagePath) 
		END
		Product.Save()
		PAGE_List_of_products.Display()
		```

			Analicemos este código: la función [&lt;Archivo de datos&gt;.Save](../WDLang4/1000024606.md) comprueba si el registro ya se encuentra en el archivo de datos "Product", y permite agregarlo o modificarlo, si es necesario. 

	5. Guarde los cambios (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) o Ctrl + S).

	6. Cierre la ventana de código.







- Vamos a modificar el menú de la página para permitir a los usuarios agregar un nuevo producto.

	1. Seleccione la página "List of products": haga clic en "PAGE_List_of_products" en las pestañas de documentos abiertos.

	2. Haga clic derecho en una opción del menú para abrir el menú contextual y seleccione "Abrir modelo".

	3. En el modelo de páginas, seleccione el menú.

	4. Haga clic en la opción "ITEMS". Un contorno amarillo aparece alrededor del menú. Este contorno indica que el menú está en modo de edición: se puede modificar.

	5. Abra la ventana de descripción de la opción (seleccione "Descripción de la opción" en el menú contextual).

	6. En la pestaña "General":

		- Introduzca el título de la opción: reemplace "ITEMS" por "ADD A PRODUCT".

		- En la sección "Acción": 

			- seleccione "Mostrar una página del sitio". 

			- seleccione la página "PAGE_Product_form".




7. Valide. La opción de menú aparece:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Fiche%20Produit%20-%202%20-%20HC%20N%B0007.jpg&type=thumb)


Ahora podemos probar nuestra opción para agrear un producto.
<a name="NOTE5_2"></a>


### Probar la adición de un nuevo producto
<a name="probar_adicion_nuevo_producto_ELTPARAGRAPHE000854"></a>

- Para probar la adición de un producto:

	1. Pruebe el proyecto (haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Projet_WB_GAF.jpg) en los botones de acceso rápido).

	2. Haga clic en "ADD A PRODUCT".

	3. Introduzca un nuevo producto con las siguientes características:

		- Reference: REF-337

		- Caption: Surf 25

		- Description: Surf with WEBDEV colors

		- Price: 150<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P3_Site%20WebDev%20-%20Go%20-%20HC%20N%B0001.jpg&type=thumb)






<a name="NOTE5_3"></a>


### Ver registros
<a name="ver_registros_ELTPARAGRAPHE000897"></a>

Los registros que introdujimos se pueden ver inmediatamente en el control Looper de la página "PAGE_List_of_products".

También se pueden ver con WDMAP, que presentamos en la lección [Crear las páginas](../TutoWB/1410087407.md).

| [Lección anterior](../TutoWB/1410087488.md) | [Tabla de contenido](../TutoWB/1410087510.md) | [Siguiente lección](../TutoWB/1410087491.md) |
| --- | --- | --- |




