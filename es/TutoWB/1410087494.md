
## Lección 5.1. Búsqueda con varios criterios


<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Esta lección abarcará los siguientes temas
<a name="esta_leccion_abarcara_los_siguientes_temas_ELTTEXTE000838"></a>


- Crear una consulta con parámetros.

- Crear la interfaz para seleccionar los criterios de búsqueda.

- Pasar parámetros a una consulta.

- Mostrar el resultado de una consulta en un control Tabla.

- Optimizar la actualización de la página mediante la activación de Ajax.





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=dur%E9e.png)<br> | <br>Tiempo estimado: 1h30 min |

| [Lección anterior](../TutoWB/1410087493.md) | [Tabla de contenido](../TutoWB/1410087510.md) | [Siguiente lección](../TutoWB/1410087495.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000885"></a>
En las partes anteriores, creamos un proyecto WEBDEV para desarrollar un sitio con una sección de Internet y otra de Intranet.

En las diferentes lecciones de la parte 5, seguiremos trabajando con el proyecto "Full_WEBDEV_Site" que utilizamos en las partes 3 y 4.



- Para abrir el proyecto:

	1. Inicie WEBDEV si es necesario. 

	2. Vaya a la página de inicio de WEBDEV (Ctrl +&lt;).

	3. En la página de inicio, haga clic en "Tutorial", luego en "Parts 3 to 6", haga doble clic en "Full WEBDEV Site - Exercise".

	4. Un cuadro de diálogo le pide que abra el proyecto en el que trabajó en la parte anterior. Puede abrir la copia local o el proyecto original. Seleccione "Abrir la copia local". 





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WB.png) | Corregido | Hay un proyecto completado disponible. Este proyecto contiene los diferentes elementos creados en esta lección. Para abrir el proyecto completado, vaya a la página de inicio y haga clic en "Tutorial", luego en "Parts 3 to 6", haga doble clic en "Full WEBDEV Site - Answers". |





En esta lección, permitiremos a los usuarios realizar una búsqueda con varios criterios.

En nuestro ejemplo, esta búsqueda se realizará en el archivo de datos "Order". El usuario podrá seleccionar:

- el nombre del cliente,

- el estado del pedido,

- el método de pago,

- el precio del pedido.


La UI de la página "PAGE_Multicriteria_search" será la siguiente: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0001.jpg&type=thumb)
Esta IU incluye:

- controles para seleccionar los criterios de búsqueda.

- botones para iniciar la búsqueda o imprimir el resultado.

- un control Tabla para mostrar el resultado de la búsqueda. Este control Tabla se basa en una consulta. La consulta permitirá seleccionar los registros que se mostrarán. 


La primera etapa consiste en crear la consulta de selección de registros.|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | **¿Qué es una consulta de selección?**<br><br>Una consulta de selección es una consulta que selecciona los registros que corresponden a criterios específicos.<br><br>Este tipo de consulta se llama Select debido al comando SELECT de SQL. |





<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Crear una consulta para buscar pedidos
<a name="crear_una_consulta_para_buscar_pedidos_ELTTEXTE000945"></a>


### Crear una consulta
<a name="crear_una_consulta_ELTPARAGRAPHE000076"></a>

- Para crear la consulta, utilizaremos el editor de consultas.

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Cr%E9er_WB_GAF.jpg) en los botones de acceso rápido. La ventana de creación de nuevos elementos se abre: haga clic en "Consulta­". El asistente de creación de consultas se abre.

	2. Elija la opción "Selección (SELECT)".
			Esta consulta nos permitirá seleccionar los registros. Pase a la etapa siguiente.

	3. La ventana de descripción de la consulta se abre.
			Veamos la UI del editor de consultas: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0002.jpg&type=thumb)
Esta UI incluye:

		1. la estructura jerárquica del análisis (la descripción de la base de datos del proyecto).

		2. los campos que se incluirán en la consulta.

		3. las opciones de selección de registros.

		4. la consulta en código SQL o en lenguaje natural.







- Para construir la consulta, vamos a seleccionar los elementos que se mostrarán en el resultado.

	1. Haga doble clic en los campos del análisis, a la izquierda de la ventana de descripción. Los campos que se tienen en cuenta se muestran en el centro de la pantalla.
			Vamos a mostrar:

		- la información sobre el pedido. En el archivo de datos "Order", haga doble clic en los siguientes campos:  OrderID, Date, Status y TotalIOT.

		- la información sobre el cliente que hizo el pedido. En el archivo de datos "Customer", haga doble clic en el campo "FullName".

		- el método de pago. En el archivo de datos "PaymentMode", haga doble clic en los campos "Caption" y "PaymentModeID".


 La ventana de descripción de la consulta es la siguiente:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0003.jpg&type=thumb)



<a name="NOTE3_2"></a>


### Prueba de la consulta
<a name="prueba_consulta_ELTPARAGRAPHE000125"></a>

Como con todos los elementos de un proyecto WEBDEV, puede probar la consulta que acabamos de crear:

1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg).

2. El resultado se muestra en una ventana:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0007.jpg)

	|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Al hacer clic derecho en el resultado de la consulta, aparece un menú contextual. Puede exportar el resultado a:<br><br>	- un archivo XLSX (Excel).<br><br>	- un archivo XML (eXtensible Markup Language).<br><br>	- un archivo de Word u Open Office.<br><br><br> |





3. El resultado muestra TODOS los pedidos. En nuestro caso, solo mostraremos los pedidos que coincidan con los criterios de búsqueda. Para ello, debemos utilizar una consulta con parámetros.

4. Cierre la ventana.



<a name="NOTE3_3"></a>


### Uso de parámetros en la consulta
<a name="uso_parametros_consulta_ELTPARAGRAPHE000148"></a>

En nuestro ejemplo, el usuario podrá seleccionar un valor para los siguientes criterios de búsqueda:

- Nombre del cliente.

- Estado del pedido.

- Método de pago del pedido.

- Precio del pedido.


Tenemos que modificar la consulta para que estos criterios de búsqueda coincidan con los parámetros de la consulta.



- Para definir los parámetros de la consulta, abra la ventana de descripción de la consulta: haga doble clic en el fondo de la representación gráfica de la consulta (o seleccione "Descripción de la consulta" en el menú contextual).




- Para definir el parámetro "Nombre del cliente":

	1. Seleccione el campo Customer.FullName en el centro de la pantalla.

	2. Despliegue "Condición de selección" (en la sección "Acciones" de la ventana) y seleccione "Nueva condición".

	3. En la ventana que aparece, vamos a especificar que la condición de selección corresponde a un parámetro:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0008.jpg)


		- Seleccione "Contiene".

- Seleccione "el parámetro".

- Especifique el nombre del parámetro: "ParamCustomerName".
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Se recomienda utilizar el prefijo "param" para los parámetros de la consulta. Esto le permite encontrarlos fácilmente en el editor de código.<br><br>Cuando busque un parámetro de la consulta, simplemente introduzca 'param' y la función de completado de código del editor de código mostrará todos los parámetros. |





4. Valide la ventana de descripción de la condición. El número "1" aparece a la derecha del campo "Customer.FullName", indicando que se definió una condición de selección.

<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0009.jpg)
|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | La descripción de la consulta en lenguaje natural (en la parte inferior del editor de consultas) se actualiza automáticamente en función de la nueva condición.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0009%201.jpg&type=thumb)<br> |







- Ahora veamos el segundo parámetro: el estado del pedido:

	1. Seleccione el campo Order.Status en el centro de la pantalla.

	2. Haga clic en el botón "Condición de selección" y seleccione "Nueva condición".

	3. En la ventana que aparece, vamos a especificar que la condición de selección es igual a un parámetro:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0010.jpg)


		- Seleccione "Es igual a".

- Seleccione "el parámetro".

- Especifique el nombre del parámetro: "ParamStatus".

4. Valide la ventana de descripción de la condición. El número "1" aparece a la derecha del campo "Order.Status" para indicar que se ha definido una condición de selección.




- Vamos a definir una condición en el método de pago. El campo "PaymentMode.PaymentModeID" no debe aparecer en el resultado de la consulta, pero se le debe definir una condición. Para ello, lo vamos a ocultar.

	1. Para no mostrar el campo "PaymentMode.PaymentModeID" en el resultado:

		- Haga clic en el ojo (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0011%201.jpg)) del campo "PaymentMode.PaymentModeID" en la lista de elementos de la consulta (en el centro de la pantalla).

		- En el menú que aparece, seleccione "No mostrar".




2. Para definir una condición de selección en el campo "PaymentMode.PaymentModeID":

	- Seleccione el campo "PaymentMode.PaymentModeID" (en el centro de la pantalla).

	- Haga clic en el botón "Condición de selección" y seleccione "Nueva condición".

	- En la ventana que aparece, especifique que la condición de selección corresponde a un parámetro:

		- Seleccione "Es igual a".

		- Seleccione "el parámetro".

		- Especifique el nombre del parámetro: "ParamPaymentModeID".




- La última condición de selección se definirá en el monto del pedido. Definiremos dos condiciones de selección para especificar el precio mínimo y máximo.

	1. Seleccione el campo "Order.TotalIOT" en la lista de elementos de la consulta.

	2. Haga clic derecho para abrir el menú contextual del campo y seleccione "Condición de selección .. Nueva condición".

	3. En la ventana que aparece:

		- Seleccione la condición "Es mayor que o igual a".

		- Haga clic en "el parámetro".

		- Especifique el nombre del parámetro: "ParamMinPrice".




4. Valide la condición de selección.

5. Defina otra condición en el mismo campo "Order.TotalIOT": haga clic derecho para abrir el menú contextual del campo y seleccione "Condición de selección .. Nueva condición".

6. En la ventana que aparece:

	- Seleccione la condición "Es menor que o igual a".

	- Haga clic en "el parámetro".

	- Especifique el nombre del parámetro: "ParamMaxPrice".



<a name="NOTE3_4"></a>


### Prueba de la consulta con parámetros
<a name="prueba_consulta_con_parametros_ELTPARAGRAPHE000251"></a>

- Para probar la consulta con parámetros:

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg).

	2. Enseguida, se abre una ventana que permite escribir los parámetros de la consulta.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Los parámetros pueden ser ignorados desmarcando la casilla a la izquierda del nombre. En este caso, se ignora la condición de selección asociada al parámetro. Por ejemplo, si se ignora el parámetro ParamCustomerName, la consulta tendrá en cuenta los pedidos de todos los clientes.<br><br>Observación: Si todos los parámetros están desmarcados, la consulta devuelve el resultado completo. |


<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0016.jpg)


	3. Defina los siguientes datos:

	- Desmarque los parámetros ParamCustomerName y ParamStatus.

	- Seleccione el parámetro ParamPaymentModeID. En la parte inferior de la pantalla, introduzca "1".

	- Seleccione el parámetro ParamMinPrice. En la parte inferior de la pantalla, introduzca "150".

	- Seleccione el parámetro ParamMaxPrice. En la parte inferior de la pantalla, introduzca "300".


Ahora, crearemos una página para:

- especificar los parámetros de la consulta,

- ejecutar la consulta,

- ver el resultado de la consulta.




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Crear la página de búsqueda con varios criterios
<a name="crear_pagina_busqueda_con_varios_criterios_ELTTEXTE001077"></a>


### Crear una página
<a name="crear_una_pagina_ELTPARAGRAPHE000287"></a>

- Para crear la página que mostrará el resultado de la búsqueda con varios criterios:

	1. Cree una nueva página en blanco.

		- Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Cr%E9er_WB_GAF.jpg) en los botones de acceso rápido.

		- La ventana de creación de nuevos elementos se abre: haga clic en "Página", y luego en "Página".

		- El asistente de creación de páginas se abre automáticamente.

		- En la sección "Basado en un modelo del proyecto", seleccione "PAGETPL_Simple" y valide el asistente.




2. La ventana para guardar la página se abre. 

3. Introduzca el título: "Multicriteria search". El nombre "PAGE_Multicriteria_search" se rellena automáticamente. 

4. Valide.



<a name="NOTE4_2"></a>


### Crear los controles para definir los criterios y mostrar el resultado
<a name="crear_los_controles_para_definir_los_criterios_mostrar_resultado_ELTPARAGRAPHE000306"></a>

Crearemos un control Tabla basado en la consulta, y luego crearemos los diferentes controles que permitan al usuario seleccionar los criterios de búsqueda.

**Crear un control Tabla**

- Para crear el control Tabla que mostrará el resultado de la búsqueda:

	1. Cree un control Tabla: en la pestaña "Creación", en el grupo "Datos", despliegue "Tabla" y seleccione "Tabla simple ".

	2. Haga clic en la página "PAGE_Multicriteria_search": el asistente de creación del control Tabla se abre.

	3. El control Tabla se basará en la consulta "QRY_FindOrders" (creada anteriormente). Seleccione la opción "Mostrar datos de un archivo o una consulta existente". Pase a la etapa siguiente del asistente.

	4. Seleccione la consulta que se utilizará como fuente de datos para el control Tabla:

		- Despliegue el grupo "Consultas".

		- Seleccione la consulta "QRY_FindOrders".<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Interface%20-%20HC%20N%B0001.jpg&type=thumb)


		- Pase a la etapa siguiente del asistente. 

- Seleccione todos los campos que aparecen: todos se mostrarán en el control Tabla. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Interface%20-%20HC%20N%B0002.jpg&type=thumb)
Pase a la etapa siguiente del asistente. 

5. Conserve las opciones predeterminadas en las diferentes etapas del asistente y valide.

6. El control Tabla se crea automáticamente en la página.

7. Si es necesario, desplace el control Tabla para que se muestre completamente.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Interface%20-%20HC%20N%B0003.jpg&type=thumb)




- Para una mejor legibilidad, vamos a modificar la descripción del control Tabla.

	1. Abra la descripción del control Tabla (haga doble clic en el control).
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | La ventana de descripción del control Tabla está compuesta por dos partes:<br><br>		- la parte superior, que contiene el nombre del control, así como el nombre y tipo de las columnas.<br><br>		- la parte inferior, que contiene las diferentes pestañas de descripción.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Interface%20-%20HC%20N%B0004.jpg&type=thumb)<br><br><br><br>Si hace clic en el nombre del control Tabla, la parte inferior muestra las características de la tabla.<br><br>Si hace clic en una columna, la parte inferior muestra las características de las columnas. |





	2. Haga clic en el nombre del control Tabla. El título del control Tabla aparece en la parte inferior. Vamos a cambiar este texto. Reemplace el texto por "Search results".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Interface%20-%20HC%20N%B0005.jpg&type=thumb)


	3. Haga clic en la columna "COL_OrderID". El título de la columna se muestra en la parte inferior de la ventana. Reemplace "Order ID" por "ID".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Interface%20-%20HC%20N%B0006.jpg&type=thumb)


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | **Live Data y controles basados en consultas**<br><br>Los datos en tiempo real no se muestran en los controles que utilizan una consulta como fuente de datos por el siguiente motivo: Los datos que se muestran dependen del resultado de la consulta y solo pueden obtenerse en tiempo de ejecución. |







- Vamos a probar esta página por primera vez:

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido.

	2. Solo se muestran los pedidos que se pagan en efectivo, con un precio entre $150 y $300. Esto corresponde a los resultados de la última prueba de la consulta ejecutada en el editor, cuando especificamos los parámetros en la ventana de prueba de la consulta.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Interface%20-%20HC%20N%B0008.jpg&type=thumb)


	3. Cierre el navegador para volver al editor.




- Echemos un vistazo a los eventos del control Tabla:

	1. Seleccione el control Tabla y presione F2.

	2. El evento "Inicialización de TABLE_QRY_FindOrders" contiene el siguiente código:
			
		```wl
		// The control uses a query with parameters to display the data.
		// The parameters of they query must be defined before or 
		// when the control is initialized.
		// The query will be automatically run if at least one parameter is defined.
		//
		// For more details, see the online help:
		// Query with parameters, Use in a Table, List Box or Combo Box control
		//
		// Parameters of 'QRY_FindOrders' query
		//MySource.ParamCustomerName = <Value of ParamCustomerName>
		//MySource.ParamStatus = <Value of ParamStatus>
		MySource.ParamPaymentModeID = "1"
		MySource.ParamMinPrice = "150"
		MySource.ParamMaxPrice = "300"
		```

			Los parámetros de prueba se obtuvieron como parámetros predeterminados para la ejecución. Ahora, vamos a modificar la página para que el usuario pueda introducir los parámetros mediante diferentes controles.

	3. Para crear la página, vamos a definir como comentarios todas las líneas de código que corresponden a parámetros:

		- Seleccione las tres líneas de código que comienzan con "MySource ...". 

		- Presione Ctrl + /.

		- Las líneas de código pasan a ser comentarios. 




4. Cierre el editor de código (haga clic en la "X" de la esquina superior derecha).




Vamos a crear los diferentes controles que permitirán al usuario seleccionar los parámetros de la consulta. Estos controles se ubicarán arriba del control Tabla.

- Si es necesario, desplace el control Tabla y reduzca su altura para dejar espacio a los controles de selección de criterios.




**Primer parámetro: Nombre del cliente**

Vamos a crear un control Campo de entrada para que el usuario introduzca el nombre del cliente que desea buscar.

- Para crear el control Campo de entrada:

	1. Abra el panel "Análisis" si es necesario: en la pestaña "Inicio", en el grupo "Entorno", despliegue "Paneles", seleccione "Paneles" y, a continuación, haga clic en "Análisis". Los diferentes archivos de datos definidos en el análisis "Full_WEBDEV_Site" se muestran en el panel.

	2. Haga clic en el ícono ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0003%202.jpg) a la izquierda del archivo de datos "Customer": los campos del archivo de datos aparecen.

	3. Seleccione el campo "FullName" del archivo de datos Customer, luego arrástrelo y suéltelo en la ventana "PAGE_Multicriteria_search".

	4. El control campo de entrada se crea automáticamente. Ubique el control arriba del control Tabla.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%202%20-%20HC%20N%B0001.jpg&type=thumb)








- Ahora vamos a pasar el valor introducido en el control Campo de entrada como parámetro a la consulta:

	1. Seleccione el control Tabla y presione F2.

	2. En el evento de inicialización del control Tabla, reemplace la siguiente línea:
			
		```wl
		//MySource.ParamCustomerName = <Value of ParamCustomerName>
		```
por:
			
		```wl
		MySource.ParamCustomerName = EDT_FullName
		```

			En este código, EDT_FullName es el nombre del control Campo de entrada que acaba de crear. El valor de este control está asociado al parámetro ParamCustomerName que espera la consulta.

	3. Cierre el editor de código.







<a name="NOTE4_Style"></a>


- Antes de ejecutar la prueba, vamos a crear un control Botón para que se vuelva a mostrar el contenido del control Tabla según el valor seleccionado en el Botón de opción:

	1. Cree un control Botón:

		- en la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_champ_bouton_WB_GAF.jpg).

		- luego, haga clic en la parte superior derecha de la página.




2. Cambie el título del control (presione Entrar). Introduzca "Find".

3. Cambie el estilo del control:

	- Haga clic derecho para abrir el menú contextual del control y seleccione la opción "Seleccionar un estilo WEBDEV".

	- En la ventana que aparece, seleccione "Details (With background)".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%202%20-%20HC%20N%B0002.jpg&type=thumb)




- Vamos a probar el primer parámetro:

	1. Guarde la página haciendo clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) en los botones de acceso rápido.

	2. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido.

	3. En la página que aparece, escriba "ADDAMS" y haga clic en "FIND". El contenido del control Tabla cambia: todos los pedidos realizados por "ADDAMS" aparecen en la tabla.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%202%20-%20HC%20N%B0003.jpg&type=thumb)


	4. Cierre la página de prueba.




**Segundo parámetro: Estado del pedido**

Un pedido puede tener tres estados:

- en espera, 

- validado,

- cancelado.


En nuestro análisis, el estado del pedido se guarda en el campo "Status" del archivo de datos "Order". Este campo es de tipo Botón de opción.

Para que el usuario pueda seleccionar uno de estos tres estados, utilizaremos un control Botón de opción enlazado al campo "Status" del archivo de datos "Order".|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Los botones de opción también se denominan "casillas de opción". Se utilizan para seleccionar una sola opción en una lista de opciones.<br><br>**¿Cómo diferenciar un botón de opción de una casilla de verificación?**<br><br>- Los botones de opción permiten seleccionar una sola opción.<br><br>- Las casillas de verificación permiten seleccionar varias opciones.<br><br><br> |







- Para crear el control Botón de opción:

	1. En el panel "Análisis", haga clic en el ícono ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20HC%20N%B0003%202.jpg) a la izquierda del archivo de datos "Order": los campos del archivo de datos aparecen.

	2. Seleccione el campo "Status" en el archivo de datos Order, luego arrástrelo y suéltelo en la página "PAGE_Multicriteria_search".

	3. El control Botón de opción se crea automáticamente. Ubique el control arriba del control Tabla.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%203%20-%20HC%20N%B0001.jpg&type=thumb)








- Vamos a utilizar el valor seleccionado en el control Botón de opción para pasarlo a la consulta como parámetro:

	1. Abra los eventos del control Tabla:

		- Seleccione el control Tabla.

		- Haga clic derecho para abrir el menú contextual y seleccione "Código".




2. En el evento de inicialización del control Tabla, reemplace la siguiente línea:
			
		```wl
		//MySource.ParamStatus = <Value of ParamStatus>
		```
por: 
			
		```wl
		MySource.ParamStatus = RADIO_Status
		```

			En este código, RADIO_Status corresponde al nombre del control Botón de opción que acabamos de crear. El valor de este control está asociado al parámetro ParamStatus que espera la consulta.

3. Cierre el editor de código.




- Vamos a probar los dos primeros parámetros que se pasaron:

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido.

	2. Escriba "ADDAMS" y seleccione "Pending".

	3. Haga clic en "FIND": solo los pedidos realizados por ADDAMS y en espera de pago aparecen en la tabla.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%203%20-%20HC%20N%B0002.jpg&type=thumb)








- En este ejemplo, solo se han mostrado los pedidos realizados por un cliente determinado y con un estado específico. Ahora, ahora vamos a mostrar todos los pedidos realizados por un cliente, independientemente del estado. Vamos a modificar la página para realizar este proceso.
	En este caso, vamos a:

	- Agregar un estado adicional para mostrar todos los pedidos,

	- Gestionar el estado adicional.







- Cierre el navegador.




- Para agregar una opción al control Botón de opción:

	1. Seleccione el control Botón de opción creado anteriormente.

	2. Haga doble clic en el control para abrir la ventana de descripción.

	3. En la pestaña "Contenido", en la lista de opciones, inserte la opción "All orders" en la parte superior de la lista:

		- Haga clic en el botón "+". 

		- Escriba "All orders".

		- Utilice la flecha hacia arriba (a la derecha de la ventana) para mover la opción hacia arriba.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%203%20-%20HC%20N%B0003.jpg&type=thumb)







- La opción "All orders" ignora el parámetro "ParamStatus" de la consulta. Para ignorar un parámetro de la consulta, simplemente asígnele el valor NULL. Vamos a gestionar este caso para el parámetro ParamStatus.

	1. Seleccione el control Tabla y abra los eventos (presione F2 o seleccione "Código" en el menú contextual).

	2. En el evento de inicialización del control Tabla, reemplace la siguiente línea: 
			
		```wl
		MySource.ParamStatus = RADIO_Status
		```
por:
			
		```wl
		SWITCH RADIO_Status
			// All orders
			CASE 1
				MySource.ParamStatus = Null
			OTHER CASE
			MySource.ParamStatus = RADIO_Status-1
		END
		```

			En este código, si el control RADIO_Status corresponde a 1 (caso de la opción "All orders"), se asigna el valor "NULL" al parámetro de la consulta asociada. En caso contrario, el valor del parámetro es el número de la opción seleccionada menos 1 (que corresponde a la opción que agregamos).

	3. Cierre el editor de código.







- Vamos a probar la página.

	1. Guarde la página haciendo clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.Jpg) en los botones de acceso rápido.

	2. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido.

	3. Escriba "ADDAMS" y seleccione "All orders".

	4. Haga clic en "FIND": los pedidos realizados por ADDAMS aparecen en la tabla, independientemente del estado.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%203%20-%20HC%20N%B0005.jpg&type=thumb)


	5. Cierre el navegador.




**Tercer parámetro: Método de pago**

Se pueden utilizar varios métodos de pago para un pedido: efectivo, cheques, etc. Los diferentes métodos de pago se almacenan en el archivo de datos "PaymentMode".

Vamos a crear un control Combo Box basado en este archivo de datos para que el usuario seleccione un método de pago.|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | El control Combo Box permite mostrar una lista de elementos y seleccionar un elemento de la lista.<br><br>A diferencia del control List Box, un Combo Box muestra un solo elemento a la vez: al hacer clic en el control, éste se expande y permite seleccionar otro elemento. Solo se puede seleccionar un elemento.<br><br>Los elementos que se muestran en un control Combo Box se pueden definir al crear el control en el editor. Estos elementos:<br><br>- se definen mediante programación.<br><br>- provienen de un archivo de datos o consulta.<br><br><br> |







- Para crear un control Combo Box:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en "Combo Box".

	2. Haga clic en la ventana, en la ubicación en la que desea crear el control (por ejemplo, junto al control Botón de opción).

	3. El asistente de creación del control Combo Box se abre.

	4. Seleccione la opción "Mostrar datos de un archivo o de una consulta existente" y vaya a la etapa siguiente.<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-Crit%E8res%20-%20Interface%204%20-%20HC%20N%B0001.jpg&type=thumb)


	5. Seleccione el archivo de datos "PaymentMode" y pase a la etapa siguiente.<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-Crit%E8res%20-%20Interface%204%20-%20HC%20N%B0002.jpg&type=thumb)




- Cambie el título del control Combo Box (presione Entrar). Introduzca "Payment mode".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%204%20-%20HC%20N%B0006.jpg&type=thumb)





- Ahora vamos a pasar el valor seleccionado en el control Combo Box como parámetro a la consulta:

	1. Abra los eventos del control Tabla: Seleccione el control Tabla y presione F2.

	2. En el evento de inicialización del control Tabla, reemplace la siguiente línea:
			
		```wl
		//MySource.ParamPaymentModeID = 1
		```
por:
			
		```wl
		MySource.ParamPaymentModeID = COMBO_PaymentMode
		```

			En este código, COMBO_PaymentMode corresponde al nombre del control Combo Box que acabamos de crear. El valor de este control está asociado al parámetro ParamPaymentModeID que espera la consulta.

	3. Cierre el editor de código.

	4. Guarde la página (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) o Ctrl + S).







- Vamos a probar los parámetros que se pasaron:

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido.

	2. Introduzca "ADDAMS".

	3. Cambie el estado de los pedidos con el control Botón de opción y el método de pago con el control Combo Box, y luego haga clic en "FIND". El contenido del control Tabla cambia.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%204%20-%20HC%20N%B0007.jpg&type=thumb)


	4. Cierre el navegador.




**Último parámetro: Total del pedido**

El último parámetro de la consulta corresponde al total del pedido. Tenemos un parámetro que corresponde al precio mínimo y un parámetro que corresponde al precio máximo. El usuario debe poder elegir un intervalo de precios. Para ello, usaremos un Control deslizante de rango.|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Un Control deslizante de rango es un control gráfico que se puede incluir fácilmente en un sitio WEBDEV y que permite seleccionar los límites de un intervalo (valor inicial y valor final). |







- Para gestionar el precio del producto:

	1. En la pestaña "Control deslizante", en el grupo "Controles gráficos", despliegue "Creación" y seleccione "Rango de precios".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%205%20-%20HC%20N%B0001.jpg&type=thumb)


	2. Haga clic en la página, entre el control "Payment mode" y el botón "FIND". El control deslizante de rango se crea automáticamente.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%205%20-%20HC%20N%B0002.jpg&type=thumb)




- El control que se acaba de crear es un control avanzado que incluye el control deslizante y dos controles que muestran los límites. El control ya está programado para mostrar los límites. Vamos a inicializar el Control deslizante para que los límites coincidan con los datos del archivo de datos Order.

	1. Seleccione el Control deslizante y abra los eventos (F2).

	2. Inserte el siguiente código antes las líneas existentes en el evento de inicialización del control:
			
		```wl
		// The lower value is the least expensive amount
		Order.ReadFirst(TotalIOT)
		MySelf.MinValue = Order.TotalIOT
		MySelf.LowerValue = MySelf.MinValue
		
		// The upper value is the most expensive amount
		Order.ReadLast(TotalIOT)
		MySelf.MaxValue = Order.TotalIOT
		MySelf.UpperValue = MySelf.MaxValue
		```

			Analicemos este código:

		- La función [&lt;Archivo de datos&gt;.ReadFirst](../WDLang4/1000025022.md) lee el primer registro del archivo de datos "Order" según la clave de búsqueda, TotalIOT en este caso. Por lo tanto, esta función lee el registro que corresponde al precio más bajo.

		- A continuación, el precio leído en el registro se asocia al límite mínimo del Control deslizante, así como a su valor inferior.

			- El límite mínimo indica el valor más bajo que puede seleccionar el usuario.

			- El valor inferior indica el valor más bajo seleccionado actualmente.




- El mismo principio se utiliza para encontrar el precio más alto. La única diferencia es la función utilizada:  [&lt;Archivo de datos &gt;.ReadLast](../WDLang4/1000025020.md). Esta función lee el último registro del archivo de datos Order según el precio, es decir, el registro con el precio más alto. 

3. Cierre la ventana de código.




- Vamos a pasar los precios seleccionados como parámetro a la consulta:

	1. Abra los eventos del control Tabla: seleccione el control Tabla y presione F2.

	2. En el evento de inicialización del control Tabla, reemplace las siguientes líneas:
			
		```txt
		//MySource.ParamMinPrice = "1500"
		//MySource.ParamMaxPrice = "3000"
		```

			por:
			
		```wl
		MySource.ParamMinPrice = SLIDER_BUDGET.LowerValue
		MySource.ParamMaxPrice = SLIDER_BUDGET.UpperValue
		```

			En este código, los parámetros que corresponden a los precios son iguales al valor inferior y superior del Control deslizante.

	3. Cierre el editor de código.

	4. Guarde la página (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) o Ctrl + S).







- Vamos a probar los parámetros que se pasaron:

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido.

	2. Defina los parámetros de búsqueda:

		- Nombre del cliente,

		- Estado,

		- Método de pago, 

		- Precio.




3. Haga clic en "FIND". El contenido del control Tabla cambia.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20multi-crit%E8res%20-%20Interface%205%20-%20HC%20N%B0003.jpg&type=thumb)




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Optimizar la visualización de la página
<a name="optimizar_visualizacion_pagina_ELTTEXTE001197"></a>
De forma predeterminada, al hacer clic en el botón "Find", el servidor devuelve todo el contenido de la página.

Para optimizar la visualización de la página, puede activar el modo Ajax en este botón. En nuestro ejemplo, el servidor solo devolverá el contenido del control Tabla.|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | WEBDEV incluye varios métodos para utilizar la tecnología Ajax en un sitio:<br><br>- **Ajax con un solo clic**: simplemente haga clic en AJAX en el editor de código para activar Ajax en un evento.<br><br>- **Controles Ajax** (controles Tabla y Looper). Los controles Ajax permiten mostrar los datos cargados dinámicamente desde el servidor. ¡No es necesario descargar todo al mismo tiempo!<br><br>- **Ajax** utilizando funciones específicas de WLanguage: [AjaxExecute](../WDLang2/3055114.md) y [AJAXExecuteAsynchronous](../WDLang2/3055115.md).<br><br><br> |







- Para activar Ajax en el botón "Find":

	1. Seleccione el botón "Find" y abra los eventos (F2).

	2. En el encabezado del evento "Clic en xxx (servidor)", el enlace AJAX aparece tachado.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Ajax%20-%20HC%20N%B0002.jpg)


	3. Haga clic en el enlace AJAX: el enlace "AJAX activado" aparece para indicar que el evento se convierte automáticamente en un evento Ajax.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Recherche%20-%20Ajax%20-%20HC%20N%B0001.jpg)




- Pruebe la página:

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido.

	2. Defina los parámetros de búsqueda:

		- Nombre del cliente,

		- Estado,

		- Método de pago, 

		- Precio.




3. Haga clic en "Find". Solo se vuelve a mostrar el contenido del control Tabla.




| [Lección anterior](../TutoWB/1410087493.md) | [Tabla de contenido](../TutoWB/1410087510.md) | [Siguiente lección](../TutoWB/1410087495.md) |
| --- | --- | --- |




