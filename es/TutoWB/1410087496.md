
## Lección 5.3. Enviar un correo electrónico


<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Esta lección abarcará los siguientes temas
<a name="esta_leccion_abarcara_los_siguientes_temas_ELTTEXTE000404"></a>


- Cómo enviar un correo electrónico desde un sitio WEBDEV.





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=dur%E9e.png)<br> | <br>Tiempo estimado: 20 min |

| [Lección anterior](../TutoWB/1410087495.md) | [Tabla de contenido](../TutoWB/1410087510.md) | [Siguiente lección](../TutoWB/1410087497.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000451"></a>
WLanguage incluye un gran número de funciones que permiten gestionar el envío y la recepción de correos electrónicos. También puede acceder a las características de un correo electrónico:

- remitente, destinatarios, 

- fecha de envío, asunto, mensaje,

- archivos adjuntos...




WEBDEV incluye varios métodos para gestionar correos electrónicos:

- A través de Lotus Notes, Outloook o MS Exchange:

	- **Lotus Notes o Outlook**: estos programas le permiten enviar y recibir correos electrónicos.

	- " **Simple Mail API**" (también llamado SMAPI o Simple MAPI): este modo de gestión de correos electrónicos es utilizado por la mayoría de las aplicaciones de Microsoft, especialmente por Microsoft Exchange.




- A través de los protocolos POP3, IMAP y SMTP:

	- Protocolo **POP3**: este protocolo de recepción de correos electrónicos es compatible con todos los proveedores de servicios. Permite comunicarse directamente con el servidor y está disponible en su proveedor de servicios de Internet (ISP). Además, permite ver la lista de mensajes entrantes y leerlos.

	- Protocolo **IMAP**: este protocolo de recepción de correos electrónicos permite dejar los correos electrónicos en el servidor para que puedan ser vistos desde diferentes clientes de mensajería o webmail.

	- Protocolo **SMTP**: este protocolo de envío de correos electrónicos es reconocido por todos los proveedores de servicios.







En esta lección, vamos a crear una página Popup que permita a los usuarios enviar sugerencias por correo electrónico al desarrollador del sitio web. La página popup es la siguiente:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Popup%20Email%20-%20HC%20N%B0001%201.jpg&type=thumb)


Para ello, usaremos el protocolo SMTP. Este es el modo de envío más utilizado.

Para obtener más información sobre los diferentes métodos, consulte [Enviar y recibir correos electrónicos](../WDLang3/3032007.md).



- Abra de nuevo el proyecto en el que trabajó en la lección anterior. 

	1. Vaya a la página de inicio de WEBDEV (Ctrl +&lt;).

	2. En la página de inicio, haga clic en "Tutorial", luego en "Parts 3 to 6", haga doble clic en "Full WEBDEV Site - Exercise".

	3. Un cuadro de diálogo le pide que abra el proyecto en el que trabajó en la lección anterior. Puede abrir la copia local o el proyecto original. Seleccione "Abrir la copia local". 





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WB.png) | Corregido | Hay un proyecto completado disponible. Este proyecto contiene los diferentes elementos creados en esta lección. Para abrir el proyecto completado, vaya a la página de inicio y haga clic en "Tutorial", luego en "Parts 3 to 6", haga doble clic en "Full WEBDEV Site - Answers". |





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WB.png) | Ejemplos | Para obtener más información sobre los correos electrónicos, consulte el ejemplo "Sending emails" (unit example), proporcionado con WEBDEV. Puede abrir este ejemplo desde la ventana de inicio de WEBDEV. |





<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Página Popup de envío de correos electrónicos
<a name="pagina_popup_envio_correos_electronicos_ELTTEXTE000511"></a>
La página Popup que vamos a crear contendrá todos los controles que permitirán al usuario introducir los diferentes elementos del correo electrónico. Vamos a incluir un botón "Send" para agrupar todos los procesos necesarios para enviar el correo electrónico. 
<a name="NOTE3_2"></a>


### Crear la página Popup
<a name="crear_pagina_popup_ELTPARAGRAPHE000075"></a>

- Para crear la página Popup:

	1. Abra el proyecto "Full_WEBDEV_Site" si es necesario.

	2. Abra la página "PAGE_List_of_products".

	3. En la barra de páginas, haga clic en "Páginas Popup".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_WB_Popup_creation%20-%20HC%20N%B0001.jpg)


	4. En el menú que aparece, haga clic en "Nueva popup".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_WB_Popup_creation%20-%20HC%20N%B0002.jpg)



<a name="NOTE3_3"></a>


### Crear los controles que permitirán introducir las características del correo electrónico
<a name="crear_los_controles_que_permitiran_introducir_las_caracteristicas_del_correo_electronico_ELTPARAGRAPHE000094"></a>

Para escribir un correo electrónico, el usuario necesita:

- Un control para introducir la dirección del remitente.

- Un control para introducir el asunto del correo electrónico.

- Un control para introducir el texto del correo electrónico.


Vamos a agregar estos controles a la página.

Observación: dado que el destinatario es el desarrollador del sitio, la dirección correspondiente estará en el código de envío del correo electrónico. Los parámetros del servidor SMTP también se introducirán directamente en el código.




- Para crear el control Campo de entrada que corresponde a la dirección del remitente:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", despliegue "Entrada".

	2. Seleccione el control "Entrada de correo electrónico".

	3. Haga clic en la página: el control Campo de entrada se crea automáticamente.

	4. Cambie el texto del control por: "Sender".







- Para crear el control Campo de entrada que corresponde al asunto del correo electrónico:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_champ_saisie_WB_GAF.jpg).

	2. Haga clic debajo del control "Sender": el control Campo de entrada se crea automáticamente.

	3. Cambie el texto del control por: "Subject".







- Para el cuerpo del mensaje, usaremos un control Campo de entrada HTML: el usuario podrá definir el formato del texto del correo electrónico utilizando una barra de herramientas específica.

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", despliegue "Entrada".

	2. Seleccione "Entrada HTML".

	3. La forma del control aparece bajo el cursor.

	4. Haga clic debajo del control "Subject": el control Campo de entrada se crea automáticamente.

	5. Amplíe el control para mostrar varias líneas.

	6. Haga doble clic en el control para abrir la ventana de descripción.

		- En la pestaña "General", cambie el modo de visualización de la barra de herramientas HTML (opción "Barra de herramientas HTML"). Esta barra de herramientas siempre debe estar visible.

		- Valide la ventana de descripción del control.




7. Ajuste la posición del control si es necesario.




- Alinee los diferentes controles de la página.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Popup%20Email%20-%20HC%20N%B0006.jpg&type=thumb)



Vamos a crear el control Botón que nos permitirá enviar los correos electrónicos.
<a name="NOTE3_4"></a>


### Envío de correos electrónicos
<a name="envio_correos_electronicos_ELTPARAGRAPHE000176"></a>

- Para crear el control Botón de envío de correos electrónicos:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_champ_bouton_WB_GAF.jpg).

	2. Haga clic en la ubicación en la que desea crear el control Botón (por ejemplo, en la parte inferior de la página).

	3. Seleccione el control y cambie el texto (presione Entrar, por ejemplo). Introduzca "Send".

	4. Edite el código del control (F2).

	5. Introduzca los siguientes códigos en el evento "Clic" del servidor:

		- el código para establecer la conexión e iniciar la sesión SMTP:
						
			```wl
			MySession is emailSMTPSession
			MySession.ServerAddress = "smtpserver"
			// Type the address of SMTP server
			MySession.Name = "user_name"
			// Type the username (if necessary)
			MySession.Password = ""
			// Type the password (if necessary)
			
			// Starts the SMTP session
			IF MySession.StartSession() = False THEN
				ToastDisplay("Unable to connect to the SMTP server.", ErrorInfo())
				RETURN
			END
			```
Este código utiliza una variable avanzada de tipo [emailSMTPSession](../WDLang3/1000018765.md). Las diferentes propiedades de esta variable definen las características de la sesión SMTP. Luego, se utiliza la función [&lt;Sesión&gt;.StartSession](../WDLang3/1000022306.md) para iniciar la sesión.

		- el código para preparar el correo electrónico:
						
			```wl
			Suggestion is Email
			Suggestion.Sender = EDT_Sender
			Suggestion.Subject = EDT_Subject
			Suggestion.HTML = EDT_HTML
			Suggestion.Message = HTMLToText(EDT_HTML)
			Suggestion.Recipient = "developer@mysite"
			```
Este código utiliza una variable de tipo [Email](../WDLang3/1000018713.md). Las diferentes propiedades de esta variable definen las características del correo electrónico que se va a enviar. Este código asocia el contenido de los diferentes controles de la página con las propiedades de la variable Email.

		- el código para enviar el correo electrónico:
						
			```wl
			// Send the email
			IF MySession.SendMessage(Suggestion) = False THEN
				ToastDisplay("Sending error", ErrorInfo())
			ELSE
				ToastDisplay("Thank you for your suggestion.")
			END
			```
El correo electrónico se envía usando la función [&lt;Sesión&gt;.SendMessage](../WDLang3/1000022314.md), que se utiliza con la variable que contiene las características de la sesión SMTP. A esta función se le pasa como parámetro una variable con las características del correo electrónico que se va a enviar.
						Si se envía el correo electrónico, se muestra un mensaje Toast indicando que el correo electrónico se ha enviado. Un Toast es un mensaje corto que aparece durante unos segundos.

		- el código para cerrar la sesión SMTP:
						
			```wl
			// Close the SMTP session
			MySession.CloseSession()
			```
 Este código cierra la sesión con la función [&lt;Sesión&gt;.CloseSession](../WDLang3/1000022286.md). Cierre el editor de código.







- Guarde la página y el código (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) o Ctrl + S).


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | El proceso de envío de correos electrónicos se da a título informativo. En un sitio real, se recomienda comprobar los parámetros introducidos, procesar los errores, guardar un archivo de registro, etc. |





<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Mejoras en la página
<a name="mejoras_pagina_ELTTEXTE000571"></a>
Vamos a mejorar la página Popup:

- Agregar un control Botón para cerrar la página Popup.

- Abrir la página Popup desde la página "PAGE_List_of_products".



<a name="NOTE4_2"></a>


### Cerrar la página Popup
<a name="cerrar_pagina_popup_ELTPARAGRAPHE000250"></a>

- Para agregar un control Botón que permita cerrar la página Popup:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en "Botón".

	2. Haga clic en la página, en la ubicación en la que desea crear el control Botón (por ejemplo, en la parte inferior, a la derecha del botón "SEND").  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Popup%20Email%20-%20HC%20N%B0005.jpg&type=thumb)


	3. Seleccione el control y presione la tecla Entrar. El texto pasa a modo de edición. Introduzca "Cancel" y valide.

4. Abra los eventos asociados al control (F2).

5. Introduzca el siguiente código en el evento Clic (navegador):
			
		```wl
		PopupClose()
		```
La función [PopupClose](../WDLang2/1000019789.md) cierra la Popup.




- [PopupClose](../WDLang2/1000019789.md) es una función Navegador, por lo tanto, solo se puede ejecutar en los navegadores: no es necesario volver al servidor. Vamos a modificar el tipo del botón "Cancel":

	1. Haga doble clic en el botón "Cancel" para abrir la ventana de descripción.

	2. En la pestaña "General", en la sección "Acción del botón":

		- para el "tipo", seleccione "Ejecutar solo código de clic Navegador".  

		- para "Durante la acción", seleccione "No enviar nada al servidor".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Popup%20Email%20-%20HC%20N%B0004.jpg&type=thumb)





Veamos cómo abrir la página Popup.
<a name="NOTE4_3"></a>


### Abrir la página Popup
<a name="abrir_pagina_popup_ELTPARAGRAPHE000296"></a>

La página Popup de envío de correos electrónicos se abrirá desde el menú de la página "PAGE_List_of_products".



- Abra la página "PAGE_List_of_products": en las pestañas de documentos abiertos del editor, haga clic en "PAGE_List_of_products".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Popup%20Email%20-%20HC%20N%B0003.jpg)





- Ahora vamos a crear un control Enlace para enviar una sugerencia:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en "Enlace".

	2. A continuación, haga clic en la parte superior de la página (debajo del control "Notifications"): el control Enlace se crea.

	3. Cambie el título por: "Send a suggestion" y valide.

	4. Haga doble clic en el control para abrir la ventana de descripción.

	5. En la sección "Acción del enlace": 

		- Seleccione el tipo "Ejecutar solo código de clic Navegador". 

		- Para "Durante la acción", seleccione "No enviar nada al servidor".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Popup%20Email%20-%20HC%20N%B0002.jpg&type=thumb)





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | **¿Por qué no abrimos la ventana popup desde el menú del modelo de páginas?**<br><br>La página Popup está vinculada a "PAGE_List_of_products". Solo se puede utilizar desde esta página.<br><br>Para utilizar una Popup desde un modelo de páginas, esta debe crearse a partir del modelo de páginas. |







- Guarde la página y el código (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Sauver_WB_GAF.jpg) o Ctrl + S).




- Pruebe la página (haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Page_WB_GAF.jpg) en los botones de acceso rápido) y abra la Popup para enviar una sugerencia.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P5_Popup%20Email%20-%20HC%20N%B0001.jpg&type=thumb)





- Cierre el navegador. 


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | **¿Por qué no aparece el enlace en el navegador en la ubicación especificada?**<br><br>En el editor de páginas, el control Enlace está situado encima del control de búsqueda, pero en tiempo de ejecución aparece encima de la opción "ADD A PRODUCT". Esta diferencia se debe al anclaje del control Enlace. <br>En el editor de páginas, aparecen varias flechas rojas en el encabezado de la página. Estas flechas indican que los controles están anclados. Veremos los anclajes en detalle en la lección [Conceptos avanzados](../TutoWB/1410087506.md). El control Enlace que creamos no está anclado y sigue el movimiento de los controles a su alrededor.<br><br>- Para anclar el control Enlace a la derecha (y evitar que se mueva): <br><br>	1. Seleccione el control Enlace. <br><br>	2. Haga clic derecho en el control y seleccione "Anclaje" en el menú contextual. <br><br>	3. En la ventana que aparece, seleccione la opción ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P7_Ancrages%20-%20HC%20N%B0006%202.jpg) y valide.<br><br><br><br><br><br> |





| [Lección anterior](../TutoWB/1410087495.md) | [Tabla de contenido](../TutoWB/1410087510.md) | [Siguiente lección](../TutoWB/1410087497.md) |
| --- | --- | --- |




