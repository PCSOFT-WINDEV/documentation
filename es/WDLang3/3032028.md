


## EmailStartSession (Función)



<a name="XUse"></a>
<a name="Use"></a>
<a name="description"></a>
Inicia una sesión de gestión de Email en función del modo de gestión seleccionado:

- correos electrónicos gestionados mediante los protocolos POP3, SMTP o IMAP: la función **EmailStartSession** permite abrir la sesión POP3, SMTP o IMAP.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) correos electrónicos gestionados a través del cliente MS Exchange: **EmailStartSession** inicia la sesión de MS Exchange. En este caso, al utilizar la función **EmailStartSession**, el directorio actual se modifica automáticamente.


![Java](https://doc.pcsoft.fr/ext/images/us/JAVA.png) Sólo se admiten las sesiones POP3 y SMTP.**Observaciones**:

- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Para iniciar una sesión con el software de mensajería de Lotus Notes, utilice [EmailStartNotesSession](../WDLang3/3032121.md).

- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Para iniciar una sesión con el software de mensajería Outlook, utilice [EmailStartOutlookSession](../WDLang3/3032128.md).

- Para iniciar una sesión de lectura de correos electrónicos (sólo protocolo POP3), utilice [EmailStartPOP3Session](../WDLang3/3032022.md).

- Para iniciar una sesión de envío de correos electrónicos (sólo protocolo SMTP), utilice [EmailStartSMTPSession](../WDLang3/3032025.md). Esta función también se puede utilizar para iniciar una sesión SMTP autenticada.



<a name="sample_code"></a>

## Ejemplo
<a class="notetitle" target="_blank" href="$DOC$=1000003032028&name=emailstartsession_funcion&product=WD">Ver ejemplos adicionales</a>
<a name="Example1"></a>

```wl
// Send an email via the POP3 protocol 
IF EmailStartSession(USER, PASSWORD, ...
		"pop3.gmail.com", "smtp.gmail.com") = True THEN
	UserName = USER
ELSE
	UserName = ""
	Error("Unable to establish the connection")
END
```

<a name="XSYNTAX"></a>

## Sintaxis
<a name="SYNTAX1"></a>

### Iniciar una sesión de Email (POP3, SMTP, IMAP, Notes o Outlook)

`<Result> = EmailStartSession(<Session>)`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True</u></u></u></u> si la sesión se abrió correctamente,

- <u><u><u><u>False</u></u></u></u> en caso contrario. Si se produce un error, la variable [ErrorOccurred](../WDLang1/3087001.md) se pone en <u><u><u><u>True</u></u></u></u>. 
	Para obtener más información sobre el error, utilice la función [ErrorInfo](../WDLang1/3013008.md) con la constante *errMessage*.




**`<Session>: (emailPOP3Session, emailSMTPSession, emailIMAPSession, emailNotesSession o emailOutlookSession Variable)`**

Nombre de la variable que contiene la description de los parámetros de conexión del servidor Email. Todas las propiedades de conexión se especifican en las propiedades de Variable. Para obtener más información, consulte:

- variable de tipo [emailPOP3Session](../WDLang3/1000018759.md): para iniciar una sesión hacia un servidor POP3 para leer los mensajes.

- variable de tipo [emailIMAPSession](../WDLang3/1000018957.md): para iniciar una sesión hacia un servidor IMAP con el fin de leer los mensajes.

- variable de tipo [emailSMTPSession](../WDLang3/1000018765.md): para iniciar una sesión hacia un servidor SMTP para enviar mensajes.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png) variable de tipo [emailNotesSession](../WDLang3/1000018768.md): para iniciar una sesión hacia un servidor Lotus Domino para poder enviar mensajes manipular.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png) variable de tipo [emailOutlookSession](../WDLang3/1000018767.md): para iniciar una sesión hacia el software de mensajería Outlook.








|   |
| --- |
| **Observación**: Esta sintaxis se mantiene para la compatibilidad con versiones anteriores.. Le recomendamos que utilice las variables [emailOutlookSession](../WDLang3/1000018767.md) o [EmailStartOutlookSession](../WDLang3/3032128.md).<br><a name="SYNTAX3"></a><br>![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png) <br>### Iniciar una sesión de Email con MS Exchange<br><br>`<Result> = EmailStartSession(<Profile> [, <Asynchronous>])`<br>---<br><br>**`<Result>: (Integro)`**<br><br><br><br>- Identificador del actual período de sesiones de Email. <br><br>- 0 (o <u><u><u><u>False</u></u></u></u>) si se produce un error. La variable [ErrorOccurred](../WDLang1/3087001.md) se establece en <u><u><u><u>True</u></u></u></u>. Para obtener más información sobre el error, utilice la función [ErrorInfo](../WDLang1/3013008.md) con la constante *errMessage*.<br><br><br><br><br>**`<Profile>: (Cadena de caracteres)`**<br><br>Identifica el perfil de conexión (véanse las Notas).<br><br>Si este parámetro corresponde a una cadena vacía ("""):<br><br>- si hay varios perfiles definidos en el ordenador actual, **EmailStartSession** muestra una ventana con todos los perfiles entre los que el usuario puede elegir el suyo.<br><br>- si se define un único perfil en el ordenador actual, **EmailStartSession** selecciona automáticamente este perfil.<br><br><br><br><br>**`<Asynchronous>: (Opcional constante o booleana)`**<br><br><br><br><br>\   \   \<br>\ --- \ --- \<br>\ *emailAsynchronous* o <u><u><u><u>True</u></u></u></u> \ Los correos electrónicos enviados durante la sesión iniciada con la función **EmailStartSession** deben transmitirse en modo asíncrono (ver Notas). \<br>\ *emailSynchronous* o <u><u><u><u>False</u></u></u></u><br>(Valor predeterminado) \ Los correos electrónicos enviados durante la sesión iniciada con la función **EmailStartSession** deben transmitirse en modo síncrono (ver Notas). \<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Este parámetro debe corresponder a *emailSynchronous* o <u><u><u><u>False</u></u></u></u>. <br><br><br> |




|   |
| --- |
| **Observación**: Esta sintaxis se mantiene para la compatibilidad con versiones anteriores.. Le recomendamos que utilice las variables [emailPOP3Session](../WDLang3/1000018759.md), [emailSMTPSession](../WDLang3/1000018765.md) o [EmailStartPOP3Session](../WDLang3/3032022.md) y [EmailStartSMTPSession](../WDLang3/3032025.md).<br><a name="SYNTAX2"></a><br><br>### Iniciar una sesión de Email usando los protocolos POP3 y SMTP simultáneamente<br><br>`<Result> = EmailStartSession(<Username> , <Password> , <Address of POP3 server> [, <Address of SMTP server> [, <Number of POP3 port> [, <Number of SMTP port> [, <Asynchronous>]]]])`<br>---<br><br>**`<Result>: (booleano)`**<br><br><br><br>- <u><u><u><u>True</u></u></u></u> si la sesión se abrió correctamente,<br><br>- <u><u><u><u>False</u></u></u></u> en caso contrario. Si se produce un error, la variable [ErrorOccurred](../WDLang1/3087001.md) se pone en <u><u><u><u>True</u></u></u></u>. Para obtener más información sobre el error, utilice la función [ErrorInfo](../WDLang1/3013008.md) con la constante *errMessage*.<br><br><br><br><br>**`<Username>: (Cadena de caracteres)`**<br><br>Identifica al usuario. Este nombre es suministrado por el proveedor de servicios o por el administrador de la red.. Este nombre se usará para identificar la sesión de Email en las diferentes funciones para la gestión de Email.<br><br>**`<Password>: (Cadena de caracteres)`**<br><br>Contraseña de usuario. Esta contraseña es proporcionada por el proveedor de servicios o por el administrador de la red.<br><br>**`<Address of POP3 server>: (Cadena de caracteres)`**<br><br>IP Address del servidor Email (protocolo de entrada). Esta IP Address es suministrada por el proveedor de servicios o por el administrador de la red. Esta IP Address puede tener el siguiente formato:<br><br>- IP Address en formato XXX.XXX.XXX.XXX (125.5.110.100 por ejemplo).<br><br>- IP Address que contiene el nombre del servidor (pop3.freesbee.eu por ejemplo). Se recomienda esta sintaxis.<br><br>- IP Address devuelta por [NetIPAddress](../WDLang3/3056023.md).<br><br><br><br><br>**`<Address of SMTP server>: (Cadena de caracteres opcional)`**<br><br>IP Address del servidor Email (protocolo de salida). Esta IP Address es suministrada por el proveedor de servicios o por el administrador de la red.<br>Esta Address debe ser especificada sólo si la cuenta POP3 y la cuenta SMTP no pasan por el mismo ordenador.<br><br>**`<Number of POP3 port>: (Entero opcional)`**<br><br>Identifica el puerto utilizado para el protocolo POP3 (110 por Default).<br><br>**`<Number of SMTP port>: (Entero opcional)`**<br><br>Identifica el puerto utilizado para el protocolo SMTP (25 por Default).<br><br>**`<Asynchronous>: (Opcional constante o booleana)`**<br><br><br><br><br>\   \   \<br>\ --- \ --- \<br>\ *emailAsynchronous* o <u><u><u><u>True</u></u></u></u> \ Los correos electrónicos enviados durante la sesión iniciada con la función **EmailStartSession** deben transmitirse en modo asíncrono (ver Notas). \<br>\ *emailSynchronous* o <u><u><u><u>False</u></u></u></u><br>(Valor predeterminado) \ Los correos electrónicos enviados durante la sesión iniciada con la función **EmailStartSession** deben transmitirse en modo síncrono (ver Notas). \<br><br>![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Este parámetro debe corresponder a *emailSynchronous* o <u><u><u><u>False</u></u></u></u>. <br><br><br> |


<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Observaciones


### Protocolos POP3 y SMTP
<a name="protocolos_pop3_smtp_ELTPARAGRAPHE000432"></a>

Los diferentes parámetros que se pasan a **EmailStartSession** son suministrados por el proveedor de servicios INTERNET o por el administrador de la red.

Se necesita una conexión INTERNET para gestionar los correos electrónicos. Pueden ocurrir varios casos:

- El usuario utiliza una conexión directa a INTERNET (cable o ADSL): no se requiere ninguna operación específica.

- El usuario utiliza un módem para conectarse a INTERNET: [NetOpenRemoteAcceso remoto](../WDLang3/3056026.md) establece la conexión con INTERNET.


Por defecto, si sólo se especifica la IP Address del servidor POP3, esta Address será utilizada por el servidor Email que utiliza SMTP. El IP Address del protocolo SMTP debe especificarse sólo si la cuenta POP3 y la cuenta SMTP no utilizan el mismo ordenador.
<a name="NOTE0_2"></a>


### SMTP autenticado
<a name="smtp_autenticado_ELTPARAGRAPHE000453"></a>

La autenticación SMTP no puede realizarse con la función **EmailStartSession**. Para iniciar una sesión POP3 y una sesión SMTP autentificada al mismo tiempo, debe utilizar tanto [EmailStartPOP3Session](../WDLang3/3032022.md) como [EmailStartSMTPSession](../WDLang3/3032025.md).




### Conexión con autenticación de dos factores
<a name="conexion_con_autenticacion_dos_factores_ELTPARAGRAPHE000467"></a>

Cada vez más proveedores ofrecen cuentas seguras de Email (SMTP/IMAP) con autenticación de dos factores.

El principio es el siguiente: 

- Conectar con el proveedor Email mediante OAuth: esta conexión proporciona una Token. 

- Utilice el token para conectarse a los buzones IMAP o SMTP Email.




Veamos un ejemplo de código que se puede utilizar:


```wl
// Example of IMAP connection with a Gmail account
// and two-factor authentication
OAuthGoogleCnt is OAuth2Parameters
gMyIMAPSession is emailIMAPSession

// IMAP server parameters
gMyIMAPSession.ServerAddress = "imap.gmail.com"
gMyIMAPSession.Option = optionSSL
MyIMAPSession.Port = "993"

// OAuth connection parameters
OAuthGoogleCnt.ClientID = "Application ID"
OAuthGoogleCnt.ClientSecret = "Secret application ID"
OAuthGoogleCnt.AuthURL = "https://accounts.google.com/o/oauth2/auth"
OAuthGoogleCnt.TokenURL = "https://accounts.google.com/o/oauth2/token"
OAuthGoogleCnt.Scope = "https://mail.google.com/"
OAuthGoogleCnt.RedirectionURL = "http://localhost:9000"
OAuthGoogleCnt.ResponseType = "code"

// OAuth authentication

gMyIMAPSession.AuthToken = AuthIdentify(OAuthGoogleCnt)

// If the authentication was successful, log in to email inbox.
IF gMyIMAPSession.AuthToken <> Null THEN
	IF EmailStartSession(gMyIMAPSession) THEN
	// Session started
	ELSE
	// Error starting the session.
	END
ELSE
	// Authentication error.
END
```







<a name="NOTE0_3"></a>


### Timeout
<a name="timeout_ELTPARAGRAPHE000477"></a>

El tiempo de espera puede ser set utilizando [EmailSetTimeOut](../WDLang3/3032001.md).
<a name="NOTE0_4"></a>
![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png)![Windows](https://doc.pcsoft.fr/ext/images/us/WINDOWS.png)![Código de Usuario (UMC)](https://doc.pcsoft.fr/ext/images/us/MCU.png) 

### Creación de un perfil de Outlook Exchange
<a name="creacion_perfil_outlook_exchange_ELTPARAGRAPHE000491"></a>

Para iniciar una nueva sesión de Email, se debe definir un "perfil". Este "perfil" se define en la configuración de la conexión INTERNET.

Para crear un perfil:

1. Abre el panel de control.

2. Haga doble clic en la opción "Email".

3. Haga clic en el botón "Mostrar los perfiles".

4. En la ventana "Elegir un perfil", haga clic en el botón "Añadir".

5. Dar un nombre al perfil. Este nombre se utilizará en los programas WINDEV.

6. Selecciona "Añadir una nueva cuenta de Email".

7. Seleccione el servicio "Microsoft Exchange Server".

8. Introduzca el nombre del servidor Microsoft Exchange.



<a name="NOTE0_6"></a>
<a name="NOTE0_7"></a>
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/us/UNIVERSALAPP.png) 

### Funcionalidad de aplicación requerida
<a name="funcionalidad_aplicacion_requerida_ELTPARAGRAPHE000555"></a>

Cuando se utiliza esta función, se debe declarar una funcionalidad de la aplicación en el asistente de generación de aplicaciones.

Característica necesaria: Redes domésticas y profesionales

Esta característica permite a las aplicaciones utilizar accesos entrantes y salientes a las redes familiares y corporativas.. 
<a name="NOTE0_8"></a>


### Gmail: ¿Qué hacer si una conexión a Gmail (SMTP, IMAP, POP3) falla con un error de Certificate?
<a name="gmail_¿que_hacer_una_conexion_gmail_smtp_imap_pop3_falla_con_error_certificate_ELTPARAGRAPHE000567"></a>

Desde agosto de 2017, una nueva Certificate fue desplegada por Google: Google INTERNET Authority G3. Desafortunadamente, el API de Windows para comprobar las Certificate s no valida esta Certificate.

Por lo tanto, iniciar una sesión POP3, IMAP o SMTP puede fallar con el error "La cadena Certificate no fue emitida por una autoridad de confianza".

Para validar la Certificate, todo lo que tienes que hacer es modificar el modo de gestión de los correos electrónicos. La función [EmailConfigure](../WDLang3/1000022269.md) de WLanguage permite cambiar este modo y dejar de utilizar la API de Windows que bloquea esta Certificate. Se debe agregar el siguiente código antes de iniciar la sesión con la función **EmailStartSession**:

```wl
// Enable the multi-platform implementation
EmailConfigure(emailParameterMode, 1)
```


Observación: A partir de la versión 23 Actualización 1, la llamada a [EmailConfigure](../WDLang3/1000022269.md) ya no es necesaria: WLanguage utiliza automáticamente el modo de gestión de los correos electrónicos adaptados a la sesión.

<a name="XComponent"></a>

## Componente:
wd280com.dll
