
## Gestión de Android Permission
			

<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000149"></a>
Las aplicaciones Android requieren permisos para proporcionar ciertas características que pueden requerir el acceso a datos sensibles o funcionalidades sensibles del dispositivo: hacer una foto, acceder a la ubicación, hacer una lista de contactos, etc.

WINDEV Mobile detecta automáticamente los permisos necesarios según las características utilizadas por la aplicación (funciones de WLanguage, controles, etc.). 

También puede añadirlos o eliminarlos manualmente desde la generación asistente. En el caso de los Permission s en tiempo de ejecución, el Android framework gestiona automáticamente la solicitud de Permission del usuario cuando se utiliza una función relevante.

Todo es automatic. 

Sin embargo, en algunas situaciones, el desarrollador necesita gestionar los permisos de la aplicación de forma más precisa. Ejemplo simple: el desarrollador necesita saber si ya se ha concedido una Permission. Si no es el caso, el desarrollador necesita mostrar una ventana que explique al usuario por qué tiene que conceder un Permission determinado para poder utilizar una función de la aplicación. 

WINDEV Mobile ofrece funciones WLanguage y un tipo Variable para gestionar los permisos desde el código. 

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Cómo funcionan los permisos
<a name="como_funcionan_los_permisos_ELTTEXTE000173"></a>
Todos los permisos requeridos por una aplicación deben ser declarados en el manifiesto de la aplicación. Todos estos permisos se pueden ver una vez que la aplicación se ha instalado en el dispositivo yendo a la información de la aplicación en la configuración del dispositivo.

La lista de permisos existentes puede encontrarse en: [https://developer.android.com/reference/android/Manifest.Permission](https://developer.android.com/reference/android/Manifest.permission).

Existen diferentes tipos de Permission:

- Permisos de instalación.

- Permisos de ejecución.







### Permisos de instalación
<a name="permisos_instalacion_ELTPARAGRAPHE000040"></a>

Estos permisos permiten a la aplicación acceder a datos o utilizar funciones que afectan mínimamente al sistema o a otras aplicaciones. Cuando se declara uno de estos Permission s en el manifiesto de la aplicación, el sistema concede automáticamente a la aplicación este Permission cuando el usuario instala la app, sin ninguna intervención. 


### Permisos de funcionamiento
<a name="permisos_funcionamiento_ELTPARAGRAPHE000045"></a>

Los permisos en tiempo de ejecución, también conocidos como permisos peligrosos, permiten a la aplicación acceder a datos o utilizar funcionalidades restringidas: datos privados del usuario, ubicación, micrófono o cámara, etc.. Por lo tanto, se necesita una acción del usuario para conceder a la aplicación esta Permission. 

Si la Permission aún no ha sido concedida, y la app intenta acceder a ciertas funcionalidades o datos sensibles, aparece un aviso pidiendo al usuario que conceda la Permission a la aplicación.

- **Si el usuario concede este Permission**, la funcionalidad o los datos pasan a ser accesibles y ya no se solicitará Permission a menos que el usuario revoque este Permission en la configuración de la aplicación.

- **Si el usuario deniega este Permission**, la característica o los datos no serán accesibles (normalmente esto hace que la función WLanguage correspondiente falle) y el Permission se solicitará de nuevo la próxima vez.

- A partir de Android 11, el usuario también puede **conceder un Permission temporalmente** ("Sólo esta vez"). En este caso, la Permission es válida mientras la ventana actual siga siendo Visible. Si la solicitud se envía al fondo, la Permission sólo es válida durante un breve período. 
	Este tipo de Permission sólo está disponible para los Permission de localización, cámara y micrófono.





### Caso especial: Ubicación de Background
<a name="caso_especial_ubicacion_background_ELTPARAGRAPHE000058"></a>

Para permitir que una aplicación acceda a la ubicación del dispositivo en el Background, debe hacer lo siguiente: 

1. Solicitar el permiso de localización (permiso ACCESO_[FINO/GRUESO]_UBICACIÓN a través de [PermissionRequest](../WDLang3/1410087423.md) con la constante *permLocation* o *permFineLocation*). 

2. Si se concede el permiso anterior, solicitar acceso a la ubicación en segundo plano (permiso ACCESS_Background_LOCATION mediante la función [PermissionRequest](../WDLang3/1410087423.md) con la constante *permBackgroundLocation*). 


En este caso, aparece una ventana especial de solicitud de Permission.  Esta ventana incluye opciones que permiten acceder a la posición del dispositivo: 

- Durante el uso de la aplicación,

- Sólo que esta vez,

- Denegar, 

- Cambiar la configuración de la aplicación. 


El usuario puede permitir que la aplicación acceda a la localización cuando está Active ("Mientras usa la app"), temporalmente, denegar el acceso, o ir a la configuración de la aplicación para permitir el acceso a la localización en el Background.

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Gestión avanzada de Permission en WLanguage
<a name="gestion_avanzada_permission_wlanguage_ELTTEXTE000215"></a>
Para gestionar con precisión los permisos, WLanguage incluye: 

- Varias funciones: 
	


|   |   |
| --- | --- |
| [PermissionList](../WDLang3/1410087429.md) | Devuelve uno o todos los permisos declarados por la aplicación. |
| [PermissionRequest](../WDLang3/1410087423.md) | Pide al usuario que conceda una aplicación Permission. |

- El tipo Permission: 
	


|   |   |
| --- | --- |
| [Permission](../WDLang3/1410087419.md) | El tipo **Permission** representa un Permission solicitado por la aplicación (y por tanto declarado en el manifiesto). |





