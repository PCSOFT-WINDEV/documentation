


## inAppListPurchase( Función)



<a name="XUse"></a>
<a name="Use"></a>
<a name="description"></a>
Devuelve la lista: 

- de los productos de aplicación comprados por el usuario y no consumidos.

- de las suscripciones de Active para el usuario.





<a name="Example1"></a>
<a name="sample_code"></a>

## Ejemplo


```wl
// Retrieve the list of purchases for the user 
inAppListPurchase(ListPurchase, inAppPurchaseID)
```

```wl
PROCEDURE ListPurchase(bSuccess is boolean, sPurchaseList is string)
	IF NOT bSuccess THEN
		ToastDisplay(ErrorInfo())
	ELSE
		// Browses the purchases performed
		FOR EACH STRING sPurchaseInfo OF sPurchaseList SEPARATED BY CR
			// Retrieves the product identifier
			sProductID is string = ExtractString(sPurchaseInfo, 1, TAB)
			// Retrieves the purchase identifier
			sPurchaseID is string = ExtractString(sPurchaseInfo, 2, TAB)
			// Consumes the product if necessary
			IF sProductID = "PRODUCT_ID" THEN
				inAppConsumeProduct(sProductID, ConsumeProduct)	
			END
		END
	END
END
```

```wl
PROCEDURE ConsumeProduct(nSuccess is boolean)
	IF NOT bSuccess THEN
		ToastDisplay(ErrorInfo())
	ELSE
		// Consume the product in the application
		...
	END
END
```

<a name="XSYNTAX"></a>

## Sintaxis
<a name="SYNTAX1"></a>

`<Result> = inAppListPurchase(<Procedure> [, <Type of information>])`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True</u></u></u></u> si se realizó la solicitud para obtener la lista de compras,

- <u><u><u><u>False</u></u></u></u> en caso contrario. Para obtener más información sobre el error, utilice la función [ErrorInfo](../WDLang1/3013008.md).




**`<Procedure>: (Cadena de caracteres)`**

Nombre del WLanguage Procedure ("callback") ejecutado cuando se recibe la lista de compras. Este procedimiento tiene el siguiente formato: 

```txt
PROCEDURE <ProcedureName>(<Success> is boolean, <ListPurchase> is string)
```
donde: 

- &lt;El éxito es booleano: 

	- <u><u><u><u>True</u></u></u></u> si se pudo obtener la lista de compras realizadas por el usuario,

	- <u><u><u><u>False</u></u></u></u> en caso contrario. Para get más detalles sobre el error, utilice [ErrorInfo](../WDLang1/3013008.md) antes de cualquier otra llamada a una función de WLanguage (esto reiniciaría el error).




- &lt;ListPurchase&gt; es una cadena de caracteres que contiene información sobre cada una de las compras realizadas por el usuario.. La información devuelta para cada compra tiene el siguiente formato (según la información solicitada): 
	
	```txt
	<Product identifier> + TAB + <Order number> + TAB + <Purchase date> + 
	TAB + <Purchase identifier> + TAB + <Automatic renewal> + TAB +
	<End date of subscription>
	```



Si se enumeran varias compras, se separan por caracteres CR (Carriage Return).

**`<Type of information>: (Constante opcional de tipo Integer)`**

Información adicional que será devuelta por cada compra listada (además del identificador del producto): 


|   |   |
| --- | --- |
| *inAppAutoRenewal* | <br><br>- 1 si la suscripción se renueva automáticamente en la próxima fecha de facturación. <br><br>- 0 si la suscripción fue cancelada por el usuario o si la compra no corresponde a una suscripción. <br><br><br> |
| *inAppOrderID* | Número de pedido correspondiente a la compra. |
| *inAppPurchaseDate* | Fecha de compra en formato AAAAMMDDD.<br><br>Para una suscripción: fecha de compra de la suscripción. |
| *inAppPurchaseID* | Identificador de la compra. <br><br><br><br> |
| *inAppSubscriptionEndDate* | Fecha de finalización de la suscripción en formato AAAAMMDDD.<br><br> |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Observaciones


### Casos especiales
<a name="casos_especiales_ELTPARAGRAPHE000138"></a>

- La función **inAppListPurchase** no tiene ningún efecto si se ejecuta desde el simulador o emulador de Android.



<a name="NOTE0_2"></a>


### Gestión de suscripciones
<a name="gestion_suscripciones_ELTPARAGRAPHE000166"></a>



<a name="XComponent"></a>

## Componente:
wd280android.aar
