


## Creación, generación y despliegue de un servicio web
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000298"></a>
WINDEV y WEBDEV le permiten generar servicios web directamente. Entonces, estos Webservices pueden ser utilizados en los proyectos WINDEV, WEBDEV, WINDEV Mobile o en cualquier otro idioma.

Un servicio web incluye una set de funciones SIN interfaz. De hecho, este tipo de módulo que se ejecuta en un servidor, no hay necesidad de desarrollar una interfaz de usuario. Por lo tanto, el servicio web incluirá funciones WLanguage organizadas en conjuntos de procedimientos.  Estas funciones pueden manipular una base de datos (HFSQL, Oracle, AS/400, ....). 

**Atención**: El despliegue de un servicio web WINDEV o WEBDEV requiere el uso de un servidor de aplicaciones WEBDEV. A través de este modo de distribución, los Webservices creados con WINDEV/WEBDEV presentan varios tipos de beneficios: 

- Servicios web desplegados en un servidor de aplicaciones WEBDEV (compatible con todos los servidores web).

- Varios modos de despliegue del servicio web (medios físicos, FTP, Cloud).

- Es posible una gran carga de trabajo.

- Webservices que pueden funcionar en todas las versiones de Windows (32 y 64 bits) así como en Linux.




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## ¿Cómo hacer que un servicio web esté disponible?
<a name="¿como_hacer_que_servicio_web_este_disponible_ELTTEXTE000322"></a>
Para que un servicio web esté disponible, debes..:

1. [Crear un servicio web](#NOTE3_1). 

2. [Generar un servicio web](#NOTE4_1).

3. [Desplegar el servicio web en un servidor de aplicaciones WEBDEV](#NOTE5_1).




Observación: Para ejecutar la prueba del Webservice, tiene la posibilidad de [desplegarlo localmente para la prueba](#NOTE5_2). 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Creación del servicio web
<a name="creacion_del_servicio_web_ELTTEXTE000346"></a>
Para crear un servicio web: 

1. Cree un proyecto WINDEV o WEBDEV cuyo tipo sea Webservice o una configuración de Webservice en un proyecto existente.

	- Al crear un proyecto, seleccione "Servicio web SOAP o REST".. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_Creation_prj.gif&type=thumb)


	- Para crear una configuración de proyecto de tipo Webservice, en la pestaña "Proyecto", en el grupo "Configuración del proyecto", despliegue "Nueva configuración" y seleccione "Webservice". 

2. Crear uno o varios conjuntos de procedimientos: 

	- En el explorador de proyectos, seleccione la carpeta "Procedimientos".

	- Seleccione "Nuevo" en el menú contextual..
			<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_Creation_Coll.gif)





3. Crear los procedimientos globales o las funciones correspondientes a los procesos que deben realizarse en el servidor.. 
	
	```wl
	// Global Addition procedure
	PROCEDURE Addition(nNumber1 is int, nNumber2 is int)
	
	nResult is int
	nResult = nNumber1 + nNumber2
	
	RESULT nResult
	```

	Cada Procedure global puede ser ejecutada por el servidor de aplicaciones WEBDEV. 
	
	**Observaciones**: 

	- Si los parámetros de los procedimientos no tienen ningún tipo, serán recibidos automáticamente como cadenas de caracteres Unicode. Por lo tanto, debe especificar el tipo de los parámetros que deben ser diferentes de una cadena de caracteres Unicode. 

	- Los procedimientos pueden marcarse como public o private. Una Procedure pública puede ser usada en los proyectos que importarán el Servicio Web. No se puede utilizar una Procedure privada en los proyectos que importarán el Webservice (la Procedure no será Visible en el explorador del proyecto). Para marcar una Procedure como pública o privada, utilice el menú contextual en el nombre de la Procedure en el explorador del proyecto.

	- Los procedimientos pueden devolver clases, estructuras, arrays de estructuras o arrays de clases. Los arrays devueltos se limitan a una dimensión.


 **Atención**: El Webservice no debe tener GUI (ni ventana, reporte, ventana de salida o cuadro de diálogo). También está limitado por los derechos definidos en el servidor Web (cuenta "INTERNET guest" en Windows).

4. Escriba (si es necesario) el código de inicialización y el código de cierre del proyecto. Estos dos códigos se ejecutarán respectivamente al cargar y al descargar la biblioteca del Webservice.





### Gestión de contextos
<a name="gestion_contextos_ELTPARAGRAPHE000094"></a>

Para mantener el valor de las variables globales durante las llamadas sucesivas a un servicio web, tiene la capacidad de utilizar una gestión de contextos.. La gestión de contextos se realiza en disco: el valor de las diferentes variables se almacena en un archivo en el servidor. Un identificador de contexto se utiliza para recuperar el contexto almacenado durante una próxima llamada al servicio web.. Este identificador se almacena en una cabecera SOAP en el ordenador del cliente.. Este identificador garantiza la seguridad de los datos almacenados.

Este modo de operación es el siguiente: 

- El identificador se almacena en una cabecera SOAP. Cuando se utiliza [DeclararServicio webContexto](../WDLang3/1000019460.md), se modifica el WSDL y se indica que el formato acepta una sección de cabecera con un nombre preciso y un formato específico. 

- El cliente transmite esta información. 

	- Durante la primera llamada, el valor está vacío, el servidor crea una nueva sesión. 

	- Si falta el valor, el servidor crea una nueva sesión. 




- El servidor devuelve la información solicitada. 




Poner en práctica una gestión de contextos: 

1. Utilice [DeclararServicio webContexto](../WDLang3/1000019460.md) para almacenar las variables deseadas. Se recomienda utilizar esta función en el código de inicialización del proyecto (para las variables del proyecto) y/o en el código de inicialización de conjuntos de procedimientos o clases.. En la mayoría de los casos, esta función debe ser utilizada en la Process donde las variables son declaradas e inicializadas.
	Observaciones: 

	- El contexto siempre se guarda en el disco y se transmite a través de una cabecera SOAP.. 

	- **DeclareWebserviceContext** usa los contextos en el disco. Los valores de las variables siempre se restauran.

	- El tamaño total de los valores de las diferentes variables no está limitado.

	- La función **DeclareWebserviceContext** se puede utilizar para los datos confidenciales (contraseña de usuario, por ejemplo).

	- Si se guardan dos variables con el mismo nombre (una en el proyecto y otra en una Page, por ejemplo), las dos variables se guardan independientemente.

	- La función **DeclareWebserviceContext** devuelve <u><u><u><u>False</u></u></u></u> si no se restauró una de las variables.

	- Todas las variables pasadas a **DeclareWebserviceContext** durante una llamada a un servicio web se pueden recuperar durante la próxima llamada. Las variables que se pasaron de antemano se guardan automáticamente de nuevo.

	- Se soportan las variables simples (entero, cadena, ...) así como las variables de estructura, clase, array o asociativas array. La arrays fija, los miembros globales de las clases y la arrays asociativa de las estructuras locales no están soportadas.




2. Para eliminar una Variable específica del contexto, tiene la posibilidad de utilizar [CancelarServicio webContexto](../WDLang3/1000019591.md). 




**Observación**: El administrador de WEBDEV le ofrece la posibilidad de configurar la duración relativa a la validez de los contextos de webservice ("Duración de los contextos de webservice" en la pestaña "Configuración"). Tan pronto como se exceda la duración especificada, y si no se ha realizado ninguna nueva solicitud, se elimina el archivo de contexto. 

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Generación del servicio web
<a name="generacion_del_servicio_web_ELTTEXTE000376"></a>
Para generar un servicio web: 

1. Seleccione (si es necesario) la configuración correspondiente al Webservice en el explorador de proyectos.

2. Generar el Webservice:  

	- En la pestaña "Proyecto", en el grupo "Generación", haga clic en "Generar". 

	- Haga clic en la generación Icon en los botones de acceso rápido. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_Ico_generation.gif)





3. Comienza la generación del servicio web asistente.

4. En la asistente, especifique: 

	- el nombre del servicio web. En Default, el nombre del Webservice corresponde al nombre del proyecto actual. Puede cambiar el nombre del Webservice (el nombre del proyecto no cambiará). 

	- el modo para pasar parámetros a las funciones. 
			Observación: Recomendamos que utilice la parametrización directa de las funciones. 




5. Pase a la etapa siguiente. 

6. Seleccione los elementos que se incluirán en el Webservice. Estos elementos corresponden a todo menos a los elementos de interfaz (ventana, Page, reporte, ...). <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_Elements_integrer.gif)
 Compruebe los elementos a incluir y los que serán llamados en el Webservice. Es posible:

	- Agregar elementos
			Se puede añadir cualquier tipo de archivo a la lista de elementos insertados en la biblioteca.: imágenes, archivos de texto, etc.

	- Eliminar elementos
			Los archivos correspondientes y sus dependencias serán ignorados en la biblioteca.

	- Crear el servicio web a partir de una description existente (archivo \*.WDU)
			Al crear una biblioteca WINDEV, se crea automáticamente un archivo ".WDU" con el mismo nombre. Este archivo contiene todas las referencias de los elementos incluidos en la biblioteca.




7. Pase a la etapa siguiente. 

8. Comprobar los elementos accesibles. Los elementos accesibles corresponden a los procedimientos que contienen las funciones Visible por la aplicación cliente que llama al Webservice. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_element_accessibles.gif)

	**Atención**: Si una set de procedimientos se hace accesible, todos los procedimientos globales pertenecientes a esta set serán accesibles. Se pueden utilizar dos métodos para ocultar algunos procedimientos: 

	- incluyen estos procedimientos en una set específica y no hacen accesible esta set. 

	- usar la palabra clave PRIVADA para hacer la Procedure inaccesible (sintaxis: PRIVADO Procedure MyProc()). Para obtener más información, consulte [Procedimientos globales](../Motscles/1513005.md). 




9. Termina la asistente para generar el Servicio Web.

10. La implementación asistente se inicia automáticamente a partir de entonces.




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Despliegue de un servicio web y ejecución de su prueba
<a name="despliegue_servicio_web_ejecucion_prueba_ELTTEXTE000400"></a>


### Despliegue de un servicio web
<a name="despliegue_servicio_web_ELTPARAGRAPHE000205"></a>

Para poder ser utilizado, un Webservice debe ser desplegado en un Servidor de Aplicación WEBDEV.

Se pueden utilizar varios métodos de implementación: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_Deployer.gif&type=thumb)


- Despliegue del Webservice en un servidor de aplicaciones WEBDEV remoto.

- Despliegue del Webservice en CLOUD para aplicaciones PC SOFT.

- Despliegue del Webservice a través del servicio de alojamiento de prueba de PC SOFT.

- Creando un paquete remoto de implementación.

- Creando una instalación por medios físicos.

- Despliegue del servicio web en el equipo local.

- Creando un docker de servicio web Image.




Las opciones para desplegar un servicio web son idénticas a las opciones para desplegar un sitio WEBDEV.. Para obtener más información, consulte [Implementar un sitio](../Editeurs/2028039.md). 
<a name="NOTE5_2"></a>


### Caso especial: Despliegue de un servicio web y ejecución de su prueba en el equipo local
<a name="caso_especial_despliegue_servicio_web_ejecucion_prueba_equipo_local_ELTPARAGRAPHE000232"></a>

La prueba del Webservice creado se puede ejecutar en el ordenador del desarrollador. Para ello, seleccione "Desplegar el Webservice en el equipo local".  Este tipo de instalación está disponible sólo si WEBDEV está disponible en el ordenador de desarrollo. En este caso, el servidor de aplicaciones utilizado es el de WEBDEV.

Al final de la instalación, aparece una pantalla que muestra 2 enlaces:

- un enlace que indica la Address de la prueba Page del servicio web (http://user-pc/MYWEBSERVICE_WEB/awws/index.htm)

- un enlace que indica la Address del WSDL (http://user-PC/MYWEBSERVICE_WEB/awws/MyWebservice.awws?wsdl)

<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_dep_local.gif)
Una vez pulsado el enlace o tecleado el Address en su navegador, se muestra un Page HTML: este Page contiene los accesos a todas las funciones desarrolladas en el Webservice así como un enlace al WSDL. Este Page se crea automáticamente al generar el Webservice así como todos los Page s HTML utilizados para ejecutar la prueba de cada función del Webservice. 

En nuestro ejemplo, encontrará el acceso a la función "Suma: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_test_webservice.gif)
 Al hacer clic en una función para probarla, aparece un nuevo Page HTML: Esta Page contiene controles que permiten introducir los parámetros para llamar a la función que se está probando.  En este caso, basta con rellenar los controles y hacer clic en "Probar".. A cambio, se mostrará el resultado Page.
En nuestro ejemplo, hay que pasar dos números a la función "Suma: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_saisie_parametres.gif)
 El resultado Page generado será: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=WS_test_reponse.gif)
 El resultado está en formato XML. Los valores de retorno se encapsulan en etiquetas XML. En nuestro ejemplo, el valor de retorno de las funciones "Suma" se incluye en la etiqueta "AdditionResult".


