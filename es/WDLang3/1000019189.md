


## EmailStartIMAPSession( Función)



<a name="XUse"></a>
<a name="Use"></a>
<a name="description"></a>
Inicia una sesión para recibir y leer correos electrónicos con el protocolo IMAP.. Sólo podrás leer los correos electrónicos. Tiene la posibilidad de iniciar una sesión IMAP segura a través de SSL.

**Observación**: Para iniciar una sesión de envío de correos electrónicos, utilice [EmailStartSMTPSession](../WDLang3/3032025.md).






<a name="Example1"></a>
<a name="sample_code"></a>

## Ejemplo


```wl
// Read an email via the IMAP protocol
IF EmailStartIMAPSession(EDT_USER, EDT_PASSWORD, "imap.mydomain.fr") = True THEN
	ProcessIncomingEmails()
ELSE
	Error("Unable to establish the connection")
END
```

<a name="XSYNTAX"></a>

## Sintaxis
<a name="SYNTAX1"></a>

`<Result> = EmailStartIMAPSession(<Username> , <Password> , <Server address> [, <Port> [, <Option>]])`
---

**`<Result>: (booleano)`**



- <u><u><u><u>True</u></u></u></u> si la sesión se abrió correctamente,

- <u><u><u><u>False</u></u></u></u> en caso contrario. Para get los detalles del error, utilice [ErrorInfo](../WDLang1/3013008.md).




**`<Username>: (Cadena de caracteres)`**

Nombre de usuario en el servidor. Este nombre es suministrado por el proveedor de servicios o por el administrador de la red.. Este nombre se usará para identificar la sesión de Email en las diferentes funciones para la gestión de Email.

**`<Password>: (Cadena de caracteres)`**

Contraseña de usuario. Esta contraseña es proporcionada por el proveedor de servicios o por el administrador de la red.

**`<Server address>: (Cadena de caracteres)`**

Address del servidor Email (protocolo de entrada). Este Address es suministrado por el proveedor de servicios o por el administrador de la red. Esta Address se puede dar en el siguiente formato:

- IP Address en formato XXX.XXX.XXX.XXX (192.168.1.1 por ejemplo).

- IP Address que contiene el nombre del servidor (imap.midominio.fr por ejemplo). Se recomienda esta sintaxis.

- IP Address devuelta por [NetIPAddress](../WDLang3/3056023.md).




**Observación**: El Address debe ser un Address IPv4.

**`<Port>: (Entero opcional)`**

Identifica el puerto utilizado para el protocolo IMAP (143 de Default).

**`<Option>: (Constante opcional de tipo Integer)`**

Se utiliza para especificar si se requiere una conexión SSL:


|   |   |
| --- | --- |
| *emailOptionDefault*<br>(Valor predeterminado) | Conexión no segura. |
| *optionSSL* | Se requiere conexión SSL (para un servidor IMAP seguro).<br><br>**Observación**: En la mayoría de los casos, el puerto utilizado para un servidor IMAP seguro es el puerto 993 (en lugar del puerto 143, el valor de puerto de Default).<br><br>![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/us/UNIVERSALAPP.png) Esta constante no está disponible. |





<a name="NOTE0"></a>
<a name="NOTE0_1"></a>

## Observaciones


### Timeout
<a name="timeout_ELTPARAGRAPHE000109"></a>

El tiempo de espera puede ser set utilizando [EmailSetTimeOut](../WDLang3/3032001.md).




### Conexión con autenticación de dos factores
<a name="conexion_con_autenticacion_dos_factores_ELTPARAGRAPHE000118"></a>

Cada vez más proveedores ofrecen cuentas seguras de Email (SMTP/IMAP) con autenticación de dos factores.

El principio es el siguiente: 

- Conectar con el proveedor Email mediante OAuth: esta conexión proporciona una Token. 

- Utilice el token para conectarse a los buzones IMAP o SMTP Email.




Veamos un ejemplo de código que se puede utilizar:




```wl
// Example of IMAP connection with a Gmail account
// and two-factor authentication
OAuthGoogleCnt is OAuth2Parameters
gMyIMAPSession is emailIMAPSession

// IMAP server parameters
gMyIMAPSession.ServerAddress = "imap.gmail.com"
gMyIMAPSession.Option = optionSSL
MyIMAPSession.Port = "993"

// OAuth connection parameters
OAuthGoogleCnt.ClientID = "Application ID"
OAuthGoogleCnt.ClientSecret = "Secret application ID"
OAuthGoogleCnt.AuthURL = "https://accounts.google.com/o/oauth2/auth"
OAuthGoogleCnt.TokenURL = "https://accounts.google.com/o/oauth2/token"
OAuthGoogleCnt.Scope = "https://mail.google.com/"
OAuthGoogleCnt.RedirectionURL = "http://localhost:9000"
OAuthGoogleCnt.ResponseType = "code"

// OAuth authentication

gMyIMAPSession.AuthToken = AuthIdentify(OAuthGoogleCnt)

// If the authentication was successful, log in to email inbox.
IF gMyIMAPSession.AuthToken <> Null THEN
	// prefix syntax of EmailStartSession
	IF gMyIMAPSession.StartSession() THEN
	// Session started
	ELSE
	// Error starting the session.
	END
ELSE
	// Authentication error.
END
```





<a name="NOTE0_2"></a>
![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/us/UNIVERSALAPP.png) 

### Funcionalidad de aplicación requerida
<a name="funcionalidad_aplicacion_requerida_ELTPARAGRAPHE000130"></a>

Cuando se utiliza esta función, se debe declarar una funcionalidad de la aplicación en el asistente de generación de aplicaciones.

Característica necesaria: Redes domésticas y profesionales

Esta característica permite a las aplicaciones utilizar accesos entrantes y salientes a las redes familiares y corporativas.. 
<a name="NOTE0_3"></a>


### Gmail: ¿Qué hacer si una conexión a Gmail (SMTP, IMAP, POP3) falla con un error de Certificate?
<a name="gmail_¿que_hacer_una_conexion_gmail_smtp_imap_pop3_falla_con_error_certificate_ELTPARAGRAPHE000295"></a>

Desde agosto de 2017, una nueva Certificate fue desplegada por Google: Google INTERNET Authority G3. Desafortunadamente, el API de Windows para comprobar las Certificate s no valida esta Certificate.

Por lo tanto, iniciar una sesión POP3, IMAP o SMTP puede fallar con el error "La cadena Certificate no fue emitida por una autoridad de confianza".

Para validar la Certificate, todo lo que tienes que hacer es modificar el modo de gestión de los correos electrónicos. La función [EmailConfigure](../WDLang3/1000022269.md) de WLanguage permite cambiar este modo y dejar de utilizar la API de Windows que bloquea esta Certificate. Se debe agregar el siguiente código antes de iniciar la sesión con la función **EmailStartIMAPSession**:

```wl
// Enable the multi-platform implementation
EmailConfigure(emailParameterMode, 1)
```


Observación: A partir de la versión 23 Actualización 1, la llamada a [EmailConfigure](../WDLang3/1000022269.md) ya no es necesaria: WLanguage utiliza automáticamente el modo de gestión de los correos electrónicos adaptados a la sesión.

<a name="XComponent"></a>

## Componente:
wd280com.dll
