


## WINDEV y los streams - Ejemplo de uso
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000162"></a>
En este ejemplo, la aplicación debe gestionar una videoconferencia entre dos ordenadores. Esta aplicación le permite:

- ver el vídeo emitido actualmente por la cámara web instalada en el ordenador actual.

- ver el vídeo emitido actualmente por la cámara web instalada en el ordenador conectado.

- transmitir la voz del usuario actual al usuario conectado.

- escuchar la voz del usuario conectado.




A partir de la versión 20, los controles de conferencia son compatibles con Windows Vista y posteriores. Si desea utilizar la control Conferencia con una versión anterior de Windows: 

1. Abra la ventana de descripción del control. 

2. En la pestaña "UI", marque "Usar la TAPI 3.x APIs / Windows XP (para compatibilidad)". 

3. Validar. 




<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Utilice el ejemplo
<a name="utilice_ejemplo_ELTTEXTE000186"></a>
Para desarrollar esta aplicación: 

1. Cree una ventana en blanco: 

	- Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_nouveau.gif) en los botones de acceso rápido.

	- Aparece la ventana de creación: haga clic en "Ventana", y luego en "Ventana".




2. Cree dos controles de conferencia en esta ventana: en la pestaña "Creación", en el grupo "Controles gráficos", despliegue "Video y captura" y seleccione "Conferencia". En nuestro ejemplo, el primer control se llama "CONF_Recepción" y el segundo control se llama "CONF_Transmisión".
	Observación: WINDEV asocia automáticamente estos dos controles en la misma secuencia. Por Default, el primer control creado se utiliza para ver el vídeo entrante mientras que el segundo control creado se utiliza para ver el vídeo saliente.

3. Visualizar la associated de eventos con el flujo ("Código del flujo associated" en el menú contextual de uno de los controles de la Conferencia).
	Recordatorio: El Event "Request for connecting a new stream" se ejecuta cuando un nuevo flujo intenta conectarse con la aplicación actual. Este Event acepta un parámetro. Para manipular este parámetro, se declara automáticamente un Procedure en la "Solicitud de conexión de un nuevo flujo" Event.

4. Añada las siguientes líneas de código en la "Solicitud de conexión de un nuevo flujo" de Event:
	
	```wl
	// Procedure used to detect a new stream 
	// nStreamID is an integer variable containing 
	// the identifier of the detected stream 
	PROCEDURE NewStream(nStreamID)  
	// Find out the name of the caller 
	CallerName is string = StreamInfo(nStreamID, StreamCallerName) 
	// Accept the incoming stream? 
	If YesNo(CallerName + "would like to start a conference with you", ...
		"Do you accept?") = Yes THEN
		StreamAccept(nStreamID, Reception) 
	ELSE     
		StreamReject(nStreamID) 
	END
	```


5. En la ventana:

	- crear un botón llamado "BTN_Call".: en la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_bouton.gif). Este botón se utilizará para conectar la transmisión a un destinatario.

	- crear una control Campo de entrada llamada "EDT_RecipientAddress": en la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_saisie.gif). Este control se utilizará para introducir el nombre de la persona llamada.

	- crear un botón llamado "BTN_Done".: en la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_bouton.gif). Este botón se utilizará para finalizar la recepción o la emisión de un stream.

	- crear una control Campo de entrada llamada "EDT_UserName".: en la pestaña "Creación", en el grupo "Controles frecuentes", haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_saisie.gif). Este control se utilizará para introducir el nombre del usuario actual.




6. Escriba el siguiente código en la Event "Click BTN_Call":
	
	```wl
	// Specify the name of the caller
	Stream1.Identifier = EDT_UserName 
	// Connect the stream 
	StreamConnect(Stream1, RecipientAddress) 
	// equivalent to: 
	// Stream1.Address = RecipientAddress
	```


7. Escriba las siguientes líneas de código en la Event "Click BTN_Done":
	
	```wl
	// Disconnect the stream
	StreamDisconnect(Stream1)
	```





**Observación**: Para funcionar, esta aplicación debe ejecutarse en dos ordenadores diferentes.




