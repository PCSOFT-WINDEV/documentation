


## Importar/Consumir servicios web
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000534"></a>
WINDEV, WEBDEV y WINDEV Mobile le permiten importar directamente servicios web a sus aplicaciones.

Un Webservice es una set de puntos de entrada puestos a disposición de los usuarios para realizar diferentes procesos. Por ejemplo, un servicio de acceso remoto proporciona los procesos utilizados para acceder a los datos. Los intercambios de información con un Webservice se realizan en formato XML y utilizan los protocolos SOAP (Simple Object Access Protocol) y HTTP.

A partir del description en formato WSDL (Web Services description Language) de este servicio, WINDEV, WEBDEV o WINDEV Mobile generarán automáticamente los tipos y funciones del WLanguage correspondientes a la interfaz de programación del Webservice.

Para utilizar el Webservice, todo lo que tiene que hacer es utilizar las funciones generadas durante la importación.

Esta página de ayuda presenta: 

- [Cómo importar un servicio web a un proyecto](#NOTE2_1). 

- [Cómo actualizar la description de un Webservice en un proyecto](#NOTE3_1). 

- [Cómo utilizar un Webservice en un proyecto](#NOTE4_1). 

- [Cómo distribuir una aplicación WINDEV que utiliza un servicio web](#NOTE5_1).




![Java](https://doc.pcsoft.fr/ext/images/us/JAVA.png) La utilización de un Webservice en un proyecto Java requiere una máquina virtual Java (JRE) en versión 6 (o 6.1) o posterior.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Importar un servicio web a un proyecto
<a name="importar_servicio_web_proyecto_ELTTEXTE000558"></a>


### Importar
<a name="importar_ELTPARAGRAPHE000066"></a>

Para importar un servicio web:

1. En la pestaña "Proyecto", en el grupo "Proyecto", despliegue "Importar" y seleccione "Un Webservice". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Importer_un_service_Web_XML%20-%20HC%20N%B0001.gif&type=thumb)
 Se inicia la importación del Webservice asistente.

2. En la asistente, la pantalla de presentación se muestra. Pase a la etapa siguiente. 

3. Especifique la ubicación del WSDL. Este archivo corresponde al servicio web description. Contiene la description de cada función que se encuentra en el Webservice así como sus parámetros. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Importer_un_service_Web_XML%20-%20HC%20N%B0002.gif)
 Se pueden utilizar dos métodos para localizar el WSDL: 

	- desde una URL, HTTP Address donde se encuentra el WSDL.
			Observaciones: 

		- Tiene la posibilidad de especificar el nombre de usuario y la contraseña si se requiere una autenticación. 

		- El botón "Proxy" permite configurar las opciones del proxy si es necesario.




- de un archivo XML que se encuentra en el ordenador actual.

4. Valide el asistente. Aparece un mensaje indicando que la importación ha finalizado.. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Importer_un_service_Web_XML%20-%20HC%20N%B0003.gif&type=thumb)


5. El Webservice se agrega automáticamente en el panel "Explorador de proyectos" (en la rama "Webservices"). Está listo para su uso.



<a name="NOTE2_2"></a>


### "Panel "Explorador de proyectos: ver un servicio web
<a name="panel_explorador_proyectos_ver_servicio_web_ELTPARAGRAPHE000113"></a>

El Webservice importado se encuentra en la carpeta "Webservices" del panel "Project explorer".: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Importer_un_service_Web_XML%20-%20HC%20N%B0004.gif)


La estructura contiene: 

- el nombre del servicio web. 

- el nombre de cada función. 

- el nombre de una estructura que contiene los parámetros de llamada o los valores de retorno. 

- el nombre de cada Variable en la estructura. 




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## description y las propiedades de un Webservice
<a name="description_las_propiedades_webservice_ELTTEXTE000588"></a>


### Actualización de la description de un Webservice
<a name="actualizacion_description_webservice_ELTPARAGRAPHE000130"></a>

Cuando un Webservice evoluciona (correcciones, nuevas versiones, etc.), su description también puede evolucionar.

Para actualizar la description de un Webservice en su proyecto:

1. Seleccione el Webservice en la pestaña "Explorador de proyectos"

2. Seleccione "Actualizar" en el menú contextual.




**Observación**: Los Webservices importados utilizando el mecanismo de compatibilidad con las versiones anteriores no pueden actualizarse.
<a name="NOTE3_2"></a>


### Propiedades de un servicio web modificable en el editor
<a name="propiedades_servicio_web_modificable_editor_ELTPARAGRAPHE000144"></a>

Para modificar las propiedades de un servicio web en el editor:

1. Seleccione el Webservice en la pestaña "Explorador de proyectos"

2. Seleccione la opción "Descripción" en el menú contextual.

3. Se muestra la ventana de propiedades. Las siguientes propiedades pueden ser modificadas en esta ventana:

	- La importación Address de Webservice: es la URL utilizada para llegar al WSDL que describe el servicio web.

	- El nombre de usuario y la contraseña utilizados para importar el WSDL. 







<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Uso de un servicio web
<a name="uso_servicio_web_ELTTEXTE000618"></a>


### Principio
<a name="principio_ELTPARAGRAPHE000160"></a>

Para utilizar un servicio web, usted debe: 

1. Declare 2 variables: un Variable utilizado para especificar los parámetros de la llamada y un Variable utilizado para recuperar la respuesta. 

2. Inicializar cada Variable de la estructura de llamada. 
	**Importante:** el orden de asignación de variables se utiliza en el XML generado en la solicitud SOAP. Por lo tanto, es necesario asignar las variables en el orden especificado en la documentación de la función de servicio web.

3. Llame a la función de Webservice pasando la llamada Variable como parámetro y recupere la respuesta Variable a cambio. 




Ejemplo: 


```wl
trackingSearch is trackSearch
trackingSearchRes is resultTrackSearch
trackingSearch.accountNumber = 99999999
trackingSearch.consigneesCountry = "FR"
trackingSearch.consigneesZipCode = "37100"
trackingSearch.sendersRef = "111111"
trackingSearchRes = TrackingServiceWSService.trackSearch(trackingSearch)

IF ErrorOccurred() THEN
	Trace("Failed to call the Webservice: " + ErrorInfo(errFullDetails))
ELSE
	Trace("Webservice successfully run")
END
```


En la mayoría de los casos, el resultado devuelto por el Webservice está en formato XML. Por lo tanto, las funciones XML deben utilizarse para decodificar la respuesta.




### ¿Cómo se pueden incluir los valores de set en la cabecera HTTP de una llamada a un servicio web SOAP?
<a name="¿como_pueden_incluir_los_valores_set_cabecera_http_una_llamada_servicio_web_soap_ELTPARAGRAPHE000178"></a>

Para los valores de set en la cabecera HTTP de una llamada de servicio web SOAP: 

1. Declarar wsRequest Variable. 

2. Utilice el httpHeader Property para set los valores de la cabecera. 

3. Llame al procedimiento del webservice especificando el nombre de la wsRequest Variable como primer parámetro. 




Ejemplo: 

```wl
C is wsRequest
C.HTTPHeader["key"] = "Value"
// Call the Webservice procedure 
// while passing the header and the expected parameters
WebServiceProc(C, param1_WS, param2_WS)
// Displays the request sent
Trace(C.XMLSource)
```


**Observación**: En el lado del servidor, es posible recuperar la cabecera utilizando la función WebserviceReadHTTPHeader. 
<a name="NOTE4_2b"></a>


### Llamada asíncrona a un servicio web
<a name="llamada_asincrona_servicio_web_ELTPARAGRAPHE000196"></a>En algunos casos, la llamada a un servicio web puede tardar demasiado tiempo. Puede ser necesario realizar una llamada asíncrona al Webservice, utilizando la siguiente sintaxis: 


```txt
AFTER <Result> = <Webservice call procedure> DO
	<Code executed only if the Webservice has been executed and has sent the response>
END
<Code executed directly after the call to the Webservice>
```


Utilizando esta sintaxis, puede evitar que la llamada al servicio web bloquee la aplicación. El programa continúa ejecutándose aunque el Webservice no haya respondido todavía. 

El ejemplo anterior se convierte en:

```wl
trackingSearch is trackSearch
trackingSearchRes is resultTrackSearch
trackingSearch.accountNumber = 99999999
trackingSearch.consigneesCountry = "FR"
trackingSearch.consigneesZipCode = "37100"
trackingSearch.sendersRef = "111111"

AFTER trackingSearchRes = TrackingServiceWSService.trackSearch(trackingSearch) DO
	IF ErrorOccurred() THEN
		Trace("Failed to call the Webservice: " + ErrorInfo(errFullDetails))
	ELSE
		Trace("Webservice successfully run")
	END
END
```
Para obtener más información, consulte [Instrucción AFTER](../Motscles/1510027.md). 




<a name="NOTE4_2"></a>


### Propiedades de associated con el Webservice
<a name="propiedades_associated_con_webservice_ELTPARAGRAPHE000217"></a>

Para manipular un Webservice mediante programación, basta con utilizar el nombre del Webservice (que se encuentra en el panel "Explorador de proyectos"). 

**Observación**: Puede arrastrar y soltar directamente desde el panel "Explorador de proyectos" al editor de código para insertar el nombre del Webservice.

Las siguientes propiedades se pueden modificar mediante programación:

| denominar | Tipo utilizado | Efecto |
| --- | --- | --- |
| Address | Cadena de caracteres | Sirve para sustituir la llamada Address del Webservice descrito en el WSDL por otra URL. Esta Property es useful si el Webservice está alojado en diferentes servidores.<br><br>Este Property tiene el siguiente formato: "http://servidor:puerto/ruta_del_webservice".<br><br>Para un Webservice generado con WINDEV y desplegado en un Servidor de aplicaciones WEBDEV, es la URL del archivo de extensión "awws".<br><br>**Observaciones**:<br><br>- La modificación de esta Property sustituye todas las URLs descritas en el WSDL.<br><br>- Si esta propiedad corresponde a una cadena vacía, se volverán a utilizar las URL descritas en el WSDL.<br><br><br> |
| ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Autenticación | Constante de tipo Integer | Se usa para forzar el método de autenticación HTTP: <br><br>- *auAutomatic* (valor Default ): Método de autentificación automatic. <br><br>- *auBasic*: Método básico de autenticación. <br><br>- *auNegotiate*: Negociar el método de autenticación.<br>	![Linux](https://doc.pcsoft.fr/ext/images/us/LX.png) Atención: Este método de autenticación no es compatible con los ejecutables de Linux.<br><br><br> |
| Contraseña | Cadena de caracteres | Contraseña utilizada para realizar la autenticación durante las peticiones HTTP al servicio web. Este nombre sólo se utiliza si se requiere una autenticación para acceder al servidor en el que está alojado el Webservice. |
| drogadicta | Cadena de caracteres | Nombre de usuario que se utilizará para realizar la autenticación durante las peticiones HTTP al Webservice. Este nombre sólo se utiliza si se requiere una autenticación para acceder al servidor en el que está alojado el Webservice..<br>Con el método Negociar autenticación, el dominio debe ser añadido al usuario dependiendo de la configuración.: <br><pre><code>myWebservice..User = "DOMAIN\User"</code></pre><br> o <br><pre><code>myWebservice..User = "User@DOMAIN"</code></pre><br> |
| IgnoreError | Combinación de constantes | Sirve para ignorar los errores de Certificate. se pueden utilizar las siguientes constantes:<br><br>- *httpIgnoreInvalidCertificate*: Sirve para ignorar un Certificate no válido o un Certificate procedente de una empresa desconocida.<br><br>- *httpIgnoreInvalidCertificateName*: Se utiliza para ignorar el nombre del sitio que se encuentra en la Certificate.<br><br>- *httpIgnoreExpiredCertificate*: Sirve para ignorar la fecha de la Certificate.<br><br>- *httpIgnoreRedirectToHTTP*: Se utiliza para redirigir a un servidor no seguro.<br><br>- *httpIgnoreRedirectToHTTPS*: Se utiliza para redirigir a un servidor seguro.<br><br>- *httpIgnoreRevocation*: Se utiliza para ignorar la verificación en la lista de certificados revocados.. <br><br><br><br><br>Observaciones: <br><br>- ![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/us/UNIVERSALAPP.png) Se ignoran los errores relativos a la seguridad de las transacciones.. El **IgnoreError** Property no está disponible.<br><br>- ![Java](https://doc.pcsoft.fr/ext/images/us/JAVA.png) Sólo se admiten los siguientes errores: *httpIgnoreExpiredCertificate*, *httpIgnoreInvalidCertificate*, *httpIgnoreInvalidCertificateName*, *httpIgnoreRevocation*. Se ignoran los otros errores. Por compatibilidad con el pasado, todos los errores son ignorados por Default.<br><br><br> |
| MethodHTTP | Constante de tipo Integer | Método HTTP utilizado para llamar al servicio web:<br><br>- *httpPost* (valor Default ): Método POST<br><br>- *httpPut*: Método PUT<br>	![Universal Windows 10 App](https://doc.pcsoft.fr/ext/images/us/UNIVERSALAPP.png) No disponible.<br><br><br> |
| Puerto | Cadena de caracteres | Nombre del puerto definido en el WSDL. Es el puerto utilizado para comunicarse con el servidor que alberga el Webservice.. Consulte a su administrador de red o al propietario del servicio web. |
| VersionHTTP | Constante de tipo Integer | Versión HTTP utilizada por el servidor: <br><br>- *httpVersion2*: HTTP versión 2.0. Si el servidor no admite esta versión, se utiliza una versión anterior. <br><br>- *httpVersion2Only*: Fuerza la versión 2.0 de HTTP: si el servidor no soporta esta versión, se muestra un error fatal. <br><br>- *httpVersion1_1*: Versión HTTP 1.1.<br><br>- *httpVersion1_0*: HTTP versión 1.0. <br><br>- *httpVersionDefault*: HTTP versión 1.0. <br><br><br> |


**Observación**:

- Si se especifica un nombre de usuario y una contraseña, la autenticación de las solicitudes HTTP se realizará utilizando el esquema de autenticación "Basic", en el que los parámetros se indican claramente en la solicitud HTTP.. Recomendamos que utilice solicitudes HTTPS si se requiere la autenticación.

- Si el servidor que aloja el Webservice requiere una autenticación de Windows en HTTP, se debe llamar a [HTTPConfigurar](../WDLang3/1000018985.md) antes de consumir el Webservice (para poder utilizar INTERNET Explorer para las peticiones HTTP).

- El tiempo máximo de espera se puede especificar con [HTTPTimeOut](../WDLang3/3043008.md).




**Atención**: Las propiedades modificables en el editor y las modificables a través de la programación no tienen ningún vínculo.
<a name="NOTE4_3"></a>


### Propiedades disponibles sobre los tipos de variables
<a name="propiedades_disponibles_sobre_los_tipos_variables_ELTPARAGRAPHE000367"></a>

Los tipos de variables que se declaran automáticamente al importar el WSDL proponen varias propiedades:

| denominar | Tipo utilizado | Efecto |
| --- | --- | --- |
| Conde | Integro | Número de elementos de este tipo en la respuesta del Webservice.<br><br>Un Webservice puede devolver arrays de variables. El **Count** Property le permite get el tamaño del array devuelto y el [ ] le permite acceder a los elementos del operador 03 de array . |
| escribir a máquina | Cadena de caracteres | Nombre del tipo Variable. Esta Property se utiliza cuando es probable que un Webservice devuelva respuestas de diferentes tipos. |
| Exist | booleano | <br><br>- <u><u><u><u>True</u></u></u></u> si existe el tipo de variable en la respuesta del Webservice,<br><br>- <u><u><u><u>False</u></u></u></u> en caso contrario.<br><br><br> |
| Valor | Variant | Valor de la Variable.<br><br>**Observación**: Se accede a esta Property por defecto cuando sólo se utiliza el nombre Variable. Por ejemplo:<br><br><br><pre><code>myWebservice.RequestVariable = EDT_Value</code></pre><br>equivale a:<br><br><br><pre><code>myWebservice.RequestVariable..Value = EDT_Value</code></pre><br> |

![Java](https://doc.pcsoft.fr/ext/images/us/JAVA.png) No se puede utilizar un método que administre un contexto compartido.
<a name="NOTE4_4"></a>


### Operaciones avanzadas del flujo XML del Webservice
<a name="operaciones_avanzadas_del_flujo_xml_del_webservice_ELTPARAGRAPHE000428"></a>

En algunos casos, puede que tenga que manipular el flujo de datos XML intercambiado con el Webservice. Algunos Webservices piden, por ejemplo, que se añadan cabeceras a su flujo XML para permitir la autenticación o devolver información meta en las cabeceras de respuesta.

Las siguientes funciones pueden utilizarse para responder a estas solicitudes concretas:


|   |   |
| --- | --- |
| [SOAPAddAttribute](../WDLang3/1000019241.md) | Declara los atributos adicionales (que no se encuentran en el WSDL) en un Webservice Variable generado automáticamente. Se utiliza en programación avanzada cuando el WSDL devuelto por el Webservice no corresponde exactamente al tipo esperado. |
| [SOAPAddHeader](../WDLang3/3069001.md) | Añade cabeceras personalizadas en una llamada a un servicio web. |
| [SOAPGetHeader](../WDLang3/1000019237.md) | Vuelve a leer la información que se encuentra en el encabezado de la respuesta del servicio web. |
| [SOAPPrepare](../WDLang3/1000019238.md) | Construye la petición al Webservice para una función y parámetros dados pero no la envía. |


<a name="NOTE4_5"></a>


### Caso especial: el Webservice devuelve un resultado cuyo tipo no es reconocido por WINDEV, WEBDEV y WINDEV Mobile
<a name="caso_especial_webservice_devuelve_resultado_cuyo_tipo_reconocido_por_windev_webdev_windev_mobile_ELTPARAGRAPHE000458"></a>

Los tipos de variables disponibles en WINDEV y las disponibles en un servicio web SOAP pueden diferir.

Los tipos simples (booleanos, enteros, etc.) y los tipos complejos (fecha y hora, duración, estructuras, arrays de tipos simples y array de estructuras, estructuras anidadas, etc.) utilizados en el Webservice se convierten automáticamente al formato WLanguage (y a la inversa) cuando el servicio se importa a un proyecto.. También se soportan los tipos de Array.

Los tipos más evolucionados (clases, tipos avanzados de WLanguage, etc.) se procesan como cadenas de caracteres en el código de WLanguage.. Estas cadenas de caracteres contienen el código XML correspondiente al tipo de Variable devuelto por el Webservice y a su contenido.

Por lo tanto, si un Webservice devuelve un resultado como una instancia de clase, este resultado se procesará en la Procedure como una cadena de caracteres en formato XML. A continuación, tendrá que Process esta cadena de caracteres (en WLanguage) para extraer la información deseada. Para más detalles, consulte la página web de [Funciones XML](../WDLang5/3081005.md).

**Observaciones**: 

- Si el Webservice devuelve una estructura, el nombre de los miembros que se encuentran en la estructura de devolución distingue entre mayúsculas y minúsculas.

- Si utiliza una estructura como parámetro de una función de Webservice y no se asigna un miembro de tipo DATE, se mostrará el siguiente error "El valor 0000-00-00 no respeta el esquema XSD". 




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Distribuyendo una aplicación WINDEV que utiliza un servicio web
<a name="distribuyendo_una_aplicacion_windev_que_utiliza_servicio_web_ELTTEXTE000680"></a>
Para distribuir una aplicación que utiliza un servicio web, simplemente incluya el archivo que describe el servicio web (archivo .wsdl) en la biblioteca de la aplicación.

Para que la aplicación pueda ejecutar el Webservice, los ordenadores de los usuarios finales deben tener acceso a INTERNET.

**Observación**: Antes de distribuir una aplicación que utilice un servicio web, se recomienda comprobar la licencia y los derechos de distribución de este servicio (en caso de que haya un gratuito para el servicio).




