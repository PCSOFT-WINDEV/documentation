
## Socket: creación de un socket server estándar
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000180"></a>
WINDEV le permite crear un servidor de socket estándar. **Este servidor se utiliza para gestionar la conexión de varios ordenadores cliente en el mismo socket.** Este principio se utiliza para crear un servidor de noticias, por ejemplo.



<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Principio de comunicación de sockets
<a name="principio_comunicacion_sockets_ELTTEXTE000204"></a>


### Etapa 1: Creación del socket
<a name="etapa_1_creacion_del_socket_ELTPARAGRAPHE000026"></a>

Para crear el socket, el servidor utiliza la función [SocketCreate](../WDLang3/3070011.md). Un socket está enlazado a un puerto específico. Se pueden crear varios sockets, cada socket utilizando un número de puerto específico. Un nombre (usado para manipular el zócalo por programación) y un número de puerto son associated con cada zócalo.
<a name="NOTE2_2"></a>


### Etapa 2: En espera de la conexión a la toma de corriente
<a name="etapa_2_espera_conexion_toma_corriente_ELTPARAGRAPHE000036"></a>

Todos los ordenadores que quieran comunicarse con el servidor pueden conectarse al socket: estos son los ordenadores de los clientes. El servidor gestiona las diferentes solicitudes de conexión de los ordenadores clientes a través de [SocketWaitForConnection](../WDLang3/3070006.md). Esta función le permite saber si una solicitud de conexión se realiza en un zócalo específico.

Se recomienda utilizar [SocketWaitForConnection](../WDLang3/3070006.md) en un thread específico. Por lo tanto, esta función se realiza en la tarea de Background. Cuando se detecta una solicitud de conexión, puede hacerlo:

- aceptar la conexión ([SocketAccept](../WDLang3/3070004.md)): en este caso, se crea un canal de comunicación específico. Para evitar el bloqueo de las aplicaciones, los mensajes entrantes suelen ser gestionados por una Thread específica (para más detalles, véase [Gestión de los hilos de discusión](../WDLang1/3077026.md)).

- rechazar la conexión ([SocketDeny](../WDLang3/3070010.md)).



<a name="NOTE2_3"></a>


### Ejemplo 
<a name="ejemplo_ELTPARAGRAPHE000063"></a>

El siguiente ejemplo se utiliza para crear un zócalo en el servidor y para gestionar las conexiones de los ordenadores clientes en un thread. Si la conexión es aceptada, la gestión de esta conexión la realiza un thread específico.

Se ejecuta una Thread para cada conexión. Cada thread utiliza la misma función de servicio ("ManagementProcedure"). Para permitir que la Procedure funcione con varios hilos al mismo tiempo, se debe cambiar el modo de sincronización de los hilos: utilice la función [ThreadMode](../WDLang1/3077028.md) con la constante *threadCriticalSection* en el código de inicialización del proyecto. La sincronización entre hilos debe hacerse manualmente (para más detalles, véase [la ayuda sobre los hilos](../WDLang1/3077026.md)).

Para diferenciar los thread s, el nombre de cada thread corresponde al nombre del canal de comunicación (nombre único). 



```wl
IF NOT SocketCreate("Server", 8000) THEN
	Error("creation error" + ErrorInfo(errMessage))
ELSE
	ThreadExecute("Thread1", threadNormal, WaitProcedure)
END
```



```wl
PROCEDURE WaitProcedure()
LOOP
	IF SocketWaitForConnection("Server") THEN
		Channel is string
		Channel = SocketAccept("Server")
		ThreadExecute(Channel, threadNormal, ProcedureManagement, Channel)
	END
END
```

<a name="NOTE2_4"></a>


### Etapa 3: Intercambio de datos
<a name="etapa_3_intercambio_datos_ELTPARAGRAPHE000085"></a>

Cuando dos máquinas utilizan el mismo socket, se establece un canal de comunicación entre ellas. Estas dos máquinas pueden leer y escribir cadenas de caracteres en el socket.

Para leer y escribir datos en el socket, la aplicación servidor de WINDEV debe utilizar las funciones [SocketRead](../WDLang3/3070014.md) y [SocketWrite](../WDLang3/3070002.md).

**Atención**: Para iniciar una operación de lectura, debe haberse realizado previamente una operación de escritura. Por ejemplo:

1. La máquina cliente escribe en el socket: envía una solicitud al servidor.

2. El servidor realiza una operación de lectura en el zócalo de un thread. Cuando se recibe un mensaje, el servidor lo procesa.

3. Si se requiere una respuesta al mensaje, el servidor identifica el ordenador cliente y le envía una respuesta.. 
	



<a name="NOTE2_5"></a>


### Etapa 4: Fin de la comunicación
<a name="etapa_4_fin_comunicacion_ELTPARAGRAPHE000107"></a>

Para finalizar la comunicación, basta con cerrar el socket con [SocketClose](../WDLang3/3070015.md).

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Modo de transmisión de la información
<a name="modo_transmision_informacion_ELTTEXTE000252"></a>
El modo de transmisión del mensaje define el modo utilizado para especificar la longitud del mensaje.

Se pueden utilizar varios métodos para definir la longitud del mensaje durante la comunicación entre sockets.

- **Método 1: Modo WINDEV**: Por Default, el número de caracteres en el mensaje se especifica al principio del mensaje. Este modo de transmisión se recomienda cuando los sockets se utilizan para comunicarse entre dos aplicaciones WINDEV..
	El mensaje tiene el siguiente formato: "11\\r\\nHelloWord"

- **Método 2: modo estándar**: El final del mensaje se señala con un carácter específico, definido de antemano. Este modo de transmisión se recomienda cuando los sockets se utilizan para comunicarse entre una aplicación WINDEV y otra aplicación.. En este caso, debe incluirse un carácter específico en el mensaje para indicar que el mensaje ha terminado..
	**El mensaje tiene el siguiente formato**: "Hola mundo&lt;EOF&gt;"

- **Método 3: modo estándar con buffer:** Corresponde al modo estándar optimizado para los protocolos más utilizados en INTERNET.




[SocketChangeTransmissionMode](../WDLang3/3070005.md) permite modificar el modo de transmisión utilizado.


