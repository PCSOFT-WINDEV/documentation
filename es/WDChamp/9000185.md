


## Aplicación Single Page
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000227"></a>
Una "Single Page App" es una aplicación Web (Internet o INTRANET) cuyos todos los Page s están agrupados en un único Page. 

Con WEBDEV, este tipo de aplicación puede ser fácilmente reutilizada a través de planos, popups, cookies, etc.

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Uso de planos
<a name="uso_planos_ELTTEXTE000251"></a>
A partir de la versión 22, WEBDEV permite utilizar planos en una Web Page. El uso de planos evita tener que ir y volver con el servidor cada vez que se cambia la Page: las aplicaciones son más fluidas, más "nativas".

El modo de operación de los planos en WEBDEV es similar al modo de operación de los planos en WINDEV/WINDEV Mobile.

Sin embargo, se observan algunas diferencias:

1. Los planos están disponibles de forma independiente para **cada elemento del contenedor**: la Page, un área de diseño, un área de texto enriquecido, una celda. Esta característica le permite realizar varias combinaciones de visualización.

2. La gestión de planos debe ser **explicitly enabled** en el elemento. Desde la description del elemento contenedor, pestaña "UI", sólo hay que habilitar la opción "Habilitar la gestión de los aviones".

3. No hay ningún plano "0".. 

	- En WINDEV, un control que debe mostrarse en todos los aviones es relacionado al avión "0". Es el plano por defecto, que siempre es Visible. 

	- En WEBDEV, un control que siempre debe ser Visible debe ser colocado explícitamente en todos los aviones con contenido.




4. El plano de un control no se puede modificar mediante programación. La asociación entre una control y uno o más aviones se realiza sólo en edición.




**Para cambiar el plano visualizado**, utilice el [Tela impermeable](../Proprietes/2510094.md) Property en el elemento contenedor.


```wl
// Go to Dashboard plane
CELL_Plane.Plane = 2
```



### Efectos de carga
<a name="efectos_carga_ELTPARAGRAPHE000042"></a>

Uno o más efectos pueden ocurrir al pasar de un avión a otro. Los efectos pueden ser definidos desde la ventana de description del elemento, pestaña "Estilo".. Se pueden definir los efectos:

- en el elemento de contenedor que gestiona el avión. Todo lo que tienes que hacer es añadir un efecto con un release adaptado (cambiar de plano, ir al plano anterior, etc.). 6 efectos disponibles para gestionar el cambio de avión: barrido de planos, secuencia de planos Blur, fundido de planos (%), superposición de planos, pliegue de planos, volteo de planos.

- en el control encontrado en el avión. Sólo hay que añadir un efecto con activación de aparición (mostrar el plano donde se encuentra la control) o desaparición (mostrar otro plano).





### Visualización retardada
<a name="visualizacion_retardada_ELTPARAGRAPHE000050"></a>

Por Default, la Page es cargada íntegramente por el navegador, con el contenido completo de cada plano. En una aplicación en la que todos los elementos se encuentran en una única Page, este modo de funcionamiento puede ralentizar considerablemente la visualización de la Page.
Para evitar esta lentitud, los aviones pueden ser cargados en modo retrasado: el contenido del plano se cargará efectivamente cuando se realice una solicitud de carga del plano:

- al cargar la página si el avión es mostrado por Default,

- al cambiar el plano a través de la [Tela impermeable](../Proprietes/2510094.md) Property.


Para retrasar la carga de los planos, basta con marcar "Carga diferida del contenido de los planos" en la pestaña "UI" del elemento contenedor description. Esta opción permite habilitar dos nuevos eventos "Carga retardada del plano", disponibles en el editor de código:

- un servidor AJAX Event llamado cuando se muestra un avión,

- un navegador llamado Event una vez que el avión está cargado.


El plano debe programarse en estos eventos para que se cargue realmente..

```wl
// -- Event "Defer loading of a plan (server)"
// According to plane
SWITCH MySelf.Plane
	// Dashboard
	CASE 2
	LoadWidget()
	LoadChart()
	// Products
	CASE 3
	...
END
```

En estos dos eventos, el número del avión que acaba de ser visualizado está disponible a través de la [Tela impermeable](../Proprietes/2510094.md) Property.

Si quieres saber el número del avión que se mostró antes, sólo tienes que guardarlo en un Variable.

Para más detalles sobre los aviones, véase [Los aviones en WEBDEV](../WDChamp/1013080.md). 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Uso de ventanas emergentes
<a name="uso_ventanas_emergentes_ELTTEXTE000287"></a>
Para que el usuario Web tenga la sensación de utilizar una aplicación nativa, tiene la posibilidad de utilizar cuadros de diálogo, para proponer una autenticación, por ejemplo.

Para obtener este tipo de UI con WEBDEV, simplemente use las páginas Popup.

Para crear una página Popup, en la pestaña "Creación", en el grupo "Contenedores", haga clic en "Popup".

Una ventana emergente Page se muestra desde un código de navegador, a través de [PopupDisplay](../WDLang2/1000019788.md). Esta función espera que se muestre el nombre del popup y su posición (posición específica o posición relativa a una control) como parámetro.


```wl
// Displays the connection popup
PopupDisplay(POPUP_Connection, popupTopLeft, 0, 0)
```
Para obtener más información, consulte [La Control Popup](../WDChamp/1000022001.md). 

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Autenticación
<a name="autenticacion_ELTTEXTE000311"></a>
La autenticación es un elemento importante en una aplicación Web.

La autentificación no debe realizarse en un navegador Event: una persona maliciosa podría fácilmente pasar por alto la autenticación.

Sin embargo, debe evitar el uso de retornos de servidor en una sola aplicación de Page App.. Por lo tanto, se debe utilizar un Ajax Process:

- llamando a la función WLanguage [AjaxExecute](../WDLang2/3055114.md). 
	
	```wl
	// Checks the information
	// for user authentication
	let sConnectionIdentifier = AJAXExecute(CheckConnectionInformation, EDT_Login, EDT_Password)
	```


- activando el botón de conexión en modo Ajax (si el código de conexión se encuentra directamente en el botón). 




Para que el usuario no tenga que teclear sus identificadores en cada conexión, su autenticación puede ser almacenada a través de un Cookie.

Durante el próximo inicio de la aplicación, si el Cookie se encuentra y es correcto, el usuario se autenticará automáticamente y accederá
el contenido de la aplicación directamente.

Para realizar este comportamiento, debes:

1. Almacenar una Cookie durante la autenticación a través de [CookieWrite](../WDLang2/3012008.md). El Cookie no almacena el nombre de usuario directamente, sino un valor aleatorio generado durante su conexión y que fue almacenado en la base de datos.
	
	```wl
	//-- Server procedure run via AjaxExecute
	PROCEDURE CheckConnectionInformation(...
	sLogin is string, sPassword is string)
	// Finds the user in database
	HReadSeekFirst(User,  Login, sLogin)
	...
	// Stores a connection identifier
	User.ConnectionGUID = GetGUID()
	HModify(User)
	// The identifier is returned (to be stored)
	RESULT User.ConnectionGUID
	```

	```wl
	//-- Browser code of connection button
	// Generates a cookie if necessary
	IF CBOX_RememberMe THEN
		CookieWrite("Connection", sConnectionIdentifier)
	END
	```


2. En la página de carga de Event( OnLoad), si se encuentra la Cookie, el popup de autenticación no se muestra y el usuario se conecta directamente.
	
	```wl
	//-- Browser code to load a page
	let sConnectionGUID = CookieRead("Connection")
	// Finds the user
	let bKnownUser = AJAXExecute(CheckConnectionInformation, sConnectionGUID)
	//-- Server procedure
	PROCEDURE CheckConnectionIdentifier(LOCAL sConnectionIdentifier)
	// Finds the user
	HReadSeekFirst(User, ConnectionGUID, sConnectionIdentifier)
	RESULT HFound(User)
	```





Consejo: Para una aplicación Web con autenticación, no olvide utilizar una conexión HTTPS para no interceptar el nombre de usuario y la contraseña.

<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Gestión de la tecla Atrás
<a name="gestion_tecla_atras_ELTTEXTE000335"></a>
Cuando el usuario de la Web pulsa el botón "Atrás" del navegador, éste vuelve a la página anterior de Page. ¡Una única aplicación Page incluye un único Page! Por lo tanto, ¡el botón Atrás vuelve al Page que aparecía antes de iniciar la aplicación!

WEBDEV permite asignar un comportamiento estándar al botón de retroceso.

- El historial de navegación se rellena automáticamente e intercepta el "Atrás" (o "Siguiente") Event a control la pantalla.

- La aplicación Page de Single Page App se muestra en su estado anterior.




Esta gestión se realiza mediante programación: 

- a través de las funciones: 
	


|   |   |
| --- | --- |
| [BrowserHistoryAdd](../WDLang2/1000023458.md) | Añade una entrada en la historia de la navegación asociando datos. Estos datos se transmitirán al volver a esta entrada. |
| [BrowserHistoryModify](../WDLang2/1000023459.md) | Modifica los datos de la entrada actual en el historial de navegación. Estos datos se transmitirán al volver a la entrada actual. |

- a través del opcional Event "Moverse en el historial de navegación" llamado cuando el usuario hace clic en "Atrás" o "Siguiente". Para obtener más información, consulte [Eventos opcionales associated con páginas](../WDChamp/1012014.md)





