


## Reporte a partir de una consulta
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000606"></a>
Las consultas se utilizan para seleccionar fácilmente los registros en uno o más archivos de datos. Las consultas también pueden utilizarse para realizar cálculos sobre los datos seleccionados. Puede, por ejemplo, seleccionar todos los pedidos para los clientes que viven en la ciudad de Nueva York y calcular la cantidad total de pedidos por cliente.

El uso de consultas en una reporte le permite crear fácilmente informes complejos. La consulta preselecciona los registros y el reporte organiza los datos seleccionados y realiza los diferentes cálculos.

**Atención**: Para optimizar la reporte, le aconsejamos que realice los cálculos (totales de las posiciones, por ejemplo) en el reporte (y no en la consulta).



Se pueden utilizar varios modos para crear una reporte basada en una consulta:

- la consulta se crea y se graba en el editor de consultas. El reporte se basa en el archivo correspondiente a la consulta (archivo.WDR). La consulta puede ser reutilizada en otra ventana de reporte, control, ... La consulta se puede modificar en cualquier momento en el editor de consultas. ***Se dice que la consulta es independiente***. 

- la consulta se crea al crear la reporte. La consulta está incluida en la sección reporte. No se crea ningún fichero específico para la consulta. La consulta sólo puede modificarse desde el reporte donde fue creada.. No puede ser reutilizado en otra reporte, ventana, control, ... ***Se dice que la consulta está incrustada***. 

- ***la consulta se basa en datos procedentes de una conexión*** (no disponible en WINDEV Mobile). 
	Observación: Este tipo de reporte basado en una consulta está disponible incluso si no se realiza ningún análisis associated con el proyecto WINDEV o WEBDEV.




**Consejo**: Tiene la posibilidad de crear, desde el editor de consultas, una reporte basada en la consulta seleccionada actual.. Para ello, en la pestaña "Consulta", en el grupo "Enlace de datos", haga clic en "Crear un reporte".

**Observación**: Una consulta independiente o una consulta incrustada puede aceptar parámetros. Para obtener más información, consulte [Reporte a partir de una consulta con parámetros](#NOTE4_1).

La reporte se puede imprimir fácilmente desde sus programas WLanguage. Para obtener más información, consulte [Impresión de una reporte basada en una consulta](#NOTE5_1).
Esta página de ayuda presenta: 

- [Cómo crear un reporte en una consulta independiente](#NOTE2_1).

- [Cómo crear una reporte sobre una consulta incrustada](#NOTE3_1).

- [Cómo crear una reporte en una consulta con parámetros](#NOTE4_1).

- [Cómo imprimir un reporte en una consulta](#NOTE5_1).

	- [Caso general](#NOTE5_2).

	- [Para una consulta con parámetros](#NOTE5_3).







<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Reporte en consulta independiente
<a name="reporte_consulta_independiente_ELTTEXTE000630"></a>


### Presentación
<a name="presentacion_ELTPARAGRAPHE000115"></a>

La consulta debe crearse antes de la reporte (para más detalles, véase [Creación de una consulta](../Editeurs/2032059.md)). Al crear la reporte, todo lo que tiene que hacer es especificar el nombre de la consulta utilizada.

Si la consulta se modifica en el editor de consultas (borrado de posiciones de resultados, por ejemplo), se muestra una pantalla de sincronización al cerrar la consulta.. Esto le permite aplicar las modificaciones realizadas en la consulta a todos los elementos que utilizan esta consulta (incluidos los informes).
<a name="NOTE2_2"></a>


### Creación de una reporte en consulta independiente
<a name="creacion_una_reporte_consulta_independiente_ELTPARAGRAPHE000127"></a>

Crear una reporte sobre consulta independiente:

1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_nouveau.gif) en los botones de acceso rápido. 

	- La ventana de creación de nuevos elementos se abre: haga clic en "Reporte", y luego en "Reporte". 

	- El asistente de creación de reportes se abre.




2. Elija el diseño de su reporte (tabla, formulario, etiqueta,...). Para obtener más información, consulte [Los diferentes tipos de informes](../WDChamp/1011054.md).

3. Seleccione (si es necesario) el reporte modelo a utilizar. Un reporte modelo se utiliza para cumplir con una disposición específica Page. Para más detalles sobre las plantillas reporte, véase [Modelos de reportes](../WDChamp/9000105.md). 

4. Seleccione la fuente de datos de reporte ("De un archivo de datos o de una consulta existente").

5. Seleccione la consulta en la que se basará la reporte. Sólo se proponen las consultas que se encuentran en la aplicación actual.

6. Para agrupar los registros, puede crear rupturas en las posiciones de clasificación. Para crear descansos, responda "Sí" a la pregunta "¿Desea añadir algunos descansos en la reporte?".
	En el siguiente paso de asistente se seleccionan los elementos de clasificación correspondientes a las pausas. Para más detalles sobre las pausas, véase [Rompimientos en un reporte](../WDChamp/1011028.md).

7. Para cada uno de los artículos mostrados en el reporte:

	- escriba la leyenda correspondiente. Este título aparecerá en la pantalla:

		- antes de la posición. Por ejemplo:<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=etatLibelleFiche.gif)


		- en la cabecera de columna (para los informes de tabla). Por ejemplo:<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=etatLibelleTable.gif)
 Esta leyenda puede ser modificada en el editor de reportes.

- seleccionar el bloque donde se imprimirá el control associated con el elemento. Las posiciones de los diferentes mandos se pueden modificar en el editor de reportes. Para más detalles sobre los diferentes bloques y su posición en un reporte, véase [Bloques de reporte](../WDChamp/1011040.md).

8. Modifique (si es necesario) el orden de visualización de los controles en la reporte con los botones de flecha que se encuentran a la derecha de tabla.

9. Si la consulta associated con el reporte contiene al menos un elemento numérico, tienes la posibilidad de realizar cálculos estos elementos. Especifique el cálculo realizado para cada posición (suma, media,...). Existen dos tipos de cálculos disponibles:

	- ***cálculo general***: se creará un control calculado en el bloque *End of Document*.

	- ***cálculo en ruptura***: se creará un control calculado en el bloque *Break footer*. En los cálculos sobre la ruptura, el resultado del cálculo se reinicia después de cada ruptura. Para realizar un cálculo sobre la ruptura, debe encontrarse una ruptura en la reporte actualmente creada.




10. Dependiendo del tipo de reporte creado actualmente, indique las opciones específicas.
	

| Tipo de reporte | Opciones específicas |
| --- | --- |
| Reporte basado en un formulario | Formulario Image, imprimiendo el formulario Image, ...<br>Opciones presentadas en detalle en [Reporte basado en un formulario](../WDChamp/1011067.md) |
| reporte Label | Formato de las etiquetas, número de copias idénticas, ...<br>Opciones presentadas en detalle en [reporte Label](../WDChamp/1011050.md) |



11. Especificar el formato de la hoja en la que se imprimirá el reporte. El reporte se imprime en formato A4 por Default.
	Observación: Por Default, los controles de reporte se muestran en una sola columna. Para crear una reporte multicolumna, simplemente especifique el número de columnas deseado en la pestaña "Formato" de la ventana de reporte description.

12. Selecciona la plantilla de la reporte si es necesario.

13. Escriba el nombre y el título del reporte (nombre del archivo ".WDE" correspondiente al reporte). Este nombre se utilizará para identificar la reporte en sus programas..
	![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) También puede especificar si el reporte puede ser modificado por el usuario final en "Informes y consultas". 

14. Validar la creación de reporte. 

15. La editor de reportes propone automáticamente cambiar el formato reporte si se cumplen las siguientes condiciones:

	- el reporte creado actualmente incluye un tabla.

	- el formato reporte no permite visualizar todas las columnas de tabla.




16. Especificar (si es necesario) el modo para reducir el tamaño de reporte: 

	- Imprimir la reporte en varias páginas. En este caso, el usuario final tendrá que agrupar las páginas. Para obtener más información, consulte [Estampado Multi-Page](../WDChamp/1011065.md). 

	- Utilizar el modo horizontal. 

	- Reducir el tamaño de reporte. Atención: según el porcentaje de reducción, la reporte impresa puede volverse ilegible. 




17. La reporte creada actualmente se visualiza en el editor de reportes.




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Reporte sobre consulta incrustada
<a name="reporte_sobre_consulta_incrustada_ELTTEXTE000660"></a>


### Presentación
<a name="presentacion_ELTPARAGRAPHE000225"></a>

La consulta se crea al crear el reporte. Esta consulta se modificará desde el editor de reportes ("Editar la consulta" en el menú contextual del reporte). Si se realizan modificaciones en la consulta, el editor de reportes enumera estas modificaciones así como su incidencia en el reporte.

**Observación**: Pasar del modo embebido al modo independiente (es decir, extraer una consulta de un reporte):

1. Visualizar la reporte basada en la consulta incrustada (en el editor de reportes). 

2. Seleccione "Editar la consulta" en el menú contextual de reporte. Otra solución: en la pestaña "Modificación", en el grupo "Reporte", haga clic en "Editar consulta". La consulta se muestra en el editor de consultas.

3. En la pestaña "Inicio", en el grupo "General", despliegue "Guardar" y seleccione "Exportar .. A una consulta independiente".

4. Grabe la nueva consulta.



<a name="NOTE3_2"></a>


### Creación de una reporte en una consulta incrustada
<a name="creacion_una_reporte_una_consulta_incrustada_ELTPARAGRAPHE000255"></a>

Crear una reporte sobre consulta incrustada:

1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ico_nouveau.gif) en los botones de acceso rápido. 

	- La ventana de creación de nuevos elementos se abre: haga clic en "Reporte", y luego en "Reporte". 

	- El asistente de creación de reportes se abre.




2. Elija el diseño de su reporte (tabla, formulario, etiqueta,...). Para obtener más información, consulte [Los diferentes tipos de informes](../WDChamp/1011054.md).

3. Seleccione (si es necesario) el reporte modelo a utilizar. Un reporte modelo se utiliza para cumplir con una disposición específica Page. Para más detalles sobre las plantillas reporte, véase [Modelos de reportes](../WDChamp/9000105.md). 

4. Seleccione la fuente de datos de reporte ("De una nueva consulta").

5. El asistente de creación de consultas se abre automáticamente. Seleccione los elementos utilizados por la consulta.
	**Observación**: Para simplificar la selección de los artículos, mostrarlos en orden alfabético o por archivo associated.

6. Defina las características de la consulta (condición de selección, grupo, ordenación, etc.) haciendo clic en el botón correspondiente.
	Para obtener más información, consulte:

	- [condiciones de selección de una consulta](../Editeurs/2032019.md),

	- [operaciones que se pueden realizar en una consulta](../Editeurs/2032020.md),

	- [ordenar los registros de consulta por orden de importancia](../Editeurs/2032005.md) (este orden es importante para los descansos).




7. Pase a la etapa siguiente.

8. Para agrupar los registros, puede crear rupturas en los elementos de clasificación definidos en la consulta. Para crear descansos, responda "Sí" a la pregunta "¿Desea añadir algunos descansos en la reporte?".
	El paso siguiente se utiliza para seleccionar las posiciones de clasificación correspondientes a las pausas. Para más detalles sobre las pausas, véase [Rompimientos en un reporte](../WDChamp/1011028.md).

9. Para cada elemento de consulta mostrado en el reporte:

	- escriba la leyenda correspondiente. Este título aparecerá en la pantalla:

		- antes de la posición. Por ejemplo:
						<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=etatLibelleFiche.gif)


		- en la cabecera de columna (para los informes de tabla). Por ejemplo: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=etatLibelleTable.gif)
 Este epígrafe puede modificarse en el editor de reportes.

- seleccionar el bloque donde se imprimirá el control associated con el elemento. Las posiciones de los diferentes mandos se pueden modificar en el editor de reportes. Para más detalles sobre los diferentes bloques y su posición en un reporte, véase [Bloques de reporte](../WDChamp/1011040.md).

10. Modifique (si es necesario) el orden de visualización de los controles en la reporte con los botones de flecha que se encuentran a la derecha de tabla.

11. Si la consulta associated con el reporte contiene al menos un elemento numérico, tienes la posibilidad de realizar cálculos estos elementos. Especifique el cálculo realizado para cada posición (suma, media,...). Existen dos tipos de cálculos disponibles:

	- ***cálculo general***: se creará un control calculado en el bloque *End of Document*.

	- ***cálculo en ruptura***: se creará un control calculado en el bloque *Break footer*. En los cálculos sobre la ruptura, el resultado del cálculo se reinicia después de cada ruptura. Para realizar un cálculo sobre la ruptura, debe encontrarse una ruptura en la reporte actualmente creada.




12. Dependiendo del tipo de reporte creado actualmente, indique las opciones específicas.
	

| Tipo de reporte | Opciones específicas |
| --- | --- |
| Reporte basado en un formulario | Formulario Image, imprimiendo el formulario Image, ...<br>Opciones presentadas en detalle en [Reporte basado en un formulario](../WDChamp/1011067.md) |
| reporte Label | Formato de las etiquetas, número de copias idénticas, ...<br>Opciones presentadas en detalle en [reporte Label](../WDChamp/1011050.md) |



13. Especificar el formato de la hoja en la que se imprimirá el reporte. El reporte se imprime en formato A4 por Default.
	Observación: Por Default, los controles de reporte se muestran en una sola columna. Para crear una reporte multicolumna, simplemente especifique el número de columnas deseado en la pestaña "Formato" de la ventana de reporte description. 

14. Selecciona la plantilla de la reporte si es necesario.

15. Escriba el nombre y el título del reporte (nombre del archivo ".WDE" correspondiente al reporte). Este nombre se utilizará para identificar la reporte en sus programas..
	![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) También puede especificar si el reporte puede ser modificado por el usuario final en "Informes y consultas". 

16. Validar la creación de reporte. 

17. La editor de reportes propone automáticamente cambiar el formato reporte si se cumplen las siguientes condiciones:

	- el reporte creado actualmente incluye un tabla.

	- el formato reporte no permite visualizar todas las columnas de tabla.




18. Especificar (si es necesario) el modo para reducir el tamaño de reporte: 

	- Imprimir la reporte en varias páginas. En este caso, el usuario final tendrá que agrupar las páginas. Para obtener más información, consulte [Estampado Multi-Page](../WDChamp/1011065.md). 

	- Utilizar el modo horizontal. 

	- Reducir el tamaño de reporte. Atención: según el porcentaje de reducción, la reporte impresa puede volverse ilegible. 




19. La reporte creada actualmente se visualiza en el editor de reportes.



<a name="NOTE3_3"></a>


### Usando un ítem de la consulta incrustada de un código de la reporte
<a name="usando_item_consulta_incrustada_codigo_reporte_ELTPARAGRAPHE000368"></a>Para acceder a un elemento de la consulta incrustada desde el código de un bloque reporte, control reporte o reporte, utilice la siguiente sintaxis:


```txt
MySource.MyItem
```


<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Reporte a partir de una consulta con parámetros
<a name="reporte_partir_una_consulta_con_parametros_ELTTEXTE000696"></a>
<a name="RptQry_Param"></a>
Una consulta independiente o una consulta incrustada puede aceptar parámetros. En este caso, una o varias condiciones de selección dependen de un parámetro durante la ejecución de la consulta.. Este parámetro puede corresponder al valor de un control Campo de entrada encontrado en una ventana.

Por ejemplo, para imprimir la factura del cliente X, todo lo que tiene que hacer es crear una reporte basada en una consulta con parámetros. En esta consulta, el parámetro será el nombre del cliente, por ejemplo. Por lo tanto, el valor del parámetro debe especificarse antes de imprimir el reporte:

- durante la prueba de la reporte basada en una consulta con parámetros, una ventana le permite escribir los parámetros de la consulta.

- en tiempo de ejecución, los parámetros de consulta deben especificarse con [iInitReportQuery](../WDLang5/3046021.md) (antes de utilizar [iPrintReport](../WDLang5/3046032.md)).


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ER.png) | Importante | Si la consulta se crea con Reports & Queries, no es necesario utilizar [iInitReportQuery](../WDLang5/3046021.md) para especificar los parámetros de la consulta. De hecho, cuando se ejecuta un reporte en una consulta con parámetros de Reports & Queries, una ventana le permite introducir los parámetros de la consulta. |



**Observación**: Para obtener más información, consulte [Consulta con parámetros](../Editeurs/2032045.md).

<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Impresión de una reporte basada en una consulta
<a name="impresion_una_reporte_basada_una_consulta_ELTTEXTE000738"></a>
Para imprimir una reporte basada en una consulta, debe distinguir entre dos casos:

- Reporte a partir de una consulta sin parámetros.

- Reporte sobre una consulta con parámetros




Observaciones:

- Si hay que pasar parámetros al ***reporte***, estos parámetros deben especificarse en [iPrintReport](../WDLang5/3046032.md), después del nombre del reporte a imprimir. Para obtener más información, consulte [Reporte con parámetros](../WDChamp/1011008.md).

- Cuando se utiliza en el código del reporte, el [SourceName](../Proprietes/2511035.md) Property permite obtener y cambiar el nombre de la consulta associated con el reporte.


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ER.png) | Importante | En [Reports & Queries](../Presentation/3088004.md), puede imprimir un reporte:<br><br>- iniciando un trabajo de impresión (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Ico_Imprimer.gif)). <br><br>- probando el reporte (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Ico_Go_Fenetre_WD_bl.gif)). <br><br><br>Por lo tanto, no se requiere programación para imprimir la reporte.<br><br>Al imprimir una reporte basada en una consulta con parámetros, una ventana permite introducir los parámetros de la consulta. |




<a name="NOTE5_2"></a>


### Impresión de una reporte basada en una consulta sin parámetros
<a name="impresion_una_reporte_basada_una_consulta_sin_parametros_ELTPARAGRAPHE000448"></a>

Para imprimir una consulta sin parámetros, debe:

1. Configura el destino de la impresión de reporte:

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) En WINDEV, con [iDestination](../WDLang5/3046074.md) (visor de reporte, impresión en un archivo HTML, etc.).


 Para obtener más información, consulte [Modos de impresión de un reporte](../WDChamp/1011031.md).

2. Especifique el nombre de la reporte a imprimir con [iPrintReport](../WDLang5/3046032.md).
	Por ejemplo:

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) En WINDEV: para imprimir el "RPT_Query" reporte:
			
		```wl
		// Open report viewer
		iDestination(iViewer)
		// Print the RPT_Query report
		iPrintReport(RPT_Query)
		```







<a name="NOTE5_3"></a>


### Imprimir un reporte basado en una consulta con parámetros
<a name="imprimir_reporte_basado_una_consulta_con_parametros_ELTPARAGRAPHE000502"></a>

Para imprimir una consulta con parámetros, es necesario:

1. Configura el destino de la impresión de reporte:

	- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) En WINDEV, con [iDestination](../WDLang5/3046074.md) (visor de reporte, impresión en un archivo HTML, etc.).


 Para obtener más información, consulte [Modos de impresión de un reporte](../WDChamp/1011031.md).

2. Pase los parámetros a la consulta con [iInitReportQuery](../WDLang5/3046021.md).

3. Especifique el nombre de la reporte a imprimir con [iPrintReport](../WDLang5/3046032.md).




**Por ejemplo**: El "RPT_Query" reporte se basa en una consulta con parámetros. Los parámetros esperados por la consulta son el nombre y el tipo de empresa. Estos parámetros se han introducido en la ventana para iniciar la impresión de reporte.

- ![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Código WINDEV:
	
	```wl
	// Open report viewer
	iDestination(iViewer)
	// Pass the parameters to the query associated with the report
	iInitReportQuery(RPT_Query, CompanyName, CompanyType)
	// Print the list of companies
	iPrintReport(RPT_Query)
	```



**Observación**: Si no se especifican algunos de los parámetros esperados por la consulta (valor correspondiente a NULL por ejemplo), se ignorarán las condiciones de selección correspondientes a estos parámetros.




