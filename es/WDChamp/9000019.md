


## Persistencia de datos
			



<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000311"></a>
La persistencia de los datos se utiliza para almacenar el valor escrito por el usuario.

Cuando el usuario introduce un valor en una ventana control, este valor se mostrará en la control la próxima vez que se abra la ventana. Esta función es útil cuando se introduce un nombre de usuario, se realizan búsquedas, se utilizan parámetros semiconstantes, para las elecciones de Default, ...

Esta función está disponible para todos los controles editables. Esta función también está disponible para seleccionar valores en un botón de radio o control Casilla de verificación.



![Windows](https://doc.pcsoft.fr/ext/images/us/WINDOWS.png)![Linux](https://doc.pcsoft.fr/ext/images/us/LX.png) La persistencia de los datos sólo se consigue mediante la programación. La información se almacena en un navegador Cookie. 

<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## ¿Cómo proceder?
<a name="¿como_proceder_ELTTEXTE000335"></a>


### Activar o desactivar la persistencia de una control en una ventana
<a name="activar_desactivar_persistencia_una_control_una_ventana_ELTPARAGRAPHE000068"></a>

Para activar o desactivar la persistencia de una control en una ventana: 

1. Abra la ventana de descripción del control. 

2. En la pestaña "Detalles" marque (o desmarque) "Guardar el valor".




En Default, los valores de los controles persistentes se almacenan en el registro (o el archivo equivalente en la plataforma de ejecución). Por ejemplo: 




![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) **Observación**: Este mecanismo puede ser implementado por el usuario a través de ["Guardar" en el menú contextual de los controles (AAF)](../WDChamp/9500128.md). 

<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Modo de funcionamiento
<a name="modo_funcionamiento_ELTTEXTE000359"></a>


### Estudio del modo de funcionamiento
<a name="estudio_del_modo_funcionamiento_ELTPARAGRAPHE000096"></a>

**Cuando el mecanismo de persistencia de control está activado**: 

- El contenido de la control se borra al cerrar la aplicación. 
	![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Esta información se almacena en el registro, en la siguiente clave: "HKEY_CURRENT_USER\\Software\\&lt;Company&gt;\\&lt;Project Name&gt;".. Esta tecla se devuelve a través de la programación de [ProjectInfo](../WDLang1/3064004.md).

- Durante el siguiente inicio de la aplicación, el mecanismo de persistencia restaura los controles almacenados en su estado anterior.. Esta operación de restauración se realiza entre el código de declaración de la ventana y el código de inicialización de la ventana.. 




Por lo tanto, la asignación de un valor control se realiza en el siguiente orden:

1. Valor definido en la pestaña "Contenido" del control description.

2. Ejecución del código de inicialización de control. Este código puede inicializar y modificar el valor inicial de la control.

3. Valor persistente (guardado en el registro, en un archivo de parámetros, ....). Si se ha definido un valor persistente para el control, este valor se asigna al control.

4. Ejecutar el código de inicialización de la ventana. Este código puede inicializar y modificar el valor asignado a la control. 




Además, para mantener la compatibilidad con el modo de funcionamiento existente de la aplicación: 

- se ejecutan los procesos de modificación de los controles asignados "automáticamente".

- se ejecutan los códigos de selección de los controles List Box y Combo Box.Si el Process para modificar o seleccionar el control no debe ejecutarse, su ejecución puede condicionarse como sigue: 





```wl
// Code for selecting a row in Combo Box control 
// or code for modifying a control
IF OPENING THEN RETURN
```
En este caso, el resto de la Process no se ejecuta si la llamada a este código se activa en cuanto se abre la ventana, al restaurar los valores almacenados.
<a name="NOTE3_2"></a>


### Configuración
<a name="configuracion_ELTPARAGRAPHE000128"></a>

La información de persistencia se almacena en el registro (o el archivo equivalente en la plataforma en tiempo de ejecución).. El método y la ubicación de esta información pueden ser modificados por [InitParameter](../WDLang1/3025044.md).

Esta función acepta dos parámetros:

- El método para almacenar los datos:

	- Document en formato XML (no disponible en la versión móvil).

	- Archivo de configuración (.ini).

	- Registro.

	- Cadena en formato XML (para ser enviada por socket o protocolo HTTP por ejemplo).




- La ubicación correspondiente al método especificado en el primer parámetro (ruta del documento XML, ruta en el registro o ruta del archivo de configuración).




Ejemplo: 


```wl
// Use a configuration file (.ini)
InitParameter(paramIni, "C:\temp\MyConfig.ini")
```
La lectura y la copia de seguridad de los datos de persistencia siguen siendo idénticas: sólo se modifica el método de almacenamiento (y la localización).

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Modo de funcionamiento avanzado
<a name="modo_funcionamiento_avanzado_ELTTEXTE000389"></a>


### Almacenamiento de las variables globales de un proyecto
<a name="almacenamiento_las_variables_globales_proyecto_ELTPARAGRAPHE000155"></a>

El mecanismo de persistencia no sólo se utiliza para almacenar los controles, sino también para almacenar las variables o cualquier otra información requerida por una aplicación.

No es necesario gestionar "manualmente" un archivo de configuración para almacenar el contenido de las variables globales de un proyecto (datos ruta, fecha de la última conexión, nombre de usuario, almacenamiento de la contraseña, etc.)
<a name="NOTE4_2"></a>


### Implementación
<a name="implementacion_ELTPARAGRAPHE000164"></a>

Debe utilizar [LoadParameter](../WDLang1/3025047.md) y [SaveParameter](../WDLang1/3025046.md).

[LoadParameter](../WDLang1/3025047.md) acepta dos parámetros:

- El nombre del parámetro a restaurar (nombre lógico), por ejemplo el nombre de la Variable correspondiente.

- El valor de Default del parámetro (si este parámetro nunca se ha guardado o utilizado).



```wl
// Load an integer parameter
gnNbStartups = LoadParameter(CS_NB_STARTUPS)
// Load a date parameter
gdLastStartupDate = LoadParameter(CS_STARTUP_DATE)
// Load a time parameter
gtLastStartupTime = LoadParameter(CS_STARTUP_TIME)
```
No hay necesidad de gestionar el tipo de parámetro: el tipo de parámetro está totalmente gestionado por el mecanismo de persistencia (no es necesario, por ejemplo, utilizar [Val](../WDLang1/3024037.md) para recuperar un valor numérico).

[SaveParameter](../WDLang1/3025046.md) también acepta dos parámetros:

- El nombre del parámetro a guardar (nombre lógico). Este nombre se utiliza en [LoadParameter](../WDLang1/3025047.md).

- El valor del parámetro.



```wl
// Store an integer parameter
SaveParameter(CS_NB_STARTS, gnNbStarts)
// Store a date parameter
SaveParameter(CS_START_DATE, gdLastStartDate)
// Store a time parameter
SaveParameter(CS_START_TIME, gtLastStartTime)
```
La información almacenada por [SaveParameter](../WDLang1/3025046.md) se almacena utilizando el método y la ubicación especificados por [InitParameter](../WDLang1/3025044.md) (por lo tanto, esta información es almacenada en el registro por Default).

Nota: Se pueden utilizar varios métodos y/o varios archivos de copia de seguridad en la misma aplicación.

<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Optimización
<a name="optimizacion_ELTTEXTE000419"></a>


### Almacenamiento de las variables globales de un proyecto
<a name="almacenamiento_las_variables_globales_proyecto_ELTPARAGRAPHE000213"></a>

Una optimización puede ser necesaria cuando la aplicación realiza procesos largos.. En efecto, los códigos de modificación de los controles "restaurados" se ejecutan. Si uno de estos controles contiene un código potencialmente largo, puede ser interesante no ejecutar todos los códigos de modificación mientras se restauran los controles.

**Ejemplo: Caso de una ventana de búsqueda multicriterio que utiliza el mecanismo de persistencia**

1. Durante la primera puesta en marcha, los controles no tienen ningún valor almacenado, el modo de funcionamiento es "como de costumbre".

2. Al final de la aplicación, el mecanismo de persistencia almacena los criterios de búsqueda seleccionados por el usuario.

3. Al iniciar la aplicación, se restauran los controles almacenados y se ejecutan los códigos de modificación de los controles.

4. Si estos códigos de modificación inician la ejecución de la búsqueda (caso común de un botón de opción), la búsqueda se realizará con criterios diferentes para cada control almacenado. Esta operación puede ser muy larga según las búsquedas realizadas.



<a name="NOTE5_2"></a>


### Optimización
<a name="optimizacion_ELTPARAGRAPHE000227"></a>

En estos casos especiales, todo lo que tiene que hacer es "desactivar" los procesos potencialmente largos mientras se restauran automáticamente.. Usted tiene la capacidad de usar el siguiente método: 

1. Declarar una ventana global Variable (tipo booleano) en la ventana correspondiente.
	
	```wl
	// Declaration code of the window
	GLOBAL
	gbRestoreInProgress is boolean
	```


2. Inicializar esta Variable a "True" en el código de declaración de la ventana.
	
	```wl
	// Declaration code of the window
	gbRestoreInProgress = True
	```


3. Añadir una prueba sobre esta Variable en los procesos potencialmente largos. Si esta variable se posiciona en "True", no se realiza el Process (los controles se restauran actualmente por el mecanismo de persistencia).
	
	```wl
	// Potentially long process
	IF gbRestoreInProgress = True THEN RETURN
	...
	```


4. Asignar esta Variable a "False" al principio del código de inicialización de la ventana para restablecer el modo de funcionamiento estándar de la aplicación.
	
	```wl
	// Initialization code of the window
	gbRestoreInProgress = False
	```





<a name="NOTE6"></a>
<a name="NOTE6_1"></a>


## Gestión de la persistencia de los datos con las funciones de WLanguage
<a name="gestion_persistencia_los_datos_con_las_funciones_wlanguage_ELTTEXTE000449"></a>
La persistencia de los datos también puede gestionarse mediante programación con las siguientes funciones: 



|   |   |
| --- | --- |
| [BorrarParámetro](../WDLang1/3025048.md) | Borra un parámetro (o una set de parámetros) guardado por [SaveParameter](../WDLang1/3025046.md), o automáticamente a través de la persistencia de datos en los controles. |
| [InitParameter](../WDLang1/3025044.md) | Inicializa la gestión de los valores persistentes. |
| [LoadParameter](../WDLang1/3025047.md) | Lee un valor persistente. |
| [SaveParameter](../WDLang1/3025046.md) | Guarda un valor persistente en el registro o en otro archivo especificado por [InitParameter](../WDLang1/3025044.md). |





![WINDEV](https://doc.pcsoft.fr/ext/images/us/WD.png) Observaciones: 

- Para guardar automáticamente todos los controles persistentes que se encuentran en una ventana, utilice [AAFExecute](../WDLang1/1000022099.md).

- [AAFDisable](../WDLang1/1000022018.md) se utiliza para desactivar la persistencia de los controles.







