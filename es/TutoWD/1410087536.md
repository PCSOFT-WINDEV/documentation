
## Lección 4.5. Imprimir un pedido
<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Esta lección abarcará los siguientes temas
<a name="esta_leccion_abarcara_los_siguientes_temas_ELTTEXTE000498"></a>


- Crear un reporte basado en una consulta.

- Imprimir un reporte basado en una consulta con parámetros.





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=dur%E9e.png)<br> | <br>Tiempo estimado: 30 min |

| [Lección anterior](../TutoWD/1410087535.md) | [Tabla de contenido](../TutoWD/1410087560.md) | [Siguiente lección](../TutoWD/1410087537.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000545"></a>
Ahora daremos al usuario la posibilidad de imprimir directamente los detalles del pedido buscado. El reporte puede imprimirse directamente a través del menú contextual del control Tabla.



- Abra de nuevo el proyecto en el que trabajó en la lección anterior. 

	1. Vaya a la página de inicio de WINDEV (Ctrl + &lt;).

	2. En la página de inicio, haga clic en "Tutorial", luego en "Part 4 - Full application with data" haga doble clic en "Full application - Exercise".

	3. Un cuadro de diálogo le pide que abra el proyecto en el que trabajó en la lección anterior. Puede abrir la copia local o el proyecto original. Seleccione "Abrir la copia local". 





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WD.png) | Corregido | Hay un proyecto completado disponible. Este proyecto contiene los diferentes reportes creados en esta lección. Para abrir el proyecto completado, vaya a la página de inicio y haga clic en "Tutorial", luego en "Part 4 - Full application with data", haga doble clic en "Full application - Answers". |





<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Crear el reporte "Order form" (Orden de compra)
<a name="crear_reporte_order_form_orden_compra_ELTTEXTE000587"></a>
Primero, vamos a definir los datos que se mostrarán en el reporte:

- Las características del pedido: fecha y número de pedido.

- Los datos personales del cliente: nombre, dirección, código postal, ciudad y país.

- Las características de las líneas de pedido:

	- Cantidad del pedido,

	- Referencia del producto,

	- Título del producto, 

	- Total sin impuestos,

	- Total con impuestos.





Para crear el reporte fácilmente, los datos a imprimir se agruparán en una consulta. Esta consulta puede ser utilizada por el reporte o por cualquier otro elemento del proyecto WINDEV (control Tabla, control Looper, etc.). |   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | WINDEV propone crear reportes a partir de varias fuentes de datos: archivos de datos, consultas, controles, archivos de texto, etc.<br><br>En la mayoría de los casos, se recomienda agrupar los datos a imprimir en una consulta y luego, crear un reporte basado en dicha consulta. Para agregar datos al reporte, simplemente agregue el campo correspondiente a la consulta.<br><br>Los reportes basados en archivos de datos deben ser reportes simples, es decir, que muestren datos de un solo archivo de datos. |




<a name="NOTE3_2"></a>


### Crear una consulta
<a name="crear_una_consulta_ELTPARAGRAPHE000064"></a>

- Vamos a utilizar el editor de consultas para crear la consulta base del reporte.

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Cr%E9er1_GAF.jpg) en los botones de acceso rápido. La ventana de creación de nuevos elementos se abre: haga clic en "Consulta­". El asistente de creación de consultas se abre.

	2. Elija la opción "Selección (SELECT)".
			Esta consulta nos permitirá seleccionar los registros que se imprimirán en el reporte. Pase a la etapa siguiente.

	3. La ventana de descripción de la consulta se abre. Para construir la consulta, vamos a seleccionar los elementos que se mostrarán en el resultado.

	4. Haga doble clic en los campos del análisis, a la izquierda de la ventana de descripción. Los campos que se tienen en cuenta se muestran en el centro de la pantalla.
			Los siguientes datos se imprimirán en el reporte:

		- información sobre el cliente. En el archivo de datos "Customer", haga doble clic en los campos FullName, Address, ZipCode, City, y Country.

		- la información sobre el pedido. En el archivo de datos "Order", haga doble clic en los campos OrderID y Date.

		- información sobre el producto. En el archivo de datos "Product", haga doble clic en los campos Reference, Caption, y PriceBT.

		- información sobre la línea de pedido. En el archivo de datos "OrderLine", haga doble clic en los campos Quantity y TotalBT.

		- el precio total del pedido. En el archivo de datos "Order", haga doble clic en los campos TotalBT y TotalIOT.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | El orden en el que se insertan los campos en la consulta es importante. Este orden corresponde al orden en el que se mostrarán los datos en el reporte. La creación del reporte correspondiente será mucho más simple si este orden se define correctamente. |









La ventana de descripción de la consulta es la siguiente: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%20Requ%EAte1.jpg&type=thumb)
Hasta ahora, esta consulta permite seleccionar todos los pedidos y las líneas de pedido correspondientes.

Vamos a seleccionar los datos de un solo pedido utilizando un identificador. Por lo tanto, vamos a definir el número de pedido como un parámetro. 



- Para definir el parámetro "Order ID":

	1. Seleccione el campo Order.OrderID en el centro de la ventana.

	2. Haga clic en el botón "Condición de selección" y seleccione "Nueva condición".

	3. En la ventana que aparece, vamos a especificar que la condición de selección corresponde a un parámetro: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%20Requ%EAte2.jpg)
Realice las siguientes operaciones:

		- Seleccione "Es igual a".

		- Seleccione "el parámetro".

		- El nombre del parámetro se propone automáticamente: "ParamOrderID".




4. Valide la ventana de descripción de la condición. El número "1" aparece a la derecha del campo Order.OrderID para indicar que se ha definido una condición de selección.

5. Indique un nombre para la consulta: escriba "QRY_OrderForm" en lugar de "QRY_SinNombre1" en la opción "Nombre de la consulta":  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%20Requ%EAte3.jpg)



<a name="NOTE3_3"></a>


### Crear un reporte basado en una consulta
<a name="crear_reporte_basado_una_consulta_ELTPARAGRAPHE000119"></a>

- Para crear un reporte:

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Cr%E9er1_GAF.jpg) en los botones de acceso rápido.

	2. La ventana de creación de nuevos elementos se abre: haga clic en "Reporte", y luego en "Reporte". El asistente de creación de reportes se abre.

	3. El asistente muestra varios tipos de reportes:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%202%20-%20Etat%20-%20HC%20N%B0001.jpg&type=thumb)


	4. Seleccione "Tabla". Pase a la etapa siguiente.

5. Seleccione la fuente de datos del reporte. El reporte se basará en la consulta que acabamos de crear. Seleccione "Un archivo de datos o una consulta existente". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%202%20-%20Etat%20-%20HC%20N%B0002.jpg&type=thumb)
 Pase a la etapa siguiente.

6. En la lista de archivos de datos y consultas, seleccione la consulta "QRY_OrderForm". Pase a la etapa siguiente.

7. El asistente pregunta si desea insertar rupturas. En este reporte, no vamos a utilizar rupturas. Este concepto se presentará más adelante en este tutorial. Seleccione "No insertar rupturas en el reporte". Pase a la etapa siguiente.

8. Vamos a especificar el orden en el que se imprimirán los campos y cómo se distribuirán en los diferentes bloques. En el asistente, los campos se muestran en el orden que se definió en la consulta:

	- Los campos que corresponden al cliente se mostrarán en el bloque "Encabezado de página". No es necesario repetir estos datos en cada línea de pedido.
						Para los campos FullName, Address, ZipCode, City y Country, haga clic en la línea que corresponde a cada campo. En la columna "Bloque", despliegue el cuadro combinado y seleccione "Encabezado de página".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%202%20-%20Etat%20-%20HC%20N%B0003.jpg&type=thumb)




- Ejecute el reporte haciendo clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_GO_Fenetre_WD_GAF.jpg) en los botones de acceso rápido.

	1. El editor de reportes propone varios destinos de impresión. Puede seleccionar uno de los siguientes destinos: <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%202%20-%20Etat%20-%20HC%20N%B0009.jpg)
Seleccione "Visor de reportes" y valide.

	2. El editor de reportes le pide que introduzca los parámetros de la consulta utilizada por el reporte. Anteriormente, utilizamos un parámetro para especificar el número del pedido que se va a imprimir. Para este ejemplo, introduzca el valor "1". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%202%20-%20Etat%20-%20HC%20N%B0010.jpg)
Valide.

	3. El reporte se muestra como lo definimos en el visor de reportes. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%202%20-%20Etat%20-%20HC%20N%B0011.jpg&type=thumb)
Es posible:

		- Imprimir directamente la página actual o todo el documento haciendo clic en la impresora.

		- Crear un duplicado.

		- Seleccionar un valor de zoom diferente.

		- Guardar el reporte como un documento de Word (en formato RTF).

		- Guardar el reporte en formato HTML.

		- Guardar el reporte en formato PDF.

		- Guardar el reporte en formato XML.

		- Crear un correo electrónico con el reporte en formato HTML en el cuerpo del mensaje.

		- Crear un correo electrónico y adjuntar el reporte como un documento PDF.

		- Agregar notas al documento.

		- Realizar búsquedas en el documento.

		- Agregar marcas de agua.







- Cierre el visor de reportes. 



<a name="NOTE3_4"></a>


### Modificar el reporte "Order form"
<a name="modificar_reporte_order_form_ELTPARAGRAPHE000289"></a>

Vamos a realizar algunos cambios en el diseño del reporte que acabamos de crear.



- Elimine el número de páginas que se muestra en el reporte:

	1. Seleccione el control [PAGENUM]/[NBPAGES].

	2. Presione la tecla Supr en el teclado.







- Vamos a ubicar la información sobre el cliente y el pedido en el encabezado de la página:

	1. Elimine el texto "Order form" que se encuentra en el encabezado de la página.

	2. Elimine el texto a la izquierda de la información del cliente (Full name, etc.). 

	3. Ubique el campo que contiene la ciudad junto al código postal.

	4. Seleccione los datos del cliente y desplácelos a la derecha del reporte.

	5. Desplace el número y la fecha del pedido hacia arriba y ubíquelos en la parte superior del bloque "Encabezado de página".







- Vamos a ubicar los totales correctamente en el pie de página:

	1. Seleccione los controles (títulos y campos) de los totales que se encuentran en el pie de página.

	2. Mueva estos controles a la esquina inferior derecha de la tabla.







- Cambie las opciones de impresión del bloque "Pie de página":

	1. Abra la ventana de descripción del bloque "Pie de página":

		- Haga clic en el bloque "Pie de página".

		- Haga clic derecho para abrir el menú contextual y seleccione la opción "Descripción del bloque".




2. En la pestaña "General", seleccione las siguientes opciones:

	- Imprimir el bloque "Fin de documento" DESPUÉS del bloque "Pie de página" en la última página.

	- El bloque "Pie de página" no se imprime en la parte inferior de la página, sino que se pega a los bloques anteriores..  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%203%20-%20Affichage%20-%20HC%20N%B0001.jpg&type=thumb)




Hemos terminado de crear el reporte.

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Visualización del reporte a imprimir desde una opción de menú
<a name="visualizacion_del_reporte_imprimir_desde_una_opcion_menu_ELTTEXTE000701"></a>
En nuestra aplicación, el reporte "RPT_Order_form" se imprimirá desde una opción del menú contextual del control Tabla en el que se muestra la lista de pedidos buscados.

Como ya hemos visto anteriormente, el control Tabla propone un menú automático. Conserve las opciones del menú automático y agregue una opción para imprimir la orden de compra seleccionada.

El principio es el siguiente:

1. Vamos a crear un nuevo menú contextual. Este menú contendrá el código WLanguage que permitirá imprimir el reporte.

2. Vamos a vincular este menú contextual al control Tabla y especificar que el menú contextual predeterminado se mostrará justo después del menú contextual definido para el control Tabla.



<a name="NOTE4_2"></a>


### Crear un menú contextual
<a name="crear_menu_contextual_ELTPARAGRAPHE000368"></a>

- Para crear un menú contextual en la ventana "WIN_Menu":

	1. Si es necesario, abra la ventana "WIN_Menu" en el editor (haga doble clic en su nombre en el panel "Explorador de proyectos", por ejemplo).

	2. En la pestaña "Ventana", en el grupo "Barras y menús", despliegue "Menús contextuales" y seleccione "Nuevo menú contextual".

	3. Un nuevo menú contextual aparece en el editor. Este menú solo tiene una opción llamada "Opción de menú".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%203%20-%20Affichage%20-%20HC%20N%B0003.jpg)


	4. Abra la descripción del menú contextual:

	- Seleccione "Opción de menú".

	- Haga clic derecho para abrir el menú contextual.

	- Seleccione "Descripción del menú contextual".






- Vamos a definir el título de la opción y escribir el código WLanguage.

	1. Seleccione "Opción de menú".

	2. Pulse la barra espaciadora: el texto pasa a modo de edición. Introduzca el texto "Print the order form" y valide.

	3. Abra los eventos WLanguage de la opción:

		- Seleccione la opción.

		- Haga clic derecho para abrir el menú contextual y seleccione "Código".




4. Introduzca el siguiente código WLanguage:
			
		```wl
		// Print in the report viewer
		iDestination(iViewer) 
		// Initializes the report query
		RPT_Order_form.InitQuery(TABLE_QRY_FindOrders.COL_OrderID)
		// Starts printing the report
		RPT_Order_form.Print()
		```
En este código:

	- La función [iDestination](../WDLang5/3046074.md) permite indicar que el reporte se imprimirá en el visor de reportes.

	- La función [&lt;Reporte&gt;.InitQuery](../WDLang5/1000025143.md) permite especificar los parámetros esperados por la consulta asociada al reporte. En este caso, la consulta espera el número de pedido como parámetro. El número de pedido se encuentra en la columna COL_OrderID del control TABLE_QRY_FindOrders de la fila actual.

	- La función [&lt;Reporte&gt;.Print](../WDLang5/1000024554.md) permite imprimir el reporte especificado (en este caso, el reporte RPT_Order_form).



<a name="NOTE4_3"></a>


### Asociar el menú contextual al control Tabla
<a name="asociar_menu_contextual_control_tabla_ELTPARAGRAPHE000433"></a>

- Última etapa: vamos a vincular el menú contextual con el control Tabla.

	1. En la ventana "WIN_Menu", seleccione la pestaña "Find orders".

	2. Seleccione el control Tabla y abra la descripción (opción "Descripción de la tabla" del menú contextual).

	3. En la pestaña "UI", despliegue la lista de "Menú contextual".

	4. Seleccione la opción "Agregar un menú contextual", seleccione el menú "MENU_Order" y luego seleccione la opción "Al inicio" para indicar que el menú se ubicará antes del menú del sistema.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%203%20-%20Affichage%20-%20HC%20N%B0004.jpg)


	5. Haga clic dentro de la ventana para validar el menú contextual. 

6. Valide.



<a name="NOTE4_4"></a>


### Prueba de la impresión
<a name="prueba_impresion_ELTPARAGRAPHE000457"></a>

- Ahora, solo tenemos que hacer una prueba real:

	1. Inicie la prueba de la ventana "WIN_Menu".

	2. Seleccione la pestaña "Find orders".

	3. Especifique los criterios e inicie una búsqueda.

	4. Seleccione uno de los pedidos que se muestran en el control Tabla.

	5. Imprima el pedido mediante el menú contextual.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20BDC%20-%203%20-%20Affichage%20-%20HC%20N%B0005.jpg&type=thumb)


	6. Cierre el visor de reportes y la ventana de prueba.




| [Lección anterior](../TutoWD/1410087535.md) | [Tabla de contenido](../TutoWD/1410087560.md) | [Siguiente lección](../TutoWD/1410087537.md) |
| --- | --- | --- |




