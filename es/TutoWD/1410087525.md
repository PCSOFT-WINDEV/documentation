
## Lección 4.10. Reutilizar del código mediante componentes externos
<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Esta lección abarcará los siguientes temas
<a name="esta_leccion_abarcara_los_siguientes_temas_ELTTEXTE000465"></a>


- ¿Qué es un componente externo?

- Crear un componente externo, paso a paso.

- Distribuir un componente externo.





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=dur%E9e.png)<br> | <br>Tiempo estimado: 40 min |

| [Lección anterior](../TutoWD/1410087524.md) | [Tabla de contenido](../TutoWD/1410087560.md) | [Siguiente lección](../TutoWD/1410087526.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000512"></a>
Un componente externo es un fragmento de código que se puede reutilizar en un número ilimitado de proyectos (y por lo tanto, de ejecutables).  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=Composant_PresentationGAF.gif)


Un componente externo permite tener un proceso idéntico con un único código fuente para realizar una operación determinada, incluso si este proceso debe ser realizado por varios proyectos.

Los proyectos que utilizan un componente externo pueden acceder al nombre de los objetos, procedimientos o métodos que el creador del componente ha definido como visibles. Los proyectos no pueden leer ni modificar el código fuente. Esto garantiza la confidencialidad y estabilidad del código fuente.

Crear un componente externo es **muy sencillo**.

¿Cómo proceder? No cambie nada, cree sus ventanas, procedimientos y clases. Luego, cuando termine, cree una configuración de tipo Componente con todos los elementos necesarios para el componente e inicie la generación, ¡es así de simple!

Un componente puede contener código, ventanas, un análisis, archivos de datos, etc.|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Se pueden usar cinco métodos para compartir el "código" en WINDEV:<br><br>1. Conjuntos de procedimientos.<br><br>2. Clases.<br><br>3. Supercontroles (a través de un diccionario).<br><br>4. Componentes externos.<br><br>5. Componentes internos.<br><br><br> |



A continuación, se presentan algunos casos en los que los componentes externos pueden ser de gran ayuda.
<a name="NOTE2_2"></a>


### Trabajo en equipo
<a name="trabajo_equipo_ELTPARAGRAPHE000051"></a>

Un desarrollador crea y gestiona un componente externo, y lo pone a disposición de otros desarrolladores. ¡No hay riesgo de que se realicen modificaciones "por error"!
<a name="NOTE2_3"></a>


### Proyectos grandes
<a name="proyectos_grandes_ELTPARAGRAPHE000058"></a>

Los componentes externos permiten tener varios proyectos pequeños y un proyecto central en el que se muestran elementos de otros proyectos. Los componentes externos son mucho más fáciles de usar que las bibliotecas (archivos WDL).
<a name="NOTE2_4"></a>


### Bases de datos a las que acceden varios proyectos
<a name="bases_datos_las_que_acceden_varios_proyectos_ELTPARAGRAPHE000065"></a>

Cuando varios proyectos acceden a la misma base de datos, a menudo se encuentran inconsistencias en la base de datos debido a código fuente antiguo o modificado. Al agrupar las operaciones de acceso a la base de datos (al menos en modo de escritura) en un componente externo, es posible verificar y  gestionar un solo código fuente, lo que permite reducir los riesgos de inconsistencia en la base de datos.

Además, el uso de un componente evita tener que volver a compilar la aplicación cuando se modifica el análisis.
<a name="NOTE2_5"></a>


### Procesos utilizados en varios proyectos
<a name="procesos_utilizados_varios_proyectos_ELTPARAGRAPHE000074"></a>A menudo se utilizan procesos de diferente complejidad en varios proyectos. Estos procesos se pueden volver a utilizar mediante "conjuntos de procedimientos" o "clases". En este caso, los cambios podrían no aplicarse a los diferentes proyectos, lo que hace que estos elementos ya no sean compatibles entre sí.
El uso de componentes externos evita cambios no deseados, mantiene la compatibilidad entre los proyectos y simplifica los cambios comunes.

Además, la palabra clave PRIVATE permite establecer la privacidad del código en todos los niveles del componente externo. Al reutilizar el componente externo en otro proyecto WINDEV, no se permitirá llamar a un procedimiento PRIVADO, pero se mostrará la documentación sobre el uso del procedimiento.
<a name="NOTE2_6"></a>


### Distribución de una funcionalidad o conjunto de funcionalidades
<a name="distribucion_una_funcionalidad_conjunto_funcionalidades_ELTPARAGRAPHE000084"></a>

Los componentes externos permiten desarrollar una funcionalidad o conjunto de funcionalidades. Otros desarrolladores podrán integrar estas funcionalidades en sus proyectos WINDEV. Los desarrolladores que utilizan un componente externo pueden ver los elementos del componente que se han hecho visibles. Sin embargo, el código fuente no se puede ver ni modificar.

Los componentes externos pueden ser comercializados o distribuidos de forma gratuita.
<a name="NOTE2_7"></a>


### Componentes externos multiplataforma
<a name="componentes_externos_multiplataforma_ELTPARAGRAPHE000093"></a>

Un componente externo puede ser utilizado en:

- una aplicación WINDEV,

- una aplicación WEBDEV,

- una aplicación WINDEV Mobile,

- los tres tipos de aplicaciones.




En este último caso, WINDEV permite:

- incluir elementos procedentes de WEBDEV y/o WINDEV Mobile en el mismo componente externo.

- especificar el código WLanguage que corresponde a cada plataforma de ejecución (por ejemplo, una ventana se abre con la función [Open](../WDLang1/3038035.md) en WINDEV y una página se abre con la función [PageDisplay](../WDLang2/3058008.md) en WEBDEV).




<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Etapa por etapa
<a name="etapa_por_etapa_ELTTEXTE000590"></a>


### Etapa 1: Crear un componente externo
<a name="etapa_1_crear_componente_externo_ELTPARAGRAPHE000118"></a>

Vamos a crear un componente externo a partir del proyecto "WD Full Application". Este proyecto permite administrar pedidos, productos y clientes. El componente externo se utilizará para identificar inmediatamente en otra aplicación los clientes que corresponden a una ciudad determinada.

Al llamar al componente externo, podrá:

- Pasar una ciudad como parámetro.

- Obtener una cadena con el nombre del cliente y el monto total de sus pedidos.




El proyecto "WD Full Application" contiene todos los elementos necesarios para no tener que escribir el código requerido para componente.



- Abra de nuevo el proyecto en el que trabajó en la lección anterior. 

	1. Vaya a la página de inicio de WINDEV (Ctrl + &lt;).

	2. En la página de inicio, haga clic en "Tutorial", luego en "Part 4 - Full application with data" haga doble clic en "Full application - Exercise".

	3. Un cuadro de diálogo le pide que abra el proyecto en el que trabajó en la lección anterior. Puede abrir la copia local o el proyecto original. Seleccione "Abrir la copia local". 





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WD.png) | Corregido | Hay un proyecto completado disponible. Este proyecto contiene los diferentes elementos creados en esta lección. Para abrir el proyecto completado, vaya a la página de inicio y haga clic en "Tutorial", luego en "Part 4 - Full application with data", haga doble clic en "Full application - Answers". |







- El proyecto contiene los siguientes elementos necesarios para el componente:

	- una consulta "QRY_OrdersByCity". Esta consulta con parámetros permite identificar a los clientes de una ciudad determinada, así como el monto total de sus pedidos.

	- un conjunto de procedimientos "SET_Component". Este conjunto de procedimientos contiene:

		- el procedimiento "GiveOrdersByCity" que devuelve, para la ciudad pasada como parámetro, una cadena que contiene el nombre del cliente y el monto total de sus pedidos.

		- el procedimiento "DataLocation" que permite localizar los datos utilizados por el componente.




- un análisis para describir los archivos de datos que almacenan la información.




- Ahora vamos a crear el componente. Para ello, crearemos una configuración de proyecto.
	|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Las configuraciones de proyecto permiten crear varias "configuraciones de destino" a partir del mismo proyecto:<br><br>	- Una aplicación de 32 bits,<br><br>	- Una aplicación de 64 bits,<br><br>	- Un componente, <br><br>	- ...<br><br><br>Puede elegir la configuración deseada y generar todos los elementos para todas las configuraciones del proyecto en una sola operación, en cualquier momento. |








- Para crear una configuración de proyecto de tipo "Componente":

	1. En la pestaña "Proyecto", en el grupo "Configuración del proyecto", despliegue "Nueva configuración" y seleccione "Componente externo (WDK)".

	2. El asistente de creación de nuevas configuraciones de proyecto se abre. WINDEV propone crear una configuración de proyecto de tipo "Componente". Pase a la etapa siguiente.

	3. Introduzca un nombre para la configuración de proyecto: por ejemplo, "CompoOrdersByCity". Pase a la etapa siguiente.

	4. Nuestro componente se utilizará en una aplicación Windows o Linux. Conserve las opciones predeterminadas. Pase a la etapa siguiente.

	5. Seleccione los elementos que se incluirán en la configuración de proyecto. En este ejemplo, los elementos también se incluirán en el componente.

		- Haga clic en el botón "Ninguno".

		- Seleccione los elementos "QRY_OrdersByCity" y "SET_Component".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Cr%E9er%20et%20utiliser%20un%20composant%20-%20HC%20N%B0001.jpg&type=thumb)







- Vamos a generar el componente.

	1. En la pestaña "Proyecto", en el grupo "Generación", haga clic en "Generar".

	2. El asistente de generación de componentes se abre automáticamente. Pase a la etapa siguiente del asistente. 

	3. Seleccione los elementos a los que se podrá acceder desde la aplicación cliente. En nuestro ejemplo, solo utilizaremos el conjunto de procedimientos "SET_Component":  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Cr%E9er%20et%20utiliser%20un%20composant%20-%20HC%20N%B0003.jpg&type=thumb)


	4. Pase a la etapa siguiente.

5. Puede activar la traducción del componente. Esta funcionalidad puede ser útil si el componente se utiliza en aplicaciones multilingües. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Cr%E9er%20et%20utiliser%20un%20composant%20-%20HC%20N%B0004.jpg&type=thumb)
Si la opción "Permitir traducción del componente" está seleccionada, se podrán traducir los elementos especificados del componente desde la aplicación que utiliza dicho componente.
			La traducción se realizará mediante WDMSG, un módulo independiente que extrae y reintegra los mensajes de un proyecto que se deben traducir.
			En este ejemplo, no seleccione esta opción. Pase a la etapa siguiente.

6. El asistente propone gestionar las diferentes versiones del componente. En nuestro ejemplo, acabamos de crear el componente.
			Conserve las opciones predeterminadas. Pase a la etapa siguiente.

7. Introduzca la información del componente:

	- Propietario, 

	- Título, Copyright, etc.




- Valide (botón "Finalizar"). Un mensaje indica que el componente se ha generado. Haga clic en "Finalizar" para validar el mensaje. 




- Ha terminado de crear el componente, ¡ya está listo para usar!



<a name="NOTE3_2"></a>


### Etapa 2: Utilizar el componente externo
<a name="etapa_2_utilizar_componente_externo_ELTPARAGRAPHE000255"></a>

Una vez creado, el componente puede utilizarse en cualquier otro proyecto WINDEV. Veamos cómo reutilizar el componente.



- Para ello, crearemos un nuevo proyecto e importaremos el componente en él.

	1. Cierre el proyecto actual: en la pestaña "Inicio", en el grupo "General", despliegue "Cerrar" y seleccione "Cerrar proyecto".

	2. Cierre el proyecto y guarde los cambios, si es necesario.

	3. La página de inicio de WINDEV aparece.

	4. Cree un nuevo proyecto: haga clic en "Crear un proyecto" en la página de inicio.

		- Este proyecto será una aplicación Windows.

		- Defina "CompUse" como nombre del proyecto y no incluya ningún análisis..




5. En la pestaña "Proyecto", en el grupo "Proyecto", despliegue "Importar" y seleccione "Un componente externo ... Desde un archivo".

6. En el directorio del proyecto "WD Full Application", seleccione el subdirectorio "EXE\\CompoOrdersByCity", y luego el archivo "CompoOrdersByCity.wdi".

7. Después de hacer clic en "Abrir", se muestra la descripción del componente interno. Esta descripción contiene:

	- En la pestaña "General", los elementos introducidos al crear el componente externo y su ubicación.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Cr%E9er%20et%20utiliser%20un%20composant%20-%20HC%20N%B0007.jpg&type=thumb)




- Vamos a crear una ventana en blanco para utilizar el componente.

	1. Cree una ventana en blanco.

		- Para el título de la ventana, introduzca "Customers by city" .

		- El nombre de la ventana cambia automáticamente a "WIN_Customers_by_city".

		- Guarde.




2. Abra los eventos WLanguage asociados a la ventana (seleccione "Código" en el menú contextual).

3. Vamos a llamar a la función **DataLocation** del componente en el evento "Fin de inicialización". Esta función espera como parámetro la ruta que permite acceder a los archivos de datos que manipula el componente. Introduzca la ruta de acceso a los datos en el ejemplo "WD Full Application". Por ejemplo: 
			
		```wl
		DataLocation(...// Specify the path of YOUR data
			"C:\My Projects\My examples\WD Full Application (Exercises)\Exe\")
		```

			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Si el proyecto utiliza otro procedimiento con el nombre "DataLocation", el nombre del procedimiento del componente debe ir precedido del nombre del conjunto de procedimientos utilizado. El código pasa a ser:<br><br><pre><code>SET_Component.DataLocation(...</code></pre><br> |





4. Cierre el editor de código.

5. Agregue los siguientes controles a la ventana:

	- Un control Campo de entrada de tipo Texto con el título "City" y el nombre "EDT_City".

	- Un control Tabla con el nombre "TABLE_Result", rellenado mediante programación y con 2 columnas: 

		- una columna con el título "Name" de tipo Texto. 

		- una columna con el título "Total sales" de tipo Monetario.




- Edite los eventos WLanguage del control "BTN_Search". Al hacer clic en el control, se ejecutará el procedimiento de búsqueda del componente. Este procedimiento:

	- espera el nombre de la ciudad como parámetro

	- devuelve una cadena en el siguiente formato: 
			
		```txt
		Name of customer 1 + TAB + Total sales 1 + CR + 
		Name of customer 2 + TAB + Total sales 2 + ...
		```



 El código del evento "Clic" del control "BTN_Search" debe:

- llamar al procedimiento **GiveOrdersByCity** del componente pasando el contenido del control EDT_City como parámetro.

- procesar la cadena devuelta para agregarla al control Tabla.




- Cierre el editor de código y guarde la ventana. 




- Pruebe la ventana: haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_GO_Fenetre_WD_GAF.jpg) en los botones de acceso rápido. En el control Campo de entrada, introduzca "Paris" (conservando mayúsculas y minúsculas) y haga clic en el botón "Search". La lista de clientes aparece.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Cr%E9er%20et%20utiliser%20un%20composant%20-%20HC%20N%B0010.jpg)





- ¡Eso es todo!




Hemos visto cómo crear un componente y reutilizarlo en las aplicaciones. También puede utilizar procedimientos de instalación para los componentes, con el fin de distribuirlos por separado de las aplicaciones, por ejemplo.

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Distribuir un componente externo
<a name="distribuir_componente_externo_ELTTEXTE000710"></a>
Existen dos métodos para distribuir un componente:

1. Proporcionar los archivos necesarios "manualmente", distribución "estándar".

2. Crear una distribución más "profesional", mediante el editor de instalación de WINDEV (WDInst).



<a name="NOTE4_2"></a>


### Distribución estándar
<a name="distribucion_estandar_ELTPARAGRAPHE000372"></a>

En este caso, debe proporcionar todos los archivos necesarios para el componente. Estos archivos se crean al generar el componente (archivos WDI, WDK y WDO, imágenes, otros documentos, etc.). Los archivos se deben copiar manualmente del directorio de origen al directorio de destino. Los proyectos WINDEV que utilizan el componente buscarán los archivos dependientes en el directorio de destino.

Lista de archivos que deben proporcionarse para una distribución estándar:

- archivos generados automáticamente por WINDEV (WDK, WDI, etc.). 

- archivos de dependencia.

- si el componente utiliza archivos de dependencia, debe proporcionarse el archivo WDO. Este archivo contiene las referencias a los archivos externos utilizados en el componente.



<a name="NOTE4_3"></a>


### Distribución profesional
<a name="distribucion_profesional_ELTPARAGRAPHE000385"></a>

La distribución de componentes mediante un procedimiento de instalación consiste en proporcionar un programa de instalación a los usuarios del componente WINDEV. Este programa instala todos los archivos necesarios para el componente en el directorio especificado por el usuario.

Este modo de instalación permite gestionar automáticamente:

- el archivo WDO y la instalación de archivos adicionales utilizados por el componente.

- la instalación automática de las herramientas necesarias (MDAC, controlador ODBC para HFSQL, etc.).

- la actualización automática de los archivos de datos utilizados por el componente (si es necesario).

- la desinstalación del componente.




- Cierre el proyecto "CompoUse": en la pestaña "Inicio", en el grupo "General", despliegue "Cerrar" y seleccione "Cerrar proyecto".




- Abra el proyecto "WD Full Application" en el que trabajó anteriormente (vaya a la página de inicio, haga clic en "Abrir un proyecto" y seleccione "WD Full Application"). Si es necesario, seleccione la configuración del proyecto que corresponde al componente en el panel "Explorador de proyectos". 




- Para crear la instalación, en la pestaña "Proyecto", en el grupo "Generación", haga clic en "Procedimiento de instalación".  


El asistente para crear la instalación del componente se abre.

No entraremos en detalles sobre los diferentes modos de instalación de un componente. Siga las etapas del asistente.


Para obtener más información sobre la instalación de componentes, consulte [Distribuir un componente externo](../Editeurs/2014007.md).

| [Lección anterior](../TutoWD/1410087524.md) | [Tabla de contenido](../TutoWD/1410087560.md) | [Siguiente lección](../TutoWD/1410087526.md) |
| --- | --- | --- |




