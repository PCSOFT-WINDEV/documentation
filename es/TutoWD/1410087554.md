
## Lección 7.7. Sockets
<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Esta lección abarcará los siguientes temas
<a name="esta_leccion_abarcara_los_siguientes_temas_ELTTEXTE000272"></a>


- Presentación.

- Aplicación Servidor.

- Aplicación Cliente.





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=dur%E9e.png)<br> | <br>Tiempo estimado: 20 min |

| [Lección anterior](../TutoWD/1410087553.md) | [Tabla de contenido](../TutoWD/1410087560.md) | [Siguiente lección](../TutoWD/1410087555.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Presentación
<a name="presentacion_ELTTEXTE000319"></a>
WINDEV incluye funciones avanzadas de gestión de sockets.

Un socket es un recurso utilizado por las aplicaciones para comunicarse de un equipo a otro, independientemente del tipo de red.

Este modo de comunicación se utiliza para establecer la comunicación entre dos aplicaciones que se encuentran en equipos diferentes (conectados a través de Internet o en la misma red local) o en el mismo equipo.

Las aplicaciones WINDEV pueden gestionar sockets según diferentes modos:

- Aplicación WINDEV Cliente: la aplicación se conecta a cualquier servidor e intercambia datos a través de un socket.

- Aplicación WINDEV, WEBDEV o WINDEV Mobile "Servidor": la aplicación WINDEV, WEBDEV o WINDEV Mobile es un servidor que intercambia información a través de sockets con distintas máquinas cliente. Para gestionar varias conexiones simultáneas, es necesario utilizar hilos.


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WD.png) | Ejemplo | WINDEV incluye un ejemplo didáctico que permite entender el uso de los sockets: "WD Using sockets". Puede acceder a este ejemplo desde la página de inicio de WINDEV (Ctrl + &lt;). |





<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Aplicación Servidor: servidor simplificado
<a name="aplicacion_servidor_servidor_simplificado_ELTTEXTE000361"></a>
WINDEV le ofrece la posibilidad de crear un servidor de sockets simplificado. **Este servidor establece la comunicación con un solo equipo cliente a la vez**. Este tipo de aplicación es muy útil cuando se debe establecer una comunicación entre dos aplicaciones remotas.

Las etapas para crear un servidor simplificado son las siguientes:

1. Creación del socket.

2. Intercambio de datos.

3. Cierre del socket.



<a name="NOTE3_2"></a>


### Creación del socket
<a name="creacion_del_socket_ELTPARAGRAPHE000054"></a>

Para crear el socket, el servidor utiliza la función [SocketCreate](../WDLang3/3070011.md). Un socket está enlazado a un puerto específico. Para utilizar sockets fácilmente mediante programación en el servidor, especifique el nombre del socket.

La máquina cliente se conectará al socket para intercambiar datos. La conexión se establecerá realmente cuando las dos máquinas intercambien datos por primera vez (es decir, cuando el servidor lea la información por primera vez).

La conexión se establece la primera vez que la función [SocketRead](../WDLang3/3070014.md) lee la información en el servidor.
<a name="NOTE3_3"></a>


### Intercambio de datos
<a name="intercambio_datos_ELTPARAGRAPHE000071"></a>

Cuando dos máquinas utilizan el mismo socket, se establece un flujo de comunicación entre ellas. Estas dos máquinas pueden leer y escribir cadenas de caracteres en el socket.

**Observación**: Para no bloquear las aplicaciones, los mensajes entrantes se pueden gestionar mediante un hilo específico.

Para leer y escribir datos en el socket, la aplicación servidor de WINDEV debe utilizar las funciones [SocketRead](../WDLang3/3070014.md) y [SocketWrite](../WDLang3/3070002.md).

**Atención**: Para iniciar una operación de lectura, debe haberse realizado previamente una operación de escritura. Por ejemplo:

1. La máquina cliente escribe en el socket: envía una solicitud al servidor.

2. El servidor lee los datos del socket en un hilo. Cuando se recibe un mensaje, el servidor lo procesa.

3. Si se requiere una respuesta al mensaje, el servidor identifica la máquina cliente (función [SocketClientInfo](../WDLang3/3070009.md)) y envía una respuesta.



<a name="NOTE3_4"></a>


### Cierre del socket
<a name="cierre_del_socket_ELTPARAGRAPHE000097"></a>

Para finalizar la comunicación, el servidor puede cerrar el socket con la función [SocketClose](../WDLang3/3070015.md).

**Observación**: la máquina cliente también puede cerrar el socket.

<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Aplicación Cliente
<a name="aplicacion_cliente_ELTTEXTE000403"></a>
Una aplicación cliente de un servidor de sockets se conecta a un servidor estándar para intercambiar información a través de un socket.

Ejemplo: Una aplicación WINDEV cliente puede conectarse a un servidor de noticias estándar en Internet.

Los pasos para crear una aplicación cliente son los siguientes:

1. Conexión al servidor

2. Intercambio de datos.

3. Fin de la comunicación



<a name="NOTE4_2"></a>


### Conexión al servidor
<a name="conexion_servidor_ELTPARAGRAPHE000124"></a>

Para conectarse a un socket del servidor, utilice la función [SocketConnect](../WDLang3/3070016.md). Esta función realiza una solicitud de conexión al servidor.

El socket se identifica por su puerto y dirección.
<a name="NOTE4_3"></a>


### Intercambio de datos
<a name="intercambio_datos_ELTPARAGRAPHE000136"></a>

Cuando dos máquinas utilizan el mismo socket, se establece un flujo de comunicación entre ellas. Estas dos máquinas pueden leer y escribir cadenas de caracteres en el socket.

**Observación**: Para no bloquear las aplicaciones, los mensajes entrantes se pueden gestionar mediante un hilo específico.

Para leer y escribir datos en el socket, la aplicación cliente WINDEV debe utilizar las funciones [SocketRead](../WDLang3/3070014.md) y [SocketWrite](../WDLang3/3070002.md).
<a name="NOTE4_4"></a>


### Fin de la comunicación
<a name="fin_comunicacion_ELTPARAGRAPHE000153"></a>

Para finalizar la comunicación, cierre el socket desde la máquina cliente con la función [SocketClose](../WDLang3/3070015.md).

**Observación**: también puede finalizar la comunicación desde el servidor.

<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Ejemplo práctico
<a name="ejemplo_practico_ELTTEXTE000445"></a>
Veremos un ejemplo real sobre la programación de sockets a través del ejemplo unitario "Using sockets".
<a name="NOTE5_2"></a>


### Prueba del ejemplo
<a name="prueba_del_ejemplo_ELTPARAGRAPHE000172"></a>

- Abra el ejemplo unitario "Using sockets".




- Pruebe la ventana "WIN_Socket". Se enviará un mensaje de la máquina B a la máquina A. La máquina A es la aplicación Servidor y la máquina B es la aplicación Cliente.

	1. En la máquina A, haga clic en el botón "Create" para crear el socket.

	2. La máquina B puede conectarse al socket creado por la máquina A. Haga clic en el botón "Connect" (en la sección Computer B).

	3. La máquina B envía un mensaje a la máquina A:

		- Escriba el mensaje que desea enviar en el campo "Sentence to send to computer A".

		- Haga clic en "Send" en el área "Computer B".




4. Para recuperar el mensaje en la máquina A, haga clic en el botón "Get" en el área "Computer A".

5. Haga clic en los botones "Disonnect" para desconectar las dos máquinas.




- Detenga la prueba de la ventana para volver al editor.



<a name="NOTE5_3"></a>


### Análisis del código utilizado
<a name="analisis_del_codigo_utilizado_ELTPARAGRAPHE000192"></a>

- Veamos el código de los diferentes botones que hemos utilizado.




- Primero, analizaremos los procesos realizados por el servidor de sockets (máquina A). 

	1. Abra el código del botón "Create" en el área "Computer A":

		- Seleccione el botón "Create".

		- Pulse F2 para abrir los eventos.




2. En el evento "Clic", verá la función [SocketCreate](../WDLang3/3070011.md), que permite crear el socket. Cierre el editor de código.

3. Abra el código del botón "Get" en el área "Computer A":

	- Seleccione el botón "Get".

	- Pulse F2 para abrir los eventos.




- Veamos los procesos realizados por el cliente (máquina B).

	1. Abra el código del botón "Connect" en el área "Computer B":

		- Seleccione el botón "Connect".

		- Pulse F2 para abrir los eventos.




2. En el evento "Clic", verá la función [SocketConnect](../WDLang3/3070016.md), que permite conectarse al socket creado por la máquina A. Cierre el editor de código.

3. Abra el código del botón "Send" en el área "Computer B":

	- Seleccione el botón "Send".

	- Pulse F2 para abrir los eventos.




Observación: En esta lección, hemos visto una comunicación "simple" entre un servidor y una máquina cliente: el cliente envía mensajes y el servidor los procesa. También es posible crear aplicaciones más complejas.

La comunicación también puede establecerse entre dos aplicaciones, tanto cliente como servidor. En este caso, los hilos son muy útiles para gestionar los mensajes enviados y las respuestas. 

| [Lección anterior](../TutoWD/1410087553.md) | [Tabla de contenido](../TutoWD/1410087560.md) | [Siguiente lección](../TutoWD/1410087555.md) |
| --- | --- | --- |




