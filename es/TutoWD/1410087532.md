
## Lección 4.1. Aplicación completa: Ventanas de adición y modificación
<a name="NOTE1"></a>
<a name="NOTE1_1"></a>


## Esta lección abarcará los siguientes temas
<a name="esta_leccion_abarcara_los_siguientes_temas_ELTTEXTE000943"></a>


- Presentación del proyecto de ejemplo. 

- Crear una ventana de menú con una lista de productos.

- Crear una ficha de producto.

- Agregar y modificar productos.





|   |   |
| --- | --- |
| <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=dur%E9e.png)<br> | <br>Tiempo estimado: 50 min |



| [Lección anterior](../TutoWD/1410087521.md) | [Tabla de contenido](../TutoWD/1410087560.md) | [Siguiente lección](../TutoWD/1410087533.md) |
| --- | --- | --- |





<a name="NOTE2"></a>
<a name="NOTE2_1"></a>


## Presentación del ejemplo utilizado en esta parte
<a name="presentacion_del_ejemplo_utilizado_esta_parte_ELTTEXTE000990"></a>
En esta parte, vamos a crear una aplicación que manipula archivos de datos en formato HFSQL Classic.

Esta aplicación de gestión de pedidos se utilizará para:

- Ver, introducir y modificar productos,

- Imprimir reportes,

- Ver estadísticas,

- Administrar niveles de uso,

- Enviar correos electrónicos,

- etc.


El desarrollo de esta aplicación también nos permitirá ver como implementar y distribuir aplicaciones a los usuarios finales.

Esto nos permitirá abarcar los principales puntos para desarrollar una aplicación. 

En la parte anterior de este tutorial vimos cómo crear un proyecto y un análisis. No lo veremos de nuevo. Trabajaremos con un proyecto que ya contiene un análisis con datos. El análisis de la aplicación es una versión mejorada del análisis que creamos en la parte anterior. 

Vamos a: 

- crear diferentes ventanas para ver, agregar y modificar productos. 

- crear diferentes reportes. 

- implementar la aplicación. 

- utilizar funcionalidades propias del desarrollo de la aplicación (Cuadro de mando, Auditorías, SCM). 

- integrar algunas funcionalidades (Groupware Usuario, gestión de correos electrónicos, etc.).  




Estas operaciones le permitirán descubrir varios aspectos de los archivos de datos, y además, le permitirán utilizar algunas funcionalidades de WINDEV.



- Abra el proyecto "WD Full Application":

	1. Inicie WINDEV. 

	2. Vaya a la página de inicio de WINDEV (Ctrl + &lt;).

	3. En la página de inicio, haga clic en "Tutorial", luego en "Part 4 - Full application with data" haga doble clic en "Full application - Exercise".
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=exemple-WD.png) | Corregido | Hay un proyecto completado disponible. Este proyecto contiene las ventanas que crearemos en esta lección. Para abrir el proyecto completado, vaya a la página de inicio y haga clic en "Tutorial", luego en "Part 4 - Full application with data", haga doble clic en "Full application - Answers". |











<a name="NOTE3"></a>
<a name="NOTE3_1"></a>


## Crear una ventana con la lista de productos
<a name="crear_una_ventana_con_lista_productos_ELTTEXTE001032"></a>
Para crear la ventana que contendrá la lista de productos, crearemos una ventana en blanco y luego agregaremos todos los controles: esto nos permitirá presentar los pasos necesarios para crear este tipo de ventana.
<a name="NOTE3_2"></a>


### Crear una ventana
<a name="crear_una_ventana_ELTPARAGRAPHE000075"></a>

- Para crear la ventana que contendrá la lista de productos:

	1. Cree una nueva ventana en blanco.

		- Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Cr%E9er1_GAF.jpg) en los botones de acceso rápido (o presione Ctrl + N).

		- La ventana de creación de nuevos elementos se abre: haga clic en "Ventana", y luego en "Ventana".

		- En el asistente, haga clic en la pestaña "Basado en un modelo" y seleccione "Utilizar: WINTPL_Template". Valide.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | **Modelos de ventanas**<br><br>Un modelo de ventana permite que todas las ventanas de la aplicación tengan un estilo homogéneo.<br><br>Un modelo contiene los elementos gráficos comunes a todas las ventanas de la aplicación. Un modelo de ventana también puede contener código. En este caso, el código será el mismo para todas las ventanas de la aplicación.<br><br>Para este ejemplo, hemos creado el modelo de ventana WINTPL_Template. Este modelo contiene un logotipo que se mostrará en todas las ventanas:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0007%201.jpg&type=thumb)<br> |








2. La nueva ventana se muestra en el editor. La ventana para guardar el elemento se abre. 

3. En esta ventana, especifique el título de la ventana: "Menu".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0001.jpg)


|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | El nombre de esta ventana es "Menu" porque será la ventana principal de la aplicación. Se usará como menú y también mostrará información. |




<a name="NOTE3_3"></a>


### Crear controles
<a name="crear_controles_ELTPARAGRAPHE000109"></a>

Utilizaremos un control Tabla para crear la lista de productos. Este control estará vinculado al archivo de datos "Product".|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | **¿Qué es un control Tabla?**<br><br>No se deben confundir los términos "Tabla" y "control Tabla".<br><br>- El término **Tabla** se utiliza en el contexto de una base de datos de tipo SQL.<br><br>- Un **control Tabla** muestra datos en la UI. En este caso, los datos se pueden introducir directamente o provenir de un archivo de datos (o tabla).<br><br><br><br><br>El control Tabla de WINDEV permite mostrar o modificar datos:<br><br>- en la memoria: en este caso se habla de control **Tabla rellenada mediante programación**.<br><br>- de archivos de datos o consultas: en este caso se habla de control **Tabla basado en un archivo de datos**.<br><br>- de variables WLanguage: en este caso se habla de control **Tabla basado en una variable**.<br><br><br> |







- Para crear el control Tabla:

	1. En la pestaña "Creación", en el grupo "Datos", despliegue "Tabla y List Box" y seleccione "Tabla (Vertical)". El control seguirá el cursor del ratón.

	2. Haga clic dentro de la ventana: el asistente de creación del control Tabla se abre.

	3. El control Tabla que estamos creando debe mostrar los registros del archivo de datos "Product". En el asistente, seleccione la opción "Mostrar datos de un archivo o una consulta existente". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0002.jpg&type=thumb)
Pase a la etapa siguiente del asistente (botón "Siguiente").

	4. La siguiente etapa del asistente muestra los diferentes archivos de datos y consultas en el proyecto actual. Despliegue "Análisis" si es necesario y seleccione el archivo de datos "Product". <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0003.jpg&type=thumb)
Pase a la etapa siguiente.

	5. El asistente muestra la lista de campos en el archivo de datos "Product". 
			De forma predeterminada, todos los campos están seleccionados para que se muestren en el control Tabla. En nuestro caso, se mostrarán todos los campos EXCEPTO el identificador "ProductID" que corresponde al identificador automático del archivo de datos. 
			Deseleccione "ProductID".<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0004.jpg&type=thumb)
Pase a la etapa siguiente.

	6. A continuación, el asistente propone seleccionar el campo de ordenación. Este campo se utilizará para ordenar los datos que se muestran en el control Tabla. Los campos que se muestran en el asistente son los que se definieron como clave en el análisis. Vamos a definir el orden de los campos según el título. Haga clic en la fila "Caption".<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0005.jpg&type=thumb)
Pase a la etapa siguiente.

	7. Las siguientes etapas son ajustes adicionales. Conserve las opciones predeterminadas hasta el final y finalice el asistente.

	8. El control Tabla se crea automáticamente en la ventana. El control se posiciona y redimensiona automáticamente para adaptarse a todo el espacio disponible en la ventana.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0007.jpg&type=thumb)








Veamos el control que acabamos de crear: los datos ya se muestran en el control, incluso en el editor. **Este concepto es conocido como "Live data"**: el contenido de los archivos de datos que se encuentran en el equipo de desarrollo se utiliza en las ventanas o reportes manipulados en el editor. Esta funcionalidad es especialmente útil para definir el tamaño de los controles en una ventana, por ejemplo.
<a name="NOTE3_4"></a>


### Prueba de la ventana
<a name="prueba_ventana_ELTPARAGRAPHE000169"></a>

- Vamos a probar la ventana que acabamos de crear.

	1. Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_GO_Fenetre_WD_GAF.jpg) en los botones de acceso rápido.

	2. La ventana se muestra automáticamente con sus datos en modo de ejecución.

	3. Puede navegar por los productos con la barra de desplazamiento (o con las flechas del teclado).







- Imaginemos que somos el usuario final para ver cómo funciona el control Tabla en tiempo de ejecución.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0008.jpg&type=thumb)



Observaciones:

- El control Tabla se muestra de la misma manera en ejecución y en el editor: esto es conocido como WYSIWYG ("What You See Is What You Get"): lo que ves es lo que obtienes.

- En la parte superior de las columnas aparecen íconos pequeños:

	- la doble flecha indica que la columna se puede ordenar (columna "Reference" o "Caption", por ejemplo). <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0008%201.jpg)
Haga clic dos veces en la columna "Caption": los datos se muestran según un orden diferente. Una flecha a la izquierda de la columna indica que está ordenada y muestra la dirección del orden.

	- la lupa indica que se puede realizar una búsqueda en la columna. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0008%202.jpg)
Haga clic en la lupa de la columna "Reference", por ejemplo. Un área de entrada le permite escribir la referencia que desea buscar. Introduzca "REF-010". El producto que corresponde a la referencia se muestra automáticamente.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0009.jpg)





- El control Tabla y las columnas contienen un menú contextual. Este menú contextual aparece:

	- haciendo clic derecho en la columna del control Tabla.

	- haciendo clic en la flecha situada en la esquina superior derecha de los encabezados de las columnas.







- Este menú contextual permite exportar el contenido del control Tabla a Excel (u OpenOffice.org Calc), Word (u OpenOffice.org Writer), imprimir, etc.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%20Liste%20des%20produits%20-%20HC%20N%B0010.jpg&type=thumb)





En pocos minutos, hemos visto algunas de las funcionalidades que están incluidas automáticamente en el control Tabla. No es necesario escribir código para que los usuarios puedan acceder a estas funcionalidades. Estas funcionalidades se conocen como "FAA" (Funcionalidades Automáticas de la Aplicación).|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Varios controles incluyen las FAA de forma predeterminada. Si estas funcionalidades no deben estar disponibles (por razones de seguridad o privacidad), pueden desactivarse en el editor o en el código. <br><br>Para obtener más información, consulte [Funcionalidades Automáticas de la Aplicación (FAA)](../Editeurs/9000022.md). |



Ahora que tenemos la lista de productos, vamos a ver cómo modificar uno. Para ello, vamos a crear una ventana en la que se mostrarán los detalles del producto.



- Cierre la ventana de prueba con la "X" situada en la esquina superior derecha de la pantalla. Enseguida, se vuelve a mostrar el editor de WINDEV.




<a name="NOTE4"></a>
<a name="NOTE4_1"></a>


## Crear una ventana "Product form"
<a name="crear_una_ventana_product_form_ELTTEXTE001146"></a>


### Crear una ventana
<a name="crear_una_ventana_ELTPARAGRAPHE000227"></a>

Vamos a crear una ventana para mostrar las características del producto seleccionado en el control Tabla. El nombre de este tipo de ventana es "Form" porque corresponde a una ficha descriptiva del elemento deseado. 

- Para crear una ventana que muestre los detalles del producto:

	1. Abra el proyecto "WD Full Application", si es necesario.

	2. Cree una nueva ventana en blanco.

		- Haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Cr%E9er1_GAF.jpg) en los botones de acceso rápido.

		- La ventana de creación de nuevos elementos se abre: haga clic en "Ventana", y luego en "Ventana". 

		- El asistente de creación de ventanas se abre.

		- En la pestaña "Basado en un modelo", seleccione "Utilizar: WINTPL_Template" y valide el asistente.




3. La ventana para guardar el elemento se abre. Introduzca el título de la ventana: "Product form". El nombre "WIN_Product_form" se completa automáticamente. 

4. Valide la ventana.



<a name="NOTE4_2"></a>


### Crear controles Campo de entrada
<a name="crear_controles_campo_entrada_ELTPARAGRAPHE000248"></a>

La ventana "Form" mostrará los datos de los campos del archivo de datos "Product". 



- Para crear los controles en la ventana:

	1. Abra el panel "Análisis" si es necesario: en la pestaña "Inicio", en el grupo "Entorno", despliegue "Paneles", seleccione "Paneles" y, a continuación, haga clic en "Análisis". Los archivos de datos descritos en el análisis "WD Full Application" se muestran en el panel.

	2. Haga clic en el ícono ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0001%201.jpg) a la izquierda del archivo de datos "Product": los campos del archivo de datos aparecen.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0001.jpg)


	3. Seleccione todos los campos que se muestran en el panel (excepto "ProductID"). Puede seleccionar varios elementos manteniendo pulsada la tecla Ctrl.

4. Arrastre los campos y suéltelos en la ventana que acabamos de crear.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0002.jpg&type=thumb)




- Mueva los controles y cambie el tamaño de la ventana para obtener la siguiente UI:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0004.jpg)




<a name="NOTE4_3"></a>


### Crear botones
<a name="crear_botones_ELTPARAGRAPHE000292"></a>

Vamos a agregar y modificar productos de la lista en la ventana "WIN_Product_form".

Para ello, agregaremos un botón para validar y uno para cancelar.

- Para crear el control Botón que permite validar los datos introducidos:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", despliegue "Botón" (haga clic en la flecha que se encuentra debajo de ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Bouton_GAF.jpg)).

	2. Enseguida, aparece una lista con botones predefinidos.

	3. Haga clic en "OK": la forma del control Botón aparece bajo el puntero del ratón.

	4. Haga clic a la derecha de los controles Campo de entrada para crear el control Botón.







- Agregue el control Botón que permite cancelar la entrada de datos siguiendo los mismo pasos.

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", despliegue "Botón" (haga clic en la flecha que se encuentra debajo de ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Bouton_GAF.jpg)).

	2. En la lista de botones predefinidos, haga clic en "Cancel": la forma del control Botón aparece bajo el puntero del ratón.

	3. Luego, haga clic debajo del botón"OK" para crear el control.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0005.jpg)







<a name="NOTE4_4"></a>


### Mejoras en la UI de las ventanas
<a name="mejoras_las_ventanas_ELTPARAGRAPHE000343"></a>

Esta ventana es bastante simple, vamos a mejorar su UI. Cambiaremos algunos detalles para mejorar la experiencia del usuario.

**Alineación de controles**

- Vamos a comenzar alineando los controles y definiendo un mismo tamaño:

	1. Seleccione el control "Caption" y luego, todos los controles Campo de entrada de la ventana (mantenga pulsada la tecla Ctrl y haga clic en los controles). El primer control seleccionado se utilizará como referencia para establecer el tamaño de los otros controles.

	2. En la cinta de opciones, vaya a la pestaña "Alineación". Esta pestaña contiene todas las opciones de alineación disponibles para los controles.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0006.jpg&type=thumb)


	3. Vamos a alinear los bordes externos e internos de los controles. Haga clic en la opción "Justificar (Int. y Ext.)". 
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Si no está seguro de qué alineación elegir, pase el cursor por encima de las opciones de la pestaña "Alineación". Al pasar el cursor por encima de una opción, los controles seleccionados en la ventana se posicionan y/o cambian de tamaño automáticamente según la opción por la que se pasa el cursor.<br><br>Para aplicar la alineación, haga clic en la opción deseada.<br><br>Si no desea aplicar la alineación, simplemente salga de las opciones de alineación: los controles vuelven a su posición inicial. |


<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0007.jpg)




**Cambiar el tamaño de la ventana**

Una vez posicionados todos los controles en la ventana, podemos definir su tamaño final. En nuestro ejemplo, la ventana sigue siendo demasiado grande. 

- Podemos utilizar los controladores de tamaño, como hemos hecho anteriormente. Sin embargo, WINDEV también ofrece la posibilidad de introducir directamente las dimensiones de la ventana. 

	1. Haga clic en la ventana del editor. La ventana se selecciona. 

	2. En la barra de mensajes, introduzca el nuevo tamaño de la ventana. <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0007%201.jpg)
En este ejemplo, la dimensión inicial es de 609 x 270, vamos a establecer una nueva dimensión de 554 x 252.

	3. La ventana se modifica automáticamente. Para deshacer los cambios y seleccionar otro tamaño, pulse Ctrl +Z.  







**Gestión de anclajes**

- Veamos el aspecto visual de nuestra ventana:

	1. En la pestaña "Modificación", en el grupo "Vista previa", haga clic en "Vista previa". Este modo de ejecución solo permite ver la interfaz de la ventana. Los diferentes códigos no se ejecutan.

	2. Amplíe la ventana con los controladores de tamaño que se encuentran en la parte inferior de la ventana. La posición de los controles no cambia, por lo que hay gran espacio vacío en la ventana. Existen dos métodos para resolver este problema:

		- Evitar que la ventana cambie de tamaño.

		- Definir los anclajes, es decir, el comportamiento de los controles cuando se cambia el tamaño de la ventana. Veamos cómo realizar esta acción.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0008.jpg&type=thumb)







- Vamos a definir los anclajes para esta ventana:

	1. Los botones "OK" y "Cancel" deben permanecer anclados a la derecha.

		- Seleccione ambos controles.

		- Haga clic derecho para abrir el menú contextual y seleccione "Anclaje".

		- En la ventana de opciones de anclaje, seleccione "Derecha".  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0009.jpg)


		- Valide. 

- En el editor aparecen pequeñas flechas rojas que indican que los controles están anclados a la derecha.

2. Los controles Campo de entrada deben ampliarse horizontalmente:

	- Seleccione los 4 controles Campo de entrada.

	- Haga clic derecho para abrir el menú contextual y seleccione "Anclaje".

	- En la ventana de opciones de anclaje, seleccione "Ancho" (![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_MP%20-%20Ancrage%20fiche%20-%20HC%20N%B0004%202.jpg)).

	- Valide.



<a name="NOTE4_6"></a>


### Abrir la ficha de producto desde la lista de productos
<a name="abrir_ficha_producto_desde_lista_productos_ELTPARAGRAPHE000473"></a>

Ahora, veamos cómo abrir la ficha del producto seleccionado en la lista de productos. El principio es muy sencillo: el usuario selecciona el producto en el control Tabla y abre los detalles del producto mediante un control Botón.



- Vamos a modificar la ventana "WIN_Menu" para crear un control Botón:

	1. Vaya a la ventana "Menu": haga clic en "WIN_Menu" en las pestañas de documentos abiertos:  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0011.jpg)


	2. Actualmente, el control Tabla ocupa toda la ventana. Amplíe la ventana hacia la derecha con los controladores de tamaño.

3. Reduzca el tamaño del control Tabla:

	- Mantenga pulsada la tecla Shift. 

	- Reduzca el control Tabla con los controladores de tamaño.
						|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | La tecla Shift permite ignorar las opciones de anclaje al cambiar el tamaño de los controles. |








- Para crear el control Botón que permite ver el producto:

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", despliegue "Botón" (haga clic en la flecha que se encuentra debajo de ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Bouton_GAF.jpg)).

	2. Escriba "Modificar" en la barra de búsqueda de la lista de controles Botón predefinidos. Haga clic en "Botón Modificar". La forma del control aparece bajo el cursor. Luego, haga clic a la derecha del control Tabla para crear el control Botón.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%202%20-%20Fiche%20produit%20-%20HC%20N%B0012.jpg&type=thumb)


	3. Haga clic derecho en el control que acaba de crear. Seleccione "Código" en el menú que aparece.

4. En la ventana de código que aparece, escriba el siguiente código WLanguage en el evento "Clic":
			
		```wl
		WIN_Product_form.Open()
		```

			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | El editor de código incluye la funcionalidad de entrada predictiva (también llamada "Autocompletado"): al introducir un punto después del nombre de la ventana, aparecerá una lista desplegable con las funciones que pueden utilizarse en dicha ventana. Solo tiene que seleccionar la función que desee con el teclado o cursor. |





5. Analicemos este código WLanguage: la función [&lt;Ventana&gt;.Open](../WDLang1/1000023903.md) permite abrir la ventana "WIN_Product_form". Ya vimos esta función en la primera parte de este tutorial.

6. Guarde los cambios haciendo clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Enregistrer_GAF.jpg) en los botones de acceso rápido.

7. Cierre la ventana de código (haga clic en la "X" de la esquina superior derecha del editor de código).




Vamos a modificar la ventana "WIN_Product_form" para abrir el producto seleccionado en el control Tabla.

- Abra la ventana "WIN_Product_form": haga clic en la pestaña correspondiente en las pestañas de documentos abiertos.




- Para ver los datos del producto:

	1. Abra los eventos asociados a la ventana:

		- Haga clic derecho fuera de la ventana.

		- Seleccione "Código" en el menú contextual que aparece.

		- El editor de código se abre. Enseguida, se muestran los eventos WLanguage asociados a la ventana. 




2. Introduzca el siguiente código WLanguage en el evento "Fin de inicialización de WIN_Product_form":
			
		```wl
		// Assigns the content of items to the controls
		Product.ToWindow()
		```

			La función [&lt;Archivo de datos&gt;.ToWindow](../WDLang4/1000021397.md) muestra los datos del archivo de datos que corresponden al registro actual en los controles. En este caso, el registro actual es el registro seleccionado en el control Tabla de la ventana "WIN_Menu".




1. Cierre la ventana de código.

2. Guarde la ventana (Ctrl + S).




- Abra la ventana "WIN_Menu" en el editor: haga clic en la pestaña correspondiente en las pestañas de documentos abiertos.




- Pruebe la ventana (haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_GO_Fenetre_WD_GAF.jpg) en los botones de acceso rápido).

	- En la lista de productos, haga clic en uno de ellos.

	- Haga clic en el botón "Modify".

	- La ventana de detalles del producto se abre.







- Cierre las diferentes ventanas de prueba haciendo clic en la "X" de la equina superior derecha de las ventanas.




<a name="NOTE5"></a>
<a name="NOTE5_1"></a>


## Modificar un producto
<a name="modificar_producto_ELTTEXTE001266"></a>
Ahora modificaremos la ventana "WIN_Product_form" para modificar un producto.

Vamos a:

- permitir que el usuario modifique la imagen del producto.

- agregar controles Botón para guardar o cancelar los cambios realizados en la ficha del producto.



<a name="NOTE5_2"></a>


### Modificar la imagen del producto
<a name="modificar_imagen_del_producto_ELTPARAGRAPHE000579"></a>

El usuario podrá modificar la imagen de la ficha de producto. Para ello, vamos a crear un control Botón "Modify" debajo de la imagen del producto. Este control abrirá un selector de archivos para seleccionar la imagen deseada.



- Primero, abra la ventana "WIN_Product_form": haga clic en la pestaña correspondiente en las pestañas de documentos abiertos.




- Para crear el control Botón que permite modificar la imagen: 

	1. En la pestaña "Creación", en el grupo "Controles frecuentes", despliegue "Botón". Escriba "Modificar" en la barra de búsqueda de la lista de controles Botón predefinidos. Haga clic en "Botón Modificar". 

	2. La forma del control aparece bajo el cursor. Haga clic dentro de la ventana, debajo de la imagen del producto.

	3. Si es necesario, cambie el tamaño del botón (con los controladores de tamaño) para que tenga el mismo ancho que la imagen.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Al cambiar el tamaño del control, un efecto de magnetismo automático facilita la alineación del control Botón con el control Imagen. |


<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0001.jpg)


	4. Haga clic derecho en el control Botón. Seleccione "Código" en el menú que aparece.

5. En la ventana de código que aparece, escriba el siguiente código WLanguage en el evento "Clic":
			
		```txt
		fImageSelect(
		```
<br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0002.jpg)




Probaremos esta funcionalidad una vez que se hayan realizado todos los cambios en la ficha de producto.
<a name="NOTE5_3"></a>


### Validar los cambios realizados en el producto
<a name="validar_los_cambios_realizados_producto_ELTPARAGRAPHE000638"></a>

Hemos creado dos controles Botón en la ventana "WIN_Product_form":

- un control Botón "OK" para validar los cambios,

- un control Botón "Cancel" para volver a la lista de productos.


Ahora vamos a escribir el código WLanguage de estos dos controles.



- Primero, abra la ventana "WIN_Product_form": haga clic en la pestaña correspondiente en las pestañas de documentos abiertos.




- Vamos a introducir el código WLanguage del botón "OK".

	1. Haga clic derecho en el control Botón y seleccione "Código" en el menú contextual.

	2. Introduzca el siguiente código en el evento "Clic" de WLanguage:
			
		```wl
		ScreenToFile()
		Product.Modify()
		Close()
		```

			Analicemos este código WLanguage:

		- La función [ScreenToFile](../WDLang4/3044146.md) actualiza los campos del registro actual con los datos de los controles enlazados. Esta función equivale a las siguientes líneas de código:
						
			```wl
			Product.Reference = EDT_Reference
			Product.Caption = EDT_Caption
			Product.Description = EDT_Description
			...
			```

						Nuestra ventana contiene menos de 10 controles y ya hemos visto la simplicidad de WLanguage; entre más controles se utilicen, ahorrará más líneas de código: ¡una sola línea de código asigna todos los valores!

		- La función [&lt;Archivo de datos&gt;.Modify](../WDLang4/1000025038.md) actualiza el registro actual en el archivo de datos.




3. Guarde los cambios haciendo clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Enregistrer_GAF.jpg) en los botones de acceso rápido.

4. Cierre la ventana de código (haga clic en la "X" de la esquina superior derecha del editor de código).




- Las modificaciones realizadas en la ventana "WIN_Product_form" deben tenerse en cuenta en el control Tabla que muestra la lista de productos. Para ello, vamos a modificar el código WLanguage asociado al control Botón "Modify" en la ventana "WIN_Menu".

	1. Abra la ventana "WIN_Menu" en el editor: haga clic en la pestaña correspondiente en las pestañas de documentos abiertos.

	2. Seleccione el botón "Modify" y abra el editor de código (F2).

	3. Modifique el evento "Clic" de la siguiente manera:
			
		```wl
		// Opens the product form for the selected product
		WIN_Product_form.Open()
		
		// Updates the selected row
		TABLE_Product.Display(taCurrentSelection)
		```
Analicemos este código:

		- La función [&lt;Tabla&gt;.Display](../WDLang1/1000023505.md) actualiza el control Tabla con los datos modificados en la ficha del producto.

		- La constante *taCurrentSelection* especifica que el control Tabla debe actualizarse a partir de la posición de la banda de selección.




4. Guarde los cambios haciendo clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Enregistrer_GAF.jpg) en los botones de acceso rápido.

5. Cierre la ventana de código (haga clic en la "X" de la esquina superior derecha del editor de código).



<a name="NOTE5_4"></a>


### Probar cambios en el producto
<a name="probar_cambios_producto_ELTPARAGRAPHE000699"></a>

- Para probar los cambios de un producto:

	1. Pruebe el proyecto (haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_GO_Projet_WD_GAF.jpg) en los botones de acceso rápido).  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Go_Projet_acces_rapide.jpg)


	2. WINDEV le pide que seleccione la primera ventana del proyecto. En este caso, la ventana "WIN_Menu". Seleccione la ventana y valide.
			|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | La primera ventana del proyecto es la primera ventana que se abrirá al iniciar la aplicación. La primera ventana del proyecto se puede definir:<br><br>		- durante la prueba del proyecto, <br><br>		- al crear el ejecutable, <br><br>		- en el panel "Explorador de proyectos": seleccione la ventana deseada, abra el menú contextual y seleccione "Primera ventana del proyecto".<br><br><br>Cuando se define la primera ventana del proyecto, aparece un 1 rojo pequeño a la izquierda del nombre de la ventana en el panel "Explorador de proyectos". |





3. El proyecto se inicia en modo de prueba y se muestra la primera ventana. 

4. Seleccione un producto de la lista de productos (por ejemplo, el primero) y haga clic en "Modify".

5. Los detalles del producto seleccionado se muestran en la ficha del producto.

6. Cambie el precio de 100,23 a 200,00 y haga clic en "OK".

7. Al volver a la lista de productos, notará que el precio del producto se actualizó correctamente.

8. Abra de nuevo los detalles del producto.

9. Haga clic en el botón "Modify" debajo de la imagen. Un selector de imágenes se abre. Seleccione una imagen y valide. La imagen seleccionada se muestra en la ficha.

10. Haga clic en el botón "Cancel". La modificación de la imagen no se tuvo en cuenta en el archivo de datos.

11. Haga clic en la "X" para cerrar la aplicación.




<a name="NOTE6"></a>
<a name="NOTE6_1"></a>


## Crear un nuevo producto
<a name="crear_nuevo_producto_ELTTEXTE001362"></a>
El principio para crear un producto es el siguiente:

- En la ventana de la lista de productos, vamos a agregar un control Botón "New" que abrirá la ventana "Product form".

- A continuación, modificaremos el código de la ventana "Product form" para agregar un producto al archivo de datos Product.



<a name="NOTE6_2"></a>


### Agregar un control Botón
<a name="agregar_control_boton_ELTPARAGRAPHE000741"></a>

- Para agregar un control Botón "New" en la ventana "WIN_Menu":

	1. Abra la ventana "WIN_Menu" en el editor: haga clic en la pestaña correspondiente en las pestañas de documentos abiertos.

	2. En la pestaña "Creación", en el grupo "Controles frecuentes", despliegue "Botón" y seleccione "Botón Nuevo".

	3. La forma del control aparece bajo el cursor. Haga clic dentro de la ventana: el control Botón se crea en el editor.

	4. Ubique el control Botón encima del botón "Modify" (si es necesario, desplace el botón "Modify").  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0003.jpg&type=thumb)


	5. Modifique el código WLanguage del control:

	- Haga clic derecho en el botón "New" y seleccione "Código" en el menú contextual.

	- Introduzca el siguiente código en el evento "Clic" de WLanguage:
						
			```wl
			Product.Reset()
			WIN_Product_form.Open()
			TABLE_Product.Display(taCurrentRecord)
			```
Analicemos este código:

		- La función [Reset](../WDLang4/1000025052.md) reinicia las variables de los campos del archivo de datos "Product" con los valores predeterminados para gestionar el nuevo registro.

		- La función [Open](../WDLang1/1000023903.md) abre la ficha de producto para introducir el nuevo registro.

		- La función [Display](../WDLang1/3074003.md) vuelve a mostrar el control Tabla. En este código, la constante ***taCurrentRecord*** vuelve a mostrar el control Tabla a partir de la posición del registro actual.



<a name="NOTE6_3"></a>


### Agregar un nuevo registro al archivo de datos
<a name="agregar_nuevo_registro_archivo_datos_ELTPARAGRAPHE000790"></a>

- Ahora modificaremos la ventana de la ficha de producto para agregar un nuevo registro.

	1. Abra la ventana "WIN_Product_form".

	2. Vamos a hacer algunos cambios en el código WLanguage del botón "OK":

		- Haga clic derecho en "OK" y seleccione "Código" en el menú contextual.

		- En el evento "Clic", reemplace el código WLanguage por el siguiente:
						
			```wl
			ScreenToFile()
			IF Product..NewRecord THEN
				Product.Add()
			ELSE
				Product.Modify()
			END
			Close()
			```
Analicemos este código WLanguage:

			- La propiedad [NewRecord](../Proprietes/1000017090.md) permite saber si se debe crear el registro actual.

			- Si se llamó a la función [&lt;Archivo de datos&gt;.Reset](../WDLang4/1000025052.md) previamente, la propiedad devuelve <u><u><u><u>True</u></u></u></u> (por ejemplo, al hacer clic en "New") y el registro se crea con la función [Add](../WDLang4/1000024187.md).

			- Si el registro actual ya existe, se modifica con la función [&lt;Archivo de datos&gt;.Modify](../WDLang4/1000025038.md).

			- La función [&lt;Archivo de datos&gt;.Add](../WDLang4/1000024187.md) agrega el registro al archivo de datos. Esta función toma los valores en la memoria y escribe el contenido de los campos en el mismo archivo de datos. Los índices se actualizan inmediatamente de forma automática. En este caso, se actualiza el archivo de datos "Product".
										|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | El código de prueba del nuevo registro se puede reemplazar con la función [&lt;Archivo de datos&gt;.Save](../WDLang4/1000024606.md). Esta función comprueba si el registro ya está en el archivo de datos, y le permite agregarlo o modificarlo si es necesario. El código pasa a ser:<br><br><pre><code>ScreenToFile()<br>				Product.Save()<br>				Close()</code></pre><br> |








3. Guarde los cambios haciendo clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_Enregistrer_GAF.jpg) en los botones de acceso rápido.

4. Cierre la ventana de código (haga clic en la "X" de la esquina superior derecha del editor de código).



<a name="NOTE6_4"></a>


### Probar la adición de un nuevo producto
<a name="probar_adicion_nuevo_producto_ELTPARAGRAPHE000843"></a>

- Para probar la adición de un producto:

	1. Pruebe el proyecto (haga clic en ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=ICO_GO_Projet_WD_GAF.jpg) en los botones de acceso rápido).

	2. En la lista de productos, haga clic en el botón "New".

	3. Introduzca un nuevo producto con las siguientes características:

		- Reference: REF-337

		- Caption: Surf WD

		- Description: Surf with WINDEV colors

		- Price: 150 <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0004.jpg)





|   |   |   |
| --- | --- | --- |
| ![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=note.png) | Nota | Pueden producirse varios errores al agregar o modificar un registro: errores de duplicados, de integridad, de contraseña, etc.<br><br>WINDEV proporciona varios modos para gestionar dichos errores:<br><br>- **modo automático**: por cada error encontrado al manipular los registros de la base de datos, se muestra una página específica al usuario. Esta ventana permite que los usuarios modifiquen sus datos directamente.<br><br>- **el modo avanzado mediante programación**: por cada error encontrado al manipular los registros de la base de datos, se llama a un procedimiento o ventana personalizados de gestión de errores.<br><br><br><br><br>El ejemplo "WD Detecting HFSQL Errors", que viene con WINDEV, permite probar los diferentes modos de gestión de errores. Este ejemplo se puede abrir a través de la página principal de WINDEV (Ctrl + &lt;), opción "Abrir un ejemplo". |




<a name="NOTE6_5"></a>


### Ver registros
<a name="ver_registros_ELTPARAGRAPHE000885"></a>

Los registros agregados se pueden ver inmediatamente en el control Tabla de la ventana "WIN_Menu".

Sin embargo, en algunos casos (al realizar pruebas, por ejemplo), es posible que desee ver el contenido del archivo de datos directamente.

WINDEV ofrece una herramienta sencilla para ver el contenido de los archivos de datos cuando se está desarrollando una aplicación (por ejemplo, cuando aún no se han creado las ventanas en las que se mostrarán los datos). 

Esta herramienta es WDMAP. Vamos a utilizarla para ver el contenido del archivo de datos Product.

- Para abrir WDMAP:

	1. En la pestaña "Herramientas", en el grupo "Base de datos", haga clic en "WDMap". 

	2. Seleccione el archivo de datos "Product". El contenido del archivo de datos se muestra.  <br>![](https://doc.pcsoft.fr/en-US/images/image.awp?langid=7&name=P4_Application%20compl%E8te%20-%203%20-%20Cr%E9ation%20Modif%20-%20HC%20N%B0006.jpg&type=thumb)


	3. Ordene los elementos por referencia (haga clic en el encabezado de la columna "Reference"), los dos registros que creamos anteriormente aparecen en la tabla.




| [Lección anterior](../TutoWD/1410087521.md) | [Tabla de contenido](../TutoWD/1410087560.md) | [Siguiente lección](../TutoWD/1410087533.md) |
| --- | --- | --- |




